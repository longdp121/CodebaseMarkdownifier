[![Chat](https://img.shields.io/discord/457912077277855764?label=chat&logo=discord)](https://svelte.dev/chat)

# SvelteKit

Web development, streamlined. Read the [documentation](https://kit.svelte.dev/docs) to get started.

### Packages

| Package                                                                     | Changelog                                                     |
| --------------------------------------------------------------------------- | ------------------------------------------------------------- |
| [@sveltejs/kit](packages/kit)                                               | [Changelog](packages/kit/CHANGELOG.md)                        |
| [@sveltejs/adapter-auto](packages/adapter-auto)                             | [Changelog](packages/adapter-auto/CHANGELOG.md)               |
| [@sveltejs/adapter-cloudflare](packages/adapter-cloudflare)                 | [Changelog](packages/adapter-cloudflare/CHANGELOG.md)         |
| [@sveltejs/adapter-cloudflare-workers](packages/adapter-cloudflare-workers) | [Changelog](packages/adapter-cloudflare-workers/CHANGELOG.md) |
| [@sveltejs/adapter-netlify](packages/adapter-netlify)                       | [Changelog](packages/adapter-netlify/CHANGELOG.md)            |
| [@sveltejs/adapter-node](packages/adapter-node)                             | [Changelog](packages/adapter-node/CHANGELOG.md)               |
| [@sveltejs/adapter-static](packages/adapter-static)                         | [Changelog](packages/adapter-static/CHANGELOG.md)             |
| [@sveltejs/adapter-vercel](packages/adapter-vercel)                         | [Changelog](packages/adapter-vercel/CHANGELOG.md)             |
| [@sveltejs/amp](packages/amp)                                               | [Changelog](packages/amp/CHANGELOG.md)                        |
| [@sveltejs/enhanced-img](packages/enhanced-img)                             | [Changelog](packages/enhanced-img/CHANGELOG.md)               |
| [@sveltejs/package](packages/package)                                       | [Changelog](packages/package/CHANGELOG.md)                    |
| [create-svelte](packages/create-svelte)                                     | [Changelog](packages/create-svelte/CHANGELOG.md)              |
| [svelte-migrate](packages/migrate)                                          | [Changelog](packages/migrate/CHANGELOG.md)                    |

[Additional adapters](https://sveltesociety.dev/packages?category=sveltekit-adapters) are maintained by the community.

## Bug reporting

Please make sure the issue you're reporting involves SvelteKit. Many issues related to how a project builds originate from [Vite](https://vitejs.dev/), which is used to build a SvelteKit project. You can create a new Vite project with `npm create vite@latest` for client-side only repros and `npm create vite-extra@latest` for SSR or library repros.

If an issue originates from Vite, please report it in the [Vite issue tracker](https://github.com/vitejs/vite/issues).

## Contributing

See [CONTRIBUTING.md](./CONTRIBUTING.md) for information on how to develop SvelteKit locally.

## Supporting Svelte

Svelte is an MIT-licensed open source project with its ongoing development made possible entirely by fantastic volunteers. If you'd like to support their efforts, please consider:

- [Becoming a backer on Open Collective](https://opencollective.com/svelte).

Funds donated via Open Collective will be used for compensating expenses related to Svelte's development such as hosting costs. If sufficient donations are received, funds may also be used to support Svelte's development more directly.

## License

[MIT](https://github.com/sveltejs/kit/blob/main/LICENSE)


########## Project Structure ##########

.
├── CONTRIBUTING.md
├── documentation
│   └── docs
│       ├── 10-getting-started
│       │   ├── 10-introduction.md
│       │   ├── 20-creating-a-project.md
│       │   ├── 30-project-structure.md
│       │   ├── 40-web-standards.md
│       │   └── meta.json
│       ├── 20-core-concepts
│       │   ├── 10-routing.md
│       │   ├── 20-load.md
│       │   ├── 30-form-actions.md
│       │   ├── 40-page-options.md
│       │   ├── 50-state-management.md
│       │   └── meta.json
│       ├── 25-build-and-deploy
│       │   ├── 10-building-your-app.md
│       │   ├── 20-adapters.md
│       │   ├── 30-adapter-auto.md
│       │   ├── 40-adapter-node.md
│       │   ├── 50-adapter-static.md
│       │   ├── 55-single-page-apps.md
│       │   ├── 60-adapter-cloudflare.md
│       │   ├── 70-adapter-cloudflare-workers.md
│       │   ├── 80-adapter-netlify.md
│       │   ├── 90-adapter-vercel.md
│       │   ├── 99-writing-adapters.md
│       │   └── meta.json
│       ├── 30-advanced
│       │   ├── 10-advanced-routing.md
│       │   ├── 20-hooks.md
│       │   ├── 25-errors.md
│       │   ├── 30-link-options.md
│       │   ├── 40-service-workers.md
│       │   ├── 50-server-only-modules.md
│       │   ├── 65-snapshots.md
│       │   ├── 67-shallow-routing.md
│       │   ├── 70-packaging.md
│       │   └── meta.json
│       ├── 40-best-practices
│       │   ├── 05-performance.md
│       │   ├── 07-images.md
│       │   ├── 10-accessibility.md
│       │   ├── 20-seo.md
│       │   └── meta.json
│       ├── 50-reference
│       │   ├── 10-configuration.md
│       │   ├── 20-cli.md
│       │   ├── 30-modules.md
│       │   ├── 40-types.md
│       │   └── meta.json
│       └── 60-appendix
│           ├── 10-faq.md
│           ├── 20-integrations.md
│           ├── 30-migrating-to-sveltekit-2.md
│           ├── 40-migrating.md
│           ├── 50-additional-resources.md
│           ├── 60-glossary.md
│           └── meta.json
├── FUNDING.json
├── LICENSE
├── package.json
├── packages
│   ├── adapter-auto
│   │   ├── adapters.js
│   │   ├── CHANGELOG.md
│   │   ├── index.d.ts
│   │   ├── index.js
│   │   ├── package.json
│   │   ├── README.md
│   │   └── tsconfig.json
│   ├── adapter-cloudflare
│   │   ├── ambient.d.ts
│   │   ├── CHANGELOG.md
│   │   ├── index.d.ts
│   │   ├── index.js
│   │   ├── package.json
│   │   ├── placeholders.d.ts
│   │   ├── README.md
│   │   ├── src
│   │   │   └── worker.js
│   │   └── tsconfig.json
│   ├── adapter-cloudflare-workers
│   │   ├── ambient.d.ts
│   │   ├── CHANGELOG.md
│   │   ├── files
│   │   │   ├── entry.js
│   │   │   └── _package.json
│   │   ├── index.d.ts
│   │   ├── index.js
│   │   ├── package.json
│   │   ├── placeholders.d.ts
│   │   ├── README.md
│   │   └── tsconfig.json
│   ├── adapter-netlify
│   │   ├── ambient.d.ts
│   │   ├── CHANGELOG.md
│   │   ├── index.d.ts
│   │   ├── index.js
│   │   ├── package.json
│   │   ├── README.md
│   │   ├── rollup.config.js
│   │   ├── src
│   │   │   ├── edge.js
│   │   │   ├── headers.js
│   │   │   ├── headers.spec.js
│   │   │   ├── serverless.js
│   │   │   └── shims.js
│   │   └── tsconfig.json
│   ├── adapter-node
│   │   ├── ambient.d.ts
│   │   ├── CHANGELOG.md
│   │   ├── index.d.ts
│   │   ├── index.js
│   │   ├── LICENSE
│   │   ├── package.json
│   │   ├── README.md
│   │   ├── rollup.config.js
│   │   ├── src
│   │   │   ├── env.js
│   │   │   ├── handler.js
│   │   │   ├── index.js
│   │   │   └── shims.js
│   │   ├── tests
│   │   │   └── smoke.spec.js
│   │   └── tsconfig.json
│   ├── adapter-static
│   │   ├── CHANGELOG.md
│   │   ├── index.d.ts
│   │   ├── index.js
│   │   ├── LICENSE
│   │   ├── package.json
│   │   ├── platforms.js
│   │   ├── README.md
│   │   ├── test
│   │   │   ├── apps
│   │   │   │   ├── prerendered
│   │   │   │   │   ├── package.json
│   │   │   │   │   ├── playwright.config.js
│   │   │   │   │   ├── src
│   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   ├── global.d.ts
│   │   │   │   │   │   └── routes
│   │   │   │   │   │       ├── endpoint
│   │   │   │   │   │       │   ├── explicit.json
│   │   │   │   │   │       │   │   └── +server.js
│   │   │   │   │   │       │   └── implicit.json
│   │   │   │   │   │       │       └── +server.js
│   │   │   │   │   │       ├── +layout.js
│   │   │   │   │   │       ├── +layout.svelte
│   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │       ├── +page.svelte
│   │   │   │   │   │       ├── public-env
│   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │       └── server-emitted-asset
│   │   │   │   │   │           ├── image.jpg
│   │   │   │   │   │           ├── +page.server.js
│   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   ├── test
│   │   │   │   │   │   └── test.js
│   │   │   │   │   └── vite.config.js
│   │   │   │   └── spa
│   │   │   │       ├── jsconfig.json
│   │   │   │       ├── package.json
│   │   │   │       ├── playwright.config.js
│   │   │   │       ├── README.md
│   │   │   │       ├── src
│   │   │   │       │   ├── app.html
│   │   │   │       │   └── routes
│   │   │   │       │       ├── about
│   │   │   │       │       │   ├── +page.js
│   │   │   │       │       │   └── +page.svelte
│   │   │   │       │       ├── +error.svelte
│   │   │   │       │       ├── fallback
│   │   │   │       │       │   └── [...rest]
│   │   │   │       │       │       └── +page.svelte
│   │   │   │       │       ├── +layout.svelte
│   │   │   │       │       └── +page.svelte
│   │   │   │       ├── svelte.config.js
│   │   │   │       ├── test
│   │   │   │       │   └── test.js
│   │   │   │       └── vite.config.js
│   │   │   └── utils.js
│   │   └── tsconfig.json
│   ├── adapter-vercel
│   │   ├── ambient.d.ts
│   │   ├── CHANGELOG.md
│   │   ├── files
│   │   │   ├── edge.js
│   │   │   └── serverless.js
│   │   ├── index.d.ts
│   │   ├── index.js
│   │   ├── internal.d.ts
│   │   ├── package.json
│   │   ├── README.md
│   │   ├── test
│   │   │   └── utils.spec.js
│   │   ├── tsconfig.json
│   │   └── utils.js
│   ├── amp
│   │   ├── CHANGELOG.md
│   │   ├── index.d.ts
│   │   ├── index.js
│   │   └── package.json
│   ├── create-svelte
│   │   ├── bin.js
│   │   ├── CHANGELOG.md
│   │   ├── index.js
│   │   ├── package.json
│   │   ├── README.md
│   │   ├── scripts
│   │   │   ├── build-templates.js
│   │   │   ├── update-template-repo-contents.js
│   │   │   └── update-template-repo.sh
│   │   ├── shared
│   │   │   ├── +checkjs
│   │   │   │   ├── jsconfig.json
│   │   │   │   └── package.json
│   │   │   ├── +default+checkjs
│   │   │   │   └── svelte.config.js
│   │   │   ├── +default+typescript
│   │   │   │   └── svelte.config.js
│   │   │   ├── +default-typescript
│   │   │   │   └── svelte.config.js
│   │   │   ├── +default+vitest
│   │   │   │   └── src
│   │   │   │       └── routes
│   │   │   │           └── sverdle
│   │   │   │               └── game.test.ts
│   │   │   ├── +eslint
│   │   │   │   └── package.json
│   │   │   ├── +eslint+prettier
│   │   │   │   └── package.json
│   │   │   ├── +eslint-prettier
│   │   │   │   └── package.json
│   │   │   ├── -eslint+prettier
│   │   │   │   └── package.json
│   │   │   ├── +eslint+prettier+typescript
│   │   │   ├── +eslint+prettier-typescript
│   │   │   ├── +eslint+svelte5
│   │   │   │   └── package.json
│   │   │   ├── +eslint+typescript
│   │   │   │   └── package.json
│   │   │   ├── +eslint-typescript
│   │   │   ├── +playwright
│   │   │   │   └── package.json
│   │   │   ├── +playwright+default
│   │   │   │   └── tests
│   │   │   │       └── test.ts
│   │   │   ├── +playwright+skeleton
│   │   │   │   └── tests
│   │   │   │       └── test.ts
│   │   │   ├── +playwright+skeletonlib
│   │   │   │   └── tests
│   │   │   │       └── test.ts
│   │   │   ├── +playwright+typescript
│   │   │   │   └── playwright.config.ts
│   │   │   ├── +playwright-typescript
│   │   │   │   └── playwright.config.js
│   │   │   ├── +playwright+vitest
│   │   │   │   └── package.json
│   │   │   ├── +prettier
│   │   │   │   └── package.json
│   │   │   ├── README.md
│   │   │   ├── +skeletonlib
│   │   │   │   └── README.md
│   │   │   ├── +skeletonlib+checkjs
│   │   │   │   └── jsconfig.json
│   │   │   ├── +skeletonlib+svelte5
│   │   │   │   └── package.json
│   │   │   ├── +skeletonlib+typescript
│   │   │   │   └── tsconfig.json
│   │   │   ├── +skeletonlib-typescript
│   │   │   │   └── jsconfig.json
│   │   │   ├── +svelte5
│   │   │   │   └── package.json
│   │   │   ├── +typescript
│   │   │   │   ├── package.json
│   │   │   │   ├── svelte.config.js
│   │   │   │   └── tsconfig.json
│   │   │   ├── -typescript
│   │   │   │   └── svelte.config.js
│   │   │   ├── vite.config.ts
│   │   │   ├── +vitest
│   │   │   │   ├── package.json
│   │   │   │   └── vite.config.ts
│   │   │   ├── +vitest+skeleton
│   │   │   │   └── src
│   │   │   │       └── index.test.ts
│   │   │   └── +vitest+skeletonlib
│   │   │       └── src
│   │   │           └── index.test.ts
│   │   ├── templates
│   │   │   ├── default
│   │   │   │   ├── netlify.toml
│   │   │   │   ├── package.json
│   │   │   │   ├── package.template.json
│   │   │   │   ├── README.md
│   │   │   │   ├── src
│   │   │   │   │   ├── app.d.ts
│   │   │   │   │   ├── app.html
│   │   │   │   │   ├── lib
│   │   │   │   │   │   └── images
│   │   │   │   │   │       ├── github.svg
│   │   │   │   │   │       ├── svelte-logo.svg
│   │   │   │   │   │       ├── svelte-welcome.png
│   │   │   │   │   │       └── svelte-welcome.webp
│   │   │   │   │   └── routes
│   │   │   │   │       ├── about
│   │   │   │   │       │   ├── +page.svelte
│   │   │   │   │       │   └── +page.ts
│   │   │   │   │       ├── Counter.svelte
│   │   │   │   │       ├── Header.svelte
│   │   │   │   │       ├── +layout.svelte
│   │   │   │   │       ├── +page.svelte
│   │   │   │   │       ├── +page.ts
│   │   │   │   │       ├── styles.css
│   │   │   │   │       └── sverdle
│   │   │   │   │           ├── game.ts
│   │   │   │   │           ├── how-to-play
│   │   │   │   │           │   ├── +page.svelte
│   │   │   │   │           │   └── +page.ts
│   │   │   │   │           ├── +page.server.ts
│   │   │   │   │           ├── +page.svelte
│   │   │   │   │           ├── reduced-motion.ts
│   │   │   │   │           └── words.server.ts
│   │   │   │   ├── static
│   │   │   │   │   ├── favicon.png
│   │   │   │   │   └── robots.txt
│   │   │   │   ├── svelte.config.js
│   │   │   │   ├── tsconfig.json
│   │   │   │   ├── vercel.json
│   │   │   │   ├── vite.config.js
│   │   │   │   └── wrangler.toml
│   │   │   ├── skeleton
│   │   │   │   ├── package.json
│   │   │   │   ├── package.template.json
│   │   │   │   ├── src
│   │   │   │   │   ├── app.d.ts
│   │   │   │   │   ├── app.html
│   │   │   │   │   ├── lib
│   │   │   │   │   │   └── index.ts
│   │   │   │   │   └── routes
│   │   │   │   │       └── +page.svelte
│   │   │   │   ├── static
│   │   │   │   │   └── favicon.png
│   │   │   │   ├── svelte.config.js
│   │   │   │   └── vite.config.js
│   │   │   └── skeletonlib
│   │   │       ├── package.template.json
│   │   │       ├── src
│   │   │       │   ├── app.d.ts
│   │   │       │   ├── app.html
│   │   │       │   ├── lib
│   │   │       │   │   └── index.ts
│   │   │       │   └── routes
│   │   │       │       └── +page.svelte
│   │   │       ├── static
│   │   │       │   └── favicon.png
│   │   │       ├── svelte.config.js
│   │   │       └── vite.config.js
│   │   ├── test
│   │   │   └── check.js
│   │   ├── tsconfig.json
│   │   ├── types
│   │   │   ├── index.d.ts
│   │   │   └── internal.d.ts
│   │   ├── utils.js
│   │   └── vitest.config.js
│   ├── enhanced-img
│   │   ├── CHANGELOG.md
│   │   ├── package.json
│   │   ├── README.md
│   │   ├── src
│   │   │   ├── index.js
│   │   │   └── preprocessor.js
│   │   ├── test
│   │   │   ├── Input.svelte
│   │   │   ├── Output.svelte
│   │   │   └── preprocessor.spec.js
│   │   ├── tsconfig.json
│   │   └── types
│   │       ├── ambient.d.ts
│   │       └── index.d.ts
│   ├── kit
│   │   ├── CHANGELOG.md
│   │   ├── kit.vitest.config.js
│   │   ├── package.json
│   │   ├── postinstall.js
│   │   ├── README.md
│   │   ├── scripts
│   │   │   ├── cp.js
│   │   │   ├── generate-dts.js
│   │   │   └── generate-version.js
│   │   ├── src
│   │   │   ├── cli.js
│   │   │   ├── constants.js
│   │   │   ├── core
│   │   │   │   ├── adapt
│   │   │   │   │   ├── builder.js
│   │   │   │   │   ├── builder.spec.js
│   │   │   │   │   ├── fixtures
│   │   │   │   │   │   ├── basic
│   │   │   │   │   │   │   └── static
│   │   │   │   │   │   │       └── answer.md
│   │   │   │   │   │   └── compress
│   │   │   │   │   │       └── foo.css
│   │   │   │   │   └── index.js
│   │   │   │   ├── config
│   │   │   │   │   ├── default-error.html
│   │   │   │   │   ├── fixtures
│   │   │   │   │   │   ├── default
│   │   │   │   │   │   │   └── svelte.config.js
│   │   │   │   │   │   └── export-string
│   │   │   │   │   │       └── svelte.config.js
│   │   │   │   │   ├── index.js
│   │   │   │   │   ├── index.spec.js
│   │   │   │   │   ├── options.js
│   │   │   │   │   └── types.d.ts
│   │   │   │   ├── env.js
│   │   │   │   ├── generate_manifest
│   │   │   │   │   ├── find_server_assets.js
│   │   │   │   │   └── index.js
│   │   │   │   ├── postbuild
│   │   │   │   │   ├── analyse.js
│   │   │   │   │   ├── crawl.js
│   │   │   │   │   ├── crawl.spec.js
│   │   │   │   │   ├── entities.js
│   │   │   │   │   ├── entities.spec.js
│   │   │   │   │   ├── fallback.js
│   │   │   │   │   ├── fixtures
│   │   │   │   │   │   ├── base
│   │   │   │   │   │   │   ├── input.html
│   │   │   │   │   │   │   └── output.json
│   │   │   │   │   │   ├── basic-href
│   │   │   │   │   │   │   ├── input.html
│   │   │   │   │   │   │   └── output.json
│   │   │   │   │   │   ├── basic-src
│   │   │   │   │   │   │   ├── input.html
│   │   │   │   │   │   │   └── output.json
│   │   │   │   │   │   ├── basic-srcset
│   │   │   │   │   │   │   ├── input.html
│   │   │   │   │   │   │   └── output.json
│   │   │   │   │   │   ├── href-with-character-reference
│   │   │   │   │   │   │   ├── input.html
│   │   │   │   │   │   │   └── output.json
│   │   │   │   │   │   ├── ids
│   │   │   │   │   │   │   ├── input.html
│   │   │   │   │   │   │   └── output.json
│   │   │   │   │   │   ├── include-rel-external
│   │   │   │   │   │   │   ├── input.html
│   │   │   │   │   │   │   └── output.json
│   │   │   │   │   │   ├── meta
│   │   │   │   │   │   │   ├── input.html
│   │   │   │   │   │   │   └── output.json
│   │   │   │   │   │   └── unquoted-attributes
│   │   │   │   │   │       ├── input.html
│   │   │   │   │   │       └── output.json
│   │   │   │   │   ├── prerender.js
│   │   │   │   │   ├── queue.js
│   │   │   │   │   └── queue.spec.js
│   │   │   │   ├── sync
│   │   │   │   │   ├── create_manifest_data
│   │   │   │   │   │   ├── conflict.js
│   │   │   │   │   │   ├── index.js
│   │   │   │   │   │   ├── index.spec.js
│   │   │   │   │   │   ├── sort.js
│   │   │   │   │   │   ├── test
│   │   │   │   │   │   │   ├── params
│   │   │   │   │   │   │   │   ├── bar.js
│   │   │   │   │   │   │   │   └── foo.js
│   │   │   │   │   │   │   ├── samples
│   │   │   │   │   │   │   │   ├── basic
│   │   │   │   │   │   │   │   │   ├── about
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── blog
│   │   │   │   │   │   │   │   │   │   ├── default.svelte
│   │   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   │   ├── [slug]
│   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── [slug].json
│   │   │   │   │   │   │   │   │   │       └── +server.ts
│   │   │   │   │   │   │   │   │   ├── blog.json
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   ├── +page.d.ts
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── basic-layout
│   │   │   │   │   │   │   │   │   ├── foo
│   │   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── conflicting-groups
│   │   │   │   │   │   │   │   │   ├── (x)
│   │   │   │   │   │   │   │   │   │   └── a
│   │   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   │   └── (y)
│   │   │   │   │   │   │   │   │       └── a
│   │   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   │   ├── conflicting-params
│   │   │   │   │   │   │   │   │   ├── [slug1]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── [slug2]
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── conflicting-ts-js-handlers-layout
│   │   │   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   │   │   └── +layout.server.ts
│   │   │   │   │   │   │   │   ├── conflicting-ts-js-handlers-page
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.ts
│   │   │   │   │   │   │   │   ├── conflicting-ts-js-handlers-server
│   │   │   │   │   │   │   │   │   ├── +server.js
│   │   │   │   │   │   │   │   │   └── +server.ts
│   │   │   │   │   │   │   │   ├── custom-extension
│   │   │   │   │   │   │   │   │   ├── about
│   │   │   │   │   │   │   │   │   │   └── +page.jazz
│   │   │   │   │   │   │   │   │   ├── blog
│   │   │   │   │   │   │   │   │   │   ├── _default.svelte
│   │   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   │   ├── [slug]
│   │   │   │   │   │   │   │   │   │   │   └── +page.beebop
│   │   │   │   │   │   │   │   │   │   └── [slug].json
│   │   │   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   │   │   ├── blog.json
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   └── +page.funk
│   │   │   │   │   │   │   │   ├── declared-layout
│   │   │   │   │   │   │   │   │   └── +layout-foo.svelte
│   │   │   │   │   │   │   │   ├── encoding
│   │   │   │   │   │   │   │   │   ├── [x+22]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── [x+23]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── [x+3f]
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── hidden-dot
│   │   │   │   │   │   │   │   ├── hidden-underscore
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   └── _b
│   │   │   │   │   │   │   │   │   │       └── c
│   │   │   │   │   │   │   │   │   │           └── d.js
│   │   │   │   │   │   │   │   │   ├── e
│   │   │   │   │   │   │   │   │   │   └── f
│   │   │   │   │   │   │   │   │   │       └── g
│   │   │   │   │   │   │   │   │   │           └── h
│   │   │   │   │   │   │   │   │   │               └── +server.js
│   │   │   │   │   │   │   │   │   ├── _foo.js
│   │   │   │   │   │   │   │   │   ├── i
│   │   │   │   │   │   │   │   │   │   └── _j.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── invalid-named-layout-reference
│   │   │   │   │   │   │   │   │   └── x
│   │   │   │   │   │   │   │   │       ├── +page@.js
│   │   │   │   │   │   │   │   │       └── +page@.svelte
│   │   │   │   │   │   │   │   ├── invalid-params
│   │   │   │   │   │   │   │   │   └── [foo][bar]
│   │   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   │   ├── lockfiles
│   │   │   │   │   │   │   │   │   └── foo
│   │   │   │   │   │   │   │   │       ├── +server.js
│   │   │   │   │   │   │   │   │       └── +server.js_tmp
│   │   │   │   │   │   │   │   ├── multiple-layouts
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   └── +layout@.svelte
│   │   │   │   │   │   │   │   ├── multiple-pages
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── +page@.svelte
│   │   │   │   │   │   │   │   ├── multiple-slugs
│   │   │   │   │   │   │   │   │   └── [file].[ext]
│   │   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   │   ├── named-layout-missing
│   │   │   │   │   │   │   │   │   └── +page@missing.svelte
│   │   │   │   │   │   │   │   ├── named-layouts
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   ├── a1
│   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── +layout.svelte
│   │   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   │   ├── c
│   │   │   │   │   │   │   │   │   │   │   ├── c2
│   │   │   │   │   │   │   │   │   │   │   │   └── +page@.svelte
│   │   │   │   │   │   │   │   │   │   │   └── +layout.svelte
│   │   │   │   │   │   │   │   │   │   └── d
│   │   │   │   │   │   │   │   │   │       ├── d1
│   │   │   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │       └── (special)
│   │   │   │   │   │   │   │   │   │           ├── (extraspecial)
│   │   │   │   │   │   │   │   │   │           │   ├── d2
│   │   │   │   │   │   │   │   │   │           │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │           │   ├── d3
│   │   │   │   │   │   │   │   │   │           │   │   └── +page@(special).svelte
│   │   │   │   │   │   │   │   │   │           │   └── +layout.svelte
│   │   │   │   │   │   │   │   │   │           ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   └── (special)
│   │   │   │   │   │   │   │   │       ├── a
│   │   │   │   │   │   │   │   │       │   └── a2
│   │   │   │   │   │   │   │   │       │       └── +page.svelte
│   │   │   │   │   │   │   │   │       ├── (alsospecial)
│   │   │   │   │   │   │   │   │       │   ├── b
│   │   │   │   │   │   │   │   │       │   │   └── c
│   │   │   │   │   │   │   │   │       │   │       └── c1
│   │   │   │   │   │   │   │   │       │   │           └── +page.svelte
│   │   │   │   │   │   │   │   │       │   └── +layout.svelte
│   │   │   │   │   │   │   │   │       ├── +layout.js
│   │   │   │   │   │   │   │   │       ├── +layout.server.js
│   │   │   │   │   │   │   │   │       └── +layout.svelte
│   │   │   │   │   │   │   │   ├── nested-errors
│   │   │   │   │   │   │   │   │   └── foo
│   │   │   │   │   │   │   │   │       ├── bar
│   │   │   │   │   │   │   │   │       │   ├── baz
│   │   │   │   │   │   │   │   │       │   │   ├── +error.svelte
│   │   │   │   │   │   │   │   │       │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │       │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │       │   └── +error.svelte
│   │   │   │   │   │   │   │   │       └── +layout.svelte
│   │   │   │   │   │   │   │   ├── nested-optionals
│   │   │   │   │   │   │   │   │   └── [[a]]
│   │   │   │   │   │   │   │   │       └── [[b]]
│   │   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   │   ├── optional
│   │   │   │   │   │   │   │   │   ├── [[foo]]bar
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   ├── nested
│   │   │   │   │   │   │   │   │   │   └── [[optional]]
│   │   │   │   │   │   │   │   │   │       └── sub
│   │   │   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── [[optional]]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── prefix[[suffix]]
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── page-without-svelte-file
│   │   │   │   │   │   │   │   │   ├── error
│   │   │   │   │   │   │   │   │   │   ├── +error.svelte
│   │   │   │   │   │   │   │   │   │   └── [...path]
│   │   │   │   │   │   │   │   │   │       └── +page.js
│   │   │   │   │   │   │   │   │   ├── layout
│   │   │   │   │   │   │   │   │   │   ├── exists
│   │   │   │   │   │   │   │   │   │   │   ├── +layout.js
│   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │   └── redirect
│   │   │   │   │   │   │   │   │   │       └── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── rest
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   └── [...rest]
│   │   │   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   │   └── b
│   │   │   │   │   │   │   │   │       └── [...rest]
│   │   │   │   │   │   │   │   │           ├── +page.server.ts
│   │   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   │   ├── rest-prefix-suffix
│   │   │   │   │   │   │   │   │   ├── prefix-[...rest]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── [...rest].json
│   │   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   │   └── symlinks
│   │   │   │   │   │   │   │       ├── bar
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       └── routes
│   │   │   │   │   │   │   │           ├── foo -> ../bar
│   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   └── static
│   │   │   │   │   │   │       ├── bar
│   │   │   │   │   │   │       │   └── baz.txt
│   │   │   │   │   │   │       └── foo.txt
│   │   │   │   │   │   └── types.d.ts
│   │   │   │   │   ├── sync.js
│   │   │   │   │   ├── ts.js
│   │   │   │   │   ├── utils.js
│   │   │   │   │   ├── write_ambient.js
│   │   │   │   │   ├── write_client_manifest.js
│   │   │   │   │   ├── write_non_ambient.js
│   │   │   │   │   ├── write_root.js
│   │   │   │   │   ├── write_server.js
│   │   │   │   │   ├── write_tsconfig.js
│   │   │   │   │   ├── write_tsconfig.spec.js
│   │   │   │   │   └── write_types
│   │   │   │   │       ├── index.js
│   │   │   │   │       ├── index.spec.js
│   │   │   │   │       └── test
│   │   │   │   │           ├── actions
│   │   │   │   │           │   └── +page.server.js
│   │   │   │   │           ├── layout
│   │   │   │   │           │   ├── +layout.js
│   │   │   │   │           │   ├── +layout.server.js
│   │   │   │   │           │   ├── +layout.svelte
│   │   │   │   │           │   ├── +page.js
│   │   │   │   │           │   ├── +page.server.js
│   │   │   │   │           │   └── +page.svelte
│   │   │   │   │           ├── layout-advanced
│   │   │   │   │           │   ├── +layout.js
│   │   │   │   │           │   ├── +layout.svelte
│   │   │   │   │           │   └── (main)
│   │   │   │   │           │       ├── +layout.server.js
│   │   │   │   │           │       ├── +layout.svelte
│   │   │   │   │           │       ├── +page.js
│   │   │   │   │           │       ├── +page@.svelte
│   │   │   │   │           │       └── sub
│   │   │   │   │           │           ├── +page.js
│   │   │   │   │           │           └── +page.svelte
│   │   │   │   │           ├── package.json
│   │   │   │   │           ├── param-type-inference
│   │   │   │   │           │   ├── optional
│   │   │   │   │           │   │   └── [[optionalNarrowedParam=narrowed]]
│   │   │   │   │           │   │       └── +page.js
│   │   │   │   │           │   ├── params
│   │   │   │   │           │   │   ├── narrowed.js
│   │   │   │   │           │   │   └── not_narrowed.js
│   │   │   │   │           │   ├── required
│   │   │   │   │           │   │   ├── +layout.js
│   │   │   │   │           │   │   ├── [narrowedParam=narrowed]
│   │   │   │   │           │   │   │   └── +page.js
│   │   │   │   │           │   │   └── [regularParam=not_narrowed]
│   │   │   │   │           │   │       └── +page.js
│   │   │   │   │           │   └── spread
│   │   │   │   │           │       └── [...spread=narrowed]
│   │   │   │   │           │           └── +page.js
│   │   │   │   │           ├── simple-page-server-and-shared
│   │   │   │   │           │   ├── +page.js
│   │   │   │   │           │   ├── +page.server.js
│   │   │   │   │           │   └── +page.svelte
│   │   │   │   │           ├── simple-page-server-only
│   │   │   │   │           │   ├── +page.server.js
│   │   │   │   │           │   ├── +page.svelte
│   │   │   │   │           │   └── sub
│   │   │   │   │           │       ├── +page.server.js
│   │   │   │   │           │       └── +page.svelte
│   │   │   │   │           ├── simple-page-shared-only
│   │   │   │   │           │   ├── +page.js
│   │   │   │   │           │   ├── +page.svelte
│   │   │   │   │           │   └── sub
│   │   │   │   │           │       ├── +page.js
│   │   │   │   │           │       └── +page.svelte
│   │   │   │   │           ├── slugs
│   │   │   │   │           │   ├── +layout.js
│   │   │   │   │           │   ├── +layout.svelte
│   │   │   │   │           │   ├── [...rest]
│   │   │   │   │           │   │   ├── +page.js
│   │   │   │   │           │   │   └── +page.svelte
│   │   │   │   │           │   ├── [slug]
│   │   │   │   │           │   │   ├── +page.js
│   │   │   │   │           │   │   └── +page.svelte
│   │   │   │   │           │   └── x
│   │   │   │   │           │       └── [[optional]]
│   │   │   │   │           │           ├── +page.js
│   │   │   │   │           │           └── +page.svelte
│   │   │   │   │           ├── slugs-layout-not-all-pages-have-load
│   │   │   │   │           │   ├── +layout.js
│   │   │   │   │           │   ├── +layout.svelte
│   │   │   │   │           │   └── nested
│   │   │   │   │           │       ├── +layout.js
│   │   │   │   │           │       ├── +layout.svelte
│   │   │   │   │           │       ├── [...rest]
│   │   │   │   │           │       │   ├── +page.js
│   │   │   │   │           │       │   └── +page.svelte
│   │   │   │   │           │       └── [slug]
│   │   │   │   │           │           └── +page@.svelte
│   │   │   │   │           └── tsconfig.json
│   │   │   │   └── utils.js
│   │   │   ├── exports
│   │   │   │   ├── hooks
│   │   │   │   │   ├── index.js
│   │   │   │   │   ├── sequence.js
│   │   │   │   │   └── sequence.spec.js
│   │   │   │   ├── index.js
│   │   │   │   ├── node
│   │   │   │   │   ├── index.js
│   │   │   │   │   └── polyfills.js
│   │   │   │   ├── public.d.ts
│   │   │   │   └── vite
│   │   │   │       ├── build
│   │   │   │       │   ├── build_server.js
│   │   │   │       │   ├── build_service_worker.js
│   │   │   │       │   └── utils.js
│   │   │   │       ├── dev
│   │   │   │       │   └── index.js
│   │   │   │       ├── graph_analysis
│   │   │   │       │   ├── index.js
│   │   │   │       │   ├── index.spec.js
│   │   │   │       │   ├── types.d.ts
│   │   │   │       │   ├── utils.js
│   │   │   │       │   └── utils.spec.js
│   │   │   │       ├── index.js
│   │   │   │       ├── module_ids.js
│   │   │   │       ├── preview
│   │   │   │       │   └── index.js
│   │   │   │       ├── types.d.ts
│   │   │   │       ├── utils.js
│   │   │   │       └── utils.spec.js
│   │   │   ├── runtime
│   │   │   │   ├── app
│   │   │   │   │   ├── environment
│   │   │   │   │   │   ├── index.js
│   │   │   │   │   │   └── types.d.ts
│   │   │   │   │   ├── forms.js
│   │   │   │   │   ├── navigation.js
│   │   │   │   │   ├── paths
│   │   │   │   │   │   ├── index.js
│   │   │   │   │   │   └── types.d.ts
│   │   │   │   │   ├── server
│   │   │   │   │   │   └── index.js
│   │   │   │   │   └── stores.js
│   │   │   │   ├── client
│   │   │   │   │   ├── client.js
│   │   │   │   │   ├── constants.js
│   │   │   │   │   ├── entry.js
│   │   │   │   │   ├── fetcher.js
│   │   │   │   │   ├── parse.js
│   │   │   │   │   ├── session-storage.js
│   │   │   │   │   ├── types.d.ts
│   │   │   │   │   └── utils.js
│   │   │   │   ├── components
│   │   │   │   │   ├── error.svelte
│   │   │   │   │   └── layout.svelte
│   │   │   │   ├── control.js
│   │   │   │   ├── env
│   │   │   │   │   └── dynamic
│   │   │   │   │       ├── private.js
│   │   │   │   │       └── public.js
│   │   │   │   ├── hash.js
│   │   │   │   ├── server
│   │   │   │   │   ├── ambient.d.ts
│   │   │   │   │   ├── cookie.js
│   │   │   │   │   ├── cookie.spec.js
│   │   │   │   │   ├── data
│   │   │   │   │   │   └── index.js
│   │   │   │   │   ├── endpoint.js
│   │   │   │   │   ├── env_module.js
│   │   │   │   │   ├── fetch.js
│   │   │   │   │   ├── index.js
│   │   │   │   │   ├── page
│   │   │   │   │   │   ├── actions.js
│   │   │   │   │   │   ├── crypto.js
│   │   │   │   │   │   ├── crypto.spec.js
│   │   │   │   │   │   ├── csp.js
│   │   │   │   │   │   ├── csp.spec.js
│   │   │   │   │   │   ├── index.js
│   │   │   │   │   │   ├── load_data.js
│   │   │   │   │   │   ├── load_data.spec.js
│   │   │   │   │   │   ├── load_page_nodes.js
│   │   │   │   │   │   ├── render.js
│   │   │   │   │   │   ├── respond_with_error.js
│   │   │   │   │   │   ├── serialize_data.js
│   │   │   │   │   │   ├── serialize_data.spec.js
│   │   │   │   │   │   └── types.d.ts
│   │   │   │   │   ├── respond.js
│   │   │   │   │   └── utils.js
│   │   │   │   ├── shared.js
│   │   │   │   ├── shared-server.js
│   │   │   │   └── utils.js
│   │   │   ├── types
│   │   │   │   ├── ambient.d.ts
│   │   │   │   ├── ambient-private.d.ts
│   │   │   │   ├── global-private.d.ts
│   │   │   │   ├── internal.d.ts
│   │   │   │   ├── private.d.ts
│   │   │   │   └── synthetic
│   │   │   │       ├── $env+dynamic+private.md
│   │   │   │       ├── $env+dynamic+public.md
│   │   │   │       ├── $env+static+private.md
│   │   │   │       ├── $env+static+public.md
│   │   │   │       └── $lib.md
│   │   │   ├── utils
│   │   │   │   ├── array.js
│   │   │   │   ├── env.js
│   │   │   │   ├── error.js
│   │   │   │   ├── escape.js
│   │   │   │   ├── escape.spec.js
│   │   │   │   ├── exports.js
│   │   │   │   ├── exports.spec.js
│   │   │   │   ├── features.js
│   │   │   │   ├── filesystem.js
│   │   │   │   ├── filesystem.spec.js
│   │   │   │   ├── fork.js
│   │   │   │   ├── functions.js
│   │   │   │   ├── http.js
│   │   │   │   ├── http.spec.js
│   │   │   │   ├── misc.js
│   │   │   │   ├── options.js
│   │   │   │   ├── route_config.js
│   │   │   │   ├── routing.js
│   │   │   │   ├── routing.spec.js
│   │   │   │   ├── streaming.js
│   │   │   │   ├── streaming.spec.js
│   │   │   │   ├── url.js
│   │   │   │   └── url.spec.js
│   │   │   ├── version.js
│   │   │   └── version.spec.js
│   │   ├── svelte-kit.js
│   │   ├── test
│   │   │   ├── ambient.d.ts
│   │   │   ├── apps
│   │   │   │   ├── amp
│   │   │   │   │   ├── package.json
│   │   │   │   │   ├── playwright.config.js
│   │   │   │   │   ├── src
│   │   │   │   │   │   ├── app.d.ts
│   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   ├── hooks.server.js
│   │   │   │   │   │   └── routes
│   │   │   │   │   │       ├── http-equiv
│   │   │   │   │   │       │   └── cache-control
│   │   │   │   │   │       │       ├── +page.js
│   │   │   │   │   │       │       └── +page.svelte
│   │   │   │   │   │       ├── invalid
│   │   │   │   │   │       │   ├── has-stylesheet
│   │   │   │   │   │       │   │   └── +page.svelte
│   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │       ├── +layout.js
│   │   │   │   │   │       ├── +layout.svelte
│   │   │   │   │   │       ├── origin
│   │   │   │   │   │       │   ├── +page.js
│   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │       ├── origin.json
│   │   │   │   │   │       │   └── +server.js
│   │   │   │   │   │       ├── styles
│   │   │   │   │   │       │   ├── imported.css
│   │   │   │   │   │       │   ├── +page.svelte
│   │   │   │   │   │       │   └── Unused.svelte
│   │   │   │   │   │       ├── valid
│   │   │   │   │   │       │   ├── +page.js
│   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │       └── valid.json
│   │   │   │   │   │           └── +server.js
│   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   ├── test
│   │   │   │   │   │   └── test.js
│   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   └── vite.config.js
│   │   │   │   ├── basics
│   │   │   │   │   ├── package.json
│   │   │   │   │   ├── playwright.config.js
│   │   │   │   │   ├── src
│   │   │   │   │   │   ├── app.d.ts
│   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   ├── error.html
│   │   │   │   │   │   ├── global.d.ts
│   │   │   │   │   │   ├── hooks.client.js
│   │   │   │   │   │   ├── hooks.js
│   │   │   │   │   │   ├── hooks.server.js
│   │   │   │   │   │   ├── params
│   │   │   │   │   │   │   ├── lowercase.js
│   │   │   │   │   │   │   ├── numeric.js
│   │   │   │   │   │   │   └── uppercase.js
│   │   │   │   │   │   ├── routes
│   │   │   │   │   │   │   ├── accessibility
│   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── autofocus
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── +layout.svelte
│   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── c
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── +layout.svelte
│   │   │   │   │   │   │   ├── actions
│   │   │   │   │   │   │   │   ├── enhance
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── file-without-enctype
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── form-errors
│   │   │   │   │   │   │   │   │   ├── adjacent-error-boundary
│   │   │   │   │   │   │   │   │   │   ├── +error.svelte
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── form-errors-persist-fields
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── invalidate-all
│   │   │   │   │   │   │   │   │   ├── +layout.js
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── redirect
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── redirect-in-handle
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── success-data
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── update-form
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── adapter
│   │   │   │   │   │   │   │   ├── dynamic
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── prerendered
│   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── anchor
│   │   │   │   │   │   │   │   ├── anchor
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── anchor-with-manual-scroll
│   │   │   │   │   │   │   │   ├── anchor-afternavigate
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── anchor-onmount
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── answer.json
│   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   ├── app-environment
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── asset-import
│   │   │   │   │   │   │   │   ├── large.jpg
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   └── small.png
│   │   │   │   │   │   │   ├── caching
│   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   └── server-data
│   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── content-length-header
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── content-type-header
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── cookies
│   │   │   │   │   │   │   │   ├── collect-without-re-escaping
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── set-cookie
│   │   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   │   ├── delete
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── encoding
│   │   │   │   │   │   │   │   │   ├── not-decoded-twice
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── set
│   │   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   │   ├── enhanced
│   │   │   │   │   │   │   │   │   └── basic
│   │   │   │   │   │   │   │   │       ├── +page.server.ts
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── forwarded-in-etag
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── nested
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── b
│   │   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   ├── serialize
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── set
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── set-in-layout
│   │   │   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── set-more-than-one
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── shared.js
│   │   │   │   │   │   │   ├── csrf
│   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   ├── css
│   │   │   │   │   │   │   │   ├── _base.css
│   │   │   │   │   │   │   │   ├── encöded
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── _manual.css
│   │   │   │   │   │   │   │   ├── other
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   └── _styles.css
│   │   │   │   │   │   │   ├── cyclical-dynamic-import
│   │   │   │   │   │   │   │   ├── _is_even.js
│   │   │   │   │   │   │   │   ├── _is_odd.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── data-sveltekit
│   │   │   │   │   │   │   │   ├── noscroll
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── target
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── preload-data
│   │   │   │   │   │   │   │   │   ├── offline
│   │   │   │   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   │   ├── slow-navigation
│   │   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── target
│   │   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── target
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── reload
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── target
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   └── replacestate
│   │   │   │   │   │   │   │       ├── +page.svelte
│   │   │   │   │   │   │   │       └── target
│   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   ├── delete-route
│   │   │   │   │   │   │   │   ├── [id].json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── encoded
│   │   │   │   │   │   │   │   ├── endpoint
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── escape-sequences
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   ├── [u+82d7]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── [u+d83e][u+dd2a]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── [x+23]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── [x+25]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── [x+2f]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── [x+3a]-[x+29]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── [x+3c]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── [x+3f]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── [x][x+3c][y]
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   ├── redirect
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── redirected
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── [slug]
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── @[username]
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── 反应
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── 苗条
│   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── endpoint-input
│   │   │   │   │   │   │   │   └── sha256
│   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   ├── endpoint-output
│   │   │   │   │   │   │   │   ├── body
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── fallback
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── head-handler
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── head-write-error
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── +server.js
│   │   │   │   │   │   │   │   ├── stream
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── stream-throw-error
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   └── stream-typeerror
│   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   ├── env
│   │   │   │   │   │   │   │   ├── includes
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── errors
│   │   │   │   │   │   │   │   ├── clientside
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── endpoint
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── endpoint.json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── endpoint-shadow
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── endpoint-shadow-not-ok
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── endpoint-throw-error
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── endpoint-throw-redirect
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── error-html
│   │   │   │   │   │   │   │   │   ├── make-root-fail
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── error-in-handle
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── error-in-layout
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── init-error-endpoint
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── invalid-load-response
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── invalid-route-response
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── invalid-server-load-response
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── +layout.js
│   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   ├── load-client
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── load-error-client
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── load-error-server
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── load-error-string-server
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── load-server
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── load-status-without-error-client
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── missing-actions
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── module-scope-client
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── module-scope-server
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── nested-error-page
│   │   │   │   │   │   │   │   │   ├── +error.svelte
│   │   │   │   │   │   │   │   │   ├── nope
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── page-endpoint
│   │   │   │   │   │   │   │   │   ├── +error.svelte
│   │   │   │   │   │   │   │   │   ├── get-explicit
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── get-implicit
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   ├── post-explicit
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── post-implicit
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── _shared.js
│   │   │   │   │   │   │   │   ├── serverside
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── stack-trace
│   │   │   │   │   │   │   │       ├── _bad.js
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── +error.svelte
│   │   │   │   │   │   │   ├── favicon.ico
│   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   ├── goto
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── headers
│   │   │   │   │   │   │   │   ├── class
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── echo
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   └── set-cookie
│   │   │   │   │   │   │   │       ├── +layout.server.js
│   │   │   │   │   │   │   │       ├── +layout.svelte
│   │   │   │   │   │   │   │       └── sub
│   │   │   │   │   │   │   │           ├── +page.server.js
│   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   ├── iframes
│   │   │   │   │   │   │   │   ├── nested
│   │   │   │   │   │   │   │   │   ├── child
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── parent
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── immutable-headers
│   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   ├── imports
│   │   │   │   │   │   │   │   ├── markdown
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── index.css
│   │   │   │   │   │   │   ├── interactivity
│   │   │   │   │   │   │   │   └── toggle-element
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── keepfocus
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── +layout.js
│   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   ├── load
│   │   │   │   │   │   │   │   ├── accumulated
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   ├── without-page-data
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── with-page-data
│   │   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── cache-control
│   │   │   │   │   │   │   │   │   ├── bust
│   │   │   │   │   │   │   │   │   │   ├── count
│   │   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   │   ├── increment
│   │   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── state.js
│   │   │   │   │   │   │   │   │   ├── default
│   │   │   │   │   │   │   │   │   │   ├── count
│   │   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   │   ├── increment
│   │   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── state.js
│   │   │   │   │   │   │   │   │   └── force
│   │   │   │   │   │   │   │   │       ├── count
│   │   │   │   │   │   │   │   │       │   └── +server.js
│   │   │   │   │   │   │   │   │       ├── increment
│   │   │   │   │   │   │   │   │       │   └── +server.js
│   │   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │   │       ├── +page.svelte
│   │   │   │   │   │   │   │   │       └── state.js
│   │   │   │   │   │   │   │   ├── change-detection
│   │   │   │   │   │   │   │   │   ├── data.json
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   ├── +layout.js
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   ├── one
│   │   │   │   │   │   │   │   │   │   └── [x]
│   │   │   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   │   └── two
│   │   │   │   │   │   │   │   │       └── [y]
│   │   │   │   │   │   │   │   │           ├── +page.js
│   │   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   │   ├── devalue
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── regex
│   │   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── [dynamic]
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── dynamic-import-styles
│   │   │   │   │   │   │   │   │   ├── _
│   │   │   │   │   │   │   │   │   │   └── Thing.svelte
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── [dynamic].json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── fetch-arraybuffer-b64
│   │   │   │   │   │   │   │   │   ├── data
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── fetch-cache-control
│   │   │   │   │   │   │   │   │   ├── headers-diff
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   ├── load-data
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── fetch-credentialed
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── fetch-credentialed.json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── fetch-external-no-cookies
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── fetch-origin-external
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── fetch-origin-internal
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── resource
│   │   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   │   ├── fetch-relative
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── fetch-relative.json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── fetch-request
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── fetch-request-headers
│   │   │   │   │   │   │   │   │   ├── data
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── fetch-request.json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── fetch-response-headers
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── fetch-response-headers.json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── invalidation
│   │   │   │   │   │   │   │   │   ├── depends
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── forced
│   │   │   │   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── state.js
│   │   │   │   │   │   │   │   │   ├── forced-goto
│   │   │   │   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── state.js
│   │   │   │   │   │   │   │   │   ├── invalidate-then-goto
│   │   │   │   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── multiple
│   │   │   │   │   │   │   │   │   │   ├── +layout.js
│   │   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   │   ├── redirect
│   │   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── state.js
│   │   │   │   │   │   │   │   │   ├── multiple-batched
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── params
│   │   │   │   │   │   │   │   │   │   ├── [a]
│   │   │   │   │   │   │   │   │   │   │   ├── [b]
│   │   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   ├── +layout.js
│   │   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── route
│   │   │   │   │   │   │   │   │   │   ├── server
│   │   │   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   │   │   │   │   └── +layout.svelte
│   │   │   │   │   │   │   │   │   │   └── shared
│   │   │   │   │   │   │   │   │   │       ├── a
│   │   │   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │       ├── b
│   │   │   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │       ├── +layout.js
│   │   │   │   │   │   │   │   │   │       ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │       └── [x]
│   │   │   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── search-params
│   │   │   │   │   │   │   │   │   │   ├── server
│   │   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── universal
│   │   │   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── server-fetch
│   │   │   │   │   │   │   │   │   │   ├── count.json
│   │   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── url
│   │   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── large-response
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── text.txt
│   │   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   │   ├── mutated-url
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── no-server-load
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── +layout.svelte
│   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   ├── parent
│   │   │   │   │   │   │   │   │   ├── server
│   │   │   │   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │   └── [x]
│   │   │   │   │   │   │   │   │   │       ├── +layout.server.js
│   │   │   │   │   │   │   │   │   │       ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │       └── [y]
│   │   │   │   │   │   │   │   │   │           ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │           └── [z]
│   │   │   │   │   │   │   │   │   │               ├── +page.server.js
│   │   │   │   │   │   │   │   │   │               └── +page.svelte
│   │   │   │   │   │   │   │   │   └── shared
│   │   │   │   │   │   │   │   │       ├── +layout.js
│   │   │   │   │   │   │   │   │       ├── +layout.svelte
│   │   │   │   │   │   │   │   │       └── [x]
│   │   │   │   │   │   │   │   │           ├── +layout.js
│   │   │   │   │   │   │   │   │           ├── +layout.svelte
│   │   │   │   │   │   │   │   │           └── [y]
│   │   │   │   │   │   │   │   │               ├── +layout.svelte
│   │   │   │   │   │   │   │   │               └── [z]
│   │   │   │   │   │   │   │   │                   ├── +page.js
│   │   │   │   │   │   │   │   │                   └── +page.svelte
│   │   │   │   │   │   │   │   ├── props
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── raw-body
│   │   │   │   │   │   │   │   │   ├── dataview
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   ├── string
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── uint8array
│   │   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── raw-body.json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── relay
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── relay.json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── serialization
│   │   │   │   │   │   │   │   │   ├── fetched-from-server.json
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   ├── fetched-from-shared.json
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── serialization-post
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── serialization-post.json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── serialization-post-request
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── server-data-nostore
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── server-data-reuse
│   │   │   │   │   │   │   │   │   ├── no-load
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── with-changing-parent
│   │   │   │   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │   ├── no-load
│   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── with-server-load
│   │   │   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   │   └── with-server-load
│   │   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── server-fetch-request
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── set-cookie-fetch
│   │   │   │   │   │   │   │   │   ├── a.json
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   ├── b.json
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── static-file-with-hash
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── unchanged
│   │   │   │   │   │   │   │   │   ├── isolated
│   │   │   │   │   │   │   │   │   │   └── [slug]
│   │   │   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── state.js
│   │   │   │   │   │   │   │   ├── unchanged-parent
│   │   │   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   ├── state.js
│   │   │   │   │   │   │   │   │   └── uses-parent
│   │   │   │   │   │   │   │   │       └── [slug]
│   │   │   │   │   │   │   │   │           ├── +page.server.js
│   │   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   │   ├── url-hash
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── url-query-param
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── url-to-string
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── window-fetch
│   │   │   │   │   │   │   │       ├── correct
│   │   │   │   │   │   │   │       │   ├── +page.js
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       ├── data.json
│   │   │   │   │   │   │   │       │   └── +server.js
│   │   │   │   │   │   │   │       ├── incorrect
│   │   │   │   │   │   │   │       │   ├── +page.js
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       ├── outside-load
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       └── patching
│   │   │   │   │   │   │   │           ├── +page.js
│   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   ├── navigation-lifecycle
│   │   │   │   │   │   │   │   ├── after-navigate
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── b
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── before-navigate
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── hash-links
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── prevent-navigation
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── redirect
│   │   │   │   │   │   │   │   │       └── +page.js
│   │   │   │   │   │   │   │   └── on-navigate
│   │   │   │   │   │   │   │       └── [x]
│   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   ├── nested-layout
│   │   │   │   │   │   │   │   ├── error
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── foo
│   │   │   │   │   │   │   │   │   ├── bar
│   │   │   │   │   │   │   │   │   │   ├── +error.svelte
│   │   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │   └── nope
│   │   │   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── baz
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── +layout.svelte
│   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   └── reset
│   │   │   │   │   │   │   │       ├── +layout@.svelte
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── no-csr
│   │   │   │   │   │   │   │   ├── data.json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── no-ssr
│   │   │   │   │   │   │   │   ├── browser-only-global
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── +layout.js
│   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   ├── margin
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── other
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   └── ssr-page-config
│   │   │   │   │   │   │   │       ├── layout
│   │   │   │   │   │   │   │       │   ├── inherit
│   │   │   │   │   │   │   │       │   │   └── +page.svelte
│   │   │   │   │   │   │   │       │   ├── +layout.js
│   │   │   │   │   │   │   │       │   ├── +layout.svelte
│   │   │   │   │   │   │   │       │   └── overwrite
│   │   │   │   │   │   │   │       │       ├── +page.js
│   │   │   │   │   │   │   │       │       └── +page.svelte
│   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── origin
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   ├── paths
│   │   │   │   │   │   │   │   ├── deeply
│   │   │   │   │   │   │   │   │   └── nested
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── prerendering
│   │   │   │   │   │   │   │   ├── env
│   │   │   │   │   │   │   │   │   ├── dynamic
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   └── prerendered
│   │   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── +error.svelte
│   │   │   │   │   │   │   │   ├── log-url
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── mutative-endpoint
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   ├── +page.server.ts
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── no-ssr
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── prerendered-endpoint
│   │   │   │   │   │   │   │       ├── api
│   │   │   │   │   │   │   │       │   └── +server.js
│   │   │   │   │   │   │   │       ├── page
│   │   │   │   │   │   │   │       │   ├── +page.server.js
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       ├── +page.svelte
│   │   │   │   │   │   │   │       └── proxy
│   │   │   │   │   │   │   │           └── +server.js
│   │   │   │   │   │   │   ├── query
│   │   │   │   │   │   │   │   └── echo
│   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │       ├── +page.svelte
│   │   │   │   │   │   │   │       └── utils.js
│   │   │   │   │   │   │   ├── read-file
│   │   │   │   │   │   │   │   ├── auto.txt
│   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   └── url.txt
│   │   │   │   │   │   │   ├── redirect
│   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── c
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── in-handle
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── loopy
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── b
│   │   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── missing-status
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── b
│   │   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── redirect-on-load
│   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   └── redirected
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── reroute
│   │   │   │   │   │   │   │   ├── basic
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── client-only-redirect
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── error-handling
│   │   │   │   │   │   │   │   │   ├── client-error
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── client-error-rewritten
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── server-error
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── external
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── preload-data
│   │   │   │   │   │   │   │       ├── a
│   │   │   │   │   │   │   │       │   └── +page.js
│   │   │   │   │   │   │   │       ├── b
│   │   │   │   │   │   │   │       │   └── +page.js
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── routing
│   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── ambiguous
│   │   │   │   │   │   │   │   │   ├── [slug]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── [slug].json
│   │   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── b.json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── cancellation
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── client
│   │   │   │   │   │   │   │   │   ├── bar
│   │   │   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── foo
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── const
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── content-negotiation
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── dirs
│   │   │   │   │   │   │   │   │   ├── bar
│   │   │   │   │   │   │   │   │   │   ├── [a]
│   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── foo
│   │   │   │   │   │   │   │   │       ├── [b]
│   │   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── external-popstate
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── form-get
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── hashes
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── pagestore
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── target
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── link-outside-app-target
│   │   │   │   │   │   │   │   │   ├── source
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── state.js
│   │   │   │   │   │   │   │   │   └── target
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── matched
│   │   │   │   │   │   │   │   │   ├── [fallback]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   ├── [letter=lowercase]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── [letter=uppercase]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── [number=numeric]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── missing-href
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   ├── params-in-handle
│   │   │   │   │   │   │   │   │   └── [x]
│   │   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   │   ├── preloading
│   │   │   │   │   │   │   │   │   ├── hash-route
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── preloaded
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── preloaded.json
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   └── preload-error
│   │   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── prerendered
│   │   │   │   │   │   │   │   │   ├── +layout.js
│   │   │   │   │   │   │   │   │   └── trailing-slash
│   │   │   │   │   │   │   │   │       ├── always
│   │   │   │   │   │   │   │   │       │   ├── +page.js
│   │   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │   │       ├── ignore
│   │   │   │   │   │   │   │   │       │   ├── +page.js
│   │   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │   │       └── never
│   │   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   │   ├── rest
│   │   │   │   │   │   │   │   │   ├── complex
│   │   │   │   │   │   │   │   │   │   ├── [...parts].json
│   │   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   │   └── prefix-[...parts]
│   │   │   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── non-greedy
│   │   │   │   │   │   │   │   │   │   ├── [dynamic]-bar
│   │   │   │   │   │   │   │   │   │   │   └── [...rest]
│   │   │   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   │   │   ├── foo
│   │   │   │   │   │   │   │   │   │   │   └── [...rest]
│   │   │   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── path
│   │   │   │   │   │   │   │   │   │   ├── [...ignored]
│   │   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   │   └── +layout.svelte
│   │   │   │   │   │   │   │   │   └── [...rest]
│   │   │   │   │   │   │   │   │       ├── deep
│   │   │   │   │   │   │   │   │       │   ├── +page.js
│   │   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │   │       ├── deep.json
│   │   │   │   │   │   │   │   │       │   └── +server.js
│   │   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── route-id
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── [x]
│   │   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── shadow-dom
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── skipped
│   │   │   │   │   │   │   │   │   └── [one]
│   │   │   │   │   │   │   │   │       └── [two]
│   │   │   │   │   │   │   │   │           ├── +page.js
│   │   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   │   ├── slashes
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── [slug]
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── split-params
│   │   │   │   │   │   │   │   │   ├── [a]-[b]
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── symlink-to
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── trailing-slash
│   │   │   │   │   │   │   │   │   ├── always
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── ignore
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +layout.js
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   ├── never
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── trailing-slash-server
│   │   │   │   │   │   │   │       ├── always
│   │   │   │   │   │   │   │       │   ├── +page.server.js
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       ├── ignore
│   │   │   │   │   │   │   │       │   ├── +page.server.js
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       ├── +layout.server.js
│   │   │   │   │   │   │   │       ├── +layout.svelte
│   │   │   │   │   │   │   │       ├── never
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── scroll
│   │   │   │   │   │   │   │   ├── cross-document
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── c
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── push-state
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── top
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── selection
│   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── +layout.svelte
│   │   │   │   │   │   │   ├── set-cookie
│   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   ├── shadowed
│   │   │   │   │   │   │   │   ├── dynamic
│   │   │   │   │   │   │   │   │   └── [slug]
│   │   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── error-get
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── error-post
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── missing-get
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── no-get
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   ├── parent
│   │   │   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── sub
│   │   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── post-success-redirect
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── redirected
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   ├── redirect
│   │   │   │   │   │   │   │   │   ├── [a]
│   │   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── redirected
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── redirect-get
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── redirect-get-with-cookie
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── redirect-get-with-cookie-from-fetch
│   │   │   │   │   │   │   │   │   ├── endpoint
│   │   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── redirect-post
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── redirect-post-with-cookie
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── same-render
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── same-render-entry
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── serialization
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── simple
│   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │       ├── +page.svelte
│   │   │   │   │   │   │   │       └── post
│   │   │   │   │   │   │   │           ├── +page.server.js
│   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   ├── shallow-routing
│   │   │   │   │   │   │   │   ├── push-state
│   │   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── replace-state
│   │   │   │   │   │   │   │       ├── a
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       ├── b
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       ├── +layout.svelte
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── snapshot
│   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── b
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── c
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── +layout.svelte
│   │   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   │   └── [...anything]
│   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── store
│   │   │   │   │   │   │   │   ├── client-access
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── data
│   │   │   │   │   │   │   │   │   ├── +error.svelte
│   │   │   │   │   │   │   │   │   ├── foo
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── [item]
│   │   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   │   ├── +layout.js
│   │   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   │   └── store-update
│   │   │   │   │   │   │   │   │       ├── a
│   │   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │   │       ├── b
│   │   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │   │       ├── +layout.svelte
│   │   │   │   │   │   │   │   │       └── same-keys
│   │   │   │   │   │   │   │   │           ├── +layout.js
│   │   │   │   │   │   │   │   │           ├── +page.svelte
│   │   │   │   │   │   │   │   │           ├── same
│   │   │   │   │   │   │   │   │           │   ├── +page.js
│   │   │   │   │   │   │   │   │           │   └── +page.svelte
│   │   │   │   │   │   │   │   │           └── same-deep
│   │   │   │   │   │   │   │   │               └── nested
│   │   │   │   │   │   │   │   │                   ├── +page.js
│   │   │   │   │   │   │   │   │                   └── +page.svelte
│   │   │   │   │   │   │   │   └── navigating
│   │   │   │   │   │   │   │       ├── a
│   │   │   │   │   │   │   │       │   ├── +page.js
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       ├── b
│   │   │   │   │   │   │   │       │   ├── +page.js
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       ├── c
│   │   │   │   │   │   │   │       │   ├── +page.js
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       └── +layout.svelte
│   │   │   │   │   │   │   ├── streaming
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   ├── server
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── server-error
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── universal
│   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── transform-page-chunk
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── unsafe-replacement
│   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── untrack
│   │   │   │   │   │   │   │   ├── server
│   │   │   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   │   │   └── [x]
│   │   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   │   └── universal
│   │   │   │   │   │   │   │       ├── +layout.js
│   │   │   │   │   │   │   │       └── [x]
│   │   │   │   │   │   │   │           ├── +page.js
│   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   ├── use-action
│   │   │   │   │   │   │   │   ├── focus-and-scroll
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── xss
│   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   ├── [path]
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── query
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   │   └── utils.js
│   │   │   │   │   │   │   │   └── shadow
│   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   └── xss.json
│   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   └── service-worker.js
│   │   │   │   │   ├── static
│   │   │   │   │   │   ├── empty.js
│   │   │   │   │   │   ├── favicon.png
│   │   │   │   │   │   ├── load
│   │   │   │   │   │   │   ├── assets
│   │   │   │   │   │   │   │   └── a#b.txt
│   │   │   │   │   │   │   └── foo.json
│   │   │   │   │   │   ├── static.json
│   │   │   │   │   │   ├── subdirectory
│   │   │   │   │   │   │   └── static.json
│   │   │   │   │   │   ├── symlink-from -> symlink-to
│   │   │   │   │   │   └── symlink-to
│   │   │   │   │   │       └── hello.txt
│   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   ├── test
│   │   │   │   │   │   ├── client.test.js
│   │   │   │   │   │   ├── cross-platform
│   │   │   │   │   │   │   ├── client.test.js
│   │   │   │   │   │   │   ├── server.test.js
│   │   │   │   │   │   │   └── test.js
│   │   │   │   │   │   ├── server.test.js
│   │   │   │   │   │   ├── setup.js
│   │   │   │   │   │   └── test.js
│   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   └── vite.config.js
│   │   │   │   ├── dev-only
│   │   │   │   │   ├── package.json
│   │   │   │   │   ├── playwright.config.js
│   │   │   │   │   ├── src
│   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   ├── hooks.server.js
│   │   │   │   │   │   ├── lib
│   │   │   │   │   │   │   ├── server
│   │   │   │   │   │   │   │   └── blah
│   │   │   │   │   │   │   │       └── private.js
│   │   │   │   │   │   │   └── test.server.js
│   │   │   │   │   │   └── routes
│   │   │   │   │   │       ├── +error.svelte
│   │   │   │   │   │       ├── illegal-imports
│   │   │   │   │   │       │   ├── env
│   │   │   │   │   │       │   │   ├── dynamic-private
│   │   │   │   │   │       │   │   │   └── +page.svelte
│   │   │   │   │   │       │   │   ├── dynamic-private-dynamic-import
│   │   │   │   │   │       │   │   │   └── +page.svelte
│   │   │   │   │   │       │   │   ├── static-private
│   │   │   │   │   │       │   │   │   └── +page.svelte
│   │   │   │   │   │       │   │   └── static-private-dynamic-import
│   │   │   │   │   │       │   │       └── +page.svelte
│   │   │   │   │   │       │   ├── server-only-folder
│   │   │   │   │   │       │   │   ├── dynamic-import
│   │   │   │   │   │       │   │   │   └── +page.svelte
│   │   │   │   │   │       │   │   └── static-import
│   │   │   │   │   │       │   │       └── +page.svelte
│   │   │   │   │   │       │   └── server-only-modules
│   │   │   │   │   │       │       ├── dynamic-import
│   │   │   │   │   │       │       │   └── +page.svelte
│   │   │   │   │   │       │       ├── illegal.server.js
│   │   │   │   │   │       │       └── static-import
│   │   │   │   │   │       │           └── +page.svelte
│   │   │   │   │   │       └── +layout.svelte
│   │   │   │   │   ├── static
│   │   │   │   │   │   └── favicon.png
│   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   ├── test
│   │   │   │   │   │   └── test.js
│   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   └── vite.config.js
│   │   │   │   ├── embed
│   │   │   │   │   ├── package.json
│   │   │   │   │   ├── playwright.config.js
│   │   │   │   │   ├── src
│   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   └── routes
│   │   │   │   │   │       ├── embed
│   │   │   │   │   │       │   ├── a
│   │   │   │   │   │       │   │   └── +page.svelte
│   │   │   │   │   │       │   ├── b
│   │   │   │   │   │       │   │   └── +page.svelte
│   │   │   │   │   │       │   ├── +page.js
│   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │       └── +layout.svelte
│   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   ├── test
│   │   │   │   │   │   └── test.js
│   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   └── vite.config.js
│   │   │   │   ├── no-ssr
│   │   │   │   │   ├── package.json
│   │   │   │   │   ├── playwright.config.js
│   │   │   │   │   ├── src
│   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   └── routes
│   │   │   │   │   │       ├── +layout.js
│   │   │   │   │   │       ├── +layout.server.js
│   │   │   │   │   │       ├── +layout.svelte
│   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   ├── static
│   │   │   │   │   │   └── favicon.png
│   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   ├── test
│   │   │   │   │   │   └── test.js
│   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   └── vite.config.js
│   │   │   │   ├── options
│   │   │   │   │   ├── env-dir
│   │   │   │   │   ├── package.json
│   │   │   │   │   ├── playwright.config.js
│   │   │   │   │   ├── public
│   │   │   │   │   │   ├── answer.html
│   │   │   │   │   │   └── favicon.png
│   │   │   │   │   ├── source
│   │   │   │   │   │   ├── components
│   │   │   │   │   │   │   ├── Message.svelte
│   │   │   │   │   │   │   └── SvelteLogo.svelte
│   │   │   │   │   │   ├── hooks.client.js
│   │   │   │   │   │   ├── hooks.server.js
│   │   │   │   │   │   ├── pages
│   │   │   │   │   │   │   ├── base
│   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   └── [slug]
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── csp
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── custom-extensions
│   │   │   │   │   │   │   │   ├── a
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── const
│   │   │   │   │   │   │   │   │   └── +page.whokilledthemuffinman
│   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   ├── +page.jesuslivesineveryone
│   │   │   │   │   │   │   │   ├── [slug]
│   │   │   │   │   │   │   │   │   └── +page.svelte.md
│   │   │   │   │   │   │   │   └── unsafe-replacement
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── endpoint
│   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   ├── endpoint-with-slash
│   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   ├── env
│   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── error
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── +layout.server.js
│   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   ├── mode
│   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── page-endpoint
│   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   ├── preloading
│   │   │   │   │   │   │   │   ├── code
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   └── preloaded
│   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── resolve-route
│   │   │   │   │   │   │   │   ├── [foo]
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── routing
│   │   │   │   │   │   │   │   └── link-outside-app-target
│   │   │   │   │   │   │   │       ├── source
│   │   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │   │       ├── state.js
│   │   │   │   │   │   │   │       └── target
│   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   ├── slash
│   │   │   │   │   │   │   │   ├── child
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   └── test.txt
│   │   │   │   │   │   └── template.html
│   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   ├── test
│   │   │   │   │   │   └── test.js
│   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   └── vite.custom.config.js
│   │   │   │   ├── options-2
│   │   │   │   │   ├── package.json
│   │   │   │   │   ├── playwright.config.js
│   │   │   │   │   ├── README.md
│   │   │   │   │   ├── src
│   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   ├── image.jpg
│   │   │   │   │   │   ├── routes
│   │   │   │   │   │   │   ├── deeply
│   │   │   │   │   │   │   │   └── nested
│   │   │   │   │   │   │   │       └── page
│   │   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   │   ├── env
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── hello
│   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   └── service-worker.js
│   │   │   │   │   ├── static
│   │   │   │   │   │   └── answer.txt
│   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   ├── test
│   │   │   │   │   │   └── test.js
│   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   └── vite.config.js
│   │   │   │   ├── read-file-test.txt
│   │   │   │   └── writes
│   │   │   │       ├── package.json
│   │   │   │       ├── playwright.config.js
│   │   │   │       ├── src
│   │   │   │       │   ├── app.html
│   │   │   │       │   ├── global.d.ts
│   │   │   │       │   └── routes
│   │   │   │       │       ├── double-mount
│   │   │   │       │       │   └── +page.svelte
│   │   │   │       │       ├── +layout.svelte
│   │   │   │       │       └── new-route
│   │   │   │       │           ├── +page.svelte
│   │   │   │       │           └── zzzz1662642734866
│   │   │   │       │               └── +page.svelte
│   │   │   │       ├── static
│   │   │   │       │   └── favicon.png
│   │   │   │       ├── svelte.config.js
│   │   │   │       ├── test
│   │   │   │       │   └── test.js
│   │   │   │       ├── tsconfig.json
│   │   │   │       └── vite.config.js
│   │   │   ├── build-errors
│   │   │   │   ├── apps
│   │   │   │   │   ├── prerenderable-incorrect-fragment
│   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   │   └── routes
│   │   │   │   │   │   │       ├── foo
│   │   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │   │       ├── +layout.js
│   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   └── favicon.png
│   │   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   │   └── vite.config.js
│   │   │   │   │   ├── prerenderable-not-prerendered
│   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   │   └── routes
│   │   │   │   │   │   │       ├── +page.svelte
│   │   │   │   │   │   │       └── [x]
│   │   │   │   │   │   │           ├── +page.js
│   │   │   │   │   │   │           └── +page.svelte
│   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   └── favicon.png
│   │   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   │   └── vite.config.js
│   │   │   │   │   ├── prerender-entry-generator-mismatch
│   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   │   └── routes
│   │   │   │   │   │   │       ├── +layout.js
│   │   │   │   │   │   │       └── [slug]
│   │   │   │   │   │   │           ├── [notSpecific]
│   │   │   │   │   │   │           │   └── +page.ts
│   │   │   │   │   │   │           └── specific
│   │   │   │   │   │   │               └── +page.svelte
│   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   └── favicon.png
│   │   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   │   └── vite.config.js
│   │   │   │   │   ├── private-dynamic-env
│   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   │   └── routes
│   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   └── favicon.png
│   │   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   │   └── vite.config.js
│   │   │   │   │   ├── private-dynamic-env-dynamic-import
│   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   │   └── routes
│   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   └── favicon.png
│   │   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   │   └── vite.config.js
│   │   │   │   │   ├── private-static-env
│   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   │   └── routes
│   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   └── favicon.png
│   │   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   │   └── vite.config.js
│   │   │   │   │   ├── private-static-env-dynamic-import
│   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   │   └── routes
│   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   └── favicon.png
│   │   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   │   └── vite.config.js
│   │   │   │   │   ├── server-only-folder
│   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   │   ├── lib
│   │   │   │   │   │   │   │   └── server
│   │   │   │   │   │   │   │       └── something
│   │   │   │   │   │   │   │           └── private.js
│   │   │   │   │   │   │   └── routes
│   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   └── favicon.png
│   │   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   │   └── vite.config.js
│   │   │   │   │   ├── server-only-folder-dynamic-import
│   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   │   ├── lib
│   │   │   │   │   │   │   │   └── server
│   │   │   │   │   │   │   │       └── something
│   │   │   │   │   │   │   │           └── private.js
│   │   │   │   │   │   │   └── routes
│   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   └── favicon.png
│   │   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   │   └── vite.config.js
│   │   │   │   │   ├── server-only-module
│   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   │   ├── lib
│   │   │   │   │   │   │   │   └── test.server.js
│   │   │   │   │   │   │   └── routes
│   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   └── favicon.png
│   │   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   │   └── vite.config.js
│   │   │   │   │   ├── server-only-module-dynamic-import
│   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   │   ├── lib
│   │   │   │   │   │   │   │   └── test.server.js
│   │   │   │   │   │   │   └── routes
│   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   └── favicon.png
│   │   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   │   └── vite.config.js
│   │   │   │   │   ├── service-worker-dynamic-public-env
│   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   │   ├── routes
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   └── service-worker.js
│   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   └── favicon.png
│   │   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   │   └── vite.config.js
│   │   │   │   │   ├── service-worker-private-env
│   │   │   │   │   │   ├── package.json
│   │   │   │   │   │   ├── src
│   │   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   │   ├── routes
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   └── service-worker.js
│   │   │   │   │   │   ├── static
│   │   │   │   │   │   │   └── favicon.png
│   │   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   │   └── vite.config.js
│   │   │   │   │   └── syntax-error
│   │   │   │   │       ├── package.json
│   │   │   │   │       ├── src
│   │   │   │   │       │   ├── app.html
│   │   │   │   │       │   ├── lib
│   │   │   │   │       │   │   └── test.server.js
│   │   │   │   │       │   └── routes
│   │   │   │   │       │       └── +page.svelte
│   │   │   │   │       ├── static
│   │   │   │   │       │   └── favicon.png
│   │   │   │   │       ├── svelte.config.js
│   │   │   │   │       ├── tsconfig.json
│   │   │   │   │       └── vite.config.js
│   │   │   │   ├── env.spec.js
│   │   │   │   ├── package.json
│   │   │   │   ├── prerender.spec.js
│   │   │   │   ├── server-only.spec.js
│   │   │   │   └── syntax-error.spec.js
│   │   │   ├── env
│   │   │   ├── github-flaky-warning-reporter.js
│   │   │   ├── prerendering
│   │   │   │   ├── basics
│   │   │   │   │   ├── package.json
│   │   │   │   │   ├── src
│   │   │   │   │   │   ├── app.d.ts
│   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   ├── hooks.server.js
│   │   │   │   │   │   ├── routes
│   │   │   │   │   │   │   ├── encöded-hash-link
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── encoding
│   │   │   │   │   │   │   │   ├── [path]
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── [path].json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── path with spaces
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── redirect
│   │   │   │   │   │   │   │       ├── +page.js
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── env
│   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── fetch-404
│   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── fetch-endpoint
│   │   │   │   │   │   │   │   ├── also-not-buffered
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── buffered
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── buffered.json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── not-buffered
│   │   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   └── not-buffered.json
│   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   ├── fetch-image
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   └── [...slug]
│   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   ├── (grouped)
│   │   │   │   │   │   │   │   └── grouped
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── immutable-headers
│   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   ├── +layout.js
│   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   ├── load-file-with-spaces
│   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── max-age
│   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── optional-params
│   │   │   │   │   │   │   │   └── [[optional]]
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── origin
│   │   │   │   │   │   │   │   ├── message.json
│   │   │   │   │   │   │   │   │   └── +server.js
│   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── page.html
│   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   ├── prerendering-true
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── redirect
│   │   │   │   │   │   │   │   └── +page.js
│   │   │   │   │   │   │   ├── redirect-encoded
│   │   │   │   │   │   │   │   └── +page.js
│   │   │   │   │   │   │   ├── redirect-malicious
│   │   │   │   │   │   │   │   └── +page.js
│   │   │   │   │   │   │   ├── redirect-relative
│   │   │   │   │   │   │   │   └── +page.js
│   │   │   │   │   │   │   ├── redirect-server
│   │   │   │   │   │   │   │   └── +page.server.js
│   │   │   │   │   │   │   ├── shadowed-get
│   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   └── ssr-off
│   │   │   │   │   │   │   │       ├── +page.server.js
│   │   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   │   ├── shadowed-post
│   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── spa-shell
│   │   │   │   │   │   │   │   ├── +page.js
│   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   ├── trailing-slash
│   │   │   │   │   │   │   │   ├── +layout.js
│   │   │   │   │   │   │   │   ├── +layout.svelte
│   │   │   │   │   │   │   │   ├── page
│   │   │   │   │   │   │   │   │   ├── +page.server.js
│   │   │   │   │   │   │   │   │   └── +page.svelte
│   │   │   │   │   │   │   │   ├── +page.svelte
│   │   │   │   │   │   │   │   └── standalone-endpoint.json
│   │   │   │   │   │   │   │       └── +server.js
│   │   │   │   │   │   │   └── 初めまして
│   │   │   │   │   │   │       └── +page.svelte
│   │   │   │   │   │   └── service-worker.js
│   │   │   │   │   ├── static
│   │   │   │   │   │   ├── file with spaces.json
│   │   │   │   │   │   ├── image.jpg
│   │   │   │   │   │   └── image.png
│   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   ├── test
│   │   │   │   │   │   └── tests.spec.js
│   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   └── vite.config.js
│   │   │   │   ├── options
│   │   │   │   │   ├── package.json
│   │   │   │   │   ├── public
│   │   │   │   │   │   └── robots.txt
│   │   │   │   │   ├── src
│   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   └── routes
│   │   │   │   │   │       ├── (group)
│   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │       ├── +layout.js
│   │   │   │   │   │       ├── +layout.svelte
│   │   │   │   │   │       ├── nested
│   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │       └── rss.xml
│   │   │   │   │   │           └── +server.js
│   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   ├── test
│   │   │   │   │   │   └── tests.spec.js
│   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   └── vite.config.js
│   │   │   │   ├── paths-base
│   │   │   │   │   ├── package.json
│   │   │   │   │   ├── src
│   │   │   │   │   │   ├── app.d.ts
│   │   │   │   │   │   ├── app.html
│   │   │   │   │   │   ├── hooks.server.js
│   │   │   │   │   │   └── routes
│   │   │   │   │   │       ├── a
│   │   │   │   │   │       │   └── b
│   │   │   │   │   │       │       ├── c
│   │   │   │   │   │       │       │   └── +page.svelte
│   │   │   │   │   │       │       └── d
│   │   │   │   │   │       │           └── +page.svelte
│   │   │   │   │   │       ├── assets
│   │   │   │   │   │       │   ├── logo.svg
│   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │       ├── dynamic
│   │   │   │   │   │       │   └── [slug]
│   │   │   │   │   │       │       └── +page.svelte
│   │   │   │   │   │       ├── +layout.js
│   │   │   │   │   │       ├── +layout.svelte
│   │   │   │   │   │       ├── nested
│   │   │   │   │   │       │   └── +page.svelte
│   │   │   │   │   │       ├── +page.svelte
│   │   │   │   │   │       └── redirect
│   │   │   │   │   │           └── +page.js
│   │   │   │   │   ├── static
│   │   │   │   │   │   └── favicon.png
│   │   │   │   │   ├── svelte.config.js
│   │   │   │   │   ├── test
│   │   │   │   │   │   └── tests.spec.js
│   │   │   │   │   ├── tsconfig.json
│   │   │   │   │   └── vite.config.js
│   │   │   │   └── test-utils.js
│   │   │   ├── setup.js
│   │   │   ├── tsconfig.json
│   │   │   ├── types
│   │   │   │   ├── actions.test.ts
│   │   │   │   ├── load.test.ts
│   │   │   │   └── tsconfig.json
│   │   │   ├── utils.d.ts
│   │   │   └── utils.js
│   │   ├── tsconfig.json
│   │   └── types
│   │       └── index.d.ts
│   ├── migrate
│   │   ├── bin.js
│   │   ├── CHANGELOG.md
│   │   ├── migrations
│   │   │   ├── package
│   │   │   │   ├── index.js
│   │   │   │   ├── migrate_config.js
│   │   │   │   ├── migrate_config.spec.js
│   │   │   │   ├── migrate_pkg.js
│   │   │   │   └── migrate_pkg.spec.js
│   │   │   ├── routes
│   │   │   │   ├── index.js
│   │   │   │   ├── migrate_page_js
│   │   │   │   │   ├── index.js
│   │   │   │   │   ├── index.spec.js
│   │   │   │   │   └── samples.md
│   │   │   │   ├── migrate_page_server
│   │   │   │   │   ├── index.js
│   │   │   │   │   ├── index.spec.js
│   │   │   │   │   └── samples.md
│   │   │   │   ├── migrate_scripts
│   │   │   │   │   ├── index.js
│   │   │   │   │   ├── index.spec.js
│   │   │   │   │   └── samples.md
│   │   │   │   ├── migrate_server
│   │   │   │   │   ├── index.js
│   │   │   │   │   ├── index.spec.js
│   │   │   │   │   └── samples.md
│   │   │   │   ├── tasks.js
│   │   │   │   └── utils.js
│   │   │   ├── self-closing-tags
│   │   │   │   ├── index.js
│   │   │   │   ├── migrate.js
│   │   │   │   └── migrate.spec.js
│   │   │   ├── svelte-4
│   │   │   │   ├── index.js
│   │   │   │   ├── migrate.js
│   │   │   │   └── migrate.spec.js
│   │   │   └── sveltekit-2
│   │   │       ├── index.js
│   │   │       ├── migrate.js
│   │   │       ├── migrate.spec.js
│   │   │       ├── svelte-config-samples.md
│   │   │       ├── tsconfig-samples.md
│   │   │       └── tsjs-samples.md
│   │   ├── package.json
│   │   ├── README.md
│   │   ├── tsconfig.json
│   │   ├── utils.js
│   │   └── utils.spec.js
│   └── package
│       ├── CHANGELOG.md
│       ├── package.json
│       ├── README.md
│       ├── src
│       │   ├── cli.js
│       │   ├── config.js
│       │   ├── filesystem.js
│       │   ├── index.js
│       │   ├── typescript.js
│       │   ├── types.d.ts
│       │   ├── utils.js
│       │   └── validate.js
│       ├── svelte-package.js
│       ├── test
│       │   ├── errors
│       │   │   └── no-lib-folder
│       │   │       ├── package.json
│       │   │       ├── svelte.config.js
│       │   │       └── tsconfig.json
│       │   ├── fixtures
│       │   │   ├── assets
│       │   │   │   ├── expected
│       │   │   │   │   └── kit.png
│       │   │   │   ├── jsconfig.json
│       │   │   │   ├── package.json
│       │   │   │   ├── src
│       │   │   │   │   └── lib
│       │   │   │   │       └── kit.png
│       │   │   │   └── svelte.config.js
│       │   │   ├── emitTypes-false
│       │   │   │   ├── expected
│       │   │   │   │   ├── foo.d.ts
│       │   │   │   │   ├── index.js
│       │   │   │   │   ├── Test2.svelte
│       │   │   │   │   └── Test.svelte
│       │   │   │   ├── package.json
│       │   │   │   ├── src
│       │   │   │   │   └── lib
│       │   │   │   │       ├── foo.d.ts
│       │   │   │   │       ├── index.js
│       │   │   │   │       ├── Test2.svelte
│       │   │   │   │       └── Test.svelte
│       │   │   │   └── svelte.config.js
│       │   │   ├── javascript
│       │   │   │   ├── expected
│       │   │   │   │   ├── foo.d.ts
│       │   │   │   │   ├── index.d.ts
│       │   │   │   │   ├── index.js
│       │   │   │   │   ├── internal
│       │   │   │   │   │   ├── foo.d.ts
│       │   │   │   │   │   ├── index.d.ts
│       │   │   │   │   │   ├── index.js
│       │   │   │   │   │   ├── runes.svelte.d.ts
│       │   │   │   │   │   ├── runes.svelte.js
│       │   │   │   │   │   ├── Test.svelte
│       │   │   │   │   │   └── Test.svelte.d.ts
│       │   │   │   │   ├── Test2.svelte
│       │   │   │   │   ├── Test2.svelte.d.ts
│       │   │   │   │   ├── Test.svelte
│       │   │   │   │   ├── Test.svelte.d.ts
│       │   │   │   │   ├── utils.d.ts
│       │   │   │   │   └── utils.js
│       │   │   │   ├── jsconfig.json
│       │   │   │   ├── package.json
│       │   │   │   ├── ReadMe.md
│       │   │   │   ├── src
│       │   │   │   │   └── lib
│       │   │   │   │       ├── foo.d.ts
│       │   │   │   │       ├── index.js
│       │   │   │   │       ├── internal
│       │   │   │   │       │   ├── foo.d.ts
│       │   │   │   │       │   ├── index.js
│       │   │   │   │       │   ├── runes.svelte.js
│       │   │   │   │       │   └── Test.svelte
│       │   │   │   │       ├── Test2.svelte
│       │   │   │   │       ├── Test.svelte
│       │   │   │   │       └── utils.js
│       │   │   │   └── svelte.config.js
│       │   │   ├── resolve-alias
│       │   │   │   ├── expected
│       │   │   │   │   ├── baz.d.ts
│       │   │   │   │   ├── baz.js
│       │   │   │   │   ├── index.d.ts
│       │   │   │   │   ├── index.js
│       │   │   │   │   ├── sub
│       │   │   │   │   │   ├── bar.d.ts
│       │   │   │   │   │   ├── bar.js
│       │   │   │   │   │   ├── foo.d.ts
│       │   │   │   │   │   └── foo.js
│       │   │   │   │   ├── Test.svelte
│       │   │   │   │   ├── Test.svelte.d.ts
│       │   │   │   │   └── utils
│       │   │   │   │       ├── index.d.ts
│       │   │   │   │       └── index.js
│       │   │   │   ├── package.json
│       │   │   │   ├── src
│       │   │   │   │   └── lib
│       │   │   │   │       ├── baz.ts
│       │   │   │   │       ├── index.ts
│       │   │   │   │       ├── sub
│       │   │   │   │       │   ├── bar.ts
│       │   │   │   │       │   └── foo.ts
│       │   │   │   │       ├── Test.svelte
│       │   │   │   │       └── utils
│       │   │   │   │           └── index.ts
│       │   │   │   ├── svelte.config.js
│       │   │   │   └── tsconfig.json
│       │   │   ├── svelte-3-types
│       │   │   │   ├── expected
│       │   │   │   │   ├── index.d.ts
│       │   │   │   │   ├── index.js
│       │   │   │   │   ├── Test.svelte
│       │   │   │   │   └── Test.svelte.d.ts
│       │   │   │   ├── package.json
│       │   │   │   ├── src
│       │   │   │   │   └── lib
│       │   │   │   │       ├── index.ts
│       │   │   │   │       └── Test.svelte
│       │   │   │   ├── svelte.config.js
│       │   │   │   └── tsconfig.json
│       │   │   ├── svelte-kit
│       │   │   │   ├── expected
│       │   │   │   │   ├── foo.d.ts
│       │   │   │   │   ├── index.d.ts
│       │   │   │   │   ├── index.js
│       │   │   │   │   ├── Test.svelte
│       │   │   │   │   └── Test.svelte.d.ts
│       │   │   │   ├── jsconfig.json
│       │   │   │   ├── package.json
│       │   │   │   ├── src
│       │   │   │   │   └── kitlib
│       │   │   │   │       ├── foo.d.ts
│       │   │   │   │       ├── index.js
│       │   │   │   │       └── Test.svelte
│       │   │   │   └── svelte.config.js
│       │   │   ├── tsconfig-specified
│       │   │   │   ├── expected
│       │   │   │   │   ├── runes.svelte.d.ts
│       │   │   │   │   └── runes.svelte.js
│       │   │   │   ├── package.json
│       │   │   │   ├── src
│       │   │   │   │   └── lib
│       │   │   │   │       └── runes.svelte.ts
│       │   │   │   ├── svelte.config.js
│       │   │   │   ├── tsconfig.build.json
│       │   │   │   └── tsconfig.json
│       │   │   ├── typescript-esnext
│       │   │   │   ├── expected
│       │   │   │   │   ├── foo.d.ts
│       │   │   │   │   ├── index.d.ts
│       │   │   │   │   ├── index.js
│       │   │   │   │   ├── Plain.svelte
│       │   │   │   │   ├── Plain.svelte.d.ts
│       │   │   │   │   ├── runes.svelte.d.ts
│       │   │   │   │   ├── runes.svelte.js
│       │   │   │   │   ├── Test2.svelte
│       │   │   │   │   ├── Test2.svelte.d.ts
│       │   │   │   │   ├── Test.svelte
│       │   │   │   │   ├── Test.svelte.d.ts
│       │   │   │   │   ├── utils.d.ts
│       │   │   │   │   └── utils.js
│       │   │   │   ├── package.json
│       │   │   │   ├── src
│       │   │   │   │   └── lib
│       │   │   │   │       ├── foo.d.ts
│       │   │   │   │       ├── index.ts
│       │   │   │   │       ├── Plain.svelte
│       │   │   │   │       ├── runes.svelte.ts
│       │   │   │   │       ├── Test2.svelte
│       │   │   │   │       ├── Test.svelte
│       │   │   │   │       └── utils.ts
│       │   │   │   ├── svelte.config.js
│       │   │   │   └── tsconfig.json
│       │   │   └── typescript-nodenext
│       │   │       ├── expected
│       │   │       │   ├── index.d.ts
│       │   │       │   ├── index.js
│       │   │       │   ├── runes.svelte.d.ts
│       │   │       │   ├── runes.svelte.js
│       │   │       │   ├── Test.svelte
│       │   │       │   └── Test.svelte.d.ts
│       │   │       ├── package.json
│       │   │       ├── src
│       │   │       │   └── lib
│       │   │       │       ├── index.ts
│       │   │       │       ├── runes.svelte.ts
│       │   │       │       └── Test.svelte
│       │   │       ├── svelte.config.js
│       │   │       └── tsconfig.json
│       │   ├── index.js
│       │   └── watch
│       │       ├── expected
│       │       │   ├── a.d.ts
│       │       │   ├── a.js
│       │       │   ├── b.d.ts
│       │       │   ├── b.js
│       │       │   ├── index.js
│       │       │   ├── package.json
│       │       │   ├── post-error.svelte
│       │       │   ├── Test.svelte
│       │       │   └── Test.svelte.d.ts
│       │       ├── package.json
│       │       ├── src
│       │       │   └── lib
│       │       │       └── index.js
│       │       ├── svelte.config.js
│       │       └── tsconfig.json
│       └── tsconfig.json
├── playgrounds
│   ├── basic
│   │   ├── jsconfig.json
│   │   ├── package.json
│   │   ├── src
│   │   │   ├── app.d.ts
│   │   │   ├── app.html
│   │   │   ├── lib
│   │   │   │   └── index.js
│   │   │   └── routes
│   │   │       └── +page.svelte
│   │   ├── static
│   │   │   └── favicon.png
│   │   ├── svelte.config.js
│   │   └── vite.config.js
│   └── README.md
├── pnpm-lock.yaml
├── pnpm-workspace.yaml
├── README.md
├── renovate.json
├── scripts
│   ├── check-dependencies.js
│   └── sync-all.js
└── sites
    └── kit.svelte.dev
        ├── package.json
        ├── README.md
        ├── scripts
        │   ├── tsconfig.json
        │   └── types
        │       └── index.js
        ├── src
        │   ├── app.d.ts
        │   ├── app.html
        │   ├── hooks.server.js
        │   ├── lib
        │   │   ├── icons
        │   │   │   ├── left-small.svg
        │   │   │   ├── pause.svg
        │   │   │   ├── play.svg
        │   │   │   ├── plus.svg
        │   │   │   ├── search.svg
        │   │   │   └── up-small.svg
        │   │   └── server
        │   │       ├── docs
        │   │       │   ├── index.js
        │   │       │   └── types.d.ts
        │   │       └── renderer.js
        │   └── routes
        │       ├── content.json
        │       │   ├── content.server.js
        │       │   └── +server.js
        │       ├── docs
        │       │   ├── +layout.server.js
        │       │   ├── +layout.svelte
        │       │   ├── +page.js
        │       │   └── [slug]
        │       │       ├── +page.server.js
        │       │       └── +page.svelte
        │       ├── edge.svg
        │       │   ├── countries.json
        │       │   ├── land-110m.json
        │       │   └── +server.js
        │       ├── +error.svelte
        │       ├── faq
        │       │   └── +page.js
        │       ├── home
        │       │   ├── cc-off.svg
        │       │   ├── cc-on.svg
        │       │   ├── common.css
        │       │   ├── Deployment.svelte
        │       │   ├── Features.svelte
        │       │   ├── Hero.svelte
        │       │   ├── Intro.svelte
        │       │   ├── logos
        │       │   │   ├── appengine.svg
        │       │   │   ├── azure.svg
        │       │   │   ├── cloudflare.svg
        │       │   │   ├── deno.svg
        │       │   │   ├── firebase.svg
        │       │   │   ├── html5.svg
        │       │   │   ├── lambda.svg
        │       │   │   ├── netlify.svg
        │       │   │   ├── node.svg
        │       │   │   └── vercel.svg
        │       │   ├── showcase
        │       │   │   ├── asmeditor.png
        │       │   │   ├── dropzone.png
        │       │   │   ├── monogram.png
        │       │   │   ├── pausly.png
        │       │   │   ├── pocketbase.png
        │       │   │   ├── pronauns.png
        │       │   │   ├── pudding.png
        │       │   │   ├── raster.png
        │       │   │   └── tradingstrategy.png
        │       │   ├── Showcase.svelte
        │       │   ├── subtitles.vtt
        │       │   ├── sveltekit-logo.svg
        │       │   ├── svelte-kit-logotype.svg.svelte
        │       │   ├── svelte-kit-machine.webp
        │       │   ├── Svelte.svelte
        │       │   ├── Video.svelte
        │       │   ├── volume-high.svg
        │       │   └── volume-off.svg
        │       ├── +layout.server.js
        │       ├── +layout.svelte
        │       ├── nav.json
        │       │   └── +server.js
        │       ├── +page.js
        │       ├── +page.svelte
        │       ├── schema.json
        │       └── search
        │           ├── +page.js
        │           ├── +page.server.js
        │           └── +page.svelte
        ├── static
        │   ├── favicon.png
        │   ├── images
        │   │   ├── svelte-android-chrome-192.png
        │   │   ├── svelte-android-chrome-512.png
        │   │   ├── svelte-kit-horizontal.svg
        │   │   └── twitter-thumbnail.jpg
        │   ├── manifest.json
        │   ├── opensearch.xml
        │   └── robots.txt
        ├── svelte.config.js
        ├── tsconfig.json
        ├── vercel.json
        └── vite.config.js

1163 directories, 2042 files

########## File List ##########

1     	CONTRIBUTING.md
2     	documentation/docs/10-getting-started/10-introduction.md
3     	documentation/docs/10-getting-started/20-creating-a-project.md
4     	documentation/docs/10-getting-started/30-project-structure.md
5     	documentation/docs/10-getting-started/40-web-standards.md
6     	documentation/docs/10-getting-started/meta.json
7     	documentation/docs/20-core-concepts/10-routing.md
8     	documentation/docs/20-core-concepts/20-load.md
9     	documentation/docs/20-core-concepts/30-form-actions.md
10    	documentation/docs/20-core-concepts/40-page-options.md
11    	documentation/docs/20-core-concepts/50-state-management.md
12    	documentation/docs/20-core-concepts/meta.json
13    	documentation/docs/25-build-and-deploy/10-building-your-app.md
14    	documentation/docs/25-build-and-deploy/20-adapters.md
15    	documentation/docs/25-build-and-deploy/30-adapter-auto.md
16    	documentation/docs/25-build-and-deploy/40-adapter-node.md
17    	documentation/docs/25-build-and-deploy/50-adapter-static.md
18    	documentation/docs/25-build-and-deploy/55-single-page-apps.md
19    	documentation/docs/25-build-and-deploy/60-adapter-cloudflare.md
20    	documentation/docs/25-build-and-deploy/70-adapter-cloudflare-workers.md
21    	documentation/docs/25-build-and-deploy/80-adapter-netlify.md
22    	documentation/docs/25-build-and-deploy/90-adapter-vercel.md
23    	documentation/docs/25-build-and-deploy/99-writing-adapters.md
24    	documentation/docs/25-build-and-deploy/meta.json
25    	documentation/docs/30-advanced/10-advanced-routing.md
26    	documentation/docs/30-advanced/20-hooks.md
27    	documentation/docs/30-advanced/25-errors.md
28    	documentation/docs/30-advanced/30-link-options.md
29    	documentation/docs/30-advanced/40-service-workers.md
30    	documentation/docs/30-advanced/50-server-only-modules.md
31    	documentation/docs/30-advanced/65-snapshots.md
32    	documentation/docs/30-advanced/67-shallow-routing.md
33    	documentation/docs/30-advanced/70-packaging.md
34    	documentation/docs/30-advanced/meta.json
35    	documentation/docs/40-best-practices/05-performance.md
36    	documentation/docs/40-best-practices/07-images.md
37    	documentation/docs/40-best-practices/10-accessibility.md
38    	documentation/docs/40-best-practices/20-seo.md
39    	documentation/docs/40-best-practices/meta.json
40    	documentation/docs/50-reference/10-configuration.md
41    	documentation/docs/50-reference/20-cli.md
42    	documentation/docs/50-reference/30-modules.md
43    	documentation/docs/50-reference/40-types.md
44    	documentation/docs/50-reference/meta.json
45    	documentation/docs/60-appendix/10-faq.md
46    	documentation/docs/60-appendix/20-integrations.md
47    	documentation/docs/60-appendix/30-migrating-to-sveltekit-2.md
48    	documentation/docs/60-appendix/40-migrating.md
49    	documentation/docs/60-appendix/50-additional-resources.md
50    	documentation/docs/60-appendix/60-glossary.md
51    	documentation/docs/60-appendix/meta.json
52    	FUNDING.json
53    	LICENSE
54    	package.json
55    	packages/adapter-auto/adapters.js
56    	packages/adapter-auto/CHANGELOG.md
57    	packages/adapter-auto/index.d.ts
58    	packages/adapter-auto/index.js
59    	packages/adapter-auto/package.json
60    	packages/adapter-auto/README.md
61    	packages/adapter-auto/tsconfig.json
62    	packages/adapter-cloudflare/ambient.d.ts
63    	packages/adapter-cloudflare/CHANGELOG.md
64    	packages/adapter-cloudflare/index.d.ts
65    	packages/adapter-cloudflare/index.js
66    	packages/adapter-cloudflare/package.json
67    	packages/adapter-cloudflare/placeholders.d.ts
68    	packages/adapter-cloudflare/README.md
69    	packages/adapter-cloudflare/src/worker.js
70    	packages/adapter-cloudflare/tsconfig.json
71    	packages/adapter-cloudflare-workers/ambient.d.ts
72    	packages/adapter-cloudflare-workers/CHANGELOG.md
73    	packages/adapter-cloudflare-workers/files/entry.js
74    	packages/adapter-cloudflare-workers/files/_package.json
75    	packages/adapter-cloudflare-workers/index.d.ts
76    	packages/adapter-cloudflare-workers/index.js
77    	packages/adapter-cloudflare-workers/package.json
78    	packages/adapter-cloudflare-workers/placeholders.d.ts
79    	packages/adapter-cloudflare-workers/README.md
80    	packages/adapter-cloudflare-workers/tsconfig.json
81    	packages/adapter-netlify/ambient.d.ts
82    	packages/adapter-netlify/CHANGELOG.md
83    	packages/adapter-netlify/index.d.ts
84    	packages/adapter-netlify/index.js
85    	packages/adapter-netlify/package.json
86    	packages/adapter-netlify/README.md
87    	packages/adapter-netlify/rollup.config.js
88    	packages/adapter-netlify/src/edge.js
89    	packages/adapter-netlify/src/headers.js
90    	packages/adapter-netlify/src/headers.spec.js
91    	packages/adapter-netlify/src/serverless.js
92    	packages/adapter-netlify/src/shims.js
93    	packages/adapter-netlify/tsconfig.json
94    	packages/adapter-node/ambient.d.ts
95    	packages/adapter-node/CHANGELOG.md
96    	packages/adapter-node/index.d.ts
97    	packages/adapter-node/index.js
98    	packages/adapter-node/LICENSE
99    	packages/adapter-node/package.json
100   	packages/adapter-node/README.md
101   	packages/adapter-node/rollup.config.js
102   	packages/adapter-node/src/env.js
103   	packages/adapter-node/src/handler.js
104   	packages/adapter-node/src/index.js
105   	packages/adapter-node/src/shims.js
106   	packages/adapter-node/tests/smoke.spec.js
107   	packages/adapter-node/tsconfig.json
108   	packages/adapter-static/CHANGELOG.md
109   	packages/adapter-static/index.d.ts
110   	packages/adapter-static/index.js
111   	packages/adapter-static/LICENSE
112   	packages/adapter-static/package.json
113   	packages/adapter-static/platforms.js
114   	packages/adapter-static/README.md
115   	packages/adapter-static/test/apps/prerendered/package.json
116   	packages/adapter-static/test/apps/prerendered/playwright.config.js
117   	packages/adapter-static/test/apps/prerendered/src/app.html
118   	packages/adapter-static/test/apps/prerendered/src/global.d.ts
119   	packages/adapter-static/test/apps/prerendered/src/routes/endpoint/explicit.json/+server.js
120   	packages/adapter-static/test/apps/prerendered/src/routes/endpoint/implicit.json/+server.js
121   	packages/adapter-static/test/apps/prerendered/src/routes/+layout.js
122   	packages/adapter-static/test/apps/prerendered/src/routes/+layout.svelte
123   	packages/adapter-static/test/apps/prerendered/src/routes/+page.js
124   	packages/adapter-static/test/apps/prerendered/src/routes/+page.svelte
125   	packages/adapter-static/test/apps/prerendered/src/routes/public-env/+page.svelte
126   	packages/adapter-static/test/apps/prerendered/src/routes/server-emitted-asset/+page.server.js
127   	packages/adapter-static/test/apps/prerendered/src/routes/server-emitted-asset/+page.svelte
128   	packages/adapter-static/test/apps/prerendered/svelte.config.js
129   	packages/adapter-static/test/apps/prerendered/test/test.js
130   	packages/adapter-static/test/apps/prerendered/vite.config.js
131   	packages/adapter-static/test/apps/spa/jsconfig.json
132   	packages/adapter-static/test/apps/spa/package.json
133   	packages/adapter-static/test/apps/spa/playwright.config.js
134   	packages/adapter-static/test/apps/spa/README.md
135   	packages/adapter-static/test/apps/spa/src/app.html
136   	packages/adapter-static/test/apps/spa/src/routes/about/+page.js
137   	packages/adapter-static/test/apps/spa/src/routes/about/+page.svelte
138   	packages/adapter-static/test/apps/spa/src/routes/+error.svelte
139   	packages/adapter-static/test/apps/spa/src/routes/fallback/[...rest]/+page.svelte
140   	packages/adapter-static/test/apps/spa/src/routes/+layout.svelte
141   	packages/adapter-static/test/apps/spa/src/routes/+page.svelte
142   	packages/adapter-static/test/apps/spa/svelte.config.js
143   	packages/adapter-static/test/apps/spa/test/test.js
144   	packages/adapter-static/test/apps/spa/vite.config.js
145   	packages/adapter-static/test/utils.js
146   	packages/adapter-static/tsconfig.json
147   	packages/adapter-vercel/ambient.d.ts
148   	packages/adapter-vercel/CHANGELOG.md
149   	packages/adapter-vercel/files/edge.js
150   	packages/adapter-vercel/files/serverless.js
151   	packages/adapter-vercel/index.d.ts
152   	packages/adapter-vercel/index.js
153   	packages/adapter-vercel/internal.d.ts
154   	packages/adapter-vercel/package.json
155   	packages/adapter-vercel/README.md
156   	packages/adapter-vercel/test/utils.spec.js
157   	packages/adapter-vercel/tsconfig.json
158   	packages/adapter-vercel/utils.js
159   	packages/amp/CHANGELOG.md
160   	packages/amp/index.d.ts
161   	packages/amp/index.js
162   	packages/amp/package.json
163   	packages/create-svelte/bin.js
164   	packages/create-svelte/CHANGELOG.md
165   	packages/create-svelte/index.js
166   	packages/create-svelte/package.json
167   	packages/create-svelte/README.md
168   	packages/create-svelte/scripts/build-templates.js
169   	packages/create-svelte/scripts/update-template-repo-contents.js
170   	packages/create-svelte/scripts/update-template-repo.sh
171   	packages/create-svelte/shared/+checkjs/jsconfig.json
172   	packages/create-svelte/shared/+checkjs/package.json
173   	packages/create-svelte/shared/+default+checkjs/svelte.config.js
174   	packages/create-svelte/shared/+default+typescript/svelte.config.js
175   	packages/create-svelte/shared/+default-typescript/svelte.config.js
176   	packages/create-svelte/shared/+default+vitest/src/routes/sverdle/game.test.ts
177   	packages/create-svelte/shared/+eslint/package.json
178   	packages/create-svelte/shared/+eslint+prettier/package.json
179   	packages/create-svelte/shared/+eslint-prettier/package.json
180   	packages/create-svelte/shared/-eslint+prettier/package.json
181   	packages/create-svelte/shared/+eslint+svelte5/package.json
182   	packages/create-svelte/shared/+eslint+typescript/package.json
183   	packages/create-svelte/shared/+playwright+default/tests/test.ts
184   	packages/create-svelte/shared/+playwright/package.json
185   	packages/create-svelte/shared/+playwright+skeletonlib/tests/test.ts
186   	packages/create-svelte/shared/+playwright+skeleton/tests/test.ts
187   	packages/create-svelte/shared/+playwright-typescript/playwright.config.js
188   	packages/create-svelte/shared/+playwright+typescript/playwright.config.ts
189   	packages/create-svelte/shared/+playwright+vitest/package.json
190   	packages/create-svelte/shared/+prettier/package.json
191   	packages/create-svelte/shared/README.md
192   	packages/create-svelte/shared/+skeletonlib+checkjs/jsconfig.json
193   	packages/create-svelte/shared/+skeletonlib/README.md
194   	packages/create-svelte/shared/+skeletonlib+svelte5/package.json
195   	packages/create-svelte/shared/+skeletonlib-typescript/jsconfig.json
196   	packages/create-svelte/shared/+skeletonlib+typescript/tsconfig.json
197   	packages/create-svelte/shared/+svelte5/package.json
198   	packages/create-svelte/shared/+typescript/package.json
199   	packages/create-svelte/shared/+typescript/svelte.config.js
200   	packages/create-svelte/shared/-typescript/svelte.config.js
201   	packages/create-svelte/shared/+typescript/tsconfig.json
202   	packages/create-svelte/shared/vite.config.ts
203   	packages/create-svelte/shared/+vitest/package.json
204   	packages/create-svelte/shared/+vitest+skeletonlib/src/index.test.ts
205   	packages/create-svelte/shared/+vitest+skeleton/src/index.test.ts
206   	packages/create-svelte/shared/+vitest/vite.config.ts
207   	packages/create-svelte/templates/default/netlify.toml
208   	packages/create-svelte/templates/default/package.json
209   	packages/create-svelte/templates/default/package.template.json
210   	packages/create-svelte/templates/default/README.md
211   	packages/create-svelte/templates/default/src/app.d.ts
212   	packages/create-svelte/templates/default/src/app.html
213   	packages/create-svelte/templates/default/src/routes/about/+page.svelte
214   	packages/create-svelte/templates/default/src/routes/about/+page.ts
215   	packages/create-svelte/templates/default/src/routes/Counter.svelte
216   	packages/create-svelte/templates/default/src/routes/Header.svelte
217   	packages/create-svelte/templates/default/src/routes/+layout.svelte
218   	packages/create-svelte/templates/default/src/routes/+page.svelte
219   	packages/create-svelte/templates/default/src/routes/+page.ts
220   	packages/create-svelte/templates/default/src/routes/styles.css
221   	packages/create-svelte/templates/default/src/routes/sverdle/game.ts
222   	packages/create-svelte/templates/default/src/routes/sverdle/how-to-play/+page.svelte
223   	packages/create-svelte/templates/default/src/routes/sverdle/how-to-play/+page.ts
224   	packages/create-svelte/templates/default/src/routes/sverdle/+page.server.ts
225   	packages/create-svelte/templates/default/src/routes/sverdle/+page.svelte
226   	packages/create-svelte/templates/default/src/routes/sverdle/reduced-motion.ts
227   	packages/create-svelte/templates/default/src/routes/sverdle/words.server.ts
228   	packages/create-svelte/templates/default/static/robots.txt
229   	packages/create-svelte/templates/default/svelte.config.js
230   	packages/create-svelte/templates/default/tsconfig.json
231   	packages/create-svelte/templates/default/vercel.json
232   	packages/create-svelte/templates/default/vite.config.js
233   	packages/create-svelte/templates/default/wrangler.toml
234   	packages/create-svelte/templates/skeletonlib/package.template.json
235   	packages/create-svelte/templates/skeletonlib/src/app.d.ts
236   	packages/create-svelte/templates/skeletonlib/src/app.html
237   	packages/create-svelte/templates/skeletonlib/src/lib/index.ts
238   	packages/create-svelte/templates/skeletonlib/src/routes/+page.svelte
239   	packages/create-svelte/templates/skeletonlib/svelte.config.js
240   	packages/create-svelte/templates/skeletonlib/vite.config.js
241   	packages/create-svelte/templates/skeleton/package.json
242   	packages/create-svelte/templates/skeleton/package.template.json
243   	packages/create-svelte/templates/skeleton/src/app.d.ts
244   	packages/create-svelte/templates/skeleton/src/app.html
245   	packages/create-svelte/templates/skeleton/src/lib/index.ts
246   	packages/create-svelte/templates/skeleton/src/routes/+page.svelte
247   	packages/create-svelte/templates/skeleton/svelte.config.js
248   	packages/create-svelte/templates/skeleton/vite.config.js
249   	packages/create-svelte/test/check.js
250   	packages/create-svelte/tsconfig.json
251   	packages/create-svelte/types/index.d.ts
252   	packages/create-svelte/types/internal.d.ts
253   	packages/create-svelte/utils.js
254   	packages/create-svelte/vitest.config.js
255   	packages/enhanced-img/CHANGELOG.md
256   	packages/enhanced-img/package.json
257   	packages/enhanced-img/README.md
258   	packages/enhanced-img/src/index.js
259   	packages/enhanced-img/src/preprocessor.js
260   	packages/enhanced-img/test/Input.svelte
261   	packages/enhanced-img/test/Output.svelte
262   	packages/enhanced-img/test/preprocessor.spec.js
263   	packages/enhanced-img/tsconfig.json
264   	packages/enhanced-img/types/ambient.d.ts
265   	packages/enhanced-img/types/index.d.ts
266   	packages/kit/CHANGELOG.md
267   	packages/kit/kit.vitest.config.js
268   	packages/kit/package.json
269   	packages/kit/postinstall.js
270   	packages/kit/README.md
271   	packages/kit/scripts/cp.js
272   	packages/kit/scripts/generate-dts.js
273   	packages/kit/scripts/generate-version.js
274   	packages/kit/src/cli.js
275   	packages/kit/src/constants.js
276   	packages/kit/src/core/adapt/builder.js
277   	packages/kit/src/core/adapt/builder.spec.js
278   	packages/kit/src/core/adapt/fixtures/basic/static/answer.md
279   	packages/kit/src/core/adapt/fixtures/compress/foo.css
280   	packages/kit/src/core/adapt/index.js
281   	packages/kit/src/core/config/default-error.html
282   	packages/kit/src/core/config/fixtures/default/svelte.config.js
283   	packages/kit/src/core/config/fixtures/export-string/svelte.config.js
284   	packages/kit/src/core/config/index.js
285   	packages/kit/src/core/config/index.spec.js
286   	packages/kit/src/core/config/options.js
287   	packages/kit/src/core/config/types.d.ts
288   	packages/kit/src/core/env.js
289   	packages/kit/src/core/generate_manifest/find_server_assets.js
290   	packages/kit/src/core/generate_manifest/index.js
291   	packages/kit/src/core/postbuild/analyse.js
292   	packages/kit/src/core/postbuild/crawl.js
293   	packages/kit/src/core/postbuild/crawl.spec.js
294   	packages/kit/src/core/postbuild/entities.js
295   	packages/kit/src/core/postbuild/entities.spec.js
296   	packages/kit/src/core/postbuild/fallback.js
297   	packages/kit/src/core/postbuild/fixtures/base/input.html
298   	packages/kit/src/core/postbuild/fixtures/base/output.json
299   	packages/kit/src/core/postbuild/fixtures/basic-href/input.html
300   	packages/kit/src/core/postbuild/fixtures/basic-href/output.json
301   	packages/kit/src/core/postbuild/fixtures/basic-src/input.html
302   	packages/kit/src/core/postbuild/fixtures/basic-src/output.json
303   	packages/kit/src/core/postbuild/fixtures/basic-srcset/input.html
304   	packages/kit/src/core/postbuild/fixtures/basic-srcset/output.json
305   	packages/kit/src/core/postbuild/fixtures/href-with-character-reference/input.html
306   	packages/kit/src/core/postbuild/fixtures/href-with-character-reference/output.json
307   	packages/kit/src/core/postbuild/fixtures/ids/input.html
308   	packages/kit/src/core/postbuild/fixtures/ids/output.json
309   	packages/kit/src/core/postbuild/fixtures/include-rel-external/input.html
310   	packages/kit/src/core/postbuild/fixtures/include-rel-external/output.json
311   	packages/kit/src/core/postbuild/fixtures/meta/input.html
312   	packages/kit/src/core/postbuild/fixtures/meta/output.json
313   	packages/kit/src/core/postbuild/fixtures/unquoted-attributes/input.html
314   	packages/kit/src/core/postbuild/fixtures/unquoted-attributes/output.json
315   	packages/kit/src/core/postbuild/prerender.js
316   	packages/kit/src/core/postbuild/queue.js
317   	packages/kit/src/core/postbuild/queue.spec.js
318   	packages/kit/src/core/sync/create_manifest_data/conflict.js
319   	packages/kit/src/core/sync/create_manifest_data/index.js
320   	packages/kit/src/core/sync/create_manifest_data/index.spec.js
321   	packages/kit/src/core/sync/create_manifest_data/sort.js
322   	packages/kit/src/core/sync/create_manifest_data/test/params/bar.js
323   	packages/kit/src/core/sync/create_manifest_data/test/params/foo.js
324   	packages/kit/src/core/sync/create_manifest_data/test/samples/basic/about/+page.svelte
325   	packages/kit/src/core/sync/create_manifest_data/test/samples/basic/blog/default.svelte
326   	packages/kit/src/core/sync/create_manifest_data/test/samples/basic/blog.json/+server.js
327   	packages/kit/src/core/sync/create_manifest_data/test/samples/basic/blog/+page.svelte
328   	packages/kit/src/core/sync/create_manifest_data/test/samples/basic/blog/[slug].json/+server.ts
329   	packages/kit/src/core/sync/create_manifest_data/test/samples/basic/blog/[slug]/+page.svelte
330   	packages/kit/src/core/sync/create_manifest_data/test/samples/basic-layout/foo/+layout.svelte
331   	packages/kit/src/core/sync/create_manifest_data/test/samples/basic-layout/foo/+page.svelte
332   	packages/kit/src/core/sync/create_manifest_data/test/samples/basic-layout/+layout.svelte
333   	packages/kit/src/core/sync/create_manifest_data/test/samples/basic-layout/+page.svelte
334   	packages/kit/src/core/sync/create_manifest_data/test/samples/basic/+page.d.ts
335   	packages/kit/src/core/sync/create_manifest_data/test/samples/basic/+page.svelte
336   	packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-groups/(x)/a/+page.svelte
337   	packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-groups/(y)/a/+page.svelte
338   	packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-params/[slug1]/+page.svelte
339   	packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-params/[slug2]/+page.svelte
340   	packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-ts-js-handlers-layout/+layout.server.js
341   	packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-ts-js-handlers-layout/+layout.server.ts
342   	packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-ts-js-handlers-page/+page.js
343   	packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-ts-js-handlers-page/+page.ts
344   	packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-ts-js-handlers-server/+server.js
345   	packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-ts-js-handlers-server/+server.ts
346   	packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/about/+page.jazz
347   	packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/blog/_default.svelte
348   	packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/blog.json/+server.js
349   	packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/blog/+page.svelte
350   	packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/blog/[slug].json/+server.js
351   	packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/blog/[slug]/+page.beebop
352   	packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/+page.funk
353   	packages/kit/src/core/sync/create_manifest_data/test/samples/declared-layout/+layout-foo.svelte
354   	packages/kit/src/core/sync/create_manifest_data/test/samples/encoding/[x+22]/+page.svelte
355   	packages/kit/src/core/sync/create_manifest_data/test/samples/encoding/[x+23]/+page.svelte
356   	packages/kit/src/core/sync/create_manifest_data/test/samples/encoding/[x+3f]/+page.svelte
357   	packages/kit/src/core/sync/create_manifest_data/test/samples/hidden-underscore/a/_b/c/d.js
358   	packages/kit/src/core/sync/create_manifest_data/test/samples/hidden-underscore/e/f/g/h/+server.js
359   	packages/kit/src/core/sync/create_manifest_data/test/samples/hidden-underscore/_foo.js
360   	packages/kit/src/core/sync/create_manifest_data/test/samples/hidden-underscore/i/_j.js
361   	packages/kit/src/core/sync/create_manifest_data/test/samples/hidden-underscore/+page.svelte
362   	packages/kit/src/core/sync/create_manifest_data/test/samples/invalid-named-layout-reference/x/+page@.js
363   	packages/kit/src/core/sync/create_manifest_data/test/samples/invalid-named-layout-reference/x/+page@.svelte
364   	packages/kit/src/core/sync/create_manifest_data/test/samples/invalid-params/[foo][bar]/+server.js
365   	packages/kit/src/core/sync/create_manifest_data/test/samples/lockfiles/foo/+server.js
366   	packages/kit/src/core/sync/create_manifest_data/test/samples/lockfiles/foo/+server.js_tmp
367   	packages/kit/src/core/sync/create_manifest_data/test/samples/multiple-layouts/+layout.svelte
368   	packages/kit/src/core/sync/create_manifest_data/test/samples/multiple-layouts/+layout@.svelte
369   	packages/kit/src/core/sync/create_manifest_data/test/samples/multiple-pages/+page.svelte
370   	packages/kit/src/core/sync/create_manifest_data/test/samples/multiple-pages/+page@.svelte
371   	packages/kit/src/core/sync/create_manifest_data/test/samples/multiple-slugs/[file].[ext]/+server.js
372   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layout-missing/+page@missing.svelte
373   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/a/a1/+page.svelte
374   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/a/+layout.svelte
375   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/c/c2/+page@.svelte
376   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/c/+layout.svelte
377   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/d/d1/+page.svelte
378   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/d/(special)/(extraspecial)/d2/+page.svelte
379   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/d/(special)/(extraspecial)/d3/+page@(special).svelte
380   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/d/(special)/(extraspecial)/+layout.svelte
381   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/d/(special)/+layout.svelte
382   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/d/(special)/+page.svelte
383   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/+layout.svelte
384   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/(special)/a/a2/+page.svelte
385   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/(special)/(alsospecial)/b/c/c1/+page.svelte
386   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/(special)/(alsospecial)/+layout.svelte
387   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/(special)/+layout.js
388   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/(special)/+layout.server.js
389   	packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/(special)/+layout.svelte
390   	packages/kit/src/core/sync/create_manifest_data/test/samples/nested-errors/foo/bar/baz/+error.svelte
391   	packages/kit/src/core/sync/create_manifest_data/test/samples/nested-errors/foo/bar/baz/+layout.svelte
392   	packages/kit/src/core/sync/create_manifest_data/test/samples/nested-errors/foo/bar/baz/+page.svelte
393   	packages/kit/src/core/sync/create_manifest_data/test/samples/nested-errors/foo/bar/+error.svelte
394   	packages/kit/src/core/sync/create_manifest_data/test/samples/nested-errors/foo/+layout.svelte
395   	packages/kit/src/core/sync/create_manifest_data/test/samples/nested-optionals/[[a]]/[[b]]/+page.svelte
396   	packages/kit/src/core/sync/create_manifest_data/test/samples/optional/[[foo]]bar/+server.js
397   	packages/kit/src/core/sync/create_manifest_data/test/samples/optional/nested/[[optional]]/sub/+page.svelte
398   	packages/kit/src/core/sync/create_manifest_data/test/samples/optional/[[optional]]/+page.svelte
399   	packages/kit/src/core/sync/create_manifest_data/test/samples/optional/prefix[[suffix]]/+page.svelte
400   	packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/error/+error.svelte
401   	packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/error/[...path]/+page.js
402   	packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/layout/exists/+layout.js
403   	packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/layout/exists/+page.svelte
404   	packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/layout/+layout.svelte
405   	packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/layout/redirect/+page.server.js
406   	packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/+page.svelte
407   	packages/kit/src/core/sync/create_manifest_data/test/samples/rest/a/[...rest]/+page.server.js
408   	packages/kit/src/core/sync/create_manifest_data/test/samples/rest/a/[...rest]/+page.svelte
409   	packages/kit/src/core/sync/create_manifest_data/test/samples/rest/b/[...rest]/+page.server.ts
410   	packages/kit/src/core/sync/create_manifest_data/test/samples/rest/b/[...rest]/+page.svelte
411   	packages/kit/src/core/sync/create_manifest_data/test/samples/rest-prefix-suffix/prefix-[...rest]/+page.svelte
412   	packages/kit/src/core/sync/create_manifest_data/test/samples/rest-prefix-suffix/[...rest].json/+server.js
413   	packages/kit/src/core/sync/create_manifest_data/test/samples/symlinks/bar/+page.svelte
414   	packages/kit/src/core/sync/create_manifest_data/test/samples/symlinks/routes/+page.svelte
415   	packages/kit/src/core/sync/create_manifest_data/test/static/bar/baz.txt
416   	packages/kit/src/core/sync/create_manifest_data/test/static/foo.txt
417   	packages/kit/src/core/sync/create_manifest_data/types.d.ts
418   	packages/kit/src/core/sync/sync.js
419   	packages/kit/src/core/sync/ts.js
420   	packages/kit/src/core/sync/utils.js
421   	packages/kit/src/core/sync/write_ambient.js
422   	packages/kit/src/core/sync/write_client_manifest.js
423   	packages/kit/src/core/sync/write_non_ambient.js
424   	packages/kit/src/core/sync/write_root.js
425   	packages/kit/src/core/sync/write_server.js
426   	packages/kit/src/core/sync/write_tsconfig.js
427   	packages/kit/src/core/sync/write_tsconfig.spec.js
428   	packages/kit/src/core/sync/write_types/index.js
429   	packages/kit/src/core/sync/write_types/index.spec.js
430   	packages/kit/src/core/sync/write_types/test/actions/+page.server.js
431   	packages/kit/src/core/sync/write_types/test/layout-advanced/+layout.js
432   	packages/kit/src/core/sync/write_types/test/layout-advanced/+layout.svelte
433   	packages/kit/src/core/sync/write_types/test/layout-advanced/(main)/+layout.server.js
434   	packages/kit/src/core/sync/write_types/test/layout-advanced/(main)/+layout.svelte
435   	packages/kit/src/core/sync/write_types/test/layout-advanced/(main)/+page.js
436   	packages/kit/src/core/sync/write_types/test/layout-advanced/(main)/+page@.svelte
437   	packages/kit/src/core/sync/write_types/test/layout-advanced/(main)/sub/+page.js
438   	packages/kit/src/core/sync/write_types/test/layout-advanced/(main)/sub/+page.svelte
439   	packages/kit/src/core/sync/write_types/test/layout/+layout.js
440   	packages/kit/src/core/sync/write_types/test/layout/+layout.server.js
441   	packages/kit/src/core/sync/write_types/test/layout/+layout.svelte
442   	packages/kit/src/core/sync/write_types/test/layout/+page.js
443   	packages/kit/src/core/sync/write_types/test/layout/+page.server.js
444   	packages/kit/src/core/sync/write_types/test/layout/+page.svelte
445   	packages/kit/src/core/sync/write_types/test/package.json
446   	packages/kit/src/core/sync/write_types/test/param-type-inference/optional/[[optionalNarrowedParam=narrowed]]/+page.js
447   	packages/kit/src/core/sync/write_types/test/param-type-inference/params/narrowed.js
448   	packages/kit/src/core/sync/write_types/test/param-type-inference/params/not_narrowed.js
449   	packages/kit/src/core/sync/write_types/test/param-type-inference/required/+layout.js
450   	packages/kit/src/core/sync/write_types/test/param-type-inference/required/[narrowedParam=narrowed]/+page.js
451   	packages/kit/src/core/sync/write_types/test/param-type-inference/required/[regularParam=not_narrowed]/+page.js
452   	packages/kit/src/core/sync/write_types/test/param-type-inference/spread/[...spread=narrowed]/+page.js
453   	packages/kit/src/core/sync/write_types/test/simple-page-server-and-shared/+page.js
454   	packages/kit/src/core/sync/write_types/test/simple-page-server-and-shared/+page.server.js
455   	packages/kit/src/core/sync/write_types/test/simple-page-server-and-shared/+page.svelte
456   	packages/kit/src/core/sync/write_types/test/simple-page-server-only/+page.server.js
457   	packages/kit/src/core/sync/write_types/test/simple-page-server-only/+page.svelte
458   	packages/kit/src/core/sync/write_types/test/simple-page-server-only/sub/+page.server.js
459   	packages/kit/src/core/sync/write_types/test/simple-page-server-only/sub/+page.svelte
460   	packages/kit/src/core/sync/write_types/test/simple-page-shared-only/+page.js
461   	packages/kit/src/core/sync/write_types/test/simple-page-shared-only/+page.svelte
462   	packages/kit/src/core/sync/write_types/test/simple-page-shared-only/sub/+page.js
463   	packages/kit/src/core/sync/write_types/test/simple-page-shared-only/sub/+page.svelte
464   	packages/kit/src/core/sync/write_types/test/slugs/+layout.js
465   	packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/+layout.js
466   	packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/+layout.svelte
467   	packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/nested/+layout.js
468   	packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/nested/+layout.svelte
469   	packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/nested/[...rest]/+page.js
470   	packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/nested/[...rest]/+page.svelte
471   	packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/nested/[slug]/+page@.svelte
472   	packages/kit/src/core/sync/write_types/test/slugs/+layout.svelte
473   	packages/kit/src/core/sync/write_types/test/slugs/[...rest]/+page.js
474   	packages/kit/src/core/sync/write_types/test/slugs/[...rest]/+page.svelte
475   	packages/kit/src/core/sync/write_types/test/slugs/[slug]/+page.js
476   	packages/kit/src/core/sync/write_types/test/slugs/[slug]/+page.svelte
477   	packages/kit/src/core/sync/write_types/test/slugs/x/[[optional]]/+page.js
478   	packages/kit/src/core/sync/write_types/test/slugs/x/[[optional]]/+page.svelte
479   	packages/kit/src/core/sync/write_types/test/tsconfig.json
480   	packages/kit/src/core/utils.js
481   	packages/kit/src/exports/hooks/index.js
482   	packages/kit/src/exports/hooks/sequence.js
483   	packages/kit/src/exports/hooks/sequence.spec.js
484   	packages/kit/src/exports/index.js
485   	packages/kit/src/exports/node/index.js
486   	packages/kit/src/exports/node/polyfills.js
487   	packages/kit/src/exports/public.d.ts
488   	packages/kit/src/exports/vite/build/build_server.js
489   	packages/kit/src/exports/vite/build/build_service_worker.js
490   	packages/kit/src/exports/vite/build/utils.js
491   	packages/kit/src/exports/vite/dev/index.js
492   	packages/kit/src/exports/vite/graph_analysis/index.js
493   	packages/kit/src/exports/vite/graph_analysis/index.spec.js
494   	packages/kit/src/exports/vite/graph_analysis/types.d.ts
495   	packages/kit/src/exports/vite/graph_analysis/utils.js
496   	packages/kit/src/exports/vite/graph_analysis/utils.spec.js
497   	packages/kit/src/exports/vite/index.js
498   	packages/kit/src/exports/vite/module_ids.js
499   	packages/kit/src/exports/vite/preview/index.js
500   	packages/kit/src/exports/vite/types.d.ts
501   	packages/kit/src/exports/vite/utils.js
502   	packages/kit/src/exports/vite/utils.spec.js
503   	packages/kit/src/runtime/app/environment/index.js
504   	packages/kit/src/runtime/app/environment/types.d.ts
505   	packages/kit/src/runtime/app/forms.js
506   	packages/kit/src/runtime/app/navigation.js
507   	packages/kit/src/runtime/app/paths/index.js
508   	packages/kit/src/runtime/app/paths/types.d.ts
509   	packages/kit/src/runtime/app/server/index.js
510   	packages/kit/src/runtime/app/stores.js
511   	packages/kit/src/runtime/client/client.js
512   	packages/kit/src/runtime/client/constants.js
513   	packages/kit/src/runtime/client/entry.js
514   	packages/kit/src/runtime/client/fetcher.js
515   	packages/kit/src/runtime/client/parse.js
516   	packages/kit/src/runtime/client/session-storage.js
517   	packages/kit/src/runtime/client/types.d.ts
518   	packages/kit/src/runtime/client/utils.js
519   	packages/kit/src/runtime/components/error.svelte
520   	packages/kit/src/runtime/components/layout.svelte
521   	packages/kit/src/runtime/control.js
522   	packages/kit/src/runtime/env/dynamic/private.js
523   	packages/kit/src/runtime/env/dynamic/public.js
524   	packages/kit/src/runtime/hash.js
525   	packages/kit/src/runtime/server/ambient.d.ts
526   	packages/kit/src/runtime/server/cookie.js
527   	packages/kit/src/runtime/server/cookie.spec.js
528   	packages/kit/src/runtime/server/data/index.js
529   	packages/kit/src/runtime/server/endpoint.js
530   	packages/kit/src/runtime/server/env_module.js
531   	packages/kit/src/runtime/server/fetch.js
532   	packages/kit/src/runtime/server/index.js
533   	packages/kit/src/runtime/server/page/actions.js
534   	packages/kit/src/runtime/server/page/crypto.js
535   	packages/kit/src/runtime/server/page/crypto.spec.js
536   	packages/kit/src/runtime/server/page/csp.js
537   	packages/kit/src/runtime/server/page/csp.spec.js
538   	packages/kit/src/runtime/server/page/index.js
539   	packages/kit/src/runtime/server/page/load_data.js
540   	packages/kit/src/runtime/server/page/load_data.spec.js
541   	packages/kit/src/runtime/server/page/load_page_nodes.js
542   	packages/kit/src/runtime/server/page/render.js
543   	packages/kit/src/runtime/server/page/respond_with_error.js
544   	packages/kit/src/runtime/server/page/serialize_data.js
545   	packages/kit/src/runtime/server/page/serialize_data.spec.js
546   	packages/kit/src/runtime/server/page/types.d.ts
547   	packages/kit/src/runtime/server/respond.js
548   	packages/kit/src/runtime/server/utils.js
549   	packages/kit/src/runtime/shared.js
550   	packages/kit/src/runtime/shared-server.js
551   	packages/kit/src/runtime/utils.js
552   	packages/kit/src/types/ambient.d.ts
553   	packages/kit/src/types/ambient-private.d.ts
554   	packages/kit/src/types/global-private.d.ts
555   	packages/kit/src/types/internal.d.ts
556   	packages/kit/src/types/private.d.ts
557   	packages/kit/src/types/synthetic/$env+dynamic+private.md
558   	packages/kit/src/types/synthetic/$env+dynamic+public.md
559   	packages/kit/src/types/synthetic/$env+static+private.md
560   	packages/kit/src/types/synthetic/$env+static+public.md
561   	packages/kit/src/types/synthetic/$lib.md
562   	packages/kit/src/utils/array.js
563   	packages/kit/src/utils/env.js
564   	packages/kit/src/utils/error.js
565   	packages/kit/src/utils/escape.js
566   	packages/kit/src/utils/escape.spec.js
567   	packages/kit/src/utils/exports.js
568   	packages/kit/src/utils/exports.spec.js
569   	packages/kit/src/utils/features.js
570   	packages/kit/src/utils/filesystem.js
571   	packages/kit/src/utils/filesystem.spec.js
572   	packages/kit/src/utils/fork.js
573   	packages/kit/src/utils/functions.js
574   	packages/kit/src/utils/http.js
575   	packages/kit/src/utils/http.spec.js
576   	packages/kit/src/utils/misc.js
577   	packages/kit/src/utils/options.js
578   	packages/kit/src/utils/route_config.js
579   	packages/kit/src/utils/routing.js
580   	packages/kit/src/utils/routing.spec.js
581   	packages/kit/src/utils/streaming.js
582   	packages/kit/src/utils/streaming.spec.js
583   	packages/kit/src/utils/url.js
584   	packages/kit/src/utils/url.spec.js
585   	packages/kit/src/version.js
586   	packages/kit/src/version.spec.js
587   	packages/kit/svelte-kit.js
588   	packages/kit/test/ambient.d.ts
589   	packages/kit/test/apps/amp/package.json
590   	packages/kit/test/apps/amp/playwright.config.js
591   	packages/kit/test/apps/amp/src/app.d.ts
592   	packages/kit/test/apps/amp/src/app.html
593   	packages/kit/test/apps/amp/src/hooks.server.js
594   	packages/kit/test/apps/amp/src/routes/http-equiv/cache-control/+page.js
595   	packages/kit/test/apps/amp/src/routes/http-equiv/cache-control/+page.svelte
596   	packages/kit/test/apps/amp/src/routes/invalid/has-stylesheet/+page.svelte
597   	packages/kit/test/apps/amp/src/routes/invalid/+page.svelte
598   	packages/kit/test/apps/amp/src/routes/+layout.js
599   	packages/kit/test/apps/amp/src/routes/+layout.svelte
600   	packages/kit/test/apps/amp/src/routes/origin.json/+server.js
601   	packages/kit/test/apps/amp/src/routes/origin/+page.js
602   	packages/kit/test/apps/amp/src/routes/origin/+page.svelte
603   	packages/kit/test/apps/amp/src/routes/styles/imported.css
604   	packages/kit/test/apps/amp/src/routes/styles/+page.svelte
605   	packages/kit/test/apps/amp/src/routes/styles/Unused.svelte
606   	packages/kit/test/apps/amp/src/routes/valid.json/+server.js
607   	packages/kit/test/apps/amp/src/routes/valid/+page.js
608   	packages/kit/test/apps/amp/src/routes/valid/+page.svelte
609   	packages/kit/test/apps/amp/svelte.config.js
610   	packages/kit/test/apps/amp/test/test.js
611   	packages/kit/test/apps/amp/tsconfig.json
612   	packages/kit/test/apps/amp/vite.config.js
613   	packages/kit/test/apps/basics/package.json
614   	packages/kit/test/apps/basics/playwright.config.js
615   	packages/kit/test/apps/basics/src/app.d.ts
616   	packages/kit/test/apps/basics/src/app.html
617   	packages/kit/test/apps/basics/src/error.html
618   	packages/kit/test/apps/basics/src/global.d.ts
619   	packages/kit/test/apps/basics/src/hooks.client.js
620   	packages/kit/test/apps/basics/src/hooks.js
621   	packages/kit/test/apps/basics/src/hooks.server.js
622   	packages/kit/test/apps/basics/src/params/lowercase.js
623   	packages/kit/test/apps/basics/src/params/numeric.js
624   	packages/kit/test/apps/basics/src/params/uppercase.js
625   	packages/kit/test/apps/basics/src/routes/accessibility/a/+page.svelte
626   	packages/kit/test/apps/basics/src/routes/accessibility/autofocus/a/+page.svelte
627   	packages/kit/test/apps/basics/src/routes/accessibility/autofocus/b/+page.server.js
628   	packages/kit/test/apps/basics/src/routes/accessibility/autofocus/b/+page.svelte
629   	packages/kit/test/apps/basics/src/routes/accessibility/autofocus/+layout.svelte
630   	packages/kit/test/apps/basics/src/routes/accessibility/b/+page.svelte
631   	packages/kit/test/apps/basics/src/routes/accessibility/c/+page.server.js
632   	packages/kit/test/apps/basics/src/routes/accessibility/c/+page.svelte
633   	packages/kit/test/apps/basics/src/routes/accessibility/+layout.svelte
634   	packages/kit/test/apps/basics/src/routes/actions/enhance/+page.server.js
635   	packages/kit/test/apps/basics/src/routes/actions/enhance/+page.svelte
636   	packages/kit/test/apps/basics/src/routes/actions/file-without-enctype/+page.server.js
637   	packages/kit/test/apps/basics/src/routes/actions/file-without-enctype/+page.svelte
638   	packages/kit/test/apps/basics/src/routes/actions/form-errors/adjacent-error-boundary/+error.svelte
639   	packages/kit/test/apps/basics/src/routes/actions/form-errors/adjacent-error-boundary/+page.server.js
640   	packages/kit/test/apps/basics/src/routes/actions/form-errors/adjacent-error-boundary/+page.svelte
641   	packages/kit/test/apps/basics/src/routes/actions/form-errors/+page.server.js
642   	packages/kit/test/apps/basics/src/routes/actions/form-errors/+page.svelte
643   	packages/kit/test/apps/basics/src/routes/actions/form-errors-persist-fields/+page.server.js
644   	packages/kit/test/apps/basics/src/routes/actions/form-errors-persist-fields/+page.svelte
645   	packages/kit/test/apps/basics/src/routes/actions/invalidate-all/+layout.js
646   	packages/kit/test/apps/basics/src/routes/actions/invalidate-all/+page.server.js
647   	packages/kit/test/apps/basics/src/routes/actions/invalidate-all/+page.svelte
648   	packages/kit/test/apps/basics/src/routes/actions/redirect-in-handle/+page.server.js
649   	packages/kit/test/apps/basics/src/routes/actions/redirect-in-handle/+page.svelte
650   	packages/kit/test/apps/basics/src/routes/actions/redirect/+page.server.js
651   	packages/kit/test/apps/basics/src/routes/actions/redirect/+page.svelte
652   	packages/kit/test/apps/basics/src/routes/actions/success-data/+page.server.js
653   	packages/kit/test/apps/basics/src/routes/actions/success-data/+page.svelte
654   	packages/kit/test/apps/basics/src/routes/actions/update-form/+page.svelte
655   	packages/kit/test/apps/basics/src/routes/adapter/dynamic/+page.server.js
656   	packages/kit/test/apps/basics/src/routes/adapter/dynamic/+page.svelte
657   	packages/kit/test/apps/basics/src/routes/adapter/prerendered/+page.server.js
658   	packages/kit/test/apps/basics/src/routes/adapter/prerendered/+page.svelte
659   	packages/kit/test/apps/basics/src/routes/anchor/anchor/+page.svelte
660   	packages/kit/test/apps/basics/src/routes/anchor/+page.svelte
661   	packages/kit/test/apps/basics/src/routes/anchor-with-manual-scroll/anchor-afternavigate/+page.svelte
662   	packages/kit/test/apps/basics/src/routes/anchor-with-manual-scroll/anchor-onmount/+page.svelte
663   	packages/kit/test/apps/basics/src/routes/anchor-with-manual-scroll/+page.svelte
664   	packages/kit/test/apps/basics/src/routes/answer.json/+server.js
665   	packages/kit/test/apps/basics/src/routes/app-environment/+page.svelte
666   	packages/kit/test/apps/basics/src/routes/asset-import/+page.svelte
667   	packages/kit/test/apps/basics/src/routes/caching/+page.js
668   	packages/kit/test/apps/basics/src/routes/caching/+page.svelte
669   	packages/kit/test/apps/basics/src/routes/caching/server-data/+page.server.js
670   	packages/kit/test/apps/basics/src/routes/caching/server-data/+page.svelte
671   	packages/kit/test/apps/basics/src/routes/content-length-header/+page.svelte
672   	packages/kit/test/apps/basics/src/routes/content-type-header/+page.svelte
673   	packages/kit/test/apps/basics/src/routes/cookies/collect-without-re-escaping/+page.js
674   	packages/kit/test/apps/basics/src/routes/cookies/collect-without-re-escaping/+page.svelte
675   	packages/kit/test/apps/basics/src/routes/cookies/collect-without-re-escaping/set-cookie/+server.js
676   	packages/kit/test/apps/basics/src/routes/cookies/delete/+server.js
677   	packages/kit/test/apps/basics/src/routes/cookies/encoding/not-decoded-twice/+server.js
678   	packages/kit/test/apps/basics/src/routes/cookies/encoding/+page.server.js
679   	packages/kit/test/apps/basics/src/routes/cookies/encoding/+page.svelte
680   	packages/kit/test/apps/basics/src/routes/cookies/encoding/set/+server.js
681   	packages/kit/test/apps/basics/src/routes/cookies/enhanced/basic/+page.server.ts
682   	packages/kit/test/apps/basics/src/routes/cookies/enhanced/basic/+page.svelte
683   	packages/kit/test/apps/basics/src/routes/cookies/forwarded-in-etag/+page.server.js
684   	packages/kit/test/apps/basics/src/routes/cookies/forwarded-in-etag/+page.svelte
685   	packages/kit/test/apps/basics/src/routes/cookies/nested/a/+page.server.js
686   	packages/kit/test/apps/basics/src/routes/cookies/nested/a/+page.svelte
687   	packages/kit/test/apps/basics/src/routes/cookies/nested/b/+page.server.js
688   	packages/kit/test/apps/basics/src/routes/cookies/nested/b/+page.svelte
689   	packages/kit/test/apps/basics/src/routes/cookies/+page.server.js
690   	packages/kit/test/apps/basics/src/routes/cookies/+page.svelte
691   	packages/kit/test/apps/basics/src/routes/cookies/serialize/+server.js
692   	packages/kit/test/apps/basics/src/routes/cookies/set-in-layout/+layout.server.js
693   	packages/kit/test/apps/basics/src/routes/cookies/set-in-layout/+layout.svelte
694   	packages/kit/test/apps/basics/src/routes/cookies/set-in-layout/+page.server.js
695   	packages/kit/test/apps/basics/src/routes/cookies/set-in-layout/+page.svelte
696   	packages/kit/test/apps/basics/src/routes/cookies/set-more-than-one/+page.server.js
697   	packages/kit/test/apps/basics/src/routes/cookies/set-more-than-one/+page.svelte
698   	packages/kit/test/apps/basics/src/routes/cookies/set/+server.js
699   	packages/kit/test/apps/basics/src/routes/cookies/shared.js
700   	packages/kit/test/apps/basics/src/routes/csrf/+server.js
701   	packages/kit/test/apps/basics/src/routes/css/_base.css
702   	packages/kit/test/apps/basics/src/routes/css/encöded/+page.svelte
703   	packages/kit/test/apps/basics/src/routes/css/_manual.css
704   	packages/kit/test/apps/basics/src/routes/css/other/+page.svelte
705   	packages/kit/test/apps/basics/src/routes/css/+page.svelte
706   	packages/kit/test/apps/basics/src/routes/css/_styles.css
707   	packages/kit/test/apps/basics/src/routes/cyclical-dynamic-import/_is_even.js
708   	packages/kit/test/apps/basics/src/routes/cyclical-dynamic-import/_is_odd.js
709   	packages/kit/test/apps/basics/src/routes/cyclical-dynamic-import/+page.svelte
710   	packages/kit/test/apps/basics/src/routes/data-sveltekit/noscroll/+page.svelte
711   	packages/kit/test/apps/basics/src/routes/data-sveltekit/noscroll/target/+page.svelte
712   	packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/offline/+layout.server.js
713   	packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/offline/+page.svelte
714   	packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/offline/slow-navigation/+page.server.js
715   	packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/offline/slow-navigation/+page.svelte
716   	packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/offline/target/+page.svelte
717   	packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/+page.svelte
718   	packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/target/+page.svelte
719   	packages/kit/test/apps/basics/src/routes/data-sveltekit/reload/+page.svelte
720   	packages/kit/test/apps/basics/src/routes/data-sveltekit/reload/target/+page.svelte
721   	packages/kit/test/apps/basics/src/routes/data-sveltekit/replacestate/+page.svelte
722   	packages/kit/test/apps/basics/src/routes/data-sveltekit/replacestate/target/+page.svelte
723   	packages/kit/test/apps/basics/src/routes/delete-route/[id].json/+server.js
724   	packages/kit/test/apps/basics/src/routes/delete-route/+page.svelte
725   	packages/kit/test/apps/basics/src/routes/encoded/endpoint/+server.js
726   	packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/+layout.svelte
727   	packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/+page.svelte
728   	packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[u+82d7]/+page.svelte
729   	packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[u+d83e][u+dd2a]/+page.svelte
730   	packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x+23]/+page.svelte
731   	packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x+25]/+page.svelte
732   	packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x+2f]/+page.svelte
733   	packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x+3a]-[x+29]/+page.svelte
734   	packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x+3c]/+page.svelte
735   	packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x+3f]/+page.svelte
736   	packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x][x+3c][y]/+page.svelte
737   	packages/kit/test/apps/basics/src/routes/encoded/+page.svelte
738   	packages/kit/test/apps/basics/src/routes/encoded/redirected/+page.js
739   	packages/kit/test/apps/basics/src/routes/encoded/redirected/+page.svelte
740   	packages/kit/test/apps/basics/src/routes/encoded/redirect/+page.js
741   	packages/kit/test/apps/basics/src/routes/encoded/redirect/+page.svelte
742   	packages/kit/test/apps/basics/src/routes/encoded/[slug]/+page.js
743   	packages/kit/test/apps/basics/src/routes/encoded/[slug]/+page.svelte
744   	packages/kit/test/apps/basics/src/routes/encoded/@[username]/+page.svelte
745   	packages/kit/test/apps/basics/src/routes/encoded/反应/+page.js
746   	packages/kit/test/apps/basics/src/routes/encoded/反应/+page.svelte
747   	packages/kit/test/apps/basics/src/routes/encoded/苗条/+page.js
748   	packages/kit/test/apps/basics/src/routes/encoded/苗条/+page.svelte
749   	packages/kit/test/apps/basics/src/routes/endpoint-input/sha256/+server.js
750   	packages/kit/test/apps/basics/src/routes/endpoint-output/body/+server.js
751   	packages/kit/test/apps/basics/src/routes/endpoint-output/fallback/+server.js
752   	packages/kit/test/apps/basics/src/routes/endpoint-output/head-handler/+page.svelte
753   	packages/kit/test/apps/basics/src/routes/endpoint-output/head-handler/+server.js
754   	packages/kit/test/apps/basics/src/routes/endpoint-output/head-write-error/+server.js
755   	packages/kit/test/apps/basics/src/routes/endpoint-output/+server.js
756   	packages/kit/test/apps/basics/src/routes/endpoint-output/stream/+server.js
757   	packages/kit/test/apps/basics/src/routes/endpoint-output/stream-throw-error/+server.js
758   	packages/kit/test/apps/basics/src/routes/endpoint-output/stream-typeerror/+server.js
759   	packages/kit/test/apps/basics/src/routes/env/includes/+page.server.js
760   	packages/kit/test/apps/basics/src/routes/env/includes/+page.svelte
761   	packages/kit/test/apps/basics/src/routes/env/+page.svelte
762   	packages/kit/test/apps/basics/src/routes/errors/clientside/+page.svelte
763   	packages/kit/test/apps/basics/src/routes/errors/endpoint.json/+server.js
764   	packages/kit/test/apps/basics/src/routes/errors/endpoint/+page.js
765   	packages/kit/test/apps/basics/src/routes/errors/endpoint/+page.svelte
766   	packages/kit/test/apps/basics/src/routes/errors/endpoint-shadow-not-ok/+page.server.js
767   	packages/kit/test/apps/basics/src/routes/errors/endpoint-shadow-not-ok/+page.svelte
768   	packages/kit/test/apps/basics/src/routes/errors/endpoint-shadow/+page.server.js
769   	packages/kit/test/apps/basics/src/routes/errors/endpoint-shadow/+page.svelte
770   	packages/kit/test/apps/basics/src/routes/errors/endpoint-throw-error/+server.js
771   	packages/kit/test/apps/basics/src/routes/errors/endpoint-throw-redirect/+server.js
772   	packages/kit/test/apps/basics/src/routes/errors/error-html/make-root-fail/+server.js
773   	packages/kit/test/apps/basics/src/routes/errors/error-html/+page.svelte
774   	packages/kit/test/apps/basics/src/routes/errors/error-in-handle/+page.svelte
775   	packages/kit/test/apps/basics/src/routes/errors/error-in-layout/+page.svelte
776   	packages/kit/test/apps/basics/src/routes/errors/init-error-endpoint/+server.js
777   	packages/kit/test/apps/basics/src/routes/errors/invalid-load-response/+page.js
778   	packages/kit/test/apps/basics/src/routes/errors/invalid-load-response/+page.svelte
779   	packages/kit/test/apps/basics/src/routes/errors/invalid-route-response/+server.js
780   	packages/kit/test/apps/basics/src/routes/errors/invalid-server-load-response/+page.server.js
781   	packages/kit/test/apps/basics/src/routes/errors/invalid-server-load-response/+page.svelte
782   	packages/kit/test/apps/basics/src/routes/errors/+layout.js
783   	packages/kit/test/apps/basics/src/routes/errors/+layout.svelte
784   	packages/kit/test/apps/basics/src/routes/errors/load-client/+page.js
785   	packages/kit/test/apps/basics/src/routes/errors/load-client/+page.svelte
786   	packages/kit/test/apps/basics/src/routes/errors/load-error-client/+page.js
787   	packages/kit/test/apps/basics/src/routes/errors/load-error-client/+page.svelte
788   	packages/kit/test/apps/basics/src/routes/errors/load-error-server/+page.js
789   	packages/kit/test/apps/basics/src/routes/errors/load-error-server/+page.svelte
790   	packages/kit/test/apps/basics/src/routes/errors/load-error-string-server/+page.js
791   	packages/kit/test/apps/basics/src/routes/errors/load-error-string-server/+page.svelte
792   	packages/kit/test/apps/basics/src/routes/errors/load-server/+page.js
793   	packages/kit/test/apps/basics/src/routes/errors/load-server/+page.svelte
794   	packages/kit/test/apps/basics/src/routes/errors/load-status-without-error-client/+page.js
795   	packages/kit/test/apps/basics/src/routes/errors/load-status-without-error-client/+page.svelte
796   	packages/kit/test/apps/basics/src/routes/errors/missing-actions/+page.svelte
797   	packages/kit/test/apps/basics/src/routes/errors/module-scope-client/+page.svelte
798   	packages/kit/test/apps/basics/src/routes/errors/module-scope-server/+page.svelte
799   	packages/kit/test/apps/basics/src/routes/errors/nested-error-page/+error.svelte
800   	packages/kit/test/apps/basics/src/routes/errors/nested-error-page/nope/+page.js
801   	packages/kit/test/apps/basics/src/routes/errors/nested-error-page/nope/+page.svelte
802   	packages/kit/test/apps/basics/src/routes/errors/nested-error-page/+page.svelte
803   	packages/kit/test/apps/basics/src/routes/errors/page-endpoint/+error.svelte
804   	packages/kit/test/apps/basics/src/routes/errors/page-endpoint/get-explicit/+page.server.js
805   	packages/kit/test/apps/basics/src/routes/errors/page-endpoint/get-explicit/+page.svelte
806   	packages/kit/test/apps/basics/src/routes/errors/page-endpoint/get-implicit/+page.server.js
807   	packages/kit/test/apps/basics/src/routes/errors/page-endpoint/get-implicit/+page.svelte
808   	packages/kit/test/apps/basics/src/routes/errors/page-endpoint/+page.svelte
809   	packages/kit/test/apps/basics/src/routes/errors/page-endpoint/post-explicit/+page.server.js
810   	packages/kit/test/apps/basics/src/routes/errors/page-endpoint/post-explicit/+page.svelte
811   	packages/kit/test/apps/basics/src/routes/errors/page-endpoint/post-implicit/+page.server.js
812   	packages/kit/test/apps/basics/src/routes/errors/page-endpoint/post-implicit/+page.svelte
813   	packages/kit/test/apps/basics/src/routes/errors/page-endpoint/_shared.js
814   	packages/kit/test/apps/basics/src/routes/errors/serverside/+page.svelte
815   	packages/kit/test/apps/basics/src/routes/errors/stack-trace/_bad.js
816   	packages/kit/test/apps/basics/src/routes/errors/stack-trace/+page.svelte
817   	packages/kit/test/apps/basics/src/routes/+error.svelte
818   	packages/kit/test/apps/basics/src/routes/favicon.ico/+server.js
819   	packages/kit/test/apps/basics/src/routes/goto/+page.svelte
820   	packages/kit/test/apps/basics/src/routes/headers/class/+page.js
821   	packages/kit/test/apps/basics/src/routes/headers/class/+page.svelte
822   	packages/kit/test/apps/basics/src/routes/headers/echo/+server.js
823   	packages/kit/test/apps/basics/src/routes/headers/+page.svelte
824   	packages/kit/test/apps/basics/src/routes/headers/set-cookie/+layout.server.js
825   	packages/kit/test/apps/basics/src/routes/headers/set-cookie/+layout.svelte
826   	packages/kit/test/apps/basics/src/routes/headers/set-cookie/sub/+page.server.js
827   	packages/kit/test/apps/basics/src/routes/headers/set-cookie/sub/+page.svelte
828   	packages/kit/test/apps/basics/src/routes/iframes/nested/child/+page.svelte
829   	packages/kit/test/apps/basics/src/routes/iframes/nested/parent/+page.svelte
830   	packages/kit/test/apps/basics/src/routes/iframes/+page.svelte
831   	packages/kit/test/apps/basics/src/routes/immutable-headers/+page.js
832   	packages/kit/test/apps/basics/src/routes/immutable-headers/+server.js
833   	packages/kit/test/apps/basics/src/routes/imports/markdown/+page.svelte
834   	packages/kit/test/apps/basics/src/routes/imports/+page.svelte
835   	packages/kit/test/apps/basics/src/routes/index.css
836   	packages/kit/test/apps/basics/src/routes/interactivity/toggle-element/+page.svelte
837   	packages/kit/test/apps/basics/src/routes/keepfocus/+page.svelte
838   	packages/kit/test/apps/basics/src/routes/+layout.js
839   	packages/kit/test/apps/basics/src/routes/+layout.server.js
840   	packages/kit/test/apps/basics/src/routes/+layout.svelte
841   	packages/kit/test/apps/basics/src/routes/load/accumulated/+page.svelte
842   	packages/kit/test/apps/basics/src/routes/load/accumulated/without-page-data/+page.svelte
843   	packages/kit/test/apps/basics/src/routes/load/accumulated/with-page-data/+page.js
844   	packages/kit/test/apps/basics/src/routes/load/accumulated/with-page-data/+page.svelte
845   	packages/kit/test/apps/basics/src/routes/load/cache-control/bust/count/+server.js
846   	packages/kit/test/apps/basics/src/routes/load/cache-control/bust/increment/+server.js
847   	packages/kit/test/apps/basics/src/routes/load/cache-control/bust/+page.js
848   	packages/kit/test/apps/basics/src/routes/load/cache-control/bust/+page.svelte
849   	packages/kit/test/apps/basics/src/routes/load/cache-control/bust/state.js
850   	packages/kit/test/apps/basics/src/routes/load/cache-control/default/count/+server.js
851   	packages/kit/test/apps/basics/src/routes/load/cache-control/default/increment/+server.js
852   	packages/kit/test/apps/basics/src/routes/load/cache-control/default/+page.js
853   	packages/kit/test/apps/basics/src/routes/load/cache-control/default/+page.svelte
854   	packages/kit/test/apps/basics/src/routes/load/cache-control/default/state.js
855   	packages/kit/test/apps/basics/src/routes/load/cache-control/force/count/+server.js
856   	packages/kit/test/apps/basics/src/routes/load/cache-control/force/increment/+server.js
857   	packages/kit/test/apps/basics/src/routes/load/cache-control/force/+page.js
858   	packages/kit/test/apps/basics/src/routes/load/cache-control/force/+page.svelte
859   	packages/kit/test/apps/basics/src/routes/load/cache-control/force/state.js
860   	packages/kit/test/apps/basics/src/routes/load/change-detection/data.json/+server.js
861   	packages/kit/test/apps/basics/src/routes/load/change-detection/+layout.js
862   	packages/kit/test/apps/basics/src/routes/load/change-detection/+layout.svelte
863   	packages/kit/test/apps/basics/src/routes/load/change-detection/one/[x]/+page.js
864   	packages/kit/test/apps/basics/src/routes/load/change-detection/one/[x]/+page.svelte
865   	packages/kit/test/apps/basics/src/routes/load/change-detection/two/[y]/+page.js
866   	packages/kit/test/apps/basics/src/routes/load/change-detection/two/[y]/+page.svelte
867   	packages/kit/test/apps/basics/src/routes/load/devalue/+page.svelte
868   	packages/kit/test/apps/basics/src/routes/load/devalue/regex/+page.server.js
869   	packages/kit/test/apps/basics/src/routes/load/devalue/regex/+page.svelte
870   	packages/kit/test/apps/basics/src/routes/load/dynamic-import-styles/+page.js
871   	packages/kit/test/apps/basics/src/routes/load/dynamic-import-styles/+page.svelte
872   	packages/kit/test/apps/basics/src/routes/load/dynamic-import-styles/_/Thing.svelte
873   	packages/kit/test/apps/basics/src/routes/load/[dynamic].json/+server.js
874   	packages/kit/test/apps/basics/src/routes/load/[dynamic]/+page.js
875   	packages/kit/test/apps/basics/src/routes/load/[dynamic]/+page.svelte
876   	packages/kit/test/apps/basics/src/routes/load/fetch-arraybuffer-b64/data/+server.js
877   	packages/kit/test/apps/basics/src/routes/load/fetch-arraybuffer-b64/+page.js
878   	packages/kit/test/apps/basics/src/routes/load/fetch-arraybuffer-b64/+page.svelte
879   	packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/headers-diff/+page.js
880   	packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/headers-diff/+page.svelte
881   	packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/headers-diff/+server.js
882   	packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/load-data/+page.js
883   	packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/load-data/+page.svelte
884   	packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/load-data/+server.js
885   	packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/+page.svelte
886   	packages/kit/test/apps/basics/src/routes/load/fetch-credentialed.json/+server.js
887   	packages/kit/test/apps/basics/src/routes/load/fetch-credentialed/+page.js
888   	packages/kit/test/apps/basics/src/routes/load/fetch-credentialed/+page.svelte
889   	packages/kit/test/apps/basics/src/routes/load/fetch-external-no-cookies/+page.js
890   	packages/kit/test/apps/basics/src/routes/load/fetch-external-no-cookies/+page.svelte
891   	packages/kit/test/apps/basics/src/routes/load/fetch-origin-external/+page.js
892   	packages/kit/test/apps/basics/src/routes/load/fetch-origin-external/+page.svelte
893   	packages/kit/test/apps/basics/src/routes/load/fetch-origin-internal/+page.js
894   	packages/kit/test/apps/basics/src/routes/load/fetch-origin-internal/+page.svelte
895   	packages/kit/test/apps/basics/src/routes/load/fetch-origin-internal/resource/+server.js
896   	packages/kit/test/apps/basics/src/routes/load/fetch-relative.json/+server.js
897   	packages/kit/test/apps/basics/src/routes/load/fetch-relative/+page.js
898   	packages/kit/test/apps/basics/src/routes/load/fetch-relative/+page.svelte
899   	packages/kit/test/apps/basics/src/routes/load/fetch-request-headers/data/+server.js
900   	packages/kit/test/apps/basics/src/routes/load/fetch-request-headers/+page.js
901   	packages/kit/test/apps/basics/src/routes/load/fetch-request-headers/+page.svelte
902   	packages/kit/test/apps/basics/src/routes/load/fetch-request.json/+server.js
903   	packages/kit/test/apps/basics/src/routes/load/fetch-request/+page.js
904   	packages/kit/test/apps/basics/src/routes/load/fetch-request/+page.svelte
905   	packages/kit/test/apps/basics/src/routes/load/fetch-response-headers.json/+server.js
906   	packages/kit/test/apps/basics/src/routes/load/fetch-response-headers/+page.js
907   	packages/kit/test/apps/basics/src/routes/load/fetch-response-headers/+page.svelte
908   	packages/kit/test/apps/basics/src/routes/load/invalidation/depends/+page.js
909   	packages/kit/test/apps/basics/src/routes/load/invalidation/depends/+page.server.js
910   	packages/kit/test/apps/basics/src/routes/load/invalidation/depends/+page.svelte
911   	packages/kit/test/apps/basics/src/routes/load/invalidation/forced-goto/+layout.server.js
912   	packages/kit/test/apps/basics/src/routes/load/invalidation/forced-goto/+layout.svelte
913   	packages/kit/test/apps/basics/src/routes/load/invalidation/forced-goto/+page.server.js
914   	packages/kit/test/apps/basics/src/routes/load/invalidation/forced-goto/+page.svelte
915   	packages/kit/test/apps/basics/src/routes/load/invalidation/forced-goto/state.js
916   	packages/kit/test/apps/basics/src/routes/load/invalidation/forced/+layout.server.js
917   	packages/kit/test/apps/basics/src/routes/load/invalidation/forced/+layout.svelte
918   	packages/kit/test/apps/basics/src/routes/load/invalidation/forced/+page.server.js
919   	packages/kit/test/apps/basics/src/routes/load/invalidation/forced/+page.svelte
920   	packages/kit/test/apps/basics/src/routes/load/invalidation/forced/state.js
921   	packages/kit/test/apps/basics/src/routes/load/invalidation/invalidate-then-goto/+layout.server.js
922   	packages/kit/test/apps/basics/src/routes/load/invalidation/invalidate-then-goto/+page.server.js
923   	packages/kit/test/apps/basics/src/routes/load/invalidation/invalidate-then-goto/+page.svelte
924   	packages/kit/test/apps/basics/src/routes/load/invalidation/multiple-batched/+page.js
925   	packages/kit/test/apps/basics/src/routes/load/invalidation/multiple-batched/+page.svelte
926   	packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/+layout.js
927   	packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/+layout.svelte
928   	packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/+page.js
929   	packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/+page.svelte
930   	packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/redirect/+page.js
931   	packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/redirect/+page.svelte
932   	packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/state.js
933   	packages/kit/test/apps/basics/src/routes/load/invalidation/params/[a]/[b]/+page.svelte
934   	packages/kit/test/apps/basics/src/routes/load/invalidation/params/[a]/+page.svelte
935   	packages/kit/test/apps/basics/src/routes/load/invalidation/params/+layout.js
936   	packages/kit/test/apps/basics/src/routes/load/invalidation/params/+layout.svelte
937   	packages/kit/test/apps/basics/src/routes/load/invalidation/params/+page.svelte
938   	packages/kit/test/apps/basics/src/routes/load/invalidation/route/server/a/+page.svelte
939   	packages/kit/test/apps/basics/src/routes/load/invalidation/route/server/b/+page.svelte
940   	packages/kit/test/apps/basics/src/routes/load/invalidation/route/server/+layout.server.js
941   	packages/kit/test/apps/basics/src/routes/load/invalidation/route/server/+layout.svelte
942   	packages/kit/test/apps/basics/src/routes/load/invalidation/route/shared/a/+page.svelte
943   	packages/kit/test/apps/basics/src/routes/load/invalidation/route/shared/b/+page.svelte
944   	packages/kit/test/apps/basics/src/routes/load/invalidation/route/shared/+layout.js
945   	packages/kit/test/apps/basics/src/routes/load/invalidation/route/shared/+layout.svelte
946   	packages/kit/test/apps/basics/src/routes/load/invalidation/route/shared/[x]/+page.svelte
947   	packages/kit/test/apps/basics/src/routes/load/invalidation/search-params/server/+page.server.js
948   	packages/kit/test/apps/basics/src/routes/load/invalidation/search-params/server/+page.svelte
949   	packages/kit/test/apps/basics/src/routes/load/invalidation/search-params/universal/+page.js
950   	packages/kit/test/apps/basics/src/routes/load/invalidation/search-params/universal/+page.svelte
951   	packages/kit/test/apps/basics/src/routes/load/invalidation/server-fetch/count.json/+server.js
952   	packages/kit/test/apps/basics/src/routes/load/invalidation/server-fetch/+page.server.js
953   	packages/kit/test/apps/basics/src/routes/load/invalidation/server-fetch/+page.svelte
954   	packages/kit/test/apps/basics/src/routes/load/invalidation/url/+page.server.js
955   	packages/kit/test/apps/basics/src/routes/load/invalidation/url/+page.svelte
956   	packages/kit/test/apps/basics/src/routes/load/large-response/+page.js
957   	packages/kit/test/apps/basics/src/routes/load/large-response/+page.svelte
958   	packages/kit/test/apps/basics/src/routes/load/large-response/text.txt/+server.js
959   	packages/kit/test/apps/basics/src/routes/load/mutated-url/+page.js
960   	packages/kit/test/apps/basics/src/routes/load/mutated-url/+page.svelte
961   	packages/kit/test/apps/basics/src/routes/load/no-server-load/a/+page.server.js
962   	packages/kit/test/apps/basics/src/routes/load/no-server-load/a/+page.svelte
963   	packages/kit/test/apps/basics/src/routes/load/no-server-load/b/+page.server.js
964   	packages/kit/test/apps/basics/src/routes/load/no-server-load/b/+page.svelte
965   	packages/kit/test/apps/basics/src/routes/load/no-server-load/+layout.svelte
966   	packages/kit/test/apps/basics/src/routes/load/+page.js
967   	packages/kit/test/apps/basics/src/routes/load/+page.svelte
968   	packages/kit/test/apps/basics/src/routes/load/parent/server/+layout.server.js
969   	packages/kit/test/apps/basics/src/routes/load/parent/server/+layout.svelte
970   	packages/kit/test/apps/basics/src/routes/load/parent/server/[x]/+layout.server.js
971   	packages/kit/test/apps/basics/src/routes/load/parent/server/[x]/+layout.svelte
972   	packages/kit/test/apps/basics/src/routes/load/parent/server/[x]/[y]/+layout.svelte
973   	packages/kit/test/apps/basics/src/routes/load/parent/server/[x]/[y]/[z]/+page.server.js
974   	packages/kit/test/apps/basics/src/routes/load/parent/server/[x]/[y]/[z]/+page.svelte
975   	packages/kit/test/apps/basics/src/routes/load/parent/shared/+layout.js
976   	packages/kit/test/apps/basics/src/routes/load/parent/shared/+layout.svelte
977   	packages/kit/test/apps/basics/src/routes/load/parent/shared/[x]/+layout.js
978   	packages/kit/test/apps/basics/src/routes/load/parent/shared/[x]/+layout.svelte
979   	packages/kit/test/apps/basics/src/routes/load/parent/shared/[x]/[y]/+layout.svelte
980   	packages/kit/test/apps/basics/src/routes/load/parent/shared/[x]/[y]/[z]/+page.js
981   	packages/kit/test/apps/basics/src/routes/load/parent/shared/[x]/[y]/[z]/+page.svelte
982   	packages/kit/test/apps/basics/src/routes/load/props/+page.js
983   	packages/kit/test/apps/basics/src/routes/load/props/+page.svelte
984   	packages/kit/test/apps/basics/src/routes/load/raw-body/dataview/+page.js
985   	packages/kit/test/apps/basics/src/routes/load/raw-body/dataview/+page.svelte
986   	packages/kit/test/apps/basics/src/routes/load/raw-body.json/+server.js
987   	packages/kit/test/apps/basics/src/routes/load/raw-body/+page.svelte
988   	packages/kit/test/apps/basics/src/routes/load/raw-body/string/+page.js
989   	packages/kit/test/apps/basics/src/routes/load/raw-body/string/+page.svelte
990   	packages/kit/test/apps/basics/src/routes/load/raw-body/uint8array/+page.js
991   	packages/kit/test/apps/basics/src/routes/load/raw-body/uint8array/+page.svelte
992   	packages/kit/test/apps/basics/src/routes/load/relay.json/+server.js
993   	packages/kit/test/apps/basics/src/routes/load/relay/+page.js
994   	packages/kit/test/apps/basics/src/routes/load/relay/+page.svelte
995   	packages/kit/test/apps/basics/src/routes/load/serialization/fetched-from-server.json/+server.js
996   	packages/kit/test/apps/basics/src/routes/load/serialization/fetched-from-shared.json/+server.js
997   	packages/kit/test/apps/basics/src/routes/load/serialization/+page.js
998   	packages/kit/test/apps/basics/src/routes/load/serialization/+page.server.js
999   	packages/kit/test/apps/basics/src/routes/load/serialization/+page.svelte
1000  	packages/kit/test/apps/basics/src/routes/load/serialization-post.json/+server.js
1001  	packages/kit/test/apps/basics/src/routes/load/serialization-post/+page.js
1002  	packages/kit/test/apps/basics/src/routes/load/serialization-post/+page.svelte
1003  	packages/kit/test/apps/basics/src/routes/load/serialization-post-request/+page.js
1004  	packages/kit/test/apps/basics/src/routes/load/serialization-post-request/+page.svelte
1005  	packages/kit/test/apps/basics/src/routes/load/server-data-nostore/+page.server.js
1006  	packages/kit/test/apps/basics/src/routes/load/server-data-nostore/+page.svelte
1007  	packages/kit/test/apps/basics/src/routes/load/server-data-reuse/no-load/+page.svelte
1008  	packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-changing-parent/+layout.server.js
1009  	packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-changing-parent/+layout.svelte
1010  	packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-changing-parent/no-load/+page.svelte
1011  	packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-changing-parent/with-server-load/+page.server.js
1012  	packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-changing-parent/with-server-load/+page.svelte
1013  	packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-server-load/+page.server.js
1014  	packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-server-load/+page.svelte
1015  	packages/kit/test/apps/basics/src/routes/load/server-fetch-request/+page.js
1016  	packages/kit/test/apps/basics/src/routes/load/server-fetch-request/+page.svelte
1017  	packages/kit/test/apps/basics/src/routes/load/set-cookie-fetch/a.json/+server.js
1018  	packages/kit/test/apps/basics/src/routes/load/set-cookie-fetch/b.json/+server.js
1019  	packages/kit/test/apps/basics/src/routes/load/set-cookie-fetch/+page.js
1020  	packages/kit/test/apps/basics/src/routes/load/set-cookie-fetch/+page.svelte
1021  	packages/kit/test/apps/basics/src/routes/load/static-file-with-hash/+page.js
1022  	packages/kit/test/apps/basics/src/routes/load/static-file-with-hash/+page.svelte
1023  	packages/kit/test/apps/basics/src/routes/load/unchanged/isolated/[slug]/+page.server.js
1024  	packages/kit/test/apps/basics/src/routes/load/unchanged/isolated/[slug]/+page.svelte
1025  	packages/kit/test/apps/basics/src/routes/load/unchanged/+layout.server.js
1026  	packages/kit/test/apps/basics/src/routes/load/unchanged/+layout.svelte
1027  	packages/kit/test/apps/basics/src/routes/load/unchanged/+page.svelte
1028  	packages/kit/test/apps/basics/src/routes/load/unchanged-parent/+layout.server.js
1029  	packages/kit/test/apps/basics/src/routes/load/unchanged-parent/+layout.svelte
1030  	packages/kit/test/apps/basics/src/routes/load/unchanged-parent/+page.svelte
1031  	packages/kit/test/apps/basics/src/routes/load/unchanged-parent/state.js
1032  	packages/kit/test/apps/basics/src/routes/load/unchanged-parent/uses-parent/[slug]/+page.server.js
1033  	packages/kit/test/apps/basics/src/routes/load/unchanged-parent/uses-parent/[slug]/+page.svelte
1034  	packages/kit/test/apps/basics/src/routes/load/unchanged/state.js
1035  	packages/kit/test/apps/basics/src/routes/load/url-hash/+page.js
1036  	packages/kit/test/apps/basics/src/routes/load/url-hash/+page.svelte
1037  	packages/kit/test/apps/basics/src/routes/load/url-query-param/+page.js
1038  	packages/kit/test/apps/basics/src/routes/load/url-query-param/+page.server.js
1039  	packages/kit/test/apps/basics/src/routes/load/url-query-param/+page.svelte
1040  	packages/kit/test/apps/basics/src/routes/load/url-to-string/+page.js
1041  	packages/kit/test/apps/basics/src/routes/load/url-to-string/+page.svelte
1042  	packages/kit/test/apps/basics/src/routes/load/window-fetch/correct/+page.js
1043  	packages/kit/test/apps/basics/src/routes/load/window-fetch/correct/+page.svelte
1044  	packages/kit/test/apps/basics/src/routes/load/window-fetch/data.json/+server.js
1045  	packages/kit/test/apps/basics/src/routes/load/window-fetch/incorrect/+page.js
1046  	packages/kit/test/apps/basics/src/routes/load/window-fetch/incorrect/+page.svelte
1047  	packages/kit/test/apps/basics/src/routes/load/window-fetch/outside-load/+page.svelte
1048  	packages/kit/test/apps/basics/src/routes/load/window-fetch/patching/+page.js
1049  	packages/kit/test/apps/basics/src/routes/load/window-fetch/patching/+page.svelte
1050  	packages/kit/test/apps/basics/src/routes/navigation-lifecycle/after-navigate/a/+page.svelte
1051  	packages/kit/test/apps/basics/src/routes/navigation-lifecycle/after-navigate/b/+page.svelte
1052  	packages/kit/test/apps/basics/src/routes/navigation-lifecycle/before-navigate/a/+page.svelte
1053  	packages/kit/test/apps/basics/src/routes/navigation-lifecycle/before-navigate/hash-links/+page.svelte
1054  	packages/kit/test/apps/basics/src/routes/navigation-lifecycle/before-navigate/prevent-navigation/+page.svelte
1055  	packages/kit/test/apps/basics/src/routes/navigation-lifecycle/before-navigate/redirect/+page.js
1056  	packages/kit/test/apps/basics/src/routes/navigation-lifecycle/on-navigate/[x]/+page.svelte
1057  	packages/kit/test/apps/basics/src/routes/nested-layout/error/+page.js
1058  	packages/kit/test/apps/basics/src/routes/nested-layout/error/+page.svelte
1059  	packages/kit/test/apps/basics/src/routes/nested-layout/foo/bar/+error.svelte
1060  	packages/kit/test/apps/basics/src/routes/nested-layout/foo/bar/+layout.svelte
1061  	packages/kit/test/apps/basics/src/routes/nested-layout/foo/bar/nope/+page.js
1062  	packages/kit/test/apps/basics/src/routes/nested-layout/foo/bar/nope/+page.svelte
1063  	packages/kit/test/apps/basics/src/routes/nested-layout/foo/baz/+page.svelte
1064  	packages/kit/test/apps/basics/src/routes/nested-layout/foo/+layout.svelte
1065  	packages/kit/test/apps/basics/src/routes/nested-layout/+layout.svelte
1066  	packages/kit/test/apps/basics/src/routes/nested-layout/+page.svelte
1067  	packages/kit/test/apps/basics/src/routes/nested-layout/reset/+layout@.svelte
1068  	packages/kit/test/apps/basics/src/routes/nested-layout/reset/+page.svelte
1069  	packages/kit/test/apps/basics/src/routes/no-csr/data.json/+server.js
1070  	packages/kit/test/apps/basics/src/routes/no-csr/+page.js
1071  	packages/kit/test/apps/basics/src/routes/no-csr/+page.svelte
1072  	packages/kit/test/apps/basics/src/routes/no-ssr/browser-only-global/+page.svelte
1073  	packages/kit/test/apps/basics/src/routes/no-ssr/+layout.js
1074  	packages/kit/test/apps/basics/src/routes/no-ssr/+layout.svelte
1075  	packages/kit/test/apps/basics/src/routes/no-ssr/margin/+page.svelte
1076  	packages/kit/test/apps/basics/src/routes/no-ssr/other/+page.svelte
1077  	packages/kit/test/apps/basics/src/routes/no-ssr/+page.svelte
1078  	packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/layout/inherit/+page.svelte
1079  	packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/layout/+layout.js
1080  	packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/layout/+layout.svelte
1081  	packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/layout/overwrite/+page.js
1082  	packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/layout/overwrite/+page.svelte
1083  	packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/+page.js
1084  	packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/+page.svelte
1085  	packages/kit/test/apps/basics/src/routes/origin/+page.svelte
1086  	packages/kit/test/apps/basics/src/routes/package.json/+server.js
1087  	packages/kit/test/apps/basics/src/routes/+page.js
1088  	packages/kit/test/apps/basics/src/routes/+page.svelte
1089  	packages/kit/test/apps/basics/src/routes/paths/deeply/nested/+page.svelte
1090  	packages/kit/test/apps/basics/src/routes/paths/+page.svelte
1091  	packages/kit/test/apps/basics/src/routes/prerendering/env/dynamic/+page.svelte
1092  	packages/kit/test/apps/basics/src/routes/prerendering/env/+layout.svelte
1093  	packages/kit/test/apps/basics/src/routes/prerendering/env/prerendered/+page.js
1094  	packages/kit/test/apps/basics/src/routes/prerendering/env/prerendered/+page.svelte
1095  	packages/kit/test/apps/basics/src/routes/prerendering/+error.svelte
1096  	packages/kit/test/apps/basics/src/routes/prerendering/log-url/+page.js
1097  	packages/kit/test/apps/basics/src/routes/prerendering/log-url/+page.svelte
1098  	packages/kit/test/apps/basics/src/routes/prerendering/mutative-endpoint/+page.js
1099  	packages/kit/test/apps/basics/src/routes/prerendering/mutative-endpoint/+page.server.ts
1100  	packages/kit/test/apps/basics/src/routes/prerendering/mutative-endpoint/+page.svelte
1101  	packages/kit/test/apps/basics/src/routes/prerendering/no-ssr/+page.js
1102  	packages/kit/test/apps/basics/src/routes/prerendering/no-ssr/+page.svelte
1103  	packages/kit/test/apps/basics/src/routes/prerendering/prerendered-endpoint/api/+server.js
1104  	packages/kit/test/apps/basics/src/routes/prerendering/prerendered-endpoint/page/+page.server.js
1105  	packages/kit/test/apps/basics/src/routes/prerendering/prerendered-endpoint/page/+page.svelte
1106  	packages/kit/test/apps/basics/src/routes/prerendering/prerendered-endpoint/+page.svelte
1107  	packages/kit/test/apps/basics/src/routes/prerendering/prerendered-endpoint/proxy/+server.js
1108  	packages/kit/test/apps/basics/src/routes/query/echo/+page.js
1109  	packages/kit/test/apps/basics/src/routes/query/echo/+page.svelte
1110  	packages/kit/test/apps/basics/src/routes/query/echo/utils.js
1111  	packages/kit/test/apps/basics/src/routes/read-file/auto.txt
1112  	packages/kit/test/apps/basics/src/routes/read-file/+page.server.js
1113  	packages/kit/test/apps/basics/src/routes/read-file/+page.svelte
1114  	packages/kit/test/apps/basics/src/routes/read-file/url.txt
1115  	packages/kit/test/apps/basics/src/routes/redirect/a/+page.js
1116  	packages/kit/test/apps/basics/src/routes/redirect/a/+page.svelte
1117  	packages/kit/test/apps/basics/src/routes/redirect/b/+page.js
1118  	packages/kit/test/apps/basics/src/routes/redirect/b/+page.svelte
1119  	packages/kit/test/apps/basics/src/routes/redirect/c/+page.svelte
1120  	packages/kit/test/apps/basics/src/routes/redirect/in-handle/+page.server.js
1121  	packages/kit/test/apps/basics/src/routes/redirect/in-handle/+page.svelte
1122  	packages/kit/test/apps/basics/src/routes/redirect/loopy/a/+page.js
1123  	packages/kit/test/apps/basics/src/routes/redirect/loopy/a/+page.svelte
1124  	packages/kit/test/apps/basics/src/routes/redirect/loopy/b/+page.js
1125  	packages/kit/test/apps/basics/src/routes/redirect/loopy/b/+page.svelte
1126  	packages/kit/test/apps/basics/src/routes/redirect/missing-status/a/+page.js
1127  	packages/kit/test/apps/basics/src/routes/redirect/missing-status/a/+page.svelte
1128  	packages/kit/test/apps/basics/src/routes/redirect/missing-status/b/+page.js
1129  	packages/kit/test/apps/basics/src/routes/redirect/missing-status/b/+page.svelte
1130  	packages/kit/test/apps/basics/src/routes/redirect-on-load/+page.js
1131  	packages/kit/test/apps/basics/src/routes/redirect-on-load/+page.svelte
1132  	packages/kit/test/apps/basics/src/routes/redirect-on-load/redirected/+page.svelte
1133  	packages/kit/test/apps/basics/src/routes/redirect/+page.svelte
1134  	packages/kit/test/apps/basics/src/routes/reroute/basic/a/+page.svelte
1135  	packages/kit/test/apps/basics/src/routes/reroute/basic/b/+page.svelte
1136  	packages/kit/test/apps/basics/src/routes/reroute/basic/+page.svelte
1137  	packages/kit/test/apps/basics/src/routes/reroute/client-only-redirect/a/+page.svelte
1138  	packages/kit/test/apps/basics/src/routes/reroute/client-only-redirect/b/+page.svelte
1139  	packages/kit/test/apps/basics/src/routes/reroute/client-only-redirect/+page.js
1140  	packages/kit/test/apps/basics/src/routes/reroute/client-only-redirect/+page.svelte
1141  	packages/kit/test/apps/basics/src/routes/reroute/error-handling/client-error/+page.svelte
1142  	packages/kit/test/apps/basics/src/routes/reroute/error-handling/client-error-rewritten/+page.svelte
1143  	packages/kit/test/apps/basics/src/routes/reroute/error-handling/+page.svelte
1144  	packages/kit/test/apps/basics/src/routes/reroute/error-handling/server-error/+page.svelte
1145  	packages/kit/test/apps/basics/src/routes/reroute/external/+page.svelte
1146  	packages/kit/test/apps/basics/src/routes/reroute/preload-data/a/+page.js
1147  	packages/kit/test/apps/basics/src/routes/reroute/preload-data/b/+page.js
1148  	packages/kit/test/apps/basics/src/routes/reroute/preload-data/+page.svelte
1149  	packages/kit/test/apps/basics/src/routes/routing/ambiguous/[slug].json/+server.js
1150  	packages/kit/test/apps/basics/src/routes/routing/ambiguous/[slug]/+page.svelte
1151  	packages/kit/test/apps/basics/src/routes/routing/a/+page.svelte
1152  	packages/kit/test/apps/basics/src/routes/routing/b.json/+server.js
1153  	packages/kit/test/apps/basics/src/routes/routing/b/+page.js
1154  	packages/kit/test/apps/basics/src/routes/routing/b/+page.svelte
1155  	packages/kit/test/apps/basics/src/routes/routing/cancellation/a/+page.js
1156  	packages/kit/test/apps/basics/src/routes/routing/cancellation/a/+page.svelte
1157  	packages/kit/test/apps/basics/src/routes/routing/cancellation/b/+page.svelte
1158  	packages/kit/test/apps/basics/src/routes/routing/cancellation/+layout.svelte
1159  	packages/kit/test/apps/basics/src/routes/routing/cancellation/+page.svelte
1160  	packages/kit/test/apps/basics/src/routes/routing/client/bar/b/+page.svelte
1161  	packages/kit/test/apps/basics/src/routes/routing/client/bar/+page.svelte
1162  	packages/kit/test/apps/basics/src/routes/routing/client/foo/+page.svelte
1163  	packages/kit/test/apps/basics/src/routes/routing/const/+page.svelte
1164  	packages/kit/test/apps/basics/src/routes/routing/content-negotiation/+page.server.js
1165  	packages/kit/test/apps/basics/src/routes/routing/content-negotiation/+page.svelte
1166  	packages/kit/test/apps/basics/src/routes/routing/content-negotiation/+server.js
1167  	packages/kit/test/apps/basics/src/routes/routing/dirs/bar/[a]/+page.svelte
1168  	packages/kit/test/apps/basics/src/routes/routing/dirs/bar/+page.svelte
1169  	packages/kit/test/apps/basics/src/routes/routing/dirs/foo/[b]/+page.svelte
1170  	packages/kit/test/apps/basics/src/routes/routing/dirs/foo/+page.svelte
1171  	packages/kit/test/apps/basics/src/routes/routing/external-popstate/+page.svelte
1172  	packages/kit/test/apps/basics/src/routes/routing/form-get/+page.svelte
1173  	packages/kit/test/apps/basics/src/routes/routing/hashes/a/+page.svelte
1174  	packages/kit/test/apps/basics/src/routes/routing/hashes/b/+page.svelte
1175  	packages/kit/test/apps/basics/src/routes/routing/hashes/pagestore/+page.svelte
1176  	packages/kit/test/apps/basics/src/routes/routing/hashes/target/+page.svelte
1177  	packages/kit/test/apps/basics/src/routes/routing/link-outside-app-target/source/+page.svelte
1178  	packages/kit/test/apps/basics/src/routes/routing/link-outside-app-target/state.js
1179  	packages/kit/test/apps/basics/src/routes/routing/link-outside-app-target/target/+page.svelte
1180  	packages/kit/test/apps/basics/src/routes/routing/matched/[fallback]/+page.svelte
1181  	packages/kit/test/apps/basics/src/routes/routing/matched/+layout.svelte
1182  	packages/kit/test/apps/basics/src/routes/routing/matched/[letter=lowercase]/+page.svelte
1183  	packages/kit/test/apps/basics/src/routes/routing/matched/[letter=uppercase]/+page.svelte
1184  	packages/kit/test/apps/basics/src/routes/routing/matched/[number=numeric]/+page.svelte
1185  	packages/kit/test/apps/basics/src/routes/routing/matched/+page.svelte
1186  	packages/kit/test/apps/basics/src/routes/routing/missing-href/+page.svelte
1187  	packages/kit/test/apps/basics/src/routes/routing/+page.svelte
1188  	packages/kit/test/apps/basics/src/routes/routing/params-in-handle/[x]/+server.js
1189  	packages/kit/test/apps/basics/src/routes/routing/preloading/hash-route/+page.js
1190  	packages/kit/test/apps/basics/src/routes/routing/preloading/hash-route/+page.svelte
1191  	packages/kit/test/apps/basics/src/routes/routing/preloading/preloaded.json/+server.js
1192  	packages/kit/test/apps/basics/src/routes/routing/preloading/preloaded/+page.js
1193  	packages/kit/test/apps/basics/src/routes/routing/preloading/preloaded/+page.svelte
1194  	packages/kit/test/apps/basics/src/routes/routing/preloading/preload-error/+page.js
1195  	packages/kit/test/apps/basics/src/routes/routing/preloading/preload-error/+page.svelte
1196  	packages/kit/test/apps/basics/src/routes/routing/prerendered/+layout.js
1197  	packages/kit/test/apps/basics/src/routes/routing/prerendered/trailing-slash/always/+page.js
1198  	packages/kit/test/apps/basics/src/routes/routing/prerendered/trailing-slash/always/+page.svelte
1199  	packages/kit/test/apps/basics/src/routes/routing/prerendered/trailing-slash/ignore/+page.js
1200  	packages/kit/test/apps/basics/src/routes/routing/prerendered/trailing-slash/ignore/+page.svelte
1201  	packages/kit/test/apps/basics/src/routes/routing/prerendered/trailing-slash/never/+page.svelte
1202  	packages/kit/test/apps/basics/src/routes/routing/rest/complex/[...parts].json/+server.js
1203  	packages/kit/test/apps/basics/src/routes/routing/rest/complex/prefix-[...parts]/+page.js
1204  	packages/kit/test/apps/basics/src/routes/routing/rest/complex/prefix-[...parts]/+page.svelte
1205  	packages/kit/test/apps/basics/src/routes/routing/rest/non-greedy/[dynamic]-bar/[...rest]/+page.svelte
1206  	packages/kit/test/apps/basics/src/routes/routing/rest/non-greedy/foo/[...rest]/+page.svelte
1207  	packages/kit/test/apps/basics/src/routes/routing/rest/non-greedy/+layout.svelte
1208  	packages/kit/test/apps/basics/src/routes/routing/rest/non-greedy/+page.svelte
1209  	packages/kit/test/apps/basics/src/routes/routing/rest/path/[...ignored]/+page.js
1210  	packages/kit/test/apps/basics/src/routes/routing/rest/path/[...ignored]/+page.svelte
1211  	packages/kit/test/apps/basics/src/routes/routing/rest/path/+layout.svelte
1212  	packages/kit/test/apps/basics/src/routes/routing/rest/[...rest]/deep.json/+server.js
1213  	packages/kit/test/apps/basics/src/routes/routing/rest/[...rest]/deep/+page.js
1214  	packages/kit/test/apps/basics/src/routes/routing/rest/[...rest]/deep/+page.svelte
1215  	packages/kit/test/apps/basics/src/routes/routing/rest/[...rest]/+page.js
1216  	packages/kit/test/apps/basics/src/routes/routing/rest/[...rest]/+page.svelte
1217  	packages/kit/test/apps/basics/src/routes/routing/route-id/+page.svelte
1218  	packages/kit/test/apps/basics/src/routes/routing/route-id/[x]/+page.js
1219  	packages/kit/test/apps/basics/src/routes/routing/route-id/[x]/+page.svelte
1220  	packages/kit/test/apps/basics/src/routes/routing/shadow-dom/+page.svelte
1221  	packages/kit/test/apps/basics/src/routes/routing/skipped/[one]/[two]/+page.js
1222  	packages/kit/test/apps/basics/src/routes/routing/skipped/[one]/[two]/+page.svelte
1223  	packages/kit/test/apps/basics/src/routes/routing/slashes/+page.svelte
1224  	packages/kit/test/apps/basics/src/routes/routing/[slug]/+page.svelte
1225  	packages/kit/test/apps/basics/src/routes/routing/split-params/[a]-[b]/+page.svelte
1226  	packages/kit/test/apps/basics/src/routes/routing/split-params/+page.svelte
1227  	packages/kit/test/apps/basics/src/routes/routing/symlink-to/+page.svelte
1228  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash/always/+page.js
1229  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash/always/+page.svelte
1230  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash/ignore/+page.js
1231  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash/ignore/+page.svelte
1232  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash/+layout.js
1233  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash/+layout.svelte
1234  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash/never/+page.svelte
1235  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash/+page.svelte
1236  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/always/+page.server.js
1237  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/always/+page.svelte
1238  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/ignore/+page.server.js
1239  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/ignore/+page.svelte
1240  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/+layout.server.js
1241  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/+layout.svelte
1242  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/never/+page.svelte
1243  	packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/+page.svelte
1244  	packages/kit/test/apps/basics/src/routes/scroll/cross-document/a/+page.svelte
1245  	packages/kit/test/apps/basics/src/routes/scroll/cross-document/b/+page.svelte
1246  	packages/kit/test/apps/basics/src/routes/scroll/cross-document/c/+page.svelte
1247  	packages/kit/test/apps/basics/src/routes/scroll/push-state/a/+page.svelte
1248  	packages/kit/test/apps/basics/src/routes/scroll/push-state/+page.svelte
1249  	packages/kit/test/apps/basics/src/routes/scroll/top/+page.svelte
1250  	packages/kit/test/apps/basics/src/routes/selection/a/+page.svelte
1251  	packages/kit/test/apps/basics/src/routes/selection/b/+page.svelte
1252  	packages/kit/test/apps/basics/src/routes/selection/+layout.svelte
1253  	packages/kit/test/apps/basics/src/routes/set-cookie/+server.js
1254  	packages/kit/test/apps/basics/src/routes/shadowed/dynamic/[slug]/+page.server.js
1255  	packages/kit/test/apps/basics/src/routes/shadowed/dynamic/[slug]/+page.svelte
1256  	packages/kit/test/apps/basics/src/routes/shadowed/error-get/+page.server.js
1257  	packages/kit/test/apps/basics/src/routes/shadowed/error-get/+page.svelte
1258  	packages/kit/test/apps/basics/src/routes/shadowed/error-post/+page.server.js
1259  	packages/kit/test/apps/basics/src/routes/shadowed/error-post/+page.svelte
1260  	packages/kit/test/apps/basics/src/routes/shadowed/missing-get/+page.server.js
1261  	packages/kit/test/apps/basics/src/routes/shadowed/missing-get/+page.svelte
1262  	packages/kit/test/apps/basics/src/routes/shadowed/no-get/+page.server.js
1263  	packages/kit/test/apps/basics/src/routes/shadowed/no-get/+page.svelte
1264  	packages/kit/test/apps/basics/src/routes/shadowed/+page.svelte
1265  	packages/kit/test/apps/basics/src/routes/shadowed/parent/+layout.server.js
1266  	packages/kit/test/apps/basics/src/routes/shadowed/parent/+layout.svelte
1267  	packages/kit/test/apps/basics/src/routes/shadowed/parent/+page.server.js
1268  	packages/kit/test/apps/basics/src/routes/shadowed/parent/+page.svelte
1269  	packages/kit/test/apps/basics/src/routes/shadowed/parent/sub/+page.server.js
1270  	packages/kit/test/apps/basics/src/routes/shadowed/parent/sub/+page.svelte
1271  	packages/kit/test/apps/basics/src/routes/shadowed/post-success-redirect/+page.server.js
1272  	packages/kit/test/apps/basics/src/routes/shadowed/post-success-redirect/+page.svelte
1273  	packages/kit/test/apps/basics/src/routes/shadowed/post-success-redirect/redirected/+page.svelte
1274  	packages/kit/test/apps/basics/src/routes/shadowed/redirect/[a]/+page.server.js
1275  	packages/kit/test/apps/basics/src/routes/shadowed/redirect/[a]/+page.svelte
1276  	packages/kit/test/apps/basics/src/routes/shadowed/redirect/b/+page.svelte
1277  	packages/kit/test/apps/basics/src/routes/shadowed/redirected/+page.server.js
1278  	packages/kit/test/apps/basics/src/routes/shadowed/redirected/+page.svelte
1279  	packages/kit/test/apps/basics/src/routes/shadowed/redirect-get/+page.server.js
1280  	packages/kit/test/apps/basics/src/routes/shadowed/redirect-get/+page.svelte
1281  	packages/kit/test/apps/basics/src/routes/shadowed/redirect-get-with-cookie-from-fetch/endpoint/+server.js
1282  	packages/kit/test/apps/basics/src/routes/shadowed/redirect-get-with-cookie-from-fetch/+page.js
1283  	packages/kit/test/apps/basics/src/routes/shadowed/redirect-get-with-cookie-from-fetch/+page.svelte
1284  	packages/kit/test/apps/basics/src/routes/shadowed/redirect-get-with-cookie/+page.server.js
1285  	packages/kit/test/apps/basics/src/routes/shadowed/redirect-get-with-cookie/+page.svelte
1286  	packages/kit/test/apps/basics/src/routes/shadowed/redirect/+page.svelte
1287  	packages/kit/test/apps/basics/src/routes/shadowed/redirect-post/+page.server.js
1288  	packages/kit/test/apps/basics/src/routes/shadowed/redirect-post/+page.svelte
1289  	packages/kit/test/apps/basics/src/routes/shadowed/redirect-post-with-cookie/+page.server.js
1290  	packages/kit/test/apps/basics/src/routes/shadowed/redirect-post-with-cookie/+page.svelte
1291  	packages/kit/test/apps/basics/src/routes/shadowed/same-render-entry/+page.svelte
1292  	packages/kit/test/apps/basics/src/routes/shadowed/same-render/+page.server.js
1293  	packages/kit/test/apps/basics/src/routes/shadowed/same-render/+page.svelte
1294  	packages/kit/test/apps/basics/src/routes/shadowed/serialization/+page.server.js
1295  	packages/kit/test/apps/basics/src/routes/shadowed/serialization/+page.svelte
1296  	packages/kit/test/apps/basics/src/routes/shadowed/simple/+page.server.js
1297  	packages/kit/test/apps/basics/src/routes/shadowed/simple/+page.svelte
1298  	packages/kit/test/apps/basics/src/routes/shadowed/simple/post/+page.server.js
1299  	packages/kit/test/apps/basics/src/routes/shadowed/simple/post/+page.svelte
1300  	packages/kit/test/apps/basics/src/routes/shallow-routing/push-state/a/+page.svelte
1301  	packages/kit/test/apps/basics/src/routes/shallow-routing/push-state/b/+page.svelte
1302  	packages/kit/test/apps/basics/src/routes/shallow-routing/push-state/+layout.svelte
1303  	packages/kit/test/apps/basics/src/routes/shallow-routing/push-state/+page.js
1304  	packages/kit/test/apps/basics/src/routes/shallow-routing/push-state/+page.svelte
1305  	packages/kit/test/apps/basics/src/routes/shallow-routing/replace-state/a/+page.svelte
1306  	packages/kit/test/apps/basics/src/routes/shallow-routing/replace-state/b/+page.svelte
1307  	packages/kit/test/apps/basics/src/routes/shallow-routing/replace-state/+layout.svelte
1308  	packages/kit/test/apps/basics/src/routes/shallow-routing/replace-state/+page.svelte
1309  	packages/kit/test/apps/basics/src/routes/snapshot/a/+page.svelte
1310  	packages/kit/test/apps/basics/src/routes/snapshot/b/+page.svelte
1311  	packages/kit/test/apps/basics/src/routes/snapshot/c/+page.svelte
1312  	packages/kit/test/apps/basics/src/routes/snapshot/+layout.svelte
1313  	packages/kit/test/apps/basics/src/routes/src/[...anything]/+server.js
1314  	packages/kit/test/apps/basics/src/routes/static/+page.svelte
1315  	packages/kit/test/apps/basics/src/routes/store/client-access/+page.svelte
1316  	packages/kit/test/apps/basics/src/routes/store/data/+error.svelte
1317  	packages/kit/test/apps/basics/src/routes/store/data/foo/+page.js
1318  	packages/kit/test/apps/basics/src/routes/store/data/foo/+page.svelte
1319  	packages/kit/test/apps/basics/src/routes/store/data/[item]/+page.js
1320  	packages/kit/test/apps/basics/src/routes/store/data/[item]/+page.svelte
1321  	packages/kit/test/apps/basics/src/routes/store/data/+layout.js
1322  	packages/kit/test/apps/basics/src/routes/store/data/+layout.svelte
1323  	packages/kit/test/apps/basics/src/routes/store/data/store-update/a/+page.svelte
1324  	packages/kit/test/apps/basics/src/routes/store/data/store-update/b/+page.svelte
1325  	packages/kit/test/apps/basics/src/routes/store/data/store-update/+layout.svelte
1326  	packages/kit/test/apps/basics/src/routes/store/data/store-update/same-keys/+layout.js
1327  	packages/kit/test/apps/basics/src/routes/store/data/store-update/same-keys/+page.svelte
1328  	packages/kit/test/apps/basics/src/routes/store/data/store-update/same-keys/same-deep/nested/+page.js
1329  	packages/kit/test/apps/basics/src/routes/store/data/store-update/same-keys/same-deep/nested/+page.svelte
1330  	packages/kit/test/apps/basics/src/routes/store/data/store-update/same-keys/same/+page.js
1331  	packages/kit/test/apps/basics/src/routes/store/data/store-update/same-keys/same/+page.svelte
1332  	packages/kit/test/apps/basics/src/routes/store/navigating/a/+page.js
1333  	packages/kit/test/apps/basics/src/routes/store/navigating/a/+page.svelte
1334  	packages/kit/test/apps/basics/src/routes/store/navigating/b/+page.js
1335  	packages/kit/test/apps/basics/src/routes/store/navigating/b/+page.svelte
1336  	packages/kit/test/apps/basics/src/routes/store/navigating/c/+page.js
1337  	packages/kit/test/apps/basics/src/routes/store/navigating/c/+page.svelte
1338  	packages/kit/test/apps/basics/src/routes/store/navigating/+layout.svelte
1339  	packages/kit/test/apps/basics/src/routes/streaming/+page.svelte
1340  	packages/kit/test/apps/basics/src/routes/streaming/server-error/+page.server.js
1341  	packages/kit/test/apps/basics/src/routes/streaming/server-error/+page.svelte
1342  	packages/kit/test/apps/basics/src/routes/streaming/server/+page.server.js
1343  	packages/kit/test/apps/basics/src/routes/streaming/server/+page.svelte
1344  	packages/kit/test/apps/basics/src/routes/streaming/universal/+page.js
1345  	packages/kit/test/apps/basics/src/routes/streaming/universal/+page.svelte
1346  	packages/kit/test/apps/basics/src/routes/transform-page-chunk/+page.svelte
1347  	packages/kit/test/apps/basics/src/routes/unsafe-replacement/+page.js
1348  	packages/kit/test/apps/basics/src/routes/unsafe-replacement/+page.svelte
1349  	packages/kit/test/apps/basics/src/routes/untrack/server/+layout.server.js
1350  	packages/kit/test/apps/basics/src/routes/untrack/server/[x]/+page.server.js
1351  	packages/kit/test/apps/basics/src/routes/untrack/server/[x]/+page.svelte
1352  	packages/kit/test/apps/basics/src/routes/untrack/universal/+layout.js
1353  	packages/kit/test/apps/basics/src/routes/untrack/universal/[x]/+page.js
1354  	packages/kit/test/apps/basics/src/routes/untrack/universal/[x]/+page.svelte
1355  	packages/kit/test/apps/basics/src/routes/use-action/focus-and-scroll/+page.svelte
1356  	packages/kit/test/apps/basics/src/routes/use-action/+page.svelte
1357  	packages/kit/test/apps/basics/src/routes/xss.json/+server.js
1358  	packages/kit/test/apps/basics/src/routes/xss/+page.js
1359  	packages/kit/test/apps/basics/src/routes/xss/+page.svelte
1360  	packages/kit/test/apps/basics/src/routes/xss/[path]/+page.svelte
1361  	packages/kit/test/apps/basics/src/routes/xss/query/+page.js
1362  	packages/kit/test/apps/basics/src/routes/xss/query/+page.svelte
1363  	packages/kit/test/apps/basics/src/routes/xss/query/utils.js
1364  	packages/kit/test/apps/basics/src/routes/xss/shadow/+page.server.js
1365  	packages/kit/test/apps/basics/src/routes/xss/shadow/+page.svelte
1366  	packages/kit/test/apps/basics/src/service-worker.js
1367  	packages/kit/test/apps/basics/static/empty.js
1368  	packages/kit/test/apps/basics/static/load/assets/a#b.txt
1369  	packages/kit/test/apps/basics/static/load/foo.json
1370  	packages/kit/test/apps/basics/static/static.json
1371  	packages/kit/test/apps/basics/static/subdirectory/static.json
1372  	packages/kit/test/apps/basics/static/symlink-to/hello.txt
1373  	packages/kit/test/apps/basics/svelte.config.js
1374  	packages/kit/test/apps/basics/test/client.test.js
1375  	packages/kit/test/apps/basics/test/cross-platform/client.test.js
1376  	packages/kit/test/apps/basics/test/cross-platform/server.test.js
1377  	packages/kit/test/apps/basics/test/cross-platform/test.js
1378  	packages/kit/test/apps/basics/test/server.test.js
1379  	packages/kit/test/apps/basics/test/setup.js
1380  	packages/kit/test/apps/basics/test/test.js
1381  	packages/kit/test/apps/basics/tsconfig.json
1382  	packages/kit/test/apps/basics/vite.config.js
1383  	packages/kit/test/apps/dev-only/package.json
1384  	packages/kit/test/apps/dev-only/playwright.config.js
1385  	packages/kit/test/apps/dev-only/src/app.html
1386  	packages/kit/test/apps/dev-only/src/hooks.server.js
1387  	packages/kit/test/apps/dev-only/src/lib/server/blah/private.js
1388  	packages/kit/test/apps/dev-only/src/lib/test.server.js
1389  	packages/kit/test/apps/dev-only/src/routes/+error.svelte
1390  	packages/kit/test/apps/dev-only/src/routes/illegal-imports/env/dynamic-private-dynamic-import/+page.svelte
1391  	packages/kit/test/apps/dev-only/src/routes/illegal-imports/env/dynamic-private/+page.svelte
1392  	packages/kit/test/apps/dev-only/src/routes/illegal-imports/env/static-private-dynamic-import/+page.svelte
1393  	packages/kit/test/apps/dev-only/src/routes/illegal-imports/env/static-private/+page.svelte
1394  	packages/kit/test/apps/dev-only/src/routes/illegal-imports/server-only-folder/dynamic-import/+page.svelte
1395  	packages/kit/test/apps/dev-only/src/routes/illegal-imports/server-only-folder/static-import/+page.svelte
1396  	packages/kit/test/apps/dev-only/src/routes/illegal-imports/server-only-modules/dynamic-import/+page.svelte
1397  	packages/kit/test/apps/dev-only/src/routes/illegal-imports/server-only-modules/illegal.server.js
1398  	packages/kit/test/apps/dev-only/src/routes/illegal-imports/server-only-modules/static-import/+page.svelte
1399  	packages/kit/test/apps/dev-only/src/routes/+layout.svelte
1400  	packages/kit/test/apps/dev-only/svelte.config.js
1401  	packages/kit/test/apps/dev-only/test/test.js
1402  	packages/kit/test/apps/dev-only/tsconfig.json
1403  	packages/kit/test/apps/dev-only/vite.config.js
1404  	packages/kit/test/apps/embed/package.json
1405  	packages/kit/test/apps/embed/playwright.config.js
1406  	packages/kit/test/apps/embed/src/app.html
1407  	packages/kit/test/apps/embed/src/routes/embed/a/+page.svelte
1408  	packages/kit/test/apps/embed/src/routes/embed/b/+page.svelte
1409  	packages/kit/test/apps/embed/src/routes/embed/+page.js
1410  	packages/kit/test/apps/embed/src/routes/embed/+page.svelte
1411  	packages/kit/test/apps/embed/src/routes/+layout.svelte
1412  	packages/kit/test/apps/embed/svelte.config.js
1413  	packages/kit/test/apps/embed/test/test.js
1414  	packages/kit/test/apps/embed/tsconfig.json
1415  	packages/kit/test/apps/embed/vite.config.js
1416  	packages/kit/test/apps/no-ssr/package.json
1417  	packages/kit/test/apps/no-ssr/playwright.config.js
1418  	packages/kit/test/apps/no-ssr/src/app.html
1419  	packages/kit/test/apps/no-ssr/src/routes/+layout.js
1420  	packages/kit/test/apps/no-ssr/src/routes/+layout.server.js
1421  	packages/kit/test/apps/no-ssr/src/routes/+layout.svelte
1422  	packages/kit/test/apps/no-ssr/src/routes/+page.svelte
1423  	packages/kit/test/apps/no-ssr/svelte.config.js
1424  	packages/kit/test/apps/no-ssr/test/test.js
1425  	packages/kit/test/apps/no-ssr/tsconfig.json
1426  	packages/kit/test/apps/no-ssr/vite.config.js
1427  	packages/kit/test/apps/options-2/package.json
1428  	packages/kit/test/apps/options-2/playwright.config.js
1429  	packages/kit/test/apps/options-2/README.md
1430  	packages/kit/test/apps/options-2/src/app.html
1431  	packages/kit/test/apps/options-2/src/routes/deeply/nested/page/+page.svelte
1432  	packages/kit/test/apps/options-2/src/routes/env/+page.svelte
1433  	packages/kit/test/apps/options-2/src/routes/hello/+page.js
1434  	packages/kit/test/apps/options-2/src/routes/hello/+page.svelte
1435  	packages/kit/test/apps/options-2/src/routes/+layout.svelte
1436  	packages/kit/test/apps/options-2/src/routes/+page.svelte
1437  	packages/kit/test/apps/options-2/src/service-worker.js
1438  	packages/kit/test/apps/options-2/static/answer.txt
1439  	packages/kit/test/apps/options-2/svelte.config.js
1440  	packages/kit/test/apps/options-2/test/test.js
1441  	packages/kit/test/apps/options-2/tsconfig.json
1442  	packages/kit/test/apps/options-2/vite.config.js
1443  	packages/kit/test/apps/options/package.json
1444  	packages/kit/test/apps/options/playwright.config.js
1445  	packages/kit/test/apps/options/public/answer.html
1446  	packages/kit/test/apps/options/source/components/Message.svelte
1447  	packages/kit/test/apps/options/source/components/SvelteLogo.svelte
1448  	packages/kit/test/apps/options/source/hooks.client.js
1449  	packages/kit/test/apps/options/source/hooks.server.js
1450  	packages/kit/test/apps/options/source/pages/base/+page.js
1451  	packages/kit/test/apps/options/source/pages/base/+page.svelte
1452  	packages/kit/test/apps/options/source/pages/base/[slug]/+page.svelte
1453  	packages/kit/test/apps/options/source/pages/csp/+page.svelte
1454  	packages/kit/test/apps/options/source/pages/custom-extensions/a/+page.svelte
1455  	packages/kit/test/apps/options/source/pages/custom-extensions/const/+page.whokilledthemuffinman
1456  	packages/kit/test/apps/options/source/pages/custom-extensions/+layout.svelte
1457  	packages/kit/test/apps/options/source/pages/custom-extensions/+page.jesuslivesineveryone
1458  	packages/kit/test/apps/options/source/pages/custom-extensions/[slug]/+page.svelte.md
1459  	packages/kit/test/apps/options/source/pages/custom-extensions/unsafe-replacement/+page.svelte
1460  	packages/kit/test/apps/options/source/pages/endpoint/+server.js
1461  	packages/kit/test/apps/options/source/pages/endpoint-with-slash/+server.js
1462  	packages/kit/test/apps/options/source/pages/env/+page.server.js
1463  	packages/kit/test/apps/options/source/pages/env/+page.svelte
1464  	packages/kit/test/apps/options/source/pages/error/+page.svelte
1465  	packages/kit/test/apps/options/source/pages/+layout.server.js
1466  	packages/kit/test/apps/options/source/pages/+layout.svelte
1467  	packages/kit/test/apps/options/source/pages/mode/+page.server.js
1468  	packages/kit/test/apps/options/source/pages/mode/+page.svelte
1469  	packages/kit/test/apps/options/source/pages/page-endpoint/+page.server.js
1470  	packages/kit/test/apps/options/source/pages/page-endpoint/+page.svelte
1471  	packages/kit/test/apps/options/source/pages/+page.svelte
1472  	packages/kit/test/apps/options/source/pages/preloading/code/+page.svelte
1473  	packages/kit/test/apps/options/source/pages/preloading/+page.svelte
1474  	packages/kit/test/apps/options/source/pages/preloading/preloaded/+page.server.js
1475  	packages/kit/test/apps/options/source/pages/preloading/preloaded/+page.svelte
1476  	packages/kit/test/apps/options/source/pages/resolve-route/[foo]/+page.svelte
1477  	packages/kit/test/apps/options/source/pages/resolve-route/+page.svelte
1478  	packages/kit/test/apps/options/source/pages/routing/link-outside-app-target/source/+page.svelte
1479  	packages/kit/test/apps/options/source/pages/routing/link-outside-app-target/state.js
1480  	packages/kit/test/apps/options/source/pages/routing/link-outside-app-target/target/+page.svelte
1481  	packages/kit/test/apps/options/source/pages/slash/child/+page.svelte
1482  	packages/kit/test/apps/options/source/pages/slash/+page.svelte
1483  	packages/kit/test/apps/options/source/pages/test.txt
1484  	packages/kit/test/apps/options/source/template.html
1485  	packages/kit/test/apps/options/svelte.config.js
1486  	packages/kit/test/apps/options/test/test.js
1487  	packages/kit/test/apps/options/tsconfig.json
1488  	packages/kit/test/apps/options/vite.custom.config.js
1489  	packages/kit/test/apps/read-file-test.txt
1490  	packages/kit/test/apps/writes/package.json
1491  	packages/kit/test/apps/writes/playwright.config.js
1492  	packages/kit/test/apps/writes/src/app.html
1493  	packages/kit/test/apps/writes/src/global.d.ts
1494  	packages/kit/test/apps/writes/src/routes/double-mount/+page.svelte
1495  	packages/kit/test/apps/writes/src/routes/+layout.svelte
1496  	packages/kit/test/apps/writes/src/routes/new-route/+page.svelte
1497  	packages/kit/test/apps/writes/src/routes/new-route/zzzz1662642734866/+page.svelte
1498  	packages/kit/test/apps/writes/svelte.config.js
1499  	packages/kit/test/apps/writes/test/test.js
1500  	packages/kit/test/apps/writes/tsconfig.json
1501  	packages/kit/test/apps/writes/vite.config.js
1502  	packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/package.json
1503  	packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/src/app.html
1504  	packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/src/routes/foo/+page.svelte
1505  	packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/src/routes/+layout.js
1506  	packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/src/routes/+page.svelte
1507  	packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/svelte.config.js
1508  	packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/tsconfig.json
1509  	packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/vite.config.js
1510  	packages/kit/test/build-errors/apps/prerenderable-not-prerendered/package.json
1511  	packages/kit/test/build-errors/apps/prerenderable-not-prerendered/src/app.html
1512  	packages/kit/test/build-errors/apps/prerenderable-not-prerendered/src/routes/+page.svelte
1513  	packages/kit/test/build-errors/apps/prerenderable-not-prerendered/src/routes/[x]/+page.js
1514  	packages/kit/test/build-errors/apps/prerenderable-not-prerendered/src/routes/[x]/+page.svelte
1515  	packages/kit/test/build-errors/apps/prerenderable-not-prerendered/svelte.config.js
1516  	packages/kit/test/build-errors/apps/prerenderable-not-prerendered/tsconfig.json
1517  	packages/kit/test/build-errors/apps/prerenderable-not-prerendered/vite.config.js
1518  	packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/package.json
1519  	packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/src/app.html
1520  	packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/src/routes/+layout.js
1521  	packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/src/routes/[slug]/[notSpecific]/+page.ts
1522  	packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/src/routes/[slug]/specific/+page.svelte
1523  	packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/svelte.config.js
1524  	packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/tsconfig.json
1525  	packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/vite.config.js
1526  	packages/kit/test/build-errors/apps/private-dynamic-env-dynamic-import/package.json
1527  	packages/kit/test/build-errors/apps/private-dynamic-env-dynamic-import/src/app.html
1528  	packages/kit/test/build-errors/apps/private-dynamic-env-dynamic-import/src/routes/+page.svelte
1529  	packages/kit/test/build-errors/apps/private-dynamic-env-dynamic-import/svelte.config.js
1530  	packages/kit/test/build-errors/apps/private-dynamic-env-dynamic-import/tsconfig.json
1531  	packages/kit/test/build-errors/apps/private-dynamic-env-dynamic-import/vite.config.js
1532  	packages/kit/test/build-errors/apps/private-dynamic-env/package.json
1533  	packages/kit/test/build-errors/apps/private-dynamic-env/src/app.html
1534  	packages/kit/test/build-errors/apps/private-dynamic-env/src/routes/+page.svelte
1535  	packages/kit/test/build-errors/apps/private-dynamic-env/svelte.config.js
1536  	packages/kit/test/build-errors/apps/private-dynamic-env/tsconfig.json
1537  	packages/kit/test/build-errors/apps/private-dynamic-env/vite.config.js
1538  	packages/kit/test/build-errors/apps/private-static-env-dynamic-import/package.json
1539  	packages/kit/test/build-errors/apps/private-static-env-dynamic-import/src/app.html
1540  	packages/kit/test/build-errors/apps/private-static-env-dynamic-import/src/routes/+page.svelte
1541  	packages/kit/test/build-errors/apps/private-static-env-dynamic-import/svelte.config.js
1542  	packages/kit/test/build-errors/apps/private-static-env-dynamic-import/tsconfig.json
1543  	packages/kit/test/build-errors/apps/private-static-env-dynamic-import/vite.config.js
1544  	packages/kit/test/build-errors/apps/private-static-env/package.json
1545  	packages/kit/test/build-errors/apps/private-static-env/src/app.html
1546  	packages/kit/test/build-errors/apps/private-static-env/src/routes/+page.svelte
1547  	packages/kit/test/build-errors/apps/private-static-env/svelte.config.js
1548  	packages/kit/test/build-errors/apps/private-static-env/tsconfig.json
1549  	packages/kit/test/build-errors/apps/private-static-env/vite.config.js
1550  	packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/package.json
1551  	packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/src/app.html
1552  	packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/src/lib/server/something/private.js
1553  	packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/src/routes/+page.svelte
1554  	packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/svelte.config.js
1555  	packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/tsconfig.json
1556  	packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/vite.config.js
1557  	packages/kit/test/build-errors/apps/server-only-folder/package.json
1558  	packages/kit/test/build-errors/apps/server-only-folder/src/app.html
1559  	packages/kit/test/build-errors/apps/server-only-folder/src/lib/server/something/private.js
1560  	packages/kit/test/build-errors/apps/server-only-folder/src/routes/+page.svelte
1561  	packages/kit/test/build-errors/apps/server-only-folder/svelte.config.js
1562  	packages/kit/test/build-errors/apps/server-only-folder/tsconfig.json
1563  	packages/kit/test/build-errors/apps/server-only-folder/vite.config.js
1564  	packages/kit/test/build-errors/apps/server-only-module-dynamic-import/package.json
1565  	packages/kit/test/build-errors/apps/server-only-module-dynamic-import/src/app.html
1566  	packages/kit/test/build-errors/apps/server-only-module-dynamic-import/src/lib/test.server.js
1567  	packages/kit/test/build-errors/apps/server-only-module-dynamic-import/src/routes/+page.svelte
1568  	packages/kit/test/build-errors/apps/server-only-module-dynamic-import/svelte.config.js
1569  	packages/kit/test/build-errors/apps/server-only-module-dynamic-import/tsconfig.json
1570  	packages/kit/test/build-errors/apps/server-only-module-dynamic-import/vite.config.js
1571  	packages/kit/test/build-errors/apps/server-only-module/package.json
1572  	packages/kit/test/build-errors/apps/server-only-module/src/app.html
1573  	packages/kit/test/build-errors/apps/server-only-module/src/lib/test.server.js
1574  	packages/kit/test/build-errors/apps/server-only-module/src/routes/+page.svelte
1575  	packages/kit/test/build-errors/apps/server-only-module/svelte.config.js
1576  	packages/kit/test/build-errors/apps/server-only-module/tsconfig.json
1577  	packages/kit/test/build-errors/apps/server-only-module/vite.config.js
1578  	packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/package.json
1579  	packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/src/app.html
1580  	packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/src/routes/+page.svelte
1581  	packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/src/service-worker.js
1582  	packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/svelte.config.js
1583  	packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/tsconfig.json
1584  	packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/vite.config.js
1585  	packages/kit/test/build-errors/apps/service-worker-private-env/package.json
1586  	packages/kit/test/build-errors/apps/service-worker-private-env/src/app.html
1587  	packages/kit/test/build-errors/apps/service-worker-private-env/src/routes/+page.svelte
1588  	packages/kit/test/build-errors/apps/service-worker-private-env/src/service-worker.js
1589  	packages/kit/test/build-errors/apps/service-worker-private-env/svelte.config.js
1590  	packages/kit/test/build-errors/apps/service-worker-private-env/tsconfig.json
1591  	packages/kit/test/build-errors/apps/service-worker-private-env/vite.config.js
1592  	packages/kit/test/build-errors/apps/syntax-error/package.json
1593  	packages/kit/test/build-errors/apps/syntax-error/src/app.html
1594  	packages/kit/test/build-errors/apps/syntax-error/src/lib/test.server.js
1595  	packages/kit/test/build-errors/apps/syntax-error/src/routes/+page.svelte
1596  	packages/kit/test/build-errors/apps/syntax-error/svelte.config.js
1597  	packages/kit/test/build-errors/apps/syntax-error/tsconfig.json
1598  	packages/kit/test/build-errors/apps/syntax-error/vite.config.js
1599  	packages/kit/test/build-errors/env.spec.js
1600  	packages/kit/test/build-errors/package.json
1601  	packages/kit/test/build-errors/prerender.spec.js
1602  	packages/kit/test/build-errors/server-only.spec.js
1603  	packages/kit/test/build-errors/syntax-error.spec.js
1604  	packages/kit/test/github-flaky-warning-reporter.js
1605  	packages/kit/test/prerendering/basics/package.json
1606  	packages/kit/test/prerendering/basics/src/app.d.ts
1607  	packages/kit/test/prerendering/basics/src/app.html
1608  	packages/kit/test/prerendering/basics/src/hooks.server.js
1609  	packages/kit/test/prerendering/basics/src/routes/encöded-hash-link/+page.svelte
1610  	packages/kit/test/prerendering/basics/src/routes/encoding/[path].json/+server.js
1611  	packages/kit/test/prerendering/basics/src/routes/encoding/[path]/+page.svelte
1612  	packages/kit/test/prerendering/basics/src/routes/encoding/path with spaces/+page.js
1613  	packages/kit/test/prerendering/basics/src/routes/encoding/path with spaces/+page.svelte
1614  	packages/kit/test/prerendering/basics/src/routes/encoding/redirect/+page.js
1615  	packages/kit/test/prerendering/basics/src/routes/encoding/redirect/+page.svelte
1616  	packages/kit/test/prerendering/basics/src/routes/env/+page.server.js
1617  	packages/kit/test/prerendering/basics/src/routes/env/+page.svelte
1618  	packages/kit/test/prerendering/basics/src/routes/fetch-404/+page.js
1619  	packages/kit/test/prerendering/basics/src/routes/fetch-404/+page.svelte
1620  	packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/also-not-buffered/+page.js
1621  	packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/also-not-buffered/+page.svelte
1622  	packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/buffered.json/+server.js
1623  	packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/buffered/+page.js
1624  	packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/buffered/+page.svelte
1625  	packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/not-buffered.json/+server.js
1626  	packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/not-buffered/+page.js
1627  	packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/not-buffered/+page.svelte
1628  	packages/kit/test/prerendering/basics/src/routes/fetch-image/+page.svelte
1629  	packages/kit/test/prerendering/basics/src/routes/fetch-image/[...slug]/+server.js
1630  	packages/kit/test/prerendering/basics/src/routes/(grouped)/grouped/+page.svelte
1631  	packages/kit/test/prerendering/basics/src/routes/immutable-headers/+server.js
1632  	packages/kit/test/prerendering/basics/src/routes/+layout.js
1633  	packages/kit/test/prerendering/basics/src/routes/+layout.svelte
1634  	packages/kit/test/prerendering/basics/src/routes/load-file-with-spaces/+page.js
1635  	packages/kit/test/prerendering/basics/src/routes/load-file-with-spaces/+page.svelte
1636  	packages/kit/test/prerendering/basics/src/routes/max-age/+page.js
1637  	packages/kit/test/prerendering/basics/src/routes/max-age/+page.svelte
1638  	packages/kit/test/prerendering/basics/src/routes/optional-params/[[optional]]/+page.svelte
1639  	packages/kit/test/prerendering/basics/src/routes/origin/message.json/+server.js
1640  	packages/kit/test/prerendering/basics/src/routes/origin/+page.server.js
1641  	packages/kit/test/prerendering/basics/src/routes/origin/+page.svelte
1642  	packages/kit/test/prerendering/basics/src/routes/page.html/+page.server.js
1643  	packages/kit/test/prerendering/basics/src/routes/page.html/+page.svelte
1644  	packages/kit/test/prerendering/basics/src/routes/+page.server.js
1645  	packages/kit/test/prerendering/basics/src/routes/+page.svelte
1646  	packages/kit/test/prerendering/basics/src/routes/prerendering-true/+page.svelte
1647  	packages/kit/test/prerendering/basics/src/routes/redirect-encoded/+page.js
1648  	packages/kit/test/prerendering/basics/src/routes/redirect-malicious/+page.js
1649  	packages/kit/test/prerendering/basics/src/routes/redirect/+page.js
1650  	packages/kit/test/prerendering/basics/src/routes/redirect-relative/+page.js
1651  	packages/kit/test/prerendering/basics/src/routes/redirect-server/+page.server.js
1652  	packages/kit/test/prerendering/basics/src/routes/shadowed-get/+page.server.js
1653  	packages/kit/test/prerendering/basics/src/routes/shadowed-get/+page.svelte
1654  	packages/kit/test/prerendering/basics/src/routes/shadowed-get/ssr-off/+page.server.js
1655  	packages/kit/test/prerendering/basics/src/routes/shadowed-get/ssr-off/+page.svelte
1656  	packages/kit/test/prerendering/basics/src/routes/shadowed-post/+page.server.js
1657  	packages/kit/test/prerendering/basics/src/routes/shadowed-post/+page.svelte
1658  	packages/kit/test/prerendering/basics/src/routes/spa-shell/+page.js
1659  	packages/kit/test/prerendering/basics/src/routes/spa-shell/+page.server.js
1660  	packages/kit/test/prerendering/basics/src/routes/spa-shell/+page.svelte
1661  	packages/kit/test/prerendering/basics/src/routes/trailing-slash/+layout.js
1662  	packages/kit/test/prerendering/basics/src/routes/trailing-slash/+layout.svelte
1663  	packages/kit/test/prerendering/basics/src/routes/trailing-slash/page/+page.server.js
1664  	packages/kit/test/prerendering/basics/src/routes/trailing-slash/page/+page.svelte
1665  	packages/kit/test/prerendering/basics/src/routes/trailing-slash/+page.svelte
1666  	packages/kit/test/prerendering/basics/src/routes/trailing-slash/standalone-endpoint.json/+server.js
1667  	packages/kit/test/prerendering/basics/src/routes/初めまして/+page.svelte
1668  	packages/kit/test/prerendering/basics/src/service-worker.js
1669  	packages/kit/test/prerendering/basics/static/file with spaces.json
1670  	packages/kit/test/prerendering/basics/svelte.config.js
1671  	packages/kit/test/prerendering/basics/test/tests.spec.js
1672  	packages/kit/test/prerendering/basics/tsconfig.json
1673  	packages/kit/test/prerendering/basics/vite.config.js
1674  	packages/kit/test/prerendering/options/package.json
1675  	packages/kit/test/prerendering/options/public/robots.txt
1676  	packages/kit/test/prerendering/options/src/app.html
1677  	packages/kit/test/prerendering/options/src/routes/(group)/+page.svelte
1678  	packages/kit/test/prerendering/options/src/routes/+layout.js
1679  	packages/kit/test/prerendering/options/src/routes/+layout.svelte
1680  	packages/kit/test/prerendering/options/src/routes/nested/+page.svelte
1681  	packages/kit/test/prerendering/options/src/routes/rss.xml/+server.js
1682  	packages/kit/test/prerendering/options/svelte.config.js
1683  	packages/kit/test/prerendering/options/test/tests.spec.js
1684  	packages/kit/test/prerendering/options/tsconfig.json
1685  	packages/kit/test/prerendering/options/vite.config.js
1686  	packages/kit/test/prerendering/paths-base/package.json
1687  	packages/kit/test/prerendering/paths-base/src/app.d.ts
1688  	packages/kit/test/prerendering/paths-base/src/app.html
1689  	packages/kit/test/prerendering/paths-base/src/hooks.server.js
1690  	packages/kit/test/prerendering/paths-base/src/routes/a/b/c/+page.svelte
1691  	packages/kit/test/prerendering/paths-base/src/routes/a/b/d/+page.svelte
1692  	packages/kit/test/prerendering/paths-base/src/routes/assets/+page.svelte
1693  	packages/kit/test/prerendering/paths-base/src/routes/dynamic/[slug]/+page.svelte
1694  	packages/kit/test/prerendering/paths-base/src/routes/+layout.js
1695  	packages/kit/test/prerendering/paths-base/src/routes/+layout.svelte
1696  	packages/kit/test/prerendering/paths-base/src/routes/nested/+page.svelte
1697  	packages/kit/test/prerendering/paths-base/src/routes/+page.svelte
1698  	packages/kit/test/prerendering/paths-base/src/routes/redirect/+page.js
1699  	packages/kit/test/prerendering/paths-base/svelte.config.js
1700  	packages/kit/test/prerendering/paths-base/test/tests.spec.js
1701  	packages/kit/test/prerendering/paths-base/tsconfig.json
1702  	packages/kit/test/prerendering/paths-base/vite.config.js
1703  	packages/kit/test/prerendering/test-utils.js
1704  	packages/kit/test/setup.js
1705  	packages/kit/test/tsconfig.json
1706  	packages/kit/test/types/actions.test.ts
1707  	packages/kit/test/types/load.test.ts
1708  	packages/kit/test/types/tsconfig.json
1709  	packages/kit/test/utils.d.ts
1710  	packages/kit/test/utils.js
1711  	packages/kit/tsconfig.json
1712  	packages/kit/types/index.d.ts
1713  	packages/migrate/bin.js
1714  	packages/migrate/CHANGELOG.md
1715  	packages/migrate/migrations/package/index.js
1716  	packages/migrate/migrations/package/migrate_config.js
1717  	packages/migrate/migrations/package/migrate_config.spec.js
1718  	packages/migrate/migrations/package/migrate_pkg.js
1719  	packages/migrate/migrations/package/migrate_pkg.spec.js
1720  	packages/migrate/migrations/routes/index.js
1721  	packages/migrate/migrations/routes/migrate_page_js/index.js
1722  	packages/migrate/migrations/routes/migrate_page_js/index.spec.js
1723  	packages/migrate/migrations/routes/migrate_page_js/samples.md
1724  	packages/migrate/migrations/routes/migrate_page_server/index.js
1725  	packages/migrate/migrations/routes/migrate_page_server/index.spec.js
1726  	packages/migrate/migrations/routes/migrate_page_server/samples.md
1727  	packages/migrate/migrations/routes/migrate_scripts/index.js
1728  	packages/migrate/migrations/routes/migrate_scripts/index.spec.js
1729  	packages/migrate/migrations/routes/migrate_scripts/samples.md
1730  	packages/migrate/migrations/routes/migrate_server/index.js
1731  	packages/migrate/migrations/routes/migrate_server/index.spec.js
1732  	packages/migrate/migrations/routes/migrate_server/samples.md
1733  	packages/migrate/migrations/routes/tasks.js
1734  	packages/migrate/migrations/routes/utils.js
1735  	packages/migrate/migrations/self-closing-tags/index.js
1736  	packages/migrate/migrations/self-closing-tags/migrate.js
1737  	packages/migrate/migrations/self-closing-tags/migrate.spec.js
1738  	packages/migrate/migrations/svelte-4/index.js
1739  	packages/migrate/migrations/svelte-4/migrate.js
1740  	packages/migrate/migrations/svelte-4/migrate.spec.js
1741  	packages/migrate/migrations/sveltekit-2/index.js
1742  	packages/migrate/migrations/sveltekit-2/migrate.js
1743  	packages/migrate/migrations/sveltekit-2/migrate.spec.js
1744  	packages/migrate/migrations/sveltekit-2/svelte-config-samples.md
1745  	packages/migrate/migrations/sveltekit-2/tsconfig-samples.md
1746  	packages/migrate/migrations/sveltekit-2/tsjs-samples.md
1747  	packages/migrate/package.json
1748  	packages/migrate/README.md
1749  	packages/migrate/tsconfig.json
1750  	packages/migrate/utils.js
1751  	packages/migrate/utils.spec.js
1752  	packages/package/CHANGELOG.md
1753  	packages/package/package.json
1754  	packages/package/README.md
1755  	packages/package/src/cli.js
1756  	packages/package/src/config.js
1757  	packages/package/src/filesystem.js
1758  	packages/package/src/index.js
1759  	packages/package/src/typescript.js
1760  	packages/package/src/types.d.ts
1761  	packages/package/src/utils.js
1762  	packages/package/src/validate.js
1763  	packages/package/svelte-package.js
1764  	packages/package/test/errors/no-lib-folder/package.json
1765  	packages/package/test/errors/no-lib-folder/svelte.config.js
1766  	packages/package/test/errors/no-lib-folder/tsconfig.json
1767  	packages/package/test/fixtures/assets/jsconfig.json
1768  	packages/package/test/fixtures/assets/package.json
1769  	packages/package/test/fixtures/assets/svelte.config.js
1770  	packages/package/test/fixtures/emitTypes-false/expected/foo.d.ts
1771  	packages/package/test/fixtures/emitTypes-false/expected/index.js
1772  	packages/package/test/fixtures/emitTypes-false/expected/Test2.svelte
1773  	packages/package/test/fixtures/emitTypes-false/expected/Test.svelte
1774  	packages/package/test/fixtures/emitTypes-false/package.json
1775  	packages/package/test/fixtures/emitTypes-false/src/lib/foo.d.ts
1776  	packages/package/test/fixtures/emitTypes-false/src/lib/index.js
1777  	packages/package/test/fixtures/emitTypes-false/src/lib/Test2.svelte
1778  	packages/package/test/fixtures/emitTypes-false/src/lib/Test.svelte
1779  	packages/package/test/fixtures/emitTypes-false/svelte.config.js
1780  	packages/package/test/fixtures/javascript/expected/foo.d.ts
1781  	packages/package/test/fixtures/javascript/expected/index.d.ts
1782  	packages/package/test/fixtures/javascript/expected/index.js
1783  	packages/package/test/fixtures/javascript/expected/internal/foo.d.ts
1784  	packages/package/test/fixtures/javascript/expected/internal/index.d.ts
1785  	packages/package/test/fixtures/javascript/expected/internal/index.js
1786  	packages/package/test/fixtures/javascript/expected/internal/runes.svelte.d.ts
1787  	packages/package/test/fixtures/javascript/expected/internal/runes.svelte.js
1788  	packages/package/test/fixtures/javascript/expected/internal/Test.svelte
1789  	packages/package/test/fixtures/javascript/expected/internal/Test.svelte.d.ts
1790  	packages/package/test/fixtures/javascript/expected/Test2.svelte
1791  	packages/package/test/fixtures/javascript/expected/Test2.svelte.d.ts
1792  	packages/package/test/fixtures/javascript/expected/Test.svelte
1793  	packages/package/test/fixtures/javascript/expected/Test.svelte.d.ts
1794  	packages/package/test/fixtures/javascript/expected/utils.d.ts
1795  	packages/package/test/fixtures/javascript/expected/utils.js
1796  	packages/package/test/fixtures/javascript/jsconfig.json
1797  	packages/package/test/fixtures/javascript/package.json
1798  	packages/package/test/fixtures/javascript/ReadMe.md
1799  	packages/package/test/fixtures/javascript/src/lib/foo.d.ts
1800  	packages/package/test/fixtures/javascript/src/lib/index.js
1801  	packages/package/test/fixtures/javascript/src/lib/internal/foo.d.ts
1802  	packages/package/test/fixtures/javascript/src/lib/internal/index.js
1803  	packages/package/test/fixtures/javascript/src/lib/internal/runes.svelte.js
1804  	packages/package/test/fixtures/javascript/src/lib/internal/Test.svelte
1805  	packages/package/test/fixtures/javascript/src/lib/Test2.svelte
1806  	packages/package/test/fixtures/javascript/src/lib/Test.svelte
1807  	packages/package/test/fixtures/javascript/src/lib/utils.js
1808  	packages/package/test/fixtures/javascript/svelte.config.js
1809  	packages/package/test/fixtures/resolve-alias/expected/baz.d.ts
1810  	packages/package/test/fixtures/resolve-alias/expected/baz.js
1811  	packages/package/test/fixtures/resolve-alias/expected/index.d.ts
1812  	packages/package/test/fixtures/resolve-alias/expected/index.js
1813  	packages/package/test/fixtures/resolve-alias/expected/sub/bar.d.ts
1814  	packages/package/test/fixtures/resolve-alias/expected/sub/bar.js
1815  	packages/package/test/fixtures/resolve-alias/expected/sub/foo.d.ts
1816  	packages/package/test/fixtures/resolve-alias/expected/sub/foo.js
1817  	packages/package/test/fixtures/resolve-alias/expected/Test.svelte
1818  	packages/package/test/fixtures/resolve-alias/expected/Test.svelte.d.ts
1819  	packages/package/test/fixtures/resolve-alias/expected/utils/index.d.ts
1820  	packages/package/test/fixtures/resolve-alias/expected/utils/index.js
1821  	packages/package/test/fixtures/resolve-alias/package.json
1822  	packages/package/test/fixtures/resolve-alias/src/lib/baz.ts
1823  	packages/package/test/fixtures/resolve-alias/src/lib/index.ts
1824  	packages/package/test/fixtures/resolve-alias/src/lib/sub/bar.ts
1825  	packages/package/test/fixtures/resolve-alias/src/lib/sub/foo.ts
1826  	packages/package/test/fixtures/resolve-alias/src/lib/Test.svelte
1827  	packages/package/test/fixtures/resolve-alias/src/lib/utils/index.ts
1828  	packages/package/test/fixtures/resolve-alias/svelte.config.js
1829  	packages/package/test/fixtures/resolve-alias/tsconfig.json
1830  	packages/package/test/fixtures/svelte-3-types/expected/index.d.ts
1831  	packages/package/test/fixtures/svelte-3-types/expected/index.js
1832  	packages/package/test/fixtures/svelte-3-types/expected/Test.svelte
1833  	packages/package/test/fixtures/svelte-3-types/expected/Test.svelte.d.ts
1834  	packages/package/test/fixtures/svelte-3-types/package.json
1835  	packages/package/test/fixtures/svelte-3-types/src/lib/index.ts
1836  	packages/package/test/fixtures/svelte-3-types/src/lib/Test.svelte
1837  	packages/package/test/fixtures/svelte-3-types/svelte.config.js
1838  	packages/package/test/fixtures/svelte-3-types/tsconfig.json
1839  	packages/package/test/fixtures/svelte-kit/expected/foo.d.ts
1840  	packages/package/test/fixtures/svelte-kit/expected/index.d.ts
1841  	packages/package/test/fixtures/svelte-kit/expected/index.js
1842  	packages/package/test/fixtures/svelte-kit/expected/Test.svelte
1843  	packages/package/test/fixtures/svelte-kit/expected/Test.svelte.d.ts
1844  	packages/package/test/fixtures/svelte-kit/jsconfig.json
1845  	packages/package/test/fixtures/svelte-kit/package.json
1846  	packages/package/test/fixtures/svelte-kit/src/kitlib/foo.d.ts
1847  	packages/package/test/fixtures/svelte-kit/src/kitlib/index.js
1848  	packages/package/test/fixtures/svelte-kit/src/kitlib/Test.svelte
1849  	packages/package/test/fixtures/svelte-kit/svelte.config.js
1850  	packages/package/test/fixtures/tsconfig-specified/expected/runes.svelte.d.ts
1851  	packages/package/test/fixtures/tsconfig-specified/expected/runes.svelte.js
1852  	packages/package/test/fixtures/tsconfig-specified/package.json
1853  	packages/package/test/fixtures/tsconfig-specified/src/lib/runes.svelte.ts
1854  	packages/package/test/fixtures/tsconfig-specified/svelte.config.js
1855  	packages/package/test/fixtures/tsconfig-specified/tsconfig.build.json
1856  	packages/package/test/fixtures/tsconfig-specified/tsconfig.json
1857  	packages/package/test/fixtures/typescript-esnext/expected/foo.d.ts
1858  	packages/package/test/fixtures/typescript-esnext/expected/index.d.ts
1859  	packages/package/test/fixtures/typescript-esnext/expected/index.js
1860  	packages/package/test/fixtures/typescript-esnext/expected/Plain.svelte
1861  	packages/package/test/fixtures/typescript-esnext/expected/Plain.svelte.d.ts
1862  	packages/package/test/fixtures/typescript-esnext/expected/runes.svelte.d.ts
1863  	packages/package/test/fixtures/typescript-esnext/expected/runes.svelte.js
1864  	packages/package/test/fixtures/typescript-esnext/expected/Test2.svelte
1865  	packages/package/test/fixtures/typescript-esnext/expected/Test2.svelte.d.ts
1866  	packages/package/test/fixtures/typescript-esnext/expected/Test.svelte
1867  	packages/package/test/fixtures/typescript-esnext/expected/Test.svelte.d.ts
1868  	packages/package/test/fixtures/typescript-esnext/expected/utils.d.ts
1869  	packages/package/test/fixtures/typescript-esnext/expected/utils.js
1870  	packages/package/test/fixtures/typescript-esnext/package.json
1871  	packages/package/test/fixtures/typescript-esnext/src/lib/foo.d.ts
1872  	packages/package/test/fixtures/typescript-esnext/src/lib/index.ts
1873  	packages/package/test/fixtures/typescript-esnext/src/lib/Plain.svelte
1874  	packages/package/test/fixtures/typescript-esnext/src/lib/runes.svelte.ts
1875  	packages/package/test/fixtures/typescript-esnext/src/lib/Test2.svelte
1876  	packages/package/test/fixtures/typescript-esnext/src/lib/Test.svelte
1877  	packages/package/test/fixtures/typescript-esnext/src/lib/utils.ts
1878  	packages/package/test/fixtures/typescript-esnext/svelte.config.js
1879  	packages/package/test/fixtures/typescript-esnext/tsconfig.json
1880  	packages/package/test/fixtures/typescript-nodenext/expected/index.d.ts
1881  	packages/package/test/fixtures/typescript-nodenext/expected/index.js
1882  	packages/package/test/fixtures/typescript-nodenext/expected/runes.svelte.d.ts
1883  	packages/package/test/fixtures/typescript-nodenext/expected/runes.svelte.js
1884  	packages/package/test/fixtures/typescript-nodenext/expected/Test.svelte
1885  	packages/package/test/fixtures/typescript-nodenext/expected/Test.svelte.d.ts
1886  	packages/package/test/fixtures/typescript-nodenext/package.json
1887  	packages/package/test/fixtures/typescript-nodenext/src/lib/index.ts
1888  	packages/package/test/fixtures/typescript-nodenext/src/lib/runes.svelte.ts
1889  	packages/package/test/fixtures/typescript-nodenext/src/lib/Test.svelte
1890  	packages/package/test/fixtures/typescript-nodenext/svelte.config.js
1891  	packages/package/test/fixtures/typescript-nodenext/tsconfig.json
1892  	packages/package/test/index.js
1893  	packages/package/test/watch/expected/a.d.ts
1894  	packages/package/test/watch/expected/a.js
1895  	packages/package/test/watch/expected/b.d.ts
1896  	packages/package/test/watch/expected/b.js
1897  	packages/package/test/watch/expected/index.js
1898  	packages/package/test/watch/expected/package.json
1899  	packages/package/test/watch/expected/post-error.svelte
1900  	packages/package/test/watch/expected/Test.svelte
1901  	packages/package/test/watch/expected/Test.svelte.d.ts
1902  	packages/package/test/watch/package.json
1903  	packages/package/test/watch/src/lib/index.js
1904  	packages/package/test/watch/svelte.config.js
1905  	packages/package/test/watch/tsconfig.json
1906  	packages/package/tsconfig.json
1907  	playgrounds/basic/jsconfig.json
1908  	playgrounds/basic/package.json
1909  	playgrounds/basic/src/app.d.ts
1910  	playgrounds/basic/src/app.html
1911  	playgrounds/basic/src/lib/index.js
1912  	playgrounds/basic/src/routes/+page.svelte
1913  	playgrounds/basic/svelte.config.js
1914  	playgrounds/basic/vite.config.js
1915  	playgrounds/README.md
1916  	pnpm-lock.yaml
1917  	pnpm-workspace.yaml
1918  	README.md
1919  	renovate.json
1920  	scripts/check-dependencies.js
1921  	scripts/sync-all.js
1922  	sites/kit.svelte.dev/package.json
1923  	sites/kit.svelte.dev/README.md
1924  	sites/kit.svelte.dev/scripts/tsconfig.json
1925  	sites/kit.svelte.dev/scripts/types/index.js
1926  	sites/kit.svelte.dev/src/app.d.ts
1927  	sites/kit.svelte.dev/src/app.html
1928  	sites/kit.svelte.dev/src/hooks.server.js
1929  	sites/kit.svelte.dev/src/lib/server/docs/index.js
1930  	sites/kit.svelte.dev/src/lib/server/docs/types.d.ts
1931  	sites/kit.svelte.dev/src/lib/server/renderer.js
1932  	sites/kit.svelte.dev/src/routes/content.json/content.server.js
1933  	sites/kit.svelte.dev/src/routes/content.json/+server.js
1934  	sites/kit.svelte.dev/src/routes/docs/+layout.server.js
1935  	sites/kit.svelte.dev/src/routes/docs/+layout.svelte
1936  	sites/kit.svelte.dev/src/routes/docs/+page.js
1937  	sites/kit.svelte.dev/src/routes/docs/[slug]/+page.server.js
1938  	sites/kit.svelte.dev/src/routes/docs/[slug]/+page.svelte
1939  	sites/kit.svelte.dev/src/routes/edge.svg/countries.json
1940  	sites/kit.svelte.dev/src/routes/edge.svg/land-110m.json
1941  	sites/kit.svelte.dev/src/routes/edge.svg/+server.js
1942  	sites/kit.svelte.dev/src/routes/+error.svelte
1943  	sites/kit.svelte.dev/src/routes/faq/+page.js
1944  	sites/kit.svelte.dev/src/routes/home/common.css
1945  	sites/kit.svelte.dev/src/routes/home/Deployment.svelte
1946  	sites/kit.svelte.dev/src/routes/home/Features.svelte
1947  	sites/kit.svelte.dev/src/routes/home/Hero.svelte
1948  	sites/kit.svelte.dev/src/routes/home/Intro.svelte
1949  	sites/kit.svelte.dev/src/routes/home/Showcase.svelte
1950  	sites/kit.svelte.dev/src/routes/home/subtitles.vtt
1951  	sites/kit.svelte.dev/src/routes/home/svelte-kit-logotype.svg.svelte
1952  	sites/kit.svelte.dev/src/routes/home/Svelte.svelte
1953  	sites/kit.svelte.dev/src/routes/home/Video.svelte
1954  	sites/kit.svelte.dev/src/routes/+layout.server.js
1955  	sites/kit.svelte.dev/src/routes/+layout.svelte
1956  	sites/kit.svelte.dev/src/routes/nav.json/+server.js
1957  	sites/kit.svelte.dev/src/routes/+page.js
1958  	sites/kit.svelte.dev/src/routes/+page.svelte
1959  	sites/kit.svelte.dev/src/routes/schema.json
1960  	sites/kit.svelte.dev/src/routes/search/+page.js
1961  	sites/kit.svelte.dev/src/routes/search/+page.server.js
1962  	sites/kit.svelte.dev/src/routes/search/+page.svelte
1963  	sites/kit.svelte.dev/static/manifest.json
1964  	sites/kit.svelte.dev/static/opensearch.xml
1965  	sites/kit.svelte.dev/static/robots.txt
1966  	sites/kit.svelte.dev/svelte.config.js
1967  	sites/kit.svelte.dev/tsconfig.json
1968  	sites/kit.svelte.dev/vercel.json
1969  	sites/kit.svelte.dev/vite.config.js

####### CONTRIBUTING.md #######

# SvelteKit Contributing Guide

## Preparing

This is a monorepo, meaning the repo holds multiple packages. It requires the use of [pnpm](https://pnpm.io/). You can [install pnpm](https://pnpm.io/installation) with:

```bash
npm i -g pnpm
```

`pnpm` commands run in the project's root directory will run on all sub-projects. You can checkout the code and install the dependencies with:

```bash
git clone git@github.com:sveltejs/kit.git
cd kit
pnpm install
```

## Testing Changes

### Playground

You can use the playground at [`playgrounds/basic`](./playgrounds/basic/) to experiment with your changes to SvelteKit locally.

### Linking

If you want to test against an existing project, you can use [pnpm `overrides`](https://pnpm.io/package_json#pnpmoverrides) in that project:

```jsonc
{
	// ...
	"pnpm": {
		"overrides": {
			"@sveltejs/kit": "link:../path/to/svelte-kit/packages/kit",
			// additionally/optional the adapter you're using
			"@sveltejs/adapter-auto": "link:../path/to/svelte-kit/packages/adapter-auto"
		}
	}
}
```

## Code structure

Entry points to be aware of are:

- [`packages/create-svelte`](https://github.com/sveltejs/kit/tree/main/packages/create-svelte) - code that's run when you create a new project with `npm create svelte@latest`
- [`packages/package`](https://github.com/sveltejs/kit/tree/main/packages/package) - for the `svelte-package` command
- [`packages/kit/src/core`](https://github.com/sveltejs/kit/tree/main/packages/kit/src/core) - code that's called at dev/build-time
- [`packages/kit/src/core/sync`](https://github.com/sveltejs/kit/tree/main/packages/kit/src/core/sync) - for `svelte-kit sync`, which regenerates routing info and type definitions
- [`packages/kit/src/runtime`](https://github.com/sveltejs/kit/tree/main/packages/kit/src/runtime) - code that's called at runtime
- [`packages/kit/src/exports/vite`](https://github.com/sveltejs/kit/tree/main/packages/kit/src/exports/vite) - for all the Vite plugin related stuff
- [`packages/adapter-[platform]`](https://github.com/sveltejs/kit/tree/main/packages) - for the various SvelteKit-provided adapters

## Good first issues

If you're looking for an issue to tackle to get familiar with the codebase and test suite, the [**low hanging fruit**](https://github.com/sveltejs/kit/issues?q=is%3Aissue+is%3Aopen+label%3A%22low+hanging+fruit%22) label contains issues that ought to be relatively straightforward to fix. Check to see if a PR already exists for an issue before working on it!

Issues that have a clear solution but which _may_ be slightly more involved have the [**ready to implement**](https://github.com/sveltejs/kit/issues?q=is%3Aissue+is%3Aopen+label%3A%22ready+to+implement%22) label.

Issues with the [**soon**](https://github.com/sveltejs/kit/issues?q=is%3Aissue+is%3Aopen+milestone%3Asoon) milestone are higher priority than issues with the [**later**](https://github.com/sveltejs/kit/issues?q=is%3Aissue+is%3Aopen+milestone%3Alater+) label (though PRs for 'later' issues are still welcome, especially if you're affected by them).

## Testing

Run `pnpm test` to run the tests from all subpackages. Browser tests live in subdirectories of `packages/kit/test` such as `packages/kit/test/apps/basics`.

You can run the tests for only a single package by first moving to that directory. E.g. `cd packages/kit`.

For some packages you must rebuild each time before running the tests if you've made code changes. These packages have a `build` command. Packages like `packages/kit` don't require a build step.

To run a single integration test or otherwise control the running of the tests locally see [the Playwright CLI docs](https://playwright.dev/docs/test-cli). Note that you will need to run these commands from the test project directory such as `packages/kit/test/apps/basics`.

You can run the test server with `cd packages/kit/test/apps/basics; pnpm run dev` to hit it with your browser. The Playwright Inspector offers similar functionality.

You may need to install some dependencies first, e.g. with `npx playwright install-deps` (which only works on Ubuntu).

If there are tests that fail on the CI, you can retrieve the failed screenshots by going to the summary page of the CI run. You can usually find this by clicking on "Details" of the check results, clicking "Summary" at the top-left corner, and then scrolling to the bottom "Artifacts" section to download the archive.

It is very easy to introduce flakiness in a browser test. If you try to fix the flakiness in a test, you can run it until failure to gain some confidence you've fixed the test with a command like:

```
npx playwright test --workers=1 --repeat-each 1000 --max-failures 1 -g "accepts a Request object"
```

## Working on Vite and other dependencies

If you would like to test local changes to Vite or another dependency, you can build it and then use [`pnpm.overrides`](https://pnpm.io/package_json#pnpmoverrides). Please note that `pnpm.overrides` must be specified in the root `package.json` and you must first list the package as a dependency in the root `package.json`:

```jsonc
{
	// ...
	"dependencies": {
		"vite": "^4.0.0"
	},
	"pnpm": {
		"overrides": {
			"vite": "link:../path/to/vite/packages/vite"
		}
	}
}
```

## Documentation changes

All documentation for SvelteKit is in the [`documentation` directory](https://github.com/sveltejs/kit/tree/main/documentation), and any improvements should be made as a Pull Request to this repository. The site itself is located in the [`sites/kit.svelte.dev` directory](https://github.com/sveltejs/kit/tree/main/sites/kit.svelte.dev) and can be run locally to preview changes.

## Sending PRs

### Coding style

There are a few guidelines we follow:

- Internal variables are written with `snake_case` while external APIs are written with `camelCase`
- Provide a single object as the argument to public APIs. This object can have multiple properties
- Avoid creating new test projects under `packages/kit/test/apps` but reuse an existing one when possible
- Ensure `pnpm lint` and `pnpm check` pass. You can run `pnpm format` to format the code

To use the git hooks in the repo, which will save you from waiting for CI to tell you that you forgot to lint, run this:

```bash
git config core.hookspath .githooks
```

### Generating changelogs

For changes to be reflected in package changelogs, run `pnpm changeset` and follow the prompts.

### Type changes

If your PR changes the generated types of SvelteKit, run `pnpm generate:types` inside `packages/kit` and commit the new output (don't format it with Prettier!). Review the changes carefully to ensure there are no unwanted changes. If you don't commit type changes, CI will fail.

## Releases

The [Changesets GitHub action](https://github.com/changesets/action#with-publishing) will create and update a PR that applies changesets and publishes new versions of changed packages to npm.

New packages will need to be published manually the first time if they are scoped to the `@sveltejs` organisation, by running this from the package directory:

```bash
npm publish --access=public
```

####### documentation/docs/10-getting-started/10-introduction.md #######

---
title: Introduction
---

## Before we begin

> If you're new to Svelte or SvelteKit we recommend checking out the [interactive tutorial](https://learn.svelte.dev).
>
> If you get stuck, reach out for help in the [Discord chatroom](https://svelte.dev/chat).

## What is SvelteKit?

SvelteKit is a framework for rapidly developing robust, performant web applications using [Svelte](https://svelte.dev/). If you're coming from React, SvelteKit is similar to Next. If you're coming from Vue, SvelteKit is similar to Nuxt.

To learn more about the kinds of applications you can build with SvelteKit, see the [FAQ](/docs/faq#what-can-i-make-with-sveltekit).

## What is Svelte?

In short, Svelte is a way of writing user interface components — like a navigation bar, comment section, or contact form — that users see and interact with in their browsers. The Svelte compiler converts your components to JavaScript that can be run to render the HTML for the page and to CSS that styles the page. You don't need to know Svelte to understand the rest of this guide, but it will help. If you'd like to learn more, check out [the Svelte tutorial](https://svelte.dev/tutorial).

## SvelteKit vs Svelte

Svelte renders UI components. You can compose these components and render an entire page with just Svelte, but you need more than just Svelte to write an entire app.

SvelteKit helps you build web apps while following modern best practices and providing solutions to common development challenges. It offers everything from basic functionalities — like a [router](glossary#routing) that updates your UI when a link is clicked — to more advanced capabilities. Its extensive list of features includes [build optimizations](https://vitejs.dev/guide/features.html#build-optimizations) to load only the minimal required code; [offline support](service-workers); [preloading](link-options#data-sveltekit-preload-data) pages before user navigation; [configurable rendering](page-options) to handle different parts of your app on the server via [SSR](glossary#ssr), in the browser through [client-side rendering](glossary#csr), or at build-time with [prerendering](glossary#prerendering); [image optimization](images); and much more. Building an app with all the modern best practices is fiendishly complicated, but SvelteKit does all the boring stuff for you so that you can get on with the creative part.

It reflects changes to your code in the browser instantly to provide a lightning-fast and feature-rich development experience by leveraging [Vite](https://vitejs.dev/) with a [Svelte plugin](https://github.com/sveltejs/vite-plugin-svelte) to do [Hot Module Replacement (HMR)](https://github.com/sveltejs/vite-plugin-svelte/blob/main/docs/config.md#hot).

####### documentation/docs/10-getting-started/20-creating-a-project.md #######

---
title: Creating a project
---

The easiest way to start building a SvelteKit app is to run `npm create`:

```bash
npm create svelte@latest my-app
cd my-app
npm install
npm run dev
```

The first command will scaffold a new project in the `my-app` directory asking you if you'd like to set up some basic tooling such as TypeScript. See [integrations](./integrations) for pointers on setting up additional tooling. The subsequent commands will then install its dependencies and start a server on [localhost:5173](http://localhost:5173).

There are two basic concepts:

- Each page of your app is a [Svelte](https://svelte.dev) component
- You create pages by adding files to the `src/routes` directory of your project. These will be server-rendered so that a user's first visit to your app is as fast as possible, then a client-side app takes over

Try editing the files to get a feel for how everything works.

## Editor setup

We recommend using [Visual Studio Code (aka VS Code)](https://code.visualstudio.com/download) with [the Svelte extension](https://marketplace.visualstudio.com/items?itemName=svelte.svelte-vscode), but [support also exists for numerous other editors](https://sveltesociety.dev/resources#editor-support).

####### documentation/docs/10-getting-started/30-project-structure.md #######

---
title: Project structure
---

A typical SvelteKit project looks like this:

```bash
my-project/
├ src/
│ ├ lib/
│ │ ├ server/
│ │ │ └ [your server-only lib files]
│ │ └ [your lib files]
│ ├ params/
│ │ └ [your param matchers]
│ ├ routes/
│ │ └ [your routes]
│ ├ app.html
│ ├ error.html
│ ├ hooks.client.js
│ ├ hooks.server.js
│ └ service-worker.js
├ static/
│ └ [your static assets]
├ tests/
│ └ [your tests]
├ package.json
├ svelte.config.js
├ tsconfig.json
└ vite.config.js
```

You'll also find common files like `.gitignore` and `.npmrc` (and `.prettierrc` and `.eslintrc.cjs` and so on, if you chose those options when running `npm create svelte@latest`).

## Project files

### src

The `src` directory contains the meat of your project. Everything except `src/routes` and `src/app.html` is optional.

- `lib` contains your library code (utilities and components), which can be imported via the [`$lib`](modules#$lib) alias, or packaged up for distribution using [`svelte-package`](packaging)
  - `server` contains your server-only library code. It can be imported by using the [`$lib/server`](server-only-modules) alias. SvelteKit will prevent you from importing these in client code.
- `params` contains any [param matchers](advanced-routing#matching) your app needs
- `routes` contains the [routes](routing) of your application. You can also colocate other components that are only used within a single route here
- `app.html` is your page template — an HTML document containing the following placeholders:
  - `%sveltekit.head%` — `<link>` and `<script>` elements needed by the app, plus any `<svelte:head>` content
  - `%sveltekit.body%` — the markup for a rendered page. This should live inside a `<div>` or other element, rather than directly inside `<body>`, to prevent bugs caused by browser extensions injecting elements that are then destroyed by the hydration process. SvelteKit will warn you in development if this is not the case
  - `%sveltekit.assets%` — either [`paths.assets`](configuration#paths), if specified, or a relative path to [`paths.base`](configuration#paths)
  - `%sveltekit.nonce%` — a [CSP](configuration#csp) nonce for manually included links and scripts, if used
  - `%sveltekit.env.[NAME]%` - this will be replaced at render time with the `[NAME]` environment variable, which must begin with the [`publicPrefix`](configuration#env) (usually `PUBLIC_`). It will fallback to `''` if not matched.
- `error.html` is the page that is rendered when everything else fails. It can contain the following placeholders:
  - `%sveltekit.status%` — the HTTP status
  - `%sveltekit.error.message%` — the error message
- `hooks.client.js` contains your client [hooks](hooks)
- `hooks.server.js` contains your server [hooks](hooks)
- `service-worker.js` contains your [service worker](service-workers)

(Whether the project contains `.js` or `.ts` files depends on whether you opt to use TypeScript when you create your project. You can switch between JavaScript and TypeScript in the documentation using the toggle at the bottom of this page.)

If you added [Vitest](https://vitest.dev) when you set up your project, your unit tests will live in the `src` directory with a `.test.js` extension.

### static

Any static assets that should be served as-is, like `robots.txt` or `favicon.png`, go in here.

### tests

If you added [Playwright](https://playwright.dev/) for browser testing when you set up your project, the tests will live in this directory.

### package.json

Your `package.json` file must include `@sveltejs/kit`, `svelte` and `vite` as `devDependencies`.

When you create a project with `npm create svelte@latest`, you'll also notice that `package.json` includes `"type": "module"`. This means that `.js` files are interpreted as native JavaScript modules with `import` and `export` keywords. Legacy CommonJS files need a `.cjs` file extension.

### svelte.config.js

This file contains your Svelte and SvelteKit [configuration](configuration).

### tsconfig.json

This file (or `jsconfig.json`, if you prefer type-checked `.js` files over `.ts` files) configures TypeScript, if you added typechecking during `npm create svelte@latest`. Since SvelteKit relies on certain configuration being set a specific way, it generates its own `.svelte-kit/tsconfig.json` file which your own config `extends`.

### vite.config.js

A SvelteKit project is really just a [Vite](https://vitejs.dev) project that uses the [`@sveltejs/kit/vite`](modules#sveltejs-kit-vite) plugin, along with any other [Vite configuration](https://vitejs.dev/config/).

## Other files

### .svelte-kit

As you develop and build your project, SvelteKit will generate files in a `.svelte-kit` directory (configurable as [`outDir`](configuration#outdir)). You can ignore its contents, and delete them at any time (they will be regenerated when you next `dev` or `build`).

####### documentation/docs/10-getting-started/40-web-standards.md #######

---
title: Web standards
---

Throughout this documentation, you'll see references to the standard [Web APIs](https://developer.mozilla.org/en-US/docs/Web/API) that SvelteKit builds on top of. Rather than reinventing the wheel, we _use the platform_, which means your existing web development skills are applicable to SvelteKit. Conversely, time spent learning SvelteKit will help you be a better web developer elsewhere.

These APIs are available in all modern browsers and in many non-browser environments like Cloudflare Workers, Deno and Vercel Edge Functions. During development, and in [adapters](adapters) for Node-based environments (including AWS Lambda), they're made available via polyfills where necessary (for now, that is — Node is rapidly adding support for more web standards).

In particular, you'll get comfortable with the following:

## Fetch APIs

SvelteKit uses [`fetch`](https://developer.mozilla.org/en-US/docs/Web/API/fetch) for getting data from the network. It's available in [hooks](hooks) and [server routes](routing#server) as well as in the browser.

> A special version of `fetch` is available in [`load`](load) functions, [server hooks](hooks#server-hooks) and [API routes](routing#server) for invoking endpoints directly during server-side rendering, without making an HTTP call, while preserving credentials. (To make credentialled fetches in server-side code outside `load`, you must explicitly pass `cookie` and/or `authorization` headers.) It also allows you to make relative requests, whereas server-side `fetch` normally requires a fully qualified URL.

Besides `fetch` itself, the [Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API) includes the following interfaces:

### Request

An instance of [`Request`](https://developer.mozilla.org/en-US/docs/Web/API/Request) is accessible in [hooks](hooks) and [server routes](routing#server) as `event.request`. It contains useful methods like `request.json()` and `request.formData()` for getting data that was posted to an endpoint.

### Response

An instance of [`Response`](https://developer.mozilla.org/en-US/docs/Web/API/Response) is returned from `await fetch(...)` and handlers in `+server.js` files. Fundamentally, a SvelteKit app is a machine for turning a `Request` into a `Response`.

### Headers

The [`Headers`](https://developer.mozilla.org/en-US/docs/Web/API/Headers) interface allows you to read incoming `request.headers` and set outgoing `response.headers`. For example, you can get the `request.headers` as shown below, and use the [`json` convenience function](modules#sveltejs-kit-json) to send modified `response.headers`:

```js
// @errors: 2461
/// file: src/routes/what-is-my-user-agent/+server.js
import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function GET({ request }) {
	// log all headers
	console.log(...request.headers);

	// create a JSON Response using a header we received
	return json({
		// retrieve a specific header
		userAgent: request.headers.get('user-agent')
	}, {
		// set a header on the response
		headers: { 'x-custom-header': 'potato' }
	});
}
```

## FormData

When dealing with HTML native form submissions you'll be working with [`FormData`](https://developer.mozilla.org/en-US/docs/Web/API/FormData) objects.

```js
// @errors: 2461
/// file: src/routes/hello/+server.js
import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export async function POST(event) {
	const body = await event.request.formData();

	// log all fields
	console.log([...body]);

	return json({
		// get a specific field's value
		name: body.get('name') ?? 'world'
	});
}
```

## Stream APIs

Most of the time, your endpoints will return complete data, as in the `userAgent` example above. Sometimes, you may need to return a response that's too large to fit in memory in one go, or is delivered in chunks, and for this the platform provides [streams](https://developer.mozilla.org/en-US/docs/Web/API/Streams_API) — [ReadableStream](https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream), [WritableStream](https://developer.mozilla.org/en-US/docs/Web/API/WritableStream) and [TransformStream](https://developer.mozilla.org/en-US/docs/Web/API/TransformStream).

## URL APIs

URLs are represented by the [`URL`](https://developer.mozilla.org/en-US/docs/Web/API/URL) interface, which includes useful properties like `origin` and `pathname` (and, in the browser, `hash`). This interface shows up in various places — `event.url` in [hooks](hooks) and [server routes](routing#server), [`$page.url`](modules#$app-stores) in [pages](routing#page), `from` and `to` in [`beforeNavigate` and `afterNavigate`](modules#$app-navigation) and so on.

### URLSearchParams

Wherever you encounter a URL, you can access query parameters via `url.searchParams`, which is an instance of [`URLSearchParams`](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams):

```js
// @filename: ambient.d.ts
declare global {
	const url: URL;
}

export {};

// @filename: index.js
// ---cut---
const foo = url.searchParams.get('foo');
```

## Web Crypto

The [Web Crypto API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API) is made available via the `crypto` global. It's used internally for [Content Security Policy](configuration#csp) headers, but you can also use it for things like generating UUIDs:

```js
const uuid = crypto.randomUUID();
```

####### documentation/docs/10-getting-started/meta.json #######

```

{
	"title": "Getting started"
}

```


####### documentation/docs/20-core-concepts/10-routing.md #######

---
title: Routing
---

At the heart of SvelteKit is a _filesystem-based router_. The routes of your app — i.e. the URL paths that users can access — are defined by the directories in your codebase:

- `src/routes` is the root route
- `src/routes/about` creates an `/about` route
- `src/routes/blog/[slug]` creates a route with a _parameter_, `slug`, that can be used to load data dynamically when a user requests a page like `/blog/hello-world`

> You can change `src/routes` to a different directory by editing the [project config](configuration).

Each route directory contains one or more _route files_, which can be identified by their `+` prefix.

## +page

### +page.svelte

A `+page.svelte` component defines a page of your app. By default, pages are rendered both on the server ([SSR](glossary#ssr)) for the initial request and in the browser ([CSR](glossary#csr)) for subsequent navigation.

```svelte
<!--- file: src/routes/+page.svelte --->
<h1>Hello and welcome to my site!</h1>
<a href="/about">About my site</a>
```

```svelte
<!--- file: src/routes/about/+page.svelte --->
<h1>About this site</h1>
<p>TODO...</p>
<a href="/">Home</a>
```

```svelte
<!--- file: src/routes/blog/[slug]/+page.svelte --->
<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.title}</h1>
<div>{@html data.content}</div>
```

> Note that SvelteKit uses `<a>` elements to navigate between routes, rather than a framework-specific `<Link>` component.

### +page.js

Often, a page will need to load some data before it can be rendered. For this, we add a `+page.js` module that exports a `load` function:

```js
/// file: src/routes/blog/[slug]/+page.js
import { error } from '@sveltejs/kit';

/** @type {import('./$types').PageLoad} */
export function load({ params }) {
	if (params.slug === 'hello-world') {
		return {
			title: 'Hello world!',
			content: 'Welcome to our blog. Lorem ipsum dolor sit amet...'
		};
	}

	error(404, 'Not found');
}
```

This function runs alongside `+page.svelte`, which means it runs on the server during server-side rendering and in the browser during client-side navigation. See [`load`](load) for full details of the API.

As well as `load`, `+page.js` can export values that configure the page's behaviour:

- `export const prerender = true` or `false` or `'auto'`
- `export const ssr = true` or `false`
- `export const csr = true` or `false`

You can find more information about these in [page options](page-options).

### +page.server.js

If your `load` function can only run on the server — for example, if it needs to fetch data from a database or you need to access private [environment variables](modules#$env-static-private) like API keys — then you can rename `+page.js` to `+page.server.js` and change the `PageLoad` type to `PageServerLoad`.

```js
/// file: src/routes/blog/[slug]/+page.server.js

// @filename: ambient.d.ts
declare global {
	const getPostFromDatabase: (slug: string) => {
		title: string;
		content: string;
	}
}

export {};

// @filename: index.js
// ---cut---
import { error } from '@sveltejs/kit';

/** @type {import('./$types').PageServerLoad} */
export async function load({ params }) {
	const post = await getPostFromDatabase(params.slug);

	if (post) {
		return post;
	}

	error(404, 'Not found');
}
```

During client-side navigation, SvelteKit will load this data from the server, which means that the returned value must be serializable using [devalue](https://github.com/rich-harris/devalue). See [`load`](load) for full details of the API.

Like `+page.js`, `+page.server.js` can export [page options](page-options) — `prerender`, `ssr` and `csr`.

A `+page.server.js` file can also export _actions_. If `load` lets you read data from the server, `actions` let you write data _to_ the server using the `<form>` element. To learn how to use them, see the [form actions](form-actions) section.

## +error

If an error occurs during `load`, SvelteKit will render a default error page. You can customise this error page on a per-route basis by adding an `+error.svelte` file:

```svelte
<!--- file: src/routes/blog/[slug]/+error.svelte --->
<script>
	import { page } from '$app/stores';
</script>

<h1>{$page.status}: {$page.error.message}</h1>
```

SvelteKit will 'walk up the tree' looking for the closest error boundary — if the file above didn't exist it would try `src/routes/blog/+error.svelte` and then `src/routes/+error.svelte` before rendering the default error page. If _that_ fails (or if the error was thrown from the `load` function of the root `+layout`, which sits 'above' the root `+error`), SvelteKit will bail out and render a static fallback error page, which you can customise by creating a `src/error.html` file.

If the error occurs inside a `load` function in `+layout(.server).js`, the closest error boundary in the tree is an `+error.svelte` file _above_ that layout (not next to it).

If no route can be found (404), `src/routes/+error.svelte` (or the default error page, if that file does not exist) will be used.

> `+error.svelte` is _not_ used when an error occurs inside [`handle`](hooks#server-hooks-handle) or a [+server.js](#server) request handler.

You can read more about error handling [here](errors).

## +layout

So far, we've treated pages as entirely standalone components — upon navigation, the existing `+page.svelte` component will be destroyed, and a new one will take its place.

But in many apps, there are elements that should be visible on _every_ page, such as top-level navigation or a footer. Instead of repeating them in every `+page.svelte`, we can put them in _layouts_.

### +layout.svelte

To create a layout that applies to every page, make a file called `src/routes/+layout.svelte`. The default layout (the one that SvelteKit uses if you don't bring your own) looks like this...

```html
<slot></slot>
```

...but we can add whatever markup, styles and behaviour we want. The only requirement is that the component includes a `<slot>` for the page content. For example, let's add a nav bar:

```html
/// file: src/routes/+layout.svelte
<nav>
	<a href="/">Home</a>
	<a href="/about">About</a>
	<a href="/settings">Settings</a>
</nav>

<slot></slot>
```

If we create pages for `/`, `/about` and `/settings`...

```html
/// file: src/routes/+page.svelte
<h1>Home</h1>
```

```html
/// file: src/routes/about/+page.svelte
<h1>About</h1>
```

```html
/// file: src/routes/settings/+page.svelte
<h1>Settings</h1>
```

...the nav will always be visible, and clicking between the three pages will only result in the `<h1>` being replaced.

Layouts can be _nested_. Suppose we don't just have a single `/settings` page, but instead have nested pages like `/settings/profile` and `/settings/notifications` with a shared submenu (for a real-life example, see [github.com/settings](https://github.com/settings)).

We can create a layout that only applies to pages below `/settings` (while inheriting the root layout with the top-level nav):

```svelte
<!--- file: src/routes/settings/+layout.svelte --->
<script>
	/** @type {import('./$types').LayoutData} */
	export let data;
</script>

<h1>Settings</h1>

<div class="submenu">
	{#each data.sections as section}
		<a href="/settings/{section.slug}">{section.title}</a>
	{/each}
</div>

<slot></slot>
```

You can see how `data` is populated by looking at the `+layout.js` example in the next section just below.

By default, each layout inherits the layout above it. Sometimes that isn't what you want - in this case, [advanced layouts](advanced-routing#advanced-layouts) can help you.

### +layout.js

Just like `+page.svelte` loading data from `+page.js`, your `+layout.svelte` component can get data from a [`load`](load) function in `+layout.js`.

```js
/// file: src/routes/settings/+layout.js
/** @type {import('./$types').LayoutLoad} */
export function load() {
	return {
		sections: [
			{ slug: 'profile', title: 'Profile' },
			{ slug: 'notifications', title: 'Notifications' }
		]
	};
}
```

If a `+layout.js` exports [page options](page-options) — `prerender`, `ssr` and `csr` — they will be used as defaults for child pages.

Data returned from a layout's `load` function is also available to all its child pages:

```svelte
<!--- file: src/routes/settings/profile/+page.svelte --->
<script>
	/** @type {import('./$types').PageData} */
	export let data;

	console.log(data.sections); // [{ slug: 'profile', title: 'Profile' }, ...]
</script>
```

> Often, layout data is unchanged when navigating between pages. SvelteKit will intelligently rerun [`load`](load) functions when necessary.

### +layout.server.js

To run your layout's `load` function on the server, move it to `+layout.server.js`, and change the `LayoutLoad` type to `LayoutServerLoad`.

Like `+layout.js`, `+layout.server.js` can export [page options](page-options) — `prerender`, `ssr` and `csr`.

## +server

As well as pages, you can define routes with a `+server.js` file (sometimes referred to as an 'API route' or an 'endpoint'), which gives you full control over the response. Your `+server.js` file exports functions corresponding to HTTP verbs like `GET`, `POST`, `PATCH`, `PUT`, `DELETE`, `OPTIONS`, and `HEAD` that take a `RequestEvent` argument and return a [`Response`](https://developer.mozilla.org/en-US/docs/Web/API/Response) object.

For example we could create an `/api/random-number` route with a `GET` handler:

```js
/// file: src/routes/api/random-number/+server.js
import { error } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function GET({ url }) {
	const min = Number(url.searchParams.get('min') ?? '0');
	const max = Number(url.searchParams.get('max') ?? '1');

	const d = max - min;

	if (isNaN(d) || d < 0) {
		error(400, 'min and max must be numbers, and min must be less than max');
	}

	const random = min + Math.random() * d;

	return new Response(String(random));
}
```

The first argument to `Response` can be a [`ReadableStream`](https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream), making it possible to stream large amounts of data or create server-sent events (unless deploying to platforms that buffer responses, like AWS Lambda).

You can use the [`error`](modules#sveltejs-kit-error), [`redirect`](modules#sveltejs-kit-redirect) and [`json`](modules#sveltejs-kit-json) methods from `@sveltejs/kit` for convenience (but you don't have to).

If an error is thrown (either `error(...)` or an unexpected error), the response will be a JSON representation of the error or a fallback error page — which can be customised via `src/error.html` — depending on the `Accept` header. The [`+error.svelte`](#error) component will _not_ be rendered in this case. You can read more about error handling [here](errors).

> When creating an `OPTIONS` handler, note that Vite will inject `Access-Control-Allow-Origin` and `Access-Control-Allow-Methods` headers — these will not be present in production unless you add them.

### Receiving data

By exporting `POST`/`PUT`/`PATCH`/`DELETE`/`OPTIONS`/`HEAD` handlers, `+server.js` files can be used to create a complete API:

```svelte
<!--- file: src/routes/add/+page.svelte --->
<script>
	let a = 0;
	let b = 0;
	let total = 0;

	async function add() {
		const response = await fetch('/api/add', {
			method: 'POST',
			body: JSON.stringify({ a, b }),
			headers: {
				'content-type': 'application/json'
			}
		});

		total = await response.json();
	}
</script>

<input type="number" bind:value={a}> +
<input type="number" bind:value={b}> =
{total}

<button on:click={add}>Calculate</button>
```

```js
/// file: src/routes/api/add/+server.js
import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export async function POST({ request }) {
	const { a, b } = await request.json();
	return json(a + b);
}
```

> In general, [form actions](form-actions) are a better way to submit data from the browser to the server.

> If a `GET` handler is exported, a `HEAD` request will return the `content-length` of the `GET` handler's response body.

### Fallback method handler

Exporting the `fallback` handler will match any unhandled request methods, including methods like `MOVE` which have no dedicated export from `+server.js`.

```js
// @errors: 7031
/// file: src/routes/api/add/+server.js
import { json, text } from '@sveltejs/kit';

export async function POST({ request }) {
	const { a, b } = await request.json();
	return json(a + b);
}

// This handler will respond to PUT, PATCH, DELETE, etc.
/** @type {import('./$types').RequestHandler} */
export async function fallback({ request }) {
	return text(`I caught your ${request.method} request!`);
}
```

> For `HEAD` requests, the `GET` handler takes precedence over the `fallback` handler.

### Content negotiation

`+server.js` files can be placed in the same directory as `+page` files, allowing the same route to be either a page or an API endpoint. To determine which, SvelteKit applies the following rules:

- `PUT`/`PATCH`/`DELETE`/`OPTIONS` requests are always handled by `+server.js` since they do not apply to pages
- `GET`/`POST`/`HEAD` requests are treated as page requests if the `accept` header prioritises `text/html` (in other words, it's a browser page request), else they are handled by `+server.js`.
- Responses to `GET` requests will include a `Vary: Accept` header, so that proxies and browsers cache HTML and JSON responses separately.

## $types

Throughout the examples above, we've been importing types from a `$types.d.ts` file. This is a file SvelteKit creates for you in a hidden directory if you're using TypeScript (or JavaScript with JSDoc type annotations) to give you type safety when working with your root files.

For example, annotating `export let data` with `PageData` (or `LayoutData`, for a `+layout.svelte` file) tells TypeScript that the type of `data` is whatever was returned from `load`:

```svelte
<!--- file: src/routes/blog/[slug]/+page.svelte --->
<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>
```

In turn, annotating the `load` function with `PageLoad`, `PageServerLoad`, `LayoutLoad` or `LayoutServerLoad` (for `+page.js`, `+page.server.js`, `+layout.js` and `+layout.server.js` respectively) ensures that `params` and the return value are correctly typed.

If you're using VS Code or any IDE that supports the language server protocol and TypeScript plugins then you can omit these types _entirely_! Svelte's IDE tooling will insert the correct types for you, so you'll get type checking without writing them yourself. It also works with our command line tool `svelte-check`.

You can read more about omitting `$types` in our [blog post](https://svelte.dev/blog/zero-config-type-safety) about it.

## Other files

Any other files inside a route directory are ignored by SvelteKit. This means you can colocate components and utility modules with the routes that need them.

If components and modules are needed by multiple routes, it's a good idea to put them in [`$lib`](modules#$lib).

## Further reading

- [Tutorial: Routing](https://learn.svelte.dev/tutorial/pages)
- [Tutorial: API routes](https://learn.svelte.dev/tutorial/get-handlers)
- [Docs: Advanced routing](advanced-routing)

####### documentation/docs/20-core-concepts/20-load.md #######

---
title: Loading data
---

Before a [`+page.svelte`](routing#page-page-svelte) component (and its containing [`+layout.svelte`](routing#layout-layout-svelte) components) can be rendered, we often need to get some data. This is done by defining `load` functions.

## Page data

A `+page.svelte` file can have a sibling `+page.js` that exports a `load` function, the return value of which is available to the page via the `data` prop:

```js
/// file: src/routes/blog/[slug]/+page.js
/** @type {import('./$types').PageLoad} */
export function load({ params }) {
	return {
		post: {
			title: `Title for ${params.slug} goes here`,
			content: `Content for ${params.slug} goes here`
		}
	};
}
```

```svelte
<!--- file: src/routes/blog/[slug]/+page.svelte --->
<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.post.title}</h1>
<div>{@html data.post.content}</div>
```

Thanks to the generated `$types` module, we get full type safety.

A `load` function in a `+page.js` file runs both on the server and in the browser (unless combined with `export const ssr = false`, in which case it will [only run in the browser](https://kit.svelte.dev/docs/page-options#ssr)). If your `load` function should _always_ run on the server (because it uses private environment variables, for example, or accesses a database) then it would go in a `+page.server.js` instead.

A more realistic version of your blog post's `load` function, that only runs on the server and pulls data from a database, might look like this:

```js
/// file: src/routes/blog/[slug]/+page.server.js
// @filename: ambient.d.ts
declare module '$lib/server/database' {
	export function getPost(slug: string): Promise<{ title: string, content: string }>
}

// @filename: index.js
// ---cut---
import * as db from '$lib/server/database';

/** @type {import('./$types').PageServerLoad} */
export async function load({ params }) {
	return {
		post: await db.getPost(params.slug)
	};
}
```

Notice that the type changed from `PageLoad` to `PageServerLoad`, because server `load` functions can access additional arguments. To understand when to use `+page.js` and when to use `+page.server.js`, see [Universal vs server](load#universal-vs-server).

## Layout data

Your `+layout.svelte` files can also load data, via `+layout.js` or `+layout.server.js`.

```js
/// file: src/routes/blog/[slug]/+layout.server.js
// @filename: ambient.d.ts
declare module '$lib/server/database' {
	export function getPostSummaries(): Promise<Array<{ title: string, slug: string }>>
}

// @filename: index.js
// ---cut---
import * as db from '$lib/server/database';

/** @type {import('./$types').LayoutServerLoad} */
export async function load() {
	return {
		posts: await db.getPostSummaries()
	};
}
```

```svelte
<!--- file: src/routes/blog/[slug]/+layout.svelte --->
<script>
	/** @type {import('./$types').LayoutData} */
	export let data;
</script>

<main>
	<!-- +page.svelte is rendered in this <slot> -->
	<slot />
</main>

<aside>
	<h2>More posts</h2>
	<ul>
		{#each data.posts as post}
			<li>
				<a href="/blog/{post.slug}">
					{post.title}
				</a>
			</li>
		{/each}
	</ul>
</aside>
```

Data returned from layout `load` functions is available to child `+layout.svelte` components and the `+page.svelte` component as well as the layout that it 'belongs' to.

```diff
/// file: src/routes/blog/[slug]/+page.svelte
<script>
+	import { page } from '$app/stores';

	/** @type {import('./$types').PageData} */
	export let data;

+	// we can access `data.posts` because it's returned from
+	// the parent layout `load` function
+	$: index = data.posts.findIndex(post => post.slug === $page.params.slug);
+	$: next = data.posts[index - 1];
</script>

<h1>{data.post.title}</h1>
<div>{@html data.post.content}</div>

+{#if next}
+	<p>Next post: <a href="/blog/{next.slug}">{next.title}</a></p>
+{/if}
```

> If multiple `load` functions return data with the same key, the last one 'wins' — the result of a layout `load` returning `{ a: 1, b: 2 }` and a page `load` returning `{ b: 3, c: 4 }` would be `{ a: 1, b: 3, c: 4 }`.

## $page.data

The `+page.svelte` component, and each `+layout.svelte` component above it, has access to its own data plus all the data from its parents.

In some cases, we might need the opposite — a parent layout might need to access page data or data from a child layout. For example, the root layout might want to access a `title` property returned from a `load` function in `+page.js` or `+page.server.js`. This can be done with `$page.data`:

```svelte
<!--- file: src/routes/+layout.svelte --->
<script>
	import { page } from '$app/stores';
</script>

<svelte:head>
	<title>{$page.data.title}</title>
</svelte:head>
```

Type information for `$page.data` is provided by `App.PageData`.

## Universal vs server

As we've seen, there are two types of `load` function:

* `+page.js` and `+layout.js` files export _universal_ `load` functions that run both on the server and in the browser
* `+page.server.js` and `+layout.server.js` files export _server_ `load` functions that only run server-side

Conceptually, they're the same thing, but there are some important differences to be aware of.

### When does which load function run?

Server `load` functions _always_ run on the server.

By default, universal `load` functions run on the server during SSR when the user first visits your page. They will then run again during hydration, reusing any responses from [fetch requests](#making-fetch-requests). All subsequent invocations of universal `load` functions happen in the browser. You can customize the behavior through [page options](page-options). If you disable [server side rendering](page-options#ssr), you'll get an SPA and universal `load` functions _always_ run on the client.

If a route contains both universal and server `load` functions, the server `load` runs first.

A `load` function is invoked at runtime, unless you [prerender](page-options#prerender) the page — in that case, it's invoked at build time.

### Input

Both universal and server `load` functions have access to properties describing the request (`params`, `route` and `url`) and various functions (`fetch`, `setHeaders`, `parent`, `depends` and `untrack`). These are described in the following sections.

Server `load` functions are called with a `ServerLoadEvent`, which inherits `clientAddress`, `cookies`, `locals`, `platform` and `request` from `RequestEvent`.

Universal `load` functions are called with a `LoadEvent`, which has a `data` property. If you have `load` functions in both `+page.js` and `+page.server.js` (or `+layout.js` and `+layout.server.js`), the return value of the server `load` function is the `data` property of the universal `load` function's argument.

### Output

A universal `load` function can return an object containing any values, including things like custom classes and component constructors.

A server `load` function must return data that can be serialized with [devalue](https://github.com/rich-harris/devalue) — anything that can be represented as JSON plus things like `BigInt`, `Date`, `Map`, `Set` and `RegExp`, or repeated/cyclical references — so that it can be transported over the network. Your data can include [promises](#streaming-with-promises), in which case it will be streamed to browsers.

### When to use which

Server `load` functions are convenient when you need to access data directly from a database or filesystem, or need to use private environment variables.

Universal `load` functions are useful when you need to `fetch` data from an external API and don't need private credentials, since SvelteKit can get the data directly from the API rather than going via your server. They are also useful when you need to return something that can't be serialized, such as a Svelte component constructor.

In rare cases, you might need to use both together — for example, you might need to return an instance of a custom class that was initialised with data from your server. When using both, the server `load` return value is _not_ passed directly to the page, but to the universal `load` function (as the `data` property):

```js
/// file: src/routes/+page.server.js
/** @type {import('./$types').PageServerLoad} */
export async function load() {
	return {
		serverMessage: 'hello from server load function'
	};
}
```

```js
/// file: src/routes/+page.js
// @errors: 18047
/** @type {import('./$types').PageLoad} */
export async function load({ data }) {
	return {
		serverMessage: data.serverMessage,
		universalMessage: 'hello from universal load function'
	};
}
```

## Using URL data

Often the `load` function depends on the URL in one way or another. For this, the `load` function provides you with `url`, `route` and `params`.

### url

An instance of [`URL`](https://developer.mozilla.org/en-US/docs/Web/API/URL), containing properties like the `origin`, `hostname`, `pathname` and `searchParams` (which contains the parsed query string as a [`URLSearchParams`](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams) object). `url.hash` cannot be accessed during `load`, since it is unavailable on the server.

> In some environments this is derived from request headers during server-side rendering. If you're using [adapter-node](adapter-node), for example, you may need to configure the adapter in order for the URL to be correct.

### route

Contains the name of the current route directory, relative to `src/routes`:

```js
/// file: src/routes/a/[b]/[...c]/+page.js
/** @type {import('./$types').PageLoad} */
export function load({ route }) {
	console.log(route.id); // '/a/[b]/[...c]'
}
```

### params

`params` is derived from `url.pathname` and `route.id`.

Given a `route.id` of `/a/[b]/[...c]` and a `url.pathname` of `/a/x/y/z`, the `params` object would look like this:

```json
{
	"b": "x",
	"c": "y/z"
}
```

## Making fetch requests

To get data from an external API or a `+server.js` handler, you can use the provided `fetch` function, which behaves identically to the [native `fetch` web API](https://developer.mozilla.org/en-US/docs/Web/API/fetch) with a few additional features:

- It can be used to make credentialed requests on the server, as it inherits the `cookie` and `authorization` headers for the page request.
- It can make relative requests on the server (ordinarily, `fetch` requires a URL with an origin when used in a server context).
- Internal requests (e.g. for `+server.js` routes) go directly to the handler function when running on the server, without the overhead of an HTTP call.
- During server-side rendering, the response will be captured and inlined into the rendered HTML by hooking into the `text`, `json` and `arrayBuffer` methods of the `Response` object. Note that headers will _not_ be serialized, unless explicitly included via [`filterSerializedResponseHeaders`](hooks#server-hooks-handle).
- During hydration, the response will be read from the HTML, guaranteeing consistency and preventing an additional network request - if you received a warning in your browser console when using the browser `fetch` instead of the `load` `fetch`, this is why.

```js
/// file: src/routes/items/[id]/+page.js
/** @type {import('./$types').PageLoad} */
export async function load({ fetch, params }) {
	const res = await fetch(`/api/items/${params.id}`);
	const item = await res.json();

	return { item };
}
```

## Cookies

A server `load` function can get and set [`cookies`](types#public-types-cookies).

```js
/// file: src/routes/+layout.server.js
// @filename: ambient.d.ts
declare module '$lib/server/database' {
	export function getUser(sessionid: string | undefined): Promise<{ name: string, avatar: string }>
}

// @filename: index.js
// ---cut---
import * as db from '$lib/server/database';

/** @type {import('./$types').LayoutServerLoad} */
export async function load({ cookies }) {
	const sessionid = cookies.get('sessionid');

	return {
		user: await db.getUser(sessionid)
	};
}
```

Cookies will only be passed through the provided `fetch` function if the target host is the same as the SvelteKit application or a more specific subdomain of it.

For example, if SvelteKit is serving my.domain.com:
- domain.com WILL NOT receive cookies
- my.domain.com WILL receive cookies
- api.domain.com WILL NOT receive cookies
- sub.my.domain.com WILL receive cookies

Other cookies will not be passed when `credentials: 'include'` is set, because SvelteKit does not know which domain which cookie belongs to (the browser does not pass this information along), so it's not safe to forward any of them. Use the [handleFetch hook](hooks#server-hooks-handlefetch) to work around it.

## Headers

Both server and universal `load` functions have access to a `setHeaders` function that, when running on the server, can set headers for the response. (When running in the browser, `setHeaders` has no effect.) This is useful if you want the page to be cached, for example:

```js
// @errors: 2322 1360
/// file: src/routes/products/+page.js
/** @type {import('./$types').PageLoad} */
export async function load({ fetch, setHeaders }) {
	const url = `https://cms.example.com/products.json`;
	const response = await fetch(url);

	// cache the page for the same length of time
	// as the underlying data
	setHeaders({
		age: response.headers.get('age'),
		'cache-control': response.headers.get('cache-control')
	});

	return response.json();
}
```

Setting the same header multiple times (even in separate `load` functions) is an error — you can only set a given header once. You cannot add a `set-cookie` header with `setHeaders` — use `cookies.set(name, value, options)` instead.

## Using parent data

Occasionally it's useful for a `load` function to access data from a parent `load` function, which can be done with `await parent()`:

```js
/// file: src/routes/+layout.js
/** @type {import('./$types').LayoutLoad} */
export function load() {
	return { a: 1 };
}
```

```js
/// file: src/routes/abc/+layout.js
/** @type {import('./$types').LayoutLoad} */
export async function load({ parent }) {
	const { a } = await parent();
	return { b: a + 1 };
}
```

```js
/// file: src/routes/abc/+page.js
/** @type {import('./$types').PageLoad} */
export async function load({ parent }) {
	const { a, b } = await parent();
	return { c: a + b };
}
```

```svelte
<!--- file: src/routes/abc/+page.svelte --->
<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<!-- renders `1 + 2 = 3` -->
<p>{data.a} + {data.b} = {data.c}</p>
```

> Notice that the `load` function in `+page.js` receives the merged data from both layout `load` functions, not just the immediate parent.

Inside `+page.server.js` and `+layout.server.js`, `parent` returns data from parent `+layout.server.js` files.

In `+page.js` or `+layout.js` it will return data from parent `+layout.js` files. However, a missing `+layout.js` is treated as a `({ data }) => data` function, meaning that it will also return data from parent `+layout.server.js` files that are not 'shadowed' by a `+layout.js` file

Take care not to introduce waterfalls when using `await parent()`. Here, for example, `getData(params)` does not depend on the result of calling `parent()`, so we should call it first to avoid a delayed render.

```diff
/// file: +page.js
/** @type {import('./$types').PageLoad} */
export async function load({ params, parent }) {
-	const parentData = await parent();
	const data = await getData(params);
+	const parentData = await parent();

	return {
		...data
		meta: { ...parentData.meta, ...data.meta }
	};
}
```

## Errors

If an error is thrown during `load`, the nearest [`+error.svelte`](routing#error) will be rendered. For [_expected_](/docs/errors#expected-errors) errors, use the `error` helper from `@sveltejs/kit` to specify the HTTP status code and an optional message:

```js
/// file: src/routes/admin/+layout.server.js
// @filename: ambient.d.ts
declare namespace App {
	interface Locals {
		user?: {
			name: string;
			isAdmin: boolean;
		}
	}
}

// @filename: index.js
// ---cut---
import { error } from '@sveltejs/kit';

/** @type {import('./$types').LayoutServerLoad} */
export function load({ locals }) {
	if (!locals.user) {
		error(401, 'not logged in');
	}

	if (!locals.user.isAdmin) {
		error(403, 'not an admin');
	}
}
```

Calling `error(...)` will throw an exception, making it easy to stop execution from inside helper functions.

If an [_unexpected_](/docs/errors#unexpected-errors) error is thrown, SvelteKit will invoke [`handleError`](hooks#shared-hooks-handleerror) and treat it as a 500 Internal Error.

> [In SvelteKit 1.x](migrating-to-sveltekit-2#redirect-and-error-are-no-longer-thrown-by-you) you had to `throw` the error yourself

## Redirects

To redirect users, use the `redirect` helper from `@sveltejs/kit` to specify the location to which they should be redirected alongside a `3xx` status code. Like `error(...)`, calling `redirect(...)` will throw an exception, making it easy to stop execution from inside helper functions.

```js
/// file: src/routes/user/+layout.server.js
// @filename: ambient.d.ts
declare namespace App {
	interface Locals {
		user?: {
			name: string;
		}
	}
}

// @filename: index.js
// ---cut---
import { redirect } from '@sveltejs/kit';

/** @type {import('./$types').LayoutServerLoad} */
export function load({ locals }) {
	if (!locals.user) {
		redirect(307, '/login');
	}
}
```

> Don't use `redirect()` inside a `try {...}` block, as the redirect will immediately trigger the catch statement.

In the browser, you can also navigate programmatically outside of a `load` function using [`goto`](modules#$app-navigation-goto) from [`$app.navigation`](modules#$app-navigation).

> [In SvelteKit 1.x](migrating-to-sveltekit-2#redirect-and-error-are-no-longer-thrown-by-you) you had to `throw` the `redirect` yourself

## Streaming with promises

When using a server `load`, promises will be streamed to the browser as they resolve. This is useful if you have slow, non-essential data, since you can start rendering the page before all the data is available:

```js
/// file: src/routes/blog/[slug]/+page.server.js
// @filename: ambient.d.ts
declare global {
	const loadPost: (slug: string) => Promise<{ title: string, content: string }>;
	const loadComments: (slug: string) => Promise<{ content: string }>;
}

export {};

// @filename: index.js
// ---cut---
/** @type {import('./$types').PageServerLoad} */
export async function load({ params }) {
	return {
		// make sure the `await` happens at the end, otherwise we
		// can't start loading comments until we've loaded the post
		comments: loadComments(params.slug),
		post: await loadPost(params.slug)
	};
}
```

This is useful for creating skeleton loading states, for example:

```svelte
<!--- file: src/routes/blog/[slug]/+page.svelte --->
<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.post.title}</h1>
<div>{@html data.post.content}</div>

{#await data.comments}
	Loading comments...
{:then comments}
	{#each comments as comment}
		<p>{comment.content}</p>
	{/each}
{:catch error}
	<p>error loading comments: {error.message}</p>
{/await}
```

When streaming data, be careful to handle promise rejections correctly. More specifically, the server could crash with an "unhandled promise rejection" error if a lazy-loaded promise fails before rendering starts (at which point it's caught) and isn't handling the error in some way. When using SvelteKit's `fetch` directly in the `load` function, SvelteKit will handle this case for you. For other promises, it is enough to attach a noop-`catch` to the promise to mark it as handled.

```js
/// file: src/routes/+page.server.js
/** @type {import('./$types').PageServerLoad} */
export function load({ fetch }) {
	const ok_manual = Promise.reject();
	ok_manual.catch(() => {});

	return {
		ok_manual,
		ok_fetch: fetch('/fetch/that/could/fail'),
		dangerous_unhandled: Promise.reject()
	};
}
```

> On platforms that do not support streaming, such as AWS Lambda or Firebase, responses will be buffered. This means the page will only render once all promises resolve. If you are using a proxy (e.g. NGINX), make sure it does not buffer responses from the proxied server.

> Streaming data will only work when JavaScript is enabled. You should avoid returning promises from a universal `load` function if the page is server rendered, as these are _not_ streamed — instead, the promise is recreated when the function reruns in the browser.

> The headers and status code of a response cannot be changed once the response has started streaming, therefore you cannot `setHeaders` or throw redirects inside a streamed promise.

> [In SvelteKit 1.x](migrating-to-sveltekit-2#top-level-promises-are-no-longer-awaited) top-level promises were automatically awaited, only nested promises were streamed.

## Parallel loading

When rendering (or navigating to) a page, SvelteKit runs all `load` functions concurrently, avoiding a waterfall of requests. During client-side navigation, the result of calling multiple server `load` functions are grouped into a single response. Once all `load` functions have returned, the page is rendered.

## Rerunning load functions

SvelteKit tracks the dependencies of each `load` function to avoid rerunning it unnecessarily during navigation.

For example, given a pair of `load` functions like these...

```js
/// file: src/routes/blog/[slug]/+page.server.js
// @filename: ambient.d.ts
declare module '$lib/server/database' {
	export function getPost(slug: string): Promise<{ title: string, content: string }>
}

// @filename: index.js
// ---cut---
import * as db from '$lib/server/database';

/** @type {import('./$types').PageServerLoad} */
export async function load({ params }) {
	return {
		post: await db.getPost(params.slug)
	};
}
```

```js
/// file: src/routes/blog/[slug]/+layout.server.js
// @filename: ambient.d.ts
declare module '$lib/server/database' {
	export function getPostSummaries(): Promise<Array<{ title: string, slug: string }>>
}

// @filename: index.js
// ---cut---
import * as db from '$lib/server/database';

/** @type {import('./$types').LayoutServerLoad} */
export async function load() {
	return {
		posts: await db.getPostSummaries()
	};
}
```

...the one in `+page.server.js` will rerun if we navigate from `/blog/trying-the-raw-meat-diet` to `/blog/i-regret-my-choices` because `params.slug` has changed. The one in `+layout.server.js` will not, because the data is still valid. In other words, we won't call `db.getPostSummaries()` a second time.

A `load` function that calls `await parent()` will also rerun if a parent `load` function is rerun.

Dependency tracking does not apply _after_ the `load` function has returned — for example, accessing `params.x` inside a nested [promise](#streaming-with-promises) will not cause the function to rerun when `params.x` changes. (Don't worry, you'll get a warning in development if you accidentally do this.) Instead, access the parameter in the main body of your `load` function.

Search parameters are tracked independently from the rest of the url. For example, accessing `event.url.searchParams.get("x")` inside a `load` function will make that `load` function re-run when navigating from `?x=1` to `?x=2`, but not when navigating from `?x=1&y=1` to `?x=1&y=2`.

### Untracking dependencies

In rare cases, you may wish to exclude something from the dependency tracking mechanism. You can do this with the provided `untrack` function:

```js
/// file: src/routes/+page.js
/** @type {import('./$types').PageLoad} */
export async function load({ untrack, url }) {
	// Untrack url.pathname so that path changes don't trigger a rerun
	if (untrack(() => url.pathname === '/')) {
		return { message: 'Welcome!' };
	}
}
```

### Manual invalidation

You can also rerun `load` functions that apply to the current page using [`invalidate(url)`](modules#$app-navigation-invalidate), which reruns all `load` functions that depend on `url`, and [`invalidateAll()`](modules#$app-navigation-invalidateall), which reruns every `load` function. Server load functions will never automatically depend on a fetched `url` to avoid leaking secrets to the client.

A `load` function depends on `url` if it calls `fetch(url)` or `depends(url)`. Note that `url` can be a custom identifier that starts with `[a-z]:`:

```js
/// file: src/routes/random-number/+page.js
/** @type {import('./$types').PageLoad} */
export async function load({ fetch, depends }) {
	// load reruns when `invalidate('https://api.example.com/random-number')` is called...
	const response = await fetch('https://api.example.com/random-number');

	// ...or when `invalidate('app:random')` is called
	depends('app:random');

	return {
		number: await response.json()
	};
}
```

```svelte
<!--- file: src/routes/random-number/+page.svelte --->
<script>
	import { invalidate, invalidateAll } from '$app/navigation';

	/** @type {import('./$types').PageData} */
	export let data;

	function rerunLoadFunction() {
		// any of these will cause the `load` function to rerun
		invalidate('app:random');
		invalidate('https://api.example.com/random-number');
		invalidate(url => url.href.includes('random-number'));
		invalidateAll();
	}
</script>

<p>random number: {data.number}</p>
<button on:click={rerunLoadFunction}>Update random number</button>
```

### When do load functions rerun?

To summarize, a `load` function will rerun in the following situations:

- It references a property of `params` whose value has changed
- It references a property of `url` (such as `url.pathname` or `url.search`) whose value has changed. Properties in `request.url` are _not_ tracked
- It calls `url.searchParams.get(...)`, `url.searchParams.getAll(...)` or `url.searchParams.has(...)` and the parameter in question changes. Accessing other properties of `url.searchParams` will have the same effect as accessing `url.search`.
- It calls `await parent()` and a parent `load` function reran
- It declared a dependency on a specific URL via [`fetch`](#making-fetch-requests) (universal load only) or [`depends`](types#public-types-loadevent), and that URL was marked invalid with [`invalidate(url)`](modules#$app-navigation-invalidate)
- All active `load` functions were forcibly rerun with [`invalidateAll()`](modules#$app-navigation-invalidateall)

`params` and `url` can change in response to a `<a href="..">` link click, a [`<form>` interaction](form-actions#get-vs-post), a [`goto`](modules#$app-navigation-goto) invocation, or a [`redirect`](modules#sveltejs-kit-redirect).

Note that rerunning a `load` function will update the `data` prop inside the corresponding `+layout.svelte` or `+page.svelte`; it does _not_ cause the component to be recreated. As a result, internal state is preserved. If this isn't what you want, you can reset whatever you need to reset inside an [`afterNavigate`](modules#$app-navigation-afternavigate) callback, and/or wrap your component in a [`{#key ...}`](https://svelte.dev/docs#template-syntax-key) block.

## Implications for authentication

A couple features of loading data have important implications for auth checks:
- Layout `load` functions do not run on every request, such as during client side navigation between child routes. [(When do load functions rerun?)](load#rerunning-load-functions-when-do-load-functions-rerun)
- Layout and page `load` functions run concurrently unless `await parent()` is called. If a layout `load` throws, the page `load` function runs, but the client will not receive the returned data.

There are a few possible strategies to ensure an auth check occurs before protected code.

To prevent data waterfalls and preserve layout `load` caches:
- Use [hooks](hooks) to protect multiple routes before any `load` functions run
- Use auth guards directly in `+page.server.js` `load` functions for route specific protection

Putting an auth guard in `+layout.server.js` requires all child pages to call `await parent()` before protected code. Unless every child page depends on returned data from `await parent()`, the other options will be more performant.

## Further reading

- [Tutorial: Loading data](https://learn.svelte.dev/tutorial/page-data)
- [Tutorial: Errors and redirects](https://learn.svelte.dev/tutorial/error-basics)
- [Tutorial: Advanced loading](https://learn.svelte.dev/tutorial/await-parent)

####### documentation/docs/20-core-concepts/30-form-actions.md #######

---
title: Form actions
---

A `+page.server.js` file can export _actions_, which allow you to `POST` data to the server using the `<form>` element.

When using `<form>`, client-side JavaScript is optional, but you can easily _progressively enhance_ your form interactions with JavaScript to provide the best user experience.

## Default actions

In the simplest case, a page declares a `default` action:

```js
/// file: src/routes/login/+page.server.js
/** @type {import('./$types').Actions} */
export const actions = {
	default: async (event) => {
		// TODO log the user in
	}
};
```

To invoke this action from the `/login` page, just add a `<form>` — no JavaScript needed:

```svelte
<!--- file: src/routes/login/+page.svelte --->
<form method="POST">
	<label>
		Email
		<input name="email" type="email">
	</label>
	<label>
		Password
		<input name="password" type="password">
	</label>
	<button>Log in</button>
</form>
```

If someone were to click the button, the browser would send the form data via `POST` request to the server, running the default action.

> Actions always use `POST` requests, since `GET` requests should never have side-effects.

We can also invoke the action from other pages (for example if there's a login widget in the nav in the root layout) by adding the `action` attribute, pointing to the page:

```html
/// file: src/routes/+layout.svelte
<form method="POST" action="/login">
	<!-- content -->
</form>
```

## Named actions

Instead of one `default` action, a page can have as many named actions as it needs:

```diff
/// file: src/routes/login/+page.server.js
/** @type {import('./$types').Actions} */
export const actions = {
-	default: async (event) => {
+	login: async (event) => {
		// TODO log the user in
	},
+	register: async (event) => {
+		// TODO register the user
+	}
};
```

To invoke a named action, add a query parameter with the name prefixed by a `/` character:

```svelte
<!--- file: src/routes/login/+page.svelte --->
<form method="POST" action="?/register">
```

```svelte
<!--- file: src/routes/+layout.svelte --->
<form method="POST" action="/login?/register">
```

As well as the `action` attribute, we can use the `formaction` attribute on a button to `POST` the same form data to a different action than the parent `<form>`:

```diff
/// file: src/routes/login/+page.svelte
-<form method="POST">
+<form method="POST" action="?/login">
	<label>
		Email
		<input name="email" type="email">
	</label>
	<label>
		Password
		<input name="password" type="password">
	</label>
	<button>Log in</button>
+	<button formaction="?/register">Register</button>
</form>
```

> We can't have default actions next to named actions, because if you POST to a named action without a redirect, the query parameter is persisted in the URL, which means the next default POST would go through the named action from before.

## Anatomy of an action

Each action receives a `RequestEvent` object, allowing you to read the data with `request.formData()`. After processing the request (for example, logging the user in by setting a cookie), the action can respond with data that will be available through the `form` property on the corresponding page and through `$page.form` app-wide until the next update.

```js
// @errors: 2304
/// file: src/routes/login/+page.server.js
/** @type {import('./$types').PageServerLoad} */
export async function load({ cookies }) {
	const user = await db.getUserFromSession(cookies.get('sessionid'));
	return { user };
}

/** @type {import('./$types').Actions} */
export const actions = {
	login: async ({ cookies, request }) => {
		const data = await request.formData();
		const email = data.get('email');
		const password = data.get('password');

		const user = await db.getUser(email);
		cookies.set('sessionid', await db.createSession(user), { path: '/' });

		return { success: true };
	},
	register: async (event) => {
		// TODO register the user
	}
};
```

```svelte
<!--- file: src/routes/login/+page.svelte --->
<script>
	/** @type {import('./$types').PageData} */
	export let data;

	/** @type {import('./$types').ActionData} */
	export let form;
</script>

{#if form?.success}
	<!-- this message is ephemeral; it exists because the page was rendered in
	       response to a form submission. it will vanish if the user reloads -->
	<p>Successfully logged in! Welcome back, {data.user.name}</p>
{/if}
```

### Validation errors

If the request couldn't be processed because of invalid data, you can return validation errors — along with the previously submitted form values — back to the user so that they can try again. The `fail` function lets you return an HTTP status code (typically 400 or 422, in the case of validation errors) along with the data. The status code is available through `$page.status` and the data through `form`:

```diff
/// file: src/routes/login/+page.server.js
+import { fail } from '@sveltejs/kit';

/** @type {import('./$types').Actions} */
export const actions = {
	login: async ({ cookies, request }) => {
		const data = await request.formData();
		const email = data.get('email');
		const password = data.get('password');

+		if (!email) {
+			return fail(400, { email, missing: true });
+		}

		const user = await db.getUser(email);

+		if (!user || user.password !== hash(password)) {
+			return fail(400, { email, incorrect: true });
+		}

		cookies.set('sessionid', await db.createSession(user), { path: '/' });

		return { success: true };
	},
	register: async (event) => {
		// TODO register the user
	}
};
```

> Note that as a precaution, we only return the email back to the page — not the password.

```diff
/// file: src/routes/login/+page.svelte
<form method="POST" action="?/login">
+	{#if form?.missing}<p class="error">The email field is required</p>{/if}
+	{#if form?.incorrect}<p class="error">Invalid credentials!</p>{/if}
	<label>
		Email
-		<input name="email" type="email">
+		<input name="email" type="email" value={form?.email ?? ''}>
	</label>
	<label>
		Password
		<input name="password" type="password">
	</label>
	<button>Log in</button>
	<button formaction="?/register">Register</button>
</form>
```

The returned data must be serializable as JSON. Beyond that, the structure is entirely up to you. For example, if you had multiple forms on the page, you could distinguish which `<form>` the returned `form` data referred to with an `id` property or similar.

### Redirects

Redirects (and errors) work exactly the same as in [`load`](load#redirects):

```diff
/// file: src/routes/login/+page.server.js
+import { fail, redirect } from '@sveltejs/kit';

/** @type {import('./$types').Actions} */
export const actions = {
+	login: async ({ cookies, request, url }) => {
		const data = await request.formData();
		const email = data.get('email');
		const password = data.get('password');

		const user = await db.getUser(email);
		if (!user) {
			return fail(400, { email, missing: true });
		}

		if (user.password !== hash(password)) {
			return fail(400, { email, incorrect: true });
		}

		cookies.set('sessionid', await db.createSession(user), { path: '/' });

+		if (url.searchParams.has('redirectTo')) {
+			redirect(303, url.searchParams.get('redirectTo'));
+		}

		return { success: true };
	},
	register: async (event) => {
		// TODO register the user
	}
};
```

## Loading data

After an action runs, the page will be re-rendered (unless a redirect or an unexpected error occurs), with the action's return value available to the page as the `form` prop. This means that your page's `load` functions will run after the action completes.

Note that `handle` runs before the action is invoked, and does not rerun before the `load` functions. This means that if, for example, you use `handle` to populate `event.locals` based on a cookie, you must update `event.locals` when you set or delete the cookie in an action:

```js
/// file: src/hooks.server.js
// @filename: ambient.d.ts
declare namespace App {
	interface Locals {
		user: {
			name: string;
		} | null
	}
}

// @filename: global.d.ts
declare global {
	function getUser(sessionid: string | undefined): {
		name: string;
	};
}

export {};

// @filename: index.js
// ---cut---
/** @type {import('@sveltejs/kit').Handle} */
export async function handle({ event, resolve }) {
	event.locals.user = await getUser(event.cookies.get('sessionid'));
	return resolve(event);
}
```

```js
/// file: src/routes/account/+page.server.js
// @filename: ambient.d.ts
declare namespace App {
	interface Locals {
		user: {
			name: string;
		} | null
	}
}

// @filename: index.js
// ---cut---
/** @type {import('./$types').PageServerLoad} */
export function load(event) {
	return {
		user: event.locals.user
	};
}

/** @type {import('./$types').Actions} */
export const actions = {
	logout: async (event) => {
		event.cookies.delete('sessionid', { path: '/' });
		event.locals.user = null;
	}
};
```

## Progressive enhancement

In the preceding sections we built a `/login` action that [works without client-side JavaScript](https://kryogenix.org/code/browser/everyonehasjs.html) — not a `fetch` in sight. That's great, but when JavaScript _is_ available we can progressively enhance our form interactions to provide a better user experience.

### use:enhance

The easiest way to progressively enhance a form is to add the `use:enhance` action:

```diff
/// file: src/routes/login/+page.svelte
<script>
+	import { enhance } from '$app/forms';

	/** @type {import('./$types').ActionData} */
	export let form;
</script>

+<form method="POST" use:enhance>
```

> Yes, it's a little confusing that the `enhance` action and `<form action>` are both called 'action'. These docs are action-packed. Sorry.

Without an argument, `use:enhance` will emulate the browser-native behaviour, just without the full-page reloads. It will:

- update the `form` property, `$page.form` and `$page.status` on a successful or invalid response, but only if the action is on the same page you're submitting from. For example, if your form looks like `<form action="/somewhere/else" ..>`, `form` and `$page` will _not_ be updated. This is because in the native form submission case you would be redirected to the page the action is on. If you want to have them updated either way, use [`applyAction`](#progressive-enhancement-customising-use-enhance)
- reset the `<form>` element
- invalidate all data using `invalidateAll` on a successful response
- call `goto` on a redirect response
- render the nearest `+error` boundary if an error occurs
- [reset focus](accessibility#focus-management) to the appropriate element

### Customising use:enhance

To customise the behaviour, you can provide a `SubmitFunction` that runs immediately before the form is submitted, and (optionally) returns a callback that runs with the `ActionResult`. Note that if you return a callback, the default behavior mentioned above is not triggered. To get it back, call `update`.

```svelte
<form
	method="POST"
	use:enhance={({ formElement, formData, action, cancel, submitter }) => {
		// `formElement` is this `<form>` element
		// `formData` is its `FormData` object that's about to be submitted
		// `action` is the URL to which the form is posted
		// calling `cancel()` will prevent the submission
		// `submitter` is the `HTMLElement` that caused the form to be submitted

		return async ({ result, update }) => {
			// `result` is an `ActionResult` object
			// `update` is a function which triggers the default logic that would be triggered if this callback wasn't set
		};
	}}
>
```

You can use these functions to show and hide loading UI, and so on.

If you return a callback, you may need to reproduce part of the default `use:enhance` behaviour, but without invalidating all data on a successful response. You can do so with `applyAction`:

```diff
/// file: src/routes/login/+page.svelte
<script>
+	import { enhance, applyAction } from '$app/forms';

	/** @type {import('./$types').ActionData} */
	export let form;
</script>

<form
	method="POST"
	use:enhance={({ formElement, formData, action, cancel }) => {

		return async ({ result }) => {
			// `result` is an `ActionResult` object
+			if (result.type === 'redirect') {
+				goto(result.location);
+			} else {
+				await applyAction(result);
+			}
		};
	}}
>
```

The behaviour of `applyAction(result)` depends on `result.type`:

- `success`, `failure` — sets `$page.status` to `result.status` and updates `form` and `$page.form` to `result.data` (regardless of where you are submitting from, in contrast to `update` from `enhance`)
- `redirect` — calls `goto(result.location, { invalidateAll: true })`
- `error` — renders the nearest `+error` boundary with `result.error`

In all cases, [focus will be reset](accessibility#focus-management).

### Custom event listener

We can also implement progressive enhancement ourselves, without `use:enhance`, with a normal event listener on the `<form>`:

```svelte
<!--- file: src/routes/login/+page.svelte --->
<script>
	import { invalidateAll, goto } from '$app/navigation';
	import { applyAction, deserialize } from '$app/forms';

	/** @type {import('./$types').ActionData} */
	export let form;

	/** @type {any} */
	let error;

	/** @param {{ currentTarget: EventTarget & HTMLFormElement}} event */
	async function handleSubmit(event) {
		const data = new FormData(event.currentTarget);

		const response = await fetch(event.currentTarget.action, {
			method: 'POST',
			body: data
		});

		/** @type {import('@sveltejs/kit').ActionResult} */
		const result = deserialize(await response.text());

		if (result.type === 'success') {
			// rerun all `load` functions, following the successful update
			await invalidateAll();
		}

		applyAction(result);
	}
</script>

<form method="POST" on:submit|preventDefault={handleSubmit}>
	<!-- content -->
</form>
```

Note that you need to `deserialize` the response before processing it further using the corresponding method from `$app/forms`. `JSON.parse()` isn't enough because form actions - like `load` functions - also support returning `Date` or `BigInt` objects.

If you have a `+server.js` alongside your `+page.server.js`, `fetch` requests will be routed there by default. To `POST` to an action in `+page.server.js` instead, use the custom `x-sveltekit-action` header:

```diff
const response = await fetch(this.action, {
	method: 'POST',
	body: data,
+	headers: {
+		'x-sveltekit-action': 'true'
+	}
});
```

## Alternatives

Form actions are the preferred way to send data to the server, since they can be progressively enhanced, but you can also use [`+server.js`](routing#server) files to expose (for example) a JSON API. Here's how such an interaction could look like:

```svelte
<!--- file: send-message/+page.svelte --->
<script>
	function rerun() {
		fetch('/api/ci', {
			method: 'POST'
		});
	}
</script>

<button on:click={rerun}>Rerun CI</button>
```

```js
// @errors: 2355 1360 2322
/// file: api/ci/+server.js

/** @type {import('./$types').RequestHandler} */
export function POST() {
	// do something
}
```

## GET vs POST

As we've seen, to invoke a form action you must use `method="POST"`.

Some forms don't need to `POST` data to the server — search inputs, for example. For these you can use `method="GET"` (or, equivalently, no `method` at all), and SvelteKit will treat them like `<a>` elements, using the client-side router instead of a full page navigation:

```html
<form action="/search">
	<label>
		Search
		<input name="q">
	</label>
</form>
```

Submitting this form will navigate to `/search?q=...` and invoke your load function but will not invoke an action. As with `<a>` elements, you can set the [`data-sveltekit-reload`](link-options#data-sveltekit-reload), [`data-sveltekit-replacestate`](link-options#data-sveltekit-replacestate), [`data-sveltekit-keepfocus`](link-options#data-sveltekit-keepfocus) and [`data-sveltekit-noscroll`](link-options#data-sveltekit-noscroll) attributes on the `<form>` to control the router's behaviour.

## Further reading

- [Tutorial: Forms](https://learn.svelte.dev/tutorial/the-form-element)

####### documentation/docs/20-core-concepts/40-page-options.md #######

---
title: Page options
---

By default, SvelteKit will render (or [prerender](glossary#prerendering)) any component first on the server and send it to the client as HTML. It will then render the component again in the browser to make it interactive in a process called [**hydration**](glossary#hydration). For this reason, you need to ensure that components can run in both places. SvelteKit will then initialize a [**router**](routing) that takes over subsequent navigations.

You can control each of these on a page-by-page basis by exporting options from [`+page.js`](routing#page-page-js) or [`+page.server.js`](routing#page-page-server-js), or for groups of pages using a shared [`+layout.js`](routing#layout-layout-js) or [`+layout.server.js`](routing#layout-layout-server-js). To define an option for the whole app, export it from the root layout. Child layouts and pages override values set in parent layouts, so — for example — you can enable prerendering for your entire app then disable it for pages that need to be dynamically rendered.

You can mix and match these options in different areas of your app. For example you could prerender your marketing page for maximum speed, server-render your dynamic pages for SEO and accessibility and turn your admin section into an SPA by rendering it on the client only. This makes SvelteKit very versatile.

## prerender

It's likely that at least some routes of your app can be represented as a simple HTML file generated at build time. These routes can be [_prerendered_](glossary#prerendering).

```js
/// file: +page.js/+page.server.js/+server.js
export const prerender = true;
```

Alternatively, you can set `export const prerender = true` in your root `+layout.js` or `+layout.server.js` and prerender everything except pages that are explicitly marked as _not_ prerenderable:

```js
/// file: +page.js/+page.server.js/+server.js
export const prerender = false;
```

Routes with `prerender = true` will be excluded from manifests used for dynamic SSR, making your server (or serverless/edge functions) smaller. In some cases you might want to prerender a route but also include it in the manifest (for example, with a route like `/blog/[slug]` where you want to prerender your most recent/popular content but server-render the long tail) — for these cases, there's a third option, 'auto':

```js
/// file: +page.js/+page.server.js/+server.js
export const prerender = 'auto';
```

> If your entire app is suitable for prerendering, you can use [`adapter-static`](https://github.com/sveltejs/kit/tree/main/packages/adapter-static), which will output files suitable for use with any static webserver.

The prerenderer will start at the root of your app and generate files for any prerenderable pages or `+server.js` routes it finds. Each page is scanned for `<a>` elements that point to other pages that are candidates for prerendering — because of this, you generally don't need to specify which pages should be accessed. If you _do_ need to specify which pages should be accessed by the prerenderer, you can do so with [`config.kit.prerender.entries`](configuration#prerender), or by exporting an [`entries`](#entries) function from your dynamic route.

While prerendering, the value of `building` imported from [`$app/environment`](modules#$app-environment) will be `true`.

### Prerendering server routes

Unlike the other page options, `prerender` also applies to `+server.js` files. These files are _not_ affected by layouts, but will inherit default values from the pages that fetch data from them, if any. For example if a `+page.js` contains this `load` function...

```js
/// file: +page.js
export const prerender = true;

/** @type {import('./$types').PageLoad} */
export async function load({ fetch }) {
	const res = await fetch('/my-server-route.json');
	return await res.json();
}
```

...then `src/routes/my-server-route.json/+server.js` will be treated as prerenderable if it doesn't contain its own `export const prerender = false`.

### When not to prerender

The basic rule is this: for a page to be prerenderable, any two users hitting it directly must get the same content from the server.

> Not all pages are suitable for prerendering. Any content that is prerendered will be seen by all users. You can of course fetch personalized data in `onMount` in a prerendered page, but this may result in a poorer user experience since it will involve blank initial content or loading indicators.

Note that you can still prerender pages that load data based on the page's parameters, such as a `src/routes/blog/[slug]/+page.svelte` route.

Accessing [`url.searchParams`](load#using-url-data-url) during prerendering is forbidden. If you need to use it, ensure you are only doing so in the browser (for example in `onMount`).

Pages with [actions](form-actions) cannot be prerendered, because a server must be able to handle the action `POST` requests.

### Route conflicts

Because prerendering writes to the filesystem, it isn't possible to have two endpoints that would cause a directory and a file to have the same name. For example, `src/routes/foo/+server.js` and `src/routes/foo/bar/+server.js` would try to create `foo` and `foo/bar`, which is impossible.

For that reason among others, it's recommended that you always include a file extension — `src/routes/foo.json/+server.js` and `src/routes/foo/bar.json/+server.js` would result in `foo.json` and `foo/bar.json` files living harmoniously side-by-side.

For _pages_, we skirt around this problem by writing `foo/index.html` instead of `foo`.

### Troubleshooting

If you encounter an error like 'The following routes were marked as prerenderable, but were not prerendered' it's because the route in question (or a parent layout, if it's a page) has `export const prerender = true` but the page wasn't actually prerendered, because it wasn't reached by the prerendering crawler.

Since these routes cannot be dynamically server-rendered, this will cause errors when people try to access the route in question. There are two ways to fix it:

* Ensure that SvelteKit can find the route by following links from [`config.kit.prerender.entries`](configuration#prerender) or the [`entries`](#entries) page option. Add links to dynamic routes (i.e. pages with `[parameters]` ) to this option if they are not found through crawling the other entry points, else they are not prerendered because SvelteKit doesn't know what value the parameters should have. Pages not marked as prerenderable will be ignored and their links to other pages will not be crawled, even if some of them would be prerenderable.
* Change `export const prerender = true` to `export const prerender = 'auto'`. Routes with `'auto'` can be dynamically server rendered

## entries

SvelteKit will discover pages to prerender automatically, by starting at _entry points_ and crawling them. By default, all your non-dynamic routes are considered entry points — for example, if you have these routes...

```bash
/             # non-dynamic
/blog         # non-dynamic
/blog/[slug]  # dynamic, because of `[slug]`
```

...SvelteKit will prerender `/` and `/blog`, and in the process discover links like `<a href="/blog/hello-world">` which give it new pages to prerender.

Most of the time, that's enough. In some situations, links to pages like `/blog/hello-world` might not exist (or might not exist on prerendered pages), in which case we need to tell SvelteKit about their existence.

This can be done with [`config.kit.prerender.entries`](configuration#prerender), or by exporting an `entries` function from a `+page.js`, a `+page.server.js` or a `+server.js` belonging to a dynamic route:

```js
/// file: src/routes/blog/[slug]/+page.server.js
/** @type {import('./$types').EntryGenerator} */
export function entries() {
	return [
		{ slug: 'hello-world' },
		{ slug: 'another-blog-post' }
	];
}

export const prerender = true;
```

`entries` can be an `async` function, allowing you to (for example) retrieve a list of posts from a CMS or database, in the example above.

## ssr

Normally, SvelteKit renders your page on the server first and sends that HTML to the client where it's [hydrated](glossary#hydration). If you set `ssr` to `false`, it renders an empty 'shell' page instead. This is useful if your page is unable to be rendered on the server (because you use browser-only globals like `document` for example), but in most situations it's not recommended ([see appendix](glossary#ssr)).

```js
/// file: +page.js
export const ssr = false;
// If both `ssr` and `csr` are `false`, nothing will be rendered!
```

If you add `export const ssr = false` to your root `+layout.js`, your entire app will only be rendered on the client — which essentially means you turn your app into an SPA.

## csr

Ordinarily, SvelteKit [hydrates](glossary#hydration) your server-rendered HTML into an interactive client-side-rendered (CSR) page. Some pages don't require JavaScript at all — many blog posts and 'about' pages fall into this category. In these cases you can disable CSR:

```js
/// file: +page.js
export const csr = false;
// If both `csr` and `ssr` are `false`, nothing will be rendered!
```

Disabling CSR does not ship any JavaScript to the client. This means:

* The webpage should work with HTML and CSS only.
* `<script>` tags inside all Svelte components are removed.
* `<form>` elements cannot be [progressively enhanced](form-actions#progressive-enhancement).
* Links are handled by the browser with a full-page navigation.

## trailingSlash

By default, SvelteKit will remove trailing slashes from URLs — if you visit `/about/`, it will respond with a redirect to `/about`. You can change this behaviour with the `trailingSlash` option, which can be one of `'never'` (the default), `'always'`, or `'ignore'`.

As with other page options, you can export this value from a `+layout.js` or a `+layout.server.js` and it will apply to all child pages. You can also export the configuration from `+server.js` files.

```js
/// file: src/routes/+layout.js
export const trailingSlash = 'always';
```

This option also affects [prerendering](#prerender). If `trailingSlash` is `always`, a route like `/about` will result in an `about/index.html` file, otherwise it will create `about.html`, mirroring static webserver conventions.

> Ignoring trailing slashes is not recommended — the semantics of relative paths differ between the two cases (`./y` from `/x` is `/y`, but from `/x/` is `/x/y`), and `/x` and `/x/` are treated as separate URLs which is harmful to SEO.

## config

With the concept of [adapters](adapters), SvelteKit is able to run on a variety of platforms. Each of these might have specific configuration to further tweak the deployment — for example on Vercel you could choose to deploy some parts of your app on the edge and others on serverless environments.

`config` is an object with key-value pairs at the top level. Beyond that, the concrete shape is dependent on the adapter you're using. Every adapter should provide a `Config` interface to import for type safety. Consult the documentation of your adapter for more information.

```js
// @filename: ambient.d.ts
declare module 'some-adapter' {
	export interface Config { runtime: string }
}

// @filename: index.js
// ---cut---
/// file: src/routes/+page.js
/** @type {import('some-adapter').Config} */
export const config = {
	runtime: 'edge'
};
```

`config` objects are merged at the top level (but _not_ deeper levels). This means you don't need to repeat all the values in a `+page.js` if you want to only override some of the values in the upper `+layout.js`. For example this layout configuration...

```js
/// file: src/routes/+layout.js
export const config = {
	runtime: 'edge',
	regions: 'all',
	foo: {
		bar: true
	}
}
```

...is overridden by this page configuration...

```js
/// file: src/routes/+page.js
export const config = {
	regions: ['us1', 'us2'],
	foo: {
		baz: true
	}
}
```

...which results in the config value `{ runtime: 'edge', regions: ['us1', 'us2'], foo: { baz: true } }` for that page.

## Further reading

- [Tutorial: Page options](https://learn.svelte.dev/tutorial/page-options)

####### documentation/docs/20-core-concepts/50-state-management.md #######

---
title: State management
---

If you're used to building client-only apps, state management in an app that spans server and client might seem intimidating. This section provides tips for avoiding some common gotchas.

## Avoid shared state on the server

Browsers are _stateful_ — state is stored in memory as the user interacts with the application. Servers, on the other hand, are _stateless_ — the content of the response is determined entirely by the content of the request.

Conceptually, that is. In reality, servers are often long-lived and shared by multiple users. For that reason it's important not to store data in shared variables. For example, consider this code:

```js
// @errors: 7034 7005
/// file: +page.server.js
let user;

/** @type {import('./$types').PageServerLoad} */
export function load() {
	return { user };
}

/** @type {import('./$types').Actions} */
export const actions = {
	default: async ({ request }) => {
		const data = await request.formData();

		// NEVER DO THIS!
		user = {
			name: data.get('name'),
			embarrassingSecret: data.get('secret')
		};
	}
}
```

The `user` variable is shared by everyone who connects to this server. If Alice submitted an embarrassing secret, and Bob visited the page after her, Bob would know Alice's secret. In addition, when Alice returns to the site later in the day, the server may have restarted, losing her data.

Instead, you should _authenticate_ the user using [`cookies`](load#cookies) and persist the data to a database.

## No side-effects in load

For the same reason, your `load` functions should be _pure_ — no side-effects (except maybe the occasional `console.log(...)`). For example, you might be tempted to write to a store inside a `load` function so that you can use the store value in your components:

```js
/// file: +page.js
// @filename: ambient.d.ts
declare module '$lib/user' {
	export const user: { set: (value: any) => void };
}

// @filename: index.js
// ---cut---
import { user } from '$lib/user';

/** @type {import('./$types').PageLoad} */
export async function load({ fetch }) {
	const response = await fetch('/api/user');

	// NEVER DO THIS!
	user.set(await response.json());
}
```

As with the previous example, this puts one user's information in a place that is shared by _all_ users. Instead, just return the data...

```diff
/// file: +page.js
export async function load({ fetch }) {
	const response = await fetch('/api/user');

+	return {
+		user: await response.json()
+	};
}
```

...and pass it around to the components that need it, or use [`$page.data`](load#$page-data).

If you're not using SSR, then there's no risk of accidentally exposing one user's data to another. But you should still avoid side-effects in your `load` functions — your application will be much easier to reason about without them.

## Using stores with context

You might wonder how we're able to use `$page.data` and other [app stores](modules#$app-stores) if we can't use our own stores. The answer is that app stores on the server use Svelte's [context API](https://learn.svelte.dev/tutorial/context-api) — the store is attached to the component tree with `setContext`, and when you subscribe you retrieve it with `getContext`. We can do the same thing with our own stores:

```svelte
<!--- file: src/routes/+layout.svelte --->
<script>
	import { setContext } from 'svelte';
	import { writable } from 'svelte/store';

	/** @type {import('./$types').LayoutData} */
	export let data;

	// Create a store and update it when necessary...
	const user = writable();
	$: user.set(data.user);

	// ...and add it to the context for child components to access
	setContext('user', user);
</script>
```

```svelte
<!--- file: src/routes/user/+page.svelte --->
<script>
	import { getContext } from 'svelte';

	// Retrieve user store from context
	const user = getContext('user');
</script>

<p>Welcome {$user.name}</p>
```

Updating the value of a context-based store in deeper-level pages or components while the page is being rendered via SSR will not affect the value in the parent component because it has already been rendered by the time the store value is updated. In contrast, on the client (when CSR is enabled, which is the default) the value will be propagated and components, pages, and layouts higher in the hierarchy will react to the new value. Therefore, to avoid values 'flashing' during state updates during hydration, it is generally recommended to pass state down into components rather than up.

If you're not using SSR (and can guarantee that you won't need to use SSR in future) then you can safely keep state in a shared module, without using the context API.

## Component and page state is preserved

When you navigate around your application, SvelteKit reuses existing layout and page components. For example, if you have a route like this...

```svelte
<!--- file: src/routes/blog/[slug]/+page.svelte --->
<script>
	/** @type {import('./$types').PageData} */
	export let data;

	// THIS CODE IS BUGGY!
	const wordCount = data.content.split(' ').length;
	const estimatedReadingTime = wordCount / 250;
</script>

<header>
	<h1>{data.title}</h1>
	<p>Reading time: {Math.round(estimatedReadingTime)} minutes</p>
</header>

<div>{@html data.content}</div>
```

...then navigating from `/blog/my-short-post` to `/blog/my-long-post` won't cause the layout, page and any other components within to be destroyed and recreated. Instead the `data` prop (and by extension `data.title` and `data.content`) will update (as it would with any other Svelte component) and, because the code isn't rerunning, lifecycle methods like `onMount` and `onDestroy` won't rerun and `estimatedReadingTime` won't be recalculated.

Instead, we need to make the value [_reactive_](https://learn.svelte.dev/tutorial/reactive-assignments):

```diff
/// file: src/routes/blog/[slug]/+page.svelte
<script>
	/** @type {import('./$types').PageData} */
	export let data;

+	$: wordCount = data.content.split(' ').length;
+	$: estimatedReadingTime = wordCount / 250;
</script>
```

> If your code in `onMount` and `onDestroy` has to run again after navigation you can use [afterNavigate](modules#$app-navigation-afternavigate) and [beforeNavigate](modules#$app-navigation-beforenavigate) respectively.

Reusing components like this means that things like sidebar scroll state are preserved, and you can easily animate between changing values. In the case that you do need to completely destroy and remount a component on navigation, you can use this pattern:

```svelte
{#key $page.url.pathname}
	<BlogPost title={data.title} content={data.title} />
{/key}
```

## Storing state in the URL

If you have state that should survive a reload and/or affect SSR, such as filters or sorting rules on a table, URL search parameters (like `?sort=price&order=ascending`) are a good place to put them. You can put them in `<a href="...">` or `<form action="...">` attributes, or set them programmatically via `goto('?key=value')`. They can be accessed inside `load` functions via the `url` parameter, and inside components via `$page.url.searchParams`.

## Storing ephemeral state in snapshots

Some UI state, such as 'is the accordion open?', is disposable — if the user navigates away or refreshes the page, it doesn't matter if the state is lost. In some cases, you _do_ want the data to persist if the user navigates to a different page and comes back, but storing the state in the URL or in a database would be overkill. For this, SvelteKit provides [snapshots](snapshots), which let you associate component state with a history entry.

####### documentation/docs/20-core-concepts/meta.json #######

```

{
	"title": "Core concepts"
}

```


####### documentation/docs/25-build-and-deploy/10-building-your-app.md #######

---
title: Building your app
---

Building a SvelteKit app happens in two stages, which both happen when you run `vite build` (usually via `npm run build`).

Firstly, Vite creates an optimized production build of your server code, your browser code, and your service worker (if you have one). [Prerendering](page-options#prerender) is executed at this stage, if appropriate.

Secondly, an _adapter_ takes this production build and tunes it for your target environment — more on this on the following pages.

## During the build

SvelteKit will load your `+page/layout(.server).js` files (and all files they import) for analysis during the build. Any code that should _not_ be executed at this stage must check that `building` from [`$app/environment`](modules#$app-environment) is `false`:

```diff
+import { building } from '$app/environment';
import { setupMyDatabase } from '$lib/server/database';

+if (!building) {
	setupMyDatabase();
+}

export function load() {
	// ...
}
```

## Preview your app

After building, you can view your production build locally with `vite preview` (via `npm run preview`). Note that this will run the app in Node, and so is not a perfect reproduction of your deployed app — adapter-specific adjustments like the [`platform` object](adapters#platform-specific-context) do not apply to previews.

####### documentation/docs/25-build-and-deploy/20-adapters.md #######

---
title: Adapters
---

Before you can deploy your SvelteKit app, you need to _adapt_ it for your deployment target. Adapters are small plugins that take the built app as input and generate output for deployment.

Official adapters exist for a variety of platforms — these are documented on the following pages:

- [`@sveltejs/adapter-cloudflare`](adapter-cloudflare) for Cloudflare Pages
- [`@sveltejs/adapter-cloudflare-workers`](adapter-cloudflare-workers) for Cloudflare Workers
- [`@sveltejs/adapter-netlify`](adapter-netlify) for Netlify
- [`@sveltejs/adapter-node`](adapter-node) for Node servers
- [`@sveltejs/adapter-static`](adapter-static) for static site generation (SSG)
- [`@sveltejs/adapter-vercel`](adapter-vercel) for Vercel

Additional [community-provided adapters](https://sveltesociety.dev/packages?category=sveltekit-adapters) exist for other platforms.

## Using adapters

Your adapter is specified in `svelte.config.js`:

```js
/// file: svelte.config.js
// @filename: ambient.d.ts
declare module 'svelte-adapter-foo' {
	const adapter: (opts: any) => import('@sveltejs/kit').Adapter;
	export default adapter;
}

// @filename: index.js
// ---cut---
import adapter from 'svelte-adapter-foo';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter({
			// adapter options go here
		})
	}
};

export default config;
```

## Platform-specific context

Some adapters may have access to additional information about the request. For example, Cloudflare Workers can access an `env` object containing KV namespaces etc. This can be passed to the `RequestEvent` used in [hooks](hooks) and [server routes](routing#server) as the `platform` property — consult each adapter's documentation to learn more.


####### documentation/docs/25-build-and-deploy/30-adapter-auto.md #######

---
title: Zero-config deployments
---

When you create a new SvelteKit project with `npm create svelte@latest`, it installs [`adapter-auto`](https://github.com/sveltejs/kit/tree/main/packages/adapter-auto) by default. This adapter automatically installs and uses the correct adapter for supported environments when you deploy:

- [`@sveltejs/adapter-cloudflare`](adapter-cloudflare) for [Cloudflare Pages](https://developers.cloudflare.com/pages/)
- [`@sveltejs/adapter-netlify`](adapter-netlify) for [Netlify](https://netlify.com/)
- [`@sveltejs/adapter-vercel`](adapter-vercel) for [Vercel](https://vercel.com/)
- [`svelte-adapter-azure-swa`](https://github.com/geoffrich/svelte-adapter-azure-swa) for [Azure Static Web Apps](https://docs.microsoft.com/en-us/azure/static-web-apps/)
- [`svelte-kit-sst`](https://github.com/sst/sst/tree/master/packages/svelte-kit-sst) for [AWS via SST](https://docs.sst.dev/start/svelte)
- [`@sveltejs/adapter-node`](https://kit.svelte.dev/docs/adapter-node) for [Google Cloud Run](https://cloud.google.com/run)

It's recommended to install the appropriate adapter to your `devDependencies` once you've settled on a target environment, since this will add the adapter to your lockfile and slightly improve install times on CI.

## Environment-specific configuration

To add configuration options, such as `{ edge: true }` in [`adapter-vercel`](adapter-vercel) and [`adapter-netlify`](adapter-netlify), you must install the underlying adapter — `adapter-auto` does not take any options.

## Adding community adapters

You can add zero-config support for additional adapters by editing [adapters.js](https://github.com/sveltejs/kit/blob/main/packages/adapter-auto/adapters.js) and opening a pull request.

####### documentation/docs/25-build-and-deploy/40-adapter-node.md #######

---
title: Node servers
---

To generate a standalone Node server, use [`adapter-node`](https://github.com/sveltejs/kit/tree/main/packages/adapter-node).

## Usage

Install with `npm i -D @sveltejs/adapter-node`, then add the adapter to your `svelte.config.js`:

```js
// @errors: 2307
/// file: svelte.config.js
import adapter from '@sveltejs/adapter-node';

export default {
	kit: {
		adapter: adapter()
	}
};
```

## Deploying

First, build your app with `npm run build`. This will create the production server in the output directory specified in the adapter options, defaulting to `build`.

You will need the output directory, the project's `package.json`, and the production dependencies in `node_modules` to run the application. Production dependencies can be generated by copying the `package.json` and `package-lock.json` and then running `npm ci --omit dev` (you can skip this step if your app doesn't have any dependencies). You can then start your app with this command:

```bash
node build
```

Development dependencies will be bundled into your app using [Rollup](https://rollupjs.org). To control whether a given package is bundled or externalised, place it in `devDependencies` or `dependencies` respectively in your `package.json`.

### Compressing responses

You will typically want to compress responses coming from the server. If you are already deploying your server behind a reverse proxy for SSL or load balancing, it typically results in better performance to also handle compression at that layer since Node.js is single-threaded.

However, if you're building a [custom server](#custom-server) and do want to add a compression middleware there, note that we would recommend using [`@polka/compression`](https://www.npmjs.com/package/@polka/compression) since SvelteKit streams responses and the more popular `compression` package does not support streaming and may cause errors when used.

## Environment variables

In `dev` and `preview`, SvelteKit will read environment variables from your `.env` file (or `.env.local`, or `.env.[mode]`, [as determined by Vite](https://vitejs.dev/guide/env-and-mode.html#env-files).)

In production, `.env` files are _not_ automatically loaded. To do so, install `dotenv` in your project...

```bash
npm install dotenv
```

...and invoke it before running the built app:

```diff
-node build
+node -r dotenv/config build
```

### `PORT`, `HOST` and `SOCKET_PATH`

By default, the server will accept connections on `0.0.0.0` using port 3000. These can be customised with the `PORT` and `HOST` environment variables:

```
HOST=127.0.0.1 PORT=4000 node build
```

Alternatively, the server can be configured to accept connections on a specified socket path. When this is done using the `SOCKET_PATH` environment variable, the `HOST` and `PORT` environment variables will be disregarded.

```
SOCKET_PATH=/tmp/socket node build
```

### `ORIGIN`, `PROTOCOL_HEADER`, `HOST_HEADER`, and `PORT_HEADER`

HTTP doesn't give SvelteKit a reliable way to know the URL that is currently being requested. The simplest way to tell SvelteKit where the app is being served is to set the `ORIGIN` environment variable:

```
ORIGIN=https://my.site node build

# or e.g. for local previewing and testing
ORIGIN=http://localhost:3000 node build
```

With this, a request for the `/stuff` pathname will correctly resolve to `https://my.site/stuff`. Alternatively, you can specify headers that tell SvelteKit about the request protocol and host, from which it can construct the origin URL:

```
PROTOCOL_HEADER=x-forwarded-proto HOST_HEADER=x-forwarded-host node build
```

> [`x-forwarded-proto`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-Proto) and [`x-forwarded-host`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-Host) are de facto standard headers that forward the original protocol and host if you're using a reverse proxy (think load balancers and CDNs). You should only set these variables if your server is behind a trusted reverse proxy; otherwise, it'd be possible for clients to spoof these headers.
>
> If you're hosting your proxy on a non-standard port and your reverse proxy supports `x-forwarded-port`, you can also set `PORT_HEADER=x-forwarded-port`.

If `adapter-node` can't correctly determine the URL of your deployment, you may experience this error when using [form actions](form-actions):

> Cross-site POST form submissions are forbidden

### `ADDRESS_HEADER` and `XFF_DEPTH`

The [RequestEvent](types#public-types-requestevent) object passed to hooks and endpoints includes an `event.getClientAddress()` function that returns the client's IP address. By default this is the connecting `remoteAddress`. If your server is behind one or more proxies (such as a load balancer), this value will contain the innermost proxy's IP address rather than the client's, so we need to specify an `ADDRESS_HEADER` to read the address from:

```
ADDRESS_HEADER=True-Client-IP node build
```

> Headers can easily be spoofed. As with `PROTOCOL_HEADER` and `HOST_HEADER`, you should [know what you're doing](https://adam-p.ca/blog/2022/03/x-forwarded-for/) before setting these.

If the `ADDRESS_HEADER` is `X-Forwarded-For`, the header value will contain a comma-separated list of IP addresses. The `XFF_DEPTH` environment variable should specify how many trusted proxies sit in front of your server. E.g. if there are three trusted proxies, proxy 3 will forward the addresses of the original connection and the first two proxies:

```
<client address>, <proxy 1 address>, <proxy 2 address>
```

Some guides will tell you to read the left-most address, but this leaves you [vulnerable to spoofing](https://adam-p.ca/blog/2022/03/x-forwarded-for/):

```
<spoofed address>, <client address>, <proxy 1 address>, <proxy 2 address>
```

We instead read from the _right_, accounting for the number of trusted proxies. In this case, we would use `XFF_DEPTH=3`.

> If you need to read the left-most address instead (and don't care about spoofing) — for example, to offer a geolocation service, where it's more important for the IP address to be _real_ than _trusted_, you can do so by inspecting the `x-forwarded-for` header within your app.

### `BODY_SIZE_LIMIT`

The maximum request body size to accept in bytes including while streaming. Defaults to 512kb. You can disable this option with a value of `Infinity` (0 in older versions of the adapter) and implement a custom check in [`handle`](hooks#server-hooks-handle) if you need something more advanced.

### `SHUTDOWN_TIMEOUT`

The number of seconds to wait before forcefully closing any remaining connections after receiving a `SIGTERM` or `SIGINT` signal. Defaults to `30`. Internally the adapter calls [`closeAllConnections`](https://nodejs.org/api/http.html#servercloseallconnections). See [Graceful shutdown](#graceful-shutdown) for more details.

### `IDLE_TIMEOUT`

When using systemd socket activation, `IDLE_TIMEOUT` specifies the number of seconds after which the app is automatically put to sleep when receiving no requests. If not set, the app runs continuously. See [Socket activation](#socket-activation) for more details.

## Options

The adapter can be configured with various options:

```js
// @errors: 2307
/// file: svelte.config.js
import adapter from '@sveltejs/adapter-node';

export default {
	kit: {
		adapter: adapter({
			// default options are shown
			out: 'build',
			precompress: true,
			envPrefix: ''
		})
	}
};
```

### out

The directory to build the server to. It defaults to `build` — i.e. `node build` would start the server locally after it has been created.

### precompress

Enables precompressing using gzip and brotli for assets and prerendered pages. It defaults to `true`.

### envPrefix

If you need to change the name of the environment variables used to configure the deployment (for example, to deconflict with environment variables you don't control), you can specify a prefix:

```js
envPrefix: 'MY_CUSTOM_';
```

```sh
MY_CUSTOM_HOST=127.0.0.1 \
MY_CUSTOM_PORT=4000 \
MY_CUSTOM_ORIGIN=https://my.site \
node build
```

## Graceful shutdown

By default `adapter-node` gracefully shuts down the HTTP server when a `SIGTERM` or `SIGINT` signal is received. It will:

1. reject new requests ([`server.close`](https://nodejs.org/api/http.html#serverclosecallback))
2. wait for requests that have already been made but not received a response yet to finish and close connections once they become idle ([`server.closeIdleConnections`](https://nodejs.org/api/http.html#servercloseidleconnections))
3. and finally, close any remaining connections that are still active after [`SHUTDOWN_TIMEOUT`](#environment-variables-shutdown-timeout) seconds. ([`server.closeAllConnections`](https://nodejs.org/api/http.html#servercloseallconnections))

> If you want to customize this behaviour you can use a [custom server](#custom-server).

## Socket activation

Most Linux operating systems today use a modern process manager called systemd to start the server and run and manage services. You can configure your server to allocate a socket and start and scale your app on demand. This is called [socket activation](http://0pointer.de/blog/projects/socket-activated-containers.html). In this case, the OS will pass two environment variables to your app — `LISTEN_PID` and `LISTEN_FDS`. The adapter will then listen on file descriptor 3 which refers to a systemd socket unit that you will have to create.

> You can still use [`envPrefix`](#options-envprefix) with systemd socket activation. `LISTEN_PID` and `LISTEN_FDS` are always read without a prefix.

To take advantage of socket activation follow these steps.

1. Run your app as a [systemd service](https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html). It can either run directly on the host system or inside a container (using Docker or a systemd portable service for example). If you additionally pass an [`IDLE_TIMEOUT`](#environment-variables-idle-timeout) environment variable to your app it will gracefully shutdown if there are no requests for `IDLE_TIMEOUT` seconds. systemd will automatically start your app again when new requests are coming in.

```ini
/// file: /etc/systemd/system/myapp.service
[Service]
Environment=NODE_ENV=production IDLE_TIMEOUT=60
ExecStart=/usr/bin/node /usr/bin/myapp/build
```

2. Create an accompanying [socket unit](https://www.freedesktop.org/software/systemd/man/latest/systemd.socket.html). The adapter only accepts a single socket.

```ini
/// file: /etc/systemd/system/myapp.socket
[Socket]
ListenStream=3000

[Install]
WantedBy=sockets.target
```

3. Make sure systemd has recognised both units by running `sudo systemctl daemon-reload`. Then enable the socket on boot and start it immediately using `sudo systemctl enable --now myapp.socket`. The app will then automatically start once the first request is made to `localhost:3000`.

## Custom server

The adapter creates two files in your build directory — `index.js` and `handler.js`. Running `index.js` — e.g. `node build`, if you use the default build directory — will start a server on the configured port.

Alternatively, you can import the `handler.js` file, which exports a handler suitable for use with [Express](https://github.com/expressjs/express), [Connect](https://github.com/senchalabs/connect) or [Polka](https://github.com/lukeed/polka) (or even just the built-in [`http.createServer`](https://nodejs.org/dist/latest/docs/api/http.html#httpcreateserveroptions-requestlistener)) and set up your own server:

```js
// @errors: 2307 7006
/// file: my-server.js
import { handler } from './build/handler.js';
import express from 'express';

const app = express();

// add a route that lives separately from the SvelteKit app
app.get('/healthcheck', (req, res) => {
	res.end('ok');
});

// let SvelteKit handle everything else, including serving prerendered pages and static assets
app.use(handler);

app.listen(3000, () => {
	console.log('listening on port 3000');
});
```

## Troubleshooting

### Is there a hook for cleaning up before the app exits?

There's nothing built-in to SvelteKit for this, because such a cleanup hook depends highly on the execution environment you're on. For Node, you can use its built-in `process.on(...)` to implement a callback that runs before the app exits:

```js
// @errors: 2304 2580
function shutdownGracefully() {
	// anything you need to clean up manually goes in here
	db.shutdown();
}

process.on('exit', shutdownGracefully);
```

####### documentation/docs/25-build-and-deploy/50-adapter-static.md #######

---
title: Static site generation
---

To use SvelteKit as a static site generator (SSG), use [`adapter-static`](https://github.com/sveltejs/kit/tree/main/packages/adapter-static).

This will prerender your entire site as a collection of static files. If you'd like to prerender only some pages and dynamically server-render others, you will need to use a different adapter together with [the `prerender` option](page-options#prerender).

## Usage

Install with `npm i -D @sveltejs/adapter-static`, then add the adapter to your `svelte.config.js`:

```js
// @errors: 2307
/// file: svelte.config.js
import adapter from '@sveltejs/adapter-static';

export default {
	kit: {
		adapter: adapter({
			// default options are shown. On some platforms
			// these options are set automatically — see below
			pages: 'build',
			assets: 'build',
			fallback: undefined,
			precompress: false,
			strict: true
		})
	}
};
```

...and add the [`prerender`](page-options#prerender) option to your root layout:

```js
/// file: src/routes/+layout.js
// This can be false if you're using a fallback (i.e. SPA mode)
export const prerender = true;
```

> You must ensure SvelteKit's [`trailingSlash`](page-options#trailingslash) option is set appropriately for your environment. If your host does not render `/a.html` upon receiving a request for `/a` then you will need to set `trailingSlash: 'always'` in your root layout to create `/a/index.html` instead.

## Zero-config support

Some platforms have zero-config support (more to come in future):

- [Vercel](https://vercel.com)

On these platforms, you should omit the adapter options so that `adapter-static` can provide the optimal configuration:

```diff
/// file: svelte.config.js
export default {
	kit: {
-		adapter: adapter({...})
+		adapter: adapter()
	}
};
```

## Options

### pages

The directory to write prerendered pages to. It defaults to `build`.

### assets

The directory to write static assets (the contents of `static`, plus client-side JS and CSS generated by SvelteKit) to. Ordinarily this should be the same as `pages`, and it will default to whatever the value of `pages` is, but in rare circumstances you might need to output pages and assets to separate locations.

### fallback

Specify a fallback page for [SPA mode](single-page-apps), e.g. `index.html` or `200.html` or `404.html`.

### precompress

If `true`, precompresses files with brotli and gzip. This will generate `.br` and `.gz` files.

### strict

By default, `adapter-static` checks that either all pages and endpoints (if any) of your app were prerendered, or you have the `fallback` option set. This check exists to prevent you from accidentally publishing an app where some parts of it are not accessible, because they are not contained in the final output. If you know this is ok (for example when a certain page only exists conditionally), you can set `strict` to `false` to turn off this check.

## GitHub Pages

When building for [GitHub Pages](https://docs.github.com/en/pages/getting-started-with-github-pages/about-github-pages), if your repo name is not equivalent to `your-username.github.io`, make sure to update [`config.kit.paths.base`](configuration#paths) to match your repo name. This is because the site will be served from `https://your-username.github.io/your-repo-name` rather than from the root.

You'll also want to generate a fallback `404.html` page to replace the default 404 page shown by GitHub Pages.

A config for GitHub Pages might look like the following:

```js
// @errors: 2307 2322
/// file: svelte.config.js
import adapter from '@sveltejs/adapter-static';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter({
			fallback: '404.html'
		}),
		paths: {
			base: process.argv.includes('dev') ? '' : process.env.BASE_PATH
		}
	}
};

export default config;
```

You can use GitHub actions to automatically deploy your site to GitHub Pages when you make a change. Here's an example workflow:

```yaml
### file: .github/workflows/deploy.yml
name: Deploy to GitHub Pages

on:
  push:
    branches: 'main'

jobs:
  build_site:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # If you're using pnpm, add this step then change the commands and cache key below to use `pnpm`
      # - name: Install pnpm
      #   uses: pnpm/action-setup@v3
      #   with:
      #     version: 8

      - name: Install Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      - name: Install dependencies
        run: npm install

      - name: build
        env:
          BASE_PATH: '/${{ github.event.repository.name }}'
        run: |
          npm run build

      - name: Upload Artifacts
        uses: actions/upload-pages-artifact@v3
        with:
          # this should match the `pages` option in your adapter-static options
          path: 'build/'

  deploy:
    needs: build_site
    runs-on: ubuntu-latest

    permissions:
      pages: write
      id-token: write

    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: Deploy
        id: deployment
        uses: actions/deploy-pages@v4
```

If you're not using GitHub actions to deploy your site (for example, you're pushing the built site to its own repo), add an empty `.nojekyll` file in your `static` directory to prevent Jekyll from interfering.

####### documentation/docs/25-build-and-deploy/55-single-page-apps.md #######

---
title: Single-page apps
---

You can turn any SvelteKit app, using any adapter, into a fully client-rendered single-page app (SPA) by disabling SSR at the root layout:

```js
/// file: src/routes/+layout.js
export const ssr = false;
```

> In most situations this is not recommended: it harms SEO, tends to slow down perceived performance, and makes your app inaccessible to users if JavaScript fails or is disabled (which happens [more often than you probably think](https://kryogenix.org/code/browser/everyonehasjs.html)).

If you don't have any server-side logic (i.e. `+page.server.js`, `+layout.server.js` or `+server.js` files) you can use [`adapter-static`](adapter-static) to create your SPA by adding a _fallback page_.

## Usage

Install with `npm i -D @sveltejs/adapter-static`, then add the adapter to your `svelte.config.js` with the following options:

```js
// @errors: 2307
/// file: svelte.config.js
import adapter from '@sveltejs/adapter-static';

export default {
	kit: {
		adapter: adapter({
			fallback: '200.html' // may differ from host to host
		})
	}
};
```

The `fallback` page is an HTML page created by SvelteKit from your page template (e.g. `app.html`) that loads your app and navigates to the correct route. For example [Surge](https://surge.sh/help/adding-a-200-page-for-client-side-routing), a static web host, lets you add a `200.html` file that will handle any requests that don't correspond to static assets or prerendered pages.

On some hosts it may be `index.html` or something else entirely — consult your platform's documentation.

> Note that the fallback page will always contain absolute asset paths (i.e. beginning with `/` rather than `.`) regardless of the value of [`paths.relative`](/docs/configuration#paths), since it is used to respond to requests for arbitrary paths.

## Apache

To run an SPA on [Apache](https://httpd.apache.org/), you should add a `static/.htaccess` file to route requests to the fallback page:

```
<IfModule mod_rewrite.c>
	RewriteEngine On
	RewriteBase /
	RewriteRule ^200\.html$ - [L]
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteRule . /200.html [L]
</IfModule>
```

## Prerendering individual pages

If you want certain pages to be prerendered, you can re-enable `ssr` alongside `prerender` for just those parts of your app:

```js
/// file: src/routes/my-prerendered-page/+page.js
export const prerender = true;
export const ssr = true;
```

####### documentation/docs/25-build-and-deploy/60-adapter-cloudflare.md #######

---
title: Cloudflare Pages
---

To deploy to [Cloudflare Pages](https://developers.cloudflare.com/pages/), use [`adapter-cloudflare`](https://github.com/sveltejs/kit/tree/main/packages/adapter-cloudflare).

This adapter will be installed by default when you use [`adapter-auto`](adapter-auto). If you plan on staying with Cloudflare Pages, you can switch from [`adapter-auto`](adapter-auto) to using this adapter directly so that values specific to Cloudflare Workers are emulated during local development, type declarations are automatically applied, and the ability to set Cloudflare-specific options is provided.

## Comparisons

- `adapter-cloudflare` – supports all SvelteKit features; builds for [Cloudflare Pages](https://blog.cloudflare.com/cloudflare-pages-goes-full-stack/)
- `adapter-cloudflare-workers` – supports all SvelteKit features; builds for Cloudflare Workers
- `adapter-static` – only produces client-side static assets; compatible with Cloudflare Pages

## Usage

Install with `npm i -D @sveltejs/adapter-cloudflare`, then add the adapter to your `svelte.config.js`:

```js
// @errors: 2307
/// file: svelte.config.js
import adapter from '@sveltejs/adapter-cloudflare';

export default {
	kit: {
		adapter: adapter({
			// See below for an explanation of these options
			routes: {
				include: ['/*'],
				exclude: ['<all>']
			},
      platformProxy: {
        persist: './your-custom-path'
      }
		})
	}
};
```

## Options

### routes

Allows you to customise the [`_routes.json`](https://developers.cloudflare.com/pages/platform/functions/routing/#create-a-_routesjson-file) file generated by `adapter-cloudflare`.

- `include` defines routes that will invoke a function, and defaults to `['/*']`
- `exclude` defines routes that will _not_ invoke a function — this is a faster and cheaper way to serve your app's static assets. This array can include the following special values:
	- `<build>` contains your app's build artifacts (the files generated by Vite)
	- `<files>` contains the contents of your `static` directory
	- `<prerendered>` contains a list of prerendered pages
	- `<all>` (the default) contains all of the above

You can have up to 100 `include` and `exclude` rules combined. Generally you can omit the `routes` options, but if (for example) your `<prerendered>` paths exceed that limit, you may find it helpful to manually create an `exclude` list that includes `'/articles/*'` instead of the auto-generated `['/articles/foo', '/articles/bar', '/articles/baz', ...]`.

### platformProxy

Preferences for the emulated `platform.env` local bindings. See the [getPlatformProxy](https://developers.cloudflare.com/workers/wrangler/api/#syntax) Wrangler API documentation for a full list of options.

## Deployment

Please follow the [Get Started Guide](https://developers.cloudflare.com/pages/get-started) for Cloudflare Pages to begin.

When configuring your project settings, you must use the following settings:

- **Framework preset** – SvelteKit
- **Build command** – `npm run build` or `vite build`
- **Build output directory** – `.svelte-kit/cloudflare`

## Runtime APIs

The [`env`](https://developers.cloudflare.com/workers/runtime-apis/fetch-event#parameters) object contains your project's [bindings](https://developers.cloudflare.com/pages/platform/functions/bindings/), which consist of KV/DO namespaces, etc. It is passed to SvelteKit via the `platform` property, along with [`context`](https://developers.cloudflare.com/workers/runtime-apis/handlers/fetch/#contextwaituntil), [`caches`](https://developers.cloudflare.com/workers/runtime-apis/cache/), and [`cf`](https://developers.cloudflare.com/workers/runtime-apis/request/#the-cf-property-requestinitcfproperties), meaning that you can access it in hooks and endpoints:

```js
// @errors: 7031
export async function POST({ request, platform }) {
	const x = platform.env.YOUR_DURABLE_OBJECT_NAMESPACE.idFromName('x');
}
```

> SvelteKit's built-in `$env` module should be preferred for environment variables.

To include type declarations for your bindings, reference them in your `src/app.d.ts`:

```diff
/// file: src/app.d.ts
declare global {
	namespace App {
		interface Platform {
+			env?: {
+				YOUR_KV_NAMESPACE: KVNamespace;
+				YOUR_DURABLE_OBJECT_NAMESPACE: DurableObjectNamespace;
+			};
		}
	}
}

export {};
```

### Testing Locally

Cloudflare Workers specific values in the `platform` property are emulated during dev and preview modes. Local [bindings](https://developers.cloudflare.com/workers/wrangler/configuration/#bindings) are created based on the configuration in your `wrangler.toml` file and are used to populate `platform.env` during development and preview. Use the adapter config [`platformProxy` option](#options-platformproxy) to change your preferences for the bindings.

For testing the build, you should use [wrangler](https://developers.cloudflare.com/workers/cli-wrangler) **version 3**. Once you have built your site, run `wrangler pages dev .svelte-kit/cloudflare`.

## Notes

Functions contained in the `/functions` directory at the project's root will _not_ be included in the deployment, which is compiled to a [single `_worker.js` file](https://developers.cloudflare.com/pages/platform/functions/#advanced-mode). Functions should be implemented as [server endpoints](https://kit.svelte.dev/docs/routing#server) in your SvelteKit app.

The `_headers` and `_redirects` files specific to Cloudflare Pages can be used for static asset responses (like images) by putting them into the `/static` folder.

However, they will have no effect on responses dynamically rendered by SvelteKit, which should return custom headers or redirect responses from [server endpoints](https://kit.svelte.dev/docs/routing#server) or with the [`handle`](https://kit.svelte.dev/docs/hooks#server-hooks-handle) hook.

## Troubleshooting

### Further reading

You may wish to refer to [Cloudflare's documentation for deploying a SvelteKit site](https://developers.cloudflare.com/pages/framework-guides/deploy-a-svelte-site).

### Accessing the file system

You can't use `fs` in Cloudflare Workers — you must [prerender](https://kit.svelte.dev/docs/page-options#prerender) the routes in question.

####### documentation/docs/25-build-and-deploy/70-adapter-cloudflare-workers.md #######

---
title: Cloudflare Workers
---

To deploy to [Cloudflare Workers](https://workers.cloudflare.com/), use [`adapter-cloudflare-workers`](https://github.com/sveltejs/kit/tree/main/packages/adapter-cloudflare-workers).

> Unless you have a specific reason to use `adapter-cloudflare-workers`, it's recommended that you use `adapter-cloudflare` instead. Both adapters have equivalent functionality, but Cloudflare Pages offers features like GitHub integration with automatic builds and deploys, preview deployments, instant rollback and so on.

## Usage

Install with `npm i -D @sveltejs/adapter-cloudflare-workers`, then add the adapter to your `svelte.config.js`:

```js
// @errors: 2307
/// file: svelte.config.js
import adapter from '@sveltejs/adapter-cloudflare-workers';

export default {
	kit: {
		adapter: adapter({
      config: '<your-wrangler-name>.toml',
      platformProxy: {
        persist: './your-custom-path'
      }
    })
	}
};
```

## Options

### config

Path to your custom `wrangler.toml` config file.

### platformProxy

Preferences for the emulated `platform.env` local bindings. See the [getPlatformProxy](https://developers.cloudflare.com/workers/wrangler/api/#syntax) Wrangler API documentation for a full list of options.

## Basic Configuration

This adapter expects to find a [wrangler.toml](https://developers.cloudflare.com/workers/platform/sites/configuration) file in the project root. It should look something like this:

```toml
/// file: wrangler.toml
name = "<your-service-name>"
account_id = "<your-account-id>"

main = "./.cloudflare/worker.js"
site.bucket = "./.cloudflare/public"

build.command = "npm run build"

compatibility_date = "2021-11-12"
workers_dev = true
```

`<your-service-name>` can be anything. `<your-account-id>` can be found by logging into your [Cloudflare dashboard](https://dash.cloudflare.com) and grabbing it from the end of the URL:

```
https://dash.cloudflare.com/<your-account-id>
```

> You should add the `.cloudflare` directory (or whichever directories you specified for `main` and `site.bucket`) to your `.gitignore`.

You will need to install [wrangler](https://developers.cloudflare.com/workers/wrangler/get-started/) and log in, if you haven't already:

```
npm i -g wrangler
wrangler login
```

Then, you can build your app and deploy it:

```sh
wrangler deploy
```

## Custom config

If you would like to use a config file other than `wrangler.toml` you can specify so using the [`config` option](#options-config).

If you would like to enable [Node.js compatibility](https://developers.cloudflare.com/workers/runtime-apis/nodejs/#enable-nodejs-from-the-cloudflare-dashboard), you can add "nodejs_compat" flag to `wrangler.toml`:

```toml
/// file: wrangler.toml
compatibility_flags = [ "nodejs_compat" ]
```

## Runtime APIs

The [`env`](https://developers.cloudflare.com/workers/runtime-apis/fetch-event#parameters) object contains your project's [bindings](https://developers.cloudflare.com/pages/platform/functions/bindings/), which consist of KV/DO namespaces, etc. It is passed to SvelteKit via the `platform` property, along with [`context`](https://developers.cloudflare.com/workers/runtime-apis/handlers/fetch/#contextwaituntil), [`caches`](https://developers.cloudflare.com/workers/runtime-apis/cache/), and [`cf`](https://developers.cloudflare.com/workers/runtime-apis/request/#the-cf-property-requestinitcfproperties), meaning that you can access it in hooks and endpoints:

```js
// @errors: 7031
export async function POST({ request, platform }) {
	const x = platform.env.YOUR_DURABLE_OBJECT_NAMESPACE.idFromName('x');
}
```

> SvelteKit's built-in `$env` module should be preferred for environment variables.

To include type declarations for your bindings, reference them in your `src/app.d.ts`:

```diff
/// file: src/app.d.ts
declare global {
	namespace App {
		interface Platform {
+			env?: {
+				YOUR_KV_NAMESPACE: KVNamespace;
+				YOUR_DURABLE_OBJECT_NAMESPACE: DurableObjectNamespace;
+			};
		}
	}
}

export {};
```

### Testing Locally

Cloudflare Workers specific values in the `platform` property are emulated during dev and preview modes. Local [bindings](https://developers.cloudflare.com/workers/wrangler/configuration/#bindings) are created based on the configuration in your `wrangler.toml` file and are used to populate `platform.env` during development and preview. Use the adapter config [`platformProxy` option](#options-platformproxy) to change your preferences for the bindings.

For testing the build, you should use [wrangler](https://developers.cloudflare.com/workers/cli-wrangler) **version 3**. Once you have built your site, run `wrangler dev`.

## Troubleshooting

### Worker size limits

When deploying to workers, the server generated by SvelteKit is bundled into a single file. Wrangler will fail to publish your worker if it exceeds [the size limits](https://developers.cloudflare.com/workers/platform/limits/#worker-size) after minification. You're unlikely to hit this limit usually, but some large libraries can cause this to happen. In that case, you can try to reduce the size of your worker by only importing such libraries on the client side. See [the FAQ](./faq#how-do-i-use-x-with-sveltekit-how-do-i-use-a-client-side-only-library-that-depends-on-document-or-window) for more information.

### Accessing the file system

You can't use `fs` in Cloudflare Workers — you must [prerender](https://kit.svelte.dev/docs/page-options#prerender) the routes in question.

####### documentation/docs/25-build-and-deploy/80-adapter-netlify.md #######

---
title: Netlify
---

To deploy to Netlify, use [`adapter-netlify`](https://github.com/sveltejs/kit/tree/main/packages/adapter-netlify).

This adapter will be installed by default when you use [`adapter-auto`](adapter-auto), but adding it to your project allows you to specify Netlify-specific options.

## Usage

Install with `npm i -D @sveltejs/adapter-netlify`, then add the adapter to your `svelte.config.js`:

```js
// @errors: 2307
/// file: svelte.config.js
import adapter from '@sveltejs/adapter-netlify';

export default {
	kit: {
		// default options are shown
		adapter: adapter({
			// if true, will create a Netlify Edge Function rather
			// than using standard Node-based functions
			edge: false,

			// if true, will split your app into multiple functions
			// instead of creating a single one for the entire app.
			// if `edge` is true, this option cannot be used
			split: false
		})
	}
};
```

Then, make sure you have a [netlify.toml](https://docs.netlify.com/configure-builds/file-based-configuration) file in the project root. This will determine where to write static assets based on the `build.publish` settings, as per this sample configuration:

```toml
[build]
	command = "npm run build"
	publish = "build"
```

If the `netlify.toml` file or the `build.publish` value is missing, a default value of `"build"` will be used. Note that if you have set the publish directory in the Netlify UI to something else then you will need to set it in `netlify.toml` too, or use the default value of `"build"`.

### Node version

New projects will use the current Node LTS version by default. However, if you're upgrading a project you created a while ago it may be stuck on an older version. See [the Netlify docs](https://docs.netlify.com/configure-builds/manage-dependencies/#node-js-and-javascript) for details on manually specifying a current Node version.

## Netlify Edge Functions

SvelteKit supports [Netlify Edge Functions](https://docs.netlify.com/netlify-labs/experimental-features/edge-functions/). If you pass the option `edge: true` to the `adapter` function, server-side rendering will happen in a Deno-based edge function that's deployed close to the site visitor. If set to `false` (the default), the site will deploy to Node-based Netlify Functions.

```js
// @errors: 2307
/// file: svelte.config.js
import adapter from '@sveltejs/adapter-netlify';

export default {
	kit: {
		adapter: adapter({
			// will create a Netlify Edge Function using Deno-based
			// rather than using standard Node-based functions
			edge: true
		})
	}
};
```

## Netlify alternatives to SvelteKit functionality

You may build your app using functionality provided directly by SvelteKit without relying on any Netlify functionality. Using the SvelteKit versions of these features will allow them to be used in dev mode, tested with integration tests, and to work with other adapters should you ever decide to switch away from Netlify. However, in some scenarios you may find it beneficial to use the Netlify versions of these features. One example would be if you're migrating an app that's already hosted on Netlify to SvelteKit.

### Redirect rules

During compilation, redirect rules are automatically appended to your `_redirects` file. (If it doesn't exist yet, it will be created.) That means:

- `[[redirects]]` in `netlify.toml` will never match as `_redirects` has a [higher priority](https://docs.netlify.com/routing/redirects/#rule-processing-order). So always put your rules in the [`_redirects` file](https://docs.netlify.com/routing/redirects/#syntax-for-the-redirects-file).
- `_redirects` shouldn't have any custom "catch all" rules such as `/* /foobar/:splat`. Otherwise the automatically appended rule will never be applied as Netlify is only processing [the first matching rule](https://docs.netlify.com/routing/redirects/#rule-processing-order).

### Netlify Forms

1. Create your Netlify HTML form as described [here](https://docs.netlify.com/forms/setup/#html-forms), e.g. as `/routes/contact/+page.svelte`. (Don't forget to add the hidden `form-name` input element!)
2. Netlify's build bot parses your HTML files at deploy time, which means your form must be [prerendered](https://kit.svelte.dev/docs/page-options#prerender) as HTML. You can either add `export const prerender = true` to your `contact.svelte` to prerender just that page or set the `kit.prerender.force: true` option to prerender all pages.
3. If your Netlify form has a [custom success message](https://docs.netlify.com/forms/setup/#success-messages) like `<form netlify ... action="/success">` then ensure the corresponding `/routes/success/+page.svelte` exists and is prerendered.

### Netlify Functions

With this adapter, SvelteKit endpoints are hosted as [Netlify Functions](https://docs.netlify.com/functions/overview/). Netlify function handlers have additional context, including [Netlify Identity](https://docs.netlify.com/visitor-access/identity/) information. You can access this context via the `event.platform.context` field inside your hooks and `+page.server` or `+layout.server` endpoints. These are [serverless functions](https://docs.netlify.com/functions/overview/) when the `edge` property is `false` in the adapter config or [edge functions](https://docs.netlify.com/edge-functions/overview/#app) when it is `true`.

```js
// @errors: 2705 7006
/// file: +page.server.js
export const load = async (event) => {
	const context = event.platform.context;
	console.log(context); // shows up in your functions log in the Netlify app
};
```

Additionally, you can add your own Netlify functions by creating a directory for them and adding the configuration to your `netlify.toml` file. For example:

```toml
[build]
	command = "npm run build"
	publish = "build"

[functions]
	directory = "functions"
```

## Troubleshooting

### Accessing the file system

You can't use `fs` in edge deployments.

You _can_ use it in serverless deployments, but it won't work as expected, since files are not copied from your project into your deployment. Instead, use the `read` function from `$app/server` to access your files. `read` does not work inside edge deployments (this may change in future).

Alternatively, you can [prerender](https://kit.svelte.dev/docs/page-options#prerender) the routes in question.

####### documentation/docs/25-build-and-deploy/90-adapter-vercel.md #######

---
title: Vercel
---

To deploy to Vercel, use [`adapter-vercel`](https://github.com/sveltejs/kit/tree/main/packages/adapter-vercel).

This adapter will be installed by default when you use [`adapter-auto`](adapter-auto), but adding it to your project allows you to specify Vercel-specific options.

## Usage

Install with `npm i -D @sveltejs/adapter-vercel`, then add the adapter to your `svelte.config.js`:

```js
// @errors: 2307 2345
/// file: svelte.config.js
import adapter from '@sveltejs/adapter-vercel';

export default {
	kit: {
		adapter: adapter({
			// see below for options that can be set here
		})
	}
};
```

## Deployment configuration

To control how your routes are deployed to Vercel as functions, you can specify deployment configuration, either through the option shown above or with [`export const config`](page-options#config) inside `+server.js`, `+page(.server).js` and `+layout(.server).js` files.

For example you could deploy some parts of your app as [Edge Functions](https://vercel.com/docs/concepts/functions/edge-functions)...

```js
/// file: about/+page.js
/** @type {import('@sveltejs/adapter-vercel').Config} */
export const config = {
	runtime: 'edge'
};
```

...and others as [Serverless Functions](https://vercel.com/docs/concepts/functions/serverless-functions) (note that by specifying `config` inside a layout, it applies to all child pages):

```js
/// file: admin/+layout.js
/** @type {import('@sveltejs/adapter-vercel').Config} */
export const config = {
	runtime: 'nodejs18.x'
};
```

The following options apply to all functions:

- `runtime`: `'edge'`, `'nodejs18.x'` or `'nodejs20.x'`. By default, the adapter will select the `'nodejs<version>.x'` corresponding to the Node version your project is configured to use on the Vercel dashboard
- `regions`: an array of [edge network regions](https://vercel.com/docs/concepts/edge-network/regions) (defaulting to `["iad1"]` for serverless functions) or `'all'` if `runtime` is `edge` (its default). Note that multiple regions for serverless functions are only supported on Enterprise plans
- `split`: if `true`, causes a route to be deployed as an individual function. If `split` is set to `true` at the adapter level, all routes will be deployed as individual functions

Additionally, the following option applies to edge functions:
- `external`: an array of dependencies that esbuild should treat as external when bundling functions. This should only be used to exclude optional dependencies that will not run outside Node

And the following option apply to serverless functions:
- `memory`: the amount of memory available to the function. Defaults to `1024` Mb, and can be decreased to `128` Mb or [increased](https://vercel.com/docs/concepts/limits/overview#serverless-function-memory) in 64Mb increments up to `3008` Mb on Pro or Enterprise accounts
- `maxDuration`: [maximum execution duration](https://vercel.com/docs/functions/runtimes#max-duration) of the function. Defaults to `10` seconds for Hobby accounts, `15` for Pro and `900` for Enterprise
- `isr`: configuration Incremental Static Regeneration, described below

If your functions need to access data in a specific region, it's recommended that they be deployed in the same region (or close to it) for optimal performance.

## Image Optimization

You may set the `images` config to control how Vercel builds your images. See the [image configuration reference](https://vercel.com/docs/build-output-api/v3/configuration#images) for full details. As an example, you may set:

```
/// file: svelte.config.js
import adapter from '@sveltejs/adapter-vercel';

export default {
	kit: {
		adapter({
			images: {
				sizes: [640, 828, 1200, 1920, 3840],
				formats: ['image/avif', 'image/webp'],
				minimumCacheTTL: 300,
				domains: ['example-app.vercel.app'],
			}
		})
	}
};
```

## Incremental Static Regeneration

Vercel supports [Incremental Static Regeneration](https://vercel.com/docs/concepts/incremental-static-regeneration/overview) (ISR), which provides the performance and cost advantages of prerendered content with the flexibility of dynamically rendered content.

To add ISR to a route, include the `isr` property in your `config` object:

```js
/// file: blog/[slug]/+page.server.js
// @filename: ambient.d.ts
declare module '$env/static/private' {
	export const BYPASS_TOKEN: string;
}

// @filename: index.js
// ---cut---
import { BYPASS_TOKEN } from '$env/static/private';

export const config = {
	isr: {
		// Expiration time (in seconds) before the cached asset will be re-generated by invoking the Serverless Function.
		// Setting the value to `false` means it will never expire.
		expiration: 60,

		// Random token that can be provided in the URL to bypass the cached version of the asset, by requesting the asset
		// with a __prerender_bypass=<token> cookie.
		//
		// Making a `GET` or `HEAD` request with `x-prerender-revalidate: <token>` will force the asset to be re-validated.
		bypassToken: BYPASS_TOKEN,

		// List of valid query parameters. Other parameters (such as utm tracking codes) will be ignored,
		// ensuring that they do not result in content being regenerated unnecessarily
		allowQuery: ['search']
	}
};
```

The `expiration` property is required; all others are optional.

## Environment variables

Vercel makes a set of [deployment-specific environment variables](https://vercel.com/docs/concepts/projects/environment-variables#system-environment-variables) available. Like other environment variables, these are accessible from `$env/static/private` and `$env/dynamic/private` (sometimes — more on that later), and inaccessible from their public counterparts. To access one of these variables from the client:

```js
// @errors: 2305
/// file: +layout.server.js
import { VERCEL_COMMIT_REF } from '$env/static/private';

/** @type {import('./$types').LayoutServerLoad} */
export function load() {
	return {
		deploymentGitBranch: VERCEL_COMMIT_REF
	};
}
```

```svelte
<!--- file: +layout.svelte --->
<script>
	/** @type {import('./$types').LayoutServerData} */
	export let data;
</script>

<p>This staging environment was deployed from {data.deploymentGitBranch}.</p>
```

Since all of these variables are unchanged between build time and run time when building on Vercel, we recommend using `$env/static/private` — which will statically replace the variables, enabling optimisations like dead code elimination — rather than `$env/dynamic/private`.

## Skew protection

When a new version of your app is deployed, assets belonging to the previous version may no longer be accessible. If a user is actively using your app when this happens, it can cause errors when they navigate — this is known as _version skew_. SvelteKit mitigates this by detecting errors resulting from version skew and causing a hard reload to get the latest version of the app, but this will cause any client-side state to be lost. (You can also proactively mitigate it by observing the [`updated`](/docs/modules#$app-stores-updated) store value, which tells clients when a new version has been deployed.)

[Skew protection](https://vercel.com/docs/deployments/skew-protection) is a Vercel feature that routes client requests to their original deployment. When a user visits your app, a cookie is set with the deployment ID, and any subsequent requests will be routed to that deployment for as long as skew protection is active. When they reload the page, they will get the newest deployment. (The `updated` store is exempted from this behaviour, and so will continue to report new deployments.) To enable it, visit the Advanced section of your project settings on Vercel.

Cookie-based skew protection comes with one caveat: if a user has multiple versions of your app open in multiple tabs, requests from older versions will be routed to the newer one, meaning they will fall back to SvelteKit's built-in skew protection.

## Notes

### Vercel functions

If you have Vercel functions contained in the `api` directory at the project's root, any requests for `/api/*` will _not_ be handled by SvelteKit. You should implement these as [API routes](https://kit.svelte.dev/docs/routing#server) in your SvelteKit app instead, unless you need to use a non-JavaScript language in which case you will need to ensure that you don't have any `/api/*` routes in your SvelteKit app.

### Node version

Projects created before a certain date may default to using an older Node version than what SvelteKit currently requires. You can [change the Node version in your project settings](https://vercel.com/docs/concepts/functions/serverless-functions/runtimes/node-js#node.js-version).

## Troubleshooting

### Accessing the file system

You can't use `fs` in edge functions.

You _can_ use it in serverless functions, but it won't work as expected, since files are not copied from your project into your deployment. Instead, use the `read` function from `$app/server` to access your files. `read` does not work inside routes deployed as edge functions (this may change in future).

Alternatively, you can [prerender](https://kit.svelte.dev/docs/page-options#prerender) the routes in question.

####### documentation/docs/25-build-and-deploy/99-writing-adapters.md #######

---
title: Writing adapters
---

If an adapter for your preferred environment doesn't yet exist, you can build your own. We recommend [looking at the source for an adapter](https://github.com/sveltejs/kit/tree/main/packages) to a platform similar to yours and copying it as a starting point.

Adapter packages implement the following API, which creates an `Adapter`:

```js
// @errors: 2322
// @filename: ambient.d.ts
type AdapterSpecificOptions = any;

// @filename: index.js
// ---cut---
/** @param {AdapterSpecificOptions} options */
export default function (options) {
	/** @type {import('@sveltejs/kit').Adapter} */
	const adapter = {
		name: 'adapter-package-name',
		async adapt(builder) {
			// adapter implementation
		},
		async emulate() {
			return {
				async platform({ config, prerender }) {
					// the returned object becomes `event.platform` during dev, build and
					// preview. Its shape is that of `App.Platform`
				}
			}
		},
		supports: {
			read: ({ config, route }) => {
				// Return `true` if the route with the given `config` can use `read`
				// from `$app/server` in production, return `false` if it can't.
				// Or throw a descriptive error describing how to configure the deployment
			}
		}
	};

	return adapter;
}
```

Of these, `name` and `adapt` are required. `emulate` and `supports` are optional.

Within the `adapt` method, there are a number of things that an adapter should do:

- Clear out the build directory
- Write SvelteKit output with `builder.writeClient`, `builder.writeServer`, and `builder.writePrerendered`
- Output code that:
	- Imports `Server` from `${builder.getServerDirectory()}/index.js`
	- Instantiates the app with a manifest generated with `builder.generateManifest({ relativePath })`
	- Listens for requests from the platform, converts them to a standard [Request](https://developer.mozilla.org/en-US/docs/Web/API/Request) if necessary, calls the `server.respond(request, { getClientAddress })` function to generate a [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response) and responds with it
	- expose any platform-specific information to SvelteKit via the `platform` option passed to `server.respond`
	- Globally shims `fetch` to work on the target platform, if necessary. SvelteKit provides a `@sveltejs/kit/node/polyfills` helper for platforms that can use `undici`
- Bundle the output to avoid needing to install dependencies on the target platform, if necessary
- Put the user's static files and the generated JS/CSS in the correct location for the target platform

Where possible, we recommend putting the adapter output under the `build/` directory with any intermediate output placed under `.svelte-kit/[adapter-name]`.

####### documentation/docs/25-build-and-deploy/meta.json #######

```

{
	"title": "Build and deploy"
}

```


####### documentation/docs/30-advanced/10-advanced-routing.md #######

---
title: Advanced routing
---

## Rest parameters

If the number of route segments is unknown, you can use rest syntax — for example you might implement GitHub's file viewer like so...

```bash
/[org]/[repo]/tree/[branch]/[...file]
```

...in which case a request for `/sveltejs/kit/tree/main/documentation/docs/04-advanced-routing.md` would result in the following parameters being available to the page:

```js
// @noErrors
{
	org: 'sveltejs',
	repo: 'kit',
	branch: 'main',
	file: 'documentation/docs/04-advanced-routing.md'
}
```

> `src/routes/a/[...rest]/z/+page.svelte` will match `/a/z` (i.e. there's no parameter at all) as well as `/a/b/z` and `/a/b/c/z` and so on. Make sure you check that the value of the rest parameter is valid, for example using a [matcher](#matching).

### 404 pages

Rest parameters also allow you to render custom 404s. Given these routes...

```
src/routes/
├ marx-brothers/
│ ├ chico/
│ ├ harpo/
│ ├ groucho/
│ └ +error.svelte
└ +error.svelte
```

...the `marx-brothers/+error.svelte` file will _not_ be rendered if you visit `/marx-brothers/karl`, because no route was matched. If you want to render the nested error page, you should create a route that matches any `/marx-brothers/*` request, and return a 404 from it:

```diff
src/routes/
├ marx-brothers/
+| ├ [...path]/
│ ├ chico/
│ ├ harpo/
│ ├ groucho/
│ └ +error.svelte
└ +error.svelte
```

```js
/// file: src/routes/marx-brothers/[...path]/+page.js
import { error } from '@sveltejs/kit';

/** @type {import('./$types').PageLoad} */
export function load(event) {
	error(404, 'Not Found');
}
```

> If you don't handle 404 cases, they will appear in [`handleError`](hooks#shared-hooks-handleerror)

## Optional parameters

A route like `[lang]/home` contains a parameter named `lang` which is required. Sometimes it's beneficial to make these parameters optional, so that in this example both `home` and `en/home` point to the same page. You can do that by wrapping the parameter in another bracket pair: `[[lang]]/home`

Note that an optional route parameter cannot follow a rest parameter (`[...rest]/[[optional]]`), since parameters are matched 'greedily' and the optional parameter would always be unused.

## Matching

A route like `src/routes/archive/[page]` would match `/archive/3`, but it would also match `/archive/potato`. We don't want that. You can ensure that route parameters are well-formed by adding a _matcher_ — which takes the parameter string (`"3"` or `"potato"`) and returns `true` if it is valid — to your [`params`](configuration#files) directory...

```js
/// file: src/params/integer.js
/** @type {import('@sveltejs/kit').ParamMatcher} */
export function match(param) {
	return /^\d+$/.test(param);
}
```

...and augmenting your routes:

```diff
-src/routes/archive/[page]
+src/routes/archive/[page=integer]
```

If the pathname doesn't match, SvelteKit will try to match other routes (using the sort order specified below), before eventually returning a 404.

Each module in the `params` directory corresponds to a matcher, with the exception of `*.test.js` and `*.spec.js` files which may be used to unit test your matchers.

> Matchers run both on the server and in the browser.

## Sorting

It's possible for multiple routes to match a given path. For example each of these routes would match `/foo-abc`:

```bash
src/routes/[...catchall]/+page.svelte
src/routes/[[a=x]]/+page.svelte
src/routes/[b]/+page.svelte
src/routes/foo-[c]/+page.svelte
src/routes/foo-abc/+page.svelte
```

SvelteKit needs to know which route is being requested. To do so, it sorts them according to the following rules...

- More specific routes are higher priority (e.g. a route with no parameters is more specific than a route with one dynamic parameter, and so on)
- Parameters with [matchers](#matching) (`[name=type]`) are higher priority than those without (`[name]`)
- `[[optional]]` and `[...rest]` parameters are ignored unless they are the final part of the route, in which case they are treated with lowest priority. In other words `x/[[y]]/z` is treated equivalently to `x/z` for the purposes of sorting
- Ties are resolved alphabetically

...resulting in this ordering, meaning that `/foo-abc` will invoke `src/routes/foo-abc/+page.svelte`, and `/foo-def` will invoke `src/routes/foo-[c]/+page.svelte` rather than less specific routes:

```bash
src/routes/foo-abc/+page.svelte
src/routes/foo-[c]/+page.svelte
src/routes/[[a=x]]/+page.svelte
src/routes/[b]/+page.svelte
src/routes/[...catchall]/+page.svelte
```

## Encoding

Some characters can't be used on the filesystem — `/` on Linux and Mac, `\ / : * ? " < > |` on Windows. The `#` and `%` characters have special meaning in URLs, and the `[ ] ( )` characters have special meaning to SvelteKit, so these also can't be used directly as part of your route.

To use these characters in your routes, you can use hexadecimal escape sequences, which have the format `[x+nn]` where `nn` is a hexadecimal character code:

- `\` — `[x+5c]`
- `/` — `[x+2f]`
- `:` — `[x+3a]`
- `*` — `[x+2a]`
- `?` — `[x+3f]`
- `"` — `[x+22]`
- `<` — `[x+3c]`
- `>` — `[x+3e]`
- `|` — `[x+7c]`
- `#` — `[x+23]`
- `%` — `[x+25]`
- `[` — `[x+5b]`
- `]` — `[x+5d]`
- `(` — `[x+28]`
- `)` — `[x+29]`

For example, to create a `/smileys/:-)` route, you would create a `src/routes/smileys/[x+3a]-[x+29]/+page.svelte` file.

You can determine the hexadecimal code for a character with JavaScript:

```js
':'.charCodeAt(0).toString(16); // '3a', hence '[x+3a]'
```

You can also use Unicode escape sequences. Generally you won't need to as you can use the unencoded character directly, but if — for some reason — you can't have a filename with an emoji in it, for example, then you can use the escaped characters. In other words, these are equivalent:

```
src/routes/[u+d83e][u+dd2a]/+page.svelte
src/routes/🤪/+page.svelte
```

The format for a Unicode escape sequence is `[u+nnnn]` where `nnnn` is a valid value between `0000` and `10ffff`. (Unlike JavaScript string escaping, there's no need to use surrogate pairs to represent code points above `ffff`.) To learn more about Unicode encodings, consult [Programming with Unicode](https://unicodebook.readthedocs.io/unicode_encodings.html).

> Since TypeScript [struggles](https://github.com/microsoft/TypeScript/issues/13399) with directories with a leading `.` character, you may find it useful to encode these characters when creating e.g. [`.well-known`](https://en.wikipedia.org/wiki/Well-known_URI) routes: `src/routes/[x+2e]well-known/...`

## Advanced layouts

By default, the _layout hierarchy_ mirrors the _route hierarchy_. In some cases, that might not be what you want.

### (group)

Perhaps you have some routes that are 'app' routes that should have one layout (e.g. `/dashboard` or `/item`), and others that are 'marketing' routes that should have a different layout (`/about` or `/testimonials`). We can group these routes with a directory whose name is wrapped in parentheses — unlike normal directories, `(app)` and `(marketing)` do not affect the URL pathname of the routes inside them:

```diff
src/routes/
+│ (app)/
│ ├ dashboard/
│ ├ item/
│ └ +layout.svelte
+│ (marketing)/
│ ├ about/
│ ├ testimonials/
│ └ +layout.svelte
├ admin/
└ +layout.svelte
```

You can also put a `+page` directly inside a `(group)`, for example if `/` should be an `(app)` or a `(marketing)` page.

### Breaking out of layouts

The root layout applies to every page of your app — if omitted, it defaults to `<slot />`. If you want some pages to have a different layout hierarchy than the rest, then you can put your entire app inside one or more groups _except_ the routes that should not inherit the common layouts.

In the example above, the `/admin` route does not inherit either the `(app)` or `(marketing)` layouts.

### +page@

Pages can break out of the current layout hierarchy on a route-by-route basis. Suppose we have an `/item/[id]/embed` route inside the `(app)` group from the previous example:

```diff
src/routes/
├ (app)/
│ ├ item/
│ │ ├ [id]/
│ │ │ ├ embed/
+│ │ │ │ └ +page.svelte
│ │ │ └ +layout.svelte
│ │ └ +layout.svelte
│ └ +layout.svelte
└ +layout.svelte
```

Ordinarily, this would inherit the root layout, the `(app)` layout, the `item` layout and the `[id]` layout. We can reset to one of those layouts by appending `@` followed by the segment name — or, for the root layout, the empty string. In this example, we can choose from the following options:

- `+page@[id].svelte` - inherits from `src/routes/(app)/item/[id]/+layout.svelte`
- `+page@item.svelte` - inherits from `src/routes/(app)/item/+layout.svelte`
- `+page@(app).svelte` - inherits from `src/routes/(app)/+layout.svelte`
- `+page@.svelte` - inherits from `src/routes/+layout.svelte`

```diff
src/routes/
├ (app)/
│ ├ item/
│ │ ├ [id]/
│ │ │ ├ embed/
+│ │ │ │ └ +page@(app).svelte
│ │ │ └ +layout.svelte
│ │ └ +layout.svelte
│ └ +layout.svelte
└ +layout.svelte
```

### +layout@

Like pages, layouts can _themselves_ break out of their parent layout hierarchy, using the same technique. For example, a `+layout@.svelte` component would reset the hierarchy for all its child routes.

```
src/routes/
├ (app)/
│ ├ item/
│ │ ├ [id]/
│ │ │ ├ embed/
│ │ │ │ └ +page.svelte  // uses (app)/item/[id]/+layout.svelte
│ │ │ ├ +layout.svelte  // inherits from (app)/item/+layout@.svelte
│ │ │ └ +page.svelte    // uses (app)/item/+layout@.svelte
│ │ └ +layout@.svelte   // inherits from root layout, skipping (app)/+layout.svelte
│ └ +layout.svelte
└ +layout.svelte
```

### When to use layout groups

Not all use cases are suited for layout grouping, nor should you feel compelled to use them. It might be that your use case would result in complex `(group)` nesting, or that you don't want to introduce a `(group)` for a single outlier. It's perfectly fine to use other means such as composition (reusable `load` functions or Svelte components) or if-statements to achieve what you want. The following example shows a layout that rewinds to the root layout and reuses components and functions that other layouts can also use:

```svelte
<!--- file: src/routes/nested/route/+layout@.svelte --->
<script>
	import ReusableLayout from '$lib/ReusableLayout.svelte';
	export let data;
</script>

<ReusableLayout {data}>
	<slot />
</ReusableLayout>
```

```js
/// file: src/routes/nested/route/+layout.js
// @filename: ambient.d.ts
declare module "$lib/reusable-load-function" {
	export function reusableLoad(event: import('@sveltejs/kit').LoadEvent): Promise<Record<string, any>>;
}
// @filename: index.js
// ---cut---
import { reusableLoad } from '$lib/reusable-load-function';

/** @type {import('./$types').PageLoad} */
export function load(event) {
	// Add additional logic here, if needed
	return reusableLoad(event);
}
```

## Further reading

- [Tutorial: Advanced Routing](https://learn.svelte.dev/tutorial/optional-params)

####### documentation/docs/30-advanced/20-hooks.md #######

---
title: Hooks
---

'Hooks' are app-wide functions you declare that SvelteKit will call in response to specific events, giving you fine-grained control over the framework's behaviour.

There are three hooks files, all optional:

- `src/hooks.server.js` — your app's server hooks
- `src/hooks.client.js` — your app's client hooks
- `src/hooks.js` — your app's hooks that run on both the client and server

Code in these modules will run when the application starts up, making them useful for initializing database clients and so on.

> You can configure the location of these files with [`config.kit.files.hooks`](configuration#files).

## Server hooks

The following hooks can be added to `src/hooks.server.js`:

### handle

This function runs every time the SvelteKit server receives a [request](web-standards#fetch-apis-request) — whether that happens while the app is running, or during [prerendering](page-options#prerender) — and determines the [response](web-standards#fetch-apis-response). It receives an `event` object representing the request and a function called `resolve`, which renders the route and generates a `Response`. This allows you to modify response headers or bodies, or bypass SvelteKit entirely (for implementing routes programmatically, for example).

```js
/// file: src/hooks.server.js
/** @type {import('@sveltejs/kit').Handle} */
export async function handle({ event, resolve }) {
	if (event.url.pathname.startsWith('/custom')) {
		return new Response('custom response');
	}

	const response = await resolve(event);
	return response;
}
```

> Requests for static assets — which includes pages that were already prerendered — are _not_ handled by SvelteKit.

If unimplemented, defaults to `({ event, resolve }) => resolve(event)`. To add custom data to the request, which is passed to handlers in `+server.js` and server `load` functions, populate the `event.locals` object, as shown below.

```js
/// file: src/hooks.server.js
// @filename: ambient.d.ts
type User = {
	name: string;
}

declare namespace App {
	interface Locals {
		user: User;
	}
}

const getUserInformation: (cookie: string | void) => Promise<User>;

// @filename: index.js
// ---cut---
/** @type {import('@sveltejs/kit').Handle} */
export async function handle({ event, resolve }) {
	event.locals.user = await getUserInformation(event.cookies.get('sessionid'));

	const response = await resolve(event);
	response.headers.set('x-custom-header', 'potato');

	return response;
}
```

You can define multiple `handle` functions and execute them with [the `sequence` helper function](modules#sveltejs-kit-hooks).

`resolve` also supports a second, optional parameter that gives you more control over how the response will be rendered. That parameter is an object that can have the following fields:

- `transformPageChunk(opts: { html: string, done: boolean }): MaybePromise<string | undefined>` — applies custom transforms to HTML. If `done` is true, it's the final chunk. Chunks are not guaranteed to be well-formed HTML (they could include an element's opening tag but not its closing tag, for example) but they will always be split at sensible boundaries such as `%sveltekit.head%` or layout/page components.
- `filterSerializedResponseHeaders(name: string, value: string): boolean` — determines which headers should be included in serialized responses when a `load` function loads a resource with `fetch`. By default, none will be included.
- `preload(input: { type: 'js' | 'css' | 'font' | 'asset', path: string }): boolean` — determines what files should be added to the `<head>` tag to preload it. The method is called with each file that was found at build time while constructing the code chunks — so if you for example have `import './styles.css` in your `+page.svelte`, `preload` will be called with the resolved path to that CSS file when visiting that page. Note that in dev mode `preload` is _not_ called, since it depends on analysis that happens at build time. Preloading can improve performance by downloading assets sooner, but it can also hurt if too much is downloaded unnecessarily. By default, `js` and `css` files will be preloaded. `asset` files are not preloaded at all currently, but we may add this later after evaluating feedback.

```js
/// file: src/hooks.server.js
/** @type {import('@sveltejs/kit').Handle} */
export async function handle({ event, resolve }) {
	const response = await resolve(event, {
		transformPageChunk: ({ html }) => html.replace('old', 'new'),
		filterSerializedResponseHeaders: (name) => name.startsWith('x-'),
		preload: ({ type, path }) => type === 'js' || path.includes('/important/')
	});

	return response;
}
```

Note that `resolve(...)` will never throw an error, it will always return a `Promise<Response>` with the appropriate status code. If an error is thrown elsewhere during `handle`, it is treated as fatal, and SvelteKit will respond with a JSON representation of the error or a fallback error page — which can be customised via `src/error.html` — depending on the `Accept` header. You can read more about error handling [here](errors).

### handleFetch

This function allows you to modify (or replace) a `fetch` request that happens inside a `load` or `action` function that runs on the server (or during pre-rendering).

For example, your `load` function might make a request to a public URL like `https://api.yourapp.com` when the user performs a client-side navigation to the respective page, but during SSR it might make sense to hit the API directly (bypassing whatever proxies and load balancers sit between it and the public internet).

```js
/// file: src/hooks.server.js
/** @type {import('@sveltejs/kit').HandleFetch} */
export async function handleFetch({ request, fetch }) {
	if (request.url.startsWith('https://api.yourapp.com/')) {
		// clone the original request, but change the URL
		request = new Request(
			request.url.replace('https://api.yourapp.com/', 'http://localhost:9999/'),
			request
		);
	}

	return fetch(request);
}
```

**Credentials**

For same-origin requests, SvelteKit's `fetch` implementation will forward `cookie` and `authorization` headers unless the `credentials` option is set to `"omit"`.

For cross-origin requests, `cookie` will be included if the request URL belongs to a subdomain of the app — for example if your app is on `my-domain.com`, and your API is on `api.my-domain.com`, cookies will be included in the request.

If your app and your API are on sibling subdomains — `www.my-domain.com` and `api.my-domain.com` for example — then a cookie belonging to a common parent domain like `my-domain.com` will _not_ be included, because SvelteKit has no way to know which domain the cookie belongs to. In these cases you will need to manually include the cookie using `handleFetch`:

```js
/// file: src/hooks.server.js
// @errors: 2345
/** @type {import('@sveltejs/kit').HandleFetch} */
export async function handleFetch({ event, request, fetch }) {
	if (request.url.startsWith('https://api.my-domain.com/')) {
		request.headers.set('cookie', event.request.headers.get('cookie'));
	}

	return fetch(request);
}
```

## Shared hooks

The following can be added to `src/hooks.server.js` _and_ `src/hooks.client.js`:

### handleError

If an [unexpected error](/docs/errors#unexpected-errors) is thrown during loading or rendering, this function will be called with the `error`, `event`, `status` code and `message`. This allows for two things:

- you can log the error
- you can generate a custom representation of the error that is safe to show to users, omitting sensitive details like messages and stack traces. The returned value, which defaults to `{ message }`, becomes the value of `$page.error`.

For errors thrown from your code (or library code called by your code) the status will be 500 and the message will be "Internal Error". While `error.message` may contain sensitive information that should not be exposed to users, `message` is safe (albeit meaningless to the average user).

To add more information to the `$page.error` object in a type-safe way, you can customize the expected shape by declaring an `App.Error` interface (which must include `message: string`, to guarantee sensible fallback behavior). This allows you to — for example — append a tracking ID for users to quote in correspondence with your technical support staff:

```ts
/// file: src/app.d.ts
declare global {
	namespace App {
		interface Error {
			message: string;
			errorId: string;
		}
	}
}

export {};
```

```js
/// file: src/hooks.server.js
// @errors: 2322 2353
// @filename: ambient.d.ts
declare module '@sentry/sveltekit' {
	export const init: (opts: any) => void;
	export const captureException: (error: any, opts: any) => void;
}

// @filename: index.js
// ---cut---
import * as Sentry from '@sentry/sveltekit';

Sentry.init({/*...*/})

/** @type {import('@sveltejs/kit').HandleServerError} */
export async function handleError({ error, event, status, message }) {
	const errorId = crypto.randomUUID();

	// example integration with https://sentry.io/
	Sentry.captureException(error, {
		extra: { event, errorId, status }
	});

	return {
		message: 'Whoops!',
		errorId
	};
}
```

```js
/// file: src/hooks.client.js
// @errors: 2322 2353
// @filename: ambient.d.ts
declare module '@sentry/sveltekit' {
	export const init: (opts: any) => void;
	export const captureException: (error: any, opts: any) => void;
}

// @filename: index.js
// ---cut---
import * as Sentry from '@sentry/sveltekit';

Sentry.init({/*...*/})

/** @type {import('@sveltejs/kit').HandleClientError} */
export async function handleError({ error, event, status, message }) {
	const errorId = crypto.randomUUID();

	// example integration with https://sentry.io/
	Sentry.captureException(error, {
		extra: { event, errorId, status }
	});

	return {
		message: 'Whoops!',
		errorId
	};
}
```

> In `src/hooks.client.js`, the type of `handleError` is `HandleClientError` instead of `HandleServerError`, and `event` is a `NavigationEvent` rather than a `RequestEvent`.

This function is not called for _expected_ errors (those thrown with the [`error`](modules#sveltejs-kit-error) function imported from `@sveltejs/kit`).

During development, if an error occurs because of a syntax error in your Svelte code, the passed in error has a `frame` property appended highlighting the location of the error.

> Make sure that `handleError` _never_ throws an error

## Universal hooks

The following can be added to `src/hooks.js`. Universal hooks run on both server and client (not to be confused with shared hooks, which are environment-specific). 

### reroute

This function runs before `handle` and allows you to change how URLs are translated into routes. The returned pathname (which defaults to `url.pathname`) is used to select the route and its parameters.

For example, you might have a `src/routes/[[lang]]/about/+page.svelte` page, which should be accessible as `/en/about` or `/de/ueber-uns` or `/fr/a-propos`. You could implement this with `reroute`:

```js
/// file: src/hooks.js
// @errors: 2345
// @errors: 2304

/** @type {Record<string, string>} */
const translated = {
	'/en/about': '/en/about',
	'/de/ueber-uns': '/de/about',
	'/fr/a-propos': '/fr/about',
};

/** @type {import('@sveltejs/kit').Reroute} */
export function reroute({ url }) {
	if (url.pathname in translated) {
		return translated[url.pathname];
	}
}
```

The `lang` parameter will be correctly derived from the returned pathname.

Using `reroute` will _not_ change the contents of the browser's address bar, or the value of `event.url`.


## Further reading

- [Tutorial: Hooks](https://learn.svelte.dev/tutorial/handle)

####### documentation/docs/30-advanced/25-errors.md #######

---
title: Errors
---

Errors are an inevitable fact of software development. SvelteKit handles errors differently depending on where they occur, what kind of errors they are, and the nature of the incoming request.

## Error objects

SvelteKit distinguishes between expected and unexpected errors, both of which are represented as simple `{ message: string }` objects by default.

You can add additional properties, like a `code` or a tracking `id`, as shown in the examples below. (When using TypeScript this requires you to redefine the `Error` type as described in  [type safety](errors#type-safety)).

## Expected errors

An _expected_ error is one created with the [`error`](modules#sveltejs-kit-error) helper imported from `@sveltejs/kit`:

```js
/// file: src/routes/blog/[slug]/+page.server.js
// @filename: ambient.d.ts
declare module '$lib/server/database' {
	export function getPost(slug: string): Promise<{ title: string, content: string } | undefined>
}

// @filename: index.js
// ---cut---
import { error } from '@sveltejs/kit';
import * as db from '$lib/server/database';

/** @type {import('./$types').PageServerLoad} */
export async function load({ params }) {
	const post = await db.getPost(params.slug);

	if (!post) {
		error(404, {
			message: 'Not found'
		});
	}

	return { post };
}
```

This throws an exception that SvelteKit catches, causing it to set the response status code to 404 and render an [`+error.svelte`](routing#error) component, where `$page.error` is the object provided as the second argument to `error(...)`.

```svelte
<!--- file: src/routes/+error.svelte --->
<script>
	import { page } from '$app/stores';
</script>

<h1>{$page.error.message}</h1>
```

You can add extra properties to the error object if needed...

```diff
error(404, {
	message: 'Not found',
+	code: 'NOT_FOUND'
});
```

...otherwise, for convenience, you can pass a string as the second argument:

```diff
-error(404, { message: 'Not found' });
+error(404, 'Not found');
```

> [In SvelteKit 1.x](migrating-to-sveltekit-2#redirect-and-error-are-no-longer-thrown-by-you) you had to `throw` the `error` yourself

## Unexpected errors

An _unexpected_ error is any other exception that occurs while handling a request. Since these can contain sensitive information, unexpected error messages and stack traces are not exposed to users.

By default, unexpected errors are printed to the console (or, in production, your server logs), while the error that is exposed to the user has a generic shape:

```json
{ "message": "Internal Error" }
```

Unexpected errors will go through the [`handleError`](hooks#shared-hooks-handleerror) hook, where you can add your own error handling — for example, sending errors to a reporting service, or returning a custom error object which becomes `$page.error`.

## Responses

If an error occurs inside `handle` or inside a [`+server.js`](routing#server) request handler, SvelteKit will respond with either a fallback error page or a JSON representation of the error object, depending on the request's `Accept` headers.

You can customise the fallback error page by adding a `src/error.html` file:

```html
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>%sveltekit.error.message%</title>
	</head>
	<body>
		<h1>My custom error page</h1>
		<p>Status: %sveltekit.status%</p>
		<p>Message: %sveltekit.error.message%</p>
	</body>
</html>
```

SvelteKit will replace `%sveltekit.status%` and `%sveltekit.error.message%` with their corresponding values.

If the error instead occurs inside a `load` function while rendering a page, SvelteKit will render the [`+error.svelte`](routing#error) component nearest to where the error occurred. If the error occurs inside a `load` function in `+layout(.server).js`, the closest error boundary in the tree is an `+error.svelte` file _above_ that layout (not next to it).

The exception is when the error occurs inside the root `+layout.js` or `+layout.server.js`, since the root layout would ordinarily _contain_ the `+error.svelte` component. In this case, SvelteKit uses the fallback error page.

## Type safety

If you're using TypeScript and need to customize the shape of errors, you can do so by declaring an `App.Error` interface in your app (by convention, in `src/app.d.ts`, though it can live anywhere that TypeScript can 'see'):

```diff
/// file: src/app.d.ts
declare global {
	namespace App {
		interface Error {
+			code: string;
+			id: string;
		}
	}
}

export {};
```

This interface always includes a `message: string` property.

## Further reading

- [Tutorial: Errors and redirects](https://learn.svelte.dev/tutorial/error-basics)
- [Tutorial: Hooks](https://learn.svelte.dev/tutorial/handle)

####### documentation/docs/30-advanced/30-link-options.md #######

---
title: Link options
---

In SvelteKit, `<a>` elements (rather than framework-specific `<Link>` components) are used to navigate between the routes of your app. If the user clicks on a link whose `href` is 'owned' by the app (as opposed to, say, a link to an external site) then SvelteKit will navigate to the new page by importing its code and then calling any `load` functions it needs to fetch data.

You can customise the behaviour of links with `data-sveltekit-*` attributes. These can be applied to the `<a>` itself, or to a parent element.

These options also apply to `<form>` elements with [`method="GET"`](form-actions#get-vs-post).

## data-sveltekit-preload-data

Before the browser registers that the user has clicked on a link, we can detect that they've hovered the mouse over it (on desktop) or that a `touchstart` or `mousedown` event was triggered. In both cases, we can make an educated guess that a `click` event is coming.

SvelteKit can use this information to get a head start on importing the code and fetching the page's data, which can give us an extra couple of hundred milliseconds — the difference between a user interface that feels laggy and one that feels snappy.

We can control this behaviour with the `data-sveltekit-preload-data` attribute, which can have one of two values:

- `"hover"` means that preloading will start if the mouse comes to a rest over a link. On mobile, preloading begins on `touchstart`
- `"tap"` means that preloading will start as soon as a `touchstart` or `mousedown` event is registered

The default project template has a `data-sveltekit-preload-data="hover"` attribute applied to the `<body>` element in `src/app.html`, meaning that every link is preloaded on hover by default:

```html
<body data-sveltekit-preload-data="hover">
	<div style="display: contents">%sveltekit.body%</div>
</body>
```

Sometimes, calling `load` when the user hovers over a link might be undesirable, either because it's likely to result in false positives (a click needn't follow a hover) or because data is updating very quickly and a delay could mean staleness.

In these cases, you can specify the `"tap"` value, which causes SvelteKit to call `load` only when the user taps or clicks on a link:

```html
<a data-sveltekit-preload-data="tap" href="/stonks">
	Get current stonk values
</a>
```

> You can also programmatically invoke `preloadData` from `$app/navigation`.

Data will never be preloaded if the user has chosen reduced data usage, meaning [`navigator.connection.saveData`](https://developer.mozilla.org/en-US/docs/Web/API/NetworkInformation/saveData) is `true`.

## data-sveltekit-preload-code

Even in cases where you don't want to preload _data_ for a link, it can be beneficial to preload the _code_. The `data-sveltekit-preload-code` attribute works similarly to `data-sveltekit-preload-data`, except that it can take one of four values, in decreasing 'eagerness':

- `"eager"` means that links will be preloaded straight away
- `"viewport"` means that links will be preloaded once they enter the viewport
- `"hover"` - as above, except that only code is preloaded
- `"tap"` - as above, except that only code is preloaded

Note that `viewport` and `eager` only apply to links that are present in the DOM immediately following navigation — if a link is added later (in an `{#if ...}` block, for example) it will not be preloaded until triggered by `hover` or `tap`. This is to avoid performance pitfalls resulting from aggressively observing the DOM for changes.

> Since preloading code is a prerequisite for preloading data, this attribute will only have an effect if it specifies a more eager value than any `data-sveltekit-preload-data` attribute that is present.

As with `data-sveltekit-preload-data`, this attribute will be ignored if the user has chosen reduced data usage.

## data-sveltekit-reload

Occasionally, we need to tell SvelteKit not to handle a link, but allow the browser to handle it. Adding a `data-sveltekit-reload` attribute to a link...

```html
<a data-sveltekit-reload href="/path">Path</a>
```

...will cause a full-page navigation when the link is clicked.

Links with a `rel="external"` attribute will receive the same treatment. In addition, they will be ignored during [prerendering](page-options#prerender).

## data-sveltekit-replacestate

Sometimes you don't want navigation to create a new entry in the browser's session history. Adding a `data-sveltekit-replacestate` attribute to a link...

```html
<a data-sveltekit-replacestate href="/path">Path</a>
```

...will replace the current `history` entry rather than creating a new one with `pushState` when the link is clicked.

## data-sveltekit-keepfocus

Sometimes you don't want [focus to be reset](accessibility#focus-management) after navigation. For example, maybe you have a search form that submits as the user is typing, and you want to keep focus on the text input.  Adding a `data-sveltekit-keepfocus` attribute to it...

```html
<form data-sveltekit-keepfocus>
	<input type="text" name="query">
</form>
```

...will cause the currently focused element to retain focus after navigation. In general, avoid using this attribute on links, since the focused element would be the `<a>` tag (and not a previously focused element) and screen reader and other assistive technology users often expect focus to be moved after a navigation. You should also only use this attribute on elements that still exist after navigation. If the element no longer exists, the user's focus will be lost, making for a confusing experience for assistive technology users.

## data-sveltekit-noscroll

When navigating to internal links, SvelteKit mirrors the browser's default navigation behaviour: it will change the scroll position to 0,0 so that the user is at the very top left of the page (unless the link includes a `#hash`, in which case it will scroll to the element with a matching ID).

In certain cases, you may wish to disable this behaviour. Adding a `data-sveltekit-noscroll` attribute to a link...

```html
<a href="path" data-sveltekit-noscroll>Path</a>
```

...will prevent scrolling after the link is clicked.

## Disabling options

To disable any of these options inside an element where they have been enabled, use the `"false"` value:

```html
<div data-sveltekit-preload-data>
	<!-- these links will be preloaded -->
	<a href="/a">a</a>
	<a href="/b">b</a>
	<a href="/c">c</a>

	<div data-sveltekit-preload-data="false">
		<!-- these links will NOT be preloaded -->
		<a href="/d">d</a>
		<a href="/e">e</a>
		<a href="/f">f</a>
	</div>
</div>
```

To apply an attribute to an element conditionally, do this:

```svelte
<div data-sveltekit-preload-data={condition ? 'hover' : false}>
```
####### documentation/docs/30-advanced/40-service-workers.md #######

---
title: Service workers
---

Service workers act as proxy servers that handle network requests inside your app. This makes it possible to make your app work offline, but even if you don't need offline support (or can't realistically implement it because of the type of app you're building), it's often worth using service workers to speed up navigation by precaching your built JS and CSS.

In SvelteKit, if you have a `src/service-worker.js` file (or `src/service-worker/index.js`) it will be bundled and automatically registered. You can change the [location of your service worker](configuration#files) if you need to.

You can [disable automatic registration](configuration#serviceworker) if you need to register the service worker with your own logic or use another solution. The default registration looks something like this:

```js
if ('serviceWorker' in navigator) {
	addEventListener('load', function () {
		navigator.serviceWorker.register('./path/to/service-worker.js');
	});
}
```

## Inside the service worker

Inside the service worker you have access to the [`$service-worker` module](modules#$service-worker), which provides you with the paths to all static assets, build files and prerendered pages. You're also provided with an app version string, which you can use for creating a unique cache name, and the deployment's `base` path. If your Vite config specifies `define` (used for global variable replacements), this will be applied to service workers as well as your server/client builds.

The following example caches the built app and any files in `static` eagerly, and caches all other requests as they happen. This would make each page work offline once visited.

```js
// @errors: 2339
/// <reference types="@sveltejs/kit" />
import { build, files, version } from '$service-worker';

// Create a unique cache name for this deployment
const CACHE = `cache-${version}`;

const ASSETS = [
	...build, // the app itself
	...files  // everything in `static`
];

self.addEventListener('install', (event) => {
	// Create a new cache and add all files to it
	async function addFilesToCache() {
		const cache = await caches.open(CACHE);
		await cache.addAll(ASSETS);
	}

	event.waitUntil(addFilesToCache());
});

self.addEventListener('activate', (event) => {
	// Remove previous cached data from disk
	async function deleteOldCaches() {
		for (const key of await caches.keys()) {
			if (key !== CACHE) await caches.delete(key);
		}
	}

	event.waitUntil(deleteOldCaches());
});

self.addEventListener('fetch', (event) => {
	// ignore POST requests etc
	if (event.request.method !== 'GET') return;

	async function respond() {
		const url = new URL(event.request.url);
		const cache = await caches.open(CACHE);

		// `build`/`files` can always be served from the cache
		if (ASSETS.includes(url.pathname)) {
			const response = await cache.match(url.pathname);

			if (response) {
				return response;
			}
		}

		// for everything else, try the network first, but
		// fall back to the cache if we're offline
		try {
			const response = await fetch(event.request);

			// if we're offline, fetch can return a value that is not a Response
			// instead of throwing - and we can't pass this non-Response to respondWith
			if (!(response instanceof Response)) {
				throw new Error('invalid response from fetch');
			}

			if (response.status === 200) {
				cache.put(event.request, response.clone());
			}

			return response;
		} catch (err) {
			const response = await cache.match(event.request);

			if (response) {
				return response;
			}

			// if there's no cache, then just error out
			// as there is nothing we can do to respond to this request
			throw err;
		}
	}

	event.respondWith(respond());
});
```

> Be careful when caching! In some cases, stale data might be worse than data that's unavailable while offline. Since browsers will empty caches if they get too full, you should also be careful about caching large assets like video files.

## During development

The service worker is bundled for production, but not during development. For that reason, only browsers that support [modules in service workers](https://web.dev/es-modules-in-sw) will be able to use them at dev time. If you are manually registering your service worker, you will need to pass the `{ type: 'module' }` option in development:

```js
import { dev } from '$app/environment';

navigator.serviceWorker.register('/service-worker.js', {
	type: dev ? 'module' : 'classic'
});
```

> `build` and `prerendered` are empty arrays during development

## Type safety

Setting up proper types for service workers requires some manual setup. Inside your `service-worker.js`, add the following to the top of your file:

```original-js
/// <reference types="@sveltejs/kit" />
/// <reference no-default-lib="true"/>
/// <reference lib="esnext" />
/// <reference lib="webworker" />

const sw = /** @type {ServiceWorkerGlobalScope} */ (/** @type {unknown} */ (self));
```
```generated-ts
/// <reference types="@sveltejs/kit" />
/// <reference no-default-lib="true"/>
/// <reference lib="esnext" />
/// <reference lib="webworker" />

const sw = self as unknown as ServiceWorkerGlobalScope;
```

This disables access to DOM typings like `HTMLElement` which are not available inside a service worker and instantiates the correct globals. The reassignment of `self` to `sw` allows you to type cast it in the process (there are a couple of ways to do this, but this is the easiest that requires no additional files). Use `sw` instead of `self` in the rest of the file. The reference to the SvelteKit types ensures that the `$service-worker` import has proper type definitions. If you import `$env/static/public` you either have to `// @ts-ignore` the import or add `/// <reference types="../.svelte-kit/ambient.d.ts" />` to the reference types.

## Other solutions

SvelteKit's service worker implementation is deliberately low-level. If you need a more full-fledged but also more opinionated solution, we recommend looking at solutions like [Vite PWA plugin](https://vite-pwa-org.netlify.app/frameworks/sveltekit.html), which uses [Workbox](https://web.dev/learn/pwa/workbox). For more general information on service workers, we recommend [the MDN web docs](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers).

####### documentation/docs/30-advanced/50-server-only-modules.md #######

---
title: Server-only modules
---

Like a good friend, SvelteKit keeps your secrets. When writing your backend and frontend in the same repository, it can be easy to accidentally import sensitive data into your front-end code (environment variables containing API keys, for example). SvelteKit provides a way to prevent this entirely: server-only modules.

## Private environment variables

The `$env/static/private` and `$env/dynamic/private` modules, which are covered in the [modules](modules) section, can only be imported into modules that only run on the server, such as [`hooks.server.js`](hooks#server-hooks) or [`+page.server.js`](routing#page-page-server-js).

## Server-only utilities

The [`$app/server`](/docs/modules#$app-server) module, which contains a `read` function for reading assets from the filesystem, can likewise only be imported by code that runs on the server.

## Your modules

You can make your own modules server-only in two ways:

- adding `.server` to the filename, e.g. `secrets.server.js`
- placing them in `$lib/server`, e.g. `$lib/server/secrets.js`

## How it works

Any time you have public-facing code that imports server-only code (whether directly or indirectly)...

```js
// @errors: 7005
/// file: $lib/server/secrets.js
export const atlantisCoordinates = [/* redacted */];
```

```js
// @errors: 2307 7006 7005
/// file: src/routes/utils.js
export { atlantisCoordinates } from '$lib/server/secrets.js';

export const add = (a, b) => a + b;
```

```html
/// file: src/routes/+page.svelte
<script>
	import { add } from './utils.js';
</script>
```

...SvelteKit will error:

```
Cannot import $lib/server/secrets.js into public-facing code:
- src/routes/+page.svelte
	- src/routes/utils.js
		- $lib/server/secrets.js
```

Even though the public-facing code — `src/routes/+page.svelte` — only uses the `add` export and not the secret `atlantisCoordinates` export, the secret code could end up in JavaScript that the browser downloads, and so the import chain is considered unsafe.

This feature also works with dynamic imports, even interpolated ones like ``await import(`./${foo}.js`)``, with one small caveat: during development, if there are two or more dynamic imports between the public-facing code and the server-only module, the illegal import will not be detected the first time the code is loaded.

> Unit testing frameworks like Vitest do not distinguish between server-only and public-facing code. For this reason, illegal import detection is disabled when running tests, as determined by `process.env.TEST === 'true'`.

## Further reading

- [Tutorial: Environment variables](https://learn.svelte.dev/tutorial/env-static-private)

####### documentation/docs/30-advanced/65-snapshots.md #######

---
title: Snapshots
---

Ephemeral DOM state — like scroll positions on sidebars, the content of `<input>` elements and so on — is discarded when you navigate from one page to another.

For example, if the user fills out a form but clicks a link before submitting, then hits the browser's back button, the values they filled in will be lost. In cases where it's valuable to preserve that input, you can take a _snapshot_ of DOM state, which can then be restored if the user navigates back.

To do this, export a `snapshot` object with `capture` and `restore` methods from a `+page.svelte` or `+layout.svelte`:

```svelte
<!--- file: +page.svelte --->
<script>
	let comment = '';

	/** @type {import('./$types').Snapshot<string>} */
	export const snapshot = {
		capture: () => comment,
		restore: (value) => comment = value
	};
</script>

<form method="POST">
	<label for="comment">Comment</label>
	<textarea id="comment" bind:value={comment} />
	<button>Post comment</button>
</form>
```

When you navigate away from this page, the `capture` function is called immediately before the page updates, and the returned value is associated with the current entry in the browser's history stack. If you navigate back, the `restore` function is called with the stored value as soon as the page is updated.

The data must be serializable as JSON so that it can be persisted to `sessionStorage`. This allows the state to be restored when the page is reloaded, or when the user navigates back from a different site.

> Avoid returning very large objects from `capture` — once captured, objects will be retained in memory for the duration of the session, and in extreme cases may be too large to persist to `sessionStorage`.

####### documentation/docs/30-advanced/67-shallow-routing.md #######

---
title: Shallow routing
---

As you navigate around a SvelteKit app, you create _history entries_. Clicking the back and forward buttons traverses through this list of entries, re-running any `load` functions and replacing page components as necessary.

Sometimes, it's useful to create history entries _without_ navigating. For example, you might want to show a modal dialog that the user can dismiss by navigating back. This is particularly valuable on mobile devices, where swipe gestures are often more natural than interacting directly with the UI. In these cases, a modal that is _not_ associated with a history entry can be a source of frustration, as a user may swipe backwards in an attempt to dismiss it and find themselves on the wrong page.

SvelteKit makes this possible with the [`pushState`](/docs/modules#$app-navigation-pushstate) and [`replaceState`](/docs/modules#$app-navigation-replacestate) functions, which allow you to associate state with a history entry without navigating. For example, to implement a history-driven modal:

```svelte
<!--- file: +page.svelte --->
<script>
	import { pushState } from '$app/navigation';
	import { page } from '$app/stores';
	import Modal from './Modal.svelte';

	function showModal() {
		pushState('', {
			showModal: true
		});
	}
</script>

{#if $page.state.showModal}
	<Modal close={() => history.back()} />
{/if}
```

The modal can be dismissed by navigating back (unsetting `$page.state.showModal`) or by interacting with it in a way that causes the `close` callback to run, which will navigate back programmatically.

## API

The first argument to `pushState` is the URL, relative to the current URL. To stay on the current URL, use `''`.

The second argument is the new page state, which can be accessed via the [page store](/docs/modules#$app-stores-page) as `$page.state`. You can make page state type-safe by declaring an [`App.PageState`](/docs/types#app) interface (usually in `src/app.d.ts`).

To set page state without creating a new history entry, use `replaceState` instead of `pushState`.

## Loading data for a route

When shallow routing, you may want to render another `+page.svelte` inside the current page. For example, clicking on a photo thumbnail could pop up the detail view without navigating to the photo page.

For this to work, you need to load the data that the `+page.svelte` expects. A convenient way to do this is to use [`preloadData`](/docs/modules#$app-navigation-preloaddata) inside the `click` handler of an `<a>` element. If the element (or a parent) uses [`data-sveltekit-preload-data`](/docs/link-options#data-sveltekit-preload-data), the data will have already been requested, and `preloadData` will reuse that request.

```svelte
<!--- file: src/routes/photos/+page.svelte --->
<script>
	import { preloadData, pushState, goto } from '$app/navigation';
	import { page } from '$app/stores';
	import Modal from './Modal.svelte';
	import PhotoPage from './[id]/+page.svelte';

	export let data;
</script>

{#each data.thumbnails as thumbnail}
	<a
		href="/photos/{thumbnail.id}"
		on:click={async (e) => {
			// bail if opening a new tab, or we're on too small a screen
			if (e.metaKey || innerWidth < 640) return;

			// prevent navigation
			e.preventDefault();

			const { href } = e.currentTarget;

			// run `load` functions (or rather, get the result of the `load` functions
			// that are already running because of `data-sveltekit-preload-data`)
			const result = await preloadData(href);

			if (result.type === 'loaded' && result.status === 200) {
				pushState(href, { selected: result.data });
			} else {
				// something bad happened! try navigating
				goto(href);
			}
		}}
	>
		<img alt={thumbnail.alt} src={thumbnail.src} />
	</a>
{/each}

{#if $page.state.selected}
	<Modal on:close={() => history.back()}>
		<!-- pass page data to the +page.svelte component,
		     just like SvelteKit would on navigation -->
		<PhotoPage data={$page.state.selected} />
	</Modal>
{/if}
```

## Caveats

During server-side rendering, `$page.state` is always an empty object. The same is true for the first page the user lands on — if the user reloads the page (or returns from another document), state will _not_ be applied until they navigate.

Shallow routing is a feature that requires JavaScript to work. Be mindful when using it and try to think of sensible fallback behavior in case JavaScript isn't available.

####### documentation/docs/30-advanced/70-packaging.md #######

---
title: Packaging
---

You can use SvelteKit to build apps as well as component libraries, using the `@sveltejs/package` package (`npm create svelte` has an option to set this up for you).

When you're creating an app, the contents of `src/routes` is the public-facing stuff; [`src/lib`](modules#$lib) contains your app's internal library.

A component library has the exact same structure as a SvelteKit app, except that `src/lib` is the public-facing bit, and your root `package.json` is used to publish the package. `src/routes` might be a documentation or demo site that accompanies the library, or it might just be a sandbox you use during development.

Running the `svelte-package` command from `@sveltejs/package` will take the contents of `src/lib` and generate a `dist` directory (which can be [configured](#options)) containing the following:

- All the files in `src/lib`. Svelte components will be preprocessed, TypeScript files will be transpiled to JavaScript.
- Type definitions (`d.ts` files) which are generated for Svelte, JavaScript and TypeScript files. You need to install `typescript >= 4.0.0` for this. Type definitions are placed next to their implementation, hand-written `d.ts` files are copied over as is. You can [disable generation](#options), but we strongly recommend against it — people using your library might use TypeScript, for which they require these type definition files.

> `@sveltejs/package` version 1 generated a `package.json`. This is no longer the case and it will now use the `package.json` from your project and validate that it is correct instead. If you're still on version 1, see [this PR](https://github.com/sveltejs/kit/pull/8922) for migration instructions.

## Anatomy of a package.json

Since you're now building a library for public use, the contents of your `package.json` will become more important. Through it, you configure the entry points of your package, which files are published to npm, and which dependencies your library has. Let's go through the most important fields one by one.

### name

This is the name of your package. It will be available for others to install using that name, and visible on `https://npmjs.com/package/<name>`.

```json
{
	"name": "your-library"
}
```

Read more about it [here](https://docs.npmjs.com/cli/v9/configuring-npm/package-json#name).

### license

Every package should have a license field so people know how they are allowed to use it. A very popular license which is also very permissive in terms of distribution and reuse without warranty is `MIT`.

```json
{
	"license": "MIT"
}
```

Read more about it [here](https://docs.npmjs.com/cli/v9/configuring-npm/package-json#license). Note that you should also include a `LICENSE` file in your package.

### files

This tells npm which files it will pack up and upload to npm. It should contain your output folder (`dist` by default). Your `package.json` and `README` and `LICENSE` will always be included, so you don't need to specify them.

```json
{
	"files": ["dist"]
}
```

To exclude unnecessary files (such as unit tests, or modules that are only imported from `src/routes` etc) you can add them to an `.npmignore` file. This will result in smaller packages that are faster to install.

Read more about it [here](https://docs.npmjs.com/cli/v9/configuring-npm/package-json#files).

### exports

The `"exports"` field contains the package's entry points. If you set up a new library project through `npm create svelte@latest`, it's set to a single export, the package root:

```json
{
	"exports": {
		".": {
			"types": "./dist/index.d.ts",
			"svelte": "./dist/index.js"
		}
	}
}
```

This tells bundlers and tooling that your package only has one entry point, the root, and everything should be imported through that, like this:

```js
// @errors: 2307
import { Something } from 'your-library';
```

The `types` and `svelte` keys are [export conditions](https://nodejs.org/api/packages.html#conditional-exports). They tell tooling what file to import when they look up the `your-library` import:

- TypeScript sees the `types` condition and looks up the type definition file. If you don't publish type definitions, omit this condition.
- Svelte-aware tooling sees the `svelte` condition and knows this is a Svelte component library. If you publish a library that does not export any Svelte components and that could also work in non-Svelte projects (for example a Svelte store library), you can replace this condition with `default`.

> Previous versions of `@sveltejs/package` also added a `package.json` export. This is no longer part of the template because all tooling can now deal with a `package.json` not being explicitly exported.

You can adjust `exports` to your liking and provide more entry points. For example, if instead of a `src/lib/index.js` file that re-exported components you wanted to expose a `src/lib/Foo.svelte` component directly, you could create the following export map...

```json
{
	"exports": {
		"./Foo.svelte": {
			"types": "./dist/Foo.svelte.d.ts",
			"svelte": "./dist/Foo.svelte"
		}
	}
}
```

...and a consumer of your library could import the component like so:

```js
// @filename: ambient.d.ts
declare module 'your-library/Foo.svelte';

// @filename: index.js
// ---cut---
import Foo from 'your-library/Foo.svelte';
```

> Beware that doing this will need additional care if you provide type definitions. Read more about the caveat [here](#typescript)

In general, each key of the exports map is the path the user will have to use to import something from your package, and the value is the path to the file that will be imported or a map of export conditions which in turn contains these file paths.

Read more about `exports` [here](https://nodejs.org/docs/latest-v18.x/api/packages.html#package-entry-points).

### svelte

This is a legacy field that enabled tooling to recognise Svelte component libraries. It's no longer necessary when using the `svelte` [export condition](#anatomy-of-a-package-json-exports), but for backwards compatibility with outdated tooling that doesn't yet know about export conditions it's good to keep it around. It should point towards your root entry point.

```json
{
	"svelte": "./dist/index.js"
}
```

## TypeScript

You should ship type definitions for your library even if you don't use TypeScript yourself so that people who do get proper intellisense when using your library. `@sveltejs/package` makes the process of generating types mostly opaque to you. By default, when packaging your library, type definitions are auto-generated for JavaScript, TypeScript and Svelte files. All you need to ensure is that the `types` condition in the [exports](#anatomy-of-a-package-json-exports) map points to the correct files. When initialising a library project through `npm create svelte@latest`, this is automatically setup for the root export.

If you have something else than a root export however — for example providing a `your-library/foo` import — you need to take additional care for providing type definitions. Unfortunately, TypeScript by default will _not_ resolve the `types` condition for an export like `{ "./foo": { "types": "./dist/foo.d.ts", ... }}`. Instead, it will search for a `foo.d.ts` relative to the root of your library (i.e. `your-library/foo.d.ts` instead of `your-library/dist/foo.d.ts`). To fix this, you have two options:

The first option is to require people using your library to set the `moduleResolution` option in their `tsconfig.json` (or `jsconfig.json`) to `bundler` (available since TypeScript 5, the best and recommended option in the future), `node16` or `nodenext`. This opts TypeScript into actually looking at the exports map and resolving the types correctly.

The second option is to (ab)use the `typesVersions` feature from TypeScript to wire up the types. This is a field inside `package.json` TypeScript uses to check for different type definitions depending on the TypeScript version, and also contains a path mapping feature for that. We leverage that path mapping feature to get what we want. For the mentioned `foo` export above, the corresponding `typesVersions` looks like this:

```json
{
	"exports": {
		"./foo": {
			"types": "./dist/foo.d.ts",
			"svelte": "./dist/foo.js"
		}
	},
	"typesVersions": {
		">4.0": {
			"foo": ["./dist/foo.d.ts"]
		}
	}
}
```

`>4.0` tells TypeScript to check the inner map if the used TypeScript version is greater than 4 (which should in practice always be true). The inner map tells TypeScript that the typings for `your-library/foo` are found within `./dist/foo.d.ts`, which essentially replicates the `exports` condition. You also have `*` as a wildcard at your disposal to make many type definitions at once available without repeating yourself. Note that if you opt into `typesVersions` you have to declare all type imports through it, including the root import (which is defined as `"index.d.ts": [..]`).

You can read more about that feature [here](https://www.typescriptlang.org/docs/handbook/declaration-files/publishing.html#version-selection-with-typesversions).

## Best practices

You should avoid using [SvelteKit-specific modules](modules) like `$app` in your packages unless you intend for them to only be consumable by other SvelteKit projects. E.g. rather than using `import { browser } from '$app/environment'` you could use `import { BROWSER } from 'esm-env'` ([see esm-env docs](https://github.com/benmccann/esm-env)). You may also wish to pass in things like the current URL or a navigation action as a prop rather than relying directly on `$app/stores`, `$app/navigation`, etc. Writing your app in this more generic fashion will also make it easier to setup tools for testing, UI demos and so on.

Ensure that you add [aliases](configuration#alias) via `svelte.config.js` (not `vite.config.js` or `tsconfig.json`), so that they are processed by `svelte-package`.

You should think carefully about whether or not the changes you make to your package are a bug fix, a new feature, or a breaking change, and update the package version accordingly. Note that if you remove any paths from `exports` or any `export` conditions inside them from your existing library, that should be regarded as a breaking change.

```diff
{
	"exports": {
		".": {
			"types": "./dist/index.d.ts",
// changing `svelte` to `default` is a breaking change:
-			"svelte": "./dist/index.js"
+			"default": "./dist/index.js"
		},
// removing this is a breaking change:
-		"./foo": {
-			"types": "./dist/foo.d.ts",
-			"svelte": "./dist/foo.js",
-			"default": "./dist/foo.js"
-		},
// adding this is ok:
+		"./bar": {
+			"types": "./dist/bar.d.ts",
+			"svelte": "./dist/bar.js",
+			"default": "./dist/bar.js"
+		}
	}
}
```

## Options

`svelte-package` accepts the following options:

- `-w`/`--watch` — watch files in `src/lib` for changes and rebuild the package
- `-i`/`--input` — the input directory which contains all the files of the package. Defaults to `src/lib`
- `-o`/`--o` — the output directory where the processed files are written to. Your `package.json`'s `exports` should point to files inside there, and the `files` array should include that folder. Defaults to `dist`
- `-t`/`--types` — whether or not to create type definitions (`d.ts` files). We strongly recommend doing this as it fosters ecosystem library quality. Defaults to `true`
- `--tsconfig` - the path to a tsconfig or jsconfig. When not provided, searches for the next upper tsconfig/jsconfig in the workspace path.

## Publishing

To publish the generated package:

```sh
npm publish
```

## Caveats

All relative file imports need to be fully specified, adhering to Node's ESM algorithm. This means that for a file like `src/lib/something/index.js`, you must include the filename with the extension:

```diff
-import { something } from './something';
+import { something } from './something/index.js';
```

If you are using TypeScript, you need to import `.ts` files the same way, but using a `.js` file ending, _not_ a `.ts` file ending. (This is a TypeScript design decision outside our control.) Setting `"moduleResolution": "NodeNext"` in your `tsconfig.json` or `jsconfig.json` will help you with this.

All files except Svelte files (preprocessed) and TypeScript files (transpiled to JavaScript) are copied across as-is.

####### documentation/docs/30-advanced/meta.json #######

```

{
	"title": "Advanced"
}

```


####### documentation/docs/40-best-practices/05-performance.md #######

---
title: Performance
---

Out of the box, SvelteKit does a lot of work to make your applications as performant as possible:

- Code-splitting, so that only the code you need for the current page is loaded
- Asset preloading, so that 'waterfalls' (of files requesting other files) are prevented
- File hashing, so that your assets can be cached forever
- Request coalescing, so that data fetched from separate server `load` functions is grouped into a single HTTP request
- Parallel loading, so that separate universal `load` functions fetch data simultaneously
- Data inlining, so that requests made with `fetch` during server rendering can be replayed in the browser without issuing a new request
- Conservative invalidation, so that `load` functions are only re-run when necessary
- Prerendering (configurable on a per-route basis, if necessary) so that pages without dynamic data can be served instantaneously
- Link preloading, so that data and code requirements for a client-side navigation are eagerly anticipated

Nevertheless, we can't (yet) eliminate all sources of slowness. To eke out maximum performance, you should be mindful of the following tips.

## Diagnosing issues

Google's [PageSpeed Insights](https://pagespeed.web.dev/) and (for more advanced analysis) [WebPageTest](https://www.webpagetest.org/) are excellent ways to understand the performance characteristics of a site that is already deployed to the internet.

Your browser also includes useful developer tools for analysing your site, whether deployed or running locally:

* Chrome - [Lighthouse](https://developer.chrome.com/docs/lighthouse/overview#devtools), [Network](https://developer.chrome.com/docs/devtools/network), and [Performance](https://developer.chrome.com/docs/devtools/performance) devtools
* Edge - [Lighthouse](https://learn.microsoft.com/en-us/microsoft-edge/devtools-guide-chromium/lighthouse/lighthouse-tool), [Network](https://learn.microsoft.com/en-us/microsoft-edge/devtools-guide-chromium/network/), and [Performance](https://learn.microsoft.com/en-us/microsoft-edge/devtools-guide-chromium/evaluate-performance/) devtools
* Firefox - [Network](https://firefox-source-docs.mozilla.org/devtools-user/network_monitor/) and [Performance](https://hacks.mozilla.org/2022/03/performance-tool-in-firefox-devtools-reloaded/) devtools
* Safari - [enhancing the performance of your webpage](https://developer.apple.com/library/archive/documentation/NetworkingInternetWeb/Conceptual/Web_Inspector_Tutorial/EnhancingyourWebpagesPerformance/EnhancingyourWebpagesPerformance.html)

Note that your site running locally in `dev` mode will exhibit different behaviour than your production app, so you should do performance testing in [preview](/docs/building-your-app#preview-your-app) mode after building.

### Instrumenting

If you see in the network tab of your browser that an API call is taking a long time and you'd like to understand why, you may consider instrumenting your backend with a tool like [OpenTelemetry](https://opentelemetry.io/) or [Server-Timing headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Server-Timing).

## Optimizing assets

### Images

Reducing the size of image files is often one of the most impactful changes you can make to a site's performance. Svelte provides the `@sveltejs/enhanced-image` package, detailed on the [images](images) page, for making this easier. Additionally, Lighthouse is useful for identifying the worst offenders.

### Videos

Video files can be very large, so extra care should be taken to ensure that they're optimized:

- Compress videos with tools such as [Handbrake](https://handbrake.fr/). Consider converting the videos to web-friendly formats such as `.webm` or `.mp4`.
- You can [lazy-load videos](https://web.dev/articles/lazy-loading-video) located below the fold with `preload="none"` (though note that this will slow down playback when the user _does_ initiate it).
- Strip the audio track out of muted videos using a tool like [FFmpeg](https://ffmpeg.org/).

### Fonts

SvelteKit automatically preloads critical `.js` and `.css` files when the user visits a page, but it does _not_ preload fonts by default, since this may cause unnecessary files (such as font weights that are referenced by your CSS but not actually used on the current page) to be downloaded. Having said that, preloading fonts correctly can make a big difference to how fast your site feels. In your [`handle`](hooks#server-hooks-handle) hook, you can call `resolve` with a `preload` filter that includes your fonts.

You can reduce the size of font files by [subsetting](https://web.dev/learn/performance/optimize-web-fonts#subset_your_web_fonts) your fonts.

## Reducing code size

### Svelte version

We recommend running the latest version of Svelte. Svelte 4 is smaller and faster than Svelte 3. (The [Svelte 5 preview](https://svelte-5-preview.vercel.app/) is much smaller and faster still, but we don't recommend that you upgrade to this version until it's production ready.)

### Packages

[`rollup-plugin-visualizer`](https://www.npmjs.com/package/rollup-plugin-visualizer) can be helpful for identifying which packages are contributing the most to the size of your site. You may also find opportunities to remove code by manually inspecting the build output (use `build: { minify: false }` in your [Vite config](https://vitejs.dev/config/build-options.html#build-minify) to make the output readable, but remember to undo that before deploying your app), or via the network tab of your browser's devtools.

### External scripts

Try to minimize the number of third-party scripts running in the browser. For example, instead of using JavaScript-based analytics consider using server-side implementations, such as those offered by many platforms with SvelteKit adapters including [Cloudflare](https://www.cloudflare.com/web-analytics/), [Netlify](https://docs.netlify.com/monitor-sites/site-analytics/), and [Vercel](https://vercel.com/docs/analytics).

To run third party scripts in a web worker (which avoids blocking the main thread), use [Partytown's SvelteKit integration](https://partytown.builder.io/sveltekit).

### Selective loading

Code imported with static `import` declarations will be automatically bundled with the rest of your page. If there is a piece of code you need only when some condition is met, use the dynamic `import(...)` form instead.

## Navigation

### Preloading

You can speed up client-side navigations by eagerly preloading the necessary code and data, using [link options](link-options). This is configured by default on the `<body>` element when you create a new SvelteKit app.

### Non-essential data

For slow-loading data that isn't needed immediately, the object returned from your `load` function can contain promises rather than the data itself. For server `load` functions, this will cause the data to [stream](load#streaming-with-promises) in after the navigation (or initial page load).

### Preventing waterfalls

One of the biggest performance killers is what is referred to as a _waterfall_, which is a series of requests that is made sequentially. This can happen on the server or in the browser.

- Asset waterfalls can occur in the browser when your HTML requests JS which requests CSS which requests a background image and web font. SvelteKit will largely solve this class of problems for you by adding [`modulepreload`](https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/rel/modulepreload) tags or headers, but you should view [the network tab in your devtools](#diagnosing-issues) to check whether additional resources need to be preloaded. Pay special attention to this if you use web [fonts](#optimizing-assets-fonts) since they need to be handled manually.
- If a universal `load` function makes an API call to fetch the current user, then uses the details from that response to fetch a list of saved items, and then uses _that_ response to fetch the details for each item, the browser will end up making multiple sequential requests. This is deadly for performance, especially for users that are physically located far from your backend. Avoid this issue by using [server `load` functions](/docs/load#universal-vs-server) where possible.
- Server `load` functions are also not immune to waterfalls (though they are much less costly since they rarely involve roundtrips with high latency). For example if you query a database to get the current user and then use that data to make a second query for a list of saved items, it will typically be more performant to issue a single query with a database join.

## Hosting

Your frontend should be located in the same data center as your backend to minimize latency. For sites with no central backend, many SvelteKit adapters support deploying to the _edge_, which means handling each user's requests from a nearby server. This can reduce load times significantly. Some adapters even support [configuring deployment on a per-route basis](https://kit.svelte.dev/docs/page-options#config). You should also consider serving images from a CDN (which are typically edge networks) — the hosts for many SvelteKit adapters will do this automatically.

Ensure your host uses HTTP/2 or newer. Vite's code splitting creates numerous small files for improved cacheability, which results in excellent performance, but this does assume that your files can be loaded in parallel with HTTP/2.

## Further reading

For the most part, building a performant SvelteKit app is the same as building any performant web app. You should be able to apply information from general performance resources such as [Core Web Vitals](https://web.dev/explore/learn-core-web-vitals) to any web experience you build.

####### documentation/docs/40-best-practices/07-images.md #######

---
title: Images
---

Images can have a big impact on your app's performance. For best results, you should optimize them by doing the following:

- generate optimal formats like `.avif` and `.webp`
- create different sizes for different screens
- ensure that assets can be cached effectively

Doing this manually is tedious. There are a variety of techniques you can use, depending on your needs and preferences.

## Vite's built-in handling

[Vite will automatically process imported assets](https://vitejs.dev/guide/assets.html) for improved performance. This includes assets referenced via the CSS `url()` function. Hashes will be added to the filenames so that they can be cached, and assets smaller than `assetsInlineLimit` will be inlined. Vite's asset handling is most often used for images, but is also useful for video, audio, etc.

```svelte
<script>
	import logo from '$lib/assets/logo.png';
</script>

<img alt="The project logo" src={logo} />
```

## @sveltejs/enhanced-img

`@sveltejs/enhanced-img` is a plugin offered on top of Vite's built-in asset handling. It provides plug and play image processing that serves smaller file formats like `avif` or `webp`, automatically sets the intrinsic `width` and `height` of the image to avoid layout shift, creates images of multiple sizes for various devices, and strips EXIF data for privacy. It will work in any Vite-based project including, but not limited to, SvelteKit projects.

> As a build plugin, `@sveltejs/enhanced-img` can only optimize files located on your machine during the build process. If you have an image located elsewhere (such as a path served from your database, CMS, or backend), please read about [loading images dynamically from a CDN](#loading-images-dynamically-from-a-cdn).
>
> **WARNING**: The `@sveltejs/enhanced-img` package is experimental. It uses pre-1.0 versioning and may introduce breaking changes with every minor version release.

### Setup

Install:

```bash
npm install --save-dev @sveltejs/enhanced-img
```

Adjust `vite.config.js`:

```diff
import { sveltekit } from '@sveltejs/kit/vite';
+import { enhancedImages } from '@sveltejs/enhanced-img';
import { defineConfig } from 'vite';

export default defineConfig({
	plugins: [
+		enhancedImages(),
		sveltekit()
	]
});
```

Building will take longer on the first build due to the computational expense of transforming images. However, the build output will be cached in `./node_modules/.cache/imagetools` so that subsequent builds will be fast.

### Basic usage

Use in your `.svelte` components by using `<enhanced:img>` rather than `<img>` and referencing the image file with a [Vite asset import](https://vitejs.dev/guide/assets.html#static-asset-handling) path:

```svelte
<enhanced:img src="./path/to/your/image.jpg" alt="An alt text" />
```

At build time, your `<enhanced:img>` tag will be replaced with an `<img>` wrapped by a `<picture>` providing multiple image types and sizes. It's only possible to downscale images without losing quality, which means that you should provide the highest resolution image that you need — smaller versions will be generated for the various device types that may request an image.

You should provide your image at 2x resolution for HiDPI displays (a.k.a. retina displays). `<enhanced:img>` will automatically take care of serving smaller versions to smaller devices.

If you wish to add styles to your `<enhanced:img>`, you should add a `class` and target that.

### Dynamically choosing an image

You can also manually import an image asset and pass it to an `<enhanced:img>`. This is useful when you have a collection of static images and would like to dynamically choose one or [iterate over them](https://github.com/sveltejs/kit/blob/main/sites/kit.svelte.dev/src/routes/home/Showcase.svelte). In this case you will need to update both the `import` statement and `<img>` element as shown below to indicate you'd like process them.

```svelte
<script>
	import MyImage from './path/to/your/image.jpg?enhanced';
</script>

<enhanced:img src={MyImage} alt="Some alt text" />
```

You can also use [Vite's `import.meta.glob`](https://vitejs.dev/guide/features.html#glob-import). Note that you will have to specify `enhanced` via a [custom query](https://vitejs.dev/guide/features.html#custom-queries):

```js
const pictures = import.meta.glob(
	'/path/to/assets/*.{avif,gif,heif,jpeg,jpg,png,tiff,webp}',
	{
		query: {
			enhanced: true
		}
	}
);
```

### Intrinsic Dimensions

`width` and `height` are optional as they can be inferred from the source image and will be automatically added when the `<enhanced:img>` tag is preprocessed. With these attributes, the browser can reserve the correct amount of space, preventing [layout shift](https://web.dev/articles/cls). If you'd like to use a different `width` and `height` you can style the image with CSS. Because the preprocessor adds a `width` and `height` for you, if you'd like one of the dimensions to be automatically calculated then you will need to specify that:

```svelte
<style>
	.hero-image img {
		width: var(--size);
		height: auto;
	}
</style>
```

### `srcset` and `sizes`

If you have a large image, such as a hero image taking the width of the design, you should specify `sizes` so that smaller versions are requested on smaller devices. E.g. if you have a 1280px image you may want to specify something like:

```svelte
<enhanced:img src="./image.png" sizes="min(1280px, 100vw)"/>
```

If `sizes` is specified, `<enhanced:img>` will generate small images for smaller devices and populate the `srcset` attribute.

The smallest picture generated automatically will have a width of 540px. If you'd like smaller images or would otherwise like to specify custom widths, you can do that with the `w` query parameter:
```svelte
<enhanced:img
  src="./image.png?w=1280;640;400"
  sizes="(min-width:1920px) 1280px, (min-width:1080px) 640px, (min-width:768px) 400px"
/>
```

If `sizes` is not provided, then a HiDPI/Retina image and a standard resolution image will be generated. The image you provide should be 2x the resolution you wish to display so that the browser can display that image on devices with a high [device pixel ratio](https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio).

### Per-image transforms

By default, enhanced images will be transformed to more efficient formats. However, you may wish to apply other transforms such as a blur, quality, flatten, or rotate operation. You can run per-image transforms by appending a query string:

```svelte
<enhanced:img src="./path/to/your/image.jpg?blur=15" alt="An alt text" />
```

[See the imagetools repo for the full list of directives](https://github.com/JonasKruckenberg/imagetools/blob/main/docs/directives.md).

## Loading images dynamically from a CDN

In some cases, the images may not be accessible at build time — e.g. they may live inside a content management system or elsewhere.

Using a content delivery network (CDN) can allow you to optimize these images dynamically, and provides more flexibility with regards to sizes, but it may involve some setup overhead and usage costs. Depending on caching strategy, the browser may not be able to use a cached copy of the asset until a [304 response](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/304) is received from the CDN. Building HTML to target CDNs allows using an `<img>` tag since the CDN can serve the appropriate format based on the `User-Agent` header, whereas build-time optimizations must produce `<picture>` tags with multiple sources. Finally, some CDNs may generate images lazily, which could have a negative performance impact for sites with low traffic and frequently changing images.

CDNs can generally be used without any need for a library. However, there are a number of libraries with Svelte support that make it easier. [`@unpic/svelte`](https://unpic.pics/img/svelte/) is a CDN-agnostic library with support for a large number of providers. You may also find that specific CDNs like [Cloudinary](https://svelte.cloudinary.dev/) have Svelte support. Finally, some content management systems (CMS) which support Svelte (such as [Contentful](https://www.contentful.com/sveltekit-starter-guide/), [Storyblok](https://github.com/storyblok/storyblok-svelte), and [Contentstack](https://www.contentstack.com/docs/developers/sample-apps/build-a-starter-website-with-sveltekit-and-contentstack)) have built-in support for image handling.

## Best practices

- For each image type, use the appropriate solution from those discussed above. You can mix and match all three solutions in one project. For example, you may use Vite's built-in handling to provide images for `<meta>` tags, display images on your homepage with `@sveltejs/enhanced-img`, and display user-submitted content with a dynamic approach.
- Consider serving all images via CDN regardless of the image optimization types you use. CDNs reduce latency by distributing copies of static assets globally.
- Your original images should have a good quality/resolution and should have 2x the width it will be displayed at to serve HiDPI devices. Image processing can size images down to save bandwidth when serving smaller screens, but it would be a waste of bandwidth to invent pixels to size images up.
- For images which are much larger than the width of a mobile device (roughly 400px), such as a hero image taking the width of the page design, specify `sizes` so that smaller images can be served on smaller devices.
- For important images, such as the [largest contentful paint (LCP)](https://web.dev/articles/lcp) image, set `fetchpriority="high" loading="eager"` to prioritize loading as early as possible.
- Give the image a container or styling so that it is constrained and does not jump around while the page is loading affecting your [cumulative layout shift (CLS)](https://web.dev/articles/cls). `width` and `height` help the browser to reserve space while the image is still loading, so `@sveltejs/enhanced-img` will add a `width` and `height` for you.
- Always provide a good `alt` text. The Svelte compiler will warn you if you don't do this.
- Do not use `em` or `rem` in `sizes` and change the default size of these measures. When used in `sizes` or `@media` queries, `em` and `rem` are both defined to mean the user's default `font-size`. For a `sizes` declaration like `sizes="(min-width: 768px) min(100vw, 108rem), 64rem"`, the actual `em` or `rem` that controls how the image is laid out on the page can be different if changed by CSS. For example, do not do something like `html { font-size: 62.5%; }` as the slot reserved by the browser preloader will now end up being larger than the actual slot of the CSS object model once it has been created.

####### documentation/docs/40-best-practices/10-accessibility.md #######

---
title: Accessibility
---

SvelteKit strives to provide an accessible platform for your app by default. Svelte's [compile-time accessibility checks](https://svelte.dev/docs#accessibility-warnings) will also apply to any SvelteKit application you build.

Here's how SvelteKit's built-in accessibility features work and what you need to do to help these features to work as well as possible. Keep in mind that while SvelteKit provides an accessible foundation, you are still responsible for making sure your application code is accessible. If you're new to accessibility, see the ["further reading"](accessibility#further-reading) section of this guide for additional resources.

We recognize that accessibility can be hard to get right. If you want to suggest improvements to how SvelteKit handles accessibility, please [open a GitHub issue](https://github.com/sveltejs/kit/issues).

## Route announcements

In traditional server-rendered applications, every navigation (e.g. clicking on an `<a>` tag) triggers a full page reload. When this happens, screen readers and other assistive technology will read out the new page's title so that users understand that the page has changed.

Since navigation between pages in SvelteKit happens without reloading the page (known as [client-side routing](glossary#routing)), SvelteKit injects a [live region](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Live_Regions) onto the page that will read out the new page name after each navigation. This determines the page name to announce by inspecting the `<title>` element.

Because of this behavior, every page in your app should have a unique, descriptive title. In SvelteKit, you can do this by placing a `<svelte:head>` element on each page:

```svelte
<!--- file: src/routes/+page.svelte --->
<svelte:head>
	<title>Todo List</title>
</svelte:head>
```

This will allow screen readers and other assistive technology to identify the new page after a navigation occurs. Providing a descriptive title is also important for [SEO](seo#manual-setup-title-and-meta).

## Focus management

In traditional server-rendered applications, every navigation will reset focus to the top of the page. This ensures that people browsing the web with a keyboard or screen reader will start interacting with the page from the beginning.

To simulate this behavior during client-side routing, SvelteKit focuses the `<body>` element after each navigation and [enhanced form submission](https://kit.svelte.dev/docs/form-actions#progressive-enhancement). There is one exception - if an element with the [`autofocus`](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/autofocus) attribute is present, SvelteKit will focus that element instead. Make sure to [consider the implications for assistive technology](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/autofocus#accessibility_considerations) when using that attribute.

If you want to customize SvelteKit's focus management, you can use the `afterNavigate` hook:

```js
/// <reference types="@sveltejs/kit" />
// ---cut---
import { afterNavigate } from '$app/navigation';

afterNavigate(() => {
	/** @type {HTMLElement | null} */
	const to_focus = document.querySelector('.focus-me');
	to_focus?.focus();
});
```

You can also programmatically navigate to a different page using the [`goto`](modules#$app-navigation-goto) function. By default, this will have the same client-side routing behavior as clicking on a link. However, `goto` also accepts a `keepFocus` option that will preserve the currently-focused element instead of resetting focus. If you enable this option, make sure the currently-focused element still exists on the page after navigation. If the element no longer exists, the user's focus will be lost, making for a confusing experience for assistive technology users.

## The "lang" attribute

By default, SvelteKit's page template sets the default language of the document to English. If your content is not in English, you should update the `<html>` element in `src/app.html` to have the correct [`lang`](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/lang#accessibility) attribute. This will ensure that any assistive technology reading the document uses the correct pronunciation. For example, if your content is in German, you should update `app.html` to the following:

```html
/// file: src/app.html
<html lang="de">
```

If your content is available in multiple languages, you should set the `lang` attribute based on the language of the current page. You can do this with SvelteKit's [handle hook](hooks#server-hooks-handle):

```html
/// file: src/app.html
<html lang="%lang%">
```

```js
/// file: src/hooks.server.js
/**
 * @param {import('@sveltejs/kit').RequestEvent} event
 */
function get_lang(event) {
	return 'en';
}
// ---cut---
/** @type {import('@sveltejs/kit').Handle} */
export function handle({ event, resolve }) {
	return resolve(event, {
		transformPageChunk: ({ html }) => html.replace('%lang%', get_lang(event))
	});
}
```

## Further reading

For the most part, building an accessible SvelteKit app is the same as building an accessible web app. You should be able to apply information from the following general accessibility resources to any web experience you build:

- [MDN Web Docs: Accessibility](https://developer.mozilla.org/en-US/docs/Learn/Accessibility)
- [The A11y Project](https://www.a11yproject.com/)
- [How to Meet WCAG (Quick Reference)](https://www.w3.org/WAI/WCAG21/quickref/)

####### documentation/docs/40-best-practices/20-seo.md #######

---
title: SEO
---

The most important aspect of SEO is to create high-quality content that is widely linked to from around the web. However, there are a few technical considerations for building sites that rank well.

## Out of the box

### SSR

While search engines have got better in recent years at indexing content that was rendered with client-side JavaScript, server-side rendered content is indexed more frequently and reliably. SvelteKit employs SSR by default, and while you can disable it in [`handle`](hooks#server-hooks-handle), you should leave it on unless you have a good reason not to.

> SvelteKit's rendering is highly configurable and you can implement [dynamic rendering](https://developers.google.com/search/docs/advanced/javascript/dynamic-rendering) if necessary. It's not generally recommended, since SSR has other benefits beyond SEO.

### Performance

Signals such as [Core Web Vitals](https://web.dev/vitals/#core-web-vitals) impact search engine ranking. Because Svelte and SvelteKit introduce minimal overhead, it's easier to build high performance sites. You can test your site's performance using Google's [PageSpeed Insights](https://pagespeed.web.dev/) or [Lighthouse](https://developers.google.com/web/tools/lighthouse). Read [the performance page](performance) for more details.

### Normalized URLs

SvelteKit redirects pathnames with trailing slashes to ones without (or vice versa depending on your [configuration](page-options#trailingslash)), as duplicate URLs are bad for SEO.

## Manual setup

### &lt;title&gt; and &lt;meta&gt;

Every page should have well-written and unique `<title>` and `<meta name="description">` elements inside a [`<svelte:head>`](https://svelte.dev/docs#template-syntax-svelte-head). Guidance on how to write descriptive titles and descriptions, along with other suggestions on making content understandable by search engines, can be found on Google's [Lighthouse SEO audits](https://web.dev/lighthouse-seo/) documentation.

> A common pattern is to return SEO-related `data` from page [`load`](load) functions, then use it (as [`$page.data`](modules#$app-stores)) in a `<svelte:head>` in your root [layout](routing#layout).

### Sitemaps

[Sitemaps](https://developers.google.com/search/docs/advanced/sitemaps/build-sitemap) help search engines prioritize pages within your site, particularly when you have a large amount of content. You can create a sitemap dynamically using an endpoint:

```js
/// file: src/routes/sitemap.xml/+server.js
export async function GET() {
	return new Response(
		`
		<?xml version="1.0" encoding="UTF-8" ?>
		<urlset
			xmlns="https://www.sitemaps.org/schemas/sitemap/0.9"
			xmlns:xhtml="https://www.w3.org/1999/xhtml"
			xmlns:mobile="https://www.google.com/schemas/sitemap-mobile/1.0"
			xmlns:news="https://www.google.com/schemas/sitemap-news/0.9"
			xmlns:image="https://www.google.com/schemas/sitemap-image/1.1"
			xmlns:video="https://www.google.com/schemas/sitemap-video/1.1"
		>
			<!-- <url> elements go here -->
		</urlset>`.trim(),
		{
			headers: {
				'Content-Type': 'application/xml'
			}
		}
	);
}
```

### AMP

An unfortunate reality of modern web development is that it is sometimes necessary to create an [Accelerated Mobile Pages (AMP)](https://amp.dev/) version of your site. In SvelteKit this can be done by setting the [`inlineStyleThreshold`](configuration#inlinestylethreshold) option...

```js
/// file: svelte.config.js
/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		// since <link rel="stylesheet"> isn't
		// allowed, inline all styles
		inlineStyleThreshold: Infinity
	}
};

export default config;
```

...disabling `csr` in your root `+layout.js`/`+layout.server.js`...

```js
/// file: src/routes/+layout.server.js
export const csr = false;
```

...adding `amp` to your `app.html`

```html
<html amp>
...
```

...and transforming the HTML using `transformPageChunk` along with `transform` imported from `@sveltejs/amp`:

```js
/// file: src/hooks.server.js
import * as amp from '@sveltejs/amp';

/** @type {import('@sveltejs/kit').Handle} */
export async function handle({ event, resolve }) {
	let buffer = '';
	return await resolve(event, {
		transformPageChunk: ({ html, done }) => {
			buffer += html;
			if (done) return amp.transform(buffer);
		}
	});
}
```

To prevent shipping any unused CSS as a result of transforming the page to amp, we can use [`dropcss`](https://www.npmjs.com/package/dropcss):

```js
/// file: src/hooks.server.js
// @errors: 2307
import * as amp from '@sveltejs/amp';
import dropcss from 'dropcss';

/** @type {import('@sveltejs/kit').Handle} */
export async function handle({ event, resolve }) {
	let buffer = '';

	return await resolve(event, {
		transformPageChunk: ({ html, done }) => {
			buffer += html;

			if (done) {
				let css = '';
				const markup = amp
					.transform(buffer)
					.replace('⚡', 'amp') // dropcss can't handle this character
					.replace(/<style amp-custom([^>]*?)>([^]+?)<\/style>/, (match, attributes, contents) => {
						css = contents;
						return `<style amp-custom${attributes}></style>`;
					});

				css = dropcss({ css, html: markup }).css;
				return markup.replace('</style>', `${css}</style>`);
			}
		}
	});
}

```

> It's a good idea to use the `handle` hook to validate the transformed HTML using `amphtml-validator`, but only if you're prerendering pages since it's very slow.

####### documentation/docs/40-best-practices/meta.json #######

```

{
	"title": "Best practices"
}

```


####### documentation/docs/50-reference/10-configuration.md #######

---
title: Configuration
---

Your project's configuration lives in a `svelte.config.js` file at the root of your project. As well as SvelteKit, this config object is used by other tooling that integrates with Svelte such as editor extensions.

```js
/// file: svelte.config.js
// @filename: ambient.d.ts
declare module '@sveltejs/adapter-auto' {
	const plugin: () => import('@sveltejs/kit').Adapter;
	export default plugin;
}

// @filename: index.js
// ---cut---
import adapter from '@sveltejs/adapter-auto';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter()
	}
};

export default config;
```

> TYPES: @sveltejs/kit#Config

The `kit` property configures SvelteKit, and can have the following properties:

> EXPANDED_TYPES: @sveltejs/kit#KitConfig
####### documentation/docs/50-reference/20-cli.md #######

---
title: Command Line Interface
---

SvelteKit projects use [Vite](https://vitejs.dev), meaning you'll mostly use its CLI (albeit via `npm run dev/build/preview` scripts):

- `vite dev` — start a development server
- `vite build` — build a production version of your app
- `vite preview` — run the production version locally

However SvelteKit includes its own CLI for initialising your project:

## svelte-kit sync

`svelte-kit sync` creates the `tsconfig.json` and all generated types (which you can import as `./$types` inside routing files) for your project. When you create a new project, it is listed as the `prepare` script and will be run automatically as part of the npm lifecycle, so you should not ordinarily have to run this command.

####### documentation/docs/50-reference/30-modules.md #######

---
title: Modules
---

SvelteKit makes a number of modules available to your application.

> MODULES

####### documentation/docs/50-reference/40-types.md #######

---
title: Types
---

## Public types

The following types can be imported from `@sveltejs/kit`:

> TYPES: @sveltejs/kit

## Private types

The following are referenced by the public types documented above, but cannot be imported directly:

> TYPES: Private types

## Generated types

The `RequestHandler` and `Load` types both accept a `Params` argument allowing you to type the `params` object. For example this endpoint expects `foo`, `bar` and `baz` params:

```js
/// file: src/routes/[foo]/[bar]/[baz]/+page.server.js
// @errors: 2355 2322 1360
/** @type {import('@sveltejs/kit').RequestHandler<{
    foo: string;
    bar: string;
    baz: string
  }>} */
export async function GET({ params }) {
	// ...
}
```

Needless to say, this is cumbersome to write out, and less portable (if you were to rename the `[foo]` directory to `[qux]`, the type would no longer reflect reality).

To solve this problem, SvelteKit generates `.d.ts` files for each of your endpoints and pages:

```ts
/// file: .svelte-kit/types/src/routes/[foo]/[bar]/[baz]/$types.d.ts
/// link: false
import type * as Kit from '@sveltejs/kit';

type RouteParams = {
	foo: string;
	bar: string;
	baz: string;
}

export type PageServerLoad = Kit.ServerLoad<RouteParams>;
export type PageLoad = Kit.Load<RouteParams>;
```

These files can be imported into your endpoints and pages as siblings, thanks to the [`rootDirs`](https://www.typescriptlang.org/tsconfig#rootDirs) option in your TypeScript configuration:

```js
/// file: src/routes/[foo]/[bar]/[baz]/+page.server.js
// @filename: $types.d.ts
import type * as Kit from '@sveltejs/kit';

type RouteParams = {
	foo: string;
	bar: string;
	baz: string;
}

export type PageServerLoad = Kit.ServerLoad<RouteParams>;

// @filename: index.js
// @errors: 2355
// ---cut---
/** @type {import('./$types').PageServerLoad} */
export async function GET({ params }) {
	// ...
}
```

```js
/// file: src/routes/[foo]/[bar]/[baz]/+page.js
// @filename: $types.d.ts
import type * as Kit from '@sveltejs/kit';

type RouteParams = {
	foo: string;
	bar: string;
	baz: string;
}

export type PageLoad = Kit.Load<RouteParams>;

// @filename: index.js
// @errors: 2355
// ---cut---
/** @type {import('./$types').PageLoad} */
export async function load({ params, fetch }) {
	// ...
}
```

> For this to work, your own `tsconfig.json` or `jsconfig.json` should extend from the generated `.svelte-kit/tsconfig.json` (where `.svelte-kit` is your [`outDir`](configuration#outdir)):
>
> `{ "extends": "./.svelte-kit/tsconfig.json" }`

### Default tsconfig.json

The generated `.svelte-kit/tsconfig.json` file contains a mixture of options. Some are generated programmatically based on your project configuration, and should generally not be overridden without good reason:

```json
/// file: .svelte-kit/tsconfig.json
{
	"compilerOptions": {
		"baseUrl": "..",
		"paths": {
			"$lib": "src/lib",
			"$lib/*": "src/lib/*"
		},
		"rootDirs": ["..", "./types"]
	},
	"include": ["../src/**/*.js", "../src/**/*.ts", "../src/**/*.svelte"],
	"exclude": ["../node_modules/**", "./**"]
}
```

Others are required for SvelteKit to work properly, and should also be left untouched unless you know what you're doing:

```json
/// file: .svelte-kit/tsconfig.json
{
	"compilerOptions": {
		// this ensures that types are explicitly
		// imported with `import type`, which is
		// necessary as svelte-preprocess cannot
		// otherwise compile components correctly
		"importsNotUsedAsValues": "error",

		// Vite compiles one TypeScript module
		// at a time, rather than compiling
		// the entire module graph
		"isolatedModules": true,

		// TypeScript cannot 'see' when you
		// use an imported value in your
		// markup, so we need this
		"preserveValueImports": true,

		// This ensures both `vite build`
		// and `svelte-package` work correctly
		"lib": ["esnext", "DOM", "DOM.Iterable"],
		"moduleResolution": "node",
		"module": "esnext",
		"target": "esnext"
	}
}
```

## App

> TYPES: App

####### documentation/docs/50-reference/meta.json #######

```

{
	"title": "Reference"
}

```


####### documentation/docs/60-appendix/10-faq.md #######

---
title: Frequently asked questions
---

## Other resources

Please see [the Svelte FAQ](https://svelte.dev/faq) and [`vite-plugin-svelte` FAQ](https://github.com/sveltejs/vite-plugin-svelte/blob/main/docs/faq.md) as well for the answers to questions deriving from those libraries.

## What can I make with SvelteKit?

SvelteKit can be used to create most kinds of applications. Out of the box, SvelteKit supports many features including:

- Dynamic page content with [load](/docs/load) functions and [API routes](/docs/routing#server).
- SEO-friendly dynamic content with [server-side rendering (SSR)](/docs/glossary#ssr).
- User-friendly progressively-enhanced interactive pages with SSR and [Form Actions](/docs/form-actions).
- Static pages with [prerendering](/docs/page-options#prerender).

SvelteKit can also be deployed to a wide spectrum of hosted architectures via [adapters](/docs/adapters). In cases where SSR is used (or server-side logic is added without prerendering), those functions will be adapted to the target backend. Some examples include:

- Self-hosted dynamic web applications with a [Node.js backend](/docs/adapter-node).
- Serverless web applications with backend loaders and APIs deployed as remote functions. See [zero-config deployments](/docs/adapter-auto) for popular deployment options.
- [Static pre-rendered sites](/docs/adapter-static) such as a blog or multi-page site hosted on a CDN or static host. Statically-generated sites are shipped without a backend.
- [Single-page Applications (SPAs)](/docs/single-page-apps) with client-side routing and rendering for API-driven dynamic content. SPAs are shipped without a backend and are not server-rendered. This option is commonly chosen when bundling SvelteKit with an app written in PHP, .Net, Java, C, Golang, Rust, etc.
- A mix of the above; some routes can be static, and some routes can use backend functions to fetch dynamic information. This can be configured with [page options](/docs/page-options) that includes the option to opt out of SSR.

In order to support SSR, a JS backend — such as Node.js or Deno-based server, serverless function, or edge function — is required.

It is also possible to write custom adapters or leverage community adapters to deploy SvelteKit to more platforms such as specialized server environments, browser extensions, or native applications. See [integrations](./integrations) for more examples and integrations.

## How do I use HMR with SvelteKit?

SvelteKit has HMR enabled by default powered by [svelte-hmr](https://github.com/sveltejs/svelte-hmr). If you saw [Rich's presentation at the 2020 Svelte Summit](https://svelte.dev/blog/whats-the-deal-with-sveltekit), you may have seen a more powerful-looking version of HMR presented. This demo had `svelte-hmr`'s `preserveLocalState` flag on. This flag is now off by default because it may lead to unexpected behaviour and edge cases. But don't worry, you are still getting HMR with SvelteKit! If you'd like to preserve local state you can use the `@hmr:keep` or `@hmr:keep-all` directives as documented on the [svelte-hmr](https://github.com/sveltejs/svelte-hmr) page.

## How do I include details from package.json in my application?

You cannot directly require JSON files, since SvelteKit expects [`svelte.config.js`](./configuration) to be an ES module. If you'd like to include your application's version number or other information from `package.json` in your application, you can load JSON like so:

```js
/// file: svelte.config.js
// @filename: index.js
/// <reference types="@types/node" />
import { URL } from 'node:url';
// ---cut---
import { readFileSync } from 'node:fs';
import { fileURLToPath } from 'node:url';

const path = fileURLToPath(new URL('package.json', import.meta.url));
const pkg = JSON.parse(readFileSync(path, 'utf8'));
```

## How do I fix the error I'm getting trying to include a package?

Most issues related to including a library are due to incorrect packaging. You can check if a library's packaging is compatible with Node.js by entering it into [the publint website](https://publint.dev/).

Here are a few things to keep in mind when checking if a library is packaged correctly:

- `exports` takes precedence over the other entry point fields such as `main` and `module`. Adding an `exports` field may not be backwards-compatible as it prevents deep imports.
- ESM files should end with `.mjs` unless `"type": "module"` is set in which any case CommonJS files should end with `.cjs`.
- `main` should be defined if `exports` is not. It should be either a CommonJS or ESM file and adhere to the previous bullet. If a `module` field is defined, it should refer to an ESM file.
- Svelte components should be distributed as uncompiled `.svelte` files with any JS in the package written as ESM only. Custom script and style languages, like TypeScript and SCSS, should be preprocessed as vanilla JS and CSS respectively. We recommend using [`svelte-package`](./packaging) for packaging Svelte libraries, which will do this for you.

Libraries work best in the browser with Vite when they distribute an ESM version, especially if they are dependencies of a Svelte component library. You may wish to suggest to library authors that they provide an ESM version. However, CommonJS (CJS) dependencies should work as well since, by default, [`vite-plugin-svelte` will ask Vite to pre-bundle them](https://github.com/sveltejs/vite-plugin-svelte/blob/main/docs/faq.md#what-is-going-on-with-vite-and-pre-bundling-dependencies) using `esbuild` to convert them to ESM.

If you are still encountering issues we recommend searching both [the Vite issue tracker](https://github.com/vitejs/vite/issues) and the issue tracker of the library in question. Sometimes issues can be worked around by fiddling with the [`optimizeDeps`](https://vitejs.dev/config/#dep-optimization-options) or [`ssr`](https://vitejs.dev/config/#ssr-options) config values though we recommend this as only a short-term workaround in favor of fixing the library in question.

## How do I use the view transitions API with SvelteKit?

While SvelteKit does not have any specific integration with [view transitions](https://developer.chrome.com/docs/web-platform/view-transitions/), you can call `document.startViewTransition` in [`onNavigate`](/docs/modules#$app-navigation-onnavigate) to trigger a view transition on every client-side navigation.

```js
// @errors: 2339 2810
import { onNavigate } from '$app/navigation';

onNavigate((navigation) => {
	if (!document.startViewTransition) return;

	return new Promise((resolve) => {
		document.startViewTransition(async () => {
			resolve();
			await navigation.complete;
		});
	});
});
```

For more, see ["Unlocking view transitions"](https://svelte.dev/blog/view-transitions) on the Svelte blog.

## How do I use X with SvelteKit?

Make sure you've read the [documentation section on integrations](./integrations). If you're still having trouble, solutions to common issues are listed below.

### How do I setup a database?

Put the code to query your database in a [server route](./routing#server) - don't query the database in .svelte files. You can create a `db.js` or similar that sets up a connection immediately and makes the client accessible throughout the app as a singleton. You can execute any one-time setup code in `hooks.server.js` and import your database helpers into any endpoint that needs them.

### How do I use a client-side only library that depends on `document` or `window`?

If you need access to the `document` or `window` variables or otherwise need code to run only on the client-side you can wrap it in a `browser` check:

```js
/// <reference types="@sveltejs/kit" />
// ---cut---
import { browser } from '$app/environment';

if (browser) {
	// client-only code here
}
```

You can also run code in `onMount` if you'd like to run it after the component has been first rendered to the DOM:

```js
// @filename: ambient.d.ts
// @lib: ES2015
declare module 'some-browser-only-library';

// @filename: index.js
// ---cut---
import { onMount } from 'svelte';

onMount(async () => {
	const { method } = await import('some-browser-only-library');
	method('hello world');
});
```

If the library you'd like to use is side-effect free you can also statically import it and it will be tree-shaken out in the server-side build where `onMount` will be automatically replaced with a no-op:

```js
// @filename: ambient.d.ts
// @lib: ES2015
declare module 'some-browser-only-library';

// @filename: index.js
// ---cut---
import { onMount } from 'svelte';
import { method } from 'some-browser-only-library';

onMount(() => {
	method('hello world');
});
```

Finally, you may also consider using an `{#await}` block:
```svelte
<!--- file: index.svelte --->
<script>
	import { browser } from '$app/environment';

	const ComponentConstructor = browser ?
		import('some-browser-only-library').then((module) => module.Component) :
		new Promise(() => {});
</script>

{#await ComponentConstructor}
	<p>Loading...</p>
{:then component}
	<svelte:component this={component} />
{:catch error}
	<p>Something went wrong: {error.message}</p>
{/await}
```

### How do I use a different backend API server?

You can use [`event.fetch`](./load#making-fetch-requests) to request data from an external API server, but be aware that you would need to deal with [CORS](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS), which will result in complications such as generally requiring requests to be preflighted resulting in higher latency. Requests to a separate subdomain may also increase latency due to an additional DNS lookup, TLS setup, etc. If you wish to use this method, you may find [`handleFetch`](./hooks#server-hooks-handlefetch) helpful.

Another approach is to set up a proxy to bypass CORS headaches. In production, you would rewrite a path like `/api` to the API server; for local development, use Vite's [`server.proxy`](https://vitejs.dev/config/server-options.html#server-proxy) option.

How to setup rewrites in production will depend on your deployment platform. If rewrites aren't an option, you could alternatively add an [API route](./routing#server):

```js
/// file: src/routes/api/[...path]/+server.js
/** @type {import('./$types').RequestHandler} */
export function GET({ params, url }) {
	return fetch(`https://my-api-server.com/${params.path + url.search}`);
}
```

(Note that you may also need to proxy `POST`/`PATCH` etc requests, and forward `request.headers`, depending on your needs.)

### How do I use middleware?

`adapter-node` builds a middleware that you can use with your own server for production mode. In dev, you can add middleware to Vite by using a Vite plugin. For example:

```js
// @errors: 2322
// @filename: ambient.d.ts
declare module '@sveltejs/kit/vite'; // TODO this feels unnecessary, why can't it 'see' the declarations?

// @filename: index.js
// ---cut---
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').Plugin} */
const myPlugin = {
	name: 'log-request-middleware',
	configureServer(server) {
		server.middlewares.use((req, res, next) => {
			console.log(`Got request ${req.url}`);
			next();
		});
	}
};

/** @type {import('vite').UserConfig} */
const config = {
	plugins: [myPlugin, sveltekit()]
};

export default config;
```

See [Vite's `configureServer` docs](https://vitejs.dev/guide/api-plugin.html#configureserver) for more details including how to control ordering.

### Does it work with Yarn 2?

Sort of. The Plug'n'Play feature, aka 'pnp', is broken (it deviates from the Node module resolution algorithm, and [doesn't yet work with native JavaScript modules](https://github.com/yarnpkg/berry/issues/638) which SvelteKit — along with an [increasing number of packages](https://blog.sindresorhus.com/get-ready-for-esm-aa53530b3f77) — uses). You can use `nodeLinker: 'node-modules'` in your [`.yarnrc.yml`](https://yarnpkg.com/configuration/yarnrc#nodeLinker) file to disable pnp, but it's probably easier to just use npm or [pnpm](https://pnpm.io/), which is similarly fast and efficient but without the compatibility headaches.

### How do I use with Yarn 3?

Currently ESM Support within the latest Yarn (version 3) is considered [experimental](https://github.com/yarnpkg/berry/pull/2161).

The below seems to work although your results may vary.

First create a new application:

```sh
yarn create svelte myapp
cd myapp
```

And enable Yarn Berry:

```sh
yarn set version berry
yarn install
```

#### Yarn 3 global cache

One of the more interesting features of Yarn Berry is the ability to have a single global cache for packages, instead of having multiple copies for each project on the disk. However, setting `enableGlobalCache` to true causes building to fail, so it is recommended to add the following to the `.yarnrc.yml` file:

```yaml
nodeLinker: node-modules
```

This will cause packages to be downloaded into a local node_modules directory but avoids the above problem and is your best bet for using version 3 of Yarn at this point in time.

####### documentation/docs/60-appendix/20-integrations.md #######

---
title: Integrations
---

## Preprocessors

Preprocessors transform your `.svelte` files before passing them to the compiler. For example, if your `.svelte` file uses TypeScript and PostCSS, it must first be transformed into JavaScript and CSS so that the Svelte compiler can handle it. There are many [available preprocessors](https://sveltesociety.dev/packages?category=preprocessors). The Svelte team maintains two official ones discussed below.

### `vitePreprocess`

`vite-plugin-svelte` offers a [`vitePreprocess`](https://github.com/sveltejs/vite-plugin-svelte/blob/main/docs/preprocess.md) feature which utilizes Vite for preprocessing. It is capable of handling the language flavors Vite handles: TypeScript, PostCSS, SCSS, Less, Stylus, and SugarSS. If you set your project up with TypeScript it will be included by default:

```js
// svelte.config.js
import { vitePreprocess } from '@sveltejs/vite-plugin-svelte';

export default {
  preprocess: [vitePreprocess()]
};
```

### `svelte-preprocess`

`svelte-preprocess` has some additional functionality not found in `vitePreprocess` such as support for Pug, Babel, and global styles. However, `vitePreprocess` may be faster and require less configuration, so it is used by default. Note that CoffeeScript is [not supported](https://github.com/sveltejs/kit/issues/2920#issuecomment-996469815) by SvelteKit.

You will need to install `svelte-preprocess` with `npm install --save-dev svelte-preprocess` and [add it to your `svelte.config.js`](https://github.com/sveltejs/svelte-preprocess/blob/main/docs/usage.md#with-svelte-config). After that, you will often need to [install the corresponding library](https://github.com/sveltejs/svelte-preprocess/blob/main/docs/getting-started.md) such as `npm install -D sass` or `npm install -D less`.

## Adders

[Svelte Adders](https://sveltesociety.dev/templates?category=svelte-add) allow you to setup many different complex integrations like Tailwind, PostCSS, Storybook, Firebase, GraphQL, mdsvex, and more with a single command. Please see [sveltesociety.dev](https://sveltesociety.dev/) for a full listing of templates, components, and tools available for use with Svelte and SvelteKit.

## Vite plugins

Since SvelteKit projects are built with Vite, you can use Vite plugins to enhance your project. See a list of available plugins at [`vitejs/awesome-vite`](https://github.com/vitejs/awesome-vite).

## Integration FAQs

The SvelteKit FAQ has a [how to do X with SvelteKit](./faq#how-do-i-use-x-with-sveltekit), which may be helpful if you still have questions.

####### documentation/docs/60-appendix/30-migrating-to-sveltekit-2.md #######

---
title: Migrating to SvelteKit v2
---

Upgrading from SvelteKit version 1 to version 2 should be mostly seamless. There are a few breaking changes to note, which are listed here. You can use `npx svelte-migrate@latest sveltekit-2` to migrate some of these changes automatically.

We highly recommend upgrading to the most recent 1.x version before upgrading to 2.0, so that you can take advantage of targeted deprecation warnings. We also recommend [updating to Svelte 4](https://svelte.dev/docs/v4-migration-guide) first: Later versions of SvelteKit 1.x support it, and SvelteKit 2.0 requires it.

## `redirect` and `error` are no longer thrown by you

Previously, you had to `throw` the values returned from `error(...)` and `redirect(...)` yourself. In SvelteKit 2 this is no longer the case — calling the functions is sufficient.

```diff
import { error } from '@sveltejs/kit'

...
- throw error(500, 'something went wrong');
+ error(500, 'something went wrong');
```

`svelte-migrate` will do these changes automatically for you.

If the error or redirect is thrown inside a `try {...}` block (hint: don't do this!), you can distinguish them from unexpected errors using [`isHttpError`](/docs/modules#sveltejs-kit-ishttperror) and [`isRedirect`](/docs/modules#sveltejs-kit-isredirect) imported from `@sveltejs/kit`.

## path is required when setting cookies

When receiving a `Set-Cookie` header that doesn't specify a `path`, browsers will [set the cookie path](https://www.rfc-editor.org/rfc/rfc6265#section-5.1.4) to the parent of the resource in question. This behaviour isn't particularly helpful or intuitive, and frequently results in bugs because the developer expected the cookie to apply to the domain as a whole.

As of SvelteKit 2.0, you need to set a `path` when calling `cookies.set(...)`, `cookies.delete(...)` or `cookies.serialize(...)` so that there's no ambiguity. Most of the time, you probably want to use `path: '/'`, but you can set it to whatever you like, including relative paths — `''` means 'the current path', `'.'` means 'the current directory'.

```diff
export function load({ cookies }) {
-    cookies.set(name, value);
+    cookies.set(name, value, { path: '/' });
    return { response }
}
```

`svelte-migrate` will add comments highlighting the locations that need to be adjusted.

## Top-level promises are no longer awaited

In SvelteKit version 1, if the top-level properties of the object returned from a `load` function were promises, they were automatically awaited. With the introduction of [streaming](https://svelte.dev/blog/streaming-snapshots-sveltekit) this behavior became a bit awkward as it forces you to nest your streamed data one level deep.

As of version 2, SvelteKit no longer differentiates between top-level and non-top-level promises. To get back the blocking behavior, use `await` (with `Promise.all` to prevent waterfalls, where appropriate):

```diff
// If you have a single promise
export function load({ fetch }) {
-    const response = fetch(...).then(r => r.json());
+    const response = await fetch(...).then(r => r.json());
    return { response }
}
```

```diff
// If you have multiple promises
export function load({ fetch }) {
-    const a = fetch(...).then(r => r.json());
-    const b = fetch(...).then(r => r.json());
+    const [a, b] = await Promise.all([
+      fetch(...).then(r => r.json()),
+      fetch(...).then(r => r.json()),
+    ]);
    return { a, b };
}
```

## goto(...) changes

`goto(...)` no longer accepts external URLs. To navigate to an external URL, use `window.location.href = url`. The `state` object now determines `$page.state` and must adhere to the `App.PageState` interface, if declared. See [shallow routing](shallow-routing) for more details.

## paths are now relative by default

In SvelteKit 1, `%sveltekit.assets%` in your `app.html` was replaced with a relative path by default (i.e. `.` or `..` or `../..` etc, depending on the path being rendered) during server-side rendering unless the [`paths.relative`](/docs/configuration#paths) config option was explicitly set to `false`. The same was true for `base` and `assets` imported from `$app/paths`, but only if the `paths.relative` option was explicitly set to `true`.

This inconsistency is fixed in version 2. Paths are either always relative or always absolute, depending on the value of [`paths.relative`](/docs/configuration#paths). It defaults to `true` as this results in more portable apps: if the `base` is something other than the app expected (as is the case when viewed on the [Internet Archive](https://archive.org/), for example) or unknown at build time (as is the case when deploying to [IPFS](https://ipfs.tech/) and so on), fewer things are likely to break.

## Server fetches are not trackable anymore

Previously it was possible to track URLs from `fetch`es on the server in order to rerun load functions. This poses a possible security risk (private URLs leaking), and as such it was behind the `dangerZone.trackServerFetches` setting, which is now removed.

## `preloadCode` arguments must be prefixed with `base`

SvelteKit exposes two functions, [`preloadCode`](/docs/modules#$app-navigation-preloadcode) and [`preloadData`](/docs/modules#$app-navigation-preloaddata), for programmatically loading the code and data associated with a particular path. In version 1, there was a subtle inconsistency — the path passed to `preloadCode` did not need to be prefixed with the `base` path (if set), while the path passed to `preloadData` did.

This is fixed in SvelteKit 2 — in both cases, the path should be prefixed with `base` if it is set.

Additionally, `preloadCode` now takes a single argument rather than _n_ arguments.

## `resolvePath` has been removed

SvelteKit 1 included a function called `resolvePath` which allows you to resolve a route ID (like `/blog/[slug]`) and a set of parameters (like `{ slug: 'hello' }`) to a pathname. Unfortunately the return value didn't include the `base` path, limiting its usefulness in cases where `base` was set.

As such, SvelteKit 2 replaces `resolvePath` with a (slightly better named) function called `resolveRoute`, which is imported from `$app/paths` and which takes `base` into account.

```diff
-import { resolvePath } from '@sveltejs/kit';
-import { base } from '$app/paths';
+import { resolveRoute } from '$app/paths';

-const path = base + resolvePath('/blog/[slug]', { slug });
+const path = resolveRoute('/blog/[slug]', { slug });
```

`svelte-migrate` will do the method replacement for you, though if you later prepend the result with `base`, you need to remove that yourself.

## Improved error handling

Errors are handled inconsistently in SvelteKit 1. Some errors trigger the `handleError` hook but there is no good way to discern their status (for example, the only way to tell a 404 from a 500 is by seeing if `event.route.id` is `null`), while others (such as 405 errors for `POST` requests to pages without actions) don't trigger `handleError` at all, but should. In the latter case, the resulting `$page.error` will deviate from the [`App.Error`](/docs/types#app-error) type, if it is specified.

SvelteKit 2 cleans this up by calling `handleError` hooks with two new properties: `status` and `message`. For errors thrown from your code (or library code called by your code) the status will be `500` and the message will be `Internal Error`. While `error.message` may contain sensitive information that should not be exposed to users, `message` is safe.

## Dynamic environment variables cannot be used during prerendering

The `$env/dynamic/public` and `$env/dynamic/private` modules provide access to _run time_ environment variables, as opposed to the _build time_ environment variables exposed by `$env/static/public` and `$env/static/private`.

During prerendering in SvelteKit 1, they are one and the same. As such, prerendered pages that make use of 'dynamic' environment variables are really 'baking in' build time values, which is incorrect. Worse, `$env/dynamic/public` is populated in the browser with these stale values if the user happens to land on a prerendered page before navigating to dynamically-rendered pages.

Because of this, dynamic environment variables can no longer be read during prerendering in SvelteKit 2 — you should use the `static` modules instead. If the user lands on a prerendered page, SvelteKit will request up-to-date values for `$env/dynamic/public` from the server (by default from a module called `_env.js` — this can be configured with `config.kit.env.publicModule`) instead of reading them from the server-rendered HTML.

## `form` and `data` have been removed from `use:enhance` callbacks

If you provide a callback to [`use:enhance`](/docs/form-actions#progressive-enhancement-use-enhance), it will be called with an object containing various useful properties.

In SvelteKit 1, those properties included `form` and `data`. These were deprecated some time ago in favour of `formElement` and `formData`, and have been removed altogether in SvelteKit 2.

## Forms containing file inputs must use `multipart/form-data`

If a form contains an `<input type="file">` but does not have an `enctype="multipart/form-data"` attribute, non-JS submissions will omit the file. SvelteKit 2 will throw an error if it encounters a form like this during a `use:enhance` submission to ensure that your forms work correctly when JavaScript is not present.

## Generated `tsconfig.json` is more strict

Previously, the generated `tsconfig.json` was trying its best to still produce a somewhat valid config when your `tsconfig.json` included `paths` or `baseUrl`. In SvelteKit 2, the validation is more strict and will warn when you use either `paths` or `baseUrl` in your `tsconfig.json`. These settings are used to generate path aliases and you should use [the `alias` config](configuration#alias) option in your `svelte.config.js` instead, to also create a corresponding alias for the bundler.

## `getRequest` no longer throws errors

The `@sveltejs/kit/node` module exports helper functions for use in Node environments, including `getRequest` which turns a Node [`ClientRequest`](https://nodejs.org/api/http.html#class-httpclientrequest) into a standard [`Request`](https://developer.mozilla.org/en-US/docs/Web/API/Request) object.

In SvelteKit 1, `getRequest` could throw if the `Content-Length` header exceeded the specified size limit. In SvelteKit 2, the error will not be thrown until later, when the request body (if any) is being read. This enables better diagnostics and simpler code.

## `vitePreprocess` is no longer exported from `@sveltejs/kit/vite`

Since `@sveltejs/vite-plugin-svelte` is now a peer dependency, SvelteKit 2 no longer re-exports `vitePreprocess`. You should import it directly from `@sveltejs/vite-plugin-svelte`.

## Updated dependency requirements

SvelteKit 2 requires Node `18.13` or higher, and the following minimum dependency versions:

- `svelte@4`
- `vite@5`
- `typescript@5`
- `@sveltejs/vite-plugin-svelte@3` (this is now required as a `peerDependency` of SvelteKit — previously it was directly depended upon)
- `@sveltejs/adapter-cloudflare@3` (if you're using these adapters)
- `@sveltejs/adapter-cloudflare-workers@2`
- `@sveltejs/adapter-netlify@3`
- `@sveltejs/adapter-node@2`
- `@sveltejs/adapter-static@3`
- `@sveltejs/adapter-vercel@4`

`svelte-migrate` will update your `package.json` for you.

As part of the TypeScript upgrade, the generated `tsconfig.json` (the one your `tsconfig.json` extends from) now uses `"moduleResolution": "bundler"` (which is recommended by the TypeScript team, as it properly resolves types from packages with an `exports` map in package.json) and `verbatimModuleSyntax` (which replaces the existing `importsNotUsedAsValues ` and `preserveValueImports` flags — if you have those in your `tsconfig.json`, remove them. `svelte-migrate` will do this for you).

####### documentation/docs/60-appendix/40-migrating.md #######

---
title: Migrating from Sapper
rank: 1
---

SvelteKit is the successor to Sapper and shares many elements of its design.

If you have an existing Sapper app that you plan to migrate to SvelteKit, there are a number of changes you will need to make. You may find it helpful to view [some examples](additional-resources#examples) while migrating.

## package.json

### type: "module"

Add `"type": "module"` to your `package.json`. You can do this step separately from the rest as part of an incremental migration if you are using Sapper 0.29.3
or newer.

### dependencies

Remove `polka` or `express`, if you're using one of those, and any middleware such as `sirv` or `compression`.

### devDependencies

Remove `sapper` from your `devDependencies` and replace it with `@sveltejs/kit` and whichever [adapter](adapters) you plan to use (see [next section](migrating#project-files-configuration)).

### scripts

Any scripts that reference `sapper` should be updated:

- `sapper build` should become `vite build` using the Node [adapter](adapters)
- `sapper export` should become `vite build` using the static [adapter](adapters)
- `sapper dev` should become `vite dev`
- `node __sapper__/build` should become `node build`

## Project files

The bulk of your app, in `src/routes`, can be left where it is, but several project files will need to be moved or updated.

### Configuration

Your `webpack.config.js` or `rollup.config.js` should be replaced with a `svelte.config.js`, as documented [here](configuration). Svelte preprocessor options should be moved to `config.preprocess`.

You will need to add an [adapter](adapters). `sapper build` is roughly equivalent to [adapter-node](https://github.com/sveltejs/kit/tree/main/packages/adapter-node) while `sapper export` is roughly equivalent to [adapter-static](https://github.com/sveltejs/kit/tree/main/packages/adapter-static), though you might prefer to use an adapter designed for the platform you're deploying to.

If you were using plugins for filetypes that are not automatically handled by [Vite](https://vitejs.dev), you will need to find Vite equivalents and add them to the [Vite config](project-structure#project-files-vite-config-js).

### src/client.js

This file has no equivalent in SvelteKit. Any custom logic (beyond `sapper.start(...)`) should be expressed in your `+layout.svelte` file, inside an `onMount` callback.

### src/server.js

When using `adapter-node` the equivalent is a [custom server](adapter-node#custom-server). Otherwise, this file has no direct equivalent, since SvelteKit apps can run in serverless environments.

### src/service-worker.js

Most imports from `@sapper/service-worker` have equivalents in [`$service-worker`](modules#$service-worker):

- `files` is unchanged
- `routes` has been removed
- `shell` is now `build`
- `timestamp` is now `version`

### src/template.html

The `src/template.html` file should be renamed `src/app.html`.

Remove `%sapper.base%`, `%sapper.scripts%` and `%sapper.styles%`. Replace `%sapper.head%` with `%sveltekit.head%` and `%sapper.html%` with `%sveltekit.body%`. The `<div id="sapper">` is no longer necessary.

### src/node_modules

A common pattern in Sapper apps is to put your internal library in a directory inside `src/node_modules`. This doesn't work with Vite, so we use [`src/lib`](modules#$lib) instead.

## Pages and layouts

### Renamed files

Routes now are made up of the folder name exclusively to remove ambiguity, the folder names leading up to a `+page.svelte` correspond to the route. See [the routing docs](routing) for an overview. The following shows a old/new comparison:

| Old                       | New                       |
| ------------------------- | ------------------------- |
| routes/about/index.svelte | routes/about/+page.svelte |
| routes/about.svelte       | routes/about/+page.svelte |

Your custom error page component should be renamed from `_error.svelte` to `+error.svelte`. Any `_layout.svelte` files should likewise be renamed `+layout.svelte`. [Any other files are ignored](routing#other-files).

### Imports

The `goto`, `prefetch` and `prefetchRoutes` imports from `@sapper/app` should be replaced with `goto`, `preloadData` and `preloadCode` imports respectively from [`$app/navigation`](modules#$app-navigation).

The `stores` import from `@sapper/app` should be replaced — see the [Stores](migrating#pages-and-layouts-stores) section below.

Any files you previously imported from directories in `src/node_modules` will need to be replaced with [`$lib`](modules#$lib) imports.

### Preload

As before, pages and layouts can export a function that allows data to be loaded before rendering takes place.

This function has been renamed from `preload` to [`load`](load), it now lives in a `+page.js` (or `+layout.js`) next to its `+page.svelte` (or `+layout.svelte`), and its API has changed. Instead of two arguments — `page` and `session` — there is a single `event` argument.

There is no more `this` object, and consequently no `this.fetch`, `this.error` or `this.redirect`. Instead, you can get [`fetch`](load#making-fetch-requests) from the input methods, and both [`error`](load#errors) and [`redirect`](load#redirects) are now thrown.

### Stores

In Sapper, you would get references to provided stores like so:

```js
// @filename: ambient.d.ts
declare module '@sapper/app';

// @filename: index.js
// ---cut---
import { stores } from '@sapper/app';
const { preloading, page, session } = stores();
```

The `page` store still exists; `preloading` has been replaced with a `navigating` store that contains `from` and `to` properties. `page` now has `url` and `params` properties, but no `path` or `query`.

You access them differently in SvelteKit. `stores` is now `getStores`, but in most cases it is unnecessary since you can import `navigating`, and `page` directly from [`$app/stores`](modules#$app-stores).

### Routing

Regex routes are no longer supported. Instead, use [advanced route matching](advanced-routing#matching).

### Segments

Previously, layout components received a `segment` prop indicating the child segment. This has been removed; you should use the more flexible `$page.url.pathname` value to derive the segment you're interested in.

### URLs

In Sapper, all relative URLs were resolved against the base URL — usually `/`, unless the `basepath` option was used — rather than against the current page.

This caused problems and is no longer the case in SvelteKit. Instead, relative URLs are resolved against the current page (or the destination page, for `fetch` URLs in `load` functions) instead. In most cases, it's easier to use root-relative (i.e. starts with `/`) URLs, since their meaning is not context-dependent.

### &lt;a&gt; attributes

- `sapper:prefetch` is now `data-sveltekit-preload-data`
- `sapper:noscroll` is now `data-sveltekit-noscroll`

## Endpoints

In Sapper, [server routes](routing#server) received the `req` and `res` objects exposed by Node's `http` module (or the augmented versions provided by frameworks like Polka and Express).

SvelteKit is designed to be agnostic as to where the app is running — it could be running on a Node server, but could equally be running on a serverless platform or in a Cloudflare Worker. For that reason, you no longer interact directly with `req` and `res`. Your endpoints will need to be updated to match the new signature.

To support this environment-agnostic behavior, `fetch` is now available in the global context, so you don't need to import `node-fetch`, `cross-fetch`, or similar server-side fetch implementations in order to use it.

## Integrations

See [integrations](./integrations) for detailed information about integrations.

### HTML minifier

Sapper includes `html-minifier` by default. SvelteKit does not include this, but you can add it as a prod dependency and then use it through a [hook](hooks#server-hooks-handle):

```js
// @filename: ambient.d.ts
/// <reference types="@sveltejs/kit" />
declare module 'html-minifier';

// @filename: index.js
// ---cut---
import { minify } from 'html-minifier';
import { building } from '$app/environment';

const minification_options = {
	collapseBooleanAttributes: true,
	collapseWhitespace: true,
	conservativeCollapse: true,
	decodeEntities: true,
	html5: true,
	ignoreCustomComments: [/^#/],
	minifyCSS: true,
	minifyJS: false,
	removeAttributeQuotes: true,
	removeComments: false, // some hydration code needs comments, so leave them in
	removeOptionalTags: true,
	removeRedundantAttributes: true,
	removeScriptTypeAttributes: true,
	removeStyleLinkTypeAttributes: true,
	sortAttributes: true,
	sortClassName: true
};

/** @type {import('@sveltejs/kit').Handle} */
export async function handle({ event, resolve }) {
	let page = '';

	return resolve(event, {
		transformPageChunk: ({ html, done }) => {
			page += html;
			if (done) {
				return building ? minify(page, minification_options) : page;
			}
		}
	});
}
```

Note that `prerendering` is `false` when using `vite preview` to test the production build of the site, so to verify the results of minifying, you'll need to inspect the built HTML files directly.

####### documentation/docs/60-appendix/50-additional-resources.md #######

---
title: Additional resources
---

## FAQs

Please see the [SvelteKit FAQ](../faq) for solutions to common issues and helpful tips and tricks.

The [Svelte FAQ](https://svelte.dev/faq) and [`vite-plugin-svelte` FAQ](https://github.com/sveltejs/vite-plugin-svelte/blob/main/docs/faq.md) may also be helpful for questions deriving from those libraries.

## Examples

We've written and published a few different SvelteKit sites as examples:

- [`sveltejs/realworld`](https://github.com/sveltejs/realworld) contains an example blog site
- [A HackerNews clone](https://github.com/sveltejs/sites/tree/master/sites/hn.svelte.dev)
- [`kit.svelte.dev`](https://github.com/sveltejs/kit/tree/main/sites/kit.svelte.dev)
- [`svelte.dev`](https://github.com/sveltejs/svelte/tree/main/sites/svelte.dev)

SvelteKit users have also published plenty of examples on GitHub, under the [#sveltekit](https://github.com/topics/sveltekit) and [#sveltekit-template](https://github.com/topics/sveltekit-template) topics, as well as on [the Svelte Society site](https://sveltesociety.dev/templates?category=sveltekit). Note that these have not been vetted by the maintainers and may not be up to date.

## Support

You can ask for help on [Discord](https://svelte.dev/chat) and [StackOverflow](https://stackoverflow.com/questions/tagged/sveltekit). Please first search for information related to your issue in the FAQ, Google or another search engine, issue tracker, and Discord chat history in order to be respectful of others' time. There are many more people asking questions than answering them, so this will help in allowing the community to grow in a scalable fashion.

####### documentation/docs/60-appendix/60-glossary.md #######

---
title: Glossary
---

The core of SvelteKit provides a highly configurable rendering engine. This section describes some of the terms used when discussing rendering. A reference for setting these options is provided in the documentation above.

## CSR

Client-side rendering (CSR) is the generation of the page contents in the web browser using JavaScript.

In SvelteKit, client-side rendering will be used by default, but you can turn off JavaScript with [the `csr = false` page option](page-options#csr).

## Hydration

Svelte components store some state and update the DOM when the state is updated. When fetching data during SSR, by default SvelteKit will store this data and transmit it to the client along with the server-rendered HTML. The components can then be initialized on the client with that data without having to call the same API endpoints again. Svelte will then check that the DOM is in the expected state and attach event listeners in a process called hydration. Once the components are fully hydrated, they can react to changes to their properties just like any newly created Svelte component.

In SvelteKit, pages will be hydrated by default, but you can turn off JavaScript with [the `csr = false` page option](page-options#csr).

## Prerendering

Prerendering means computing the contents of a page at build time and saving the HTML for display. This approach has the same benefits as traditional server-rendered pages, but avoids recomputing the page for each visitor and so scales nearly for free as the number of visitors increases. The tradeoff is that the build process is more expensive and prerendered content can only be updated by building and deploying a new version of the application.

Not all pages can be prerendered. The basic rule is this: for content to be prerenderable, any two users hitting it directly must get the same content from the server, and the page must not contain [actions](form-actions). Note that you can still prerender content that is loaded based on the page's parameters as long as all users will be seeing the same prerendered content.

Pre-rendered pages are not limited to static content. You can build personalized pages if user-specific data is fetched and rendered client-side. This is subject to the caveat that you will experience the downsides of not doing SSR for that content as discussed above.

In SvelteKit, you can control prerendering with [the `prerender` page option](page-options#prerender) and [`prerender` config](configuration#prerender) in `svelte.config.js`.

## Routing

By default, when you navigate to a new page (by clicking on a link or using the browser's forward or back buttons), SvelteKit will intercept the attempted navigation and handle it instead of allowing the browser to send a request to the server for the destination page. SvelteKit will then update the displayed contents on the client by rendering the component for the new page, which in turn can make calls to the necessary API endpoints. This process of updating the page on the client in response to attempted navigation is called client-side routing.

In SvelteKit, client-side routing will be used by default, but you can skip it with [`data-sveltekit-reload`](link-options#data-sveltekit-reload).

## SPA

A single-page app (SPA) is an application in which all requests to the server load a single HTML file which then does client-side rendering of the requested contents based on the requested URL. All navigation is handled on the client-side in a process called client-side routing with per-page contents being updated and common layout elements remaining largely unchanged. SPAs do not provide SSR, which has the shortcoming described above. However, some applications are not greatly impacted by these shortcomings such as a complex business application behind a login where SEO would not be important and it is known that users will be accessing the application from a consistent computing environment.

In SvelteKit, you can [build an SPA with `adapter-static`](single-page-apps).

## SSG

Static Site Generation (SSG) is a term that refers to a site where every page is prerendered. SvelteKit was not built to do only static site generation like some tools and so may not scale as well to efficiently render a very large number of pages as tools built specifically for that purpose. However, in contrast to most purpose-built SSGs, SvelteKit does nicely allow for mixing and matching different rendering types on different pages. One benefit of fully prerendering a site is that you do not need to maintain or pay for servers to perform SSR. Once generated, the site can be served from CDNs, leading to great "time to first byte" performance. This delivery model is often referred to as JAMstack.

In SvelteKit, you can do static site generation by using [`adapter-static`](adapter-static) or by configuring every page to be prerendered using [the `prerender` page option](page-options#prerender) or [`prerender` config](configuration#prerender) in `svelte.config.js`.

## SSR

Server-side rendering (SSR) is the generation of the page contents on the server. SSR is generally preferred for SEO. While some search engines can index content that is dynamically generated on the client-side it may take longer even in these cases. It also tends to improve perceived performance and makes your app accessible to users if JavaScript fails or is disabled (which happens [more often than you probably think](https://kryogenix.org/code/browser/everyonehasjs.html)).

In SvelteKit, pages are server-side rendered by default. You can disable SSR with [the `ssr` page option](https://kit.svelte.dev/docs/page-options#ssr).

####### documentation/docs/60-appendix/meta.json #######

```

{
	"title": "Appendix"
}

```


####### FUNDING.json #######

```

{
	"drips": {
		"ethereum": {
			"ownedBy": "0xCE08E02c37d90d75C2bf7D9e55f7606C8DB80E70"
		}
	}
}

```


####### LICENSE #######

```

Copyright (c) 2020 [these people](https://github.com/sveltejs/kit/graphs/contributors)

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
```


####### package.json #######

```

{
	"name": "kit-monorepo",
	"version": "0.0.1",
	"description": "monorepo for @sveltejs/kit and friends",
	"private": true,
	"type": "module",
	"scripts": {
		"test:kit": "pnpm run --dir packages/kit test",
		"test:cross-platform:dev": "pnpm run --dir packages/kit test:cross-platform:dev",
		"test:cross-platform:build": "pnpm run --dir packages/kit test:cross-platform:build",
		"test:vite-ecosystem-ci": "pnpm test --dir packages/kit",
		"test:others": "pnpm test -r --filter=./packages/* --filter=!./packages/kit/ --workspace-concurrency=1",
		"check": "pnpm -r prepublishOnly && pnpm -r check",
		"lint": "pnpm -r lint && eslint --cache --cache-location node_modules/.eslintcache 'packages/**/*.js'",
		"format": "pnpm -r format",
		"precommit": "pnpm format && pnpm lint",
		"changeset:version": "changeset version && pnpm -r generate:version && git add --all",
		"changeset:release": "changeset publish",
		"start": "cd sites/kit.svelte.dev && npm run dev",
		"build": "pnpm --filter @sveltejs/* -r build",
		"sync-all": "node scripts/sync-all.js"
	},
	"devDependencies": {
		"@changesets/cli": "^2.27.1",
		"@sveltejs/eslint-config": "^6.0.4",
		"@svitejs/changesets-changelog-github-compact": "^1.1.0",
		"@typescript-eslint/eslint-plugin": "^7.0.0",
		"eslint": "^8.56.0",
		"eslint-config-prettier": "^9.1.0",
		"eslint-plugin-svelte": "^2.35.1",
		"eslint-plugin-unicorn": "^52.0.0",
		"playwright": "^1.41.0"
	},
	"packageManager": "pnpm@8.15.7",
	"engines": {
		"pnpm": "^8.0.0"
	}
}

```


####### packages/adapter-auto/adapters.js #######

```

// List of adapters to check for. `version` is used to pin the installed adapter version and should point
// to the latest version of the adapter that is compatible with adapter-auto's current peerDependency version of SvelteKit.
export const adapters = [
	{
		name: 'Vercel',
		test: () => !!process.env.VERCEL,
		module: '@sveltejs/adapter-vercel',
		version: '4'
	},
	{
		name: 'Cloudflare Pages',
		test: () => !!process.env.CF_PAGES,
		module: '@sveltejs/adapter-cloudflare',
		version: '3'
	},
	{
		name: 'Netlify',
		test: () => !!process.env.NETLIFY,
		module: '@sveltejs/adapter-netlify',
		version: '3'
	},
	{
		name: 'Azure Static Web Apps',
		test: () => process.env.GITHUB_ACTION_REPOSITORY === 'Azure/static-web-apps-deploy',
		module: 'svelte-adapter-azure-swa',
		version: '0.20'
	},
	{
		name: 'AWS via SST',
		test: () => !!process.env.SST,
		module: 'svelte-kit-sst',
		version: '2'
	},
	{
		name: 'Google Cloud Run',
		test: () => !!process.env.GCP_BUILDPACKS,
		module: '@sveltejs/adapter-node',
		version: '5'
	}
];

```


####### packages/adapter-auto/CHANGELOG.md #######

# @sveltejs/adapter-auto

## 3.2.0

### Minor Changes

- feat: add support for Google Cloud Run ([#12015](https://github.com/sveltejs/kit/pull/12015))

## 3.1.1

### Patch Changes

- fix: better error message when using `read` ([#11689](https://github.com/sveltejs/kit/pull/11689))

## 3.1.0

### Minor Changes

- feat: bump Azure adapter version ([#11496](https://github.com/sveltejs/kit/pull/11496))

## 3.0.1

### Patch Changes

- chore: update primary branch from master to main ([`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d))

- Updated dependencies [[`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d), [`16961e8cd3fa6a7f382153b1ff056bc2aae9b31b`](https://github.com/sveltejs/kit/commit/16961e8cd3fa6a7f382153b1ff056bc2aae9b31b), [`197e01f95652f511160f38b37b9da73a124ecd48`](https://github.com/sveltejs/kit/commit/197e01f95652f511160f38b37b9da73a124ecd48), [`102e4a5ae5b29624302163faf5a20c94a64a5b2c`](https://github.com/sveltejs/kit/commit/102e4a5ae5b29624302163faf5a20c94a64a5b2c), [`f8e3d8b9728c9f1ab63389342c31d7246b6f9db6`](https://github.com/sveltejs/kit/commit/f8e3d8b9728c9f1ab63389342c31d7246b6f9db6)]:
  - @sveltejs/kit@2.0.4

## 3.0.0

### Major Changes

- breaking: require SvelteKit 2 ([#11316](https://github.com/sveltejs/kit/pull/11316))

## 2.1.1

### Patch Changes

- chore(deps): update dependency `import-meta-resolve` to v4 ([#10970](https://github.com/sveltejs/kit/pull/10970))

- Updated dependencies [[`072430ec5`](https://github.com/sveltejs/kit/commit/072430ec5c64782cd25c750f40534fea9cab4b40)]:
  - @sveltejs/kit@1.27.3

## 2.1.0

### Minor Changes

- [feat] support AWS via SST ([#9874](https://github.com/sveltejs/kit/pull/9874))

## 2.0.1

### Patch Changes

- chore: update dependency `import-meta-resolve` to v3 ([#9758](https://github.com/sveltejs/kit/pull/9758))

- Updated dependencies [[`aae5992e4`](https://github.com/sveltejs/kit/commit/aae5992e4568d93b477befe02b4018a59a298262), [`415358258`](https://github.com/sveltejs/kit/commit/415358258797911a8406c3b1e569b7cdcae6b207)]:
  - @sveltejs/kit@1.15.8

## 2.0.0

### Major Changes

- breaking: bump `@sveltejs/kit` peer dependency ([#8740](https://github.com/sveltejs/kit/pull/8740))

### Patch Changes

- Updated dependencies [[`c7648f66`](https://github.com/sveltejs/kit/commit/c7648f6608a413e2654625cbd30f890d2148cf13), [`63613bf1`](https://github.com/sveltejs/kit/commit/63613bf194c18ce50e111585ad770fc93f9e43c7), [`d1f7655e`](https://github.com/sveltejs/kit/commit/d1f7655efdff70d91f94fe0cb0de50ed2511b5e5)]:
  - @sveltejs/kit@1.5.0

## 1.0.3

### Patch Changes

- fix: pin adapter versions ([#8874](https://github.com/sveltejs/kit/pull/8874))

- Updated dependencies [[`f8dd7754`](https://github.com/sveltejs/kit/commit/f8dd7754ea21b11063613aac7d0d6cd98fc28b8e), [`fafe7d5f`](https://github.com/sveltejs/kit/commit/fafe7d5f033b249d554879b5ab7bc641f0ace362), [`e56a13c6`](https://github.com/sveltejs/kit/commit/e56a13c68a7d885f83f519c43f3510f10fee4ca5), [`02bd767d`](https://github.com/sveltejs/kit/commit/02bd767d3277a840b480fe94444cd1c886ef519b), [`97d68b13`](https://github.com/sveltejs/kit/commit/97d68b1381c1e0d052a0978824e96b9f50d248a9), [`2ef9b7d1`](https://github.com/sveltejs/kit/commit/2ef9b7d124809ce6a9804abbeaa4647a99fac97c), [`64a279f7`](https://github.com/sveltejs/kit/commit/64a279f7f92dcd4855af83fcbb09ea5ba1521ee8)]:
  - @sveltejs/kit@1.4.0

## 1.0.2

### Patch Changes

- docs: move adapter docs to site ([#8531](https://github.com/sveltejs/kit/pull/8531))

## 1.0.1

### Patch Changes

- chore: remove superfluous main field from package.json ([#8519](https://github.com/sveltejs/kit/pull/8519))

- Updated dependencies [[`7e2d3405`](https://github.com/sveltejs/kit/commit/7e2d34056e99f371e22406d941b764df365a2649)]:
  - @sveltejs/kit@1.1.1

## 1.0.0

### Major Changes

First major release, see below for the history of changes that lead up to this.
Starting from now all releases follow semver and changes will be listed as Major/Minor/Patch

## 1.0.0-next.91

### Patch Changes

- chore: add peerDependencies, add more specific next version ([#8141](https://github.com/sveltejs/kit/pull/8141))

## 1.0.0-next.90

### Patch Changes

- Upgrade dependencies ([#7852](https://github.com/sveltejs/kit/pull/7852))

## 1.0.0-next.89

### Patch Changes

- defer adapter installation until actually needed ([#7739](https://github.com/sveltejs/kit/pull/7739))

## 1.0.0-next.88

### Patch Changes

- feat: install adapters on demand ([#7462](https://github.com/sveltejs/kit/pull/7462))

## 1.0.0-next.87

### Patch Changes

- Updated dependencies [[`7259ed67`](https://github.com/sveltejs/kit/commit/7259ed67c2bee882135bcf43577611bab6903f90)]:
  - @sveltejs/adapter-netlify@1.0.0-next.84
  - @sveltejs/adapter-vercel@1.0.0-next.81

## 1.0.0-next.86

### Patch Changes

- update dependencies ([#7355](https://github.com/sveltejs/kit/pull/7355))
- Updated dependencies [[`e141513d`](https://github.com/sveltejs/kit/commit/e141513dd395466cc2e1649c8c9bfe36c0633846)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.40
  - @sveltejs/adapter-netlify@1.0.0-next.83
  - @sveltejs/adapter-vercel@1.0.0-next.81

## 1.0.0-next.85

### Patch Changes

- Updated dependencies [[`97d45c0c`](https://github.com/sveltejs/kit/commit/97d45c0cca9c06e71f91a0777d4748f96d400b4d)]:
  - @sveltejs/adapter-netlify@1.0.0-next.82
  - @sveltejs/adapter-vercel@1.0.0-next.80

## 1.0.0-next.84

### Patch Changes

- Updated dependencies [[`8d83708a`](https://github.com/sveltejs/kit/commit/8d83708ab021e367dc0eaa3ed57daf30a56497d7)]:
  - @sveltejs/adapter-vercel@1.0.0-next.80
  - @sveltejs/adapter-netlify@1.0.0-next.81

## 1.0.0-next.83

### Patch Changes

- Updated dependencies [[`b4c26809`](https://github.com/sveltejs/kit/commit/b4c268091b246befb1cb028875781285c9ff4aa5)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.39
  - @sveltejs/adapter-netlify@1.0.0-next.81
  - @sveltejs/adapter-vercel@1.0.0-next.79

## 1.0.0-next.82

### Patch Changes

- Updated dependencies [[`b5a0991c`](https://github.com/sveltejs/kit/commit/b5a0991c1692ff87d04be0cdb0a562a20de113a1)]:
  - @sveltejs/adapter-netlify@1.0.0-next.80
  - @sveltejs/adapter-vercel@1.0.0-next.78

## 1.0.0-next.81

### Patch Changes

- Updated dependencies [[`2555e64b`](https://github.com/sveltejs/kit/commit/2555e64be5ca8433c623e7838dc9c570ad024aed)]:
  - @sveltejs/adapter-netlify@1.0.0-next.79
  - @sveltejs/adapter-vercel@1.0.0-next.77

## 1.0.0-next.80

### Patch Changes

- Updated dependencies [[`d0e63d44`](https://github.com/sveltejs/kit/commit/d0e63d445e19e2df7a5e7d35f42b2ba1ae5e5745)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.38

## 1.0.0-next.79

### Patch Changes

- Updated dependencies [[`ae8225d4`](https://github.com/sveltejs/kit/commit/ae8225d4e547c8bc07d82e516dd49315eddb56c3)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.37
  - @sveltejs/adapter-netlify@1.0.0-next.78
  - @sveltejs/adapter-vercel@1.0.0-next.77

## 1.0.0-next.78

### Patch Changes

- Updated dependencies [[`737160d8`](https://github.com/sveltejs/kit/commit/737160d88cd96323eeac317ed08b4f0d6d83c482)]:
  - @sveltejs/adapter-vercel@1.0.0-next.77
  - @sveltejs/adapter-netlify@1.0.0-next.78

## 1.0.0-next.77

### Patch Changes

- Updated dependencies [[`e40acb56`](https://github.com/sveltejs/kit/commit/e40acb561e32a2ee5bcb6d289ebd1284d7af247b)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.36

## 1.0.0-next.76

### Patch Changes

- Updated dependencies [[`ae2e4bf2`](https://github.com/sveltejs/kit/commit/ae2e4bf2c5fe0aeba4cba21d51362837f66d1949)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.35

## 1.0.0-next.75

### Patch Changes

- Updated dependencies [[`fc1834b7`](https://github.com/sveltejs/kit/commit/fc1834b79ac85066ccb0f995958276628f944147)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.34
  - @sveltejs/adapter-netlify@1.0.0-next.78
  - @sveltejs/adapter-vercel@1.0.0-next.76

## 1.0.0-next.74

### Patch Changes

- feat: support Azure SWA ([#6761](https://github.com/sveltejs/kit/pull/6761))
- Updated dependencies [[`2040baee`](https://github.com/sveltejs/kit/commit/2040baee98cf85fe542e1e38a9fb60ede3f95f1d)]:
  - @sveltejs/adapter-vercel@1.0.0-next.75
  - @sveltejs/adapter-netlify@1.0.0-next.77

## 1.0.0-next.73

### Patch Changes

- Updated dependencies [[`b32b3ac9`](https://github.com/sveltejs/kit/commit/b32b3ac9c05efebfab5651de9bf5cdd0d4d54c12), [`ee5777e3`](https://github.com/sveltejs/kit/commit/ee5777e33695d2ddf1742a5e1d0144674d48d2d3)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.33
  - @sveltejs/adapter-netlify@1.0.0-next.77
  - @sveltejs/adapter-vercel@1.0.0-next.74

## 1.0.0-next.72

### Patch Changes

- Updated dependencies [[`f1e762bf`](https://github.com/sveltejs/kit/commit/f1e762bff16acc56b0d1e10c9cadeada0d25017d)]:
  - @sveltejs/adapter-vercel@1.0.0-next.73
  - @sveltejs/adapter-netlify@1.0.0-next.76

## 1.0.0-next.71

### Patch Changes

- Updated dependencies [[`6b06da84`](https://github.com/sveltejs/kit/commit/6b06da84b2454f42cbf7e8bcb643169af74428db)]:
  - @sveltejs/adapter-netlify@1.0.0-next.76
  - @sveltejs/adapter-vercel@1.0.0-next.72

## 1.0.0-next.70

### Patch Changes

- Updated dependencies [[`4b48d1bd`](https://github.com/sveltejs/kit/commit/4b48d1bd5005dc8e059b17fa42f0d08674aad30c)]:
  - @sveltejs/adapter-vercel@1.0.0-next.72
  - @sveltejs/adapter-netlify@1.0.0-next.75

## 1.0.0-next.69

### Patch Changes

- Updated dependencies [[`c530d337`](https://github.com/sveltejs/kit/commit/c530d33793a228fac684c71ed7926e6217101a90)]:
  - @sveltejs/adapter-netlify@1.0.0-next.75
  - @sveltejs/adapter-vercel@1.0.0-next.71

## 1.0.0-next.68

### Patch Changes

- Updated dependencies [[`331e0a80`](https://github.com/sveltejs/kit/commit/331e0a80b5e63f75c8226ddc93d0b0beefd40de3)]:
  - @sveltejs/adapter-vercel@1.0.0-next.70
  - @sveltejs/adapter-netlify@1.0.0-next.74

## 1.0.0-next.67

### Patch Changes

- Updated dependencies [[`ddd3b630`](https://github.com/sveltejs/kit/commit/ddd3b630090cd098a1038a56765e570339697830)]:
  - @sveltejs/adapter-vercel@1.0.0-next.69
  - @sveltejs/adapter-netlify@1.0.0-next.73

## 1.0.0-next.66

### Patch Changes

- Updated dependencies [[`64449a71`](https://github.com/sveltejs/kit/commit/64449a7138b9b5bce913dce1290bd6ff8a44c906)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.32
  - @sveltejs/adapter-netlify@1.0.0-next.72
  - @sveltejs/adapter-vercel@1.0.0-next.68

## 1.0.0-next.65

### Patch Changes

- Updated dependencies [[`4bd84b32`](https://github.com/sveltejs/kit/commit/4bd84b326889f71c2ebaacfc7f0f1b3a19017a4c)]:
  - @sveltejs/adapter-vercel@1.0.0-next.67
  - @sveltejs/adapter-netlify@1.0.0-next.71

## 1.0.0-next.64

### Patch Changes

- Updated dependencies [[`b1a40552`](https://github.com/sveltejs/kit/commit/b1a40552aa6d9bd16d1f2bb5d7359dcc0101d2ea)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.31
  - @sveltejs/adapter-netlify@1.0.0-next.71
  - @sveltejs/adapter-vercel@1.0.0-next.66

## 1.0.0-next.63

### Patch Changes

- Updated dependencies [[`81917206`](https://github.com/sveltejs/kit/commit/819172065cdda6c695f3fb48e60fa451c1caaae6)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.30
  - @sveltejs/adapter-netlify@1.0.0-next.70
  - @sveltejs/adapter-vercel@1.0.0-next.65

## 1.0.0-next.62

### Patch Changes

- Updated dependencies [[`2a9c1925`](https://github.com/sveltejs/kit/commit/2a9c19252912d61bd840441fe80dc13366af41f7)]:
  - @sveltejs/adapter-vercel@1.0.0-next.64
  - @sveltejs/adapter-netlify@1.0.0-next.69

## 1.0.0-next.61

### Patch Changes

- Updated dependencies [[`bbb8a8e0`](https://github.com/sveltejs/kit/commit/bbb8a8e0f0d2ca6513ecc8da5964877acbebf4b7)]:
  - @sveltejs/adapter-vercel@1.0.0-next.63

## 1.0.0-next.60

### Patch Changes

- Updated dependencies [[`5e7ca20d`](https://github.com/sveltejs/kit/commit/5e7ca20d79682416fb11aefc3f3abe0f1878d188)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.29
  - @sveltejs/adapter-netlify@1.0.0-next.69
  - @sveltejs/adapter-vercel@1.0.0-next.62

## 1.0.0-next.59

### Patch Changes

- Updated dependencies [[`d090a59b`](https://github.com/sveltejs/kit/commit/d090a59b89114f5f4ec605149f28a1e1748358ea)]:
  - @sveltejs/adapter-vercel@1.0.0-next.61

## 1.0.0-next.58

### Patch Changes

- Updated dependencies [[`cdbce6b1`](https://github.com/sveltejs/kit/commit/cdbce6b10e960a8839916ab5db11c79b450541f7)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.28

## 1.0.0-next.57

### Patch Changes

- Updated dependencies [[`10f2105d`](https://github.com/sveltejs/kit/commit/10f2105d5d33640cfd7365b3747c131a90281834)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.27

## 1.0.0-next.56

### Patch Changes

- Updated dependencies [[`31fbb1cb`](https://github.com/sveltejs/kit/commit/31fbb1cb4dc9fd29edff5993bb85da8863b54e79)]:
  - @sveltejs/adapter-netlify@1.0.0-next.68

## 1.0.0-next.55

### Patch Changes

- chore: upgrade TypeScript to 4.7.4 ([#5414](https://github.com/sveltejs/kit/pull/5414))
- Updated dependencies [[`3799a89e`](https://github.com/sveltejs/kit/commit/3799a89e7913b71da4dab749ec1423215c4a20a1)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.26
  - @sveltejs/adapter-netlify@1.0.0-next.67
  - @sveltejs/adapter-vercel@1.0.0-next.60

## 1.0.0-next.54

### Patch Changes

- Updated dependencies [[`320777aa`](https://github.com/sveltejs/kit/commit/320777aad1f0d2141e36738fc440589e3232304d)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.25

## 1.0.0-next.53

### Patch Changes

- Updated dependencies [[`8883ab72`](https://github.com/sveltejs/kit/commit/8883ab72bf2a9ce1815ef8ebd5eb7b028cd5a6dd)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.24
  - @sveltejs/adapter-netlify@1.0.0-next.66
  - @sveltejs/adapter-vercel@1.0.0-next.59

## 1.0.0-next.52

### Patch Changes

- Updated dependencies [[`c399840e`](https://github.com/sveltejs/kit/commit/c399840ecaa33d84e396b6d4c6658c240d248455)]:
  - @sveltejs/adapter-vercel@1.0.0-next.59
  - @sveltejs/adapter-netlify@1.0.0-next.65

## 1.0.0-next.51

### Patch Changes

- Updated dependencies [[`1974386d`](https://github.com/sveltejs/kit/commit/1974386d001beff62d92ca1d174a06c5681d3158)]:
  - @sveltejs/adapter-netlify@1.0.0-next.65
  - @sveltejs/adapter-vercel@1.0.0-next.58

## 1.0.0-next.50

### Patch Changes

- Update dependencies ([#5121](https://github.com/sveltejs/kit/pull/5121))
- Updated dependencies [[`821592f3`](https://github.com/sveltejs/kit/commit/821592f36e4e507cbfa5a0e0a1ee99be9991e827)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.23
  - @sveltejs/adapter-netlify@1.0.0-next.64
  - @sveltejs/adapter-vercel@1.0.0-next.58

## 1.0.0-next.49

### Patch Changes

- Update adapter entrypoint typings to be NodeNext/ESNext-compatible ([#5111](https://github.com/sveltejs/kit/pull/5111))
- Updated dependencies [[`7d5fb308`](https://github.com/sveltejs/kit/commit/7d5fb3083a428c4b045d7845138efdb40e1ebad8)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.22
  - @sveltejs/adapter-netlify@1.0.0-next.63
  - @sveltejs/adapter-vercel@1.0.0-next.57

## 1.0.0-next.48

### Patch Changes

- Updated dependencies [[`60370cc2`](https://github.com/sveltejs/kit/commit/60370cc242ff0879401d3b10eb38e9c22e41b7ab), [`f0fb175d`](https://github.com/sveltejs/kit/commit/f0fb175dda834807dc51964105e4ecce33c4ad0b)]:
  - @sveltejs/adapter-vercel@1.0.0-next.56
  - @sveltejs/adapter-cloudflare@1.0.0-next.21
  - @sveltejs/adapter-netlify@1.0.0-next.62

## 1.0.0-next.47

### Patch Changes

- Add types to pkg.exports ([#5045](https://github.com/sveltejs/kit/pull/5045))
- Updated dependencies [[`9b13c61c`](https://github.com/sveltejs/kit/commit/9b13c61c68ac4fe601e0a95cf958f7b63fa7a754)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.20
  - @sveltejs/adapter-netlify@1.0.0-next.61
  - @sveltejs/adapter-vercel@1.0.0-next.55

## 1.0.0-next.46

### Patch Changes

- Updated dependencies [[`e3c9073a`](https://github.com/sveltejs/kit/commit/e3c9073a8b43f1dd4aa871639b61cb974a1f110e)]:
  - @sveltejs/adapter-netlify@1.0.0-next.60
  - @sveltejs/adapter-vercel@1.0.0-next.54

## 1.0.0-next.45

### Patch Changes

- Updated dependencies [[`c660143a`](https://github.com/sveltejs/kit/commit/c660143ad2b90ea3a1ae18247c553da2538750a0)]:
  - @sveltejs/adapter-netlify@1.0.0-next.59
  - @sveltejs/adapter-vercel@1.0.0-next.54

## 1.0.0-next.44

### Patch Changes

- Updated dependencies [[`a452bd83`](https://github.com/sveltejs/kit/commit/a452bd83ac5feb27040a1cb364395c9ae5c04107)]:
  - @sveltejs/adapter-vercel@1.0.0-next.53

## 1.0.0-next.43

### Patch Changes

- Updated dependencies [[`0efa319d`](https://github.com/sveltejs/kit/commit/0efa319d0a03c180a66845d1a4933589084ddb48), [`3d34924c`](https://github.com/sveltejs/kit/commit/3d34924c3f3c1af75c326c6d92cdbfb263f0492a), [`e685c5ae`](https://github.com/sveltejs/kit/commit/e685c5aecdefbc57fcbec5624ed43fd7dd01a037)]:
  - @sveltejs/adapter-netlify@1.0.0-next.58
  - @sveltejs/adapter-vercel@1.0.0-next.52

## 1.0.0-next.42

### Patch Changes

- Updated dependencies [[`7609ad07`](https://github.com/sveltejs/kit/commit/7609ad0759c895600198eaf4345d735c7c6d1166), [`7609ad07`](https://github.com/sveltejs/kit/commit/7609ad0759c895600198eaf4345d735c7c6d1166)]:
  - @sveltejs/adapter-vercel@1.0.0-next.51
  - @sveltejs/adapter-netlify@1.0.0-next.57

## 1.0.0-next.41

### Patch Changes

- Updated dependencies [[`3b83249b`](https://github.com/sveltejs/kit/commit/3b83249ba22353ccfe592d265d2c3b8b71c2c224)]:
  - @sveltejs/adapter-netlify@1.0.0-next.57
  - @sveltejs/adapter-vercel@1.0.0-next.50

## 1.0.0-next.40

### Patch Changes

- Updated dependencies [[`f9c30302`](https://github.com/sveltejs/kit/commit/f9c30302d8639983ea2e13bf532f34dbaa78d199)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.19
  - @sveltejs/adapter-netlify@1.0.0-next.56
  - @sveltejs/adapter-vercel@1.0.0-next.50

## 1.0.0-next.39

### Patch Changes

- Updated dependencies [[`6821d642`](https://github.com/sveltejs/kit/commit/6821d642478c692ed028e91d8d08c9754aa1db2f)]:
  - @sveltejs/adapter-vercel@1.0.0-next.50
  - @sveltejs/adapter-netlify@1.0.0-next.55

## 1.0.0-next.38

### Patch Changes

- Updated dependencies [[`40e50322`](https://github.com/sveltejs/kit/commit/40e50322cd4487d818198f879b90166eccd31c78)]:
  - @sveltejs/adapter-netlify@1.0.0-next.55

## 1.0.0-next.37

### Patch Changes

- Updated dependencies [[`f862a784`](https://github.com/sveltejs/kit/commit/f862a7844349ab3a233fdc67e0cc8025fde385c6)]:
  - @sveltejs/adapter-netlify@1.0.0-next.54
  - @sveltejs/adapter-vercel@1.0.0-next.49

## 1.0.0-next.36

### Patch Changes

- Updated dependencies [[`f15af292`](https://github.com/sveltejs/kit/commit/f15af292f5e91dac4cd526f9ad538b5d593505ce), [`e82fe2b5`](https://github.com/sveltejs/kit/commit/e82fe2b519d3dd84aa77cdd62f4b251874019a6b)]:
  - @sveltejs/adapter-vercel@1.0.0-next.49
  - @sveltejs/adapter-netlify@1.0.0-next.53

## 1.0.0-next.35

### Patch Changes

- Updated dependencies [[`467cdb97`](https://github.com/sveltejs/kit/commit/467cdb9713e7d6a3355a35ffb5ee17bcd58a9c30), [`b228fb5b`](https://github.com/sveltejs/kit/commit/b228fb5b119641dca59dcb57d94700ebe3b79155), [`41db4a36`](https://github.com/sveltejs/kit/commit/41db4a36f3673c4b174d872a47afd1efd0db35c4)]:
  - @sveltejs/adapter-vercel@1.0.0-next.48
  - @sveltejs/adapter-cloudflare@1.0.0-next.18
  - @sveltejs/adapter-netlify@1.0.0-next.52

## 1.0.0-next.34

### Patch Changes

- Updated dependencies [[`316943fc`](https://github.com/sveltejs/kit/commit/316943fc2ea3272060636e12eccac430667fc562), [`08bb98c8`](https://github.com/sveltejs/kit/commit/08bb98c8d4f3431bf3e43faeec08ec9669b70e51)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.17
  - @sveltejs/adapter-netlify@1.0.0-next.51
  - @sveltejs/adapter-vercel@1.0.0-next.47

## 1.0.0-next.33

### Patch Changes

- Updated dependencies [[`268ee6b9`](https://github.com/sveltejs/kit/commit/268ee6b921ee9cab9f5995b6c5144b3d903ed02a)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.16
  - @sveltejs/adapter-netlify@1.0.0-next.51
  - @sveltejs/adapter-vercel@1.0.0-next.47

## 1.0.0-next.32

### Patch Changes

- Select adapter immediately ([#4299](https://github.com/sveltejs/kit/pull/4299))
- Updated dependencies []:
  - @sveltejs/adapter-netlify@1.0.0-next.50
  - @sveltejs/adapter-vercel@1.0.0-next.46

## 1.0.0-next.31

### Patch Changes

- Updated dependencies [[`8aa2920b`](https://github.com/sveltejs/kit/commit/8aa2920b9a05ab2907ee2ffbe9f273ab8e2dbc69)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.15
  - @sveltejs/adapter-netlify@1.0.0-next.50
  - @sveltejs/adapter-vercel@1.0.0-next.46

## 1.0.0-next.30

### Patch Changes

- Updated dependencies [[`8c08aa50`](https://github.com/sveltejs/kit/commit/8c08aa505a0b5238cdc2fbe8408b89ff495da1f7)]:
  - @sveltejs/adapter-netlify@1.0.0-next.49
  - @sveltejs/adapter-cloudflare@1.0.0-next.14
  - @sveltejs/adapter-vercel@1.0.0-next.45

## 1.0.0-next.29

### Patch Changes

- Updated dependencies [[`dcb856f8`](https://github.com/sveltejs/kit/commit/dcb856f89ccc5c823fa604fb20e75d88323f83ca)]:
  - @sveltejs/adapter-netlify@1.0.0-next.48
  - @sveltejs/adapter-vercel@1.0.0-next.45
  - @sveltejs/adapter-cloudflare@1.0.0-next.14

## 1.0.0-next.28

### Patch Changes

- Updated dependencies [[`c1bf43e4`](https://github.com/sveltejs/kit/commit/c1bf43e4cc34f565089d82f8579e46ea12ae618e)]:
  - @sveltejs/adapter-netlify@1.0.0-next.47
  - @sveltejs/adapter-cloudflare@1.0.0-next.14
  - @sveltejs/adapter-vercel@1.0.0-next.44

## 1.0.0-next.27

### Patch Changes

- Bumping versions again ([#4090](https://github.com/sveltejs/kit/pull/4090))
- Updated dependencies [[`69401762`](https://github.com/sveltejs/kit/commit/694017624ec8f1abaad7ebefb867bb065f7adf05)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.14

## 1.0.0-next.26

### Patch Changes

- Attempt to force @next version bump ([#4088](https://github.com/sveltejs/kit/pull/4088))
- Updated dependencies [[`46f44a61`](https://github.com/sveltejs/kit/commit/46f44a61624bed525e393e669da9b7db566a1e18)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.13

## 1.0.0-next.25

### Patch Changes

- Attempt to bump @next version of adapter-auto ([#4082](https://github.com/sveltejs/kit/pull/4082))

## 1.0.0-next.24

### Patch Changes

- Updated dependencies [[`f223f91a`](https://github.com/sveltejs/kit/commit/f223f91ab8346fb8fc376393603956e72baa6369)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.12
  - @sveltejs/adapter-netlify@1.0.0-next.46
  - @sveltejs/adapter-vercel@1.0.0-next.44

## 1.0.0-next.23

### Patch Changes

- Updated dependencies [[`9ee49342`](https://github.com/sveltejs/kit/commit/9ee493426a5571b20d5d84eb59b4b7ded9f3438d)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.11
  - @sveltejs/adapter-netlify@1.0.0-next.45
  - @sveltejs/adapter-vercel@1.0.0-next.43

## 1.0.0-next.22

### Patch Changes

- Updated dependencies [[`b05c9f13`](https://github.com/sveltejs/kit/commit/b05c9f13ec4b61053962b99a62794ee3831bf345)]:
  - @sveltejs/adapter-vercel@1.0.0-next.43

## 1.0.0-next.21

### Patch Changes

- Updated dependencies [[`68fd6843`](https://github.com/sveltejs/kit/commit/68fd684344a0650420a5b9bffa1c91333dcbaa98)]:
  - @sveltejs/adapter-vercel@1.0.0-next.42
  - @sveltejs/adapter-cloudflare@1.0.0-next.10
  - @sveltejs/adapter-netlify@1.0.0-next.45

## 1.0.0-next.20

### Patch Changes

- fix links pointing to multi-page docs ([#3815](https://github.com/sveltejs/kit/pull/3815))
- Updated dependencies []:
  - @sveltejs/adapter-cloudflare@1.0.0-next.10
  - @sveltejs/adapter-netlify@1.0.0-next.45
  - @sveltejs/adapter-vercel@1.0.0-next.41

## 1.0.0-next.19

### Patch Changes

- Updated dependencies [[`b33f75a4`](https://github.com/sveltejs/kit/commit/b33f75a4edc49d345baf3f6a5bd232232223dcc5)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.10
  - @sveltejs/adapter-netlify@1.0.0-next.45
  - @sveltejs/adapter-vercel@1.0.0-next.41

## 1.0.0-next.18

### Patch Changes

- Updated dependencies [[`48f48162`](https://github.com/sveltejs/kit/commit/48f481626908377aa156a4cc4e177d2d7d663c81)]:
  - @sveltejs/adapter-vercel@1.0.0-next.40
  - @sveltejs/adapter-cloudflare@1.0.0-next.9
  - @sveltejs/adapter-netlify@1.0.0-next.44

## 1.0.0-next.17

### Patch Changes

- Updated dependencies [[`667bc815`](https://github.com/sveltejs/kit/commit/667bc8152d094c4537cfc3329dba7c6bb4b9eac1)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.9
  - @sveltejs/adapter-netlify@1.0.0-next.44
  - @sveltejs/adapter-vercel@1.0.0-next.39

## 1.0.0-next.16

### Patch Changes

- Updated dependencies [[`90664c9d`](https://github.com/sveltejs/kit/commit/90664c9dd9749086ac0b34aa2acd625174af80cf)]:
  - @sveltejs/adapter-netlify@1.0.0-next.44
  - @sveltejs/adapter-cloudflare@1.0.0-next.8
  - @sveltejs/adapter-vercel@1.0.0-next.39

## 1.0.0-next.15

### Patch Changes

- Updated dependencies [[`1795843a`](https://github.com/sveltejs/kit/commit/1795843ac8551cc06009bd5868c7ef2a65c00200)]:
  - @sveltejs/adapter-netlify@1.0.0-next.43

## 1.0.0-next.14

### Patch Changes

- Updated dependencies [[`4d58e10c`](https://github.com/sveltejs/kit/commit/4d58e10c36cab47d40c161a87c82512bebeb6b90)]:
  - @sveltejs/adapter-netlify@1.0.0-next.42
  - @sveltejs/adapter-cloudflare@1.0.0-next.8
  - @sveltejs/adapter-vercel@1.0.0-next.39

## 1.0.0-next.13

### Patch Changes

- Updated dependencies [[`ee906a3b`](https://github.com/sveltejs/kit/commit/ee906a3b2b103e4523eb1b6bb13f04d03eb35238)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.8
  - @sveltejs/adapter-netlify@1.0.0-next.41
  - @sveltejs/adapter-vercel@1.0.0-next.39

## 1.0.0-next.12

### Patch Changes

- Updated dependencies [[`49114b9a`](https://github.com/sveltejs/kit/commit/49114b9a37e93335b027865e68fa4d58a0a7a2e5)]:
  - @sveltejs/adapter-netlify@1.0.0-next.40
  - @sveltejs/adapter-vercel@1.0.0-next.38
  - @sveltejs/adapter-cloudflare@1.0.0-next.7

## 1.0.0-next.11

### Patch Changes

- Allow `__fetchPolyfill()` to run several times ([#3377](https://github.com/sveltejs/kit/pull/3377))
- Updated dependencies [[`7569bb27`](https://github.com/sveltejs/kit/commit/7569bb27a640c2bbff6ac02a4c44fdf456bdc227)]:
  - @sveltejs/adapter-netlify@1.0.0-next.39
  - @sveltejs/adapter-vercel@1.0.0-next.37

## 1.0.0-next.10

### Patch Changes

- Updated dependencies [[`e100b426`](https://github.com/sveltejs/kit/commit/e100b4269f159016d7235869d002b8a623d8066b)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.7
  - @sveltejs/adapter-netlify@1.0.0-next.38
  - @sveltejs/adapter-vercel@1.0.0-next.36

## 1.0.0-next.9

### Patch Changes

- Updated dependencies [[`0f6196fd`](https://github.com/sveltejs/kit/commit/0f6196fd52d59b20df661743dee274e0040813b8)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.6

## 1.0.0-next.8

### Patch Changes

- Updated dependencies [[`a34370c1`](https://github.com/sveltejs/kit/commit/a34370c14af0179b0194deae3050330379cf138d)]:
  - @sveltejs/adapter-vercel@1.0.0-next.35
  - @sveltejs/adapter-cloudflare@1.0.0-next.5
  - @sveltejs/adapter-netlify@1.0.0-next.37

## 1.0.0-next.7

### Patch Changes

- Updated dependencies [[`a1c02e15`](https://github.com/sveltejs/kit/commit/a1c02e158ae324953c1588aefeae35eee23280bf)]:
  - @sveltejs/adapter-vercel@1.0.0-next.34

## 1.0.0-next.6

### Patch Changes

- Overhaul adapter API ([#2931](https://github.com/sveltejs/kit/pull/2931))
- Updated dependencies [[`ecb423b5`](https://github.com/sveltejs/kit/commit/ecb423b54d459be8c0693c723799be4171369afd), [`ecb423b5`](https://github.com/sveltejs/kit/commit/ecb423b54d459be8c0693c723799be4171369afd), [`c096899f`](https://github.com/sveltejs/kit/commit/c096899f12c96de34811b6f9ebfc1601d39daa2e), [`ecb423b5`](https://github.com/sveltejs/kit/commit/ecb423b54d459be8c0693c723799be4171369afd), [`ecb423b5`](https://github.com/sveltejs/kit/commit/ecb423b54d459be8c0693c723799be4171369afd)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.5
  - @sveltejs/adapter-netlify@1.0.0-next.37
  - @sveltejs/adapter-vercel@1.0.0-next.33

## 1.0.0-next.5

### Patch Changes

- Updated dependencies [[`ad321f8d`](https://github.com/sveltejs/kit/commit/ad321f8d7dadf3f5b874d5aa434776a968e1bc8b)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.4
  - @sveltejs/adapter-netlify@1.0.0-next.36
  - @sveltejs/adapter-vercel@1.0.0-next.32

## 1.0.0-next.4

### Patch Changes

- Updated dependencies [[`318072b7`](https://github.com/sveltejs/kit/commit/318072b786fe018507ae13df6da2f0bb693587e8)]:
  - @sveltejs/adapter-cloudflare@1.0.0-next.3
  - @sveltejs/adapter-netlify@1.0.0-next.36
  - @sveltejs/adapter-vercel@1.0.0-next.32

## 1.0.0-next.3

### Patch Changes

- Remove ANSI codes ([#2897](https://github.com/sveltejs/kit/pull/2897))

* Fix platform detection order ([#2897](https://github.com/sveltejs/kit/pull/2897))

## 1.0.0-next.2

### Patch Changes

- Add missing file to adapter-auto package ([#2891](https://github.com/sveltejs/kit/pull/2891))

## 1.0.0-next.1

### Patch Changes

- Force republish ([#2885](https://github.com/sveltejs/kit/pull/2885))

## 1.0.0-next.0

### Patch Changes

- Add adapter-auto ([#2867](https://github.com/sveltejs/kit/pull/2867))

####### packages/adapter-auto/index.d.ts #######

```

import { Adapter } from '@sveltejs/kit';

export default function plugin(): Adapter;

```


####### packages/adapter-auto/index.js #######

```

import { execSync } from 'node:child_process';
import { pathToFileURL } from 'node:url';
import { resolve } from 'import-meta-resolve';
import { adapters } from './adapters.js';
import { dirname, join } from 'node:path';
import { existsSync } from 'node:fs';

/** @type {Record<string, (name: string, version: string) => string>} */
const commands = {
	npm: (name, version) => `npm install -D ${name}@${version}`,
	pnpm: (name, version) => `pnpm add -D ${name}@${version}`,
	yarn: (name, version) => `yarn add -D ${name}@${version}`
};

function detect_lockfile() {
	let dir = process.cwd();

	do {
		if (existsSync(join(dir, 'pnpm-lock.yaml'))) return 'pnpm';
		if (existsSync(join(dir, 'yarn.lock'))) return 'yarn';
		if (existsSync(join(dir, 'package-lock.json'))) return 'npm';
	} while (dir !== (dir = dirname(dir)));

	return 'npm';
}

function detect_package_manager() {
	const manager = detect_lockfile();

	try {
		execSync(`${manager} --version`);
		return manager;
	} catch {
		return 'npm';
	}
}

/** @param {string} name */
async function import_from_cwd(name) {
	const cwd = pathToFileURL(process.cwd()).href;
	const url = await resolve(name, cwd + '/x.js');

	return import(url);
}

/** @typedef {import('@sveltejs/kit').Adapter} Adapter */

/**
 * @returns {Promise<Adapter | undefined>} The corresponding adapter for the current environment if found otherwise undefined
 */
async function get_adapter() {
	const match = adapters.find((candidate) => candidate.test());

	if (!match) return;

	/** @type {{ default: () => Adapter }} */
	let module;

	try {
		module = await import_from_cwd(match.module);
	} catch (error) {
		if (
			error.code === 'ERR_MODULE_NOT_FOUND' &&
			error.message.startsWith(`Cannot find package '${match.module}'`)
		) {
			const package_manager = detect_package_manager();
			const command = commands[package_manager](match.module, match.version);

			try {
				console.log(`Installing ${match.module}...`);

				execSync(command, {
					stdio: 'inherit',
					env: {
						...process.env,
						NODE_ENV: undefined
					}
				});

				module = await import_from_cwd(match.module);

				console.log(`Successfully installed ${match.module}.`);
				console.warn(
					`\nIf you plan on staying on this deployment platform, consider replacing @sveltejs/adapter-auto with ${match.module}. This will give you faster and more robust installs, and more control over deployment configuration.\n`
				);
			} catch (e) {
				throw new Error(
					`Could not install ${match.module}. Please install it yourself by adding it to your package.json's devDependencies and try building your project again.`,
					{ cause: e }
				);
			}
		} else {
			throw error;
		}
	}

	const adapter = module.default();

	return {
		...adapter,
		adapt: (builder) => {
			builder.log.info(`Detected environment: ${match.name}. Using ${match.module}`);
			return adapter.adapt(builder);
		}
	};
}

/** @type {() => Adapter} */
export default () => ({
	name: '@sveltejs/adapter-auto',
	adapt: async (builder) => {
		const adapter = await get_adapter();

		if (adapter) return adapter.adapt(builder);

		builder.log.warn(
			'Could not detect a supported production environment. See https://kit.svelte.dev/docs/adapters to learn how to configure your app to run on the platform of your choosing'
		);
	},
	supports: {
		read: () => {
			throw new Error(
				"The read function imported from $app/server only works in certain environments. Since you're using @sveltejs/adapter-auto, SvelteKit cannot determine whether it will work when your app is deployed. Please replace it with an adapter tailored to your target environment."
			);
		}
	}
});

```


####### packages/adapter-auto/package.json #######

```

{
	"name": "@sveltejs/adapter-auto",
	"version": "3.2.0",
	"description": "Automatically chooses the SvelteKit adapter for your current environment, if possible.",
	"repository": {
		"type": "git",
		"url": "https://github.com/sveltejs/kit",
		"directory": "packages/adapter-auto"
	},
	"license": "MIT",
	"homepage": "https://kit.svelte.dev",
	"type": "module",
	"exports": {
		".": {
			"types": "./index.d.ts",
			"import": "./index.js"
		},
		"./package.json": "./package.json"
	},
	"types": "index.d.ts",
	"files": [
		"files",
		"index.js",
		"index.d.ts",
		"adapters.js"
	],
	"scripts": {
		"lint": "prettier --check .",
		"format": "pnpm lint --write",
		"check": "tsc"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"@types/node": "^18.19.3",
		"typescript": "^5.3.3"
	},
	"dependencies": {
		"import-meta-resolve": "^4.0.0"
	},
	"peerDependencies": {
		"@sveltejs/kit": "^2.0.0"
	}
}

```


####### packages/adapter-auto/README.md #######

# adapter-auto

Automatically chooses the SvelteKit adapter for your current environment, if possible.

## Docs

[Docs](https://kit.svelte.dev/docs/adapter-auto)

## Changelog

[The Changelog for this package is available on GitHub](https://github.com/sveltejs/kit/blob/main/packages/adapter-auto/CHANGELOG.md).

####### packages/adapter-auto/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true,
		"noImplicitAny": true,
		"target": "es2022",
		"module": "node16",
		"moduleResolution": "node16",
		"baseUrl": "."
	},
	"include": ["**/*.js"]
}

```


####### packages/adapter-cloudflare/ambient.d.ts #######

```

import { CacheStorage, IncomingRequestCfProperties } from '@cloudflare/workers-types';

declare global {
	namespace App {
		export interface Platform {
			context: {
				waitUntil(promise: Promise<any>): void;
			};
			caches: CacheStorage;
			cf?: IncomingRequestCfProperties;
		}
	}
}

```


####### packages/adapter-cloudflare/CHANGELOG.md #######

# @sveltejs/adapter-cloudflare

## 4.4.0

### Minor Changes

- chore(deps): upgrade esbuild ([#12118](https://github.com/sveltejs/kit/pull/12118))

### Patch Changes

- Updated dependencies [[`bbab296f6fcc05af6b999182798bcdedabbaa4c9`](https://github.com/sveltejs/kit/commit/bbab296f6fcc05af6b999182798bcdedabbaa4c9)]:
  - @sveltejs/kit@2.5.6

## 4.3.0

### Minor Changes

- feat: support platform emulation configuration via the `platformProxy` adapter option ([#12011](https://github.com/sveltejs/kit/pull/12011))

## 4.2.1

### Patch Changes

- fix: add `workerd` to esbuild conditions ([#12069](https://github.com/sveltejs/kit/pull/12069))

## 4.2.0

### Minor Changes

- feat: emulate Cloudflare Workers bindings and incoming request properties in `event.platform` for `dev` and `preview` ([#11974](https://github.com/sveltejs/kit/pull/11974))

### Patch Changes

- Updated dependencies [[`4562275ed42964148df03c79434172024897c08c`](https://github.com/sveltejs/kit/commit/4562275ed42964148df03c79434172024897c08c)]:
  - @sveltejs/kit@2.5.4

## 4.1.0

### Minor Changes

- feat: more helpful errors when using incompatible Node modules ([#11673](https://github.com/sveltejs/kit/pull/11673))

- feat: support compatible node modules without prefixes ([#11672](https://github.com/sveltejs/kit/pull/11672))

- feat: Add Node.js compatibility ([#10544](https://github.com/sveltejs/kit/pull/10544))

### Patch Changes

- Updated dependencies [[`288f731c8a5b20cadb9e219f9583f3f16bf8c7b8`](https://github.com/sveltejs/kit/commit/288f731c8a5b20cadb9e219f9583f3f16bf8c7b8)]:
  - @sveltejs/kit@2.4.0

## 4.0.2

### Patch Changes

- chore(deps): update dependency worktop to v0.8.0-next.18 ([#11618](https://github.com/sveltejs/kit/pull/11618))

## 4.0.1

### Patch Changes

- chore: upgrade esbuild to 0.19.11 ([#11632](https://github.com/sveltejs/kit/pull/11632))

## 4.0.0

### Major Changes

- breaking: generate plaintext 404.html instead of SPA-style fallback page ([#11596](https://github.com/sveltejs/kit/pull/11596))

### Patch Changes

- Updated dependencies [[`2137717ea8592c310ada93490feabbd9eea125ea`](https://github.com/sveltejs/kit/commit/2137717ea8592c310ada93490feabbd9eea125ea)]:
  - @sveltejs/kit@2.3.3

## 3.0.2

### Patch Changes

- fix: serve static files in `_app` from function, if not already handled ([#11593](https://github.com/sveltejs/kit/pull/11593))

- Updated dependencies [[`553e14c8320ad9c6ebb3c554c35f1482755c9555`](https://github.com/sveltejs/kit/commit/553e14c8320ad9c6ebb3c554c35f1482755c9555), [`48576de0dc8b1fbbab7954113004540ea4e76935`](https://github.com/sveltejs/kit/commit/48576de0dc8b1fbbab7954113004540ea4e76935)]:
  - @sveltejs/kit@2.3.2

## 3.0.1

### Patch Changes

- chore: update primary branch from master to main ([`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d))

- Updated dependencies [[`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d), [`16961e8cd3fa6a7f382153b1ff056bc2aae9b31b`](https://github.com/sveltejs/kit/commit/16961e8cd3fa6a7f382153b1ff056bc2aae9b31b), [`197e01f95652f511160f38b37b9da73a124ecd48`](https://github.com/sveltejs/kit/commit/197e01f95652f511160f38b37b9da73a124ecd48), [`102e4a5ae5b29624302163faf5a20c94a64a5b2c`](https://github.com/sveltejs/kit/commit/102e4a5ae5b29624302163faf5a20c94a64a5b2c), [`f8e3d8b9728c9f1ab63389342c31d7246b6f9db6`](https://github.com/sveltejs/kit/commit/f8e3d8b9728c9f1ab63389342c31d7246b6f9db6)]:
  - @sveltejs/kit@2.0.4

## 3.0.0

### Major Changes

- breaking: require SvelteKit 2 ([#11316](https://github.com/sveltejs/kit/pull/11316))

- chore: upgrade esbuild ([#11122](https://github.com/sveltejs/kit/pull/11122))

## 2.3.4

### Patch Changes

- fix: retain URL query string for trailing slash redirects to prerendered pages ([#11142](https://github.com/sveltejs/kit/pull/11142))

- Updated dependencies [[`a7f8bdcfa`](https://github.com/sveltejs/kit/commit/a7f8bdcfabce5cda85dd073a21d0afb6138a7a08), [`a4d91304e`](https://github.com/sveltejs/kit/commit/a4d91304eebc08bf2e748d83a46d3548a546e3ab)]:
  - @sveltejs/kit@1.27.7

## 2.3.3

### Patch Changes

- fix: correctly include `config.kit.paths.base` ([#10604](https://github.com/sveltejs/kit/pull/10604))

- Updated dependencies [[`7c37a2fb3`](https://github.com/sveltejs/kit/commit/7c37a2fb3bff0f47f817bc8049b454abe591b8a0), [`998fe2f19`](https://github.com/sveltejs/kit/commit/998fe2f19833df4ffc08f29e924cc8e1591f7734), [`23721d1fb`](https://github.com/sveltejs/kit/commit/23721d1fbed04083069f07c068289282819ff4cb), [`32afba695`](https://github.com/sveltejs/kit/commit/32afba695088b946aefe96da75b36de9b0667fbe)]:
  - @sveltejs/kit@1.23.0

## 2.3.2

### Patch Changes

- fix: mark `cloudflare:` packages as external ([#10404](https://github.com/sveltejs/kit/pull/10404))

- Updated dependencies [[`0f0049810`](https://github.com/sveltejs/kit/commit/0f00498100361ef0a4ea8b0b4e8465e442fa22a6), [`6f36aefe1`](https://github.com/sveltejs/kit/commit/6f36aefe13bf55cfaef14166c60ecee989061ddd)]:
  - @sveltejs/kit@1.22.4

## 2.3.1

### Patch Changes

- chore: upgrade to esbuild 0.18.11 ([#10330](https://github.com/sveltejs/kit/pull/10330))

- Updated dependencies [[`23d1df702`](https://github.com/sveltejs/kit/commit/23d1df702f0fd77983040404352d8d83fd1dd8a1), [`486a971fe`](https://github.com/sveltejs/kit/commit/486a971fe7c375aae1585f1fa2505e28f86f4b8e)]:
  - @sveltejs/kit@1.22.2

## 2.3.0

### Minor Changes

- feat: add cloudflare's `request.cf` object to the `event.platform` property ([#9978](https://github.com/sveltejs/kit/pull/9978))

### Patch Changes

- Updated dependencies [[`4aa976e50`](https://github.com/sveltejs/kit/commit/4aa976e5018664ee333629c5f2f6edacab9d868a), [`c1d34584f`](https://github.com/sveltejs/kit/commit/c1d34584f2404b9c80a547c8138264cac2a813b6), [`1c0423b65`](https://github.com/sveltejs/kit/commit/1c0423b655b7d5909e405d9d15025dc75e71a04f), [`7499d8f31`](https://github.com/sveltejs/kit/commit/7499d8f31195473d2c955f1280e097ac95995efa), [`81af6baf9`](https://github.com/sveltejs/kit/commit/81af6baf9b6f6e8f14212958eb393677db09320a), [`86dd16cc1`](https://github.com/sveltejs/kit/commit/86dd16cc10c35c4b723a4e7f77e654452aa0965e), [`195e9ac22`](https://github.com/sveltejs/kit/commit/195e9ac2233776ecf1aff7dadbadd7226f68e8dd)]:
  - @sveltejs/kit@1.19.0

## 2.2.4

### Patch Changes

- fix: require explicit cache-control header for caching ([#9885](https://github.com/sveltejs/kit/pull/9885))

## 2.2.3

### Patch Changes

- fix: Copy .wasm files during build ([#9909](https://github.com/sveltejs/kit/pull/9909))

- Updated dependencies [[`50acb22ca`](https://github.com/sveltejs/kit/commit/50acb22caf2901283e044cdfda36db6f07b3e0ae), [`2e6da9496`](https://github.com/sveltejs/kit/commit/2e6da9496bdace2c65040b9d1845c44801ca868c), [`a81106b3a`](https://github.com/sveltejs/kit/commit/a81106b3a817829c41e048207d6253e63988c58c), [`a6338a0b1`](https://github.com/sveltejs/kit/commit/a6338a0b124f54bda7ba3fe64be1d6173e118d00), [`4a85b7f08`](https://github.com/sveltejs/kit/commit/4a85b7f0820d35c7830c00afe1df3c94fcbf8c3d), [`26d2b7f8f`](https://github.com/sveltejs/kit/commit/26d2b7f8f5ca29c60ef61b936ff86deaeb1636ce), [`bc70b4e63`](https://github.com/sveltejs/kit/commit/bc70b4e636fcbd9593356996bf737e014ff8c238), [`ab9f57721`](https://github.com/sveltejs/kit/commit/ab9f57721fca146af7c4eb41f4875fafa5dfc0d2)]:
  - @sveltejs/kit@1.17.0

## 2.2.2

### Patch Changes

- fix: respect response status code for caching in `adapter-cloudflare` ([#9820](https://github.com/sveltejs/kit/pull/9820))

## 2.2.1

### Patch Changes

- chore: update all dependencies with minor version bumps ([#9761](https://github.com/sveltejs/kit/pull/9761))

## 2.2.0

### Minor Changes

- feat: generate `404.html` ([#9294](https://github.com/sveltejs/kit/pull/9294))

- feat: use `es2022` target ([#9293](https://github.com/sveltejs/kit/pull/9293))

### Patch Changes

- Updated dependencies [[`2b647fd8`](https://github.com/sveltejs/kit/commit/2b647fd85be028bc5775894567ee8b13f91411a7), [`fbe4fe76`](https://github.com/sveltejs/kit/commit/fbe4fe768140abac09bd66edd12c77787cafc2c5), [`744dc81c`](https://github.com/sveltejs/kit/commit/744dc81c6b0d8cade087df733c6d3d3f1281e68c)]:
  - @sveltejs/kit@1.10.0

## 2.1.0

### Minor Changes

- feat: allow custom `include` and `exclude` rules in `_routes.json` ([#9111](https://github.com/sveltejs/kit/pull/9111))

## 2.0.2

### Patch Changes

- fix: exclude `_headers` and `_redirects` files from Cloudflare Pages static request list ([#9042](https://github.com/sveltejs/kit/pull/9042))

- fix: remove redundant cloudflare worker static asset serving ([#9040](https://github.com/sveltejs/kit/pull/9040))

- Updated dependencies [[`19c0e62a`](https://github.com/sveltejs/kit/commit/19c0e62a6bd281e656061b453973c35fa2dd9d3d)]:
  - @sveltejs/kit@1.5.7

## 2.0.1

### Patch Changes

- fix: correctly check URL pathname with Cloudflare adapter ([#8733](https://github.com/sveltejs/kit/pull/8733))

- Updated dependencies [[`eba8fb09`](https://github.com/sveltejs/kit/commit/eba8fb0929b35edea1ca7867b816abd184d8f8f7), [`c14f3aeb`](https://github.com/sveltejs/kit/commit/c14f3aeb32f3e78c8454e9b89f85a0650b7683c4)]:
  - @sveltejs/kit@1.3.6

## 2.0.0

### Major Changes

- breaking: append `_headers` instead of overwriting ([#8693](https://github.com/sveltejs/kit/pull/8693))

## 1.1.0

### Minor Changes

- feat: include as many static assets as possible in exclude list ([#8422](https://github.com/sveltejs/kit/pull/8422))

### Patch Changes

- Updated dependencies [[`06a56ae5`](https://github.com/sveltejs/kit/commit/06a56ae587795113b17fec559ab49c93f40861e8), [`06a56ae5`](https://github.com/sveltejs/kit/commit/06a56ae587795113b17fec559ab49c93f40861e8), [`2726e7c2`](https://github.com/sveltejs/kit/commit/2726e7c2d6d086e6200f9edecbeecf0d38eef873)]:
  - @sveltejs/kit@1.2.0

## 1.0.4

### Patch Changes

- docs: move adapter docs to site ([#8531](https://github.com/sveltejs/kit/pull/8531))

## 1.0.3

### Patch Changes

- chore: remove superfluous main field from package.json ([#8519](https://github.com/sveltejs/kit/pull/8519))

- Updated dependencies [[`7e2d3405`](https://github.com/sveltejs/kit/commit/7e2d34056e99f371e22406d941b764df365a2649)]:
  - @sveltejs/kit@1.1.1

## 1.0.2

### Patch Changes

- fix: don't load ambient worker types ([#8483](https://github.com/sveltejs/kit/pull/8483))

## 1.0.1

### Patch Changes

- docs: add note about inability to access file system at runtime ([#8441](https://github.com/sveltejs/kit/pull/8441))

- Updated dependencies [[`9c01c32e`](https://github.com/sveltejs/kit/commit/9c01c32ef72bbed630fadcb8283f8f8533ced5e1), [`b6ca02a6`](https://github.com/sveltejs/kit/commit/b6ca02a684dbf13a3138b552e2d2be64697f2254), [`130abe43`](https://github.com/sveltejs/kit/commit/130abe43cef2cfbaf922aa16b20cbd4332a07c15), [`c4137536`](https://github.com/sveltejs/kit/commit/c4137536f2c6572eaeec1a82ccea0852f5be6b98), [`40464efa`](https://github.com/sveltejs/kit/commit/40464efab172a17f0b637d7dadea30d77ef1ed10), [`ce028470`](https://github.com/sveltejs/kit/commit/ce0284708184198efdd30f3ff72fd579cef830b4)]:
  - @sveltejs/kit@1.0.12

## 1.0.0

### Major Changes

First major release, see below for the history of changes that lead up to this.
Starting from now all releases follow semver and changes will be listed as Major/Minor/Patch

## 1.0.0-next.45

### Patch Changes

- breaking: remove warnings/errors about removed/changed APIs ([#8019](https://github.com/sveltejs/kit/pull/8019))
- Updated dependencies [[`f42604a2`](https://github.com/sveltejs/kit/commit/f42604a2b4c04026d3d8bad95807720b79529539)]:
  - @sveltejs/kit@1.0.0-next.589

## 1.0.0-next.44

### Patch Changes

- chore: add peerDependencies, add more specific next version ([#8141](https://github.com/sveltejs/kit/pull/8141))

## 1.0.0-next.43

### Patch Changes

- fix: revert platform change from browser to neutral ([#8122](https://github.com/sveltejs/kit/pull/8122))

## 1.0.0-next.42

### Patch Changes

- fix: set esbuild platform to neutral ([#8083](https://github.com/sveltejs/kit/pull/8083))

## 1.0.0-next.41

### Patch Changes

- update esbuild to ^0.16.3 ([#7543](https://github.com/sveltejs/kit/pull/7543))

## 1.0.0-next.40

### Patch Changes

- update dependencies ([#7355](https://github.com/sveltejs/kit/pull/7355))

## 1.0.0-next.39

### Patch Changes

- Use config.kit.paths.base prefix for static assets ([#4448](https://github.com/sveltejs/kit/pull/4448))

## 1.0.0-next.38

### Patch Changes

- Ensure all excluded paths in `_routes.json` start with / ([#6952](https://github.com/sveltejs/kit/pull/6952))

## 1.0.0-next.37

### Patch Changes

- Support Cloudflare Pages `_routes.json` specification ([#6530](https://github.com/sveltejs/kit/pull/6530))

## 1.0.0-next.36

### Patch Changes

- Include ambient.d.ts files in adapter packages. ([#6917](https://github.com/sveltejs/kit/pull/6917))

## 1.0.0-next.35

### Patch Changes

- fix: return 404 instead of 200 for missing assets ([#6879](https://github.com/sveltejs/kit/pull/6879))

## 1.0.0-next.34

### Patch Changes

- chore: bump esbuild ([#6829](https://github.com/sveltejs/kit/pull/6829))

## 1.0.0-next.33

### Patch Changes

- Update to esbuild 0.15 ([#6740](https://github.com/sveltejs/kit/pull/6740))

## 1.0.0-next.32

### Patch Changes

- feat: Moved hooks.js initialization from Server.respond into Server.init ([#6179](https://github.com/sveltejs/kit/pull/6179))

## 1.0.0-next.31

### Patch Changes

- Initialise `env` ([#5663](https://github.com/sveltejs/kit/pull/5663))

## 1.0.0-next.30

### Patch Changes

- breaking: remove writeStatic to align with Vite ([#5618](https://github.com/sveltejs/kit/pull/5618))

## 1.0.0-next.29

### Patch Changes

- Update dependencies ([#5005](https://github.com/sveltejs/kit/pull/5005))

## 1.0.0-next.28

### Patch Changes

- breaking: Don't pass arbitrary options to esbuild ([#4639](https://github.com/sveltejs/kit/pull/4639))

## 1.0.0-next.27

### Patch Changes

- Expose App interfaces ([#5386](https://github.com/sveltejs/kit/pull/5386))

## 1.0.0-next.26

### Patch Changes

- chore: upgrade TypeScript to 4.7.4 ([#5414](https://github.com/sveltejs/kit/pull/5414))

## 1.0.0-next.25

### Patch Changes

- Expose Cloudflare Worker Cache API through `caches` in Platform ([#5081](https://github.com/sveltejs/kit/pull/5081))

## 1.0.0-next.24

### Patch Changes

- Generate sourcemaps for server-side functions when bundling with esbuild ([#5258](https://github.com/sveltejs/kit/pull/5258))

## 1.0.0-next.23

### Patch Changes

- Update dependencies ([#5121](https://github.com/sveltejs/kit/pull/5121))

## 1.0.0-next.22

### Patch Changes

- Update adapter entrypoint typings to be NodeNext/ESNext-compatible ([#5111](https://github.com/sveltejs/kit/pull/5111))

## 1.0.0-next.21

### Patch Changes

- only serve `_app/immutable` with immutable cache header, not `_app/version.json` ([#5051](https://github.com/sveltejs/kit/pull/5051))

## 1.0.0-next.20

### Patch Changes

- Add types to pkg.exports ([#5045](https://github.com/sveltejs/kit/pull/5045))

## 1.0.0-next.19

### Patch Changes

- breaking: Remove try-catch around server.respond ([#4738](https://github.com/sveltejs/kit/pull/4738))

## 1.0.0-next.18

### Patch Changes

- chore: more restrictive cache lookup & save conditions ([#4669](https://github.com/sveltejs/kit/pull/4669))

## 1.0.0-next.17

### Patch Changes

- Check for Cache match sooner; use `worktop` for types & Cache operations ([#4453](https://github.com/sveltejs/kit/pull/4453))
- Add cloudflare cache to store responses with a cache header. ([#4412](https://github.com/sveltejs/kit/pull/4412))

## 1.0.0-next.16

### Patch Changes

- Provide getClientAddress function ([#4289](https://github.com/sveltejs/kit/pull/4289))

## 1.0.0-next.15

### Patch Changes

- breaking: replace builder.prerender() with builder.writePrerendered() and builder.prerendered ([#4192](https://github.com/sveltejs/kit/pull/4192)) ([#4229](https://github.com/sveltejs/kit/pull/4229))

## 1.0.0-next.14

### Patch Changes

- Bumping versions again ([#4090](https://github.com/sveltejs/kit/pull/4090))

## 1.0.0-next.13

### Patch Changes

- Attempt to force @next version bump ([#4088](https://github.com/sveltejs/kit/pull/4088))

## 1.0.0-next.12

### Patch Changes

- breaking: rename `app.render` to `server.respond` ([#4034](https://github.com/sveltejs/kit/pull/4034))

## 1.0.0-next.11

### Patch Changes

- Add `context` to `event.platform` object ([#3868](https://github.com/sveltejs/kit/pull/3868))

## 1.0.0-next.10

### Patch Changes

- update to Vite 2.8 and esbuild 0.14 ([#3791](https://github.com/sveltejs/kit/pull/3791))

## 1.0.0-next.9

### Patch Changes

- Pass `env` object to SvelteKit via `platform` ([#3429](https://github.com/sveltejs/kit/pull/3429))

## 1.0.0-next.8

### Patch Changes

- Breaking: change app.render signature to (request: Request) => Promise<Response> ([#3384](https://github.com/sveltejs/kit/pull/3384))

## 1.0.0-next.7

### Patch Changes

- Add immutable cache headers to generated assets ([#3222](https://github.com/sveltejs/kit/pull/3222))

## 1.0.0-next.6

### Patch Changes

- use posix to resolve relative path ([#3214](https://github.com/sveltejs/kit/pull/3214))

## 1.0.0-next.5

### Patch Changes

- Overhaul adapter API ([#2931](https://github.com/sveltejs/kit/pull/2931))
- Remove esbuild options ([#2931](https://github.com/sveltejs/kit/pull/2931))
- Update adapters to provide app.render with a url ([#3133](https://github.com/sveltejs/kit/pull/3133))

## 1.0.0-next.4

### Patch Changes

- Updated Cloudflare adapter to allow static files with spaces (eg. "Example File.pdf") to be accessed. ([#3047](https://github.com/sveltejs/kit/pull/3047))

## 1.0.0-next.3

### Patch Changes

- update to esbuild 0.13.15 and other dependency updates ([#2957](https://github.com/sveltejs/kit/pull/2957))

## 1.0.0-next.2

### Patch Changes

- Allow `npm publish` to succeed via `publishConfig.access` config ([#2834](https://github.com/sveltejs/kit/pull/2834))

## 1.0.0-next.1

### Patch Changes

- Add new `adapter-cloudflare` package for Cloudflare Pages with Workers integration ([#2815](https://github.com/sveltejs/kit/pull/2815))

## 1.0.0-next.0

- Initial release

####### packages/adapter-cloudflare/index.d.ts #######

```

import { Adapter } from '@sveltejs/kit';
import './ambient.js';
import { GetPlatformProxyOptions } from 'wrangler';

export default function plugin(options?: AdapterOptions): Adapter;

export interface AdapterOptions {
	/**
	 * Whether to render a plaintext 404.html page, or a rendered SPA fallback page. This page will
	 * only be served when a request that matches an entry in `routes.exclude` fails to match an asset.
	 *
	 * Most of the time `plaintext` is sufficient, but if you are using `routes.exclude` to manually
	 * exclude a set of prerendered pages without exceeding the 100 route limit, you may wish to
	 * use `spa` instead to avoid showing an unstyled 404 page to users.
	 *
	 * @default 'plaintext'
	 */
	fallback?: 'plaintext' | 'spa';

	/**
	 * Customize the automatically-generated `_routes.json` file.
	 * https://developers.cloudflare.com/pages/platform/functions/routing/#create-a-_routesjson-file
	 */
	routes?: {
		/**
		 * Routes that will be invoked by functions. Accepts wildcards.
		 * @default ["/*"]
		 */
		include?: string[];

		/**
		 * Routes that will not be invoked by functions. Accepts wildcards.
		 * `exclude` takes priority over `include`.
		 *
		 * To have the adapter automatically exclude certain things, you can use these placeholders:
		 *
		 * - `<build>` to exclude build artifacts (files generated by Vite)
		 * - `<files>` for the contents of your `static` directory
		 * - `<prerendered>` for prerendered routes
		 * - `<all>` to exclude all of the above
		 *
		 * @default ["<all>"]
		 */
		exclude?: string[];
	};

	/**
	 * Config object passed to {@link https://developers.cloudflare.com/workers/wrangler/api/#getplatformproxy | getPlatformProxy}
	 * during development and preview.
	 */
	platformProxy?: GetPlatformProxyOptions;
}

export interface RoutesJSONSpec {
	version: 1;
	description: string;
	include: string[];
	exclude: string[];
}

```


####### packages/adapter-cloudflare/index.js #######

```

import { writeFileSync } from 'node:fs';
import * as path from 'node:path';
import { fileURLToPath } from 'node:url';
import * as esbuild from 'esbuild';
import { getPlatformProxy } from 'wrangler';

// list from https://developers.cloudflare.com/workers/runtime-apis/nodejs/
const compatible_node_modules = [
	'assert',
	'async_hooks',
	'buffer',
	'crypto',
	'diagnostics_channel',
	'events',
	'path',
	'process',
	'stream',
	'string_decoder',
	'util'
];

/** @type {import('./index.js').default} */
export default function (options = {}) {
	return {
		name: '@sveltejs/adapter-cloudflare',
		async adapt(builder) {
			const files = fileURLToPath(new URL('./files', import.meta.url).href);
			const dest = builder.getBuildDirectory('cloudflare');
			const tmp = builder.getBuildDirectory('cloudflare-tmp');

			builder.rimraf(dest);
			builder.rimraf(tmp);

			builder.mkdirp(dest);
			builder.mkdirp(tmp);

			// generate plaintext 404.html first which can then be overridden by prerendering, if the user defined such a page
			const fallback = path.join(dest, '404.html');
			if (options.fallback === 'spa') {
				await builder.generateFallback(fallback);
			} else {
				writeFileSync(fallback, 'Not Found');
			}

			const dest_dir = `${dest}${builder.config.kit.paths.base}`;
			const written_files = builder.writeClient(dest_dir);
			builder.writePrerendered(dest_dir);

			const relativePath = path.posix.relative(tmp, builder.getServerDirectory());

			writeFileSync(
				`${tmp}/manifest.js`,
				`export const manifest = ${builder.generateManifest({ relativePath })};\n\n` +
					`export const prerendered = new Set(${JSON.stringify(builder.prerendered.paths)});\n\n` +
					`export const app_path = ${JSON.stringify(builder.getAppPath())};\n`
			);

			writeFileSync(
				`${dest}/_routes.json`,
				JSON.stringify(get_routes_json(builder, written_files, options.routes ?? {}), null, '\t')
			);

			writeFileSync(`${dest}/_headers`, generate_headers(builder.getAppPath()), { flag: 'a' });

			builder.copy(`${files}/worker.js`, `${tmp}/_worker.js`, {
				replace: {
					SERVER: `${relativePath}/index.js`,
					MANIFEST: './manifest.js'
				}
			});

			const external = ['cloudflare:*', ...compatible_node_modules.map((id) => `node:${id}`)];

			try {
				const result = await esbuild.build({
					platform: 'browser',
					// https://github.com/cloudflare/workers-sdk/blob/a12b2786ce745f24475174bcec994ad691e65b0f/packages/wrangler/src/deployment-bundle/bundle.ts#L35-L36
					conditions: ['workerd', 'worker', 'browser'],
					sourcemap: 'linked',
					target: 'es2022',
					entryPoints: [`${tmp}/_worker.js`],
					outfile: `${dest}/_worker.js`,
					allowOverwrite: true,
					format: 'esm',
					bundle: true,
					loader: {
						'.wasm': 'copy'
					},
					external,
					alias: Object.fromEntries(compatible_node_modules.map((id) => [id, `node:${id}`])),
					logLevel: 'silent'
				});

				if (result.warnings.length > 0) {
					const formatted = await esbuild.formatMessages(result.warnings, {
						kind: 'warning',
						color: true
					});

					console.error(formatted.join('\n'));
				}
			} catch (error) {
				for (const e of error.errors) {
					for (const node of e.notes) {
						const match =
							/The package "(.+)" wasn't found on the file system but is built into node/.exec(
								node.text
							);

						if (match) {
							node.text = `Cannot use "${match[1]}" when deploying to Cloudflare.`;
						}
					}
				}

				const formatted = await esbuild.formatMessages(error.errors, {
					kind: 'error',
					color: true
				});

				console.error(formatted.join('\n'));

				throw new Error(
					`Bundling with esbuild failed with ${error.errors.length} ${
						error.errors.length === 1 ? 'error' : 'errors'
					}`
				);
			}
		},
		async emulate() {
			const proxy = await getPlatformProxy(options.platformProxy);
			const platform = /** @type {App.Platform} */ ({
				env: proxy.env,
				context: proxy.ctx,
				caches: proxy.caches,
				cf: proxy.cf
			});

			/** @type {Record<string, any>} */
			const env = {};
			const prerender_platform = /** @type {App.Platform} */ (/** @type {unknown} */ ({ env }));

			for (const key in proxy.env) {
				Object.defineProperty(env, key, {
					get: () => {
						throw new Error(`Cannot access platform.env.${key} in a prerenderable route`);
					}
				});
			}

			return {
				platform: ({ prerender }) => {
					return prerender ? prerender_platform : platform;
				}
			};
		}
	};
}

/**
 * @param {import('@sveltejs/kit').Builder} builder
 * @param {string[]} assets
 * @param {import('./index.js').AdapterOptions['routes']} routes
 * @returns {import('./index.js').RoutesJSONSpec}
 */
function get_routes_json(builder, assets, { include = ['/*'], exclude = ['<all>'] }) {
	if (!Array.isArray(include) || !Array.isArray(exclude)) {
		throw new Error('routes.include and routes.exclude must be arrays');
	}

	if (include.length === 0) {
		throw new Error('routes.include must contain at least one route');
	}

	if (include.length > 100) {
		throw new Error('routes.include must contain 100 or fewer routes');
	}

	exclude = exclude
		.flatMap((rule) => (rule === '<all>' ? ['<build>', '<files>', '<prerendered>'] : rule))
		.flatMap((rule) => {
			if (rule === '<build>') {
				return `/${builder.getAppPath()}/*`;
			}

			if (rule === '<files>') {
				return assets
					.filter(
						(file) =>
							!(
								file.startsWith(`${builder.config.kit.appDir}/`) ||
								file === '_headers' ||
								file === '_redirects'
							)
					)
					.map((file) => `/${file}`);
			}

			if (rule === '<prerendered>') {
				const prerendered = [];
				for (const path of builder.prerendered.paths) {
					if (!builder.prerendered.redirects.has(path)) {
						prerendered.push(path);
					}
				}

				return prerendered;
			}

			return rule;
		});

	const excess = include.length + exclude.length - 100;
	if (excess > 0) {
		const message = `Function includes/excludes exceeds _routes.json limits (see https://developers.cloudflare.com/pages/platform/functions/routing/#limits). Dropping ${excess} exclude rules — this will cause unnecessary function invocations.`;
		builder.log.warn(message);

		exclude.length -= excess;
	}

	return {
		version: 1,
		description: 'Generated by @sveltejs/adapter-cloudflare',
		include,
		exclude
	};
}

/** @param {string} app_dir */
function generate_headers(app_dir) {
	return `
# === START AUTOGENERATED SVELTE IMMUTABLE HEADERS ===
/${app_dir}/*
  X-Robots-Tag: noindex
	Cache-Control: no-cache
/${app_dir}/immutable/*
  ! Cache-Control
	Cache-Control: public, immutable, max-age=31536000
# === END AUTOGENERATED SVELTE IMMUTABLE HEADERS ===
`.trimEnd();
}

```


####### packages/adapter-cloudflare/package.json #######

```

{
	"name": "@sveltejs/adapter-cloudflare",
	"version": "4.4.0",
	"description": "Adapter for building SvelteKit applications on Cloudflare Pages with Workers integration",
	"repository": {
		"type": "git",
		"url": "https://github.com/sveltejs/kit",
		"directory": "packages/adapter-cloudflare"
	},
	"license": "MIT",
	"homepage": "https://kit.svelte.dev",
	"type": "module",
	"exports": {
		".": {
			"types": "./index.d.ts",
			"import": "./index.js"
		},
		"./package.json": "./package.json"
	},
	"types": "index.d.ts",
	"files": [
		"files",
		"index.js",
		"index.d.ts",
		"ambient.d.ts"
	],
	"scripts": {
		"build": "esbuild src/worker.js --bundle --outfile=files/worker.js --external:SERVER --external:MANIFEST --format=esm",
		"lint": "prettier --check .",
		"format": "pnpm lint --write",
		"check": "tsc --skipLibCheck",
		"prepublishOnly": "pnpm build"
	},
	"dependencies": {
		"@cloudflare/workers-types": "^4.20231121.0",
		"esbuild": "^0.20.2",
		"worktop": "0.8.0-next.18"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@types/node": "^18.19.3",
		"@types/ws": "^8.5.10",
		"typescript": "^5.3.3"
	},
	"peerDependencies": {
		"@sveltejs/kit": "^2.0.0",
		"wrangler": "^3.28.4"
	},
	"publishConfig": {
		"access": "public"
	}
}

```


####### packages/adapter-cloudflare/placeholders.d.ts #######

```

declare module 'SERVER' {
	export { Server } from '@sveltejs/kit';
}

declare module 'MANIFEST' {
	import { SSRManifest } from '@sveltejs/kit';

	export const manifest: SSRManifest;
	export const prerendered: Set<string>;
	export const app_path: string;
}

```


####### packages/adapter-cloudflare/README.md #######

# adapter-cloudflare

[Adapter](https://kit.svelte.dev/docs/building-your-app) for building SvelteKit applications on [Cloudflare Pages](https://developers.cloudflare.com/pages/) with [Workers integration](https://developers.cloudflare.com/pages/platform/functions).

## Docs

[Docs](https://kit.svelte.dev/docs/adapter-cloudflare)

## Changelog

[The Changelog for this package is available on GitHub](https://github.com/sveltejs/kit/blob/main/packages/adapter-cloudflare/CHANGELOG.md).

####### packages/adapter-cloudflare/src/worker.js #######

```

import { Server } from 'SERVER';
import { manifest, prerendered, app_path } from 'MANIFEST';
import * as Cache from 'worktop/cfw.cache';

const server = new Server(manifest);

const immutable = `/${app_path}/immutable/`;
const version_file = `/${app_path}/version.json`;

/** @type {import('worktop/cfw').Module.Worker<{ ASSETS: import('worktop/cfw.durable').Durable.Object }>} */
const worker = {
	async fetch(req, env, context) {
		// @ts-ignore
		await server.init({ env });
		// skip cache if "cache-control: no-cache" in request
		let pragma = req.headers.get('cache-control') || '';
		let res = !pragma.includes('no-cache') && (await Cache.lookup(req));
		if (res) return res;

		let { pathname, search } = new URL(req.url);
		try {
			pathname = decodeURIComponent(pathname);
		} catch {
			// ignore invalid URI
		}

		const stripped_pathname = pathname.replace(/\/$/, '');

		// prerendered pages and /static files
		let is_static_asset = false;
		const filename = stripped_pathname.substring(1);
		if (filename) {
			is_static_asset =
				manifest.assets.has(filename) || manifest.assets.has(filename + '/index.html');
		}

		let location = pathname.at(-1) === '/' ? stripped_pathname : pathname + '/';

		if (
			is_static_asset ||
			prerendered.has(pathname) ||
			pathname === version_file ||
			pathname.startsWith(immutable)
		) {
			res = await env.ASSETS.fetch(req);
		} else if (location && prerendered.has(location)) {
			if (search) location += search;
			res = new Response('', {
				status: 308,
				headers: {
					location
				}
			});
		} else {
			// dynamically-generated pages
			res = await server.respond(req, {
				// @ts-ignore
				platform: { env, context, caches, cf: req.cf },
				getClientAddress() {
					return req.headers.get('cf-connecting-ip');
				}
			});
		}

		// write to `Cache` only if response is not an error,
		// let `Cache.save` handle the Cache-Control and Vary headers
		pragma = res.headers.get('cache-control') || '';
		return pragma && res.status < 400 ? Cache.save(req, res, context) : res;
	}
};

export default worker;

```


####### packages/adapter-cloudflare/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true,
		"noImplicitAny": true,
		"target": "es2022",
		"module": "node16",
		"moduleResolution": "node16",
		"baseUrl": ".",
		"paths": {
			"@sveltejs/kit": ["../kit/types/index"]
		}
	},
	"include": ["index.js", "placeholders.d.ts", "src/worker.js"]
}

```


####### packages/adapter-cloudflare-workers/ambient.d.ts #######

```

import { CacheStorage, IncomingRequestCfProperties } from '@cloudflare/workers-types';

declare global {
	namespace App {
		export interface Platform {
			context: {
				waitUntil(promise: Promise<any>): void;
			};
			caches: CacheStorage;
			cf?: IncomingRequestCfProperties;
		}
	}
}

```


####### packages/adapter-cloudflare-workers/CHANGELOG.md #######

# @sveltejs/adapter-cloudflare-workers

## 2.4.0

### Minor Changes

- chore(deps): upgrade esbuild ([#12118](https://github.com/sveltejs/kit/pull/12118))

### Patch Changes

- Updated dependencies [[`bbab296f6fcc05af6b999182798bcdedabbaa4c9`](https://github.com/sveltejs/kit/commit/bbab296f6fcc05af6b999182798bcdedabbaa4c9)]:
  - @sveltejs/kit@2.5.6

## 2.3.0

### Minor Changes

- feat: support platform emulation configuration via the `platformProxy` adapter option ([#12011](https://github.com/sveltejs/kit/pull/12011))

## 2.2.1

### Patch Changes

- fix: add `workerd` to esbuild conditions ([#12069](https://github.com/sveltejs/kit/pull/12069))

## 2.2.0

### Minor Changes

- feat: emulate Cloudflare Workers bindings and incoming request properties in `event.platform` for `dev` and `preview` ([#11974](https://github.com/sveltejs/kit/pull/11974))

### Patch Changes

- Updated dependencies [[`4562275ed42964148df03c79434172024897c08c`](https://github.com/sveltejs/kit/commit/4562275ed42964148df03c79434172024897c08c)]:
  - @sveltejs/kit@2.5.4

## 2.1.0

### Minor Changes

- feat: more helpful errors when using incompatible Node modules ([#11673](https://github.com/sveltejs/kit/pull/11673))

- feat: support compatible node modules without prefixes ([#11672](https://github.com/sveltejs/kit/pull/11672))

- feat: Add Node.js compatibility ([#10544](https://github.com/sveltejs/kit/pull/10544))

### Patch Changes

- Updated dependencies [[`288f731c8a5b20cadb9e219f9583f3f16bf8c7b8`](https://github.com/sveltejs/kit/commit/288f731c8a5b20cadb9e219f9583f3f16bf8c7b8)]:
  - @sveltejs/kit@2.4.0

## 2.0.3

### Patch Changes

- chore: upgrade esbuild to 0.19.11 ([#11632](https://github.com/sveltejs/kit/pull/11632))

## 2.0.2

### Patch Changes

- fix: serve static files in `_app` from function, if not already handled ([#11593](https://github.com/sveltejs/kit/pull/11593))

- Updated dependencies [[`553e14c8320ad9c6ebb3c554c35f1482755c9555`](https://github.com/sveltejs/kit/commit/553e14c8320ad9c6ebb3c554c35f1482755c9555), [`48576de0dc8b1fbbab7954113004540ea4e76935`](https://github.com/sveltejs/kit/commit/48576de0dc8b1fbbab7954113004540ea4e76935)]:
  - @sveltejs/kit@2.3.2

## 2.0.1

### Patch Changes

- chore: update primary branch from master to main ([`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d))

- Updated dependencies [[`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d), [`16961e8cd3fa6a7f382153b1ff056bc2aae9b31b`](https://github.com/sveltejs/kit/commit/16961e8cd3fa6a7f382153b1ff056bc2aae9b31b), [`197e01f95652f511160f38b37b9da73a124ecd48`](https://github.com/sveltejs/kit/commit/197e01f95652f511160f38b37b9da73a124ecd48), [`102e4a5ae5b29624302163faf5a20c94a64a5b2c`](https://github.com/sveltejs/kit/commit/102e4a5ae5b29624302163faf5a20c94a64a5b2c), [`f8e3d8b9728c9f1ab63389342c31d7246b6f9db6`](https://github.com/sveltejs/kit/commit/f8e3d8b9728c9f1ab63389342c31d7246b6f9db6)]:
  - @sveltejs/kit@2.0.4

## 2.0.0

### Major Changes

- breaking: require SvelteKit 2 ([#11316](https://github.com/sveltejs/kit/pull/11316))

- chore: upgrade esbuild ([#11122](https://github.com/sveltejs/kit/pull/11122))

### Patch Changes

- fix: declare the adapter plugin options as optional ([#11246](https://github.com/sveltejs/kit/pull/11246))

## 1.2.3

### Patch Changes

- fix: correctly map prerendered pages when base path is set ([#11245](https://github.com/sveltejs/kit/pull/11245))

- Updated dependencies [[`bd383f576`](https://github.com/sveltejs/kit/commit/bd383f576592948a2a96b357118cdc7598a8b61c), [`b6a0be712`](https://github.com/sveltejs/kit/commit/b6a0be712644bca4bbd7bec194c1bff682e39d71), [`ded16305b`](https://github.com/sveltejs/kit/commit/ded16305b4c180a697c457ca1b2bec249b4b38fb), [`15422d21d`](https://github.com/sveltejs/kit/commit/15422d21d08a1484f92490da5dd4b77ca7332c23)]:
  - @sveltejs/kit@1.28.0

## 1.2.2

### Patch Changes

- fix: retain URL query string for trailing slash redirects to prerendered pages ([#11142](https://github.com/sveltejs/kit/pull/11142))

- Updated dependencies [[`a7f8bdcfa`](https://github.com/sveltejs/kit/commit/a7f8bdcfabce5cda85dd073a21d0afb6138a7a08), [`a4d91304e`](https://github.com/sveltejs/kit/commit/a4d91304eebc08bf2e748d83a46d3548a546e3ab)]:
  - @sveltejs/kit@1.27.7

## 1.2.1

### Patch Changes

- fix: correctly check url pathnames for trailing slashes ([#10968](https://github.com/sveltejs/kit/pull/10968))

## 1.2.0

### Minor Changes

- feat: add cloudflare's `request.cf` object to the `event.platform` property ([#10873](https://github.com/sveltejs/kit/pull/10873))

## 1.1.4

### Patch Changes

- fix: mark `cloudflare:` packages as external ([#10404](https://github.com/sveltejs/kit/pull/10404))

- Updated dependencies [[`0f0049810`](https://github.com/sveltejs/kit/commit/0f00498100361ef0a4ea8b0b4e8465e442fa22a6), [`6f36aefe1`](https://github.com/sveltejs/kit/commit/6f36aefe13bf55cfaef14166c60ecee989061ddd)]:
  - @sveltejs/kit@1.22.4

## 1.1.3

### Patch Changes

- chore: upgrade to esbuild 0.18.11 ([#10330](https://github.com/sveltejs/kit/pull/10330))

- Updated dependencies [[`23d1df702`](https://github.com/sveltejs/kit/commit/23d1df702f0fd77983040404352d8d83fd1dd8a1), [`486a971fe`](https://github.com/sveltejs/kit/commit/486a971fe7c375aae1585f1fa2505e28f86f4b8e)]:
  - @sveltejs/kit@1.22.2

## 1.1.2

### Patch Changes

- fix: Copy .wasm files during build ([#9940](https://github.com/sveltejs/kit/pull/9940))

- Updated dependencies [[`50acb22ca`](https://github.com/sveltejs/kit/commit/50acb22caf2901283e044cdfda36db6f07b3e0ae), [`2e6da9496`](https://github.com/sveltejs/kit/commit/2e6da9496bdace2c65040b9d1845c44801ca868c), [`a81106b3a`](https://github.com/sveltejs/kit/commit/a81106b3a817829c41e048207d6253e63988c58c), [`a6338a0b1`](https://github.com/sveltejs/kit/commit/a6338a0b124f54bda7ba3fe64be1d6173e118d00), [`4a85b7f08`](https://github.com/sveltejs/kit/commit/4a85b7f0820d35c7830c00afe1df3c94fcbf8c3d), [`26d2b7f8f`](https://github.com/sveltejs/kit/commit/26d2b7f8f5ca29c60ef61b936ff86deaeb1636ce), [`bc70b4e63`](https://github.com/sveltejs/kit/commit/bc70b4e636fcbd9593356996bf737e014ff8c238), [`ab9f57721`](https://github.com/sveltejs/kit/commit/ab9f57721fca146af7c4eb41f4875fafa5dfc0d2)]:
  - @sveltejs/kit@1.17.0

## 1.1.1

### Patch Changes

- chore: update all dependencies with minor version bumps ([#9761](https://github.com/sveltejs/kit/pull/9761))

## 1.1.0

### Minor Changes

- feat: use `es2022` target ([#9293](https://github.com/sveltejs/kit/pull/9293))

### Patch Changes

- Updated dependencies [[`2b647fd8`](https://github.com/sveltejs/kit/commit/2b647fd85be028bc5775894567ee8b13f91411a7), [`fbe4fe76`](https://github.com/sveltejs/kit/commit/fbe4fe768140abac09bd66edd12c77787cafc2c5), [`744dc81c`](https://github.com/sveltejs/kit/commit/744dc81c6b0d8cade087df733c6d3d3f1281e68c)]:
  - @sveltejs/kit@1.10.0

## 1.0.6

### Patch Changes

- feat: expose `App.Platform` interface automatically ([#8531](https://github.com/sveltejs/kit/pull/8531))

- docs: move adapter docs to site ([#8531](https://github.com/sveltejs/kit/pull/8531))

- fix: amend `App.Platform` ([#8531](https://github.com/sveltejs/kit/pull/8531))

## 1.0.5

### Patch Changes

- fix: publish missing files ([#8532](https://github.com/sveltejs/kit/pull/8532))

## 1.0.4

### Patch Changes

- chore: remove superfluous main field from package.json ([#8519](https://github.com/sveltejs/kit/pull/8519))

- Updated dependencies [[`7e2d3405`](https://github.com/sveltejs/kit/commit/7e2d34056e99f371e22406d941b764df365a2649)]:
  - @sveltejs/kit@1.1.1

## 1.0.3

### Patch Changes

- fix: don't load ambient worker types ([#8483](https://github.com/sveltejs/kit/pull/8483))

## 1.0.2

### Patch Changes

- docs: add note about inability to access file system at runtime ([#8441](https://github.com/sveltejs/kit/pull/8441))

- Updated dependencies [[`9c01c32e`](https://github.com/sveltejs/kit/commit/9c01c32ef72bbed630fadcb8283f8f8533ced5e1), [`b6ca02a6`](https://github.com/sveltejs/kit/commit/b6ca02a684dbf13a3138b552e2d2be64697f2254), [`130abe43`](https://github.com/sveltejs/kit/commit/130abe43cef2cfbaf922aa16b20cbd4332a07c15), [`c4137536`](https://github.com/sveltejs/kit/commit/c4137536f2c6572eaeec1a82ccea0852f5be6b98), [`40464efa`](https://github.com/sveltejs/kit/commit/40464efab172a17f0b637d7dadea30d77ef1ed10), [`ce028470`](https://github.com/sveltejs/kit/commit/ce0284708184198efdd30f3ff72fd579cef830b4)]:
  - @sveltejs/kit@1.0.12

## 1.0.1

### Patch Changes

- chore: update @cloudflare/kv-asset-handler ([`30e1130e`](https://github.com/sveltejs/kit/commit/30e1130ef84e56a77be5cb1136d5c53edef6e5f9))
- Updated dependencies [[`fab0de4f`](https://github.com/sveltejs/kit/commit/fab0de4f06ac5b1e9b049e106889b193975c1c29), [`89b8d94b`](https://github.com/sveltejs/kit/commit/89b8d94b1b20d586e1ca525c30d07587c3f2d8f2)]:
  - @sveltejs/kit@1.0.2

## 1.0.0

### Major Changes

First major release, see below for the history of changes that lead up to this.
Starting from now all releases follow semver and changes will be listed as Major/Minor/Patch

## 1.0.0-next.65

### Patch Changes

- breaking: remove warnings/errors about removed/changed APIs ([#8019](https://github.com/sveltejs/kit/pull/8019))
- Updated dependencies [[`f42604a2`](https://github.com/sveltejs/kit/commit/f42604a2b4c04026d3d8bad95807720b79529539)]:
  - @sveltejs/kit@1.0.0-next.589

## 1.0.0-next.64

### Patch Changes

- chore: add peerDependencies, add more specific next version ([#8141](https://github.com/sveltejs/kit/pull/8141))

## 1.0.0-next.63

### Patch Changes

- fix: revert platform change from browser to neutral ([#8122](https://github.com/sveltejs/kit/pull/8122))

## 1.0.0-next.62

### Patch Changes

- fix: set esbuild platform to neutral ([#8083](https://github.com/sveltejs/kit/pull/8083))

## 1.0.0-next.61

### Patch Changes

- update esbuild to ^0.16.3 ([#7543](https://github.com/sveltejs/kit/pull/7543))

## 1.0.0-next.60

### Patch Changes

- update dependencies ([#7355](https://github.com/sveltejs/kit/pull/7355))

## 1.0.0-next.59

### Patch Changes

- Use config.kit.paths.base prefix for static assets ([#4448](https://github.com/sveltejs/kit/pull/4448))

## 1.0.0-next.58

### Patch Changes

- Add config option to set custom `wrangler.toml` file name ([#7104](https://github.com/sveltejs/kit/pull/7104))

## 1.0.0-next.57

### Patch Changes

- Include ambient.d.ts files in adapter packages. ([#6917](https://github.com/sveltejs/kit/pull/6917))

## 1.0.0-next.56

### Patch Changes

- chore: bump esbuild ([#6829](https://github.com/sveltejs/kit/pull/6829))

## 1.0.0-next.55

### Patch Changes

- Update to esbuild 0.15 ([#6740](https://github.com/sveltejs/kit/pull/6740))

## 1.0.0-next.54

### Patch Changes

- feat: Moved hooks.js initialization from Server.respond into Server.init ([#6179](https://github.com/sveltejs/kit/pull/6179))

## 1.0.0-next.53

### Patch Changes

- expose caches on platform ([#5887](https://github.com/sveltejs/kit/pull/5887))

## 1.0.0-next.52

### Patch Changes

- Initialise `env` ([#5663](https://github.com/sveltejs/kit/pull/5663))

## 1.0.0-next.51

### Patch Changes

- breaking: remove writeStatic to align with Vite ([#5618](https://github.com/sveltejs/kit/pull/5618))

## 1.0.0-next.50

### Patch Changes

- Update dependencies ([#5005](https://github.com/sveltejs/kit/pull/5005))

## 1.0.0-next.49

### Patch Changes

- breaking: Don't pass arbitrary options to esbuild ([#4639](https://github.com/sveltejs/kit/pull/4639))

## 1.0.0-next.48

### Patch Changes

- Expose App interfaces ([#5386](https://github.com/sveltejs/kit/pull/5386))

## 1.0.0-next.47

### Patch Changes

- chore: upgrade TypeScript to 4.7.4 ([#5414](https://github.com/sveltejs/kit/pull/5414))

## 1.0.0-next.46

### Patch Changes

- Generate sourcemaps for server-side functions when bundling with esbuild ([#5258](https://github.com/sveltejs/kit/pull/5258))

## 1.0.0-next.45

### Patch Changes

- Simplify example wrangler.toml, and fix outdated README ([#5187](https://github.com/sveltejs/kit/pull/5187))

## 1.0.0-next.44

### Patch Changes

- Update dependencies ([#5121](https://github.com/sveltejs/kit/pull/5121))

## 1.0.0-next.43

### Patch Changes

- Update adapter entrypoint typings to be NodeNext/ESNext-compatible ([#5111](https://github.com/sveltejs/kit/pull/5111))

## 1.0.0-next.42

### Patch Changes

- only serve `_app/immutable` with immutable cache header, not `_app/version.json` ([#5051](https://github.com/sveltejs/kit/pull/5051))

## 1.0.0-next.41

### Patch Changes

- Add types to pkg.exports ([#5045](https://github.com/sveltejs/kit/pull/5045))

## 1.0.0-next.40

### Patch Changes

- breaking: support Wrangler 2, drop Wrangler 1 ([#4887](https://github.com/sveltejs/kit/pull/4887))

## 1.0.0-next.39

### Patch Changes

- breaking: Remove try-catch around server.respond ([#4738](https://github.com/sveltejs/kit/pull/4738))

## 1.0.0-next.38

### Patch Changes

- - Fix an issue related to prerendered pages incorrectly resolving in @sveltejs/adapter-cloudflare-workers ([#4626](https://github.com/sveltejs/kit/pull/4626))

## 1.0.0-next.37

### Patch Changes

- Breaking: refactor implementation from "Service Worker" pattern to "Module Worker" used in adapter-cloudflare ([#4276](https://github.com/sveltejs/kit/pull/4276))

  #### add the following to your wrangler.toml

  ```toml
  		[build.upload]
  		format = "modules"
  		main = "./worker.mjs"
  ```

## 1.0.0-next.36

### Patch Changes

- Provide getClientAddress function ([#4289](https://github.com/sveltejs/kit/pull/4289))

## 1.0.0-next.35

### Patch Changes

- breaking: replace builder.prerender() with builder.writePrerendered() and builder.prerendered ([#4192](https://github.com/sveltejs/kit/pull/4192)) ([#4229](https://github.com/sveltejs/kit/pull/4229))

## 1.0.0-next.34

### Patch Changes

- breaking: rename `app.render` to `server.respond` ([#4034](https://github.com/sveltejs/kit/pull/4034))

## 1.0.0-next.33

### Patch Changes

- revert change to Cloudflare ES target version ([#3847](https://github.com/sveltejs/kit/pull/3847))

## 1.0.0-next.32

### Patch Changes

- Fix Cloudflare adapter targets ([#3827](https://github.com/sveltejs/kit/pull/3827))

## 1.0.0-next.31

### Patch Changes

- update to Vite 2.8 and esbuild 0.14 ([#3791](https://github.com/sveltejs/kit/pull/3791))

## 1.0.0-next.30

### Patch Changes

- Breaking: change app.render signature to (request: Request) => Promise<Response> ([#3384](https://github.com/sveltejs/kit/pull/3384))

## 1.0.0-next.29

### Patch Changes

- Add immutable cache headers to generated assets ([#3222](https://github.com/sveltejs/kit/pull/3222))

## 1.0.0-next.28

### Patch Changes

- use path/posix to resolve relative paths for esmodules ([#3212](https://github.com/sveltejs/kit/pull/3212))

## 1.0.0-next.27

### Patch Changes

- Overhaul adapter API ([#2931](https://github.com/sveltejs/kit/pull/2931))
- Remove esbuild options ([#2931](https://github.com/sveltejs/kit/pull/2931))
- Update adapters to provide app.render with a url ([#3133](https://github.com/sveltejs/kit/pull/3133))

## 1.0.0-next.26

### Patch Changes

- update to esbuild 0.13.15 and other dependency updates ([#2957](https://github.com/sveltejs/kit/pull/2957))

## 1.0.0-next.25

### Patch Changes

- chore: upgrade `@cloudflare/kv-asset-handler` ([#2650](https://github.com/sveltejs/kit/pull/2650))

## 1.0.0-next.24

### Patch Changes

- update dependencies ([#2574](https://github.com/sveltejs/kit/pull/2574))

## 1.0.0-next.23

### Patch Changes

- update to vite 2.6.0 and esbuild 0.13 ([#2522](https://github.com/sveltejs/kit/pull/2522))

## 1.0.0-next.22

### Patch Changes

- chore: add links to repository and homepage to package.json ([#2425](https://github.com/sveltejs/kit/pull/2425))

## 1.0.0-next.21

### Patch Changes

- chore: export package.json from adapters ([#2351](https://github.com/sveltejs/kit/pull/2351))

## 1.0.0-next.20

### Patch Changes

- Support assigning multiple values to a header ([#2313](https://github.com/sveltejs/kit/pull/2313))

## 1.0.0-next.19

### Patch Changes

- Ensure the raw body is an Uint8Array before passing it to request handlers ([#2215](https://github.com/sveltejs/kit/pull/2215))

## 1.0.0-next.18

### Patch Changes

- d81de603: revert adapters automatically updating .gitignore ([#1924](https://github.com/sveltejs/kit/pull/1924))

## 1.0.0-next.17

### Patch Changes

- e9f78999: fix: include esbuild config in adapter type definition ([#1954](https://github.com/sveltejs/kit/pull/1954))

## 1.0.0-next.16

### Patch Changes

- e6995797: feat(adapters): expose esbuild configuration ([#1914](https://github.com/sveltejs/kit/pull/1914))

## 1.0.0-next.15

### Patch Changes

- 4720b67: Default body parsing to binary ([#1890](https://github.com/sveltejs/kit/pull/1890))

## 1.0.0-next.14

### Patch Changes

- 7faf52f: Update and consolidate checks for binary body types ([#1687](https://github.com/sveltejs/kit/pull/1687))

## 1.0.0-next.13

### Patch Changes

- 9f0c54a: Externalize app initialization to adapters ([#1804](https://github.com/sveltejs/kit/pull/1804))

## 1.0.0-next.12

### Patch Changes

- c51ab7d: Upgrade esbuild to ^0.12.5 ([#1627](https://github.com/sveltejs/kit/pull/1627))

## 1.0.0-next.11

### Patch Changes

- edc307d: Remove peerDependencies due to pnpm bug ([#1621](https://github.com/sveltejs/kit/pull/1621))
- 2636e68: Attempt to fix peerDependencies specification ([#1620](https://github.com/sveltejs/kit/pull/1620))

## 1.0.0-next.10

### Patch Changes

- 028abd9: Pass validated svelte config to adapter adapt function ([#1559](https://github.com/sveltejs/kit/pull/1559))
- Updated dependencies [6372690]
- Updated dependencies [c3d36a3]
- Updated dependencies [bf77940]
- Updated dependencies [2172469]
- Updated dependencies [028abd9]
  - @sveltejs/kit@1.0.0-next.110

## 1.0.0-next.9

### Patch Changes

- 71e293d: change toml parser to support dotted keys and other language features added after the TOML v0.4.0 spec ([#1509](https://github.com/sveltejs/kit/pull/1509))
- dca4946: Make kit a peerDependency of the adapters ([#1505](https://github.com/sveltejs/kit/pull/1505))
- Updated dependencies [261ee1c]
- Updated dependencies [ec156c6]
- Updated dependencies [586785d]
  - @sveltejs/kit@1.0.0-next.109

## 1.0.0-next.8

### Patch Changes

- dad93fc: Fix workspace dependencies ([#1434](https://github.com/sveltejs/kit/pull/1434))

## 1.0.0-next.7

### Patch Changes

- 11e7840: Ensure rawBody is a string or Uint8Array ([#1382](https://github.com/sveltejs/kit/pull/1382))

## 0.0.2-next.6

### Patch Changes

- c6fde99: Convert to ESM ([#1323](https://github.com/sveltejs/kit/pull/1323))

## 0.0.2-next.5

### Patch Changes

- 9e67505: Add es2020 target to esbuild function to solve Unexpected character '#' error ([#1287](https://github.com/sveltejs/kit/pull/1287))

## 0.0.2-next.4

### Patch Changes

- 2e72a94: Add type declarations ([#1230](https://github.com/sveltejs/kit/pull/1230))

## 0.0.2-next.3

### Patch Changes

- b372d61: Generate required package.json ([#1116](https://github.com/sveltejs/kit/pull/1116))

## 0.0.2-next.2

### Patch Changes

- 1237eb3: Pass rawBody to SvelteKit, bundle worker with esbuild ([#1109](https://github.com/sveltejs/kit/pull/1109))

## 0.0.2-next.1

### Patch Changes

- 4325b39: Aligns request/response API of cloudflare-workers adapter with others ([#946](https://github.com/sveltejs/kit/pull/946))

## 0.0.2-next.0

### Patch Changes

- e890031: Fix dev/prod deps (oops) ([#749](https://github.com/sveltejs/kit/pull/749))

####### packages/adapter-cloudflare-workers/files/entry.js #######

```

import { Server } from 'SERVER';
import { manifest, prerendered } from 'MANIFEST';
import { getAssetFromKV, mapRequestToAsset } from '@cloudflare/kv-asset-handler';
import static_asset_manifest_json from '__STATIC_CONTENT_MANIFEST';
const static_asset_manifest = JSON.parse(static_asset_manifest_json);

const server = new Server(manifest);

const app_path = `/${manifest.appPath}`;

const immutable = `${app_path}/immutable/`;
const version_file = `${app_path}/version.json`;

export default {
	/**
	 * @param {Request} req
	 * @param {any} env
	 * @param {any} context
	 */
	async fetch(req, env, context) {
		await server.init({ env });

		const url = new URL(req.url);

		// static assets
		if (url.pathname.startsWith(app_path)) {
			/** @type {Response} */
			const res = await get_asset_from_kv(req, env, context);
			if (is_error(res.status)) return res;

			const cache_control = url.pathname.startsWith(immutable)
				? 'public, immutable, max-age=31536000'
				: 'no-cache';

			return new Response(res.body, {
				headers: {
					// include original headers, minus cache-control which
					// is overridden, and etag which is no longer useful
					'cache-control': cache_control,
					'content-type': res.headers.get('content-type'),
					'x-robots-tag': 'noindex'
				}
			});
		}

		let { pathname, search } = url;
		try {
			pathname = decodeURIComponent(pathname);
		} catch {
			// ignore invalid URI
		}

		const stripped_pathname = pathname.replace(/\/$/, '');

		// prerendered pages and /static files
		let is_static_asset = false;
		const filename = stripped_pathname.substring(1);
		if (filename) {
			is_static_asset =
				manifest.assets.has(filename) || manifest.assets.has(filename + '/index.html');
		}

		let location = pathname.at(-1) === '/' ? stripped_pathname : pathname + '/';

		if (
			is_static_asset ||
			prerendered.has(pathname) ||
			pathname === version_file ||
			pathname.startsWith(immutable)
		) {
			return get_asset_from_kv(req, env, context, (request, options) => {
				if (prerendered.has(pathname)) {
					url.pathname = '/' + prerendered.get(pathname).file;
					return new Request(url.toString(), request);
				}

				return mapRequestToAsset(request, options);
			});
		} else if (location && prerendered.has(location)) {
			if (search) location += search;
			return new Response('', {
				status: 308,
				headers: {
					location
				}
			});
		}

		// dynamically-generated pages
		return await server.respond(req, {
			platform: {
				env,
				context,
				// @ts-expect-error lib.dom is interfering with workers-types
				caches,
				// @ts-expect-error req is actually a Cloudflare request not a standard request
				cf: req.cf
			},
			getClientAddress() {
				return req.headers.get('cf-connecting-ip');
			}
		});
	}
};

/**
 * @param {Request} req
 * @param {any} env
 * @param {any} context
 */
async function get_asset_from_kv(req, env, context, map = mapRequestToAsset) {
	return await getAssetFromKV(
		{
			request: req,
			waitUntil(promise) {
				return context.waitUntil(promise);
			}
		},
		{
			ASSET_NAMESPACE: env.__STATIC_CONTENT,
			ASSET_MANIFEST: static_asset_manifest,
			mapRequestToAsset: map
		}
	);
}

/**
 * @param {number} status
 * @returns {boolean}
 */
function is_error(status) {
	return status > 399;
}

```


####### packages/adapter-cloudflare-workers/files/_package.json #######

```

{
	"private": true,
	"version": "0.0.1",
	"description": "Worker site generated by SvelteKit",
	"main": "index.js",
	"dependencies": {
		"@cloudflare/kv-asset-handler": "~0.1.3"
	}
}

```


####### packages/adapter-cloudflare-workers/index.d.ts #######

```

import { Adapter } from '@sveltejs/kit';
import './ambient.js';
import { GetPlatformProxyOptions } from 'wrangler';

export default function plugin(options?: AdapterOptions): Adapter;

export interface AdapterOptions {
	config?: string;
	/**
	 * Config object passed to {@link https://developers.cloudflare.com/workers/wrangler/api/#getplatformproxy | getPlatformProxy}
	 * during development and preview.
	 */
	platformProxy?: GetPlatformProxyOptions;
}

```


####### packages/adapter-cloudflare-workers/index.js #######

```

import { existsSync, readFileSync, writeFileSync } from 'node:fs';
import { posix, dirname } from 'node:path';
import { execSync } from 'node:child_process';
import esbuild from 'esbuild';
import toml from '@iarna/toml';
import { fileURLToPath } from 'node:url';
import { getPlatformProxy } from 'wrangler';

/**
 * @typedef {{
 *   main: string;
 *   site: {
 *     bucket: string;
 *   }
 *   compatibility_flags?: string[];
 * }} WranglerConfig
 */

// list from https://developers.cloudflare.com/workers/runtime-apis/nodejs/
const compatible_node_modules = [
	'assert',
	'async_hooks',
	'buffer',
	'crypto',
	'diagnostics_channel',
	'events',
	'path',
	'process',
	'stream',
	'string_decoder',
	'util'
];

/** @type {import('./index.js').default} */
export default function ({ config = 'wrangler.toml', platformProxy = {} } = {}) {
	return {
		name: '@sveltejs/adapter-cloudflare-workers',

		async adapt(builder) {
			const { main, site, compatibility_flags } = validate_config(builder, config);

			const files = fileURLToPath(new URL('./files', import.meta.url).href);
			const tmp = builder.getBuildDirectory('cloudflare-workers-tmp');

			builder.rimraf(site.bucket);
			builder.rimraf(dirname(main));

			builder.log.info('Installing worker dependencies...');
			builder.copy(`${files}/_package.json`, `${tmp}/package.json`);

			// TODO would be cool if we could make this step unnecessary somehow
			const stdout = execSync('npm install', { cwd: tmp });
			builder.log.info(stdout.toString());

			builder.log.minor('Generating worker...');
			const relativePath = posix.relative(tmp, builder.getServerDirectory());

			builder.copy(`${files}/entry.js`, `${tmp}/entry.js`, {
				replace: {
					SERVER: `${relativePath}/index.js`,
					MANIFEST: './manifest.js'
				}
			});

			let prerendered_entries = Array.from(builder.prerendered.pages.entries());

			if (builder.config.kit.paths.base) {
				prerendered_entries = prerendered_entries.map(([path, { file }]) => [
					path,
					{ file: `${builder.config.kit.paths.base}/${file}` }
				]);
			}

			writeFileSync(
				`${tmp}/manifest.js`,
				`export const manifest = ${builder.generateManifest({
					relativePath
				})};\n\nexport const prerendered = new Map(${JSON.stringify(prerendered_entries)});\n`
			);

			const external = ['__STATIC_CONTENT_MANIFEST', 'cloudflare:*'];
			if (compatibility_flags && compatibility_flags.includes('nodejs_compat')) {
				external.push(...compatible_node_modules.map((id) => `node:${id}`));
			}

			try {
				const result = await esbuild.build({
					platform: 'browser',
					// https://github.com/cloudflare/workers-sdk/blob/a12b2786ce745f24475174bcec994ad691e65b0f/packages/wrangler/src/deployment-bundle/bundle.ts#L35-L36
					conditions: ['workerd', 'worker', 'browser'],
					sourcemap: 'linked',
					target: 'es2022',
					entryPoints: [`${tmp}/entry.js`],
					outfile: main,
					bundle: true,
					external,
					alias: Object.fromEntries(compatible_node_modules.map((id) => [id, `node:${id}`])),
					format: 'esm',
					loader: {
						'.wasm': 'copy'
					},
					logLevel: 'silent'
				});

				if (result.warnings.length > 0) {
					const formatted = await esbuild.formatMessages(result.warnings, {
						kind: 'warning',
						color: true
					});

					console.error(formatted.join('\n'));
				}
			} catch (error) {
				for (const e of error.errors) {
					for (const node of e.notes) {
						const match =
							/The package "(.+)" wasn't found on the file system but is built into node/.exec(
								node.text
							);

						if (match) {
							node.text = `Cannot use "${match[1]}" when deploying to Cloudflare.`;
						}
					}
				}

				const formatted = await esbuild.formatMessages(error.errors, {
					kind: 'error',
					color: true
				});

				console.error(formatted.join('\n'));

				throw new Error(
					`Bundling with esbuild failed with ${error.errors.length} ${
						error.errors.length === 1 ? 'error' : 'errors'
					}`
				);
			}

			builder.log.minor('Copying assets...');
			const bucket_dir = `${site.bucket}${builder.config.kit.paths.base}`;
			builder.writeClient(bucket_dir);
			builder.writePrerendered(bucket_dir);
		},

		async emulate() {
			const proxy = await getPlatformProxy(platformProxy);
			const platform = /** @type {App.Platform} */ ({
				env: proxy.env,
				context: proxy.ctx,
				caches: proxy.caches,
				cf: proxy.cf
			});

			/** @type {Record<string, any>} */
			const env = {};
			const prerender_platform = /** @type {App.Platform} */ (/** @type {unknown} */ ({ env }));

			for (const key in proxy.env) {
				Object.defineProperty(env, key, {
					get: () => {
						throw new Error(`Cannot access platform.env.${key} in a prerenderable route`);
					}
				});
			}

			return {
				platform: ({ prerender }) => {
					return prerender ? prerender_platform : platform;
				}
			};
		}
	};
}

/**
 * @param {import('@sveltejs/kit').Builder} builder
 * @param {string} config_file
 * @returns {WranglerConfig}
 */
function validate_config(builder, config_file) {
	if (existsSync(config_file)) {
		/** @type {WranglerConfig} */
		let wrangler_config;

		try {
			wrangler_config = /** @type {WranglerConfig} */ (
				toml.parse(readFileSync(config_file, 'utf-8'))
			);
		} catch (err) {
			err.message = `Error parsing ${config_file}: ${err.message}`;
			throw err;
		}

		if (!wrangler_config.site?.bucket) {
			throw new Error(
				`You must specify site.bucket in ${config_file}. Consult https://developers.cloudflare.com/workers/platform/sites/configuration`
			);
		}

		if (!wrangler_config.main) {
			throw new Error(
				`You must specify main option in ${config_file}. Consult https://github.com/sveltejs/kit/tree/main/packages/adapter-cloudflare-workers`
			);
		}

		return wrangler_config;
	}

	builder.log.error(
		'Consult https://developers.cloudflare.com/workers/platform/sites/configuration on how to setup your site'
	);

	builder.log(
		`
		Sample wrangler.toml:

		name = "<your-site-name>"
		account_id = "<your-account-id>"

		main = "./.cloudflare/worker.js"
		site.bucket = "./.cloudflare/public"

		build.command = "npm run build"

		compatibility_date = "2021-11-12"
		workers_dev = true`
			.replace(/^\t+/gm, '')
			.trim()
	);

	throw new Error(`Missing a ${config_file} file`);
}

```


####### packages/adapter-cloudflare-workers/package.json #######

```

{
	"name": "@sveltejs/adapter-cloudflare-workers",
	"version": "2.4.0",
	"description": "SvelteKit adapter that creates a Cloudflare Workers site using a function for dynamic server rendering",
	"repository": {
		"type": "git",
		"url": "https://github.com/sveltejs/kit",
		"directory": "packages/adapter-cloudflare-workers"
	},
	"license": "MIT",
	"homepage": "https://kit.svelte.dev",
	"type": "module",
	"exports": {
		".": {
			"types": "./index.d.ts",
			"import": "./index.js"
		},
		"./package.json": "./package.json"
	},
	"types": "index.d.ts",
	"files": [
		"ambient.d.ts",
		"files",
		"index.js",
		"index.d.ts"
	],
	"scripts": {
		"lint": "prettier --check .",
		"format": "pnpm lint --write",
		"check": "tsc --skipLibCheck"
	},
	"dependencies": {
		"@cloudflare/workers-types": "^4.20231121.0",
		"@iarna/toml": "^2.2.5",
		"esbuild": "^0.20.2"
	},
	"devDependencies": {
		"@cloudflare/kv-asset-handler": "^0.3.0",
		"@sveltejs/kit": "workspace:^",
		"@types/node": "^18.19.3",
		"typescript": "^5.3.3"
	},
	"peerDependencies": {
		"@sveltejs/kit": "^2.0.0",
		"wrangler": "^3.28.4"
	}
}

```


####### packages/adapter-cloudflare-workers/placeholders.d.ts #######

```

declare module 'SERVER' {
	export { Server } from '@sveltejs/kit';
}

declare module 'MANIFEST' {
	import { SSRManifest } from '@sveltejs/kit';

	export const manifest: SSRManifest;
	export const prerendered: Map<string, { file: string }>;
}

declare module '__STATIC_CONTENT_MANIFEST' {
	const json: string;
	export default json;
}

```


####### packages/adapter-cloudflare-workers/README.md #######

# adapter-cloudflare-workers

SvelteKit adapter that creates a Cloudflare Workers site using a function for dynamic server rendering.

**Requires [Wrangler v2](https://developers.cloudflare.com/workers/wrangler/get-started/).** Wrangler v1 is no longer supported.

## Docs

[Docs](https://kit.svelte.dev/docs/adapter-cloudflare-workers)

## Changelog

[The Changelog for this package is available on GitHub](https://github.com/sveltejs/kit/blob/main/packages/adapter-cloudflare-workers/CHANGELOG.md).

####### packages/adapter-cloudflare-workers/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true,
		"noImplicitAny": true,
		"target": "es2022",
		"module": "node16",
		"moduleResolution": "node16",
		"allowSyntheticDefaultImports": true,
		"baseUrl": ".",
		"paths": {
			"@sveltejs/kit": ["../kit/types/index"]
		}
	},
	"include": ["**/*.js", "placeholders.d.ts"]
}

```


####### packages/adapter-netlify/ambient.d.ts #######

```

declare module '0SERVER' {
	export { Server } from '@sveltejs/kit';
}

declare module 'MANIFEST' {
	import { SSRManifest } from '@sveltejs/kit';

	export const manifest: SSRManifest;
	export const prerendered: Set<string>;
}

```


####### packages/adapter-netlify/CHANGELOG.md #######

# @sveltejs/adapter-netlify

## 4.2.0

### Minor Changes

- chore(deps): upgrade esbuild ([#12118](https://github.com/sveltejs/kit/pull/12118))

### Patch Changes

- Updated dependencies [[`bbab296f6fcc05af6b999182798bcdedabbaa4c9`](https://github.com/sveltejs/kit/commit/bbab296f6fcc05af6b999182798bcdedabbaa4c9)]:
  - @sveltejs/kit@2.5.6

## 4.1.0

### Minor Changes

- feat: allow Node.js built-in modules when targeting edge functions ([#11675](https://github.com/sveltejs/kit/pull/11675))

### Patch Changes

- Updated dependencies [[`36dc54ac740b8b4c6a2b904a1d0aadd8923a875c`](https://github.com/sveltejs/kit/commit/36dc54ac740b8b4c6a2b904a1d0aadd8923a875c), [`5dae3676b8cc6f8ee0def57340e6a6e591bafecd`](https://github.com/sveltejs/kit/commit/5dae3676b8cc6f8ee0def57340e6a6e591bafecd), [`ada595908b5501b8f4ac30c89c0d6314f364fde3`](https://github.com/sveltejs/kit/commit/ada595908b5501b8f4ac30c89c0d6314f364fde3), [`e228f8997840b89c6248e1c5df6f3108008a06be`](https://github.com/sveltejs/kit/commit/e228f8997840b89c6248e1c5df6f3108008a06be)]:
  - @sveltejs/kit@2.4.1

## 4.0.0

### Major Changes

- breaking: update peer dependency on `@sveltejs/kit` ([#11649](https://github.com/sveltejs/kit/pull/11649))

### Minor Changes

- feat: support `read` from `$app/server` ([#11649](https://github.com/sveltejs/kit/pull/11649))

### Patch Changes

- Updated dependencies [[`288f731c8a5b20cadb9e219f9583f3f16bf8c7b8`](https://github.com/sveltejs/kit/commit/288f731c8a5b20cadb9e219f9583f3f16bf8c7b8)]:
  - @sveltejs/kit@2.4.0

## 3.0.2

### Patch Changes

- chore: upgrade esbuild to 0.19.11 ([#11632](https://github.com/sveltejs/kit/pull/11632))

## 3.0.1

### Patch Changes

- chore: update primary branch from master to main ([`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d))

- Updated dependencies [[`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d), [`16961e8cd3fa6a7f382153b1ff056bc2aae9b31b`](https://github.com/sveltejs/kit/commit/16961e8cd3fa6a7f382153b1ff056bc2aae9b31b), [`197e01f95652f511160f38b37b9da73a124ecd48`](https://github.com/sveltejs/kit/commit/197e01f95652f511160f38b37b9da73a124ecd48), [`102e4a5ae5b29624302163faf5a20c94a64a5b2c`](https://github.com/sveltejs/kit/commit/102e4a5ae5b29624302163faf5a20c94a64a5b2c), [`f8e3d8b9728c9f1ab63389342c31d7246b6f9db6`](https://github.com/sveltejs/kit/commit/f8e3d8b9728c9f1ab63389342c31d7246b6f9db6)]:
  - @sveltejs/kit@2.0.4

## 3.0.0

### Major Changes

- breaking: require SvelteKit 2 ([#11316](https://github.com/sveltejs/kit/pull/11316))

- chore: upgrade esbuild ([#11122](https://github.com/sveltejs/kit/pull/11122))

## 2.0.8

### Patch Changes

- chore: upgrade to esbuild 0.18.11 ([#10330](https://github.com/sveltejs/kit/pull/10330))

- Updated dependencies [[`23d1df702`](https://github.com/sveltejs/kit/commit/23d1df702f0fd77983040404352d8d83fd1dd8a1), [`486a971fe`](https://github.com/sveltejs/kit/commit/486a971fe7c375aae1585f1fa2505e28f86f4b8e)]:
  - @sveltejs/kit@1.22.2

## 2.0.7

### Patch Changes

- chore: update all dependencies with minor version bumps ([#9761](https://github.com/sveltejs/kit/pull/9761))

## 2.0.6

### Patch Changes

- docs: remove comment discourage direct use of adapters ([#9344](https://github.com/sveltejs/kit/pull/9344))

- Updated dependencies [[`b575287d`](https://github.com/sveltejs/kit/commit/b575287d063562868d7726f6451352aa43a63453), [`8114c658`](https://github.com/sveltejs/kit/commit/8114c658c0bc053198ff76704c002cfeb8225e2a), [`620f5605`](https://github.com/sveltejs/kit/commit/620f56058de0993e776c146db4c19fca97b9cb39), [`6a91e887`](https://github.com/sveltejs/kit/commit/6a91e887ee4c1bef8aabfafbf1ab6079113c2832), [`1c32723a`](https://github.com/sveltejs/kit/commit/1c32723a52beca0c5aa895b1114341da78d92eaf), [`0f863bbc`](https://github.com/sveltejs/kit/commit/0f863bbc957ab2ed37b04ebd839fc864b945034d), [`78b4a1bb`](https://github.com/sveltejs/kit/commit/78b4a1bb5e1ae11a894d70a0a28cc344ea0b1284), [`66b2f4ef`](https://github.com/sveltejs/kit/commit/66b2f4ef03a5dd60da2757edde4effcfdf3183cf), [`5dada256`](https://github.com/sveltejs/kit/commit/5dada256dc05674a18946f8f19db1f25ba91aeaf), [`a71b5e69`](https://github.com/sveltejs/kit/commit/a71b5e69ef37ce46e8e8590d537036cb7e267d51), [`daad7e48`](https://github.com/sveltejs/kit/commit/daad7e48b175245cbb7efd0e255263bfb52a5ee6), [`18d330b1`](https://github.com/sveltejs/kit/commit/18d330b16330d76c4b2991839c6b4462d5a4163f), [`18d7e81a`](https://github.com/sveltejs/kit/commit/18d7e81a9892e718c3cd07b2366a60f2e09561ab)]:
  - @sveltejs/kit@1.11.0

## 2.0.5

### Patch Changes

- chore: support newest version of undici ([#9005](https://github.com/sveltejs/kit/pull/9005))

- Updated dependencies [[`6cdf54d1`](https://github.com/sveltejs/kit/commit/6cdf54d1f3561348d87f35ddc8330081919eb839)]:
  - @sveltejs/kit@1.7.1

## 2.0.4

### Patch Changes

- fix: Root route data endpoint redirect when using split routes ([#9006](https://github.com/sveltejs/kit/pull/9006))

- Updated dependencies [[`74cfa8d5`](https://github.com/sveltejs/kit/commit/74cfa8d5f1f13f81759e20e90f4ff86a4f96040d), [`bfa2b6ec`](https://github.com/sveltejs/kit/commit/bfa2b6ec88a6d522d87c924d7c466c01e142e66e)]:
  - @sveltejs/kit@1.5.6

## 2.0.3

### Patch Changes

- chore: simplify functions-internal cleanup ([#8953](https://github.com/sveltejs/kit/pull/8953))

- fix: correctly compare routes when generating split functions ([#8952](https://github.com/sveltejs/kit/pull/8952))

- Updated dependencies [[`0abb8ebf`](https://github.com/sveltejs/kit/commit/0abb8ebffc6121f81c2bbfa0a0f68866d4cc1627), [`bef54f63`](https://github.com/sveltejs/kit/commit/bef54f63d2315066d30e8f1bcf471ddf2bd72c35), [`51cd6e64`](https://github.com/sveltejs/kit/commit/51cd6e643178e3a113fc2c3e8a63755bcbfe902d), [`930c8e4e`](https://github.com/sveltejs/kit/commit/930c8e4ee2e3046ed1b622777dafa23029a19fe5), [`ee8066fc`](https://github.com/sveltejs/kit/commit/ee8066fcb29ed1e7e3ab513cabb7997e38c984f2), [`49d2ec62`](https://github.com/sveltejs/kit/commit/49d2ec62e6385694f11701bf2fa411d07449344c), [`eb943565`](https://github.com/sveltejs/kit/commit/eb943565a4324dbed3da5a581924ca91a24366de)]:
  - @sveltejs/kit@1.5.3

## 2.0.2

### Patch Changes

- fix: preserve functions-internal folder so that auto-generated functions are not removed when ntl build is run ([#8899](https://github.com/sveltejs/kit/pull/8899))

- Updated dependencies [[`1960296d`](https://github.com/sveltejs/kit/commit/1960296da62fdd4ad8e8bb7286940b98fbe8db0f), [`1beb19cb`](https://github.com/sveltejs/kit/commit/1beb19cb487bd6d719048f0feedcb2fbee91a005), [`b915dfe9`](https://github.com/sveltejs/kit/commit/b915dfe9d16a930246a469c9aea8c1a84e5157ba), [`a402d50b`](https://github.com/sveltejs/kit/commit/a402d50b33eba2a937d09e635275c319061ce678)]:
  - @sveltejs/kit@1.5.1

## 2.0.1

### Patch Changes

- chore: throw helpful migration error ([#8915](https://github.com/sveltejs/kit/pull/8915))

## 2.0.0

### Major Changes

- breaking: bump `@sveltejs/kit` peer dependency ([#8740](https://github.com/sveltejs/kit/pull/8740))

### Patch Changes

- Updated dependencies [[`c7648f66`](https://github.com/sveltejs/kit/commit/c7648f6608a413e2654625cbd30f890d2148cf13), [`63613bf1`](https://github.com/sveltejs/kit/commit/63613bf194c18ce50e111585ad770fc93f9e43c7), [`d1f7655e`](https://github.com/sveltejs/kit/commit/d1f7655efdff70d91f94fe0cb0de50ed2511b5e5)]:
  - @sveltejs/kit@1.5.0

## 1.0.5

### Patch Changes

- chore: update link to docs for missing netlify.toml warning ([#8673](https://github.com/sveltejs/kit/pull/8673))

- Updated dependencies [[`24d2efe4`](https://github.com/sveltejs/kit/commit/24d2efe4e5b641b9caacf21ba77a42f812b3b120)]:
  - @sveltejs/kit@1.2.4

## 1.0.4

### Patch Changes

- docs: move adapter docs to site ([#8531](https://github.com/sveltejs/kit/pull/8531))

## 1.0.3

### Patch Changes

- fix: publish missing files ([#8532](https://github.com/sveltejs/kit/pull/8532))

## 1.0.2

### Patch Changes

- chore: remove superfluous main field from package.json ([#8519](https://github.com/sveltejs/kit/pull/8519))

- Updated dependencies [[`7e2d3405`](https://github.com/sveltejs/kit/commit/7e2d34056e99f371e22406d941b764df365a2649)]:
  - @sveltejs/kit@1.1.1

## 1.0.1

### Patch Changes

- docs: add note about inability to access file system at runtime ([#8441](https://github.com/sveltejs/kit/pull/8441))

- Updated dependencies [[`9c01c32e`](https://github.com/sveltejs/kit/commit/9c01c32ef72bbed630fadcb8283f8f8533ced5e1), [`b6ca02a6`](https://github.com/sveltejs/kit/commit/b6ca02a684dbf13a3138b552e2d2be64697f2254), [`130abe43`](https://github.com/sveltejs/kit/commit/130abe43cef2cfbaf922aa16b20cbd4332a07c15), [`c4137536`](https://github.com/sveltejs/kit/commit/c4137536f2c6572eaeec1a82ccea0852f5be6b98), [`40464efa`](https://github.com/sveltejs/kit/commit/40464efab172a17f0b637d7dadea30d77ef1ed10), [`ce028470`](https://github.com/sveltejs/kit/commit/ce0284708184198efdd30f3ff72fd579cef830b4)]:
  - @sveltejs/kit@1.0.12

## 1.0.0

### Major Changes

First major release, see below for the history of changes that lead up to this.
Starting from now all releases follow semver and changes will be listed as Major/Minor/Patch

## 1.0.0-next.88

### Patch Changes

- chore: add peerDependencies, add more specific next version ([#8141](https://github.com/sveltejs/kit/pull/8141))

## 1.0.0-next.87

### Patch Changes

- fix: revert platform change from browser to neutral ([#8122](https://github.com/sveltejs/kit/pull/8122))

## 1.0.0-next.86

### Patch Changes

- fix: set esbuild platform to neutral ([#8083](https://github.com/sveltejs/kit/pull/8083))

## 1.0.0-next.85

### Patch Changes

- update esbuild to ^0.16.3 ([#7543](https://github.com/sveltejs/kit/pull/7543))

## 1.0.0-next.84

### Patch Changes

- Add information about edge functions and `event.platform` ([#7498](https://github.com/sveltejs/kit/pull/7498))

## 1.0.0-next.83

### Patch Changes

- update dependencies ([#7355](https://github.com/sveltejs/kit/pull/7355))

## 1.0.0-next.82

### Patch Changes

- Drop CJS version of adapter-netlify ([#7401](https://github.com/sveltejs/kit/pull/7401))

## 1.0.0-next.81

### Patch Changes

- Use config.kit.paths.base prefix for static assets ([#4448](https://github.com/sveltejs/kit/pull/4448))

## 1.0.0-next.80

### Patch Changes

- Transfer server data as devalue-encoded JSON ([#7177](https://github.com/sveltejs/kit/pull/7177))

## 1.0.0-next.79

### Patch Changes

- fix: clear out build directory when running `adapter-netlify` ([#7159](https://github.com/sveltejs/kit/pull/7159))

## 1.0.0-next.78

### Patch Changes

- chore: bump esbuild ([#6829](https://github.com/sveltejs/kit/pull/6829))

## 1.0.0-next.77

### Patch Changes

- Update to esbuild 0.15 ([#6740](https://github.com/sveltejs/kit/pull/6740))
- feat: only generate ESM functions ([#6760](https://github.com/sveltejs/kit/pull/6760))

## 1.0.0-next.76

### Patch Changes

- Update adapter to only glob files ([#6492](https://github.com/sveltejs/kit/pull/6492))

## 1.0.0-next.75

### Patch Changes

- Use devalue to serialize server-only `load` return values ([#6318](https://github.com/sveltejs/kit/pull/6318))

## 1.0.0-next.74

### Patch Changes

- Don't use top-level-await, as it is not supported right now ([#6360](https://github.com/sveltejs/kit/pull/6360))

## 1.0.0-next.73

### Patch Changes

- Run `server.init()` for edge functions ([#6327](https://github.com/sveltejs/kit/pull/6327))

## 1.0.0-next.72

### Patch Changes

- feat: Moved hooks.js initialization from Server.respond into Server.init ([#6179](https://github.com/sveltejs/kit/pull/6179))

## 1.0.0-next.71

### Patch Changes

- Initialise `env` ([#5663](https://github.com/sveltejs/kit/pull/5663))

## 1.0.0-next.70

### Patch Changes

- breaking: remove writeStatic to align with Vite ([#5618](https://github.com/sveltejs/kit/pull/5618))

## 1.0.0-next.69

### Patch Changes

- Update dependencies ([#5005](https://github.com/sveltejs/kit/pull/5005))

## 1.0.0-next.68

### Patch Changes

- feat: get client IP from Context object rather than the request header ([#5473](https://github.com/sveltejs/kit/pull/5473))

## 1.0.0-next.67

### Patch Changes

- chore: upgrade TypeScript to 4.7.4 ([#5414](https://github.com/sveltejs/kit/pull/5414))

## 1.0.0-next.66

### Patch Changes

- Generate sourcemaps for server-side functions when bundling with esbuild ([#5258](https://github.com/sveltejs/kit/pull/5258))

## 1.0.0-next.65

### Patch Changes

- fix: add redirects for routes containing `__data.json` suffix ([#5180](https://github.com/sveltejs/kit/pull/5180))

## 1.0.0-next.64

### Patch Changes

- Update dependencies ([#5121](https://github.com/sveltejs/kit/pull/5121))

## 1.0.0-next.63

### Patch Changes

- Update adapter entrypoint typings to be NodeNext/ESNext-compatible ([#5111](https://github.com/sveltejs/kit/pull/5111))

## 1.0.0-next.62

### Patch Changes

- only serve `_app/immutable` with immutable cache header, not `_app/version.json` ([#5051](https://github.com/sveltejs/kit/pull/5051))

## 1.0.0-next.61

### Patch Changes

- Add types to pkg.exports ([#5045](https://github.com/sveltejs/kit/pull/5045))

## 1.0.0-next.60

### Patch Changes

- Encode binary responses as base64 ([#5048](https://github.com/sveltejs/kit/pull/5048))

## 1.0.0-next.59

### Patch Changes

- breaking: replace @sveltejs/kit/install-fetch with @sveltejs/kit/node/polyfills ([#4934](https://github.com/sveltejs/kit/pull/4934))

## 1.0.0-next.58

### Patch Changes

- docs: explain how to change node version ([#4921](https://github.com/sveltejs/kit/pull/4921))

## 1.0.0-next.57

### Patch Changes

- Copy existing `_redirects` file before appending function redirects ([#4890](https://github.com/sveltejs/kit/pull/4890))

## 1.0.0-next.56

### Patch Changes

- breaking: Remove try-catch around server.respond ([#4738](https://github.com/sveltejs/kit/pull/4738))

## 1.0.0-next.55

### Patch Changes

- Fix adapter-netlify edge functions ([#4702](https://github.com/sveltejs/kit/pull/4702))

## 1.0.0-next.54

### Patch Changes

- Ensure tmp dir is created ([#4694](https://github.com/sveltejs/kit/pull/4694))

## 1.0.0-next.53

### Patch Changes

- Ensure build directory exists before writing \_redirects ([#4676](https://github.com/sveltejs/kit/pull/4676))

## 1.0.0-next.52

### Patch Changes

- Adds support for Netlify Edge Functions ([#4657](https://github.com/sveltejs/kit/pull/4657))

## 1.0.0-next.51

### Patch Changes

- Provide getClientAddress function ([#4289](https://github.com/sveltejs/kit/pull/4289))

## 1.0.0-next.50

### Patch Changes

- breaking: replace builder.prerender() with builder.writePrerendered() and builder.prerendered ([#4192](https://github.com/sveltejs/kit/pull/4192)) ([#4229](https://github.com/sveltejs/kit/pull/4229))

## 1.0.0-next.49

### Patch Changes

- Add Netlify Functions context as `event.platform.context` ([#4145](https://github.com/sveltejs/kit/pull/4145))

## 1.0.0-next.48

### Patch Changes

- Rename `__fetch_polyfill` to `installFetch` ([#4111](https://github.com/sveltejs/kit/pull/4111))

## 1.0.0-next.47

### Patch Changes

- Fix incorrect set-cookie header handling on adapter-netlify ([#4096](https://github.com/sveltejs/kit/pull/4096))

## 1.0.0-next.46

### Patch Changes

- breaking: rename `app.render` to `server.respond` ([#4034](https://github.com/sveltejs/kit/pull/4034))

## 1.0.0-next.45

### Patch Changes

- update to Vite 2.8 and esbuild 0.14 ([#3791](https://github.com/sveltejs/kit/pull/3791))

## 1.0.0-next.44

### Patch Changes

- Fix string replacement in CJS builds ([#3546](https://github.com/sveltejs/kit/pull/3546))

## 1.0.0-next.43

### Patch Changes

- Bump version to trigger rebuild with set-cookie support ([#3529](https://github.com/sveltejs/kit/pull/3529))

## 1.0.0-next.42

### Patch Changes

- Avoid setting the body of the request when the request method is GET or HEAD ([#3459](https://github.com/sveltejs/kit/pull/3459))

## 1.0.0-next.41

### Patch Changes

- Breaking: change app.render signature to (request: Request) => Promise<Response> ([#3384](https://github.com/sveltejs/kit/pull/3384))

## 1.0.0-next.40

### Patch Changes

- Polyfill fetch before running any app code ([#3400](https://github.com/sveltejs/kit/pull/3400))

## 1.0.0-next.39

### Patch Changes

- Allow `__fetchPolyfill()` to run several times ([#3377](https://github.com/sveltejs/kit/pull/3377))

## 1.0.0-next.38

### Patch Changes

- Add immutable cache headers to generated assets ([#3222](https://github.com/sveltejs/kit/pull/3222))

## 1.0.0-next.37

### Patch Changes

- Overhaul adapter API ([#2931](https://github.com/sveltejs/kit/pull/2931))
- Update adapters to provide app.render with a url ([#3133](https://github.com/sveltejs/kit/pull/3133))
- Add experimental function splitting ([#2931](https://github.com/sveltejs/kit/pull/2931))
- Don't bundle final output ([#2931](https://github.com/sveltejs/kit/pull/2931))

## 1.0.0-next.36

### Patch Changes

- update to esbuild 0.13.15 and other dependency updates ([#2957](https://github.com/sveltejs/kit/pull/2957))

## 1.0.0-next.35

### Patch Changes

- fix: adapter-netlify: handle undefined body ([#2682](https://github.com/sveltejs/kit/pull/2682))

## 1.0.0-next.34

### Patch Changes

- fix: encode UInt8Array response bodies as base64 ([#2630](https://github.com/sveltejs/kit/pull/2630))

## 1.0.0-next.33

### Patch Changes

- update dependencies ([#2574](https://github.com/sveltejs/kit/pull/2574))

## 1.0.0-next.32

### Patch Changes

- update to vite 2.6.0 and esbuild 0.13 ([#2522](https://github.com/sveltejs/kit/pull/2522))

## 1.0.0-next.31

### Patch Changes

- chore: add links to repository and homepage to package.json ([#2425](https://github.com/sveltejs/kit/pull/2425))

## 1.0.0-next.30

### Patch Changes

- chore: export package.json from adapters ([#2351](https://github.com/sveltejs/kit/pull/2351))

## 1.0.0-next.29

### Patch Changes

- Deploy generated Netlify entrypoint to the internal functions directory. This allows it to co-exist with other Netlify functions. ([#2113](https://github.com/sveltejs/kit/pull/2113))

## 1.0.0-next.28

### Patch Changes

- Ensure the raw body is an Uint8Array before passing it to request handlers ([#2215](https://github.com/sveltejs/kit/pull/2215))

## 1.0.0-next.27

### Patch Changes

- 94b34fa6: [breaking] standardize final output dir as /build (vs /.svelte-kit) ([#2109](https://github.com/sveltejs/kit/pull/2109))

## 1.0.0-next.26

### Patch Changes

- 4cb4e749: update build output locations ([#2058](https://github.com/sveltejs/kit/pull/2058))
- d81de603: revert adapters automatically updating .gitignore ([#1924](https://github.com/sveltejs/kit/pull/1924))

## 1.0.0-next.25

### Patch Changes

- e9f78999: fix: include esbuild config in adapter type definition ([#1954](https://github.com/sveltejs/kit/pull/1954))

## 1.0.0-next.24

### Patch Changes

- e6995797: feat(adapters): expose esbuild configuration ([#1914](https://github.com/sveltejs/kit/pull/1914))

## 1.0.0-next.23

### Patch Changes

- 67ca3a39: return the correct headers ([#1913](https://github.com/sveltejs/kit/pull/1913))

## 1.0.0-next.22

### Patch Changes

- 9461178: Use multivalue headers to set multiple cookies ([#1906](https://github.com/sveltejs/kit/pull/1906))

## 1.0.0-next.21

### Patch Changes

- 4720b67: Default body parsing to binary ([#1890](https://github.com/sveltejs/kit/pull/1890))

## 1.0.0-next.20

### Patch Changes

- 7faf52f: Update and consolidate checks for binary body types ([#1687](https://github.com/sveltejs/kit/pull/1687))

## 1.0.0-next.19

### Patch Changes

- 2ac5781: Use esbuild inject API to insert shims ([#1822](https://github.com/sveltejs/kit/pull/1822))

## 1.0.0-next.18

### Patch Changes

- 9f0c54a: Externalize app initialization to adapters ([#1804](https://github.com/sveltejs/kit/pull/1804))

## 1.0.0-next.17

### Patch Changes

- c51ab7d: Upgrade esbuild to ^0.12.5 ([#1627](https://github.com/sveltejs/kit/pull/1627))

## 1.0.0-next.16

### Patch Changes

- edc307d: Remove peerDependencies due to pnpm bug ([#1621](https://github.com/sveltejs/kit/pull/1621))
- 2636e68: Attempt to fix peerDependencies specification ([#1620](https://github.com/sveltejs/kit/pull/1620))
- 3b988a4: Allow `_redirects` to be placed in root directory ([#1586](https://github.com/sveltejs/kit/pull/1586))

## 1.0.0-next.15

### Patch Changes

- 028abd9: Pass validated svelte config to adapter adapt function ([#1559](https://github.com/sveltejs/kit/pull/1559))
- Updated dependencies [6372690]
- Updated dependencies [c3d36a3]
- Updated dependencies [bf77940]
- Updated dependencies [2172469]
- Updated dependencies [028abd9]
  - @sveltejs/kit@1.0.0-next.110

## 1.0.0-next.14

### Patch Changes

- f59530f: Allow custom redirects for Netlify Adapter
- 71e293d: change toml parser to support dotted keys and other language features added after the TOML v0.4.0 spec ([#1509](https://github.com/sveltejs/kit/pull/1509))
- 1ba1784: Prevent adapter from splitting query params if they contain commas ([#1467](https://github.com/sveltejs/kit/pull/1467))
- dca4946: Make kit a peerDependency of the adapters ([#1505](https://github.com/sveltejs/kit/pull/1505))
- Updated dependencies [261ee1c]
- Updated dependencies [ec156c6]
- Updated dependencies [586785d]
  - @sveltejs/kit@1.0.0-next.109

## 1.0.0-next.13

### Patch Changes

- dad93fc: Fix workspace dependencies ([#1434](https://github.com/sveltejs/kit/pull/1434))
- Updated dependencies [dad93fc]
- Updated dependencies [37fc04f]
  - @sveltejs/kit@1.0.0-next.108

## 1.0.0-next.12

### Patch Changes

- 11e7840: Ensure rawBody is a string or Uint8Array ([#1382](https://github.com/sveltejs/kit/pull/1382))
- Updated dependencies [11e7840]
- Updated dependencies [11e7840]
- Updated dependencies [9e20873]
- Updated dependencies [2562ca0]
  - @sveltejs/kit@1.0.0-next.103

## 1.0.0-next.11

### Patch Changes

- c6fde99: Convert to ESM ([#1323](https://github.com/sveltejs/kit/pull/1323))
- Updated dependencies [694f5de]
- Updated dependencies [0befffb]
- Updated dependencies [c6fde99]
  - @sveltejs/kit@1.0.0-next.97

## 1.0.0-next.10

### Patch Changes

- 2e72a94: Add type declarations ([#1230](https://github.com/sveltejs/kit/pull/1230))
- Updated dependencies [82955ec]
  - @sveltejs/kit@1.0.0-next.91

## 1.0.0-next.9

### Patch Changes

- d3cb858: Convert body to string, unless type is octet-stream ([#1121](https://github.com/sveltejs/kit/pull/1121))
- Updated dependencies [4af45e1]
  - @sveltejs/kit@1.0.0-next.82

## 1.0.0-next.8

### Patch Changes

- 1237eb3: Fix dependencies ([#1109](https://github.com/sveltejs/kit/pull/1109))
- 1237eb3: Pass rawBody from netlify adapter ([#1109](https://github.com/sveltejs/kit/pull/1109))
- Updated dependencies [1237eb3]
- Updated dependencies [1237eb3]
  - @sveltejs/kit@1.0.0-next.81

## 1.0.0-next.7

### Patch Changes

- 0db2cf7: Fix serverless function ([#1102](https://github.com/sveltejs/kit/pull/1102))

## 1.0.0-next.6

### Patch Changes

- 7a4b351: Bundle serverless functions with esbuild ([#1091](https://github.com/sveltejs/kit/pull/1091))

## 1.0.0-next.5

### Patch Changes

- 6e27880: Move server-side fetch to adapters instead of build step ([#1066](https://github.com/sveltejs/kit/pull/1066))

## 1.0.0-next.4

### Patch Changes

- 8805c6d: Pass adapters directly to svelte.config.cjs ([#579](https://github.com/sveltejs/kit/pull/579))

## 1.0.0-next.3

### Patch Changes

- f35a5cd: Change adapter signature ([#505](https://github.com/sveltejs/kit/pull/505))

## 1.0.0-next.2

### Patch Changes

- 512b8c9: adapter-netlify: Use CJS entrypoint ([#485](https://github.com/sveltejs/kit/pull/485))

## 1.0.0-next.1

### Patch Changes

- Fix adapters and convert to ES modules

## 0.0.13

### Patch Changes

- Add svelte-kit start command

## 0.0.12

### Patch Changes

- b475ed4: Overhaul adapter API - fixes #166 ([#180](https://github.com/sveltejs/kit/pull/180))

## 0.0.11

### Patch Changes

- 67eaeea: Move app-utils stuff into subpackages

## 0.0.10

### Patch Changes

- Use setup

## 0.0.9

### Patch Changes

- 0320208: Rename 'server route' to 'endpoint'
- 5ca907c: Use shared mkdirp helper

## 0.0.8

### Patch Changes

- various

####### packages/adapter-netlify/index.d.ts #######

```

import { Adapter } from '@sveltejs/kit';
import './ambient.js';

export default function plugin(opts?: { split?: boolean; edge?: boolean }): Adapter;

```


####### packages/adapter-netlify/index.js #######

```

import { appendFileSync, existsSync, readdirSync, readFileSync, writeFileSync } from 'node:fs';
import { dirname, join, resolve, posix } from 'node:path';
import { fileURLToPath } from 'node:url';
import { builtinModules } from 'node:module';
import esbuild from 'esbuild';
import toml from '@iarna/toml';

/**
 * @typedef {{
 *   build?: { publish?: string }
 *   functions?: { node_bundler?: 'zisi' | 'esbuild' }
 * } & toml.JsonMap} NetlifyConfig
 */

/**
 * @typedef {{
 *	 functions: Array<
 *		 | {
 *				 function: string;
 *				 path: string;
 *		   }
 *		 | {
 *				 function: string;
 *				 pattern: string;
 *		   }
 *	 >;
 *	 version: 1;
 *	 }} HandlerManifest
 */

const name = '@sveltejs/adapter-netlify';
const files = fileURLToPath(new URL('./files', import.meta.url).href);

const edge_set_in_env_var =
	process.env.NETLIFY_SVELTEKIT_USE_EDGE === 'true' ||
	process.env.NETLIFY_SVELTEKIT_USE_EDGE === '1';

const FUNCTION_PREFIX = 'sveltekit-';

/** @type {import('./index.js').default} */
export default function ({ split = false, edge = edge_set_in_env_var } = {}) {
	return {
		name,

		async adapt(builder) {
			if (!builder.routes) {
				throw new Error(
					'@sveltejs/adapter-netlify >=2.x (possibly installed through @sveltejs/adapter-auto) requires @sveltejs/kit version 1.5 or higher. ' +
						'Either downgrade the adapter or upgrade @sveltejs/kit'
				);
			}

			const netlify_config = get_netlify_config();

			// "build" is the default publish directory when Netlify detects SvelteKit
			const publish = get_publish_directory(netlify_config, builder) || 'build';

			// empty out existing build directories
			builder.rimraf(publish);
			builder.rimraf('.netlify/edge-functions');
			builder.rimraf('.netlify/server');
			builder.rimraf('.netlify/package.json');
			builder.rimraf('.netlify/serverless.js');

			if (existsSync('.netlify/functions-internal')) {
				for (const file of readdirSync('.netlify/functions-internal')) {
					if (file.startsWith(FUNCTION_PREFIX)) {
						builder.rimraf(join('.netlify/functions-internal', file));
					}
				}
			}

			builder.log.minor(`Publishing to "${publish}"`);

			builder.log.minor('Copying assets...');
			const publish_dir = `${publish}${builder.config.kit.paths.base}`;
			builder.writeClient(publish_dir);
			builder.writePrerendered(publish_dir);

			builder.log.minor('Writing custom headers...');
			const headers_file = join(publish, '_headers');
			builder.copy('_headers', headers_file);
			appendFileSync(
				headers_file,
				`\n\n/${builder.getAppPath()}/immutable/*\n  cache-control: public\n  cache-control: immutable\n  cache-control: max-age=31536000\n`
			);

			if (edge) {
				if (split) {
					throw new Error('Cannot use `split: true` alongside `edge: true`');
				}

				await generate_edge_functions({ builder });
			} else {
				await generate_lambda_functions({ builder, split, publish });
			}
		},

		supports: {
			// reading from the filesystem only works in serverless functions
			read: ({ route }) => {
				if (edge) {
					throw new Error(
						`${name}: Cannot use \`read\` from \`$app/server\` in route \`${route.id}\` when using edge functions`
					);
				}

				return true;
			}
		}
	};
}
/**
 * @param { object } params
 * @param {import('@sveltejs/kit').Builder} params.builder
 */
async function generate_edge_functions({ builder }) {
	const tmp = builder.getBuildDirectory('netlify-tmp');
	builder.rimraf(tmp);
	builder.mkdirp(tmp);

	builder.mkdirp('.netlify/edge-functions');

	// Don't match the static directory
	const pattern = '^/.*$';

	// Go doesn't support lookarounds, so we can't do this
	// const pattern = appDir ? `^/(?!${escapeStringRegexp(appDir)}).*$` : '^/.*$';

	/** @type {HandlerManifest} */
	const edge_manifest = {
		functions: [
			{
				function: 'render',
				pattern
			}
		],
		version: 1
	};

	builder.log.minor('Generating Edge Function...');
	const relativePath = posix.relative(tmp, builder.getServerDirectory());

	builder.copy(`${files}/edge.js`, `${tmp}/entry.js`, {
		replace: {
			'0SERVER': `${relativePath}/index.js`,
			MANIFEST: './manifest.js'
		}
	});

	const manifest = builder.generateManifest({
		relativePath
	});

	writeFileSync(
		`${tmp}/manifest.js`,
		`export const manifest = ${manifest};\n\nexport const prerendered = new Set(${JSON.stringify(
			builder.prerendered.paths
		)});\n`
	);

	await esbuild.build({
		entryPoints: [`${tmp}/entry.js`],
		outfile: '.netlify/edge-functions/render.js',
		bundle: true,
		format: 'esm',
		platform: 'browser',
		sourcemap: 'linked',
		target: 'es2020',

		// Node built-ins are allowed, but must be prefixed with `node:`
		// https://docs.netlify.com/edge-functions/api/#runtime-environment
		external: builtinModules.map((id) => `node:${id}`),
		alias: Object.fromEntries(builtinModules.map((id) => [id, `node:${id}`]))
	});

	writeFileSync('.netlify/edge-functions/manifest.json', JSON.stringify(edge_manifest));
}
/**
 * @param { object } params
 * @param {import('@sveltejs/kit').Builder} params.builder
 * @param { string } params.publish
 * @param { boolean } params.split
 */
async function generate_lambda_functions({ builder, publish, split }) {
	builder.mkdirp('.netlify/functions-internal/.svelte-kit');

	/** @type {string[]} */
	const redirects = [];
	builder.writeServer('.netlify/server');

	const replace = {
		'0SERVER': './server/index.js' // digit prefix prevents CJS build from using this as a variable name, which would also get replaced
	};

	builder.copy(`${files}/esm`, '.netlify', { replace });

	// Configuring the function to use ESM as the output format.
	const fn_config = JSON.stringify({ config: { nodeModuleFormat: 'esm' }, version: 1 });

	builder.log.minor('Generating serverless functions...');

	if (split) {
		const seen = new Set();

		for (let i = 0; i < builder.routes.length; i++) {
			const route = builder.routes[i];
			if (route.prerender === true) continue;

			const routes = [route];

			const parts = [];
			// Netlify's syntax uses '*' and ':param' as "splats" and "placeholders"
			// https://docs.netlify.com/routing/redirects/redirect-options/#splats
			for (const segment of route.segments) {
				if (segment.rest) {
					parts.push('*');
					break; // Netlify redirects don't allow anything after a *
				} else if (segment.dynamic) {
					parts.push(`:${parts.length}`);
				} else {
					parts.push(segment.content);
				}
			}

			const pattern = `/${parts.join('/')}`;
			const name =
				FUNCTION_PREFIX + (parts.join('-').replace(/[:.]/g, '_').replace('*', '__rest') || 'index');

			// skip routes with identical patterns, they were already folded into another function
			if (seen.has(pattern)) continue;
			seen.add(pattern);

			// figure out which lower priority routes should be considered fallbacks
			for (let j = i + 1; j < builder.routes.length; j += 1) {
				const other = builder.routes[j];
				if (other.prerender === true) continue;

				if (matches(route.segments, other.segments)) {
					routes.push(other);
				}
			}

			const manifest = builder.generateManifest({
				relativePath: '../server',
				routes
			});

			const fn = `import { init } from '../serverless.js';\n\nexport const handler = init(${manifest});\n`;

			writeFileSync(`.netlify/functions-internal/${name}.mjs`, fn);
			writeFileSync(`.netlify/functions-internal/${name}.json`, fn_config);

			const redirect = `/.netlify/functions/${name} 200`;
			redirects.push(`${pattern} ${redirect}`);
			redirects.push(`${pattern === '/' ? '' : pattern}/__data.json ${redirect}`);
		}
	} else {
		const manifest = builder.generateManifest({
			relativePath: '../server'
		});

		const fn = `import { init } from '../serverless.js';\n\nexport const handler = init(${manifest});\n`;

		writeFileSync(`.netlify/functions-internal/${FUNCTION_PREFIX}render.json`, fn_config);
		writeFileSync(`.netlify/functions-internal/${FUNCTION_PREFIX}render.mjs`, fn);
		redirects.push(`* /.netlify/functions/${FUNCTION_PREFIX}render 200`);
	}

	// this should happen at the end, after builder.writeClient(...),
	// so that generated redirects are appended to custom redirects
	// rather than replaced by them
	builder.log.minor('Writing redirects...');
	const redirect_file = join(publish, '_redirects');
	if (existsSync('_redirects')) {
		builder.copy('_redirects', redirect_file);
	}
	builder.mkdirp(dirname(redirect_file));
	appendFileSync(redirect_file, `\n\n${redirects.join('\n')}`);
}

function get_netlify_config() {
	if (!existsSync('netlify.toml')) return null;

	try {
		return /** @type {NetlifyConfig} */ (toml.parse(readFileSync('netlify.toml', 'utf-8')));
	} catch (err) {
		err.message = `Error parsing netlify.toml: ${err.message}`;
		throw err;
	}
}

/**
 * @param {NetlifyConfig} netlify_config
 * @param {import('@sveltejs/kit').Builder} builder
 **/
function get_publish_directory(netlify_config, builder) {
	if (netlify_config) {
		if (!netlify_config.build?.publish) {
			builder.log.minor('No publish directory specified in netlify.toml, using default');
			return;
		}

		if (netlify_config.redirects) {
			throw new Error(
				"Redirects are not supported in netlify.toml. Use _redirects instead. For more details consult the readme's troubleshooting section."
			);
		}
		if (resolve(netlify_config.build.publish) === process.cwd()) {
			throw new Error(
				'The publish directory cannot be set to the site root. Please change it to another value such as "build" in netlify.toml.'
			);
		}
		return netlify_config.build.publish;
	}

	builder.log.warn(
		'No netlify.toml found. Using default publish directory. Consult https://kit.svelte.dev/docs/adapter-netlify#usage for more details'
	);
}

/**
 * @typedef {{ rest: boolean, dynamic: boolean, content: string }} RouteSegment
 */

/**
 * @param {RouteSegment[]} a
 * @param {RouteSegment[]} b
 * @returns {boolean}
 */
function matches(a, b) {
	if (a[0] && b[0]) {
		if (b[0].rest) {
			if (b.length === 1) return true;

			const next_b = b.slice(1);

			for (let i = 0; i < a.length; i += 1) {
				if (matches(a.slice(i), next_b)) return true;
			}

			return false;
		}

		if (!b[0].dynamic) {
			if (!a[0].dynamic && a[0].content !== b[0].content) return false;
		}

		if (a.length === 1 && b.length === 1) return true;
		return matches(a.slice(1), b.slice(1));
	} else if (a[0]) {
		return a.length === 1 && a[0].rest;
	} else {
		return b.length === 1 && b[0].rest;
	}
}

```


####### packages/adapter-netlify/package.json #######

```

{
	"name": "@sveltejs/adapter-netlify",
	"version": "4.2.0",
	"description": "A SvelteKit adapter that creates a Netlify app",
	"repository": {
		"type": "git",
		"url": "https://github.com/sveltejs/kit",
		"directory": "packages/adapter-netlify"
	},
	"license": "MIT",
	"homepage": "https://kit.svelte.dev",
	"type": "module",
	"exports": {
		".": {
			"types": "./index.d.ts",
			"import": "./index.js"
		},
		"./package.json": "./package.json"
	},
	"types": "index.d.ts",
	"files": [
		"files",
		"index.js",
		"index.d.ts"
	],
	"scripts": {
		"dev": "node -e \"fs.rmSync('files', { force: true, recursive: true })\" && rollup -cw",
		"build": "node -e \"fs.rmSync('files', { force: true, recursive: true })\" && rollup -c && cp src/edge.js files/edge.js",
		"test": "vitest run",
		"check": "tsc",
		"lint": "prettier --check .",
		"format": "pnpm lint --write",
		"prepublishOnly": "pnpm build"
	},
	"dependencies": {
		"@iarna/toml": "^2.2.5",
		"esbuild": "^0.20.2",
		"set-cookie-parser": "^2.6.0"
	},
	"devDependencies": {
		"@netlify/functions": "^2.4.1",
		"@rollup/plugin-commonjs": "^25.0.7",
		"@rollup/plugin-json": "^6.1.0",
		"@rollup/plugin-node-resolve": "^15.2.3",
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"@types/node": "^18.19.3",
		"@types/set-cookie-parser": "^2.4.7",
		"rollup": "^4.14.2",
		"typescript": "^5.3.3",
		"vitest": "^1.5.0"
	},
	"peerDependencies": {
		"@sveltejs/kit": "^2.4.0"
	}
}

```


####### packages/adapter-netlify/README.md #######

# adapter-netlify

A SvelteKit adapter that creates a Netlify app.

## Docs

[Docs](https://kit.svelte.dev/docs/adapter-netlify)

## Changelog

[The Changelog for this package is available on GitHub](https://github.com/sveltejs/kit/blob/main/packages/adapter-netlify/CHANGELOG.md).

####### packages/adapter-netlify/rollup.config.js #######

```

import { nodeResolve } from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import json from '@rollup/plugin-json';

/** @type {import('rollup').RollupOptions} */
const config = {
	input: {
		serverless: 'src/serverless.js',
		shims: 'src/shims.js'
	},
	output: {
		dir: 'files/esm',
		format: 'esm'
	},
	// @ts-ignore https://github.com/rollup/plugins/issues/1329
	plugins: [nodeResolve({ preferBuiltins: true }), commonjs(), json()],
	external: (id) => id === '0SERVER' || id.startsWith('node:'),
	preserveEntrySignatures: 'exports-only'
};

export default config;

```


####### packages/adapter-netlify/src/edge.js #######

```

import { Server } from '0SERVER';
import { manifest, prerendered } from 'MANIFEST';

const server = new Server(manifest);
const prefix = `/${manifest.appPath}/`;

const initialized = server.init({
	// @ts-ignore
	env: Deno.env.toObject()
});

/**
 * @param { Request } request
 * @param { any } context
 * @returns { Promise<Response> }
 */
export default async function handler(request, context) {
	if (is_static_file(request)) {
		// Static files can skip the handler
		// TODO can we serve _app/immutable files with an immutable cache header?
		return;
	}

	await initialized;
	return server.respond(request, {
		platform: { context },
		getClientAddress() {
			return context.ip;
		}
	});
}

/**
 * @param {Request} request
 */
function is_static_file(request) {
	const url = new URL(request.url);

	// Assets in the app dir
	if (url.pathname.startsWith(prefix)) {
		return true;
	}

	// prerendered pages and index.html files
	const pathname = url.pathname.replace(/\/$/, '');
	let file = pathname.substring(1);

	try {
		file = decodeURIComponent(file);
	} catch (err) {
		// ignore
	}

	return (
		manifest.assets.has(file) ||
		manifest.assets.has(file + '/index.html') ||
		prerendered.has(pathname || '/')
	);
}

```


####### packages/adapter-netlify/src/headers.js #######

```

import * as set_cookie_parser from 'set-cookie-parser';

/**
 * Splits headers into two categories: single value and multi value
 * @param {Headers} headers
 * @returns {{
 *   headers: Record<string, string>,
 *   multiValueHeaders: Record<string, string[]>
 * }}
 */
export function split_headers(headers) {
	/** @type {Record<string, string>} */
	const h = {};

	/** @type {Record<string, string[]>} */
	const m = {};

	headers.forEach((value, key) => {
		if (key === 'set-cookie') {
			if (!m[key]) m[key] = [];
			m[key].push(...set_cookie_parser.splitCookiesString(value));
		} else {
			h[key] = value;
		}
	});

	return {
		headers: h,
		multiValueHeaders: m
	};
}

```


####### packages/adapter-netlify/src/headers.spec.js #######

```

import { expect, test } from 'vitest';
import './shims.js';
import { split_headers } from './headers.js';

test('empty headers', () => {
	const headers = new Headers();

	const result = split_headers(headers);

	expect(result).toEqual({
		headers: {},
		multiValueHeaders: {}
	});
});

test('single-value headers', () => {
	const headers = new Headers();
	headers.append('Location', '/apple');
	headers.append('Content-Type', 'application/json');

	const result = split_headers(headers);

	expect(result).toEqual({
		headers: {
			// Note: becomes lowercase even if specified as uppercase
			location: '/apple',
			'content-type': 'application/json'
		},
		multiValueHeaders: {}
	});
});

test('multi-value headers', () => {
	// https://httpwg.org/specs/rfc7231.html#http.date
	const wednesday = 'Wed, 23 Feb 2022 21:01:48 GMT';
	const thursday = 'Thu, 24 Feb 2022 21:01:48 GMT';

	const headers = new Headers();
	headers.append('Set-Cookie', `flavor=sugar; Expires=${wednesday}`);
	headers.append('Set-Cookie', `diameter=6cm; Expires=${thursday}`);

	const result = split_headers(headers);

	// it splits at actual cookie boundaries, not the commas in the dates
	expect(result).toEqual({
		headers: {},
		multiValueHeaders: {
			'set-cookie': [`flavor=sugar; Expires=${wednesday}`, `diameter=6cm; Expires=${thursday}`]
		}
	});
});

```


####### packages/adapter-netlify/src/serverless.js #######

```

import './shims';
import { Server } from '0SERVER';
import { split_headers } from './headers.js';
import { createReadableStream } from '@sveltejs/kit/node';

/**
 * @param {import('@sveltejs/kit').SSRManifest} manifest
 * @returns {import('@netlify/functions').Handler}
 */
export function init(manifest) {
	const server = new Server(manifest);

	let init_promise = server.init({
		env: process.env,
		read: (file) => createReadableStream(`.netlify/server/${file}`)
	});

	return async (event, context) => {
		if (init_promise !== null) {
			await init_promise;
			init_promise = null;
		}

		const response = await server.respond(to_request(event), {
			platform: { context },
			getClientAddress() {
				return event.headers['x-nf-client-connection-ip'];
			}
		});

		const partial_response = {
			statusCode: response.status,
			...split_headers(response.headers)
		};

		if (!is_text(response.headers.get('content-type'))) {
			// Function responses should be strings (or undefined), and responses with binary
			// content should be base64 encoded and set isBase64Encoded to true.
			// https://github.com/netlify/functions/blob/main/src/function/response.ts
			return {
				...partial_response,
				isBase64Encoded: true,
				body: Buffer.from(await response.arrayBuffer()).toString('base64')
			};
		}

		return {
			...partial_response,
			body: await response.text()
		};
	};
}

/**
 * @param {import('@netlify/functions').HandlerEvent} event
 * @returns {Request}
 */
function to_request(event) {
	const { httpMethod, headers, rawUrl, body, isBase64Encoded } = event;

	/** @type {RequestInit} */
	const init = {
		method: httpMethod,
		headers: new Headers(headers)
	};

	if (httpMethod !== 'GET' && httpMethod !== 'HEAD') {
		const encoding = isBase64Encoded ? 'base64' : 'utf-8';
		init.body = typeof body === 'string' ? Buffer.from(body, encoding) : body;
	}

	return new Request(rawUrl, init);
}

const text_types = new Set([
	'application/xml',
	'application/json',
	'application/x-www-form-urlencoded',
	'multipart/form-data'
]);

/**
 * Decides how the body should be parsed based on its mime type
 *
 * @param {string | undefined | null} content_type The `content-type` header of a request/response.
 * @returns {boolean}
 */
function is_text(content_type) {
	if (!content_type) return true; // defaults to json
	const type = content_type.split(';')[0].toLowerCase(); // get the mime type

	return type.startsWith('text/') || type.endsWith('+xml') || text_types.has(type);
}

```


####### packages/adapter-netlify/src/shims.js #######

```

import { installPolyfills } from '@sveltejs/kit/node/polyfills';
installPolyfills();

```


####### packages/adapter-netlify/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true,
		"noImplicitAny": true,
		"target": "es2022",
		"module": "node16",
		"moduleResolution": "node16",
		// https://github.com/netlify/functions/issues/447
		"skipLibCheck": true,
		"allowSyntheticDefaultImports": true,
		"baseUrl": ".",
		"paths": {
			"@sveltejs/kit": ["../kit/types/index"]
		}
	},
	"include": ["*.js", "src/**/*.js", "ambient.d.ts"]
}

```


####### packages/adapter-node/ambient.d.ts #######

```

declare module 'ENV' {
	export function env(key: string, fallback?: any): string;
}

declare module 'HANDLER' {
	export const handler: import('polka').Middleware;
}

declare module 'MANIFEST' {
	import { SSRManifest } from '@sveltejs/kit';

	export const base: string;
	export const manifest: SSRManifest;
	export const prerendered: Set<string>;
}

declare module 'SERVER' {
	export { Server } from '@sveltejs/kit';
}

declare namespace App {
	export interface Platform {
		/**
		 * The original Node request object (https://nodejs.org/api/http.html#class-httpincomingmessage)
		 */
		req: import('http').IncomingMessage;
	}
}

```


####### packages/adapter-node/CHANGELOG.md #######

# @sveltejs/adapter-node

## 5.0.1

### Patch Changes

- fix: regression preventing built application from starting ([#11960](https://github.com/sveltejs/kit/pull/11960))

## 5.0.0

### Major Changes

- breaking: add graceful shutdown ([#11653](https://github.com/sveltejs/kit/pull/11653))

- breaking: change default value of `precompress` option to true to serve precompressed assets by default ([#11945](https://github.com/sveltejs/kit/pull/11945))

### Minor Changes

- feat: add systemd socket activation ([#11653](https://github.com/sveltejs/kit/pull/11653))

### Patch Changes

- Updated dependencies [[`873a09eac86817d1cbb53bf3f9c8842d7346d20d`](https://github.com/sveltejs/kit/commit/873a09eac86817d1cbb53bf3f9c8842d7346d20d), [`30c78f223a4f9e6c4547d087338a8b8cc477ba55`](https://github.com/sveltejs/kit/commit/30c78f223a4f9e6c4547d087338a8b8cc477ba55)]:
  - @sveltejs/kit@2.5.3

## 4.0.1

### Patch Changes

- fix: return 400 response if request construction fails ([#11713](https://github.com/sveltejs/kit/pull/11713))

- Updated dependencies [[`f56781fa47a0f958b228e4a51bb3cbf173854f12`](https://github.com/sveltejs/kit/commit/f56781fa47a0f958b228e4a51bb3cbf173854f12)]:
  - @sveltejs/kit@2.4.3

## 4.0.0

### Major Changes

- breaking: update peer dependency on `@sveltejs/kit` ([#11649](https://github.com/sveltejs/kit/pull/11649))

### Minor Changes

- feat: support `read` from `$app/server` ([#11649](https://github.com/sveltejs/kit/pull/11649))

### Patch Changes

- Updated dependencies [[`288f731c8a5b20cadb9e219f9583f3f16bf8c7b8`](https://github.com/sveltejs/kit/commit/288f731c8a5b20cadb9e219f9583f3f16bf8c7b8)]:
  - @sveltejs/kit@2.4.0

## 3.0.3

### Patch Changes

- fix: return 400 response if request construction fails

## 3.0.2

### Patch Changes

- fix: return 400 response if request construction fails

## 3.0.1

### Patch Changes

- chore: upgrade rollup to 4.9.5 ([#11632](https://github.com/sveltejs/kit/pull/11632))

## 3.0.0

### Major Changes

- breaking: allow any numeric value for `BODY_SIZE_LIMIT`, and interpret literally. Use `Infinity` rather than `0` for unrestricted body sizes ([#11589](https://github.com/sveltejs/kit/pull/11589))

## 2.1.2

### Patch Changes

- fix: return 400 response if request construction fails

## 2.1.1

### Patch Changes

- fix: correctly handle BODY_SIZE_LIMIT=0 ([#11574](https://github.com/sveltejs/kit/pull/11574))

## 2.1.0

### Minor Changes

- feat: add `PORT_HEADER` env var for reverse proxies with non-standard ports ([#11249](https://github.com/sveltejs/kit/pull/11249))

### Patch Changes

- Updated dependencies [[`9556abae4ba28c02ba468735beb9eb868876a9a1`](https://github.com/sveltejs/kit/commit/9556abae4ba28c02ba468735beb9eb868876a9a1), [`8468af597c6240f7a3687ef1ed3873990b944f8c`](https://github.com/sveltejs/kit/commit/8468af597c6240f7a3687ef1ed3873990b944f8c)]:
  - @sveltejs/kit@2.1.1

## 2.0.2

### Patch Changes

- fix: upgrade `sirv` and `mrmime` to modernize javascript mime type ([#11419](https://github.com/sveltejs/kit/pull/11419))

- Updated dependencies [[`b999cfdea24e72043505e032ed9d621590896263`](https://github.com/sveltejs/kit/commit/b999cfdea24e72043505e032ed9d621590896263), [`2a091dcbbdf7d2a70a38316638e16761bd1b9b59`](https://github.com/sveltejs/kit/commit/2a091dcbbdf7d2a70a38316638e16761bd1b9b59)]:
  - @sveltejs/kit@2.0.5

## 2.0.1

### Patch Changes

- chore: update primary branch from master to main ([`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d))

- Updated dependencies [[`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d), [`16961e8cd3fa6a7f382153b1ff056bc2aae9b31b`](https://github.com/sveltejs/kit/commit/16961e8cd3fa6a7f382153b1ff056bc2aae9b31b), [`197e01f95652f511160f38b37b9da73a124ecd48`](https://github.com/sveltejs/kit/commit/197e01f95652f511160f38b37b9da73a124ecd48), [`102e4a5ae5b29624302163faf5a20c94a64a5b2c`](https://github.com/sveltejs/kit/commit/102e4a5ae5b29624302163faf5a20c94a64a5b2c), [`f8e3d8b9728c9f1ab63389342c31d7246b6f9db6`](https://github.com/sveltejs/kit/commit/f8e3d8b9728c9f1ab63389342c31d7246b6f9db6)]:
  - @sveltejs/kit@2.0.4

## 2.0.0

### Major Changes

- breaking: require SvelteKit 2 peer dependency ([#11289](https://github.com/sveltejs/kit/pull/11289))

- breaking: remove polyfill option. fetch APIs will now always come from the platform being used. File and crypto APIs will be polyfilled if not available ([#11172](https://github.com/sveltejs/kit/pull/11172))

- chore: upgrade rollup ([#11122](https://github.com/sveltejs/kit/pull/11122))

## 1.3.1

### Patch Changes

- fix: build output stuck on top level await ([#10314](https://github.com/sveltejs/kit/pull/10314))

- Updated dependencies [[`c1ad5b2f8`](https://github.com/sveltejs/kit/commit/c1ad5b2f84762a34adb327a0e309792603b405b3), [`67a0d869b`](https://github.com/sveltejs/kit/commit/67a0d869b3221925c3f456127205a4aee0b28e85), [`4d7f38fa1`](https://github.com/sveltejs/kit/commit/4d7f38fa18c75991bca3f723cdc50d8a67036f83), [`42c9b935e`](https://github.com/sveltejs/kit/commit/42c9b935e49fbbeff7065d1b2a31986c0b814956), [`42c9b935e`](https://github.com/sveltejs/kit/commit/42c9b935e49fbbeff7065d1b2a31986c0b814956)]:
  - @sveltejs/kit@1.22.0

## 1.3.0

### Minor Changes

- chore: remove build step for adapter node ([#10041](https://github.com/sveltejs/kit/pull/10041))

- feat: load sourcemaps so that they can be merged to point to original sourcefiles ([#10041](https://github.com/sveltejs/kit/pull/10041))

### Patch Changes

- fix: do not crash server if specified `ADDRESS_HEADER` is missing from a request ([#10285](https://github.com/sveltejs/kit/pull/10285))

## 1.2.4

### Patch Changes

- chore: update all dependencies with minor version bumps ([#9761](https://github.com/sveltejs/kit/pull/9761))

## 1.2.3

### Patch Changes

- fix: only send cache header when static resource is 200 ([#9394](https://github.com/sveltejs/kit/pull/9394))

- Updated dependencies [[`385bd49e`](https://github.com/sveltejs/kit/commit/385bd49efb6890078dcdb523fdf5b621fe1c3e72), [`29ffc785`](https://github.com/sveltejs/kit/commit/29ffc78560a99ce387b10a24f48b7f01205f51e7), [`d257d37d`](https://github.com/sveltejs/kit/commit/d257d37d3cac94f30befa9fe38c2987f84fb551a), [`c45c35e7`](https://github.com/sveltejs/kit/commit/c45c35e7b40837cd1bea3fc26cfb831478e03c00), [`75e2c6f7`](https://github.com/sveltejs/kit/commit/75e2c6f7c8376685317b669767c7767fd21670eb), [`1c085780`](https://github.com/sveltejs/kit/commit/1c08578031395377a98b365a27eb9587594dd06e)]:
  - @sveltejs/kit@1.12.0

## 1.2.2

### Patch Changes

- fix: add `BODY_SIZE_LIMIT` to the list of recognized env variables ([#9326](https://github.com/sveltejs/kit/pull/9326))

- Updated dependencies [[`b575287d`](https://github.com/sveltejs/kit/commit/b575287d063562868d7726f6451352aa43a63453), [`8114c658`](https://github.com/sveltejs/kit/commit/8114c658c0bc053198ff76704c002cfeb8225e2a), [`620f5605`](https://github.com/sveltejs/kit/commit/620f56058de0993e776c146db4c19fca97b9cb39), [`6a91e887`](https://github.com/sveltejs/kit/commit/6a91e887ee4c1bef8aabfafbf1ab6079113c2832), [`1c32723a`](https://github.com/sveltejs/kit/commit/1c32723a52beca0c5aa895b1114341da78d92eaf), [`0f863bbc`](https://github.com/sveltejs/kit/commit/0f863bbc957ab2ed37b04ebd839fc864b945034d), [`78b4a1bb`](https://github.com/sveltejs/kit/commit/78b4a1bb5e1ae11a894d70a0a28cc344ea0b1284), [`66b2f4ef`](https://github.com/sveltejs/kit/commit/66b2f4ef03a5dd60da2757edde4effcfdf3183cf), [`5dada256`](https://github.com/sveltejs/kit/commit/5dada256dc05674a18946f8f19db1f25ba91aeaf), [`a71b5e69`](https://github.com/sveltejs/kit/commit/a71b5e69ef37ce46e8e8590d537036cb7e267d51), [`daad7e48`](https://github.com/sveltejs/kit/commit/daad7e48b175245cbb7efd0e255263bfb52a5ee6), [`18d330b1`](https://github.com/sveltejs/kit/commit/18d330b16330d76c4b2991839c6b4462d5a4163f), [`18d7e81a`](https://github.com/sveltejs/kit/commit/18d7e81a9892e718c3cd07b2366a60f2e09561ab)]:
  - @sveltejs/kit@1.11.0

## 1.2.1

### Patch Changes

- fix: use `node` export condition when bundling ([#9276](https://github.com/sveltejs/kit/pull/9276))

- Updated dependencies [[`1e2c8269`](https://github.com/sveltejs/kit/commit/1e2c82697d501c88c6027722ea9b106e09a0eb6d)]:
  - @sveltejs/kit@1.9.3

## 1.2.0

### Minor Changes

- add polyfill option ([#8991](https://github.com/sveltejs/kit/pull/8991))

### Patch Changes

- Updated dependencies [[`74cfa8d5`](https://github.com/sveltejs/kit/commit/74cfa8d5f1f13f81759e20e90f4ff86a4f96040d), [`bfa2b6ec`](https://github.com/sveltejs/kit/commit/bfa2b6ec88a6d522d87c924d7c466c01e142e66e)]:
  - @sveltejs/kit@1.5.6

## 1.1.8

### Patch Changes

- fix: use `strictRequires: true` when bundling output ([#8958](https://github.com/sveltejs/kit/pull/8958))

- Updated dependencies [[`0abb8ebf`](https://github.com/sveltejs/kit/commit/0abb8ebffc6121f81c2bbfa0a0f68866d4cc1627), [`bef54f63`](https://github.com/sveltejs/kit/commit/bef54f63d2315066d30e8f1bcf471ddf2bd72c35), [`51cd6e64`](https://github.com/sveltejs/kit/commit/51cd6e643178e3a113fc2c3e8a63755bcbfe902d), [`930c8e4e`](https://github.com/sveltejs/kit/commit/930c8e4ee2e3046ed1b622777dafa23029a19fe5), [`ee8066fc`](https://github.com/sveltejs/kit/commit/ee8066fcb29ed1e7e3ab513cabb7997e38c984f2), [`49d2ec62`](https://github.com/sveltejs/kit/commit/49d2ec62e6385694f11701bf2fa411d07449344c), [`eb943565`](https://github.com/sveltejs/kit/commit/eb943565a4324dbed3da5a581924ca91a24366de)]:
  - @sveltejs/kit@1.5.3

## 1.1.7

### Patch Changes

- fix: make serve_prerendered middleware work with node http server ([#8890](https://github.com/sveltejs/kit/pull/8890))

- Updated dependencies [[`c7648f66`](https://github.com/sveltejs/kit/commit/c7648f6608a413e2654625cbd30f890d2148cf13), [`63613bf1`](https://github.com/sveltejs/kit/commit/63613bf194c18ce50e111585ad770fc93f9e43c7), [`d1f7655e`](https://github.com/sveltejs/kit/commit/d1f7655efdff70d91f94fe0cb0de50ed2511b5e5)]:
  - @sveltejs/kit@1.5.0

## 1.1.6

### Patch Changes

- fix: correctly redirect trailing slashes for `adapter-node` ([#8857](https://github.com/sveltejs/kit/pull/8857))

## 1.1.5

### Patch Changes

- docs: fix link in README ([#8854](https://github.com/sveltejs/kit/pull/8854))

- Updated dependencies [[`7cdb7a65`](https://github.com/sveltejs/kit/commit/7cdb7a65819342c6d334c79defc697d531d5cbf4)]:
  - @sveltejs/kit@1.3.10

## 1.1.4

### Patch Changes

- docs: move adapter docs to site ([#8531](https://github.com/sveltejs/kit/pull/8531))

## 1.1.3

### Patch Changes

- fix: publish missing files ([#8532](https://github.com/sveltejs/kit/pull/8532))

## 1.1.2

### Patch Changes

- chore: remove superfluous main field from package.json ([#8519](https://github.com/sveltejs/kit/pull/8519))

- Updated dependencies [[`7e2d3405`](https://github.com/sveltejs/kit/commit/7e2d34056e99f371e22406d941b764df365a2649)]:
  - @sveltejs/kit@1.1.1

## 1.1.1

### Patch Changes

- docs: add info about custom cleanup before server exits ([#8455](https://github.com/sveltejs/kit/pull/8455))

- Updated dependencies [[`9c01c32e`](https://github.com/sveltejs/kit/commit/9c01c32ef72bbed630fadcb8283f8f8533ced5e1), [`b6ca02a6`](https://github.com/sveltejs/kit/commit/b6ca02a684dbf13a3138b552e2d2be64697f2254), [`130abe43`](https://github.com/sveltejs/kit/commit/130abe43cef2cfbaf922aa16b20cbd4332a07c15), [`c4137536`](https://github.com/sveltejs/kit/commit/c4137536f2c6572eaeec1a82ccea0852f5be6b98), [`40464efa`](https://github.com/sveltejs/kit/commit/40464efab172a17f0b637d7dadea30d77ef1ed10), [`ce028470`](https://github.com/sveltejs/kit/commit/ce0284708184198efdd30f3ff72fd579cef830b4)]:
  - @sveltejs/kit@1.0.12

## 1.1.0

### Minor Changes

- feat: add original request object as `event.platform.req` ([#8171](https://github.com/sveltejs/kit/pull/8171))

### Patch Changes

- Updated dependencies [[`5426901a`](https://github.com/sveltejs/kit/commit/5426901a710f5e412bd8d3bf2c78bd9df283b2a2)]:
  - @sveltejs/kit@1.0.5

## 1.0.1

### Patch Changes

- chore: update dependency @rollup/plugin-json to v6 ([#8204](https://github.com/sveltejs/kit/pull/8204))
  - Note: plugin-json v6 fails your build for parse errors that only logged a warning with v5. We consider this a bugfix as only healthy input should result in a successful build.
- chore(deps): update dependency @rollup/plugin-commonjs to v24 ([#8216](https://github.com/sveltejs/kit/pull/8216))
- Updated dependencies [[`fab0de4f`](https://github.com/sveltejs/kit/commit/fab0de4f06ac5b1e9b049e106889b193975c1c29), [`89b8d94b`](https://github.com/sveltejs/kit/commit/89b8d94b1b20d586e1ca525c30d07587c3f2d8f2)]:
  - @sveltejs/kit@1.0.2

## 1.0.0

### Major Changes

First major release, see below for the history of changes that lead up to this.
Starting from now all releases follow semver and changes will be listed as Major/Minor/Patch

## 1.0.0-next.106

### Patch Changes

- breaking: remove warnings/errors about removed/changed APIs ([#8019](https://github.com/sveltejs/kit/pull/8019))
- Updated dependencies [[`f42604a2`](https://github.com/sveltejs/kit/commit/f42604a2b4c04026d3d8bad95807720b79529539)]:
  - @sveltejs/kit@1.0.0-next.589

## 1.0.0-next.105

### Patch Changes

- chore: add peerDependencies, add more specific next version ([#8141](https://github.com/sveltejs/kit/pull/8141))

## 1.0.0-next.104

### Patch Changes

- update rollup to ^3.7.0 ([#7543](https://github.com/sveltejs/kit/pull/7543))

## 1.0.0-next.103

### Patch Changes

- Update docs with example of loading environment variables ([#8020](https://github.com/sveltejs/kit/pull/8020))

## 1.0.0-next.102

### Patch Changes

- docs: update reference to `getClientAddress()` ([#7907](https://github.com/sveltejs/kit/pull/7907))

## 1.0.0-next.101

### Patch Changes

- Update docs ([#7744](https://github.com/sveltejs/kit/pull/7744))

## 1.0.0-next.100

### Patch Changes

- update dependencies ([#7355](https://github.com/sveltejs/kit/pull/7355))

## 1.0.0-next.99

### Patch Changes

- fix: take into account deep exports for external packages ([#7311](https://github.com/sveltejs/kit/pull/7311))

## 1.0.0-next.98

### Patch Changes

- Use config.kit.paths.base prefix for static assets ([#4448](https://github.com/sveltejs/kit/pull/4448))

## 1.0.0-next.97

### Patch Changes

- chore: update dependency @rollup/plugin-json to v5 ([#7204](https://github.com/sveltejs/kit/pull/7204))

## 1.0.0-next.96

### Patch Changes

- Disable builtin modules warning ([#7031](https://github.com/sveltejs/kit/pull/7031))

## 1.0.0-next.95

### Patch Changes

- Redact error message if `getRequest` fails ([#6936](https://github.com/sveltejs/kit/pull/6936))

## 1.0.0-next.94

### Patch Changes

- Add missing Rollup dependency ([#6927](https://github.com/sveltejs/kit/pull/6927))

## 1.0.0-next.93

### Patch Changes

- Bundle with rollup instead of esbuild ([#6896](https://github.com/sveltejs/kit/pull/6896))

## 1.0.0-next.92

### Patch Changes

- chore: bump esbuild ([#6829](https://github.com/sveltejs/kit/pull/6829))

## 1.0.0-next.91

### Patch Changes

- Allow streaming when `BODY_SIZE_LIMIT` is set ([#6702](https://github.com/sveltejs/kit/pull/6702))

## 1.0.0-next.90

### Patch Changes

- Update to esbuild 0.15 ([#6740](https://github.com/sveltejs/kit/pull/6740))
- Improve performance by compressing in parallel ([#6710](https://github.com/sveltejs/kit/pull/6710))

## 1.0.0-next.89

### Patch Changes

- breaking: request creation cleanup ([#6681](https://github.com/sveltejs/kit/pull/6681))
- breaking: limit adapter-node request size ([#6684](https://github.com/sveltejs/kit/pull/6684))

## 1.0.0-next.88

### Patch Changes

- Bundle non-production dependencies with esbuild ([#6372](https://github.com/sveltejs/kit/pull/6372))

## 1.0.0-next.87

### Patch Changes

- feat: Moved hooks.js initialization from Server.respond into Server.init ([#6179](https://github.com/sveltejs/kit/pull/6179))

## 1.0.0-next.86

### Patch Changes

- Move `compress` logic to `Builder` API ([#5822](https://github.com/sveltejs/kit/pull/5822))

## 1.0.0-next.85

### Patch Changes

- Initialise `env` ([#5663](https://github.com/sveltejs/kit/pull/5663))

## 1.0.0-next.84

### Patch Changes

- Set Vite's publicDir and correctly serve public assets earlier in pipeline ([#5686](https://github.com/sveltejs/kit/pull/5686))

## 1.0.0-next.83

### Patch Changes

- set Vite's `publicDir` option ([#5648](https://github.com/sveltejs/kit/pull/5648))

## 1.0.0-next.82

### Patch Changes

- breaking: remove writeStatic to align with Vite ([#5618](https://github.com/sveltejs/kit/pull/5618))

## 1.0.0-next.81

### Patch Changes

- breaking: remove compression middleware from adapter-node output server ([#5506](https://github.com/sveltejs/kit/pull/5506))

## 1.0.0-next.80

### Patch Changes

- Update dependencies ([#5005](https://github.com/sveltejs/kit/pull/5005))

## 1.0.0-next.79

### Patch Changes

- chore: upgrade TypeScript to 4.7.4 ([#5414](https://github.com/sveltejs/kit/pull/5414))

## 1.0.0-next.78

### Patch Changes

- Update dependencies ([#5121](https://github.com/sveltejs/kit/pull/5121))

## 1.0.0-next.77

### Patch Changes

- Update adapter entrypoint typings to be NodeNext/ESNext-compatible ([#5111](https://github.com/sveltejs/kit/pull/5111))

## 1.0.0-next.76

### Patch Changes

- only serve `_app/immutable` with immutable cache header, not `_app/version.json` ([#5051](https://github.com/sveltejs/kit/pull/5051))

## 1.0.0-next.75

### Patch Changes

- Add types to pkg.exports ([#5045](https://github.com/sveltejs/kit/pull/5045))

## 1.0.0-next.74

### Patch Changes

- breaking: replace @sveltejs/kit/install-fetch with @sveltejs/kit/node/polyfills ([#4934](https://github.com/sveltejs/kit/pull/4934))

## 1.0.0-next.73

### Patch Changes

- breaking: rename `xForwardedForIndex` to `XFF_DEPTH` and make it an environment variable ([#4332](https://github.com/sveltejs/kit/pull/4332))
- breaking: Replace `options.env` with `options.envPrefix` ([#4360](https://github.com/sveltejs/kit/pull/4360))

## 1.0.0-next.72

### Patch Changes

- Provide getClientAddress function ([#4289](https://github.com/sveltejs/kit/pull/4289))

## 1.0.0-next.71

### Patch Changes

- breaking: replace builder.prerender() with builder.writePrerendered() and builder.prerendered ([#4192](https://github.com/sveltejs/kit/pull/4192)) ([#4229](https://github.com/sveltejs/kit/pull/4229))

## 1.0.0-next.70

### Patch Changes

- Rename `__fetch_polyfill` to `installFetch` ([#4111](https://github.com/sveltejs/kit/pull/4111))

## 1.0.0-next.69

### Patch Changes

- breaking: rename `app.render` to `server.respond` ([#4034](https://github.com/sveltejs/kit/pull/4034))

## 1.0.0-next.68

### Patch Changes

- `precompress` option also compress wasm files ([#3812](https://github.com/sveltejs/kit/pull/3812))

## 1.0.0-next.67

### Patch Changes

- Bump version to trigger rebuild with set-cookie support ([#3529](https://github.com/sveltejs/kit/pull/3529))

## 1.0.0-next.66

### Patch Changes

- fix usage of `ORIGIN` environment variable ([#3448](https://github.com/sveltejs/kit/pull/3448))

## 1.0.0-next.65

### Patch Changes

- fix: rename `BASE` to `ORIGIN` and fix config handling ([#3423](https://github.com/sveltejs/kit/pull/3423))

## 1.0.0-next.64

### Patch Changes

- breaking: change app.render signature to (request: Request) => Promise<Response> ([#3384](https://github.com/sveltejs/kit/pull/3384))
- breaking: Remove protocol/host configuration options from Kit to adapter-node ([#3384](https://github.com/sveltejs/kit/pull/3384))

## 1.0.0-next.63

### Patch Changes

- Polyfill fetch before running any app code ([#3400](https://github.com/sveltejs/kit/pull/3400))

## 1.0.0-next.62

### Patch Changes

- Allow `__fetchPolyfill()` to run several times ([#3377](https://github.com/sveltejs/kit/pull/3377))

## 1.0.0-next.61

### Patch Changes

- chore: update dependency sirv to v2 ([#3263](https://github.com/sveltejs/kit/pull/3263))

## 1.0.0-next.60

### Patch Changes

- Don't cache non-hashed static assets in adapter-node ([#3193](https://github.com/sveltejs/kit/pull/3193))
- Only set cache-control: immutable when appropriate ([#3196](https://github.com/sveltejs/kit/pull/3196))

## 1.0.0-next.59

### Patch Changes

- Fix types ([#3181](https://github.com/sveltejs/kit/pull/3181))
- Check if directory exists, before compressing ([#3179](https://github.com/sveltejs/kit/pull/3179))

## 1.0.0-next.58

### Patch Changes

- fix: only add handlers for directories that exist ([#3148](https://github.com/sveltejs/kit/pull/3148))

## 1.0.0-next.57

### Patch Changes

- Overhaul adapter API ([#2931](https://github.com/sveltejs/kit/pull/2931))
- Update adapters to provide app.render with a url ([#3133](https://github.com/sveltejs/kit/pull/3133))
- Don't bundle final output ([#2931](https://github.com/sveltejs/kit/pull/2931))

## 1.0.0-next.56

### Patch Changes

- update to esbuild 0.13.15 and other dependency updates ([#2957](https://github.com/sveltejs/kit/pull/2957))

## 1.0.0-next.55

### Patch Changes

- breaking: drop Node 12 support ([#2604](https://github.com/sveltejs/kit/pull/2604))

## 1.0.0-next.54

### Patch Changes

- update dependencies ([#2574](https://github.com/sveltejs/kit/pull/2574))

## 1.0.0-next.53

### Patch Changes

- Don't crash when receiving malformed URLs ([#2533](https://github.com/sveltejs/kit/pull/2533))

## 1.0.0-next.52

### Patch Changes

- update to vite 2.6.0 and esbuild 0.13 ([#2522](https://github.com/sveltejs/kit/pull/2522))

## 1.0.0-next.51

### Patch Changes

- fix: regression where builds not using `entryPoint` stopped having `middlewares.js` external ([#2484](https://github.com/sveltejs/kit/pull/2484))

## 1.0.0-next.50

### Patch Changes

- fix: Correctly treat `middlewares.js` as external when using `entryPoint` option ([#2482](https://github.com/sveltejs/kit/pull/2482))

## 1.0.0-next.49

### Patch Changes

- update dependencies ([#2447](https://github.com/sveltejs/kit/pull/2447))

## 1.0.0-next.48

### Patch Changes

- chore: add links to repository and homepage to package.json ([#2425](https://github.com/sveltejs/kit/pull/2425))

## 1.0.0-next.47

### Patch Changes

- feat: add entryPoint option for custom servers ([#2414](https://github.com/sveltejs/kit/pull/2414))

## 1.0.0-next.46

### Patch Changes

- Clear output directory before adapting ([#2388](https://github.com/sveltejs/kit/pull/2388))

## 1.0.0-next.45

### Patch Changes

- chore: export package.json from adapters ([#2351](https://github.com/sveltejs/kit/pull/2351))

## 1.0.0-next.44

### Patch Changes

- feat: expose handler to allow use in custom server

## 1.0.0-next.43

### Patch Changes

- fix: provide default port only if path not provided ([#2244](https://github.com/sveltejs/kit/pull/2244))

## 1.0.0-next.42

### Patch Changes

- fix: bump polka and sirv again to address unicode handling bug

## 1.0.0-next.41

### Patch Changes

- fix: upgrade polka and sirv. fixes handling of URLs with unicode characters ([#2191](https://github.com/sveltejs/kit/pull/2191))

## 1.0.0-next.40

### Patch Changes

- fix: handle paths consistently between dev and various production adapters ([#2171](https://github.com/sveltejs/kit/pull/2171))

* [feat] allow node adapter to configure listen path ([#2048](https://github.com/sveltejs/kit/pull/2048))

## 1.0.0-next.39

### Patch Changes

- 94b34fa6: [breaking] standardize final output dir as /build (vs /.svelte-kit) ([#2109](https://github.com/sveltejs/kit/pull/2109))

## 1.0.0-next.38

### Patch Changes

- a12beb04: [fix] update broken file path ([#2096](https://github.com/sveltejs/kit/pull/2096))

## 1.0.0-next.37

### Patch Changes

- b3e7c8b3: [chore] update build output location ([#2082](https://github.com/sveltejs/kit/pull/2082))

## 1.0.0-next.36

### Patch Changes

- d81de603: revert adapters automatically updating .gitignore ([#1924](https://github.com/sveltejs/kit/pull/1924))

## 1.0.0-next.35

### Patch Changes

- e9f78999: fix: include esbuild config in adapter type definition ([#1954](https://github.com/sveltejs/kit/pull/1954))

## 1.0.0-next.34

### Patch Changes

- e6995797: feat(adapters): expose esbuild configuration ([#1914](https://github.com/sveltejs/kit/pull/1914))

## 1.0.0-next.33

### Patch Changes

- 463199c: Handle Uint8Array bodies from endpoints ([#1875](https://github.com/sveltejs/kit/pull/1875))
- 0db0889: log both host and port ([#1877](https://github.com/sveltejs/kit/pull/1877))

## 1.0.0-next.32

### Patch Changes

- 2ac5781: Use esbuild inject API to insert shims ([#1822](https://github.com/sveltejs/kit/pull/1822))

## 1.0.0-next.31

### Patch Changes

- c639586: Check if '[out]/prerendered' exists, before precompressing ([#1806](https://github.com/sveltejs/kit/pull/1806))

## 1.0.0-next.30

### Patch Changes

- 9f0c54a: Externalize app initialization to adapters ([#1804](https://github.com/sveltejs/kit/pull/1804))

## 1.0.0-next.29

### Patch Changes

- aa5cf15: Fix regression caused by writing `env.js` to the wrong path ([#1756](https://github.com/sveltejs/kit/pull/1756))

## 1.0.0-next.28

### Patch Changes

- 1c8bdba: Allow the environment variables containing the host and port to serve on to be customised ([#1754](https://github.com/sveltejs/kit/pull/1754))

## 1.0.0-next.27

### Patch Changes

- 926481f: precompress assets and prerendered pages (html,js,json,css,svg,xml) ([#1693](https://github.com/sveltejs/kit/pull/1693))
- 318cdd7: Only cache files in config.kit.appDir ([#1416](https://github.com/sveltejs/kit/pull/1416))

## 1.0.0-next.26

### Patch Changes

- 9a7195b: Allow sirv to looks for precompiled gzip and brotli files by default ([#1672](https://github.com/sveltejs/kit/pull/1672))
- 53f3322: Fix build when using TypeScript and there is a `tsconfig.json` with `target: 'es2019'` or earlier ([#1675](https://github.com/sveltejs/kit/pull/1675))

## 1.0.0-next.25

### Patch Changes

- 0b780a6: Bundle server-side app during adapt phase ([#1648](https://github.com/sveltejs/kit/pull/1648))

## 1.0.0-next.24

### Patch Changes

- edc307d: Remove peerDependencies due to pnpm bug ([#1621](https://github.com/sveltejs/kit/pull/1621))
- 2636e68: Attempt to fix peerDependencies specification ([#1620](https://github.com/sveltejs/kit/pull/1620))

## 1.0.0-next.23

### Patch Changes

- c3d36a3: ensure `content-length` limit respected; handle `getRawBody` error(s) ([#1528](https://github.com/sveltejs/kit/pull/1528))
- bf77940: bump `polka` and `sirv` dependency versions ([#1548](https://github.com/sveltejs/kit/pull/1548))
- 028abd9: Pass validated svelte config to adapter adapt function ([#1559](https://github.com/sveltejs/kit/pull/1559))
- Updated dependencies [6372690]
- Updated dependencies [c3d36a3]
- Updated dependencies [bf77940]
- Updated dependencies [2172469]
- Updated dependencies [028abd9]
  - @sveltejs/kit@1.0.0-next.110

## 1.0.0-next.22

### Patch Changes

- dca4946: Make kit a peerDependency of the adapters ([#1505](https://github.com/sveltejs/kit/pull/1505))
- Updated dependencies [261ee1c]
- Updated dependencies [ec156c6]
- Updated dependencies [586785d]
  - @sveltejs/kit@1.0.0-next.109

## 1.0.0-next.21

### Patch Changes

- dad93fc: Fix workspace dependencies ([#1434](https://github.com/sveltejs/kit/pull/1434))

## 1.0.0-next.20

### Patch Changes

- 9b448a6: Rename @sveltejs/kit/http to @sveltejs/kit/node ([#1391](https://github.com/sveltejs/kit/pull/1391))

## 1.0.0-next.19

### Patch Changes

- 0e09581: Make host configurable via process.env.HOST ([#1366](https://github.com/sveltejs/kit/pull/1366))

## 1.0.0-next.18

### Patch Changes

- c6fde99: Convert to ESM ([#1323](https://github.com/sveltejs/kit/pull/1323))

## 1.0.0-next.17

### Patch Changes

- 2e72a94: Add type declarations ([#1230](https://github.com/sveltejs/kit/pull/1230))

## 1.0.0-next.16

### Patch Changes

- 1237eb3: Use getRawBody ([#1109](https://github.com/sveltejs/kit/pull/1109))

## 1.0.0-next.15

### Patch Changes

- 7a4b351: Use install-fetch helper ([#1091](https://github.com/sveltejs/kit/pull/1091))

## 1.0.0-next.14

### Patch Changes

- 8e61e84: Include missing entrypoint ([#1071](https://github.com/sveltejs/kit/pull/1071))

## 1.0.0-next.13

### Patch Changes

- 6e27880: Move server-side fetch to adapters instead of build step ([#1066](https://github.com/sveltejs/kit/pull/1066))

## 1.0.0-next.12

### Patch Changes

- feb2db7: Fix fatal error when trying to parse URLs of incoming requests ([#802](https://github.com/sveltejs/kit/pull/802))

## 1.0.0-next.11

### Patch Changes

- ca33a35: Fix adapter-vercel query parsing and update adapter-node's ([#774](https://github.com/sveltejs/kit/pull/774))

## 1.0.0-next.10

### Patch Changes

- 8024178: remove @sveltejs/app-utils ([#600](https://github.com/sveltejs/kit/pull/600))

## 1.0.0-next.9

### Patch Changes

- 8805c6d: Pass adapters directly to svelte.config.cjs ([#579](https://github.com/sveltejs/kit/pull/579))

## 1.0.0-next.8

### Patch Changes

- 9212aa5: Add options to adapter-node, and add adapter types ([#531](https://github.com/sveltejs/kit/pull/531))

## 1.0.0-next.7

### Patch Changes

- f35a5cd: Change adapter signature ([#505](https://github.com/sveltejs/kit/pull/505))

## 1.0.0-next.6

### Patch Changes

- c3cf3f3: Bump deps ([#492](https://github.com/sveltejs/kit/pull/492))

## 1.0.0-next.5

### Patch Changes

- 222fe9d: Compress adapter-node responses ([#367](https://github.com/sveltejs/kit/pull/367))

## 1.0.0-next.4

### Patch Changes

- Make adapter node work under esm

## 1.0.0-next.3

### Patch Changes

- ab2367d: Convert to ESM ([#387](https://github.com/sveltejs/kit/pull/387))

## 1.0.0-next.2

### Patch Changes

- Fix adapters and convert to ES modules

## 1.0.0-next.1

### Patch Changes

- 13e8fa3: Make adapter-node work

## 0.0.18

### Patch Changes

- b3ac507: Add missing pkg.files

## 0.0.17

### Patch Changes

- Add svelte-kit start command

## 0.0.16

### Patch Changes

- Make paths and target configurable

## 0.0.15

### Patch Changes

- b475ed4: Overhaul adapter API - fixes #166 ([#180](https://github.com/sveltejs/kit/pull/180))
- Updated dependencies [b475ed4]
  - @sveltejs/app-utils@0.0.18

## 0.0.14

### Patch Changes

- Updated dependencies [3bdf33b]
  - @sveltejs/app-utils@0.0.17

## 0.0.13

### Patch Changes

- 67eaeea: Move app-utils stuff into subpackages
- Updated dependencies [67eaeea]
  - @sveltejs/app-utils@0.0.16

## 0.0.12

### Patch Changes

- a163000: Parse body on incoming requests
- Updated dependencies [a163000]
  - @sveltejs/app-utils@0.0.15

## 0.0.11

### Patch Changes

- Use setup module
- Updated dependencies [undefined]
- Updated dependencies [undefined]
- Updated dependencies [undefined]
  - @sveltejs/app-utils@0.0.14

## 0.0.10

### Patch Changes

- Updated dependencies [undefined]
- Updated dependencies [96c06d8]
  - @sveltejs/app-utils@0.0.13

## 0.0.9

### Patch Changes

- 0320208: Rename 'server route' to 'endpoint'
- 026acd2: Accommodate missing build/prerendered directory
- 8b63057: Let sirv add must-revalidate
- Updated dependencies [0320208]
- Updated dependencies [5ca907c]
  - @sveltejs/app-utils@0.0.12

## 0.0.8

### Patch Changes

- Updated dependencies [undefined]
  - @sveltejs/app-utils@0.0.11

## 0.0.7

### Patch Changes

- 19323e9: Fix prerendering
- Updated dependencies [19323e9]
  - @sveltejs/app-utils@0.0.10

## 0.0.6

### Patch Changes

- Updated dependencies [90a98ae]
  - @sveltejs/app-utils@0.0.9

## 0.0.5

### Patch Changes

- Updated dependencies [undefined]
  - @sveltejs/app-utils@0.0.8

## 0.0.4

### Patch Changes

- various
- Updated dependencies [undefined]
  - @sveltejs/app-utils@0.0.7

####### packages/adapter-node/index.d.ts #######

```

import { Adapter } from '@sveltejs/kit';
import './ambient.js';

declare global {
	const ENV_PREFIX: string;
}

interface AdapterOptions {
	out?: string;
	precompress?: boolean;
	envPrefix?: string;
}

export default function plugin(options?: AdapterOptions): Adapter;

```


####### packages/adapter-node/index.js #######

```

import { readFileSync, writeFileSync } from 'node:fs';
import { fileURLToPath } from 'node:url';
import { rollup } from 'rollup';
import { nodeResolve } from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import json from '@rollup/plugin-json';

const files = fileURLToPath(new URL('./files', import.meta.url).href);

/** @type {import('./index.js').default} */
export default function (opts = {}) {
	const { out = 'build', precompress = true, envPrefix = '' } = opts;

	return {
		name: '@sveltejs/adapter-node',

		async adapt(builder) {
			const tmp = builder.getBuildDirectory('adapter-node');

			builder.rimraf(out);
			builder.rimraf(tmp);
			builder.mkdirp(tmp);

			builder.log.minor('Copying assets');
			builder.writeClient(`${out}/client${builder.config.kit.paths.base}`);
			builder.writePrerendered(`${out}/prerendered${builder.config.kit.paths.base}`);

			if (precompress) {
				builder.log.minor('Compressing assets');
				await Promise.all([
					builder.compress(`${out}/client`),
					builder.compress(`${out}/prerendered`)
				]);
			}

			builder.log.minor('Building server');

			builder.writeServer(tmp);

			writeFileSync(
				`${tmp}/manifest.js`,
				[
					`export const manifest = ${builder.generateManifest({ relativePath: './' })};`,
					`export const prerendered = new Set(${JSON.stringify(builder.prerendered.paths)});`,
					`export const base = ${JSON.stringify(builder.config.kit.paths.base)};`
				].join('\n\n')
			);

			const pkg = JSON.parse(readFileSync('package.json', 'utf8'));

			// we bundle the Vite output so that deployments only need
			// their production dependencies. Anything in devDependencies
			// will get included in the bundled code
			const bundle = await rollup({
				input: {
					index: `${tmp}/index.js`,
					manifest: `${tmp}/manifest.js`
				},
				external: [
					// dependencies could have deep exports, so we need a regex
					...Object.keys(pkg.dependencies || {}).map((d) => new RegExp(`^${d}(\\/.*)?$`))
				],
				plugins: [
					nodeResolve({
						preferBuiltins: true,
						exportConditions: ['node']
					}),
					// @ts-ignore https://github.com/rollup/plugins/issues/1329
					commonjs({ strictRequires: true }),
					// @ts-ignore https://github.com/rollup/plugins/issues/1329
					json()
				]
			});

			await bundle.write({
				dir: `${out}/server`,
				format: 'esm',
				sourcemap: true,
				chunkFileNames: 'chunks/[name]-[hash].js'
			});

			builder.copy(files, out, {
				replace: {
					ENV: './env.js',
					HANDLER: './handler.js',
					MANIFEST: './server/manifest.js',
					SERVER: './server/index.js',
					SHIMS: './shims.js',
					ENV_PREFIX: JSON.stringify(envPrefix)
				}
			});
		},

		supports: {
			read: () => true
		}
	};
}

```


####### packages/adapter-node/LICENSE #######

```

Copyright (c) 2020 [these people](https://github.com/sveltejs/kit/graphs/contributors)

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
```


####### packages/adapter-node/package.json #######

```

{
	"name": "@sveltejs/adapter-node",
	"version": "5.0.1",
	"description": "Adapter for SvelteKit apps that generates a standalone Node server",
	"repository": {
		"type": "git",
		"url": "https://github.com/sveltejs/kit",
		"directory": "packages/adapter-node"
	},
	"license": "MIT",
	"homepage": "https://kit.svelte.dev",
	"type": "module",
	"exports": {
		".": {
			"types": "./index.d.ts",
			"import": "./index.js"
		},
		"./package.json": "./package.json"
	},
	"types": "index.d.ts",
	"files": [
		"files",
		"index.js",
		"index.d.ts"
	],
	"scripts": {
		"dev": "node -e \"fs.rmSync('files', { force: true, recursive: true })\" && rollup -cw",
		"build": "node -e \"fs.rmSync('files', { force: true, recursive: true })\" && rollup -c",
		"test": "echo \"tests temporarily disabled\" # c8 vitest run",
		"check": "tsc",
		"lint": "prettier --check .",
		"format": "pnpm lint --write",
		"prepublishOnly": "pnpm build"
	},
	"devDependencies": {
		"@polka/url": "1.0.0-next.25",
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"@types/node": "^18.19.3",
		"c8": "^9.0.0",
		"polka": "1.0.0-next.25",
		"sirv": "^2.0.4",
		"typescript": "^5.3.3",
		"vitest": "^1.5.0"
	},
	"dependencies": {
		"@rollup/plugin-commonjs": "^25.0.7",
		"@rollup/plugin-json": "^6.1.0",
		"@rollup/plugin-node-resolve": "^15.2.3",
		"rollup": "^4.9.5"
	},
	"peerDependencies": {
		"@sveltejs/kit": "^2.4.0"
	}
}

```


####### packages/adapter-node/README.md #######

# @sveltejs/adapter-node

[Adapter](https://kit.svelte.dev/docs/adapters) for SvelteKit apps that generates a standalone Node server.

## Docs

[Docs](https://kit.svelte.dev/docs/adapter-node)

## Changelog

[The Changelog for this package is available on GitHub](https://github.com/sveltejs/kit/blob/main/packages/adapter-node/CHANGELOG.md).

## License

[MIT](LICENSE)

####### packages/adapter-node/rollup.config.js #######

```

import { nodeResolve } from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import json from '@rollup/plugin-json';
import { builtinModules } from 'node:module';

export default [
	{
		input: 'src/index.js',
		output: {
			file: 'files/index.js',
			format: 'esm'
		},
		plugins: [nodeResolve({ preferBuiltins: true }), commonjs(), json()],
		external: ['ENV', 'HANDLER', ...builtinModules]
	},
	{
		input: 'src/env.js',
		output: {
			file: 'files/env.js',
			format: 'esm'
		},
		plugins: [nodeResolve(), commonjs(), json()],
		external: ['HANDLER', ...builtinModules]
	},
	{
		input: 'src/handler.js',
		output: {
			file: 'files/handler.js',
			format: 'esm',
			inlineDynamicImports: true
		},
		plugins: [nodeResolve(), commonjs(), json()],
		external: ['ENV', 'MANIFEST', 'SERVER', 'SHIMS', ...builtinModules]
	},
	{
		input: 'src/shims.js',
		output: {
			file: 'files/shims.js',
			format: 'esm'
		},
		plugins: [nodeResolve(), commonjs()],
		external: builtinModules
	}
];

```


####### packages/adapter-node/src/env.js #######

```

/* global ENV_PREFIX */

const expected = new Set([
	'SOCKET_PATH',
	'HOST',
	'PORT',
	'ORIGIN',
	'XFF_DEPTH',
	'ADDRESS_HEADER',
	'PROTOCOL_HEADER',
	'HOST_HEADER',
	'PORT_HEADER',
	'BODY_SIZE_LIMIT',
	'SHUTDOWN_TIMEOUT',
	'IDLE_TIMEOUT'
]);

const expected_unprefixed = new Set(['LISTEN_PID', 'LISTEN_FDS']);

if (ENV_PREFIX) {
	for (const name in process.env) {
		if (name.startsWith(ENV_PREFIX)) {
			const unprefixed = name.slice(ENV_PREFIX.length);
			if (!expected.has(unprefixed)) {
				throw new Error(
					`You should change envPrefix (${ENV_PREFIX}) to avoid conflicts with existing environment variables — unexpectedly saw ${name}`
				);
			}
		}
	}
}

/**
 * @param {string} name
 * @param {any} fallback
 */
export function env(name, fallback) {
	const prefix = expected_unprefixed.has(name) ? '' : ENV_PREFIX;
	const prefixed = prefix + name;
	return prefixed in process.env ? process.env[prefixed] : fallback;
}

```


####### packages/adapter-node/src/handler.js #######

```

import 'SHIMS';
import fs from 'node:fs';
import path from 'node:path';
import sirv from 'sirv';
import { fileURLToPath } from 'node:url';
import { parse as polka_url_parser } from '@polka/url';
import { getRequest, setResponse, createReadableStream } from '@sveltejs/kit/node';
import { Server } from 'SERVER';
import { manifest, prerendered, base } from 'MANIFEST';
import { env } from 'ENV';

/* global ENV_PREFIX */

const server = new Server(manifest);

const origin = env('ORIGIN', undefined);
const xff_depth = parseInt(env('XFF_DEPTH', '1'));
const address_header = env('ADDRESS_HEADER', '').toLowerCase();
const protocol_header = env('PROTOCOL_HEADER', '').toLowerCase();
const host_header = env('HOST_HEADER', 'host').toLowerCase();
const port_header = env('PORT_HEADER', '').toLowerCase();
const body_size_limit = Number(env('BODY_SIZE_LIMIT', '524288'));

if (isNaN(body_size_limit)) {
	throw new Error(
		`Invalid BODY_SIZE_LIMIT: '${env('BODY_SIZE_LIMIT')}'. Please provide a numeric value.`
	);
}

const dir = path.dirname(fileURLToPath(import.meta.url));

const asset_dir = `${dir}/client${base}`;

await server.init({
	env: process.env,
	read: (file) => createReadableStream(`${asset_dir}/${file}`)
});

/**
 * @param {string} path
 * @param {boolean} client
 */
function serve(path, client = false) {
	return (
		fs.existsSync(path) &&
		sirv(path, {
			etag: true,
			gzip: true,
			brotli: true,
			setHeaders:
				client &&
				((res, pathname) => {
					// only apply to build directory, not e.g. version.json
					if (pathname.startsWith(`/${manifest.appPath}/immutable/`) && res.statusCode === 200) {
						res.setHeader('cache-control', 'public,max-age=31536000,immutable');
					}
				})
		})
	);
}

// required because the static file server ignores trailing slashes
/** @returns {import('polka').Middleware} */
function serve_prerendered() {
	const handler = serve(path.join(dir, 'prerendered'));

	return (req, res, next) => {
		let { pathname, search, query } = polka_url_parser(req);

		try {
			pathname = decodeURIComponent(pathname);
		} catch {
			// ignore invalid URI
		}

		if (prerendered.has(pathname)) {
			return handler(req, res, next);
		}

		// remove or add trailing slash as appropriate
		let location = pathname.at(-1) === '/' ? pathname.slice(0, -1) : pathname + '/';
		if (prerendered.has(location)) {
			if (query) location += search;
			res.writeHead(308, { location }).end();
		} else {
			next();
		}
	};
}

/** @type {import('polka').Middleware} */
const ssr = async (req, res) => {
	/** @type {Request} */
	let request;

	try {
		request = await getRequest({
			base: origin || get_origin(req.headers),
			request: req,
			bodySizeLimit: body_size_limit
		});
	} catch {
		res.statusCode = 400;
		res.end('Bad Request');
		return;
	}

	setResponse(
		res,
		await server.respond(request, {
			platform: { req },
			getClientAddress: () => {
				if (address_header) {
					if (!(address_header in req.headers)) {
						throw new Error(
							`Address header was specified with ${
								ENV_PREFIX + 'ADDRESS_HEADER'
							}=${address_header} but is absent from request`
						);
					}

					const value = /** @type {string} */ (req.headers[address_header]) || '';

					if (address_header === 'x-forwarded-for') {
						const addresses = value.split(',');

						if (xff_depth < 1) {
							throw new Error(`${ENV_PREFIX + 'XFF_DEPTH'} must be a positive integer`);
						}

						if (xff_depth > addresses.length) {
							throw new Error(
								`${ENV_PREFIX + 'XFF_DEPTH'} is ${xff_depth}, but only found ${
									addresses.length
								} addresses`
							);
						}
						return addresses[addresses.length - xff_depth].trim();
					}

					return value;
				}

				return (
					req.connection?.remoteAddress ||
					// @ts-expect-error
					req.connection?.socket?.remoteAddress ||
					req.socket?.remoteAddress ||
					// @ts-expect-error
					req.info?.remoteAddress
				);
			}
		})
	);
};

/** @param {import('polka').Middleware[]} handlers */
function sequence(handlers) {
	/** @type {import('polka').Middleware} */
	return (req, res, next) => {
		/**
		 * @param {number} i
		 * @returns {ReturnType<import('polka').Middleware>}
		 */
		function handle(i) {
			if (i < handlers.length) {
				return handlers[i](req, res, () => handle(i + 1));
			} else {
				return next();
			}
		}

		return handle(0);
	};
}

/**
 * @param {import('http').IncomingHttpHeaders} headers
 * @returns
 */
function get_origin(headers) {
	const protocol = (protocol_header && headers[protocol_header]) || 'https';
	const host = headers[host_header];
	const port = port_header && headers[port_header];
	if (port) {
		return `${protocol}://${host}:${port}`;
	} else {
		return `${protocol}://${host}`;
	}
}

export const handler = sequence(
	[
		serve(path.join(dir, 'client'), true),
		serve(path.join(dir, 'static')),
		serve_prerendered(),
		ssr
	].filter(Boolean)
);

```


####### packages/adapter-node/src/index.js #######

```

import { handler } from 'HANDLER';
import { env } from 'ENV';
import polka from 'polka';

export const path = env('SOCKET_PATH', false);
export const host = env('HOST', '0.0.0.0');
export const port = env('PORT', !path && '3000');

const shutdown_timeout = parseInt(env('SHUTDOWN_TIMEOUT', '30'));
const idle_timeout = parseInt(env('IDLE_TIMEOUT', '0'));
const listen_pid = parseInt(env('LISTEN_PID', '0'));
const listen_fds = parseInt(env('LISTEN_FDS', '0'));
// https://www.freedesktop.org/software/systemd/man/latest/sd_listen_fds.html
const SD_LISTEN_FDS_START = 3;

if (listen_pid !== 0 && listen_pid !== process.pid) {
	throw new Error(`received LISTEN_PID ${listen_pid} but current process id is ${process.pid}`);
}
if (listen_fds > 1) {
	throw new Error(
		`only one socket is allowed for socket activation, but LISTEN_FDS was set to ${listen_fds}`
	);
}

const socket_activation = listen_pid === process.pid && listen_fds === 1;

let requests = 0;
/** @type {NodeJS.Timeout | void} */
let shutdown_timeout_id;
/** @type {NodeJS.Timeout | void} */
let idle_timeout_id;

const server = polka().use(handler);

if (socket_activation) {
	server.listen({ fd: SD_LISTEN_FDS_START }, () => {
		console.log(`Listening on file descriptor ${SD_LISTEN_FDS_START}`);
	});
} else {
	server.listen({ path, host, port }, () => {
		console.log(`Listening on ${path ? path : host + ':' + port}`);
	});
}

function shutdown() {
	if (shutdown_timeout_id) return;

	// @ts-expect-error this was added in 18.2.0 but is not reflected in the types
	server.server.closeIdleConnections();

	server.server.close(() => {
		if (shutdown_timeout_id) {
			shutdown_timeout_id = clearTimeout(shutdown_timeout_id);
		}
		if (idle_timeout_id) {
			idle_timeout_id = clearTimeout(idle_timeout_id);
		}
	});

	shutdown_timeout_id = setTimeout(
		// @ts-expect-error this was added in 18.2.0 but is not reflected in the types
		() => server.server.closeAllConnections(),
		shutdown_timeout * 1000
	);
}

server.server.on(
	'request',
	/** @param {import('node:http').IncomingMessage} req */
	(req) => {
		requests++;

		if (socket_activation && idle_timeout_id) {
			idle_timeout_id = clearTimeout(idle_timeout_id);
		}

		req.on('close', () => {
			requests--;

			if (requests === 0 && shutdown_timeout_id) {
				// when all requests are done, close the connections, so the app shuts down without delay
				// @ts-expect-error this was added in 18.2.0 but is not reflected in the types
				server.server.closeIdleConnections();
			}
			if (requests === 0 && socket_activation && idle_timeout) {
				idle_timeout_id = setTimeout(shutdown, idle_timeout * 1000);
			}
		});
	}
);

process.on('SIGTERM', shutdown);
process.on('SIGINT', shutdown);

export { server };

```


####### packages/adapter-node/src/shims.js #######

```

import { installPolyfills } from '@sveltejs/kit/node/polyfills';
installPolyfills();

```


####### packages/adapter-node/tests/smoke.spec.js #######

```

import { assert, test } from 'vitest';
import { create_kit_middleware } from '../src/handler.js';
import fetch from 'node-fetch';
import polka from 'polka';

const { PORT = 3000 } = process.env;
const DEFAULT_SERVER_OPTS = { render: () => {} };

async function startServer(opts = DEFAULT_SERVER_OPTS) {
	return new Promise((fulfil, reject) => {
		const server = polka().use(create_kit_middleware(opts));
		server.listen(PORT, (err) => {
			if (err) {
				reject(err);
			}
			fulfil(server);
		});
	});
}

test('starts a server', async () => {
	const server = await startServer();
	assert.ok('server started');
	server.server.close();
});

test('serves a 404', async () => {
	const server = await startServer();
	const res = await fetch(`http://localhost:${PORT}/nothing`);
	assert.equal(res.status, 404);
	server.server.close();
});

test('responses with the rendered status code', async () => {
	const server = await startServer({
		render: () => {
			return {
				headers: 'wow',
				status: 203,
				body: 'ok'
			};
		}
	});
	const res = await fetch(`http://localhost:${PORT}/wow`);
	assert.equal(res.status, 203);
	server.server.close();
});

test('passes through umlaut as encoded path', async () => {
	const server = await startServer({
		render: (incoming) => {
			return {
				status: 200,
				body: incoming.path
			};
		}
	});
	const res = await fetch(`http://localhost:${PORT}/%C3%BCber-uns`);
	assert.equal(await res.text(), '/%C3%BCber-uns');
	server.server.close();
});

test('serve a 400 when we have a malformed url', async () => {
	const server = await startServer();
	const res = await fetch(`http://localhost:${PORT}//`);
	assert.equal(res.status, 400);
	server.server.close();
});

test.run();

```


####### packages/adapter-node/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true,
		"noImplicitAny": true,
		"allowSyntheticDefaultImports": true,
		"target": "es2022",
		"module": "node16",
		"moduleResolution": "node16",
		"baseUrl": ".",
		"paths": {
			"@sveltejs/kit": ["../kit/types/index"]
		}
	},
	"include": ["index.js", "src/**/*.js", "ambient.d.ts"]
}

```


####### packages/adapter-static/CHANGELOG.md #######

# @sveltejs/adapter-static

## 3.0.1

### Patch Changes

- chore: update primary branch from master to main ([`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d))

- Updated dependencies [[`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d), [`16961e8cd3fa6a7f382153b1ff056bc2aae9b31b`](https://github.com/sveltejs/kit/commit/16961e8cd3fa6a7f382153b1ff056bc2aae9b31b), [`197e01f95652f511160f38b37b9da73a124ecd48`](https://github.com/sveltejs/kit/commit/197e01f95652f511160f38b37b9da73a124ecd48), [`102e4a5ae5b29624302163faf5a20c94a64a5b2c`](https://github.com/sveltejs/kit/commit/102e4a5ae5b29624302163faf5a20c94a64a5b2c), [`f8e3d8b9728c9f1ab63389342c31d7246b6f9db6`](https://github.com/sveltejs/kit/commit/f8e3d8b9728c9f1ab63389342c31d7246b6f9db6)]:
  - @sveltejs/kit@2.0.4

## 3.0.0

### Major Changes

- breaking: update SvelteKit peer dependency to version 2 ([#11277](https://github.com/sveltejs/kit/pull/11277))

## 2.0.3

### Patch Changes

- fix: correctly list dynamic routes in error log ([#10443](https://github.com/sveltejs/kit/pull/10443))

## 2.0.2

### Patch Changes

- fix: update broken link in error message ([`118ce5a0`](https://github.com/sveltejs/kit/commit/118ce5a07a3a984353c3fc858b34c67e9e560fa0))

- Updated dependencies [[`748a8720`](https://github.com/sveltejs/kit/commit/748a8720fea8ea938576041207b81e19bb8f7dff)]:
  - @sveltejs/kit@1.15.3

## 2.0.1

### Patch Changes

- fix: generate fallback page before compressing ([#8972](https://github.com/sveltejs/kit/pull/8972))

- Updated dependencies [[`0abb8ebf`](https://github.com/sveltejs/kit/commit/0abb8ebffc6121f81c2bbfa0a0f68866d4cc1627), [`bef54f63`](https://github.com/sveltejs/kit/commit/bef54f63d2315066d30e8f1bcf471ddf2bd72c35), [`51cd6e64`](https://github.com/sveltejs/kit/commit/51cd6e643178e3a113fc2c3e8a63755bcbfe902d), [`930c8e4e`](https://github.com/sveltejs/kit/commit/930c8e4ee2e3046ed1b622777dafa23029a19fe5), [`ee8066fc`](https://github.com/sveltejs/kit/commit/ee8066fcb29ed1e7e3ab513cabb7997e38c984f2), [`49d2ec62`](https://github.com/sveltejs/kit/commit/49d2ec62e6385694f11701bf2fa411d07449344c), [`eb943565`](https://github.com/sveltejs/kit/commit/eb943565a4324dbed3da5a581924ca91a24366de)]:
  - @sveltejs/kit@1.5.3

## 2.0.0

### Major Changes

- breaking: bump `@sveltejs/kit` peer dependency ([#8740](https://github.com/sveltejs/kit/pull/8740))

### Patch Changes

- Updated dependencies [[`c7648f66`](https://github.com/sveltejs/kit/commit/c7648f6608a413e2654625cbd30f890d2148cf13), [`63613bf1`](https://github.com/sveltejs/kit/commit/63613bf194c18ce50e111585ad770fc93f9e43c7), [`d1f7655e`](https://github.com/sveltejs/kit/commit/d1f7655efdff70d91f94fe0cb0de50ed2511b5e5)]:
  - @sveltejs/kit@1.5.0

## 1.0.6

### Patch Changes

- docs: fix link in README ([#8854](https://github.com/sveltejs/kit/pull/8854))

- Updated dependencies [[`7cdb7a65`](https://github.com/sveltejs/kit/commit/7cdb7a65819342c6d334c79defc697d531d5cbf4)]:
  - @sveltejs/kit@1.3.10

## 1.0.5

### Patch Changes

- docs: move adapter docs to site ([#8531](https://github.com/sveltejs/kit/pull/8531))

## 1.0.4

### Patch Changes

- fix: publish missing files ([#8532](https://github.com/sveltejs/kit/pull/8532))

## 1.0.3

### Patch Changes

- chore: remove superfluous main field from package.json ([#8519](https://github.com/sveltejs/kit/pull/8519))

- Updated dependencies [[`7e2d3405`](https://github.com/sveltejs/kit/commit/7e2d34056e99f371e22406d941b764df365a2649)]:
  - @sveltejs/kit@1.1.1

## 1.0.2

### Patch Changes

- docs: clarify that you can build SPAs with adapter-static ([#8502](https://github.com/sveltejs/kit/pull/8502))

## 1.0.1

### Patch Changes

- fix: match `adapter-vercel` logic for serving prerendered content ([#8332](https://github.com/sveltejs/kit/pull/8332))

## 1.0.0

### Major Changes

First major release, see below for the history of changes that lead up to this.
Starting from now all releases follow semver and changes will be listed as Major/Minor/Patch

## 1.0.0-next.50

### Patch Changes

- chore: add peerDependencies, add more specific next version ([#8141](https://github.com/sveltejs/kit/pull/8141))

## 1.0.0-next.49

### Patch Changes

- breaking: replace automatic fallback generation with `builder.generateFallback(fallback)` ([#8013](https://github.com/sveltejs/kit/pull/8013))

## 1.0.0-next.48

### Patch Changes

- Update README ([#7480](https://github.com/sveltejs/kit/pull/7480))

## 1.0.0-next.47

### Patch Changes

- update dependencies ([#7355](https://github.com/sveltejs/kit/pull/7355))

## 1.0.0-next.46

### Patch Changes

- Make options object optional ([#7341](https://github.com/sveltejs/kit/pull/7341))

## 1.0.0-next.45

### Patch Changes

- feat: more info about prerendering errors, add strict option to adapter-static ([#7264](https://github.com/sveltejs/kit/pull/7264))

## 1.0.0-next.44

### Patch Changes

- fix error message ([#7108](https://github.com/sveltejs/kit/pull/7108))

## 1.0.0-next.43

### Patch Changes

- Improve performance by compressing in parallel ([#6710](https://github.com/sveltejs/kit/pull/6710))

## 1.0.0-next.42

### Patch Changes

- docs: more specific error message when prerendering fails ([#6577](https://github.com/sveltejs/kit/pull/6577))

## 1.0.0-next.41

### Patch Changes

- Better error when encountering not-fully-prerenderable routes ([#6474](https://github.com/sveltejs/kit/pull/6474))

## 1.0.0-next.40

### Patch Changes

- breaking: require all routes to be prerenderable when not using fallback option ([#6392](https://github.com/sveltejs/kit/pull/6392))

## 1.0.0-next.39

### Patch Changes

- Move `compress` logic to `Builder` API ([#5822](https://github.com/sveltejs/kit/pull/5822))

## 1.0.0-next.38

### Patch Changes

- breaking: remove writeStatic to align with Vite ([#5618](https://github.com/sveltejs/kit/pull/5618))

## 1.0.0-next.37

### Patch Changes

- breaking: Throws when correctly configured to run as a static site of a SPA ([#5562](https://github.com/sveltejs/kit/pull/5562))

## 1.0.0-next.36

### Patch Changes

- Remove ENABLE_VC_BUILD check, use v3 build output API for all apps deployed to Vercel ([#5514](https://github.com/sveltejs/kit/pull/5514))

## 1.0.0-next.35

### Patch Changes

- chore: upgrade TypeScript to 4.7.4 ([#5414](https://github.com/sveltejs/kit/pull/5414))

## 1.0.0-next.34

### Patch Changes

- Update dependencies ([#5121](https://github.com/sveltejs/kit/pull/5121))

## 1.0.0-next.33

### Patch Changes

- Update adapter entrypoint typings to be NodeNext/ESNext-compatible ([#5111](https://github.com/sveltejs/kit/pull/5111))

## 1.0.0-next.32

### Patch Changes

- Add types to pkg.exports ([#5045](https://github.com/sveltejs/kit/pull/5045))

## 1.0.0-next.31

### Patch Changes

- Tweak fallback page README ([#4954](https://github.com/sveltejs/kit/pull/4954))

## 1.0.0-next.30

### Patch Changes

- Bump version to trigger README update on npm ([#4875](https://github.com/sveltejs/kit/pull/4875))

## 1.0.0-next.29

### Patch Changes

- breaking: replace builder.prerender() with builder.writePrerendered() and builder.prerendered ([#4192](https://github.com/sveltejs/kit/pull/4192)) ([#4229](https://github.com/sveltejs/kit/pull/4229))

## 1.0.0-next.28

### Patch Changes

- breaking: remove `createIndexFiles` option, derive from `trailingSlash` instead ([#3801](https://github.com/sveltejs/kit/pull/3801))

## 1.0.0-next.27

### Patch Changes

- `precompress` option also compress wasm files ([#3790](https://github.com/sveltejs/kit/pull/3790))

## 1.0.0-next.26

### Patch Changes

- Log adapter-static output directories ([#3274](https://github.com/sveltejs/kit/pull/3274))

## 1.0.0-next.25

### Patch Changes

- chore: update dependency sirv to v2 ([#3263](https://github.com/sveltejs/kit/pull/3263))

## 1.0.0-next.24

### Patch Changes

- Overhaul adapter API ([#2931](https://github.com/sveltejs/kit/pull/2931))

## 1.0.0-next.23

### Patch Changes

- add precompress option to adapter-static ([#3079](https://github.com/sveltejs/kit/pull/3079))

## 1.0.0-next.22

### Patch Changes

- update to esbuild 0.13.15 and other dependency updates ([#2957](https://github.com/sveltejs/kit/pull/2957))

## 1.0.0-next.21

### Patch Changes

- update dependencies ([#2574](https://github.com/sveltejs/kit/pull/2574))

## 1.0.0-next.20

### Patch Changes

- chore: upgrade to Svelte 3.43.0" ([#2474](https://github.com/sveltejs/kit/pull/2474))

## 1.0.0-next.19

### Patch Changes

- chore: add links to repository and homepage to package.json ([#2425](https://github.com/sveltejs/kit/pull/2425))

## 1.0.0-next.18

### Patch Changes

- chore: export package.json from adapters ([#2351](https://github.com/sveltejs/kit/pull/2351))

## 1.0.0-next.17

### Patch Changes

- Clear output before adapting ([#2260](https://github.com/sveltejs/kit/pull/2260))

## 1.0.0-next.16

### Patch Changes

- 94b34fa6: [breaking] standardize final output dir as /build (vs /.svelte-kit) ([#2109](https://github.com/sveltejs/kit/pull/2109))

## 1.0.0-next.15

### Patch Changes

- b3e7c8b3: [chore] update build output location ([#2082](https://github.com/sveltejs/kit/pull/2082))

## 1.0.0-next.14

### Patch Changes

- d81de603: revert adapters automatically updating .gitignore ([#1924](https://github.com/sveltejs/kit/pull/1924))

## 1.0.0-next.13

### Patch Changes

- edc307d: Remove peerDependencies due to pnpm bug ([#1621](https://github.com/sveltejs/kit/pull/1621))
- 2636e68: Attempt to fix peerDependencies specification ([#1620](https://github.com/sveltejs/kit/pull/1620))

## 1.0.0-next.12

### Patch Changes

- bf77940: bump `polka` and `sirv` dependency versions ([#1548](https://github.com/sveltejs/kit/pull/1548))
- 028abd9: Pass validated svelte config to adapter adapt function ([#1559](https://github.com/sveltejs/kit/pull/1559))
- Updated dependencies [6372690]
- Updated dependencies [c3d36a3]
- Updated dependencies [bf77940]
- Updated dependencies [2172469]
- Updated dependencies [028abd9]
  - @sveltejs/kit@1.0.0-next.110

## 1.0.0-next.11

### Patch Changes

- dca4946: Make kit a peerDependency of the adapters ([#1505](https://github.com/sveltejs/kit/pull/1505))
- Updated dependencies [261ee1c]
- Updated dependencies [ec156c6]
- Updated dependencies [586785d]
  - @sveltejs/kit@1.0.0-next.109

## 1.0.0-next.10

### Patch Changes

- dad93fc: Fix workspace dependencies ([#1434](https://github.com/sveltejs/kit/pull/1434))

## 1.0.0-next.9

### Patch Changes

- d871213: Remove Vite dependency from apps ([#1374](https://github.com/sveltejs/kit/pull/1374))

## 1.0.0-next.8

### Patch Changes

- c6fde99: Convert to ESM ([#1323](https://github.com/sveltejs/kit/pull/1323))

## 1.0.0-next.7

### Patch Changes

- 2e72a94: Add type declarations ([#1230](https://github.com/sveltejs/kit/pull/1230))

## 1.0.0-next.6

### Patch Changes

- 6f2b4a6: Remove references to npm start ([#1196](https://github.com/sveltejs/kit/pull/1196))

## 1.0.0-next.5

### Patch Changes

- 4131467: Prerender fallback page for SPAs ([#1181](https://github.com/sveltejs/kit/pull/1181))

## 1.0.0-next.4

### Patch Changes

- 8805c6d: Pass adapters directly to svelte.config.cjs ([#579](https://github.com/sveltejs/kit/pull/579))

## 1.0.0-next.3

### Patch Changes

- f35a5cd: Change adapter signature ([#505](https://github.com/sveltejs/kit/pull/505))

## 1.0.0-next.2

### Patch Changes

- Fix adapters and convert to ES modules

## 1.0.0-next.1

### Patch Changes

- Support options

## 0.0.17

### Patch Changes

- Add svelte-kit start command

## 0.0.16

### Patch Changes

- Remove unnecessary prepublish script

## 0.0.15

### Patch Changes

- b475ed4: Overhaul adapter API - fixes #166 ([#180](https://github.com/sveltejs/kit/pull/180))

## 0.0.14

### Patch Changes

- Updated dependencies [3bdf33b]
  - @sveltejs/app-utils@0.0.17

## 0.0.13

### Patch Changes

- 67eaeea: Move app-utils stuff into subpackages
- Updated dependencies [67eaeea]
  - @sveltejs/app-utils@0.0.16

## 0.0.12

### Patch Changes

- Updated dependencies [a163000]
  - @sveltejs/app-utils@0.0.15

## 0.0.11

### Patch Changes

- Updated dependencies [undefined]
- Updated dependencies [undefined]
- Updated dependencies [undefined]
  - @sveltejs/app-utils@0.0.14

## 0.0.10

### Patch Changes

- Updated dependencies [undefined]
- Updated dependencies [96c06d8]
  - @sveltejs/app-utils@0.0.13

## 0.0.9

### Patch Changes

- Updated dependencies [0320208]
- Updated dependencies [5ca907c]
  - @sveltejs/app-utils@0.0.12

## 0.0.8

### Patch Changes

- Updated dependencies [undefined]
  - @sveltejs/app-utils@0.0.11

## 0.0.7

### Patch Changes

- Updated dependencies [19323e9]
  - @sveltejs/app-utils@0.0.10

## 0.0.6

### Patch Changes

- Updated dependencies [90a98ae]
  - @sveltejs/app-utils@0.0.9

## 0.0.5

### Patch Changes

- Updated dependencies [undefined]
  - @sveltejs/app-utils@0.0.8

## 0.0.4

### Patch Changes

- various
- Updated dependencies [undefined]
  - @sveltejs/app-utils@0.0.7

####### packages/adapter-static/index.d.ts #######

```

import { Adapter } from '@sveltejs/kit';

export interface AdapterOptions {
	pages?: string;
	assets?: string;
	fallback?: string;
	precompress?: boolean;
	strict?: boolean;
}

export default function plugin(options?: AdapterOptions): Adapter;

```


####### packages/adapter-static/index.js #######

```

import path from 'node:path';
import { platforms } from './platforms.js';

/** @type {import('./index.js').default} */
export default function (options) {
	return {
		name: '@sveltejs/adapter-static',

		async adapt(builder) {
			if (!options?.fallback) {
				const dynamic_routes = builder.routes.filter((route) => route.prerender !== true);
				if (dynamic_routes.length > 0 && options?.strict !== false) {
					const prefix = path.relative('.', builder.config.kit.files.routes);
					const has_param_routes = builder.routes.some((route) => route.id.includes('['));
					const config_option =
						has_param_routes || JSON.stringify(builder.config.kit.prerender.entries) !== '["*"]'
							? `  - adjust the \`prerender.entries\` config option ${
									has_param_routes
										? '(routes with parameters are not part of entry points by default)'
										: ''
								} — see https://kit.svelte.dev/docs/configuration#prerender for more info.`
							: '';

					builder.log.error(
						`@sveltejs/adapter-static: all routes must be fully prerenderable, but found the following routes that are dynamic:
${dynamic_routes.map((route) => `  - ${path.posix.join(prefix, route.id)}`).join('\n')}

You have the following options:
  - set the \`fallback\` option — see https://kit.svelte.dev/docs/single-page-apps#usage for more info.
  - add \`export const prerender = true\` to your root \`+layout.js/.ts\` or \`+layout.server.js/.ts\` file. This will try to prerender all pages.
  - add \`export const prerender = true\` to any \`+server.js/ts\` files that are not fetched by page \`load\` functions.
${config_option}
  - pass \`strict: false\` to \`adapter-static\` to ignore this error. Only do this if you are sure you don't need the routes in question in your final app, as they will be unavailable. See https://github.com/sveltejs/kit/tree/main/packages/adapter-static#strict for more info.

If this doesn't help, you may need to use a different adapter. @sveltejs/adapter-static can only be used for sites that don't need a server for dynamic rendering, and can run on just a static file server.
See https://kit.svelte.dev/docs/page-options#prerender for more details`
					);
					throw new Error('Encountered dynamic routes');
				}
			}

			const platform = platforms.find((platform) => platform.test());

			if (platform) {
				if (options) {
					builder.log.warn(
						`Detected ${platform.name}. Please remove adapter-static options to enable zero-config mode`
					);
				} else {
					builder.log.info(`Detected ${platform.name}, using zero-config mode`);
				}
			}

			const {
				// @ts-ignore
				pages = 'build',
				assets = pages,
				fallback,
				precompress
			} = options ?? platform?.defaults ?? /** @type {import('./index.js').AdapterOptions} */ ({});

			builder.rimraf(assets);
			builder.rimraf(pages);

			builder.generateEnvModule();
			builder.writeClient(assets);
			builder.writePrerendered(pages);

			if (fallback) {
				await builder.generateFallback(path.join(pages, fallback));
			}

			if (precompress) {
				builder.log.minor('Compressing assets and pages');
				if (pages === assets) {
					await builder.compress(assets);
				} else {
					await Promise.all([builder.compress(assets), builder.compress(pages)]);
				}
			}

			if (pages === assets) {
				builder.log(`Wrote site to "${pages}"`);
			} else {
				builder.log(`Wrote pages to "${pages}" and assets to "${assets}"`);
			}

			if (!options) platform?.done(builder);
		}
	};
}

```


####### packages/adapter-static/LICENSE #######

```

Copyright (c) 2020 [these people](https://github.com/sveltejs/kit/graphs/contributors)

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
```


####### packages/adapter-static/package.json #######

```

{
	"name": "@sveltejs/adapter-static",
	"version": "3.0.1",
	"description": "Adapter for SvelteKit apps that prerenders your entire site as a collection of static files",
	"repository": {
		"type": "git",
		"url": "https://github.com/sveltejs/kit",
		"directory": "packages/adapter-static"
	},
	"license": "MIT",
	"homepage": "https://kit.svelte.dev",
	"type": "module",
	"exports": {
		".": {
			"types": "./index.d.ts",
			"import": "./index.js"
		},
		"./package.json": "./package.json"
	},
	"types": "index.d.ts",
	"files": [
		"index.js",
		"index.d.ts",
		"platforms.js"
	],
	"scripts": {
		"lint": "prettier --check .",
		"check": "tsc",
		"format": "pnpm lint --write",
		"test": "pnpm -r --workspace-concurrency 1 --filter=\"./test/**\" test"
	},
	"devDependencies": {
		"@playwright/test": "^1.41.0",
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"@types/node": "^18.19.3",
		"sirv": "^2.0.4",
		"svelte": "^4.2.10",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"peerDependencies": {
		"@sveltejs/kit": "^2.0.0"
	}
}

```


####### packages/adapter-static/platforms.js #######

```

import fs from 'node:fs';

/**
 * @typedef {{
 *   name: string;
 *   test: () => boolean;
 *   defaults: import('./index.js').AdapterOptions;
 *   done: (builder: import('@sveltejs/kit').Builder) => void;
 * }}
 * Platform */

// This function is duplicated in adapter-vercel
/** @param {import('@sveltejs/kit').Builder} builder */
function static_vercel_config(builder) {
	/** @type {any[]} */
	const prerendered_redirects = [];

	/** @type {Record<string, { path: string }>} */
	const overrides = {};

	for (const [src, redirect] of builder.prerendered.redirects) {
		prerendered_redirects.push({
			src,
			headers: {
				Location: redirect.location
			},
			status: redirect.status
		});
	}

	for (const [path, page] of builder.prerendered.pages) {
		if (path.endsWith('/') && path !== '/') {
			prerendered_redirects.push(
				{ src: path, dest: path.slice(0, -1) },
				{ src: path.slice(0, -1), status: 308, headers: { Location: path } }
			);

			overrides[page.file] = { path: path.slice(1, -1) };
		} else {
			overrides[page.file] = { path: path.slice(1) };
		}
	}

	return {
		version: 3,
		routes: [
			...prerendered_redirects,
			{
				src: `/${builder.getAppPath()}/immutable/.+`,
				headers: {
					'cache-control': 'public, immutable, max-age=31536000'
				}
			},
			{
				handle: 'filesystem'
			}
		],
		overrides
	};
}

/** @type {Platform[]} */
export const platforms = [
	{
		name: 'Vercel',
		test: () => !!process.env.VERCEL,
		defaults: {
			pages: '.vercel/output/static'
		},
		done: (builder) => {
			const config = static_vercel_config(builder);
			fs.writeFileSync('.vercel/output/config.json', JSON.stringify(config, null, '  '));
		}
	}
];

```


####### packages/adapter-static/README.md #######

# @sveltejs/adapter-static

[Adapter](https://kit.svelte.dev/docs/adapters) for SvelteKit apps that prerenders your entire site as a collection of static files. It's also possible to create an SPA with it by specifying a fallback page which renders an empty shell. If you'd like to prerender only some pages and not create an SPA for those left out, you will need to use a different adapter together with [the `prerender` option](https://kit.svelte.dev/docs/page-options#prerender).

## Docs

[Docs](https://kit.svelte.dev/docs/adapter-static)

## Changelog

[The Changelog for this package is available on GitHub](https://github.com/sveltejs/kit/blob/main/packages/adapter-static/CHANGELOG.md).

## License

[MIT](LICENSE)

####### packages/adapter-static/test/apps/prerendered/package.json #######

```

{
	"name": "~TODO~",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "sirv -p 5173 -s 200.html build",
		"test": "playwright test"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"sirv-cli": "^2.0.2",
		"svelte": "^4.2.10",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/adapter-static/test/apps/prerendered/playwright.config.js #######

```

export { config as default } from '../../utils.js';

```


####### packages/adapter-static/test/apps/prerendered/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/adapter-static/test/apps/prerendered/src/global.d.ts #######

```

/// <reference types="@sveltejs/kit" />

```


####### packages/adapter-static/test/apps/prerendered/src/routes/endpoint/explicit.json/+server.js #######

```

import { json } from '@sveltejs/kit';

export const prerender = true;

/** @type {import('./$types').RequestHandler} */
export function GET() {
	return json({ answer: 42 });
}

```


####### packages/adapter-static/test/apps/prerendered/src/routes/endpoint/implicit.json/+server.js #######

```

import { json } from '@sveltejs/kit';

// no export const prerender here, it should be prerendered by virtue
// of being fetched from a prerendered page

/** @type {import('./$types').RequestHandler} */
export function GET() {
	return json({ answer: 42 });
}

```


####### packages/adapter-static/test/apps/prerendered/src/routes/+layout.js #######

```

export const prerender = true;

```


####### packages/adapter-static/test/apps/prerendered/src/routes/+layout.svelte #######

```

<slot />

```


####### packages/adapter-static/test/apps/prerendered/src/routes/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ fetch }) {
	const res = await fetch('/endpoint/implicit.json');
	return await res.json();
}

```


####### packages/adapter-static/test/apps/prerendered/src/routes/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>This page was prerendered</h1>
<p>answer: {data.answer}</p>

```


####### packages/adapter-static/test/apps/prerendered/src/routes/public-env/+page.svelte #######

```

<script>
	import { browser } from '$app/environment';
	import { PUBLIC_ANSWER } from '$env/static/public';
	import { env } from '$env/dynamic/public';
</script>

<h1>The answer is {PUBLIC_ANSWER}</h1>

{#if browser}
	<h2>The dynamic answer is {env.PUBLIC_ANSWER}</h2>
{/if}

```


####### packages/adapter-static/test/apps/prerendered/src/routes/server-emitted-asset/+page.server.js #######

```

import src from './image.jpg';

export function load() {
	return {
		src
	};
}

```


####### packages/adapter-static/test/apps/prerendered/src/routes/server-emitted-asset/+page.svelte #######

```

<script>
	export let data;
</script>

<img src={data.src} alt="birb" />

```


####### packages/adapter-static/test/apps/prerendered/svelte.config.js #######

```

import adapter from '../../../index.js';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter()
	}
};

export default config;

```


####### packages/adapter-static/test/apps/prerendered/test/test.js #######

```

import * as fs from 'node:fs';
import { expect, test } from '@playwright/test';

const cwd = process.cwd();

test('generates HTML files', () => {
	expect(fs.existsSync(`${cwd}/build/index.html`)).toBeTruthy();
});

test('prerenders a page', async ({ page }) => {
	await page.goto('/');
	expect(await page.textContent('h1')).toEqual('This page was prerendered');
	expect(await page.textContent('p')).toEqual('answer: 42');
});

test('prerenders an unreferenced endpoint with explicit `prerender` setting', async () => {
	expect(fs.existsSync(`${cwd}/build/endpoint/explicit.json`)).toBeTruthy();
});

test('prerenders a referenced endpoint with implicit `prerender` setting', async () => {
	expect(fs.existsSync(`${cwd}/build/endpoint/implicit.json`)).toBeTruthy();
});

test('exposes public env vars to the client', async ({ page }) => {
	await page.goto('/public-env');
	expect(await page.textContent('h1')).toEqual('The answer is 42');
	expect(await page.textContent('h2')).toEqual('The dynamic answer is 42');
});

```


####### packages/adapter-static/test/apps/prerendered/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},
	plugins: [sveltekit()]
};

export default config;

```


####### packages/adapter-static/test/apps/spa/jsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"include": ["src/**/*.d.ts", "src/**/*.js", "src/**/*.svelte"]
}

```


####### packages/adapter-static/test/apps/spa/package.json #######

```

{
	"name": "~TODO~",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build --mode staging",
		"preview": "sirv -p 5173 -s 200.html build",
		"test": "playwright test"
	},
	"devDependencies": {
		"@sveltejs/adapter-node": "workspace:^",
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"sirv-cli": "^2.0.2",
		"svelte": "^4.2.10",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/adapter-static/test/apps/spa/playwright.config.js #######

```

export { config as default } from '../../utils.js';

```


####### packages/adapter-static/test/apps/spa/README.md #######

# create-svelte

Everything you need to build a Svelte project, powered by [`create-svelte`](https://github.com/sveltejs/kit/tree/main/packages/create-svelte);

## Creating a project

If you're seeing this, you've probably already done this step. Congrats!

```bash
# create a new project in the current directory
npm init svelte

# create a new project in my-app
npm init svelte my-app
```

## Developing

Once you've created a project and installed dependencies with `npm install` (or `pnpm install` or `yarn`), start a development server:

```bash
npm run dev

# or start the server and open the app in a new browser tab
npm run dev -- --open
```

## Building

Before creating a production version of your app, install an [adapter](https://kit.svelte.dev/docs/adapters) for your target environment. Then:

```bash
npm run build
```

> You can preview the built app with `npm run preview`, regardless of whether you installed an adapter. This should _not_ be used to serve your app in production.

####### packages/adapter-static/test/apps/spa/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/adapter-static/test/apps/spa/src/routes/about/+page.js #######

```

export const prerender = true;

```


####### packages/adapter-static/test/apps/spa/src/routes/about/+page.svelte #######

```

<h1>This page was prerendered</h1>

```


####### packages/adapter-static/test/apps/spa/src/routes/+error.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>{$page.status}</h1>

```


####### packages/adapter-static/test/apps/spa/src/routes/fallback/[...rest]/+page.svelte #######

```

<script>
	import { PUBLIC_VALUE } from '$env/static/public';
</script>

<h1>the fallback page was rendered</h1>

<b>{PUBLIC_VALUE}</b>

```


####### packages/adapter-static/test/apps/spa/src/routes/+layout.svelte #######

```

<nav>
	<a href="/">home</a>
	<a href="/about">about</a>
</nav>

<slot />

```


####### packages/adapter-static/test/apps/spa/src/routes/+page.svelte #######

```

<h1>This page was not prerendered</h1>

```


####### packages/adapter-static/test/apps/spa/svelte.config.js #######

```

import adapter from '../../../index.js';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter({
			fallback: '200.html'
		})
	}
};

export default config;

```


####### packages/adapter-static/test/apps/spa/test/test.js #######

```

import * as fs from 'node:fs';
import { expect, test } from '@playwright/test';

const cwd = process.cwd();

test('generates a fallback page', async ({ page }) => {
	expect(fs.existsSync(`${cwd}/build/200.html`)).toBeTruthy();

	await page.goto('/fallback/a/b/c');
	expect(await page.textContent('h1')).toEqual('the fallback page was rendered');
});

test('does not prerender pages without prerender=true', () => {
	expect(fs.existsSync(`${cwd}/build/index.html`)).toBeFalsy();
});

test('prerenders page with prerender=true', () => {
	expect(fs.existsSync(`${cwd}/build/about.html`)).toBeTruthy();
});

test('renders content in fallback page when JS runs', async ({ page }) => {
	await page.goto('/');
	expect(await page.textContent('h1')).toEqual('This page was not prerendered');
});

test('renders error page for missing page', async ({ page }) => {
	await page.goto('/nosuchpage');
	expect(await page.textContent('h1')).toEqual('404');
});

test('uses correct environment variables for fallback page (mode = staging)', async ({ page }) => {
	await page.goto('/fallback/x/y/z');
	expect(await page.textContent('b')).toEqual('42');
});

```


####### packages/adapter-static/test/apps/spa/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},
	plugins: [sveltekit()]
};

export default config;

```


####### packages/adapter-static/test/utils.js #######

```

import { devices } from '@playwright/test';

/** @type {import('@playwright/test').PlaywrightTestConfig} */
export const config = {
	forbidOnly: !!process.env.CI,
	// generous timeouts on CI
	timeout: process.env.CI ? 45000 : 15000,
	webServer: {
		command: 'pnpm build && pnpm preview',
		port: 5173
	},
	retries: process.env.CI ? 2 : 0,
	projects: [
		{
			name: 'chromium'
		}
	],
	use: {
		...devices['Desktop Chrome'],
		screenshot: 'only-on-failure',
		trace: 'retain-on-failure'
	},
	workers: process.env.CI ? 2 : undefined,
	reporter: 'list',
	testDir: 'test',
	testMatch: /(.+\.)?(test|spec)\.[jt]s/
};

```


####### packages/adapter-static/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true,
		"noImplicitAny": true,
		"target": "es2022",
		"module": "node16",
		"moduleResolution": "node16",
		"allowSyntheticDefaultImports": true,
		"baseUrl": ".",
		"paths": {
			"@sveltejs/kit": ["../kit/types/index"]
		}
	},
	"include": ["index.js"]
}

```


####### packages/adapter-vercel/ambient.d.ts #######

```

import { RequestContext } from './index.js';

declare global {
	namespace App {
		export interface Platform {
			/**
			 * `context` is only available in Edge Functions
			 */
			context?: RequestContext;
		}
	}
}

```


####### packages/adapter-vercel/CHANGELOG.md #######

# @sveltejs/adapter-vercel

## 5.3.0

### Minor Changes

- chore(deps): upgrade esbuild ([#12118](https://github.com/sveltejs/kit/pull/12118))

### Patch Changes

- Updated dependencies [[`bbab296f6fcc05af6b999182798bcdedabbaa4c9`](https://github.com/sveltejs/kit/commit/bbab296f6fcc05af6b999182798bcdedabbaa4c9)]:
  - @sveltejs/kit@2.5.6

## 5.2.0

### Minor Changes

- feat: add framework metadata in Vercel build output files ([#11800](https://github.com/sveltejs/kit/pull/11800))

- feat: implement version skew protection ([#11987](https://github.com/sveltejs/kit/pull/11987))

## 5.1.1

### Patch Changes

- fix: handle optional and rest routes for incremental static regeneration (ISR) correctly ([#11928](https://github.com/sveltejs/kit/pull/11928))

## 5.1.0

### Minor Changes

- feat: allow compatible subset of Node.js built-in modules when targeting edge functions ([#11675](https://github.com/sveltejs/kit/pull/11675))

### Patch Changes

- Updated dependencies [[`36dc54ac740b8b4c6a2b904a1d0aadd8923a875c`](https://github.com/sveltejs/kit/commit/36dc54ac740b8b4c6a2b904a1d0aadd8923a875c), [`5dae3676b8cc6f8ee0def57340e6a6e591bafecd`](https://github.com/sveltejs/kit/commit/5dae3676b8cc6f8ee0def57340e6a6e591bafecd), [`ada595908b5501b8f4ac30c89c0d6314f364fde3`](https://github.com/sveltejs/kit/commit/ada595908b5501b8f4ac30c89c0d6314f364fde3), [`e228f8997840b89c6248e1c5df6f3108008a06be`](https://github.com/sveltejs/kit/commit/e228f8997840b89c6248e1c5df6f3108008a06be)]:
  - @sveltejs/kit@2.4.1

## 5.0.0

### Major Changes

- breaking: update peer dependency on `@sveltejs/kit` ([#11649](https://github.com/sveltejs/kit/pull/11649))

### Minor Changes

- feat: support `read` from `$app/server` ([#11649](https://github.com/sveltejs/kit/pull/11649))

### Patch Changes

- Updated dependencies [[`288f731c8a5b20cadb9e219f9583f3f16bf8c7b8`](https://github.com/sveltejs/kit/commit/288f731c8a5b20cadb9e219f9583f3f16bf8c7b8)]:
  - @sveltejs/kit@2.4.0

## 4.0.5

### Patch Changes

- chore: upgrade esbuild to 0.19.11 ([#11632](https://github.com/sveltejs/kit/pull/11632))

## 4.0.4

### Patch Changes

- fix: update @vercel/nft to 0.26.1 ([#11508](https://github.com/sveltejs/kit/pull/11508))

## 4.0.3

### Patch Changes

- chore: update primary branch from master to main ([`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d))

- Updated dependencies [[`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d), [`16961e8cd3fa6a7f382153b1ff056bc2aae9b31b`](https://github.com/sveltejs/kit/commit/16961e8cd3fa6a7f382153b1ff056bc2aae9b31b), [`197e01f95652f511160f38b37b9da73a124ecd48`](https://github.com/sveltejs/kit/commit/197e01f95652f511160f38b37b9da73a124ecd48), [`102e4a5ae5b29624302163faf5a20c94a64a5b2c`](https://github.com/sveltejs/kit/commit/102e4a5ae5b29624302163faf5a20c94a64a5b2c), [`f8e3d8b9728c9f1ab63389342c31d7246b6f9db6`](https://github.com/sveltejs/kit/commit/f8e3d8b9728c9f1ab63389342c31d7246b6f9db6)]:
  - @sveltejs/kit@2.0.4

## 4.0.2

### Patch Changes

- fix: remove broken node 16 support ([#11328](https://github.com/sveltejs/kit/pull/11328))

## 4.0.1

### Patch Changes

- chore(deps): update `@vercel/nft` ([#11281](https://github.com/sveltejs/kit/pull/11281))

## 4.0.0

### Major Changes

- breaking: require SvelteKit 2 peer dependency ([#11289](https://github.com/sveltejs/kit/pull/11289))

- chore: upgrade esbuild ([#11122](https://github.com/sveltejs/kit/pull/11122))

### Minor Changes

- feat: expose vercel image optimization config in adapter config ([#8667](https://github.com/sveltejs/kit/pull/8667))

## 3.1.0

### Minor Changes

- feat: add support for nodejs20.x ([#11067](https://github.com/sveltejs/kit/pull/11067))

## 3.0.3

### Patch Changes

- chore: upgrade to @vercel/nft version 0.23.0 ([#10445](https://github.com/sveltejs/kit/pull/10445))

- Updated dependencies [[`0f0049810`](https://github.com/sveltejs/kit/commit/0f00498100361ef0a4ea8b0b4e8465e442fa22a6), [`6f36aefe1`](https://github.com/sveltejs/kit/commit/6f36aefe13bf55cfaef14166c60ecee989061ddd)]:
  - @sveltejs/kit@1.22.4

## 3.0.2

### Patch Changes

- chore: upgrade to esbuild 0.18.11 ([#10330](https://github.com/sveltejs/kit/pull/10330))

- Updated dependencies [[`23d1df702`](https://github.com/sveltejs/kit/commit/23d1df702f0fd77983040404352d8d83fd1dd8a1), [`486a971fe`](https://github.com/sveltejs/kit/commit/486a971fe7c375aae1585f1fa2505e28f86f4b8e)]:
  - @sveltejs/kit@1.22.2

## 3.0.1

### Patch Changes

- fix: stop incorrectly warning users that crons don't match paths ([#10074](https://github.com/sveltejs/kit/pull/10074))

- Updated dependencies [[`d4de2049c`](https://github.com/sveltejs/kit/commit/d4de2049cd05c7b32cfbe1b0e63b58f345f13372)]:
  - @sveltejs/kit@1.20.1

## 3.0.0

### Major Changes

- breaking: remove obsolete `envVarsInUse` option ([#9942](https://github.com/sveltejs/kit/pull/9942))

### Patch Changes

- fix: Copy .wasm files during build ([#9944](https://github.com/sveltejs/kit/pull/9944))

- Updated dependencies [[`50acb22ca`](https://github.com/sveltejs/kit/commit/50acb22caf2901283e044cdfda36db6f07b3e0ae), [`2e6da9496`](https://github.com/sveltejs/kit/commit/2e6da9496bdace2c65040b9d1845c44801ca868c), [`a81106b3a`](https://github.com/sveltejs/kit/commit/a81106b3a817829c41e048207d6253e63988c58c), [`a6338a0b1`](https://github.com/sveltejs/kit/commit/a6338a0b124f54bda7ba3fe64be1d6173e118d00), [`4a85b7f08`](https://github.com/sveltejs/kit/commit/4a85b7f0820d35c7830c00afe1df3c94fcbf8c3d), [`26d2b7f8f`](https://github.com/sveltejs/kit/commit/26d2b7f8f5ca29c60ef61b936ff86deaeb1636ce), [`bc70b4e63`](https://github.com/sveltejs/kit/commit/bc70b4e636fcbd9593356996bf737e014ff8c238), [`ab9f57721`](https://github.com/sveltejs/kit/commit/ab9f57721fca146af7c4eb41f4875fafa5dfc0d2)]:
  - @sveltejs/kit@1.17.0

## 2.4.3

### Patch Changes

- chore: update all dependencies with minor version bumps ([#9761](https://github.com/sveltejs/kit/pull/9761))

## 2.4.2

### Patch Changes

- fix: construct correct pathname for isr from route with nested params ([#9470](https://github.com/sveltejs/kit/pull/9470))

- Updated dependencies [[`84a5250d`](https://github.com/sveltejs/kit/commit/84a5250d5fe80a87eb7df5569e76a1dde857aa82), [`95e95828`](https://github.com/sveltejs/kit/commit/95e95828f444a35ca3f71eb1350c6630895c02c9), [`367067f5`](https://github.com/sveltejs/kit/commit/367067f547bb78c61f511e88b9361632862cb4ee), [`e9dd2559`](https://github.com/sveltejs/kit/commit/e9dd2559445958c2fdcb4faa2d94bccac2f1f950), [`ae2f4a8c`](https://github.com/sveltejs/kit/commit/ae2f4a8caacfb671db159f3cdce0894beb485b4f)]:
  - @sveltejs/kit@1.15.7

## 2.4.1

### Patch Changes

- fix: create separate functions for ISR routes ([#9504](https://github.com/sveltejs/kit/pull/9504))

## 2.4.0

### Minor Changes

- feat: warn when prerender setting makes isr config useless ([#9436](https://github.com/sveltejs/kit/pull/9436))

### Patch Changes

- fix: don't show cron warning when everything's valid ([#9436](https://github.com/sveltejs/kit/pull/9436))

- fix: allow to set isr to false to clear isr config in leafs ([#9436](https://github.com/sveltejs/kit/pull/9436))

## 2.3.2

### Patch Changes

- fix: throw error if `isr` is combined with `runtime: 'edge'` ([#9432](https://github.com/sveltejs/kit/pull/9432))

- Updated dependencies [[`385bd49e`](https://github.com/sveltejs/kit/commit/385bd49efb6890078dcdb523fdf5b621fe1c3e72), [`29ffc785`](https://github.com/sveltejs/kit/commit/29ffc78560a99ce387b10a24f48b7f01205f51e7), [`d257d37d`](https://github.com/sveltejs/kit/commit/d257d37d3cac94f30befa9fe38c2987f84fb551a), [`c45c35e7`](https://github.com/sveltejs/kit/commit/c45c35e7b40837cd1bea3fc26cfb831478e03c00), [`75e2c6f7`](https://github.com/sveltejs/kit/commit/75e2c6f7c8376685317b669767c7767fd21670eb), [`1c085780`](https://github.com/sveltejs/kit/commit/1c08578031395377a98b365a27eb9587594dd06e)]:
  - @sveltejs/kit@1.12.0

## 2.3.1

### Patch Changes

- docs: remove comment discourage direct use of adapters ([#9344](https://github.com/sveltejs/kit/pull/9344))

- Updated dependencies [[`b575287d`](https://github.com/sveltejs/kit/commit/b575287d063562868d7726f6451352aa43a63453), [`8114c658`](https://github.com/sveltejs/kit/commit/8114c658c0bc053198ff76704c002cfeb8225e2a), [`620f5605`](https://github.com/sveltejs/kit/commit/620f56058de0993e776c146db4c19fca97b9cb39), [`6a91e887`](https://github.com/sveltejs/kit/commit/6a91e887ee4c1bef8aabfafbf1ab6079113c2832), [`1c32723a`](https://github.com/sveltejs/kit/commit/1c32723a52beca0c5aa895b1114341da78d92eaf), [`0f863bbc`](https://github.com/sveltejs/kit/commit/0f863bbc957ab2ed37b04ebd839fc864b945034d), [`78b4a1bb`](https://github.com/sveltejs/kit/commit/78b4a1bb5e1ae11a894d70a0a28cc344ea0b1284), [`66b2f4ef`](https://github.com/sveltejs/kit/commit/66b2f4ef03a5dd60da2757edde4effcfdf3183cf), [`5dada256`](https://github.com/sveltejs/kit/commit/5dada256dc05674a18946f8f19db1f25ba91aeaf), [`a71b5e69`](https://github.com/sveltejs/kit/commit/a71b5e69ef37ce46e8e8590d537036cb7e267d51), [`daad7e48`](https://github.com/sveltejs/kit/commit/daad7e48b175245cbb7efd0e255263bfb52a5ee6), [`18d330b1`](https://github.com/sveltejs/kit/commit/18d330b16330d76c4b2991839c6b4462d5a4163f), [`18d7e81a`](https://github.com/sveltejs/kit/commit/18d7e81a9892e718c3cd07b2366a60f2e09561ab)]:
  - @sveltejs/kit@1.11.0

## 2.3.0

### Minor Changes

- feat: provide access to request context via `event.platform` ([#9280](https://github.com/sveltejs/kit/pull/9280))

### Patch Changes

- Updated dependencies [[`2b647fd8`](https://github.com/sveltejs/kit/commit/2b647fd85be028bc5775894567ee8b13f91411a7), [`fbe4fe76`](https://github.com/sveltejs/kit/commit/fbe4fe768140abac09bd66edd12c77787cafc2c5), [`744dc81c`](https://github.com/sveltejs/kit/commit/744dc81c6b0d8cade087df733c6d3d3f1281e68c)]:
  - @sveltejs/kit@1.10.0

## 2.2.1

### Patch Changes

- fix: add catch-all route for 404s ([#9265](https://github.com/sveltejs/kit/pull/9265))

## 2.2.0

### Minor Changes

- feat: validate that Vercel cron paths match an API path ([#9145](https://github.com/sveltejs/kit/pull/9145))

## 2.1.1

### Patch Changes

- fix: move catch-all-regex to the end ([#9185](https://github.com/sveltejs/kit/pull/9185))

- fix: temporarily disable streaming when ISR is used ([#9197](https://github.com/sveltejs/kit/pull/9197))

## 2.1.0

### Minor Changes

- feat: enable experimental response streaming ([#9144](https://github.com/sveltejs/kit/pull/9144))

## 2.0.4

### Patch Changes

- fix: add leading / to isr routes ([#9100](https://github.com/sveltejs/kit/pull/9100))

## 2.0.3

### Patch Changes

- fix: get ISR working on Vercel ([#9063](https://github.com/sveltejs/kit/pull/9063))

## 2.0.2

### Patch Changes

- fix: mark `expiration` as required ([#8943](https://github.com/sveltejs/kit/pull/8943))

- Updated dependencies [[`1960296d`](https://github.com/sveltejs/kit/commit/1960296da62fdd4ad8e8bb7286940b98fbe8db0f), [`1beb19cb`](https://github.com/sveltejs/kit/commit/1beb19cb487bd6d719048f0feedcb2fbee91a005), [`b915dfe9`](https://github.com/sveltejs/kit/commit/b915dfe9d16a930246a469c9aea8c1a84e5157ba), [`a402d50b`](https://github.com/sveltejs/kit/commit/a402d50b33eba2a937d09e635275c319061ce678)]:
  - @sveltejs/kit@1.5.1

## 2.0.1

### Patch Changes

- chore: throw helpful migration error ([#8915](https://github.com/sveltejs/kit/pull/8915))

## 2.0.0

### Major Changes

- breaking: bump `@sveltejs/kit` peer dependency ([#8740](https://github.com/sveltejs/kit/pull/8740))

### Minor Changes

- feat: support route-level configuration options ([#8740](https://github.com/sveltejs/kit/pull/8740))

### Patch Changes

- Updated dependencies [[`c7648f66`](https://github.com/sveltejs/kit/commit/c7648f6608a413e2654625cbd30f890d2148cf13), [`63613bf1`](https://github.com/sveltejs/kit/commit/63613bf194c18ce50e111585ad770fc93f9e43c7), [`d1f7655e`](https://github.com/sveltejs/kit/commit/d1f7655efdff70d91f94fe0cb0de50ed2511b5e5)]:
  - @sveltejs/kit@1.5.0

## 1.0.6

### Patch Changes

- fix: add trailing slash -> no trailing slash redirect for prerendered pages ([#8766](https://github.com/sveltejs/kit/pull/8766))

- Updated dependencies [[`438e4318`](https://github.com/sveltejs/kit/commit/438e4318e96f3e192e273b95d20ee8f590e99829)]:
  - @sveltejs/kit@1.3.4

## 1.0.5

### Patch Changes

- docs: move adapter docs to site ([#8531](https://github.com/sveltejs/kit/pull/8531))

## 1.0.4

### Patch Changes

- fix: publish missing files ([#8532](https://github.com/sveltejs/kit/pull/8532))

## 1.0.3

### Patch Changes

- chore: remove superfluous main field from package.json ([#8519](https://github.com/sveltejs/kit/pull/8519))

- Updated dependencies [[`7e2d3405`](https://github.com/sveltejs/kit/commit/7e2d34056e99f371e22406d941b764df365a2649)]:
  - @sveltejs/kit@1.1.1

## 1.0.2

### Patch Changes

- docs: add note about inability to access file system at runtime ([#8441](https://github.com/sveltejs/kit/pull/8441))

- Updated dependencies [[`9c01c32e`](https://github.com/sveltejs/kit/commit/9c01c32ef72bbed630fadcb8283f8f8533ced5e1), [`b6ca02a6`](https://github.com/sveltejs/kit/commit/b6ca02a684dbf13a3138b552e2d2be64697f2254), [`130abe43`](https://github.com/sveltejs/kit/commit/130abe43cef2cfbaf922aa16b20cbd4332a07c15), [`c4137536`](https://github.com/sveltejs/kit/commit/c4137536f2c6572eaeec1a82ccea0852f5be6b98), [`40464efa`](https://github.com/sveltejs/kit/commit/40464efab172a17f0b637d7dadea30d77ef1ed10), [`ce028470`](https://github.com/sveltejs/kit/commit/ce0284708184198efdd30f3ff72fd579cef830b4)]:
  - @sveltejs/kit@1.0.12

## 1.0.1

### Patch Changes

- fix: only apply immutable cache-control headers to immutable assets ([#8332](https://github.com/sveltejs/kit/pull/8332))

## 1.0.0

### Major Changes

First major release, see below for the history of changes that lead up to this.
Starting from now all releases follow semver and changes will be listed as Major/Minor/Patch

## 1.0.0-next.88

### Patch Changes

- chore: add peerDependencies, add more specific next version ([#8141](https://github.com/sveltejs/kit/pull/8141))

## 1.0.0-next.87

### Patch Changes

- fix: revert platform change from browser to neutral ([#8122](https://github.com/sveltejs/kit/pull/8122))

## 1.0.0-next.86

### Patch Changes

- fix: set esbuild platform to neutral ([#8083](https://github.com/sveltejs/kit/pull/8083))

## 1.0.0-next.85

### Patch Changes

- update esbuild to ^0.16.3 ([#7543](https://github.com/sveltejs/kit/pull/7543))

## 1.0.0-next.84

### Patch Changes

- fix: Write redirects for prerendered pages with trailing slashes ([#7747](https://github.com/sveltejs/kit/pull/7747))

## 1.0.0-next.83

### Patch Changes

- fix: handle root route for split config ([#7741](https://github.com/sveltejs/kit/pull/7741))

## 1.0.0-next.82

### Patch Changes

- Handle redirects inside SvelteKit ([#7719](https://github.com/sveltejs/kit/pull/7719))

## 1.0.0-next.81

### Patch Changes

- update dependencies ([#7355](https://github.com/sveltejs/kit/pull/7355))

## 1.0.0-next.80

### Patch Changes

- fix: don't fail on unknown error message ([#7312](https://github.com/sveltejs/kit/pull/7312))

## 1.0.0-next.79

### Patch Changes

- Use config.kit.paths.base prefix for static assets ([#4448](https://github.com/sveltejs/kit/pull/4448))

## 1.0.0-next.78

### Patch Changes

- Transfer server data as devalue-encoded JSON ([#7177](https://github.com/sveltejs/kit/pull/7177))

## 1.0.0-next.77

### Patch Changes

- Redact error message if `getRequest` fails ([#6936](https://github.com/sveltejs/kit/pull/6936))

## 1.0.0-next.76

### Patch Changes

- chore: bump esbuild ([#6829](https://github.com/sveltejs/kit/pull/6829))

## 1.0.0-next.75

### Patch Changes

- Ignore warnings when traced file fails to parse ([#6810](https://github.com/sveltejs/kit/pull/6810))

## 1.0.0-next.74

### Patch Changes

- Update to esbuild 0.15 ([#6740](https://github.com/sveltejs/kit/pull/6740))

## 1.0.0-next.73

### Patch Changes

- breaking: request creation cleanup ([#6681](https://github.com/sveltejs/kit/pull/6681))

## 1.0.0-next.72

### Patch Changes

- Fix `global is not defined` runtime error building with `edge: true` option ([#6425](https://github.com/sveltejs/kit/pull/6425))

## 1.0.0-next.71

### Patch Changes

- Use devalue to serialize server-only `load` return values ([#6318](https://github.com/sveltejs/kit/pull/6318))

## 1.0.0-next.70

### Patch Changes

- Don't use top-level-await, as it is not supported right now ([#6360](https://github.com/sveltejs/kit/pull/6360))

## 1.0.0-next.69

### Patch Changes

- Run `server.init()` for edge functions ([#6327](https://github.com/sveltejs/kit/pull/6327))

## 1.0.0-next.68

### Patch Changes

- feat: Moved hooks.js initialization from Server.respond into Server.init ([#6179](https://github.com/sveltejs/kit/pull/6179))

## 1.0.0-next.67

### Patch Changes

- Use `platform: 'browser'` for esbuild in Vercel Edge Functions. ([#6109](https://github.com/sveltejs/kit/pull/6109))

## 1.0.0-next.66

### Patch Changes

- Initialise `env` ([#5663](https://github.com/sveltejs/kit/pull/5663))

## 1.0.0-next.65

### Patch Changes

- breaking: remove writeStatic to align with Vite ([#5618](https://github.com/sveltejs/kit/pull/5618))

## 1.0.0-next.64

### Patch Changes

- Don't remove .vercel/output directory ([#5555](https://github.com/sveltejs/kit/pull/5555))

## 1.0.0-next.63

### Patch Changes

- Print friendlier message if adapter-vercel fails to resolve dependencies ([#5551](https://github.com/sveltejs/kit/pull/5551))

## 1.0.0-next.62

### Patch Changes

- Update dependencies ([#5005](https://github.com/sveltejs/kit/pull/5005))

## 1.0.0-next.61

### Patch Changes

- Remove ENABLE_VC_BUILD check, use v3 build output API for all apps deployed to Vercel ([#5514](https://github.com/sveltejs/kit/pull/5514))

## 1.0.0-next.60

### Patch Changes

- chore: upgrade TypeScript to 4.7.4 ([#5414](https://github.com/sveltejs/kit/pull/5414))

## 1.0.0-next.59

### Patch Changes

- Add sourcemap generation for the generated functions ([#5197](https://github.com/sveltejs/kit/pull/5197))

## 1.0.0-next.58

### Patch Changes

- Update dependencies ([#5121](https://github.com/sveltejs/kit/pull/5121))

## 1.0.0-next.57

### Patch Changes

- Update adapter entrypoint typings to be NodeNext/ESNext-compatible ([#5111](https://github.com/sveltejs/kit/pull/5111))

## 1.0.0-next.56

### Patch Changes

- Use @vercel/nft to include dependencies in lambda without bundling with esbuild, when using v3 build output API ([#4969](https://github.com/sveltejs/kit/pull/4969))

* only serve `_app/immutable` with immutable cache header, not `_app/version.json` ([#5051](https://github.com/sveltejs/kit/pull/5051))

## 1.0.0-next.55

### Patch Changes

- Add types to pkg.exports ([#5045](https://github.com/sveltejs/kit/pull/5045))

## 1.0.0-next.54

### Patch Changes

- breaking: replace @sveltejs/kit/install-fetch with @sveltejs/kit/node/polyfills ([#4934](https://github.com/sveltejs/kit/pull/4934))

## 1.0.0-next.53

### Patch Changes

- Revert to cjs mode when building for lambda ([#4967](https://github.com/sveltejs/kit/pull/4967))

## 1.0.0-next.52

### Patch Changes

- breaking: drop Node 14 support ([#4922](https://github.com/sveltejs/kit/pull/4922))

* Use general purpose Edge Functions instead of piggybacking Middleware for Edge Deployment + fix split mode ([#4883](https://github.com/sveltejs/kit/pull/4883))

## 1.0.0-next.51

### Patch Changes

- Support for Node.js 16 ([#4904](https://github.com/sveltejs/kit/pull/4904))
- The output of serverless now is ESM instead of CJS ([#4904](https://github.com/sveltejs/kit/pull/4904))

## 1.0.0-next.50

### Patch Changes

- Fix `edge: true, split: true` build error for root routes when deploying to Vercel ([#4731](https://github.com/sveltejs/kit/pull/4731))

## 1.0.0-next.49

### Patch Changes

- Remove unused target option from config.json ([#4678](https://github.com/sveltejs/kit/pull/4678))

## 1.0.0-next.48

### Patch Changes

- Support build output API, with edge functions and code-splitting ([#4663](https://github.com/sveltejs/kit/pull/4663))

## 1.0.0-next.47

### Patch Changes

- Provide getClientAddress function ([#4289](https://github.com/sveltejs/kit/pull/4289))

## 1.0.0-next.46

### Patch Changes

- breaking: replace builder.prerender() with builder.writePrerendered() and builder.prerendered ([#4192](https://github.com/sveltejs/kit/pull/4192)) ([#4229](https://github.com/sveltejs/kit/pull/4229))

## 1.0.0-next.45

### Patch Changes

- Rename `__fetch_polyfill` to `installFetch` ([#4111](https://github.com/sveltejs/kit/pull/4111))

## 1.0.0-next.44

### Patch Changes

- breaking: rename `app.render` to `server.respond` ([#4034](https://github.com/sveltejs/kit/pull/4034))

## 1.0.0-next.43

### Patch Changes

- Add prerendered routes to config ([#3822](https://github.com/sveltejs/kit/pull/3822))

## 1.0.0-next.42

### Patch Changes

- Clean URLs and handle trailingSlash configuration ([#3820](https://github.com/sveltejs/kit/pull/3820))

## 1.0.0-next.41

### Patch Changes

- update to Vite 2.8 and esbuild 0.14 ([#3791](https://github.com/sveltejs/kit/pull/3791))

## 1.0.0-next.40

### Patch Changes

- Expose external option ([#3614](https://github.com/sveltejs/kit/pull/3614))

## 1.0.0-next.39

### Patch Changes

- Breaking: change app.render signature to (request: Request) => Promise<Response> ([#3384](https://github.com/sveltejs/kit/pull/3384))

## 1.0.0-next.38

### Patch Changes

- Polyfill fetch before running any app code ([#3400](https://github.com/sveltejs/kit/pull/3400))

## 1.0.0-next.37

### Patch Changes

- Allow `__fetchPolyfill()` to run several times ([#3377](https://github.com/sveltejs/kit/pull/3377))

## 1.0.0-next.36

### Patch Changes

- Add immutable cache headers to generated assets ([#3222](https://github.com/sveltejs/kit/pull/3222))

## 1.0.0-next.35

### Patch Changes

- Use path.posix to resolve routes for esmodules ([#3200](https://github.com/sveltejs/kit/pull/3200))

## 1.0.0-next.34

### Patch Changes

- Revert to v1 filesystem API ([#3149](https://github.com/sveltejs/kit/pull/3149))

## 1.0.0-next.33

### Patch Changes

- Overhaul adapter API ([#2931](https://github.com/sveltejs/kit/pull/2931))
- Remove esbuild options ([#2931](https://github.com/sveltejs/kit/pull/2931))
- Update adapters to provide app.render with a url ([#3133](https://github.com/sveltejs/kit/pull/3133))

## 1.0.0-next.32

### Patch Changes

- update to esbuild 0.13.15 and other dependency updates ([#2957](https://github.com/sveltejs/kit/pull/2957))

## 1.0.0-next.31

### Patch Changes

- update dependencies ([#2574](https://github.com/sveltejs/kit/pull/2574))

## 1.0.0-next.30

### Patch Changes

- update to vite 2.6.0 and esbuild 0.13 ([#2522](https://github.com/sveltejs/kit/pull/2522))

## 1.0.0-next.29

### Patch Changes

- chore: add links to repository and homepage to package.json ([#2425](https://github.com/sveltejs/kit/pull/2425))

## 1.0.0-next.28

### Patch Changes

- chore: export package.json from adapters ([#2351](https://github.com/sveltejs/kit/pull/2351))

## 1.0.0-next.27

### Patch Changes

- d81de603: revert adapters automatically updating .gitignore ([#1924](https://github.com/sveltejs/kit/pull/1924))

## 1.0.0-next.26

### Patch Changes

- e9f78999: fix: include esbuild config in adapter type definition ([#1954](https://github.com/sveltejs/kit/pull/1954))

## 1.0.0-next.25

### Patch Changes

- e6995797: feat(adapters): expose esbuild configuration ([#1914](https://github.com/sveltejs/kit/pull/1914))

## 1.0.0-next.24

### Patch Changes

- 2ac5781: Use esbuild inject API to insert shims ([#1822](https://github.com/sveltejs/kit/pull/1822))

## 1.0.0-next.23

### Patch Changes

- 9f0c54a: Externalize app initialization to adapters ([#1804](https://github.com/sveltejs/kit/pull/1804))

## 1.0.0-next.22

### Patch Changes

- c51ab7d: Upgrade esbuild to ^0.12.5 ([#1627](https://github.com/sveltejs/kit/pull/1627))

## 1.0.0-next.21

### Patch Changes

- edc307d: Remove peerDependencies due to pnpm bug ([#1621](https://github.com/sveltejs/kit/pull/1621))
- 2636e68: Attempt to fix peerDependencies specification ([#1620](https://github.com/sveltejs/kit/pull/1620))

## 1.0.0-next.20

### Patch Changes

- c3d36a3: ensure `content-length` limit respected; handle `getRawBody` error(s) ([#1528](https://github.com/sveltejs/kit/pull/1528))
- 028abd9: Pass validated svelte config to adapter adapt function ([#1559](https://github.com/sveltejs/kit/pull/1559))
- Updated dependencies [6372690]
- Updated dependencies [c3d36a3]
- Updated dependencies [bf77940]
- Updated dependencies [2172469]
- Updated dependencies [028abd9]
  - @sveltejs/kit@1.0.0-next.110

## 1.0.0-next.19

### Patch Changes

- dca4946: Make kit a peerDependency of the adapters ([#1505](https://github.com/sveltejs/kit/pull/1505))
- Updated dependencies [261ee1c]
- Updated dependencies [ec156c6]
- Updated dependencies [586785d]
  - @sveltejs/kit@1.0.0-next.109

## 1.0.0-next.18

### Patch Changes

- dad93fc: Fix workspace dependencies ([#1434](https://github.com/sveltejs/kit/pull/1434))
- Updated dependencies [dad93fc]
- Updated dependencies [37fc04f]
  - @sveltejs/kit@1.0.0-next.108

## 1.0.0-next.17

### Patch Changes

- 9b448a6: Rename @sveltejs/kit/http to @sveltejs/kit/node ([#1391](https://github.com/sveltejs/kit/pull/1391))
- Updated dependencies [9b448a6]
  - @sveltejs/kit@1.0.0-next.104

## 1.0.0-next.16

### Patch Changes

- c6fde99: Convert to ESM ([#1323](https://github.com/sveltejs/kit/pull/1323))
- Updated dependencies [694f5de]
- Updated dependencies [0befffb]
- Updated dependencies [c6fde99]
  - @sveltejs/kit@1.0.0-next.97

## 1.0.0-next.15

### Patch Changes

- 2e72a94: Add type declarations ([#1230](https://github.com/sveltejs/kit/pull/1230))
- Updated dependencies [82955ec]
  - @sveltejs/kit@1.0.0-next.91

## 1.0.0-next.14

### Patch Changes

- 59f9277: fix body parsing ([#1146](https://github.com/sveltejs/kit/pull/1146))

## 1.0.0-next.13

### Patch Changes

- 1237eb3: Fix dependencies ([#1109](https://github.com/sveltejs/kit/pull/1109))
- 1237eb3: Use getRawBody in adapter-vercel ([#1109](https://github.com/sveltejs/kit/pull/1109))
- Updated dependencies [1237eb3]
- Updated dependencies [1237eb3]
  - @sveltejs/kit@1.0.0-next.81

## 1.0.0-next.12

### Patch Changes

- 7a4b351: Bundle serverless functions with esbuild ([#1091](https://github.com/sveltejs/kit/pull/1091))

## 1.0.0-next.11

### Patch Changes

- 6e27880: Move server-side fetch to adapters instead of build step ([#1066](https://github.com/sveltejs/kit/pull/1066))

## 1.0.0-next.10

### Patch Changes

- feb2db7: Simplify parsing of URLS of incoming requests ([#802](https://github.com/sveltejs/kit/pull/802))

## 1.0.0-next.9

### Patch Changes

- ca33a35: Fix adapter-vercel query parsing and update adapter-node's ([#774](https://github.com/sveltejs/kit/pull/774))

## 1.0.0-next.8

### Patch Changes

- 8024178: remove @sveltejs/app-utils ([#600](https://github.com/sveltejs/kit/pull/600))

## 1.0.0-next.7

### Patch Changes

- 17e82eb: Fix adapter-vercel imports ([#588](https://github.com/sveltejs/kit/pull/588))

## 1.0.0-next.6

### Patch Changes

- 8805c6d: Pass adapters directly to svelte.config.cjs ([#579](https://github.com/sveltejs/kit/pull/579))

## 1.0.0-next.5

### Patch Changes

- f35a5cd: Change adapter signature ([#505](https://github.com/sveltejs/kit/pull/505))

## 1.0.0-next.4

### Patch Changes

- c3cf3f3: Bump deps ([#492](https://github.com/sveltejs/kit/pull/492))
- d742029: Fix mixed usage of CJS and ESM ([#483](https://github.com/sveltejs/kit/pull/483))
- Updated dependencies [c3cf3f3]
  - @sveltejs/app-utils@1.0.0-next.3

## 1.0.0-next.3

### Patch Changes

- 8123929: Fix adapter-vercel using the wrong directory ([#450](https://github.com/sveltejs/kit/pull/450))
- Updated dependencies [73dd998]
- Updated dependencies [b800049]
  - @sveltejs/app-utils@1.0.0-next.2

## 1.0.0-next.2

### Patch Changes

- Fix adapters and convert to ES modules

## 1.0.0-next.1

### Patch Changes

- Update to new adapter API

## 0.0.3

### Patch Changes

- 67eaeea: Move app-utils stuff into subpackages

## 0.0.2

### Patch Changes

- Use setup

## 0.0.1

### Patch Changes

- 0320208: Rename 'server route' to 'endpoint'
- 5ca907c: Use shared mkdirp helper

####### packages/adapter-vercel/files/edge.js #######

```

import { Server } from 'SERVER';
import { manifest } from 'MANIFEST';

const server = new Server(manifest);
const initialized = server.init({
	env: /** @type {Record<string, string>} */ (process.env)
});

/**
 * @param {Request} request
 * @param {import('../index.js').RequestContext} context
 */
export default async (request, context) => {
	await initialized;

	return server.respond(request, {
		getClientAddress() {
			return /** @type {string} */ (request.headers.get('x-forwarded-for'));
		},
		platform: {
			context
		}
	});
};

```


####### packages/adapter-vercel/files/serverless.js #######

```

import { installPolyfills } from '@sveltejs/kit/node/polyfills';
import { getRequest, setResponse, createReadableStream } from '@sveltejs/kit/node';
import { Server } from 'SERVER';
import { manifest } from 'MANIFEST';

installPolyfills();

const server = new Server(manifest);

await server.init({
	env: /** @type {Record<string, string>} */ (process.env),
	read: createReadableStream
});

const DATA_SUFFIX = '/__data.json';

/**
 * @param {import('http').IncomingMessage} req
 * @param {import('http').ServerResponse} res
 */
export default async (req, res) => {
	if (req.url) {
		const [path, search] = req.url.split('?');

		const params = new URLSearchParams(search);
		let pathname = params.get('__pathname');

		if (pathname) {
			params.delete('__pathname');
			// Optional routes' pathname replacements look like `/foo/$1/bar` which means we could end up with an url like /foo//bar
			pathname = pathname.replace(/\/+/g, '/');
			req.url = `${pathname}${path.endsWith(DATA_SUFFIX) ? DATA_SUFFIX : ''}?${params}`;
		}
	}

	const request = await getRequest({ base: `https://${req.headers.host}`, request: req });

	setResponse(
		res,
		await server.respond(request, {
			getClientAddress() {
				return /** @type {string} */ (request.headers.get('x-forwarded-for'));
			}
		})
	);
};

```


####### packages/adapter-vercel/index.d.ts #######

```

import { Adapter } from '@sveltejs/kit';
import './ambient.js';

export default function plugin(config?: Config): Adapter;

export interface ServerlessConfig {
	/**
	 * Whether to use [Edge Functions](https://vercel.com/docs/concepts/functions/edge-functions) (`'edge'`) or [Serverless Functions](https://vercel.com/docs/concepts/functions/serverless-functions) (`'nodejs18.x'`, `'nodejs20.x'` etc).
	 * @default 'nodejs18.x'
	 */
	runtime?: `nodejs${number}.x`;
	/**
	 * To which regions to deploy the app. A list of regions.
	 * More info: https://vercel.com/docs/concepts/edge-network/regions
	 */
	regions?: string[];
	/**
	 * Maximum execution duration (in seconds) that will be allowed for the Serverless Function.
	 * Serverless only.
	 */
	maxDuration?: number;
	/**
	 * Amount of memory (RAM in MB) that will be allocated to the Serverless Function.
	 * Serverless only.
	 */
	memory?: number;
	/**
	 * If `true`, this route will always be deployed as its own separate function
	 */
	split?: boolean;

	/**
	 * https://vercel.com/docs/build-output-api/v3/configuration#images
	 */
	images?: ImagesConfig;

	/**
	 * [Incremental Static Regeneration](https://vercel.com/docs/concepts/incremental-static-regeneration/overview) configuration.
	 * Serverless only.
	 */
	isr?:
		| {
				/**
				 * Expiration time (in seconds) before the cached asset will be re-generated by invoking the Serverless Function. Setting the value to `false` means it will never expire.
				 */
				expiration: number | false;
				/**
				 * Random token that can be provided in the URL to bypass the cached version of the asset, by requesting the asset
				 * with a __prerender_bypass=<token> cookie.
				 *
				 * Making a `GET` or `HEAD` request with `x-prerender-revalidate: <token>` will force the asset to be re-validated.
				 */
				bypassToken?: string;
				/**
				 * List of query string parameter names that will be cached independently. If an empty array, query values are not considered for caching. If undefined each unique query value is cached independently
				 */
				allowQuery?: string[] | undefined;
		  }
		| false;
}

type ImageFormat = 'image/avif' | 'image/webp';

type RemotePattern = {
	protocol?: 'http' | 'https';
	hostname: string;
	port?: string;
	pathname?: string;
};

type ImagesConfig = {
	sizes: number[];
	domains: string[];
	remotePatterns?: RemotePattern[];
	minimumCacheTTL?: number; // seconds
	formats?: ImageFormat[];
	dangerouslyAllowSVG?: boolean;
	contentSecurityPolicy?: string;
	contentDispositionType?: string;
};

export interface EdgeConfig {
	/**
	 * Whether to use [Edge Functions](https://vercel.com/docs/concepts/functions/edge-functions) (`'edge'`) or [Serverless Functions](https://vercel.com/docs/concepts/functions/serverless-functions) (`'nodejs18.x'`, `'nodejs20.x'` etc).
	 */
	runtime?: 'edge';
	/**
	 * To which regions to deploy the app. A list of regions or `'all'`.
	 * More info: https://vercel.com/docs/concepts/edge-network/regions
	 */
	regions?: string[] | 'all';
	/**
	 * List of packages that should not be bundled into the Edge Function.
	 * Edge only.
	 */
	external?: string[];
	/**
	 * If `true`, this route will always be deployed as its own separate function
	 */
	split?: boolean;
}

export type Config = EdgeConfig | ServerlessConfig;

// we copy the RequestContext interface from `@vercel/edge` because that package can't co-exist with `@types/node`.
// see https://github.com/sveltejs/kit/pull/9280#issuecomment-1452110035

/**
 * An extension to the standard `Request` object that is passed to every Edge Function.
 *
 * @example
 * ```ts
 * import type { RequestContext } from '@vercel/edge';
 *
 * export default async function handler(request: Request, ctx: RequestContext): Promise<Response> {
 *   // ctx is the RequestContext
 * }
 * ```
 */
export interface RequestContext {
	/**
	 * A method that can be used to keep the function running after a response has been sent.
	 * This is useful when you have an async task that you want to keep running even after the
	 * response has been sent and the request has ended.
	 *
	 * @example
	 *
	 * <caption>Sending an internal error to an error tracking service</caption>
	 *
	 * ```ts
	 * import type { RequestContext } from '@vercel/edge';
	 *
	 * export async function handleRequest(request: Request, ctx: RequestContext): Promise<Response> {
	 *  try {
	 *    return await myFunctionThatReturnsResponse();
	 *  } catch (e) {
	 *    ctx.waitUntil((async () => {
	 *      // report this error to your error tracking service
	 *      await fetch('https://my-error-tracking-service.com', {
	 *        method: 'POST',
	 *        body: JSON.stringify({
	 *          stack: e.stack,
	 *          message: e.message,
	 *          name: e.name,
	 *          url: request.url,
	 *        }),
	 *      });
	 *    })());
	 *    return new Response('Internal Server Error', { status: 500 });
	 *  }
	 * }
	 * ```
	 */
	waitUntil(
		/**
		 * A promise that will be kept alive until it resolves or rejects.
		 */ promise: Promise<unknown>
	): void;
}

```


####### packages/adapter-vercel/index.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';
import { nodeFileTrace } from '@vercel/nft';
import esbuild from 'esbuild';
import { get_pathname, pattern_to_src } from './utils.js';
import { VERSION } from '@sveltejs/kit';

const name = '@sveltejs/adapter-vercel';
const DEFAULT_FUNCTION_NAME = 'fn';

const get_default_runtime = () => {
	const major = process.version.slice(1).split('.')[0];
	if (major === '18') return 'nodejs18.x';
	if (major === '20') return 'nodejs20.x';

	throw new Error(
		`Unsupported Node.js version: ${process.version}. Please use Node 18 or Node 20 to build your project, or explicitly specify a runtime in your adapter configuration.`
	);
};

// https://vercel.com/docs/functions/edge-functions/edge-runtime#compatible-node.js-modules
const compatible_node_modules = ['async_hooks', 'events', 'buffer', 'assert', 'util'];

/** @type {import('.').default} **/
const plugin = function (defaults = {}) {
	if ('edge' in defaults) {
		throw new Error("{ edge: true } has been removed in favour of { runtime: 'edge' }");
	}

	return {
		name,

		async adapt(builder) {
			if (!builder.routes) {
				throw new Error(
					'@sveltejs/adapter-vercel >=2.x (possibly installed through @sveltejs/adapter-auto) requires @sveltejs/kit version 1.5 or higher. ' +
						'Either downgrade the adapter or upgrade @sveltejs/kit'
				);
			}

			const dir = '.vercel/output';
			const tmp = builder.getBuildDirectory('vercel-tmp');

			builder.rimraf(dir);
			builder.rimraf(tmp);

			if (fs.existsSync('vercel.json')) {
				const vercel_file = fs.readFileSync('vercel.json', 'utf-8');
				const vercel_config = JSON.parse(vercel_file);
				validate_vercel_json(builder, vercel_config);
			}

			const files = fileURLToPath(new URL('./files', import.meta.url).href);

			const dirs = {
				static: `${dir}/static${builder.config.kit.paths.base}`,
				functions: `${dir}/functions`
			};

			builder.log.minor('Copying assets...');

			builder.writeClient(dirs.static);
			builder.writePrerendered(dirs.static);

			const static_config = static_vercel_config(builder, defaults, dirs.static);

			builder.log.minor('Generating serverless function...');

			/**
			 * @param {string} name
			 * @param {import('.').ServerlessConfig} config
			 * @param {import('@sveltejs/kit').RouteDefinition<import('.').Config>[]} routes
			 */
			async function generate_serverless_function(name, config, routes) {
				const dir = `${dirs.functions}/${name}.func`;

				const relativePath = path.posix.relative(tmp, builder.getServerDirectory());

				builder.copy(`${files}/serverless.js`, `${tmp}/index.js`, {
					replace: {
						SERVER: `${relativePath}/index.js`,
						MANIFEST: './manifest.js'
					}
				});

				write(
					`${tmp}/manifest.js`,
					`export const manifest = ${builder.generateManifest({ relativePath, routes })};\n`
				);

				await create_function_bundle(builder, `${tmp}/index.js`, dir, config);

				for (const asset of builder.findServerAssets(routes)) {
					// TODO use symlinks, once Build Output API supports doing so
					builder.copy(`${builder.getServerDirectory()}/${asset}`, `${dir}/${asset}`);
				}
			}

			/**
			 * @param {string} name
			 * @param {import('.').EdgeConfig} config
			 * @param {import('@sveltejs/kit').RouteDefinition<import('.').EdgeConfig>[]} routes
			 */
			async function generate_edge_function(name, config, routes) {
				const tmp = builder.getBuildDirectory(`vercel-tmp/${name}`);
				const relativePath = path.posix.relative(tmp, builder.getServerDirectory());

				builder.copy(`${files}/edge.js`, `${tmp}/edge.js`, {
					replace: {
						SERVER: `${relativePath}/index.js`,
						MANIFEST: './manifest.js'
					}
				});

				write(
					`${tmp}/manifest.js`,
					`export const manifest = ${builder.generateManifest({ relativePath, routes })};\n`
				);

				try {
					const result = await esbuild.build({
						entryPoints: [`${tmp}/edge.js`],
						outfile: `${dirs.functions}/${name}.func/index.js`,
						target: 'es2020', // TODO verify what the edge runtime supports
						bundle: true,
						platform: 'browser',
						format: 'esm',
						external: [
							...compatible_node_modules,
							...compatible_node_modules.map((id) => `node:${id}`),
							...(config.external || [])
						],
						sourcemap: 'linked',
						banner: { js: 'globalThis.global = globalThis;' },
						loader: {
							'.wasm': 'copy'
						}
					});

					if (result.warnings.length > 0) {
						const formatted = await esbuild.formatMessages(result.warnings, {
							kind: 'warning',
							color: true
						});

						console.error(formatted.join('\n'));
					}
				} catch (error) {
					for (const e of error.errors) {
						for (const node of e.notes) {
							const match =
								/The package "(.+)" wasn't found on the file system but is built into node/.exec(
									node.text
								);

							if (match) {
								node.text = `Cannot use "${match[1]}" when deploying to Vercel Edge Functions.`;
							}
						}
					}

					const formatted = await esbuild.formatMessages(error.errors, {
						kind: 'error',
						color: true
					});

					console.error(formatted.join('\n'));

					throw new Error(
						`Bundling with esbuild failed with ${error.errors.length} ${
							error.errors.length === 1 ? 'error' : 'errors'
						}`
					);
				}

				write(
					`${dirs.functions}/${name}.func/.vc-config.json`,
					JSON.stringify(
						{
							runtime: config.runtime,
							regions: config.regions,
							entrypoint: 'index.js',
							framework: {
								slug: 'sveltekit',
								version: VERSION
							}
						},
						null,
						'\t'
					)
				);
			}

			/** @type {Map<string, { i: number, config: import('.').Config, routes: import('@sveltejs/kit').RouteDefinition<import('.').Config>[] }>} */
			const groups = new Map();

			/** @type {Map<string, { hash: string, route_id: string }>} */
			const conflicts = new Map();

			/** @type {Map<string, string>} */
			const functions = new Map();

			/** @type {Map<import('@sveltejs/kit').RouteDefinition<import('.').Config>, { expiration: number | false, bypassToken: string | undefined, allowQuery: string[], group: number, passQuery: true }>} */
			const isr_config = new Map();

			/** @type {Set<string>} */
			const ignored_isr = new Set();

			// group routes by config
			for (const route of builder.routes) {
				const runtime = route.config?.runtime ?? defaults?.runtime ?? get_default_runtime();
				const config = { runtime, ...defaults, ...route.config };

				if (is_prerendered(route)) {
					if (config.isr) {
						ignored_isr.add(route.id);
					}
					continue;
				}

				const node_runtime = /nodejs([0-9]+)\.x/.exec(runtime);
				if (runtime !== 'edge' && (!node_runtime || node_runtime[1] < 18)) {
					throw new Error(
						`Invalid runtime '${runtime}' for route ${route.id}. Valid runtimes are 'edge' and 'nodejs18.x' or higher ` +
							'(see the Node.js Version section in your Vercel project settings for info on the currently supported versions).'
					);
				}

				if (config.isr) {
					const directory = path.relative('.', builder.config.kit.files.routes + route.id);

					if (!runtime.startsWith('nodejs')) {
						throw new Error(
							`${directory}: Routes using \`isr\` must use a Node.js runtime (for example 'nodejs20.x')`
						);
					}

					if (config.isr.allowQuery?.includes('__pathname')) {
						throw new Error(
							`${directory}: \`__pathname\` is a reserved query parameter for \`isr.allowQuery\``
						);
					}

					isr_config.set(route, {
						expiration: config.isr.expiration,
						bypassToken: config.isr.bypassToken,
						allowQuery: ['__pathname', ...(config.isr.allowQuery ?? [])],
						group: isr_config.size + 1,
						passQuery: true
					});
				}

				const hash = hash_config(config);

				// first, check there are no routes with incompatible configs that will be merged
				const pattern = route.pattern.toString();
				const existing = conflicts.get(pattern);
				if (existing) {
					if (existing.hash !== hash) {
						throw new Error(
							`The ${route.id} and ${existing.route_id} routes must be merged into a single function that matches the ${route.pattern} regex, but they have incompatible configs. You must either rename one of the routes, or make their configs match.`
						);
					}
				} else {
					conflicts.set(pattern, { hash, route_id: route.id });
				}

				// then, create a group for each config
				const id = config.split ? `${hash}-${groups.size}` : hash;
				let group = groups.get(id);
				if (!group) {
					group = { i: groups.size, config, routes: [] };
					groups.set(id, group);
				}

				group.routes.push(route);
			}

			if (ignored_isr.size) {
				builder.log.warn(
					'\nWarning: The following routes have an ISR config which is ignored because the route is prerendered:'
				);

				for (const ignored of ignored_isr) {
					console.log(`    - ${ignored}`);
				}

				console.log(
					'Either remove the "prerender" option from these routes to use ISR, or remove the ISR config.\n'
				);
			}

			const singular = groups.size === 1;

			for (const group of groups.values()) {
				const generate_function =
					group.config.runtime === 'edge' ? generate_edge_function : generate_serverless_function;

				// generate one function for the group
				const name = singular ? DEFAULT_FUNCTION_NAME : `fn-${group.i}`;

				await generate_function(
					name,
					/** @type {any} */ (group.config),
					/** @type {import('@sveltejs/kit').RouteDefinition<any>[]} */ (group.routes)
				);

				for (const route of group.routes) {
					functions.set(route.pattern.toString(), name);
				}
			}

			for (const route of builder.routes) {
				if (is_prerendered(route)) continue;

				const pattern = route.pattern.toString();
				const src = pattern_to_src(pattern);
				const name = functions.get(pattern) ?? 'fn-0';

				const isr = isr_config.get(route);
				if (isr) {
					const isr_name = route.id.slice(1) || '__root__'; // should we check that __root__ isn't a route?
					const base = `${dirs.functions}/${isr_name}`;
					builder.mkdirp(base);

					const target = `${dirs.functions}/${name}.func`;
					const relative = path.relative(path.dirname(base), target);

					// create a symlink to the actual function, but use the
					// route name so that we can derive the correct URL
					fs.symlinkSync(relative, `${base}.func`);
					fs.symlinkSync(`../${relative}`, `${base}/__data.json.func`);

					const pathname = get_pathname(route);
					const json = JSON.stringify(isr, null, '\t');

					write(`${base}.prerender-config.json`, json);
					write(`${base}/__data.json.prerender-config.json`, json);

					const q = `?__pathname=/${pathname}`;

					static_config.routes.push({
						src: src + '$',
						dest: `/${isr_name}${q}`
					});

					static_config.routes.push({
						src: src + '/__data.json$',
						dest: `/${isr_name}/__data.json${q}`
					});
				} else if (!singular) {
					static_config.routes.push({ src: src + '(?:/__data.json)?$', dest: `/${name}` });
				}
			}

			if (!singular) {
				// we need to create a catch-all route so that 404s are handled
				// by SvelteKit rather than Vercel

				const runtime = defaults.runtime ?? get_default_runtime();
				const generate_function =
					runtime === 'edge' ? generate_edge_function : generate_serverless_function;

				await generate_function(
					DEFAULT_FUNCTION_NAME,
					/** @type {any} */ ({ runtime, ...defaults }),
					[]
				);
			}

			// Catch-all route must come at the end, otherwise it will swallow all other routes,
			// including ISR aliases if there is only one function
			static_config.routes.push({ src: '/.*', dest: `/${DEFAULT_FUNCTION_NAME}` });

			builder.log.minor('Writing routes...');

			write(`${dir}/config.json`, JSON.stringify(static_config, null, '\t'));
		},

		supports: {
			// reading from the filesystem only works in serverless functions
			read: ({ config, route }) => {
				const runtime = config.runtime ?? defaults.runtime;

				if (runtime === 'edge') {
					throw new Error(
						`${name}: Cannot use \`read\` from \`$app/server\` in route \`${route.id}\` configured with \`runtime: 'edge'\``
					);
				}

				return true;
			}
		}
	};
};

/** @param {import('.').EdgeConfig & import('.').ServerlessConfig} config */
function hash_config(config) {
	return [
		config.runtime ?? '',
		config.external ?? '',
		config.regions ?? '',
		config.memory ?? '',
		config.maxDuration ?? '',
		!!config.isr // need to distinguish ISR from non-ISR functions, because ISR functions can't use streaming mode
	].join('/');
}

/**
 * @param {string} file
 * @param {string} data
 */
function write(file, data) {
	try {
		fs.mkdirSync(path.dirname(file), { recursive: true });
	} catch {
		// do nothing
	}

	fs.writeFileSync(file, data);
}

// This function is duplicated in adapter-static
/**
 * @param {import('@sveltejs/kit').Builder} builder
 * @param {import('.').Config} config
 * @param {string} dir
 */
function static_vercel_config(builder, config, dir) {
	/** @type {any[]} */
	const prerendered_redirects = [];

	/** @type {Record<string, { path: string }>} */
	const overrides = {};

	/** @type {import('./index').ImagesConfig} */
	const images = config.images;

	for (const [src, redirect] of builder.prerendered.redirects) {
		prerendered_redirects.push({
			src,
			headers: {
				Location: redirect.location
			},
			status: redirect.status
		});
	}

	for (const [path, page] of builder.prerendered.pages) {
		let overrides_path = path.slice(1);

		if (path !== '/') {
			/** @type {string | undefined} */
			let counterpart_route = path + '/';

			if (path.endsWith('/')) {
				counterpart_route = path.slice(0, -1);
				overrides_path = path.slice(1, -1);
			}

			prerendered_redirects.push(
				{ src: path, dest: counterpart_route },
				{ src: counterpart_route, status: 308, headers: { Location: path } }
			);
		}

		overrides[page.file] = { path: overrides_path };
	}

	const routes = [
		...prerendered_redirects,
		{
			src: `/${builder.getAppPath()}/immutable/.+`,
			headers: {
				'cache-control': 'public, immutable, max-age=31536000'
			}
		}
	];

	// https://vercel.com/docs/deployments/skew-protection
	if (process.env.VERCEL_SKEW_PROTECTION_ENABLED) {
		routes.push({
			src: '/.*',
			has: [
				{
					type: 'header',
					key: 'Sec-Fetch-Dest',
					value: 'document'
				}
			],
			headers: {
				'Set-Cookie': `__vdpl=${process.env.VERCEL_DEPLOYMENT_ID}; Path=${builder.config.kit.paths.base}/; SameSite=Strict; Secure; HttpOnly`
			},
			continue: true
		});

		// this is a dreadful hack that is necessary until the Vercel Build Output API
		// allows you to set multiple cookies for a single route. essentially, since we
		// know that the entry file will be requested immediately, we can set the second
		// cookie in _that_ response rather than the document response
		const base = `${dir}/${builder.config.kit.appDir}/immutable/entry`;
		const entry = fs.readdirSync(base).find((file) => file.startsWith('start.'));

		if (!entry) {
			throw new Error('Could not find entry point');
		}

		routes.splice(-2, 0, {
			src: `/${builder.getAppPath()}/immutable/entry/${entry}`,
			headers: {
				'Set-Cookie': `__vdpl=; Path=/${builder.getAppPath()}/version.json; SameSite=Strict; Secure; HttpOnly`
			},
			continue: true
		});
	}

	routes.push({
		handle: 'filesystem'
	});

	return {
		version: 3,
		routes,
		overrides,
		images
	};
}

/**
 * @param {import('@sveltejs/kit').Builder} builder
 * @param {string} entry
 * @param {string} dir
 * @param {import('.').ServerlessConfig} config
 */
async function create_function_bundle(builder, entry, dir, config) {
	fs.rmSync(dir, { force: true, recursive: true });

	let base = entry;
	while (base !== (base = path.dirname(base)));

	const traced = await nodeFileTrace([entry], { base });

	/** @type {Map<string, string[]>} */
	const resolution_failures = new Map();

	traced.warnings.forEach((error) => {
		// pending https://github.com/vercel/nft/issues/284
		if (error.message.startsWith('Failed to resolve dependency node:')) return;

		// parse errors are likely not js and can safely be ignored,
		// such as this html file in "main" meant for nw instead of node:
		// https://github.com/vercel/nft/issues/311
		if (error.message.startsWith('Failed to parse')) return;

		if (error.message.startsWith('Failed to resolve dependency')) {
			const match = /Cannot find module '(.+?)' loaded from (.+)/;
			const [, module, importer] = match.exec(error.message) ?? [, error.message, '(unknown)'];

			if (!resolution_failures.has(importer)) {
				resolution_failures.set(importer, []);
			}

			/** @type {string[]} */ (resolution_failures.get(importer)).push(module);
		} else {
			throw error;
		}
	});

	if (resolution_failures.size > 0) {
		const cwd = process.cwd();
		builder.log.warn(
			'Warning: The following modules failed to locate dependencies that may (or may not) be required for your app to work:'
		);

		for (const [importer, modules] of resolution_failures) {
			console.error(`  ${path.relative(cwd, importer)}`);
			for (const module of modules) {
				console.error(`    - \u001B[1m\u001B[36m${module}\u001B[39m\u001B[22m`);
			}
		}
	}

	const files = Array.from(traced.fileList);

	// find common ancestor directory
	/** @type {string[]} */
	let common_parts = files[0]?.split(path.sep) ?? [];

	for (let i = 1; i < files.length; i += 1) {
		const file = files[i];
		const parts = file.split(path.sep);

		for (let j = 0; j < common_parts.length; j += 1) {
			if (parts[j] !== common_parts[j]) {
				common_parts = common_parts.slice(0, j);
				break;
			}
		}
	}

	const ancestor = base + common_parts.join(path.sep);

	for (const file of traced.fileList) {
		const source = base + file;
		const dest = path.join(dir, path.relative(ancestor, source));

		const stats = fs.statSync(source);
		const is_dir = stats.isDirectory();

		const realpath = fs.realpathSync(source);

		try {
			fs.mkdirSync(path.dirname(dest), { recursive: true });
		} catch {
			// do nothing
		}

		if (source !== realpath) {
			const realdest = path.join(dir, path.relative(ancestor, realpath));
			fs.symlinkSync(path.relative(path.dirname(dest), realdest), dest, is_dir ? 'dir' : 'file');
		} else if (!is_dir) {
			fs.copyFileSync(source, dest);
		}
	}

	write(
		`${dir}/.vc-config.json`,
		JSON.stringify(
			{
				runtime: config.runtime,
				regions: config.regions,
				memory: config.memory,
				maxDuration: config.maxDuration,
				handler: path.relative(base + ancestor, entry),
				launcherType: 'Nodejs',
				experimentalResponseStreaming: !config.isr,
				framework: {
					slug: 'sveltekit',
					version: VERSION
				}
			},
			null,
			'\t'
		)
	);

	write(`${dir}/package.json`, JSON.stringify({ type: 'module' }));
}

/**
 *
 * @param {import('@sveltejs/kit').Builder} builder
 * @param {any} vercel_config
 */
function validate_vercel_json(builder, vercel_config) {
	if (builder.routes.length > 0 && !builder.routes[0].api) {
		// bail — we're on an older SvelteKit version that doesn't
		// populate `route.api.methods`, so we can't check
		// to see if cron paths are valid
		return;
	}

	const crons = /** @type {Array<unknown>} */ (
		Array.isArray(vercel_config?.crons) ? vercel_config.crons : []
	);

	/** For a route to be considered 'valid', it must be an API route with a GET handler */
	const valid_routes = builder.routes.filter((route) => route.api.methods.includes('GET'));

	/** @type {Array<string>} */
	const unmatched_paths = [];

	for (const cron of crons) {
		if (typeof cron !== 'object' || cron === null || !('path' in cron)) {
			continue;
		}

		const { path } = cron;
		if (typeof path !== 'string') {
			continue;
		}

		if (!valid_routes.some((route) => route.pattern.test(path))) {
			unmatched_paths.push(path);
		}
	}

	if (unmatched_paths.length) {
		builder.log.warn(
			'\nWarning: vercel.json defines cron tasks that use paths that do not correspond to an API route with a GET handler (ignore this if the request is handled in your `handle` hook):'
		);

		for (const path of unmatched_paths) {
			console.log(`    - ${path}`);
		}

		console.log('');
	}
}

/** @param {import('@sveltejs/kit').RouteDefinition} route */
function is_prerendered(route) {
	return (
		route.prerender === true ||
		(route.prerender === 'auto' && route.segments.every((segment) => !segment.dynamic))
	);
}

export default plugin;

```


####### packages/adapter-vercel/internal.d.ts #######

```

declare module 'SERVER' {
	export { Server } from '@sveltejs/kit';
}

declare module 'MANIFEST' {
	import { SSRManifest } from '@sveltejs/kit';
	export const manifest: SSRManifest;
}

```


####### packages/adapter-vercel/package.json #######

```

{
	"name": "@sveltejs/adapter-vercel",
	"version": "5.3.0",
	"description": "A SvelteKit adapter that creates a Vercel app",
	"repository": {
		"type": "git",
		"url": "https://github.com/sveltejs/kit",
		"directory": "packages/adapter-vercel"
	},
	"license": "MIT",
	"homepage": "https://kit.svelte.dev",
	"type": "module",
	"exports": {
		".": {
			"types": "./index.d.ts",
			"import": "./index.js"
		},
		"./package.json": "./package.json"
	},
	"types": "index.d.ts",
	"files": [
		"files",
		"index.js",
		"utils.js",
		"index.d.ts"
	],
	"scripts": {
		"lint": "prettier --check .",
		"format": "pnpm lint --write",
		"check": "tsc",
		"test": "vitest run"
	},
	"dependencies": {
		"@vercel/nft": "^0.26.1",
		"esbuild": "^0.20.2"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"@types/node": "^18.19.3",
		"typescript": "^5.3.3",
		"vitest": "^1.5.0"
	},
	"peerDependencies": {
		"@sveltejs/kit": "^2.4.0"
	}
}

```


####### packages/adapter-vercel/README.md #######

# adapter-vercel

A SvelteKit adapter that creates a Vercel app.

## Docs

[Docs](https://kit.svelte.dev/docs/adapter-vercel)

## Changelog

[The Changelog for this package is available on GitHub](https://github.com/sveltejs/kit/blob/main/packages/adapter-vercel/CHANGELOG.md).

####### packages/adapter-vercel/test/utils.spec.js #######

```

import { assert, test } from 'vitest';
import { get_pathname, pattern_to_src } from '../utils.js';

// workaround so that TypeScript doesn't follow that import which makes it pick up that file and then error on missing import aliases
const { parse_route_id } = await import('../../kit/src/' + 'utils/routing.js');

/**
 * @param {import('@sveltejs/kit').RouteDefinition<any>['segments']} segments
 * @param {string} expected
 */
function run_get_pathname_test(segments, expected) {
	const route = /** @type {import('@sveltejs/kit').RouteDefinition<any>} */ ({ segments });
	assert.equal(get_pathname(route), expected);
}

test('get_pathname for simple route', () => {
	run_get_pathname_test([{ content: 'foo', dynamic: false, rest: false }], 'foo');
});

test('get_pathname for simple route with multiple segments', () => {
	run_get_pathname_test(
		[
			{ content: 'foo', dynamic: false, rest: false },
			{ content: 'bar', dynamic: false, rest: false }
		],
		'foo/bar'
	);
});

test('get_pathname for route with parameters', () => {
	run_get_pathname_test(
		[
			{ content: 'foo', dynamic: false, rest: false },
			{ content: '[bar]', dynamic: true, rest: false }
		],
		'foo/$1'
	);
});

test('get_pathname for route with parameters within segment', () => {
	run_get_pathname_test(
		[
			{ content: 'foo-[bar]', dynamic: true, rest: false },
			{ content: '[baz]-buz', dynamic: true, rest: false }
		],
		'foo-$1/$2-buz'
	);
});

test('get_pathname for route with optional parameters within segment', () => {
	run_get_pathname_test(
		[
			{ content: 'foo-[[bar]]', dynamic: true, rest: false },
			{ content: '[[baz]]-buz', dynamic: true, rest: false }
		],
		'foo-$1/$2-buz'
	);
});

test('get_pathname for route with rest parameter', () => {
	run_get_pathname_test(
		[
			{ content: 'foo', dynamic: false, rest: false },
			{ content: '[[...rest]]', dynamic: true, rest: true }
		],
		'foo$1'
	);
});

test('get_pathname for route with required and rest parameter', () => {
	run_get_pathname_test(
		[
			{ content: '[foo]', dynamic: true, rest: false },
			{ content: '[...rest]', dynamic: true, rest: true }
		],
		'$1$2'
	);
});

test('get_pathname for route with required and optional parameter', () => {
	run_get_pathname_test(
		[
			{ content: '[foo]', dynamic: true, rest: false },
			{ content: '[[optional]]', dynamic: true, rest: true }
		],
		'$1$2'
	);
});

test('get_pathname for route with required and optional parameter', () => {
	run_get_pathname_test(
		[
			{ content: '[foo]', dynamic: true, rest: false },
			{ content: '[[...rest]]', dynamic: true, rest: true },
			{ content: 'bar', dynamic: false, rest: false }
		],
		'$1$2/bar'
	);
});

/**
 * @param {string} route_id
 * @param {string} expected
 */
function run_pattern_to_src_test(route_id, expected) {
	const { pattern } = parse_route_id(route_id);
	assert.equal(pattern_to_src(pattern.toString()), expected);
}

test('pattern_to_src for simple route', () => {
	run_pattern_to_src_test('/', '^/?');
});

test('pattern_to_src for route with parameters', () => {
	run_pattern_to_src_test('/foo/[bar]', '^/foo/([^/]+?)/?');
});

test('pattern_to_src for route with optional parameters', () => {
	run_pattern_to_src_test('/foo/[[bar]]', '^/foo(/[^/]+)?/?');
});

test('pattern_to_src for route with optional parameter in the middle', () => {
	run_pattern_to_src_test('/foo/[[bar]]/baz', '^/foo(/[^/]+)?/baz/?');
});

test('pattern_to_src for route with rest parameter', () => {
	run_pattern_to_src_test('/foo/[...bar]', '^/foo(/.*)?/?');
});

test('pattern_to_src for route with rest parameter in the middle', () => {
	run_pattern_to_src_test('/foo/[...bar]/baz', '^/foo(/.*)?/baz/?');
});

```


####### packages/adapter-vercel/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"strict": true,
		"noEmit": true,
		"noImplicitAny": true,
		"target": "es2022",
		"module": "node16",
		"moduleResolution": "node16",
		"allowSyntheticDefaultImports": true,
		"baseUrl": ".",
		"paths": {
			"@sveltejs/kit": ["../kit/types/index"]
		}
	},
	"include": ["**/*.js", "index.d.ts", "internal.d.ts"]
}

```


####### packages/adapter-vercel/utils.js #######

```

/** @param {import("@sveltejs/kit").RouteDefinition<any>} route */
export function get_pathname(route) {
	let i = 1;

	const pathname = route.segments
		.map((segment) => {
			if (!segment.dynamic) {
				return '/' + segment.content;
			}

			const parts = segment.content.split(/\[(.+?)\](?!\])/);
			let result = '';

			if (
				parts.length === 3 &&
				!parts[0] &&
				!parts[2] &&
				(parts[1].startsWith('...') || parts[1][0] === '[')
			) {
				// Special case: segment is a single optional or rest parameter.
				// In that case we don't prepend a slash (also see comment in pattern_to_src).
				result = `$${i++}`;
			} else {
				result =
					'/' +
					parts
						.map((content, j) => {
							if (j % 2) {
								return `$${i++}`;
							} else {
								return content;
							}
						})
						.join('');
			}

			return result;
		})
		.join('');

	return pathname[0] === '/' ? pathname.slice(1) : pathname;
}

/**
 * Adjusts the stringified route regex for Vercel's routing system
 * @param {string} pattern stringified route regex
 */
export function pattern_to_src(pattern) {
	let src = pattern
		// remove leading / and trailing $/
		.slice(1, -2)
		// replace escaped \/ with /
		.replace(/\\\//g, '/');

	// replace the root route "^/" with "^/?"
	if (src === '^/') {
		src = '^/?';
	}

	// Move non-capturing groups that swallow slashes into their following capturing groups.
	// This is necessary because during ISR we're using the regex to construct the __pathname
	// query parameter: In case of a route like [required]/[...rest] we need to turn them
	// into $1$2 and not $1/$2, because if [...rest] is empty, we don't want to have a trailing
	// slash in the __pathname query parameter which wasn't there in the original URL, as that
	// could result in a false trailing slash redirect in the SvelteKit runtime, leading to infinite redirects.
	src = src.replace(/\(\?:\/\((.+?)\)\)/g, '(/$1)');

	return src;
}

```


####### packages/amp/CHANGELOG.md #######

# @sveltejs/amp

## 1.1.0

### Minor Changes

- feat: allow SvelteKit 2 as peer dependency ([#11233](https://github.com/sveltejs/kit/pull/11233))

## 1.0.2

### Patch Changes

- fix: publish missing files ([#8532](https://github.com/sveltejs/kit/pull/8532))

## 1.0.1

### Patch Changes

- chore: remove superfluous main field from package.json ([#8519](https://github.com/sveltejs/kit/pull/8519))

- Updated dependencies [[`7e2d3405`](https://github.com/sveltejs/kit/commit/7e2d34056e99f371e22406d941b764df365a2649)]:
  - @sveltejs/kit@1.1.1

## 1.0.0

### Major Changes

First major release, see below for the history of changes that lead up to this.
Starting from now all releases follow semver and changes will be listed as Major/Minor/Patch

## 1.0.0-next.3

### Patch Changes

- chore: add peerDependencies, add more specific next version ([#8141](https://github.com/sveltejs/kit/pull/8141))

## 1.0.0-next.2

### Patch Changes

- Amend boilerplate to match current recommendations ([#7184](https://github.com/sveltejs/kit/pull/7184))

## 1.0.0-next.1

### Patch Changes

- Add types to pkg.exports ([#5045](https://github.com/sveltejs/kit/pull/5045))

####### packages/amp/index.d.ts #######

```

export function transform(html: string): string;

```


####### packages/amp/index.js #######

```

// https://amp.dev/documentation/guides-and-tutorials/learn/spec/amp-boilerplate/
const boilerplate = `
	<link rel="preload" as="script" href="https://cdn.ampproject.org/v0.js" />
	<script async src="https://cdn.ampproject.org/v0.js"></script>
	<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
`;

/** @param {string} html */
export function transform(html) {
	return html
		.replace(/<style([^]+?)<\/style>/, (match, $1) => `<style amp-custom${$1}</style>`)
		.replace(/<script[^]+?<\/script>/g, '')
		.replace(/<link[^>]+>/g, (match) => {
			if (/rel=('|")?stylesheet\1/.test(match)) {
				if (/ disabled /.test(match)) return '';
				throw new Error(
					'An AMP document cannot contain <link rel="stylesheet"> — ensure that inlineStyleThreshold is set to Infinity, and remove links from your page template and <svelte:head> elements'
				);
			}

			return match;
		})
		.replace(/<meta[^>]+>/g, (match) => {
			if (match.includes('http-equiv')) return '';
			return match;
		})
		.replace('</head>', boilerplate + '</head>');
}

```


####### packages/amp/package.json #######

```

{
	"name": "@sveltejs/amp",
	"version": "1.1.0",
	"description": "AMP integration for SvelteKit",
	"repository": {
		"type": "git",
		"url": "https://github.com/sveltejs/kit",
		"directory": "packages/amp"
	},
	"license": "MIT",
	"homepage": "https://kit.svelte.dev",
	"type": "module",
	"exports": {
		".": {
			"types": "./index.d.ts",
			"import": "./index.js"
		},
		"./package.json": "./package.json"
	},
	"types": "index.d.ts",
	"files": [
		"index.js",
		"index.d.ts"
	],
	"scripts": {
		"lint": "prettier --check .",
		"format": "pnpm lint --write"
	},
	"peerDependencies": {
		"@sveltejs/kit": "^1.0.0 || ^2.0.0"
	}
}

```


####### packages/create-svelte/bin.js #######

```

#!/usr/bin/env node
import fs from 'node:fs';
import path from 'node:path';
import * as p from '@clack/prompts';
import { bold, cyan, grey, yellow } from 'kleur/colors';
import { create } from './index.js';
import { dist, package_manager } from './utils.js';

const { version } = JSON.parse(fs.readFileSync(new URL('package.json', import.meta.url), 'utf-8'));
let cwd = process.argv[2] || '.';

console.log(`
${grey(`create-svelte version ${version}`)}
`);

p.intro('Welcome to SvelteKit!');

if (cwd === '.') {
	const dir = await p.text({
		message: 'Where should we create your project?',
		placeholder: '  (hit Enter to use current directory)'
	});

	if (p.isCancel(dir)) process.exit(1);

	if (dir) {
		cwd = /** @type {string} */ (dir);
	}
}

if (fs.existsSync(cwd)) {
	if (fs.readdirSync(cwd).length > 0) {
		const force = await p.confirm({
			message: 'Directory not empty. Continue?',
			initialValue: false
		});

		// bail if `force` is `false` or the user cancelled with Ctrl-C
		if (force !== true) {
			process.exit(1);
		}
	}
}

const options = await p.group(
	{
		template: () =>
			p.select({
				message: 'Which Svelte app template?',
				// @ts-expect-error i have no idea what is going on here
				options: fs.readdirSync(dist('templates')).map((dir) => {
					const meta_file = dist(`templates/${dir}/meta.json`);
					const { title, description } = JSON.parse(fs.readFileSync(meta_file, 'utf8'));

					return {
						label: title,
						hint: description,
						value: dir
					};
				})
			}),

		types: () =>
			p.select({
				message: 'Add type checking with TypeScript?',
				initialValue: /** @type {'checkjs' | 'typescript' | null} */ ('checkjs'),
				options: [
					{
						label: 'Yes, using JavaScript with JSDoc comments',
						value: 'checkjs'
					},
					{
						label: 'Yes, using TypeScript syntax',
						value: 'typescript'
					},
					{ label: 'No', value: null }
				]
			}),

		features: () =>
			p.multiselect({
				message: 'Select additional options (use arrow keys/space bar)',
				required: false,
				options: [
					{
						value: 'eslint',
						label: 'Add ESLint for code linting'
					},
					{
						value: 'prettier',
						label: 'Add Prettier for code formatting'
					},
					{
						value: 'playwright',
						label: 'Add Playwright for browser testing'
					},
					{
						value: 'vitest',
						label: 'Add Vitest for unit testing'
					},
					{
						value: 'svelte5',
						label: 'Try the Svelte 5 preview (unstable!)'
					}
				]
			})
	},
	{ onCancel: () => process.exit(1) }
);

await create(cwd, {
	name: path.basename(path.resolve(cwd)),
	template: /** @type {'default' | 'skeleton' | 'skeletonlib'} */ (options.template),
	types: options.types,
	prettier: options.features.includes('prettier'),
	eslint: options.features.includes('eslint'),
	playwright: options.features.includes('playwright'),
	vitest: options.features.includes('vitest'),
	svelte5: options.features.includes('svelte5')
});

p.outro('Your project is ready!');

if (options.types === 'typescript') {
	console.log(bold('✔ Typescript'));
	console.log('  Inside Svelte components, use <script lang="ts">\n');
} else if (options.types === 'checkjs') {
	console.log(bold('✔ Type-checked JavaScript'));
	console.log(cyan('  https://www.typescriptlang.org/tsconfig#checkJs\n'));
} else if (options.template === 'skeletonlib') {
	const warning = yellow('▲');
	console.log(
		`${warning} You chose to not add type checking, but TypeScript will still be installed in order to generate type definitions when building the library\n`
	);
}

if (options.features.includes('eslint')) {
	console.log(bold('✔ ESLint'));
	console.log(cyan('  https://github.com/sveltejs/eslint-plugin-svelte\n'));
}

if (options.features.includes('prettier')) {
	console.log(bold('✔ Prettier'));
	console.log(cyan('  https://prettier.io/docs/en/options.html'));
	console.log(cyan('  https://github.com/sveltejs/prettier-plugin-svelte#options\n'));
}

if (options.features.includes('playwright')) {
	console.log(bold('✔ Playwright'));
	console.log(cyan('  https://playwright.dev\n'));
}

if (options.features.includes('vitest')) {
	console.log(bold('✔ Vitest'));
	console.log(cyan('  https://vitest.dev\n'));
}

console.log('Install community-maintained integrations:');
console.log(cyan('  https://github.com/svelte-add/svelte-add'));

console.log('\nNext steps:');
let i = 1;

const relative = path.relative(process.cwd(), cwd);
if (relative !== '') {
	console.log(`  ${i++}: ${bold(cyan(`cd ${relative}`))}`);
}

console.log(`  ${i++}: ${bold(cyan(`${package_manager} install`))}`);
// prettier-ignore
console.log(`  ${i++}: ${bold(cyan('git init && git add -A && git commit -m "Initial commit"'))} (optional)`);
console.log(`  ${i++}: ${bold(cyan(`${package_manager} run dev -- --open`))}`);

console.log(`\nTo close the dev server, hit ${bold(cyan('Ctrl-C'))}`);
console.log(`\nStuck? Visit us at ${cyan('https://svelte.dev/chat')}`);

```


####### packages/create-svelte/CHANGELOG.md #######

# create-svelte

## 6.1.2

### Patch Changes

- fix: set peerDependencies based on chosen Svelte version ([#12117](https://github.com/sveltejs/kit/pull/12117))

## 6.1.1

### Patch Changes

- fix: go back to eslint 8 until typescript-eslint supports eslint 9 ([#12110](https://github.com/sveltejs/kit/pull/12110))

## 6.1.0

### Minor Changes

- feat: upgrade eslint to v9 ([#12089](https://github.com/sveltejs/kit/pull/12089))

## 6.0.10

### Patch Changes

- docs: update comment about path aliases ([#11788](https://github.com/sveltejs/kit/pull/11788))

## 6.0.9

### Patch Changes

- chore: bump typescript-eslint to v7 ([#11845](https://github.com/sveltejs/kit/pull/11845))

## 6.0.8

### Patch Changes

- chore: upgrade to vite 5.0.11 and vitest 1.2.0 ([#11632](https://github.com/sveltejs/kit/pull/11632))

## 6.0.7

### Patch Changes

- fix: install eslint-plugin-svelte@next for svelte5 ([#11627](https://github.com/sveltejs/kit/pull/11627))

## 6.0.6

### Patch Changes

- fix: set path: '/' in demo ([#11495](https://github.com/sveltejs/kit/pull/11495))

## 6.0.5

### Patch Changes

- fix: set the correct type for the ESLint config object ([#11453](https://github.com/sveltejs/kit/pull/11453))

## 6.0.4

### Patch Changes

- chore: update primary branch from master to main ([`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d))

## 6.0.3

### Patch Changes

- fix: remove unnecessary @types/cookie package ([#11375](https://github.com/sveltejs/kit/pull/11375))

## 6.0.2

### Patch Changes

- fix: use vitest 1.0 in playwright + vitest template ([#11376](https://github.com/sveltejs/kit/pull/11376))

## 6.0.1

### Patch Changes

- chore: simplify `.prettierignore` ([#11349](https://github.com/sveltejs/kit/pull/11349))

## 6.0.0

### Major Changes

- feat: create projects with SvelteKit 2 ([#11236](https://github.com/sveltejs/kit/pull/11236))

- breaking: require Node 18.13 or newer ([#11172](https://github.com/sveltejs/kit/pull/11172))

### Minor Changes

- feat: update vitest to 1.0 ([#11196](https://github.com/sveltejs/kit/pull/11196))

## 5.3.4

### Patch Changes

- chore: upgrade to prettier 3.1.1 ([#11304](https://github.com/sveltejs/kit/pull/11304))

## 5.3.3

### Patch Changes

- fix: call Svelte 5 an alpha rather than beta ([#11119](https://github.com/sveltejs/kit/pull/11119))

## 5.3.2

### Patch Changes

- chore: add type declaration to `.eslintrc.cjs` files ([#11091](https://github.com/sveltejs/kit/pull/11091))

## 5.3.1

### Patch Changes

- chore: upgrade eslint-config-prettier ([#11037](https://github.com/sveltejs/kit/pull/11037))

## 5.3.0

### Minor Changes

- feat: upgrade to prettier 3 and prettier-plugin-svelte 3 ([#10410](https://github.com/sveltejs/kit/pull/10410))

### Patch Changes

- fix: correctly configure `module` and `noEmit` tsconfig and jsconfig properties ([#11029](https://github.com/sveltejs/kit/pull/11029))

## 5.2.0

### Minor Changes

- feat: add option to try out Svelte 5 beta ([#11026](https://github.com/sveltejs/kit/pull/11026))

## 5.1.1

### Patch Changes

- fix: specified `initial-scale=1` on all viewport meta tags ([#10793](https://github.com/sveltejs/kit/pull/10793))

- feat: make output reflect user's choice of package manager ([#10811](https://github.com/sveltejs/kit/pull/10811))

## 5.1.0

### Minor Changes

- chore: remove `resolution-mode=highest` in template `.npmrc` ([#10635](https://github.com/sveltejs/kit/pull/10635))

### Patch Changes

- feat: improve sverdle reactivity ([#10670](https://github.com/sveltejs/kit/pull/10670))

## 5.0.6

### Patch Changes

- chore: bump typescript-eslint to v6 ([#10371](https://github.com/sveltejs/kit/pull/10371))

## 5.0.5

### Patch Changes

- chore: upgrade `vitest` to 0.34.0 and `@clack/prompts` to 0.7.0 ([#10240](https://github.com/sveltejs/kit/pull/10240))

## 5.0.4

### Patch Changes

- chore: upgrade @fontsource/fira-mono to v5 ([#10445](https://github.com/sveltejs/kit/pull/10445))

- chore: upgrade to vitest 0.33.0 ([#10445](https://github.com/sveltejs/kit/pull/10445))

## 5.0.3

### Patch Changes

- chore: bump Vite and Svelte dependencies ([#10330](https://github.com/sveltejs/kit/pull/10330))

- fix: create lib folder in skeleton project ([#10341](https://github.com/sveltejs/kit/pull/10341))

## 5.0.2

### Patch Changes

- fix: npm test should run unit tests ([#10241](https://github.com/sveltejs/kit/pull/10241))

- chore: upgrade vitest ([#10236](https://github.com/sveltejs/kit/pull/10236))

## 5.0.1

### Patch Changes

- chore: use satisfies keyword in jsdocs, in create-svelte default template ([#10203](https://github.com/sveltejs/kit/pull/10203))

## 5.0.0

### Major Changes

- breaking: install Svelte 4 ([#10217](https://github.com/sveltejs/kit/pull/10217))

## 4.2.0

### Minor Changes

- feat: Add `data-sveltekit-preload-data` to lib template ([#9863](https://github.com/sveltejs/kit/pull/9863))

## 4.1.1

### Patch Changes

- fix: default playwright globs ([#9795](https://github.com/sveltejs/kit/pull/9795))

- fix: remove obsolete `ignorePatterns: ['*.cjs']` from .eslintrc.cjs ([#9797](https://github.com/sveltejs/kit/pull/9797))

## 4.1.0

### Minor Changes

- feat: set `resolution-mode=highest` in generated `.npmrc` ([#9781](https://github.com/sveltejs/kit/pull/9781))

## 4.0.0

### Major Changes

- feat: switch default ESLint plugin from `eslint-plugin-svelte3` to `eslint-plugin-svelte` ([#9749](https://github.com/sveltejs/kit/pull/9749))

## 3.3.1

### Patch Changes

- feat: upgrade to Vite 4.3 for faster build times ([#9737](https://github.com/sveltejs/kit/pull/9737))

- fix: generate tsconfig/jsconfig correctly for library option ([#9712](https://github.com/sveltejs/kit/pull/9712))

## 3.3.0

### Minor Changes

- feat: ignore test files in library skeleton package.json ([#9584](https://github.com/sveltejs/kit/pull/9584))

## 3.2.0

### Minor Changes

- feat: upgrade to TypeScript 5 ([#9435](https://github.com/sveltejs/kit/pull/9435))

### Patch Changes

- chore: upgrade to Vite 4.2 ([#9434](https://github.com/sveltejs/kit/pull/9434))

## 3.1.2

### Patch Changes

- fix: prevent duplicated lines in project creation CLI ([#9346](https://github.com/sveltejs/kit/pull/9346))

## 3.1.1

### Patch Changes

- chore: Add hint for toggling additional options during scaffolding flow. ([#9318](https://github.com/sveltejs/kit/pull/9318))

## 3.1.0

### Minor Changes

- feat: use `@clack/prompts` ([#9219](https://github.com/sveltejs/kit/pull/9219))

## 3.0.4

### Patch Changes

- docs: inform about adapter-auto not supporting all environments ([#9196](https://github.com/sveltejs/kit/pull/9196))

## 3.0.3

### Patch Changes

- chore: enhance library skeleton readme with some library instructions ([#9128](https://github.com/sveltejs/kit/pull/9128))

## 3.0.2

### Patch Changes

- chore: avoid running publint twice in prepublish ([#9126](https://github.com/sveltejs/kit/pull/9126))

- fix: add `dist` to `pkg.files` and `.gitignore` ([#9124](https://github.com/sveltejs/kit/pull/9124))

## 3.0.1

### Patch Changes

- fix: update dependency @sveltejs/package to v2.0.0 ([#9087](https://github.com/sveltejs/kit/pull/9087))

## 3.0.0

### Major Changes

- breaking: update library scaffolding for `@sveltejs/package` version 2 ([#8922](https://github.com/sveltejs/kit/pull/8922))

## 2.3.4

### Patch Changes

- fix: use new locator API to improve demo test ([#8988](https://github.com/sveltejs/kit/pull/8988))

## 2.3.3

### Patch Changes

- chore: bump `@sveltejs/kit` and `@sveltejs/adapter-auto` versions ([#8740](https://github.com/sveltejs/kit/pull/8740))

- fix: adjust vite config type to work with vitest options ([#8871](https://github.com/sveltejs/kit/pull/8871))

## 2.3.2

### Patch Changes

- fix: remove duplicate space around JSDoc comments removed for TypeScript demo app ([#8684](https://github.com/sveltejs/kit/pull/8684))

## 2.3.1

### Patch Changes

- chore: remove obsolete comment from templates ([#8620](https://github.com/sveltejs/kit/pull/8620))

## 2.3.0

### Minor Changes

- fix: adjust `app.d.ts` to diminish confusion about imports ([#8477](https://github.com/sveltejs/kit/pull/8477))

## 2.2.1

### Patch Changes

- fix: note why TypeScript is always installed for library projects and add jsconfig ([#8484](https://github.com/sveltejs/kit/pull/8484))

## 2.2.0

### Minor Changes

- feat: use svelte-check v3 ([#8468](https://github.com/sveltejs/kit/pull/8468))

## 2.1.0

### Minor Changes

- feat: create vite.config.ts for TypeScript projects ([#8258](https://github.com/sveltejs/kit/pull/8258))

## 2.0.2

### Patch Changes

- fix: address flakiness in playwright test ([#8162](https://github.com/sveltejs/kit/pull/8162))

## 2.0.1

### Patch Changes

- chore: no code change, rerelease as 2.0.1 for technical reasons ([#8161](https://github.com/sveltejs/kit/pull/8161))

## 2.0.0

### Major Changes

First major release, see below for the history of changes that lead up to this.
Starting from now all releases follow semver and changes will be listed as Major/Minor/Patch

## 2.0.0-next.204

### Patch Changes

- feat: remove release candidate banner ([#8109](https://github.com/sveltejs/kit/pull/8109))

## 2.0.0-next.203

### Patch Changes

- chore: add peerDependencies, add more specific next version ([#8141](https://github.com/sveltejs/kit/pull/8141))

## 2.0.0-next.202

### Patch Changes

- feat: vitePreprocess ([#8036](https://github.com/sveltejs/kit/pull/8036))

## 2.0.0-next.201

### Patch Changes

- breaking: upgrade to Vite 4 ([#7543](https://github.com/sveltejs/kit/pull/7543))

## 2.0.0-next.200

### Patch Changes

- Use `satisfies` operator ([#7861](https://github.com/sveltejs/kit/pull/7861))

## 2.0.0-next.199

### Patch Changes

- fix: improve Sverdle a11y ([#7960](https://github.com/sveltejs/kit/pull/7960))

## 2.0.0-next.198

### Patch Changes

- Upgrade dependencies in templates ([#7866](https://github.com/sveltejs/kit/pull/7866))

## 2.0.0-next.197

### Patch Changes

- Upgrade dependencies ([#7852](https://github.com/sveltejs/kit/pull/7852))

## 2.0.0-next.196

### Patch Changes

- Update app.d.ts files ([#7003](https://github.com/sveltejs/kit/pull/7003))

## 2.0.0-next.195

### Patch Changes

- breaking: Replace `data-sveltekit-prefetch` with `-preload-code` and `-preload-data` ([#7776](https://github.com/sveltejs/kit/pull/7776))
- Upgrade to Playwright 1.28.1 ([#7696](https://github.com/sveltejs/kit/pull/7696))

## 2.0.0-next.194

### Patch Changes

- fix playwright glob filter ([#7826](https://github.com/sveltejs/kit/pull/7826))

## 2.0.0-next.193

### Patch Changes

- Added the option to add Vitest to new projects ([#5708](https://github.com/sveltejs/kit/pull/5708))

## 2.0.0-next.192

### Patch Changes

- Ignore Vite timestamp files by default in `create-svelte` templates (added to `.gitignore`) ([#7660](https://github.com/sveltejs/kit/pull/7660))

## 2.0.0-next.191

### Patch Changes

- Add `style="display: contents"` to wrapper element by default ([#7652](https://github.com/sveltejs/kit/pull/7652))

## 2.0.0-next.190

### Patch Changes

- fix: remove Sverdle from Stackblitz template ([#7448](https://github.com/sveltejs/kit/pull/7448))

## 2.0.0-next.189

### Patch Changes

- update dependencies ([#7355](https://github.com/sveltejs/kit/pull/7355))

## 2.0.0-next.188

### Patch Changes

- Use aria-current instead of active class in nav ([#7376](https://github.com/sveltejs/kit/pull/7376))

## 2.0.0-next.187

### Patch Changes

- Add missing titles and descriptions to the Sverdle pages ([#7351](https://github.com/sveltejs/kit/pull/7351))
- Use `justify-content: flex-start;` on Sverdle CSS to avoid compatibility issues ([#7352](https://github.com/sveltejs/kit/pull/7352))

## 2.0.0-next.186

### Patch Changes

- feat: add reset option to update method of enhance ([#7326](https://github.com/sveltejs/kit/pull/7326))

## 2.0.0-next.185

### Patch Changes

- Warn user when they accidentally try to publish the `./` directory ([#7280](https://github.com/sveltejs/kit/pull/7280))

## 2.0.0-next.184

### Patch Changes

- fix sverdle guesses incorrectly cleared by form `enhance` ([#7241](https://github.com/sveltejs/kit/pull/7241))

## 2.0.0-next.183

### Patch Changes

- feat: extract and export types from create-svelte ([#7111](https://github.com/sveltejs/kit/pull/7111))

## 2.0.0-next.182

### Patch Changes

- Work around SSR transform bug ([#7088](https://github.com/sveltejs/kit/pull/7088))

## 2.0.0-next.181

### Patch Changes

- Fix template description for SvelteKit demo app ([#7076](https://github.com/sveltejs/kit/pull/7076))

## 2.0.0-next.180

### Patch Changes

- Replace /todos page in demo app with /sverdle ([#6979](https://github.com/sveltejs/kit/pull/6979))

## 2.0.0-next.179

### Patch Changes

- breaking: rename App.PageError to App.Error ([#6963](https://github.com/sveltejs/kit/pull/6963))

## 2.0.0-next.178

### Patch Changes

- fix: prettier not formatting svelte files ([#6866](https://github.com/sveltejs/kit/pull/6866))

## 2.0.0-next.177

### Patch Changes

- chore: bump vite ([#6829](https://github.com/sveltejs/kit/pull/6829))

## 2.0.0-next.176

### Patch Changes

- SvelteKit 1.0 RC ([#6707](https://github.com/sveltejs/kit/pull/6707))

## 2.0.0-next.175

### Patch Changes

- breaking: update use:enhance usage ([#6697](https://github.com/sveltejs/kit/pull/6697))
- breaking: hooks file rename ([#6697](https://github.com/sveltejs/kit/pull/6697))

## 2.0.0-next.174

### Patch Changes

- Remove cookie package from demo app ([#6602](https://github.com/sveltejs/kit/pull/6602))

## 2.0.0-next.173

### Patch Changes

- breaking: Replace `POST`/`PUT`/`PATCH`/`DELETE` in `+page.server.js` with `export const actions` ([#6469](https://github.com/sveltejs/kit/pull/6469))

## 2.0.0-next.172

### Patch Changes

- Bump vite-plugin-svelte and required vite version ([#6583](https://github.com/sveltejs/kit/pull/6583))

## 2.0.0-next.171

### Patch Changes

- Use `invalidateAll()` ([#6493](https://github.com/sveltejs/kit/pull/6493))

## 2.0.0-next.170

### Patch Changes

- reorder create-svelte templates such that library is last ([#6481](https://github.com/sveltejs/kit/pull/6481))

## 2.0.0-next.169

### Patch Changes

- Move `data-sveltekit-prefetch` to `<nav>` element ([#6442](https://github.com/sveltejs/kit/pull/6442))

## 2.0.0-next.168

### Patch Changes

- chore: bump ts version and ensure it works with latest changes ([#6428](https://github.com/sveltejs/kit/pull/6428))

## 2.0.0-next.167

### Patch Changes

- breaking: Replace `sveltekit:*` with valid HTML attributes like `data-sveltekit-*` ([#6170](https://github.com/sveltejs/kit/pull/6170))

## 2.0.0-next.166

### Patch Changes

- Remove App.PrivateEnv and App.PublicEnv placeholders ([#6413](https://github.com/sveltejs/kit/pull/6413))

## 2.0.0-next.165

### Patch Changes

- Update to Vite 3.1.0-beta.1 ([#6407](https://github.com/sveltejs/kit/pull/6407))

## 2.0.0-next.164

### Patch Changes

- breaking: rename `$app/env` to `$app/environment`, to disambiguate with `$env/...` ([#6334](https://github.com/sveltejs/kit/pull/6334))
- Add svelte-kit sync to check scripts in checkjs templates ([#6339](https://github.com/sveltejs/kit/pull/6339))

## 2.0.0-next.163

### Patch Changes

- fix type definition issue that caused a svelte-check error when using TS 4.8 ([#6306](https://github.com/sveltejs/kit/pull/6306))

## 2.0.0-next.162

### Patch Changes

- remove some unused code ([#6287](https://github.com/sveltejs/kit/pull/6287))

## 2.0.0-next.161

### Patch Changes

- feat: add App.PageData type ([#6226](https://github.com/sveltejs/kit/pull/6226))

## 2.0.0-next.160

### Patch Changes

- Create TypeScript/JSDoc/vanilla versions of shared template .ts files ([#6253](https://github.com/sveltejs/kit/pull/6253))
- Create vite.config.ts when creating TypeScript project ([#6253](https://github.com/sveltejs/kit/pull/6253))
- Invalidate data after form submission ([#6254](https://github.com/sveltejs/kit/pull/6254))

## 2.0.0-next.159

### Patch Changes

- Update text referring to route location ([#6134](https://github.com/sveltejs/kit/pull/6134))

## 2.0.0-next.158

### Patch Changes

- Add notes about includes/excludes and path aliases ([#6085](https://github.com/sveltejs/kit/pull/6085))
- setup prettier plugin-search-dirs to enable use with pnpm ([#6101](https://github.com/sveltejs/kit/pull/6101))

## 2.0.0-next.157

### Patch Changes

- Run svelte-kit sync before svelte-check in check scripts ([#6037](https://github.com/sveltejs/kit/pull/6037))

## 2.0.0-next.156

### Patch Changes

- update `app.d.ts` for library skeleton template ([#6020](https://github.com/sveltejs/kit/pull/6020))

## 2.0.0-next.155

### Patch Changes

- make variable names more descriptive ([#5983](https://github.com/sveltejs/kit/pull/5983))

## 2.0.0-next.154

### Patch Changes

- remove session remnants ([#5966](https://github.com/sveltejs/kit/pull/5966))
- remove outdated notes in `api.ts` ([#5964](https://github.com/sveltejs/kit/pull/5964))

## 2.0.0-next.153

### Patch Changes

- Update templates ([#5778](https://github.com/sveltejs/kit/pull/5778))

## 2.0.0-next.152

### Patch Changes

- Use @sveltejs/kit postinstall lifecycle hook to invoke 'svelte-kit sync' instead of prepare in projects created by create-svelte ([#5760](https://github.com/sveltejs/kit/pull/5760))

## 2.0.0-next.151

### Patch Changes

- feat: include reference to `@sveltejs/kit` types in ambient file ([#5745](https://github.com/sveltejs/kit/pull/5745))

## 2.0.0-next.150

### Patch Changes

- Remove initial-scale=1 from meta tags ([#5706](https://github.com/sveltejs/kit/pull/5706))

## 2.0.0-next.149

### Patch Changes

- uppercase handlers ([#5513](https://github.com/sveltejs/kit/pull/5513))

## 2.0.0-next.148

### Patch Changes

- Update dependencies ([#5005](https://github.com/sveltejs/kit/pull/5005))

## 2.0.0-next.147

### Patch Changes

- chore: upgrade TypeScript to 4.7.4 ([#5414](https://github.com/sveltejs/kit/pull/5414))

## 2.0.0-next.146

### Patch Changes

- Add vite.config.js to the create-svelte templates ([#5332](https://github.com/sveltejs/kit/pull/5332))
- breaking: switch to vite CLI for dev, build, and preview commands ([#5332](https://github.com/sveltejs/kit/pull/5332))

## 2.0.0-next.145

### Patch Changes

- fix todos fail to update in demo app ([#5354](https://github.com/sveltejs/kit/pull/5354))

## 2.0.0-next.144

### Patch Changes

- Revert to use ESM eslint config files ([#5293](https://github.com/sveltejs/kit/pull/5293))

## 2.0.0-next.143

### Patch Changes

- Enhance docs on importing types in app.d.ts ([#5280](https://github.com/sveltejs/kit/pull/5280))
- Use ESM eslint config files ([#5263](https://github.com/sveltejs/kit/pull/5263))
- fix formatting for initial package.json ([#5271](https://github.com/sveltejs/kit/pull/5271))

## 2.0.0-next.142

### Patch Changes

- Add descriptions to templates, and make TypeScript options more self-explanatory ([#5221](https://github.com/sveltejs/kit/pull/5221))

## 2.0.0-next.141

### Patch Changes

- fix: use inline element in heading ([#5164](https://github.com/sveltejs/kit/pull/5164))

## 2.0.0-next.140

### Patch Changes

- Use crypto.randomUUID() instead of @lukeed/uuid ([#5042](https://github.com/sveltejs/kit/pull/5042))

## 2.0.0-next.139

### Patch Changes

- correct default package.json format ([#5013](https://github.com/sveltejs/kit/pull/5013))
- breaking: Replace `%svelte.body%` with `%sveltekit.body%`, etc. ([#5016](https://github.com/sveltejs/kit/pull/5016))

## 2.0.0-next.138

### Patch Changes

- Use separate ignore files for prettier and eslint ([#5009](https://github.com/sveltejs/kit/pull/5009))

## 2.0.0-next.137

### Patch Changes

- import generated types from `__types/index.d.ts` file ([#4705](https://github.com/sveltejs/kit/pull/4705))

## 2.0.0-next.136

### Patch Changes

- Add README ([#4951](https://github.com/sveltejs/kit/pull/4951))

## 2.0.0-next.135

### Patch Changes

- remove unnecessary CHANGELOG.md ([#4903](https://github.com/sveltejs/kit/pull/4903))

## 2.0.0-next.134

### Patch Changes

- fix lib, module, and target to not override the tsconfig they generate by default ([#4893](https://github.com/sveltejs/kit/pull/4893))

## 2.0.0-next.133

### Patch Changes

- Bump `eslint` from version 7 to 8 ([#4553](https://github.com/sveltejs/kit/pull/4553))

## 2.0.0-next.132

### Patch Changes

- Remove default `<meta name="description">` and add separate descriptions to each page ([#4686](https://github.com/sveltejs/kit/pull/4686))

## 2.0.0-next.131

### Patch Changes

- Make hooks file comply with TypeScript strictest mode ([#4667](https://github.com/sveltejs/kit/pull/4667))

## 2.0.0-next.130

### Patch Changes

- Ignore .turbo directory when building templates ([#4638](https://github.com/sveltejs/kit/pull/4638))
- Disable type checking by default for non-typescript projects. ([#4621](https://github.com/sveltejs/kit/pull/4621))
- breaking: move non-essential TypeScript compilerOptions into user-editable config ([#4633](https://github.com/sveltejs/kit/pull/4633))

## 2.0.0-next.129

### Patch Changes

- type check exception handling on form action ([#4532](https://github.com/sveltejs/kit/pull/4532))
- Update broken documentation links for `App` namespaces ([#4627](https://github.com/sveltejs/kit/pull/4627))

## 2.0.0-next.128

### Patch Changes

- chore: upgrade to Playwright 1.21.0 ([#4601](https://github.com/sveltejs/kit/pull/4601))

## 2.0.0-next.127

### Patch Changes

- Fix iOS double-tap zoom on counter buttons ([#4390](https://github.com/sveltejs/kit/pull/4390))

## 2.0.0-next.126

### Patch Changes

- fix: use .ts extension for tests when using TypeScript ([#4368](https://github.com/sveltejs/kit/pull/4368))

## 2.0.0-next.125

### Patch Changes

- fix: check for app.d.ts rather than global.d.ts ([#4295](https://github.com/sveltejs/kit/pull/4295))

## 2.0.0-next.124

### Patch Changes

- Add sync CLI command ([#4182](https://github.com/sveltejs/kit/pull/4182))
- Upgrade to TypeScript 4.6 ([#4190](https://github.com/sveltejs/kit/pull/4190))

## 2.0.0-next.123

### Patch Changes

- Extend user tsconfig from generated .svelte-kit/tsconfig.json ([#4118](https://github.com/sveltejs/kit/pull/4118))

## 2.0.0-next.122

### Patch Changes

- remove unnecessary CSS units ([#4115](https://github.com/sveltejs/kit/pull/4115))

## 2.0.0-next.121

### Patch Changes

- Add option to create integration tests with Playwright ([#4056](https://github.com/sveltejs/kit/pull/4056))

## 2.0.0-next.120

### Patch Changes

- fix `@typescript-eslint/no-empty-interface` lint error when starting a new app with eslint ([#4077](https://github.com/sveltejs/kit/pull/4077))

## 2.0.0-next.119

### Patch Changes

- fix: update docs URL for App namespace interfaces ([#4042](https://github.com/sveltejs/kit/pull/4042))

## 2.0.0-next.118

### Patch Changes

- make demo app work without JS ([#3970](https://github.com/sveltejs/kit/pull/3970))

## 2.0.0-next.117

### Patch Changes

- update comment to remove outdated reference ([#3898](https://github.com/sveltejs/kit/pull/3898))

## 2.0.0-next.116

### Patch Changes

- use preserveValueImports flag ([#3064](https://github.com/sveltejs/kit/pull/3064))

## 2.0.0-next.115

### Patch Changes

- fix links pointing to multi-page docs ([#3815](https://github.com/sveltejs/kit/pull/3815))
- upgrade to TypeScript 4.5 ([#3809](https://github.com/sveltejs/kit/pull/3809))

## 2.0.0-next.114

### Patch Changes

- Add App namespace for app-level types ([#3670](https://github.com/sveltejs/kit/pull/3670))
- Remove target option ([#3674](https://github.com/sveltejs/kit/pull/3674))

## 2.0.0-next.113

### Patch Changes

- Bump version ([#3610](https://github.com/sveltejs/kit/pull/3610))

## 2.0.0-next.112

### Patch Changes

- Try this ([#3608](https://github.com/sveltejs/kit/pull/3608))

## 2.0.0-next.111

### Patch Changes

- I think this might be it ([#3606](https://github.com/sveltejs/kit/pull/3606))

## 2.0.0-next.110

### Patch Changes

- And again ([#3604](https://github.com/sveltejs/kit/pull/3604))

## 2.0.0-next.109

### Patch Changes

- Bump version ([#3602](https://github.com/sveltejs/kit/pull/3602))

## 2.0.0-next.108

### Patch Changes

- And again ([#3600](https://github.com/sveltejs/kit/pull/3600))

## 2.0.0-next.107

### Patch Changes

- Trying something ([#3598](https://github.com/sveltejs/kit/pull/3598))

## 2.0.0-next.105

### Patch Changes

- Another meaningless change ([#3596](https://github.com/sveltejs/kit/pull/3596))

## 2.0.0-next.104

### Patch Changes

- typo ([#3593](https://github.com/sveltejs/kit/pull/3593))

## 2.0.0-next.103

### Patch Changes

- Tweak README ([#3591](https://github.com/sveltejs/kit/pull/3591))

## 2.0.0-next.102

### Patch Changes

- Fix typo ([#3583](https://github.com/sveltejs/kit/pull/3583))

## 2.0.0-next.101

### Patch Changes

- bump eslint plugin and parser in template ([#3544](https://github.com/sveltejs/kit/pull/3544))

## 2.0.0-next.100

### Patch Changes

- add ESLint configuration for mixed JS/TS codebase ([#3536](https://github.com/sveltejs/kit/pull/3536))

## 2.0.0-next.99

### Patch Changes

- Respect Ctrl-C when running create-svelte ([#3472](https://github.com/sveltejs/kit/pull/3472))
- Make project name an explicit option' ([#3472](https://github.com/sveltejs/kit/pull/3472))
- Prompt for directory when running create-svelte without argument ([#3472](https://github.com/sveltejs/kit/pull/3472))

## 2.0.0-next.98

### Patch Changes

- Add index.js file to `pkg.files` ([#3445](https://github.com/sveltejs/kit/pull/3445))

## 2.0.0-next.97

### Patch Changes

- Add a programmatic interface to create-svelte ([#3437](https://github.com/sveltejs/kit/pull/3437))

## 2.0.0-next.96

### Patch Changes

- breaking: change app.render signature to (request: Request) => Promise (#3384) ([#3430](https://github.com/sveltejs/kit/pull/3430))

## 2.0.0-next.95

### Patch Changes

- Add methodOverrides to default configs ([#3411](https://github.com/sveltejs/kit/pull/3411))

## 2.0.0-next.94

### Patch Changes

- Add methodOverride option for submitting PUT/PATCH/DELETE/etc with <form> elements ([#2989](https://github.com/sveltejs/kit/pull/2989))

## 2.0.0-next.93

### Patch Changes

- Update template files to include %svelte.assets% ([#3234](https://github.com/sveltejs/kit/pull/3234))

## 2.0.0-next.92

### Patch Changes

- Update template to use new page/request APIs ([#3146](https://github.com/sveltejs/kit/pull/3146))

## 2.0.0-next.91

### Patch Changes

- Make demo app complies with TypeScript strict mode ([#3095](https://github.com/sveltejs/kit/pull/3095))

## 2.0.0-next.90

### Patch Changes

- bump eslint ecmaVersion to 2020 ([#2985](https://github.com/sveltejs/kit/pull/2985))
- include missing .npmrc in templates ([#2990](https://github.com/sveltejs/kit/pull/2990))
- Do not gitignore `.env.example` ([#2926](https://github.com/sveltejs/kit/pull/2926))
- update to esbuild 0.13.15 and other dependency updates ([#2957](https://github.com/sveltejs/kit/pull/2957))

## 2.0.0-next.89

### Patch Changes

- Git ignore files with a .env. prefix ([#2905](https://github.com/sveltejs/kit/pull/2905))

## 2.0.0-next.88

### Patch Changes

- Improve project scaffolding language ([#2895](https://github.com/sveltejs/kit/pull/2895))

## 2.0.0-next.87

### Patch Changes

- Add adapter-auto to template configs ([#2885](https://github.com/sveltejs/kit/pull/2885))

## 2.0.0-next.86

### Patch Changes

- Add adapter-auto ([#2867](https://github.com/sveltejs/kit/pull/2867))
- Add an npm run package command to templates ([#2882](https://github.com/sveltejs/kit/pull/2882))

## 2.0.0-next.85

### Patch Changes

- feat: added .env to gitignore for skeleton and default starters ([#2732](https://github.com/sveltejs/kit/pull/2732))

## 2.0.0-next.84

### Patch Changes

- Add explicit types in `_api.ts` and `form.ts` for TypeScript and ESLint integration example ([#2657](https://github.com/sveltejs/kit/pull/2657))

## 2.0.0-next.83

### Patch Changes

- breaking: drop Node 12 support ([#2604](https://github.com/sveltejs/kit/pull/2604))

## 2.0.0-next.82

### Patch Changes

- chore: upgrade to Svelte 3.43.0" ([#2474](https://github.com/sveltejs/kit/pull/2474))

## 2.0.0-next.81

### Patch Changes

- fix: provide valid value for `letter-spacing` CSS property ([#2437](https://github.com/sveltejs/kit/pull/2437))
- update dependencies ([#2447](https://github.com/sveltejs/kit/pull/2447))

## 2.0.0-next.80

### Patch Changes

- chore: add links to repository and homepage to package.json ([#2425](https://github.com/sveltejs/kit/pull/2425))

## 2.0.0-next.79

### Patch Changes

- Use the name of folder as name in package.json ([#2415](https://github.com/sveltejs/kit/pull/2415))

## 2.0.0-next.78

### Patch Changes

- Disable delete button while waiting for API response ([#2172](https://github.com/sveltejs/kit/pull/2172))

## 2.0.0-next.77

### Patch Changes

- 94b34fa6: [breaking] standardize final output dir as /build (vs /.svelte-kit) ([#2109](https://github.com/sveltejs/kit/pull/2109))

## 2.0.0-next.76

### Patch Changes

- b9e63381: Add DOM to lib in tsconfig ([#1956](https://github.com/sveltejs/kit/pull/1956))

## 2.0.0-next.75

### Patch Changes

- fe68e13: Simplify component file names ([#1878](https://github.com/sveltejs/kit/pull/1878))

## 2.0.0-next.74

### Patch Changes

- 4c7ccfd: Add \$lib alias to js/tsconfig ([#1860](https://github.com/sveltejs/kit/pull/1860))

## 2.0.0-next.73

### Patch Changes

- 2d2fab1: Add favicon to skeleton template ([#1514](https://github.com/sveltejs/kit/pull/1514))
- 6aa4988: Replace favicon ([#1589](https://github.com/sveltejs/kit/pull/1589))

## 2.0.0-next.72

### Patch Changes

- 1739443: Add svelte-check to TS templates ([#1556](https://github.com/sveltejs/kit/pull/1556))
- 6372690: gitignore package directory ([#1499](https://github.com/sveltejs/kit/pull/1499))
- f211906: Adjust build-template script to include package.json ([#1555](https://github.com/sveltejs/kit/pull/1555))

## 2.0.0-next.71

### Patch Changes

- dad93fc: Fix workspace dependencies ([#1434](https://github.com/sveltejs/kit/pull/1434))

## 2.0.0-next.70

### Patch Changes

- d871213: Remove Vite dependency from apps ([#1374](https://github.com/sveltejs/kit/pull/1374))

## 2.0.0-next.69

### Patch Changes

- 9cc2508: Ensure template files match Prettier settings ([#1364](https://github.com/sveltejs/kit/pull/1364))
- f5e626d: Reference Vite/Svelte types inside Kit types ([#1319](https://github.com/sveltejs/kit/pull/1319))
- 8a402a9: Exclude deploy artifacts from create-svelte package ([#1363](https://github.com/sveltejs/kit/pull/1363))
- e8bed05: Prompt to npm install before prompting to git init ([#1362](https://github.com/sveltejs/kit/pull/1362))
- 507e2c3: fix: Prettier not formatting .svelte files ([#1360](https://github.com/sveltejs/kit/pull/1360))

## 2.0.0-next.68

### Patch Changes

- 5ed3ed2: Fix usage of request.locals in starter project ([#1344](https://github.com/sveltejs/kit/pull/1344))

## 2.0.0-next.67

### Patch Changes

- d15b48a: Add renamed .svelte -> .svelte-kit directory to ignore files ([#1339](https://github.com/sveltejs/kit/pull/1339))

## 2.0.0-next.66

### Patch Changes

- 1753987: Use request.locals

## 2.0.0-next.65

### Patch Changes

- 0befffb: Rename .svelte to .svelte-kit ([#1321](https://github.com/sveltejs/kit/pull/1321))
- c6fde99: Switch to ESM in config files ([#1323](https://github.com/sveltejs/kit/pull/1323))

## 2.0.0-next.64

### Patch Changes

- 3fb191c: Improved install prompts, turn confirms into toggle ([#1312](https://github.com/sveltejs/kit/pull/1312))

## 2.0.0-next.63

### Patch Changes

- d19f3de: bump minimum required Svelte version ([#1192](https://github.com/sveltejs/kit/pull/1192))

## 2.0.0-next.62

### Patch Changes

- c44f231: Improve a11y on to-do list in template ([#1207](https://github.com/sveltejs/kit/pull/1207))

## 2.0.0-next.61

### Patch Changes

- 82955ec: fix: adapt to svelte ids without ?import in vite 2.2.3

## 2.0.0-next.60

### Patch Changes

- 1b816b2: Update version of eslint-plugin-svelte3 ([#1195](https://github.com/sveltejs/kit/pull/1195))
- 6f2b4a6: Update welcome message ([#1196](https://github.com/sveltejs/kit/pull/1196))
- 6f2b4a6: No adapter by default ([#1196](https://github.com/sveltejs/kit/pull/1196))

## 2.0.0-next.59

### Patch Changes

- a2f3f4b: Rename `start` to `preview` in the CLI and package scripts

## 2.0.0-next.58

### Patch Changes

- 2bf4338: Add .gitignore files to new projects ([#1167](https://github.com/sveltejs/kit/pull/1167))

## 2.0.0-next.57

### Patch Changes

- 4645ad5: Remove obsolete vite.ssr config from template ([#1148](https://github.com/sveltejs/kit/pull/1148))
- 872d734: Hide out-of-view counter from assistive tech ([#1150](https://github.com/sveltejs/kit/pull/1150))

## 2.0.0-next.56

### Patch Changes

- cdf4d5b: Show git init instructions when creating new project
- 112d194: Uppercase method in template ([#1119](https://github.com/sveltejs/kit/pull/1119))

## 2.0.0-next.55

### Patch Changes

- daf6913: Fix bootstrapping command on about page ([#1105](https://github.com/sveltejs/kit/pull/1105))

## 2.0.0-next.54

### Patch Changes

- a84cb88: Fix global.d.ts rename, Windows build issue, missing adapter-node ([#1095](https://github.com/sveltejs/kit/pull/1095))

## 2.0.0-next.53

### Patch Changes

- 27c2e1d: Fix CSS on demo app hero image ([#1088](https://github.com/sveltejs/kit/pull/1088))
- bbeb58f: Include dotfiles when creating new project ([#1084](https://github.com/sveltejs/kit/pull/1084))
- 6a8e73f: Remove large image from create-svelte ([#1085](https://github.com/sveltejs/kit/pull/1085))

## 2.0.0-next.52

### Patch Changes

- f342372: Adding new Hello World templates (default with enhanced style and skeleton) to create-svelte ([#1014](https://github.com/sveltejs/kit/pull/1014))

## 2.0.0-next.51

### Patch Changes

- 4cffc14: add global.d.ts to js version ([#1051](https://github.com/sveltejs/kit/pull/1051))

## 2.0.0-next.50

### Patch Changes

- 3802c64: Fix build so that the package can be automatically published ([#1001](https://github.com/sveltejs/kit/pull/1001))

## 2.0.0-next.49

### Patch Changes

- 3c41d07: Fix preprocess option in template
- 9bb747f: Remove CSS option and simplify ([#989](https://github.com/sveltejs/kit/pull/989))

## 2.0.0-next.48

### Patch Changes

- 4c45784: Add ambient types to published files ([#980](https://github.com/sveltejs/kit/pull/980))

## 2.0.0-next.47

### Patch Changes

- 59a1e06: Add button:focus CSS styles to index page of default app ([#957](https://github.com/sveltejs/kit/pull/957))
- 39b6967: Add ambient type definitions for \$app imports ([#917](https://github.com/sveltejs/kit/pull/917))
- dfbe62b: Add title tag to index page of default app ([#954](https://github.com/sveltejs/kit/pull/954))

## 2.0.0-next.46

### Patch Changes

- 570f90c: Update tsconfig to use module and lib es2020 ([#817](https://github.com/sveltejs/kit/pull/817))
- 8d453c8: Specify minimum Node version number in @sveltejs/kit and add .npmrc to enforce it ([#787](https://github.com/sveltejs/kit/pull/787))

## 2.0.0-next.45

### Patch Changes

- dac29c5: allow importing JSON modules ([#792](https://github.com/sveltejs/kit/pull/792))
- 8dc89ba: Set target to es2019 in default tsconfig.json ([#772](https://github.com/sveltejs/kit/pull/772))

## 2.0.0-next.44

### Patch Changes

- 7e51473: fix eslint error in ts starter template, add eslint and prettier ignore config
- 7d42f72: Add a global stylesheet during create-svelte depending on the chosen CSS preprocessor ([#726](https://github.com/sveltejs/kit/pull/726))

## 2.0.0-next.43

### Patch Changes

- bdf4ed9: Fix typo in `ignorePatterns` for the `.eslintrc.cjs` generated for TypeScript projects so that `.eslintrc.cjs` correctly ignores itself. ([#701](https://github.com/sveltejs/kit/pull/701))
- f7badf1: Add '\$service-worker' to paths in tsconfig.json ([#716](https://github.com/sveltejs/kit/pull/716))
- 9a664e1: Set `.eslintrc.cjs` to ignore all `.cjs` files. ([#707](https://github.com/sveltejs/kit/pull/707))
- df380e6: Add env options to eslint config ([#722](https://github.com/sveltejs/kit/pull/722))

## 2.0.0-next.42

### Patch Changes

- a52cf82: add eslint and prettier setup options ([#632](https://github.com/sveltejs/kit/pull/632))

## 2.0.0-next.41

### Patch Changes

- 8024178: remove @sveltejs/app-utils ([#600](https://github.com/sveltejs/kit/pull/600))

## 2.0.0-next.40

### Patch Changes

- 8805c6d: Pass adapters directly to svelte.config.cjs ([#579](https://github.com/sveltejs/kit/pull/579))

## 2.0.0-next.39

### Patch Changes

- ac3669e: Move Vite config into svelte.config.cjs ([#569](https://github.com/sveltejs/kit/pull/569))

## 2.0.0-next.38

### Patch Changes

- c04887c: create-svelte: Include globals.d.ts in tsconfig ([#549](https://github.com/sveltejs/kit/pull/549))

## 2.0.0-next.37

### Patch Changes

- c76c9bf: Upgrade Vite ([#544](https://github.com/sveltejs/kit/pull/544))
- ab28c0a: create-svelte: Remove duplicate types ([#538](https://github.com/sveltejs/kit/pull/538))

## 2.0.0-next.36

### Patch Changes

- 0da62eb: create-svelte: Include missing ts-template ([#535](https://github.com/sveltejs/kit/pull/535))

## 2.0.0-next.35

### Patch Changes

- bb01514: Actually fix $component => $lib transition ([#529](https://github.com/sveltejs/kit/pull/529))

## 2.0.0-next.34

### Patch Changes

- 848687c: Fix location of example `Counter.svelte` component ([#522](https://github.com/sveltejs/kit/pull/522))

## 2.0.0-next.33

### Patch Changes

- f7dc6ad: Fix typo in template app
- 5554acc: Add \$lib alias ([#511](https://github.com/sveltejs/kit/pull/511))
- c0ed7a8: create-svelte: globals.d.ts TSDoc fixes, add vite/client types to js/tsconfig ([#517](https://github.com/sveltejs/kit/pull/517))

## 2.0.0-next.32

### Patch Changes

- 97b7ea4: jsconfig for js projects ([#510](https://github.com/sveltejs/kit/pull/510))

## 2.0.0-next.31

### Patch Changes

- c3cf3f3: Bump deps ([#492](https://github.com/sveltejs/kit/pull/492))
- 625747d: create-svelte: bundle production dependencies for SSR ([#486](https://github.com/sveltejs/kit/pull/486))

## 2.0.0-next.30

### Patch Changes

- b800049: Include type declarations ([#442](https://github.com/sveltejs/kit/pull/442))

## 2.0.0-next.29

### Patch Changes

- 15dd6d6: Fix setup to include vite ([#415](https://github.com/sveltejs/kit/pull/415))

## 2.0.0-next.28

### Patch Changes

- Use Vite

## 2.0.0-next.27

### Patch Changes

- Convert everything to ESM

## 2.0.0-next.26

### Patch Changes

- 00cbaf6: Rename `_.config.js` to `_.config.cjs` ([#356](https://github.com/sveltejs/kit/pull/356))

## 2.0.0-next.25

### Patch Changes

- c9d8d4f: Render to #svelte by default

## 2.0.0-next.24

### Patch Changes

- 0e45255: Move options behind kit namespace, change paths -> kit.files ([#236](https://github.com/sveltejs/kit/pull/236))

## 2.0.0-next.23

### Patch Changes

- Use next tag for all packages

## 2.0.0-next.22

### Patch Changes

- Bump kit version

## 2.0.0-next.21

### Patch Changes

- Show create-svelte version when starting a new project

## 2.0.0-alpha.19

### Patch Changes

- Add svelte-kit start command

## 2.0.0-alpha.18

### Patch Changes

- rename CLI to svelte-kit
- 0904e22: rename svelte CLI to svelte-kit ([#186](https://github.com/sveltejs/kit/pull/186))

## 2.0.0-alpha.16

### Patch Changes

- 5fbc475: Add TypeScript support at project init

## 2.0.0-alpha.14-15

### Patch Changes

- Add 'here be dragons' warning

## 2.0.0-alpha.13

### Patch Changes

- d936573: Give newly created app a name based on current directory
- 5ca907c: Use shared mkdirp helper

####### packages/create-svelte/index.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import { mkdirp, copy, dist } from './utils.js';

/** @type {import('./types/index.js').create} */
export async function create(cwd, options) {
	mkdirp(cwd);

	write_template_files(options.template, options.types, options.name, cwd);
	write_common_files(cwd, options, options.name);
}

/**
 * @param {string} template
 * @param {'typescript' | 'checkjs' | null} types
 * @param {string} name
 * @param {string} cwd
 */
function write_template_files(template, types, name, cwd) {
	const dir = dist(`templates/${template}`);
	copy(`${dir}/assets`, cwd, (name) => name.replace('DOT-', '.'));
	copy(`${dir}/package.json`, `${cwd}/package.json`);

	const manifest = `${dir}/files.types=${types}.json`;
	const files = /** @type {import('./types/internal.js').File[]} */ (
		JSON.parse(fs.readFileSync(manifest, 'utf-8'))
	);

	files.forEach((file) => {
		const dest = path.join(cwd, file.name);
		mkdirp(path.dirname(dest));

		fs.writeFileSync(dest, file.contents.replace(/~TODO~/g, name));
	});
}

/**
 *
 * @param {string} cwd
 * @param {import('./types/internal.js').Options} options
 * @param {string} name
 */
function write_common_files(cwd, options, name) {
	const shared = dist('shared.json');
	const { files } = /** @type {import('./types/internal.js').Common} */ (
		JSON.parse(fs.readFileSync(shared, 'utf-8'))
	);

	const pkg_file = path.join(cwd, 'package.json');
	const pkg = /** @type {any} */ (JSON.parse(fs.readFileSync(pkg_file, 'utf-8')));

	sort_files(files).forEach((file) => {
		const include = file.include.every((condition) => matches_condition(condition, options));
		const exclude = file.exclude.some((condition) => matches_condition(condition, options));

		if (exclude || !include) return;

		if (file.name === 'package.json') {
			const new_pkg = JSON.parse(file.contents);
			merge(pkg, new_pkg);
		} else {
			const dest = path.join(cwd, file.name);
			mkdirp(path.dirname(dest));
			fs.writeFileSync(dest, file.contents);
		}
	});

	pkg.dependencies = sort_keys(pkg.dependencies);
	pkg.devDependencies = sort_keys(pkg.devDependencies);
	pkg.name = to_valid_package_name(name);

	fs.writeFileSync(pkg_file, JSON.stringify(pkg, null, '\t') + '\n');
}

/**
 * @param {import('./types/internal.js').Condition} condition
 * @param {import('./types/internal.js').Options} options
 * @returns {boolean}
 */
function matches_condition(condition, options) {
	if (condition === 'default' || condition === 'skeleton' || condition === 'skeletonlib') {
		return options.template === condition;
	}
	if (condition === 'typescript' || condition === 'checkjs') {
		return options.types === condition;
	}
	return !!options[condition];
}

/**
 * @param {any} target
 * @param {any} source
 */
function merge(target, source) {
	for (const key in source) {
		if (key in target) {
			const target_value = target[key];
			const source_value = source[key];

			if (
				typeof source_value !== typeof target_value ||
				Array.isArray(source_value) !== Array.isArray(target_value)
			) {
				throw new Error('Mismatched values');
			}

			if (typeof source_value === 'object') {
				merge(target_value, source_value);
			} else {
				target[key] = source_value;
			}
		} else {
			target[key] = source[key];
		}
	}
}

/** @param {Record<string, any>} obj */
function sort_keys(obj) {
	if (!obj) return;

	/** @type {Record<string, any>} */
	const sorted = {};
	Object.keys(obj)
		.sort()
		.forEach((key) => {
			sorted[key] = obj[key];
		});

	return sorted;
}

/**
 * Sort files so that those which apply more generically come first so they
 * can be overwritten by files for more precise cases later.
 *
 * @param {import('./types/internal.js').Common['files']} files
 */
function sort_files(files) {
	return files.sort((f1, f2) => {
		const f1_more_generic =
			f1.include.every((include) => f2.include.includes(include)) &&
			f1.exclude.every((exclude) => f2.exclude.includes(exclude));
		const f2_more_generic =
			f2.include.every((include) => f1.include.includes(include)) &&
			f2.exclude.every((exclude) => f1.exclude.includes(exclude));
		const same = f1_more_generic && f2_more_generic;
		const different = !f1_more_generic && !f2_more_generic;
		return same || different ? 0 : f1_more_generic ? -1 : 1;
	});
}

/** @param {string} name */
function to_valid_package_name(name) {
	return name
		.trim()
		.toLowerCase()
		.replace(/\s+/g, '-')
		.replace(/^[._]/, '')
		.replace(/[^a-z0-9~.-]+/g, '-');
}

```


####### packages/create-svelte/package.json #######

```

{
	"name": "create-svelte",
	"version": "6.1.2",
	"description": "A CLI for creating new SvelteKit projects",
	"repository": {
		"type": "git",
		"url": "https://github.com/sveltejs/kit",
		"directory": "packages/create-svelte"
	},
	"license": "MIT",
	"homepage": "https://kit.svelte.dev",
	"bin": "./bin.js",
	"main": "./index.js",
	"dependencies": {
		"@clack/prompts": "^0.7.0",
		"kleur": "^4.1.5"
	},
	"devDependencies": {
		"@playwright/test": "^1.41.0",
		"@types/gitignore-parser": "^0.0.3",
		"gitignore-parser": "^0.0.2",
		"prettier": "^3.1.1",
		"prettier-plugin-svelte": "^3.1.2",
		"sucrase": "^3.34.0",
		"svelte": "^4.2.10",
		"tiny-glob": "^0.2.9",
		"typescript": "^5.3.3",
		"vitest": "^1.5.0"
	},
	"scripts": {
		"build": "node scripts/build-templates",
		"test": "pnpm build && vitest run",
		"check": "tsc",
		"lint": "prettier --check . --config ../../.prettierrc --ignore-path ../../.gitignore --ignore-path .gitignore",
		"format": "pnpm lint --write",
		"prepublishOnly": "pnpm build",
		"postpublish": "echo \"Updating template repo\" && bash ./scripts/update-template-repo.sh"
	},
	"files": [
		"index.js",
		"dist",
		"bin.js",
		"utils.js",
		"types"
	],
	"types": "types/index.d.ts",
	"type": "module"
}

```


####### packages/create-svelte/README.md #######

# create-svelte

A CLI for creating new [SvelteKit](https://kit.svelte.dev) projects. Just run...

```bash
npm create svelte@latest
```

...and follow the prompts.

## API

You can also use `create-svelte` programmatically:

```js
import { create } from 'create-svelte';

await create('my-new-app', {
  name: 'my-new-app',
  template: 'default', // or 'skeleton' or 'skeletonlib'
  types: 'checkjs', // or 'typescript' or null;
  prettier: false,
  eslint: false,
  playwright: false,
  vitest: false
});
```

`checkjs` means your project will use TypeScript to typecheck JavaScript via [JSDoc comments](https://www.typescriptlang.org/docs/handbook/jsdoc-supported-types.html).

## License

[MIT](../../LICENSE).

####### packages/create-svelte/scripts/build-templates.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import parser from 'gitignore-parser';
import prettier from 'prettier';
import { transform } from 'sucrase';
import glob from 'tiny-glob/sync.js';
import { mkdirp, rimraf } from '../utils.js';

/** @param {string} content */
async function convert_typescript(content) {
	let { code } = transform(content, {
		transforms: ['typescript'],
		disableESTransforms: true
	});

	// sucrase leaves invalid class fields intact
	code = code.replace(/^\s*[a-z]+;$/gm, '');

	// Prettier strips 'unnecessary' parens from .ts files, we need to hack them back in
	code = code.replace(/(\/\*\* @type.+? \*\/) (.+?) \/\*\*\*\//g, '$1($2)');

	return await prettier.format(code, {
		parser: 'babel',
		useTabs: true,
		singleQuote: true,
		trailingComma: 'none',
		printWidth: 100
	});
}

/** @param {string} content */
function strip_jsdoc(content) {
	return content
		.replace(/ \/\*\*\*\//g, '')
		.replace(
			/\/\*\*([\s\S]+?)(@[\s\S]+?)?\*\/([\s\n]+)/g,
			(match, description, tags, whitespace) => {
				if (/^\s+(\*\s*)?$/.test(description)) {
					return '';
				}

				return `/**${description.replace(/\* $/, '')}*/${whitespace}`;
			}
		);
}

/** @param {Set<string>} shared */
async function generate_templates(shared) {
	const templates = fs.readdirSync('templates');

	for (const template of templates) {
		if (template[0] === '.') continue;

		const dir = `dist/templates/${template}`;
		const assets = `${dir}/assets`;
		mkdirp(assets);

		const cwd = path.resolve('templates', template);

		const gitignore_file = path.join(cwd, '.gitignore');
		if (!fs.existsSync(gitignore_file)) {
			throw new Error(`"${template}" template must have a .gitignore file`);
		}

		const gitignore = parser.compile(fs.readFileSync(gitignore_file, 'utf-8'));

		const ignore_file = path.join(cwd, '.ignore');
		if (!fs.existsSync(ignore_file)) throw new Error('Template must have a .ignore file');
		const ignore = parser.compile(fs.readFileSync(ignore_file, 'utf-8'));

		const meta_file = path.join(cwd, '.meta.json');
		if (!fs.existsSync(meta_file)) throw new Error('Template must have a .meta.json file');

		/** @type {Record<string, import('../types/internal.js').File[]>} */
		const types = {
			typescript: [],
			checkjs: [],
			null: []
		};

		const files = glob('**/*', { cwd, filesOnly: true, dot: true });
		for (const name of files) {
			// the package.template.json thing is a bit annoying — basically we want
			// to be able to develop and deploy the app from here, but have a different
			// package.json in newly created projects (based on package.template.json)
			if (name === 'package.template.json') {
				let contents = fs.readFileSync(path.join(cwd, name), 'utf8');
				// TODO package-specific versions
				contents = contents.replace(/workspace:\*/g, 'next');
				fs.writeFileSync(`${dir}/package.json`, contents);
				continue;
			}

			// ignore files that are written conditionally
			if (shared.has(name)) continue;

			// ignore contents of .gitignore or .ignore
			if (!gitignore.accepts(name) || !ignore.accepts(name) || name === '.ignore') continue;

			if (/\.(ts|svelte)$/.test(name)) {
				const contents = fs.readFileSync(path.join(cwd, name), 'utf8');

				if (name.endsWith('.d.ts')) {
					if (name.endsWith('app.d.ts')) types.checkjs.push({ name, contents });
					types.typescript.push({ name, contents });
				} else if (name.endsWith('.ts')) {
					const js = await convert_typescript(contents);

					types.typescript.push({
						name,
						contents: strip_jsdoc(contents)
					});

					types.checkjs.push({
						name: name.replace(/\.ts$/, '.js'),
						contents: js
					});

					types.null.push({
						name: name.replace(/\.ts$/, '.js'),
						contents: strip_jsdoc(js)
					});
				} else {
					// we jump through some hoops, rather than just using svelte.preprocess,
					// so that the output preserves the original formatting to the extent
					// possible (e.g. preserving double line breaks). Sucrase is the best
					// tool for the job because it just removes the types; Prettier then
					// tidies up the end result
					const js_contents = await replace_async(
						contents,
						/<script([^>]+)>([\s\S]+?)<\/script>/g,
						async (
							/** @type {any} */ m,
							/** @type {string} */ attrs,
							/** @type {string} */ typescript
						) => {
							// Sucrase assumes 'unused' imports (which _are_ used, but only
							// in the markup) are type imports, and strips them. This step
							// prevents it from drawing that conclusion
							const imports = [];
							const import_pattern = /import (.+?) from/g;
							let import_match;
							while ((import_match = import_pattern.exec(typescript))) {
								const word_pattern = /[a-z_$][a-z0-9_$]*/gi;
								let word_match;
								while ((word_match = word_pattern.exec(import_match[1]))) {
									imports.push(word_match[0]);
								}
							}

							const suffix = `\n${imports.join(',')}`;

							const transformed = transform(typescript + suffix, {
								transforms: ['typescript'],
								disableESTransforms: true
							}).code.slice(0, -suffix.length);

							const contents = (
								await prettier.format(transformed, {
									parser: 'babel',
									useTabs: true,
									singleQuote: true,
									trailingComma: 'none',
									printWidth: 100
								})
							)
								.trim()
								.replace(/^(.)/gm, '\t$1');

							return `<script${attrs.replace(' lang="ts"', '')}>\n${contents}\n</script>`;
						}
					);

					types.typescript.push({
						name,
						contents: strip_jsdoc(contents)
					});

					types.checkjs.push({
						name,
						contents: js_contents
					});

					types.null.push({
						name,
						contents: strip_jsdoc(js_contents)
					});
				}
			} else {
				const dest = path.join(assets, name.replace(/^\./, 'DOT-'));
				mkdirp(path.dirname(dest));
				fs.copyFileSync(path.join(cwd, name), dest);
			}
		}

		fs.copyFileSync(meta_file, `${dir}/meta.json`);
		fs.writeFileSync(
			`${dir}/files.types=typescript.json`,
			JSON.stringify(types.typescript, null, '\t')
		);
		fs.writeFileSync(`${dir}/files.types=checkjs.json`, JSON.stringify(types.checkjs, null, '\t'));
		fs.writeFileSync(`${dir}/files.types=null.json`, JSON.stringify(types.null, null, '\t'));
	}
}

/**
 * @param {string} string
 * @param {RegExp} regexp
 * @param {{ (m: any, attrs: string, typescript: string): Promise<string>; (arg0: any): any; }} replacer
 */
async function replace_async(string, regexp, replacer) {
	const replacements = await Promise.all(
		// @ts-ignore
		Array.from(string.matchAll(regexp), (match) => replacer(...match))
	);
	let i = 0;
	return string.replace(regexp, () => replacements[i++]);
}

async function generate_shared() {
	const cwd = path.resolve('shared');

	/** @type {Set<string>} */
	const shared = new Set();

	/** @type {Array<{ name: string, include: string[], exclude: string[], contents: string }>} */
	const files = [];

	const globbed = glob('**/*', { cwd, filesOnly: true, dot: true });
	for (const file of globbed) {
		const contents = fs.readFileSync(path.join(cwd, file), 'utf8');

		/** @type {string[]} */
		const include = [];

		/** @type {string[]} */
		const exclude = [];

		let name = file;

		if (file.startsWith('+') || file.startsWith('-')) {
			const [conditions, ...rest] = file.split(path.sep);

			const pattern = /([+-])([a-z0-9]+)/g;
			let match;
			while ((match = pattern.exec(conditions))) {
				const set = match[1] === '+' ? include : exclude;
				set.push(match[2]);
			}

			name = rest.join('/');
		}

		if (name.endsWith('.ts') && !include.includes('typescript')) {
			// file includes types in TypeScript and JSDoc —
			// create .js file, with and without JSDoc
			const js = await convert_typescript(contents);
			const js_name = name.replace(/\.ts$/, '.js');

			// typescript
			files.push({
				name,
				include: [...include, 'typescript'],
				exclude,
				contents: strip_jsdoc(contents)
			});

			// checkjs
			files.push({
				name: js_name,
				include: [...include, 'checkjs'],
				exclude,
				contents: js
			});

			// no typechecking
			files.push({
				name: js_name,
				include,
				exclude: [...exclude, 'typescript', 'checkjs'],
				contents: strip_jsdoc(js)
			});

			shared.add(name);
			shared.add(js_name);
		} else {
			shared.add(name);
			files.push({ name, include, exclude, contents });
		}
	}

	files.sort((a, b) => a.include.length + a.exclude.length - (b.include.length + b.exclude.length));

	fs.writeFileSync('dist/shared.json', JSON.stringify({ files }, null, '\t'));

	shared.delete('package.json');
	return shared;
}

async function main() {
	rimraf('dist');
	mkdirp('dist');

	const shared = await generate_shared();
	await generate_templates(shared);
}

main();

```


####### packages/create-svelte/scripts/update-template-repo-contents.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import { create } from '../index.js';

const repo = process.argv[2];

fs.readdirSync(repo).forEach((file) => {
	if (file !== '.git') {
		fs.rmSync(path.join(repo, file), {
			recursive: true,
			force: true
		});
	}
});

await create(repo, {
	name: 'kit-template-default',
	template: 'default',
	eslint: false,
	types: 'checkjs',
	prettier: true,
	playwright: false,
	vitest: false,
	svelte5: false
});

// Remove the Sverdle from the template because it doesn't work within Stackblitz (cookies not set)
fs.rmSync(path.join(repo, 'src', 'routes', 'sverdle'), { force: true, recursive: true });

const header_file = path.join(repo, 'src', 'routes', 'Header.svelte');
const header = fs.readFileSync(header_file, 'utf-8');
fs.writeFileSync(
	header_file,
	// Remove the Sverdle link from the header
	header.replace(/<\/li>\s+<li.+?'\/sverdle'[\s\S]+?<\/li>/, '</li>')
);

const about_file = path.join(repo, 'src', 'routes', 'about', '+page.svelte');
const about = fs.readFileSync(about_file, 'utf-8');
fs.writeFileSync(
	about_file,
	// Remove the Sverdle paragraph from the about page
	about.replace(/<\/p>\s+<p>\s+?[\s\S]+?Sverdle[\s\S]+?<\/p>/, '</p>')
);

```


####### packages/create-svelte/scripts/update-template-repo.sh #######

```

#!/bin/bash

get_abs_filename() {
  # $1 : relative filename
  echo "$(cd "$(dirname "$1")" && pwd)/$(basename "$1")"
}

DIR=$(get_abs_filename $(dirname "$0"))
TMP=$(get_abs_filename "$DIR/../node_modules/.tmp")

mkdir -p $TMP
cd $TMP

if [ "$CI" ]; then
	(umask 0077; echo "$UPDATE_TEMPLATE_SSH_KEY" > ~/ssh_key;)
	export GIT_SSH_COMMAND='ssh -o StrictHostKeyChecking=accept-new -i ~/ssh_key'
fi

# clone the template repo
rm -rf kit-template-default
git clone --depth 1 --single-branch --branch main git@github.com:sveltejs/kit-template-default.git kit-template-default

# empty out the repo
cd kit-template-default
node $DIR/update-template-repo-contents.js $TMP/kit-template-default

if [ "$CI" ]; then
	git config user.email 'noreply@svelte.dev'
	git config user.name '[bot]'
fi

# commit the new files
git add -A
git commit -m "version $npm_package_version"

git push git@github.com:sveltejs/kit-template-default.git main -f
```


####### packages/create-svelte/shared/+checkjs/jsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"skipLibCheck": true,
		"sourceMap": true,
		"strict": true,
		"moduleResolution": "bundler"
	}
	// Path aliases are handled by https://kit.svelte.dev/docs/configuration#alias
	// except $lib which is handled by https://kit.svelte.dev/docs/configuration#files
	//
	// If you want to overwrite includes/excludes, make sure to copy over the relevant includes/excludes
	// from the referenced tsconfig.json - TypeScript does not merge them in
}

```


####### packages/create-svelte/shared/+checkjs/package.json #######

```

{
	"scripts": {
		"check": "svelte-kit sync && svelte-check --tsconfig ./jsconfig.json",
		"check:watch": "svelte-kit sync && svelte-check --tsconfig ./jsconfig.json --watch"
	},
	"devDependencies": {
		"typescript": "^5.0.0",
		"svelte-check": "^3.6.0"
	}
}

```


####### packages/create-svelte/shared/+default+checkjs/svelte.config.js #######

```

import adapter from '@sveltejs/adapter-auto';
import { vitePreprocess } from '@sveltejs/vite-plugin-svelte';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	// Consult https://kit.svelte.dev/docs/integrations#preprocessors
	// for more information about preprocessors
	preprocess: vitePreprocess(),

	kit: {
		// adapter-auto only supports some environments, see https://kit.svelte.dev/docs/adapter-auto for a list.
		// If your environment is not supported, or you settled on a specific environment, switch out the adapter.
		// See https://kit.svelte.dev/docs/adapters for more information about adapters.
		adapter: adapter()
	}
};

export default config;

```


####### packages/create-svelte/shared/+default+typescript/svelte.config.js #######

```

import adapter from '@sveltejs/adapter-auto';
import { vitePreprocess } from '@sveltejs/vite-plugin-svelte';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	// Consult https://kit.svelte.dev/docs/integrations#preprocessors
	// for more information about preprocessors
	preprocess: vitePreprocess(),

	kit: {
		// adapter-auto only supports some environments, see https://kit.svelte.dev/docs/adapter-auto for a list.
		// If your environment is not supported, or you settled on a specific environment, switch out the adapter.
		// See https://kit.svelte.dev/docs/adapters for more information about adapters.
		adapter: adapter()
	}
};

export default config;

```


####### packages/create-svelte/shared/+default-typescript/svelte.config.js #######

```

import adapter from '@sveltejs/adapter-auto';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		// adapter-auto only supports some environments, see https://kit.svelte.dev/docs/adapter-auto for a list.
		// If your environment is not supported, or you settled on a specific environment, switch out the adapter.
		// See https://kit.svelte.dev/docs/adapters for more information about adapters.
		adapter: adapter()
	}
};

export default config;

```


####### packages/create-svelte/shared/+default+vitest/src/routes/sverdle/game.test.ts #######

```

import { describe, it, expect } from 'vitest';
import { Game } from './game';

describe('game test', () => {
	it('returns true when a valid word is entered', () => {
		const game = new Game();
		expect(game.enter('zorro'.split(''))).toBe(true);
	});
});

```


####### packages/create-svelte/shared/+eslint/package.json #######

```

{
	"devDependencies": {
		"@types/eslint": "^8.56.0",
		"eslint": "^8.56.0",
		"eslint-plugin-svelte": "^2.35.1"
	}
}

```


####### packages/create-svelte/shared/+eslint+prettier/package.json #######

```

{
	"devDependencies": {
		"eslint-config-prettier": "^9.1.0"
	},
	"scripts": {
		"lint": "prettier --check . && eslint .",
		"format": "prettier --write ."
	}
}

```


####### packages/create-svelte/shared/+eslint-prettier/package.json #######

```

{
	"scripts": {
		"lint": "eslint ."
	}
}

```


####### packages/create-svelte/shared/-eslint+prettier/package.json #######

```

{
	"scripts": {
		"lint": "prettier --check .",
		"format": "prettier --write ."
	}
}

```


####### packages/create-svelte/shared/+eslint+svelte5/package.json #######

```

{
	"devDependencies": {
		"eslint-plugin-svelte": "^2.36.0-next.4"
	}
}

```


####### packages/create-svelte/shared/+eslint+typescript/package.json #######

```

{
	"devDependencies": {
		"@typescript-eslint/eslint-plugin": "^7.0.0",
		"@typescript-eslint/parser": "^7.0.0"
	}
}

```


####### packages/create-svelte/shared/+playwright+default/tests/test.ts #######

```

import { expect, test } from '@playwright/test';

test('about page has expected h1', async ({ page }) => {
	await page.goto('/about');
	await expect(page.getByRole('heading', { name: 'About this app' })).toBeVisible();
});

```


####### packages/create-svelte/shared/+playwright/package.json #######

```

{
	"devDependencies": {
		"@playwright/test": "^1.28.1"
	},
	"scripts": {
		"test": "playwright test"
	}
}

```


####### packages/create-svelte/shared/+playwright+skeletonlib/tests/test.ts #######

```

import { expect, test } from '@playwright/test';

test('index page has expected h1', async ({ page }) => {
	await page.goto('/');
	await expect(page.getByRole('heading', { name: 'Welcome to SvelteKit' })).toBeVisible();
});

```


####### packages/create-svelte/shared/+playwright+skeleton/tests/test.ts #######

```

import { expect, test } from '@playwright/test';

test('index page has expected h1', async ({ page }) => {
	await page.goto('/');
	await expect(page.getByRole('heading', { name: 'Welcome to SvelteKit' })).toBeVisible();
});

```


####### packages/create-svelte/shared/+playwright-typescript/playwright.config.js #######

```

/** @type {import('@playwright/test').PlaywrightTestConfig} */
const config = {
	webServer: {
		command: 'npm run build && npm run preview',
		port: 4173
	},
	testDir: 'tests',
	testMatch: /(.+\.)?(test|spec)\.[jt]s/
};

export default config;

```


####### packages/create-svelte/shared/+playwright+typescript/playwright.config.ts #######

```

import type { PlaywrightTestConfig } from '@playwright/test';

const config: PlaywrightTestConfig = {
	webServer: {
		command: 'npm run build && npm run preview',
		port: 4173
	},
	testDir: 'tests',
	testMatch: /(.+\.)?(test|spec)\.[jt]s/
};

export default config;

```


####### packages/create-svelte/shared/+playwright+vitest/package.json #######

```

{
	"devDependencies": {
		"@playwright/test": "^1.28.1",
		"vitest": "^1.2.0"
	},
	"scripts": {
		"test:integration": "playwright test",
		"test:unit": "vitest",
		"test": "npm run test:integration && npm run test:unit"
	}
}

```


####### packages/create-svelte/shared/+prettier/package.json #######

```

{
	"devDependencies": {
		"prettier": "^3.1.1",
		"prettier-plugin-svelte": "^3.1.2"
	}
}

```


####### packages/create-svelte/shared/README.md #######

# create-svelte

Everything you need to build a Svelte project, powered by [`create-svelte`](https://github.com/sveltejs/kit/tree/main/packages/create-svelte).

## Creating a project

If you're seeing this, you've probably already done this step. Congrats!

```bash
# create a new project in the current directory
npm create svelte@latest

# create a new project in my-app
npm create svelte@latest my-app
```

## Developing

Once you've created a project and installed dependencies with `npm install` (or `pnpm install` or `yarn`), start a development server:

```bash
npm run dev

# or start the server and open the app in a new browser tab
npm run dev -- --open
```

## Building

To create a production version of your app:

```bash
npm run build
```

You can preview the production build with `npm run preview`.

> To deploy your app, you may need to install an [adapter](https://kit.svelte.dev/docs/adapters) for your target environment.

####### packages/create-svelte/shared/+skeletonlib+checkjs/jsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"skipLibCheck": true,
		"sourceMap": true,
		"strict": true,
		"module": "NodeNext",
		"moduleResolution": "NodeNext"
	}
}

```


####### packages/create-svelte/shared/+skeletonlib/README.md #######

# create-svelte

Everything you need to build a Svelte library, powered by [`create-svelte`](https://github.com/sveltejs/kit/tree/main/packages/create-svelte).

Read more about creating a library [in the docs](https://kit.svelte.dev/docs/packaging).

## Creating a project

If you're seeing this, you've probably already done this step. Congrats!

```bash
# create a new project in the current directory
npm create svelte@latest

# create a new project in my-app
npm create svelte@latest my-app
```

## Developing

Once you've created a project and installed dependencies with `npm install` (or `pnpm install` or `yarn`), start a development server:

```bash
npm run dev

# or start the server and open the app in a new browser tab
npm run dev -- --open
```

Everything inside `src/lib` is part of your library, everything inside `src/routes` can be used as a showcase or preview app.

## Building

To build your library:

```bash
npm run package
```

To create a production version of your showcase app:

```bash
npm run build
```

You can preview the production build with `npm run preview`.

> To deploy your app, you may need to install an [adapter](https://kit.svelte.dev/docs/adapters) for your target environment.

## Publishing

Go into the `package.json` and give your package the desired name through the `"name"` option. Also consider adding a `"license"` field and point it to a `LICENSE` file which you can create from a template (one popular option is the [MIT license](https://opensource.org/license/mit/)).

To publish your library to [npm](https://www.npmjs.com):

```bash
npm publish
```

####### packages/create-svelte/shared/+skeletonlib+svelte5/package.json #######

```

{
	"peerDependencies": {
		"svelte": "^5.0.0-next.1"
	},
	"devDependencies": {
		"svelte": "^5.0.0-next.1"
	}
}

```


####### packages/create-svelte/shared/+skeletonlib-typescript/jsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"skipLibCheck": true,
		"sourceMap": true,
		"module": "NodeNext",
		"moduleResolution": "NodeNext"
	}
}

```


####### packages/create-svelte/shared/+skeletonlib+typescript/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"skipLibCheck": true,
		"sourceMap": true,
		"strict": true,
		"module": "NodeNext",
		"moduleResolution": "NodeNext"
	}
}

```


####### packages/create-svelte/shared/+svelte5/package.json #######

```

{
	"devDependencies": {
		"svelte": "^5.0.0-next.1"
	}
}

```


####### packages/create-svelte/shared/+typescript/package.json #######

```

{
	"scripts": {
		"check": "svelte-kit sync && svelte-check --tsconfig ./tsconfig.json",
		"check:watch": "svelte-kit sync && svelte-check --tsconfig ./tsconfig.json --watch"
	},
	"devDependencies": {
		"typescript": "^5.0.0",
		"tslib": "^2.4.1",
		"svelte-check": "^3.6.0"
	}
}

```


####### packages/create-svelte/shared/+typescript/svelte.config.js #######

```

import adapter from '@sveltejs/adapter-auto';
import { vitePreprocess } from '@sveltejs/vite-plugin-svelte';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	// Consult https://kit.svelte.dev/docs/integrations#preprocessors
	// for more information about preprocessors
	preprocess: vitePreprocess(),

	kit: {
		// adapter-auto only supports some environments, see https://kit.svelte.dev/docs/adapter-auto for a list.
		// If your environment is not supported, or you settled on a specific environment, switch out the adapter.
		// See https://kit.svelte.dev/docs/adapters for more information about adapters.
		adapter: adapter()
	}
};

export default config;

```


####### packages/create-svelte/shared/-typescript/svelte.config.js #######

```

import adapter from '@sveltejs/adapter-auto';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		// adapter-auto only supports some environments, see https://kit.svelte.dev/docs/adapter-auto for a list.
		// If your environment is not supported, or you settled on a specific environment, switch out the adapter.
		// See https://kit.svelte.dev/docs/adapters for more information about adapters.
		adapter: adapter()
	}
};

export default config;

```


####### packages/create-svelte/shared/+typescript/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"skipLibCheck": true,
		"sourceMap": true,
		"strict": true,
		"moduleResolution": "bundler"
	}
	// Path aliases are handled by https://kit.svelte.dev/docs/configuration#alias
	// except $lib which is handled by https://kit.svelte.dev/docs/configuration#files
	//
	// If you want to overwrite includes/excludes, make sure to copy over the relevant includes/excludes
	// from the referenced tsconfig.json - TypeScript does not merge them in
}

```


####### packages/create-svelte/shared/vite.config.ts #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import { defineConfig } from 'vite';

export default defineConfig({
	plugins: [sveltekit()]
});

```


####### packages/create-svelte/shared/+vitest/package.json #######

```

{
	"devDependencies": {
		"vitest": "^1.2.0"
	},
	"scripts": {
		"test": "vitest"
	}
}

```


####### packages/create-svelte/shared/+vitest+skeletonlib/src/index.test.ts #######

```

import { describe, it, expect } from 'vitest';

describe('sum test', () => {
	it('adds 1 + 2 to equal 3', () => {
		expect(1 + 2).toBe(3);
	});
});

```


####### packages/create-svelte/shared/+vitest+skeleton/src/index.test.ts #######

```

import { describe, it, expect } from 'vitest';

describe('sum test', () => {
	it('adds 1 + 2 to equal 3', () => {
		expect(1 + 2).toBe(3);
	});
});

```


####### packages/create-svelte/shared/+vitest/vite.config.ts #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import { defineConfig } from 'vitest/config';

export default defineConfig({
	plugins: [sveltekit()],
	test: {
		include: ['src/**/*.{test,spec}.{js,ts}']
	}
});

```


####### packages/create-svelte/templates/default/netlify.toml #######

```

[build]
  command = "npx pnpm install --store=node_modules/.pnpm-store && npx pnpm build -r"
  publish = "build"

[build.environment]
  NPM_FLAGS = "--version" # this prevents npm install from happening

[functions]
  node_bundler = "esbuild"
```


####### packages/create-svelte/templates/default/package.json #######

```

{
	"name": "default-template",
	"version": "0.0.2-next.0",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview"
	},
	"devDependencies": {
		"@neoconfetti/svelte": "^1.0.0",
		"@sveltejs/adapter-auto": "workspace:*",
		"@sveltejs/kit": "workspace:*",
		"@sveltejs/vite-plugin-svelte": "^3.0.0",
		"svelte": "^4.2.10",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module",
	"dependencies": {
		"@fontsource/fira-mono": "^5.0.8"
	}
}

```


####### packages/create-svelte/templates/default/package.template.json #######

```

{
	"name": "~TODO~",
	"version": "0.0.1",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview"
	},
	"devDependencies": {
		"@fontsource/fira-mono": "^4.5.10",
		"@neoconfetti/svelte": "^1.0.0",
		"@sveltejs/adapter-auto": "^3.0.0",
		"@sveltejs/kit": "^2.0.0",
		"@sveltejs/vite-plugin-svelte": "^3.0.0",
		"svelte": "^4.2.7",
		"vite": "^5.0.3"
	},
	"type": "module"
}

```


####### packages/create-svelte/templates/default/README.md #######

# Default SvelteKit template

This README isn't part of the template; it is ignored, and replaced with [the shared README](../../shared/README.md) when a project is created.

The default template is automatically deployed to Cloudflare Pages and Vercel on every commit. Commits to `main` will update production deployments:

- https://cloudflare.demo.svelte.dev
- https://kit-default-template-svelte.vercel.app/

## Cloudflare Pages settings

### Build command

```
npm i -g pnpm && pnpm i && pnpm build -r
```

### Build output directory

```
/packages/create-svelte/templates/default/.svelte-kit/cloudflare
```

### Environment variables

```
NPM_FLAGS=--version
```

## Netlify settings

Most settings are contained in [netlify.toml](netlify.toml).

### Build directory

```
packages/create-svelte/templates/default
```

## Vercel settings

### Install command

```
npm install -g pnpm && pnpm install && pnpm build -r
```

### Root directory

```
packages/create-svelte/templates/default
```

####### packages/create-svelte/templates/default/src/app.d.ts #######

```

// See https://kit.svelte.dev/docs/types#app
// for information about these interfaces
declare global {
	namespace App {
		// interface Error {}
		// interface Locals {}
		// interface PageData {}
		// interface PageState {}
		// interface Platform {}
	}
}

export {};

```


####### packages/create-svelte/templates/default/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>

```


####### packages/create-svelte/templates/default/src/routes/about/+page.svelte #######

```

<svelte:head>
	<title>About</title>
	<meta name="description" content="About this app" />
</svelte:head>

<div class="text-column">
	<h1>About this app</h1>

	<p>
		This is a <a href="https://kit.svelte.dev">SvelteKit</a> app. You can make your own by typing the
		following into your command line and following the prompts:
	</p>

	<pre>npm create svelte@latest</pre>

	<p>
		The page you're looking at is purely static HTML, with no client-side interactivity needed.
		Because of that, we don't need to load any JavaScript. Try viewing the page's source, or opening
		the devtools network panel and reloading.
	</p>

	<p>
		The <a href="/sverdle">Sverdle</a> page illustrates SvelteKit's data loading and form handling. Try
		using it with JavaScript disabled!
	</p>
</div>

```


####### packages/create-svelte/templates/default/src/routes/about/+page.ts #######

```

import { dev } from '$app/environment';

// we don't need any JS on this page, though we'll load
// it in dev so that we get hot module replacement
export const csr = dev;

// since there's no dynamic data here, we can prerender
// it so that it gets served as a static asset in production
export const prerender = true;

```


####### packages/create-svelte/templates/default/src/routes/Counter.svelte #######

```

<script lang="ts">
	import { spring } from 'svelte/motion';

	let count = 0;

	const displayed_count = spring();
	$: displayed_count.set(count);
	$: offset = modulo($displayed_count, 1);

	/**
	 * @param {number} n
	 * @param {number} m
	 */
	function modulo(n: number, m: number) {
		// handle negative numbers
		return ((n % m) + m) % m;
	}
</script>

<div class="counter">
	<button on:click={() => (count -= 1)} aria-label="Decrease the counter by one">
		<svg aria-hidden="true" viewBox="0 0 1 1">
			<path d="M0,0.5 L1,0.5" />
		</svg>
	</button>

	<div class="counter-viewport">
		<div class="counter-digits" style="transform: translate(0, {100 * offset}%)">
			<strong class="hidden" aria-hidden="true">{Math.floor($displayed_count + 1)}</strong>
			<strong>{Math.floor($displayed_count)}</strong>
		</div>
	</div>

	<button on:click={() => (count += 1)} aria-label="Increase the counter by one">
		<svg aria-hidden="true" viewBox="0 0 1 1">
			<path d="M0,0.5 L1,0.5 M0.5,0 L0.5,1" />
		</svg>
	</button>
</div>

<style>
	.counter {
		display: flex;
		border-top: 1px solid rgba(0, 0, 0, 0.1);
		border-bottom: 1px solid rgba(0, 0, 0, 0.1);
		margin: 1rem 0;
	}

	.counter button {
		width: 2em;
		padding: 0;
		display: flex;
		align-items: center;
		justify-content: center;
		border: 0;
		background-color: transparent;
		touch-action: manipulation;
		font-size: 2rem;
	}

	.counter button:hover {
		background-color: var(--color-bg-1);
	}

	svg {
		width: 25%;
		height: 25%;
	}

	path {
		vector-effect: non-scaling-stroke;
		stroke-width: 2px;
		stroke: #444;
	}

	.counter-viewport {
		width: 8em;
		height: 4em;
		overflow: hidden;
		text-align: center;
		position: relative;
	}

	.counter-viewport strong {
		position: absolute;
		display: flex;
		width: 100%;
		height: 100%;
		font-weight: 400;
		color: var(--color-theme-1);
		font-size: 4rem;
		align-items: center;
		justify-content: center;
	}

	.counter-digits {
		position: absolute;
		width: 100%;
		height: 100%;
	}

	.hidden {
		top: -100%;
		user-select: none;
	}
</style>

```


####### packages/create-svelte/templates/default/src/routes/Header.svelte #######

```

<script>
	import { page } from '$app/stores';
	import logo from '$lib/images/svelte-logo.svg';
	import github from '$lib/images/github.svg';
</script>

<header>
	<div class="corner">
		<a href="https://kit.svelte.dev">
			<img src={logo} alt="SvelteKit" />
		</a>
	</div>

	<nav>
		<svg viewBox="0 0 2 3" aria-hidden="true">
			<path d="M0,0 L1,2 C1.5,3 1.5,3 2,3 L2,0 Z" />
		</svg>
		<ul>
			<li aria-current={$page.url.pathname === '/' ? 'page' : undefined}>
				<a href="/">Home</a>
			</li>
			<li aria-current={$page.url.pathname === '/about' ? 'page' : undefined}>
				<a href="/about">About</a>
			</li>
			<li aria-current={$page.url.pathname.startsWith('/sverdle') ? 'page' : undefined}>
				<a href="/sverdle">Sverdle</a>
			</li>
		</ul>
		<svg viewBox="0 0 2 3" aria-hidden="true">
			<path d="M0,0 L0,3 C0.5,3 0.5,3 1,2 L2,0 Z" />
		</svg>
	</nav>

	<div class="corner">
		<a href="https://github.com/sveltejs/kit">
			<img src={github} alt="GitHub" />
		</a>
	</div>
</header>

<style>
	header {
		display: flex;
		justify-content: space-between;
	}

	.corner {
		width: 3em;
		height: 3em;
	}

	.corner a {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 100%;
		height: 100%;
	}

	.corner img {
		width: 2em;
		height: 2em;
		object-fit: contain;
	}

	nav {
		display: flex;
		justify-content: center;
		--background: rgba(255, 255, 255, 0.7);
	}

	svg {
		width: 2em;
		height: 3em;
		display: block;
	}

	path {
		fill: var(--background);
	}

	ul {
		position: relative;
		padding: 0;
		margin: 0;
		height: 3em;
		display: flex;
		justify-content: center;
		align-items: center;
		list-style: none;
		background: var(--background);
		background-size: contain;
	}

	li {
		position: relative;
		height: 100%;
	}

	li[aria-current='page']::before {
		--size: 6px;
		content: '';
		width: 0;
		height: 0;
		position: absolute;
		top: 0;
		left: calc(50% - var(--size));
		border: var(--size) solid transparent;
		border-top: var(--size) solid var(--color-theme-1);
	}

	nav a {
		display: flex;
		height: 100%;
		align-items: center;
		padding: 0 0.5rem;
		color: var(--color-text);
		font-weight: 700;
		font-size: 0.8rem;
		text-transform: uppercase;
		letter-spacing: 0.1em;
		text-decoration: none;
		transition: color 0.2s linear;
	}

	a:hover {
		color: var(--color-theme-1);
	}
</style>

```


####### packages/create-svelte/templates/default/src/routes/+layout.svelte #######

```

<script>
	import Header from './Header.svelte';
	import './styles.css';
</script>

<div class="app">
	<Header />

	<main>
		<slot />
	</main>

	<footer>
		<p>visit <a href="https://kit.svelte.dev">kit.svelte.dev</a> to learn SvelteKit</p>
	</footer>
</div>

<style>
	.app {
		display: flex;
		flex-direction: column;
		min-height: 100vh;
	}

	main {
		flex: 1;
		display: flex;
		flex-direction: column;
		padding: 1rem;
		width: 100%;
		max-width: 64rem;
		margin: 0 auto;
		box-sizing: border-box;
	}

	footer {
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		padding: 12px;
	}

	footer a {
		font-weight: bold;
	}

	@media (min-width: 480px) {
		footer {
			padding: 12px 0;
		}
	}
</style>

```


####### packages/create-svelte/templates/default/src/routes/+page.svelte #######

```

<script>
	import Counter from './Counter.svelte';
	import welcome from '$lib/images/svelte-welcome.webp';
	import welcome_fallback from '$lib/images/svelte-welcome.png';
</script>

<svelte:head>
	<title>Home</title>
	<meta name="description" content="Svelte demo app" />
</svelte:head>

<section>
	<h1>
		<span class="welcome">
			<picture>
				<source srcset={welcome} type="image/webp" />
				<img src={welcome_fallback} alt="Welcome" />
			</picture>
		</span>

		to your new<br />SvelteKit app
	</h1>

	<h2>
		try editing <strong>src/routes/+page.svelte</strong>
	</h2>

	<Counter />
</section>

<style>
	section {
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		flex: 0.6;
	}

	h1 {
		width: 100%;
	}

	.welcome {
		display: block;
		position: relative;
		width: 100%;
		height: 0;
		padding: 0 0 calc(100% * 495 / 2048) 0;
	}

	.welcome img {
		position: absolute;
		width: 100%;
		height: 100%;
		top: 0;
		display: block;
	}
</style>

```


####### packages/create-svelte/templates/default/src/routes/+page.ts #######

```

// since there's no dynamic data here, we can prerender
// it so that it gets served as a static asset in production
export const prerender = true;

```


####### packages/create-svelte/templates/default/src/routes/styles.css #######

```

@import '@fontsource/fira-mono';

:root {
	--font-body: Arial, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu,
		Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
	--font-mono: 'Fira Mono', monospace;
	--color-bg-0: rgb(202, 216, 228);
	--color-bg-1: hsl(209, 36%, 86%);
	--color-bg-2: hsl(224, 44%, 95%);
	--color-theme-1: #ff3e00;
	--color-theme-2: #4075a6;
	--color-text: rgba(0, 0, 0, 0.7);
	--column-width: 42rem;
	--column-margin-top: 4rem;
	font-family: var(--font-body);
	color: var(--color-text);
}

body {
	min-height: 100vh;
	margin: 0;
	background-attachment: fixed;
	background-color: var(--color-bg-1);
	background-size: 100vw 100vh;
	background-image: radial-gradient(
			50% 50% at 50% 50%,
			rgba(255, 255, 255, 0.75) 0%,
			rgba(255, 255, 255, 0) 100%
		),
		linear-gradient(180deg, var(--color-bg-0) 0%, var(--color-bg-1) 15%, var(--color-bg-2) 50%);
}

h1,
h2,
p {
	font-weight: 400;
}

p {
	line-height: 1.5;
}

a {
	color: var(--color-theme-1);
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

h1 {
	font-size: 2rem;
	text-align: center;
}

h2 {
	font-size: 1rem;
}

pre {
	font-size: 16px;
	font-family: var(--font-mono);
	background-color: rgba(255, 255, 255, 0.45);
	border-radius: 3px;
	box-shadow: 2px 2px 6px rgb(255 255 255 / 25%);
	padding: 0.5em;
	overflow-x: auto;
	color: var(--color-text);
}

.text-column {
	display: flex;
	max-width: 48rem;
	flex: 0.6;
	flex-direction: column;
	justify-content: center;
	margin: 0 auto;
}

input,
button {
	font-size: inherit;
	font-family: inherit;
}

button:focus:not(:focus-visible) {
	outline: none;
}

@media (min-width: 720px) {
	h1 {
		font-size: 2.4rem;
	}
}

.visually-hidden {
	border: 0;
	clip: rect(0 0 0 0);
	height: auto;
	margin: 0;
	overflow: hidden;
	padding: 0;
	position: absolute;
	width: 1px;
	white-space: nowrap;
}

```


####### packages/create-svelte/templates/default/src/routes/sverdle/game.ts #######

```

import { words, allowed } from './words.server';

export class Game {
	index: number;
	guesses: string[];
	answers: string[];
	answer: string;

	/**
	 * Create a game object from the player's cookie, or initialise a new game
	 * @param {string | undefined} serialized
	 */
	constructor(serialized: string | undefined = undefined) {
		if (serialized) {
			const [index, guesses, answers] = serialized.split('-');

			this.index = +index;
			this.guesses = guesses ? guesses.split(' ') : [];
			this.answers = answers ? answers.split(' ') : [];
		} else {
			this.index = Math.floor(Math.random() * words.length);
			this.guesses = ['', '', '', '', '', ''];
			this.answers = /** @type {string[]} */ [] /***/;
		}

		this.answer = words[this.index];
	}

	/**
	 * Update game state based on a guess of a five-letter word. Returns
	 * true if the guess was valid, false otherwise
	 * @param {string[]} letters
	 */
	enter(letters: string[]) {
		const word = letters.join('');
		const valid = allowed.has(word);

		if (!valid) return false;

		this.guesses[this.answers.length] = word;

		const available = Array.from(this.answer);
		const answer = Array(5).fill('_');

		// first, find exact matches
		for (let i = 0; i < 5; i += 1) {
			if (letters[i] === available[i]) {
				answer[i] = 'x';
				available[i] = ' ';
			}
		}

		// then find close matches (this has to happen
		// in a second step, otherwise an early close
		// match can prevent a later exact match)
		for (let i = 0; i < 5; i += 1) {
			if (answer[i] === '_') {
				const index = available.indexOf(letters[i]);
				if (index !== -1) {
					answer[i] = 'c';
					available[index] = ' ';
				}
			}
		}

		this.answers.push(answer.join(''));

		return true;
	}

	/**
	 * Serialize game state so it can be set as a cookie
	 */
	toString() {
		return `${this.index}-${this.guesses.join(' ')}-${this.answers.join(' ')}`;
	}
}

```


####### packages/create-svelte/templates/default/src/routes/sverdle/how-to-play/+page.svelte #######

```

<svelte:head>
	<title>How to play Sverdle</title>
	<meta name="description" content="How to play Sverdle" />
</svelte:head>

<div class="text-column">
	<h1>How to play Sverdle</h1>

	<p>
		Sverdle is a clone of <a href="https://www.nytimes.com/games/wordle/index.html">Wordle</a>, the
		word guessing game. To play, enter a five-letter English word. For example:
	</p>

	<div class="example">
		<span class="close">r</span>
		<span class="missing">i</span>
		<span class="close">t</span>
		<span class="missing">z</span>
		<span class="exact">y</span>
	</div>

	<p>
		The <span class="exact">y</span> is in the right place. <span class="close">r</span> and
		<span class="close">t</span>
		are the right letters, but in the wrong place. The other letters are wrong, and can be discarded.
		Let's make another guess:
	</p>

	<div class="example">
		<span class="exact">p</span>
		<span class="exact">a</span>
		<span class="exact">r</span>
		<span class="exact">t</span>
		<span class="exact">y</span>
	</div>

	<p>This time we guessed right! You have <strong>six</strong> guesses to get the word.</p>

	<p>
		Unlike the original Wordle, Sverdle runs on the server instead of in the browser, making it
		impossible to cheat. It uses <code>&lt;form&gt;</code> and cookies to submit data, meaning you can
		even play with JavaScript disabled!
	</p>
</div>

<style>
	span {
		display: inline-flex;
		justify-content: center;
		align-items: center;
		font-size: 0.8em;
		width: 2.4em;
		height: 2.4em;
		background-color: white;
		box-sizing: border-box;
		border-radius: 2px;
		border-width: 2px;
		color: rgba(0, 0, 0, 0.7);
	}

	.missing {
		background: rgba(255, 255, 255, 0.5);
		color: rgba(0, 0, 0, 0.5);
	}

	.close {
		border-style: solid;
		border-color: var(--color-theme-2);
	}

	.exact {
		background: var(--color-theme-2);
		color: white;
	}

	.example {
		display: flex;
		justify-content: flex-start;
		margin: 1rem 0;
		gap: 0.2rem;
	}

	.example span {
		font-size: 1.4rem;
	}

	p span {
		position: relative;
		border-width: 1px;
		border-radius: 1px;
		font-size: 0.4em;
		transform: scale(2) translate(0, -10%);
		margin: 0 1em;
	}
</style>

```


####### packages/create-svelte/templates/default/src/routes/sverdle/how-to-play/+page.ts #######

```

import { dev } from '$app/environment';

// we don't need any JS on this page, though we'll load
// it in dev so that we get hot module replacement
export const csr = dev;

// since there's no dynamic data here, we can prerender
// it so that it gets served as a static asset in production
export const prerender = true;

```


####### packages/create-svelte/templates/default/src/routes/sverdle/+page.server.ts #######

```

import { fail } from '@sveltejs/kit';
import { Game } from './game';
import type { PageServerLoad, Actions } from './$types';

/** @satisfies {import('./$types').PageServerLoad} */
export const load = (({ cookies }) => {
	const game = new Game(cookies.get('sverdle'));

	return {
		/**
		 * The player's guessed words so far
		 */
		guesses: game.guesses,

		/**
		 * An array of strings like '__x_c' corresponding to the guesses, where 'x' means
		 * an exact match, and 'c' means a close match (right letter, wrong place)
		 */
		answers: game.answers,

		/**
		 * The correct answer, revealed if the game is over
		 */
		answer: game.answers.length >= 6 ? game.answer : null
	};
}) satisfies PageServerLoad;

/** @satisfies {import('./$types').Actions} */
export const actions = {
	/**
	 * Modify game state in reaction to a keypress. If client-side JavaScript
	 * is available, this will happen in the browser instead of here
	 */
	update: async ({ request, cookies }) => {
		const game = new Game(cookies.get('sverdle'));

		const data = await request.formData();
		const key = data.get('key');

		const i = game.answers.length;

		if (key === 'backspace') {
			game.guesses[i] = game.guesses[i].slice(0, -1);
		} else {
			game.guesses[i] += key;
		}

		cookies.set('sverdle', game.toString(), { path: '/' });
	},

	/**
	 * Modify game state in reaction to a guessed word. This logic always runs on
	 * the server, so that people can't cheat by peeking at the JavaScript
	 */
	enter: async ({ request, cookies }) => {
		const game = new Game(cookies.get('sverdle'));

		const data = await request.formData();
		const guess = /** @type {string[]} */ data.getAll('guess') /***/ as string[];

		if (!game.enter(guess)) {
			return fail(400, { badGuess: true });
		}

		cookies.set('sverdle', game.toString(), { path: '/' });
	},

	restart: async ({ cookies }) => {
		cookies.delete('sverdle', { path: '/' });
	}
} satisfies Actions;

```


####### packages/create-svelte/templates/default/src/routes/sverdle/+page.svelte #######

```

<script lang="ts">
	import { confetti } from '@neoconfetti/svelte';
	import { enhance } from '$app/forms';
	import type { PageData, ActionData } from './$types';
	import { reduced_motion } from './reduced-motion';

	/** @type {import('./$types').PageData} */
	export let data: PageData;

	/** @type {import('./$types').ActionData} */
	export let form: ActionData;

	/** Whether or not the user has won */
	$: won = data.answers.at(-1) === 'xxxxx';

	/** The index of the current guess */
	$: i = won ? -1 : data.answers.length;

	/** The current guess */
	$: currentGuess = data.guesses[i] || '';

	/** Whether the current guess can be submitted */
	$: submittable = currentGuess.length === 5;

	/**
	 * A map of classnames for all letters that have been guessed,
	 * used for styling the keyboard
	 * @type {Record<string, 'exact' | 'close' | 'missing'>}
	 */
	let classnames: Record<string, 'exact' | 'close' | 'missing'>;

	/**
	 * A map of descriptions for all letters that have been guessed,
	 * used for adding text for assistive technology (e.g. screen readers)
	 * @type {Record<string, string>}
	 */
	let description: Record<string, string>;

	$: {
		classnames = {};
		description = {};

		data.answers.forEach((answer, i) => {
			const guess = data.guesses[i];

			for (let i = 0; i < 5; i += 1) {
				const letter = guess[i];

				if (answer[i] === 'x') {
					classnames[letter] = 'exact';
					description[letter] = 'correct';
				} else if (!classnames[letter]) {
					classnames[letter] = answer[i] === 'c' ? 'close' : 'missing';
					description[letter] = answer[i] === 'c' ? 'present' : 'absent';
				}
			}
		});
	}

	/**
	 * Modify the game state without making a trip to the server,
	 * if client-side JavaScript is enabled
	 * @param {MouseEvent} event
	 */
	function update(event: MouseEvent) {
		const key = /** @type {HTMLButtonElement} */ (event.target as HTMLButtonElement).getAttribute(
			'data-key'
		);

		if (key === 'backspace') {
			currentGuess = currentGuess.slice(0, -1);
			if (form?.badGuess) form.badGuess = false;
		} else if (currentGuess.length < 5) {
			currentGuess += key;
		}
	}

	/**
	 * Trigger form logic in response to a keydown event, so that
	 * desktop users can use the keyboard to play the game
	 * @param {KeyboardEvent} event
	 */
	function keydown(event: KeyboardEvent) {
		if (event.metaKey) return;

		if (event.key === 'Enter' && !submittable) return;

		document
			.querySelector(`[data-key="${event.key}" i]`)
			?.dispatchEvent(new MouseEvent('click', { cancelable: true }));
	}
</script>

<svelte:window on:keydown={keydown} />

<svelte:head>
	<title>Sverdle</title>
	<meta name="description" content="A Wordle clone written in SvelteKit" />
</svelte:head>

<h1 class="visually-hidden">Sverdle</h1>

<form
	method="POST"
	action="?/enter"
	use:enhance={() => {
		// prevent default callback from resetting the form
		return ({ update }) => {
			update({ reset: false });
		};
	}}
>
	<a class="how-to-play" href="/sverdle/how-to-play">How to play</a>

	<div class="grid" class:playing={!won} class:bad-guess={form?.badGuess}>
		{#each Array.from(Array(6).keys()) as row (row)}
			{@const current = row === i}
			<h2 class="visually-hidden">Row {row + 1}</h2>
			<div class="row" class:current>
				{#each Array.from(Array(5).keys()) as column (column)}
					{@const guess = current ? currentGuess : data.guesses[row]}
					{@const answer = data.answers[row]?.[column]}
					{@const value = guess?.[column] ?? ''}
					{@const selected = current && column === guess.length}
					{@const exact = answer === 'x'}
					{@const close = answer === 'c'}
					{@const missing = answer === '_'}
					<div class="letter" class:exact class:close class:missing class:selected>
						{value}
						<span class="visually-hidden">
							{#if exact}
								(correct)
							{:else if close}
								(present)
							{:else if missing}
								(absent)
							{:else}
								empty
							{/if}
						</span>
						<input name="guess" disabled={!current} type="hidden" {value} />
					</div>
				{/each}
			</div>
		{/each}
	</div>

	<div class="controls">
		{#if won || data.answers.length >= 6}
			{#if !won && data.answer}
				<p>the answer was "{data.answer}"</p>
			{/if}
			<button data-key="enter" class="restart selected" formaction="?/restart">
				{won ? 'you won :)' : `game over :(`} play again?
			</button>
		{:else}
			<div class="keyboard">
				<button data-key="enter" class:selected={submittable} disabled={!submittable}>enter</button>

				<button
					on:click|preventDefault={update}
					data-key="backspace"
					formaction="?/update"
					name="key"
					value="backspace"
				>
					back
				</button>

				{#each ['qwertyuiop', 'asdfghjkl', 'zxcvbnm'] as row}
					<div class="row">
						{#each row as letter}
							<button
								on:click|preventDefault={update}
								data-key={letter}
								class={classnames[letter]}
								disabled={submittable}
								formaction="?/update"
								name="key"
								value={letter}
								aria-label="{letter} {description[letter] || ''}"
							>
								{letter}
							</button>
						{/each}
					</div>
				{/each}
			</div>
		{/if}
	</div>
</form>

{#if won}
	<div
		style="position: absolute; left: 50%; top: 30%"
		use:confetti={{
			particleCount: $reduced_motion ? 0 : undefined,
			force: 0.7,
			stageWidth: window.innerWidth,
			stageHeight: window.innerHeight,
			colors: ['#ff3e00', '#40b3ff', '#676778']
		}}
	></div>
{/if}

<style>
	form {
		width: 100%;
		height: 100%;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		gap: 1rem;
		flex: 1;
	}

	.how-to-play {
		color: var(--color-text);
	}

	.how-to-play::before {
		content: 'i';
		display: inline-block;
		font-size: 0.8em;
		font-weight: 900;
		width: 1em;
		height: 1em;
		padding: 0.2em;
		line-height: 1;
		border: 1.5px solid var(--color-text);
		border-radius: 50%;
		text-align: center;
		margin: 0 0.5em 0 0;
		position: relative;
		top: -0.05em;
	}

	.grid {
		--width: min(100vw, 40vh, 380px);
		max-width: var(--width);
		align-self: center;
		justify-self: center;
		width: 100%;
		height: 100%;
		display: flex;
		flex-direction: column;
		justify-content: flex-start;
	}

	.grid .row {
		display: grid;
		grid-template-columns: repeat(5, 1fr);
		grid-gap: 0.2rem;
		margin: 0 0 0.2rem 0;
	}

	@media (prefers-reduced-motion: no-preference) {
		.grid.bad-guess .row.current {
			animation: wiggle 0.5s;
		}
	}

	.grid.playing .row.current {
		filter: drop-shadow(3px 3px 10px var(--color-bg-0));
	}

	.letter {
		aspect-ratio: 1;
		width: 100%;
		display: flex;
		align-items: center;
		justify-content: center;
		text-align: center;
		box-sizing: border-box;
		text-transform: lowercase;
		border: none;
		font-size: calc(0.08 * var(--width));
		border-radius: 2px;
		background: white;
		margin: 0;
		color: rgba(0, 0, 0, 0.7);
	}

	.letter.missing {
		background: rgba(255, 255, 255, 0.5);
		color: rgba(0, 0, 0, 0.5);
	}

	.letter.exact {
		background: var(--color-theme-2);
		color: white;
	}

	.letter.close {
		border: 2px solid var(--color-theme-2);
	}

	.selected {
		outline: 2px solid var(--color-theme-1);
	}

	.controls {
		text-align: center;
		justify-content: center;
		height: min(18vh, 10rem);
	}

	.keyboard {
		--gap: 0.2rem;
		position: relative;
		display: flex;
		flex-direction: column;
		gap: var(--gap);
		height: 100%;
	}

	.keyboard .row {
		display: flex;
		justify-content: center;
		gap: 0.2rem;
		flex: 1;
	}

	.keyboard button,
	.keyboard button:disabled {
		--size: min(8vw, 4vh, 40px);
		background-color: white;
		color: black;
		width: var(--size);
		border: none;
		border-radius: 2px;
		font-size: calc(var(--size) * 0.5);
		margin: 0;
	}

	.keyboard button.exact {
		background: var(--color-theme-2);
		color: white;
	}

	.keyboard button.missing {
		opacity: 0.5;
	}

	.keyboard button.close {
		border: 2px solid var(--color-theme-2);
	}

	.keyboard button:focus {
		background: var(--color-theme-1);
		color: white;
		outline: none;
	}

	.keyboard button[data-key='enter'],
	.keyboard button[data-key='backspace'] {
		position: absolute;
		bottom: 0;
		width: calc(1.5 * var(--size));
		height: calc(1 / 3 * (100% - 2 * var(--gap)));
		text-transform: uppercase;
		font-size: calc(0.3 * var(--size));
		padding-top: calc(0.15 * var(--size));
	}

	.keyboard button[data-key='enter'] {
		right: calc(50% + 3.5 * var(--size) + 0.8rem);
	}

	.keyboard button[data-key='backspace'] {
		left: calc(50% + 3.5 * var(--size) + 0.8rem);
	}

	.keyboard button[data-key='enter']:disabled {
		opacity: 0.5;
	}

	.restart {
		width: 100%;
		padding: 1rem;
		background: rgba(255, 255, 255, 0.5);
		border-radius: 2px;
		border: none;
	}

	.restart:focus,
	.restart:hover {
		background: var(--color-theme-1);
		color: white;
		outline: none;
	}

	@keyframes wiggle {
		0% {
			transform: translateX(0);
		}
		10% {
			transform: translateX(-2px);
		}
		30% {
			transform: translateX(4px);
		}
		50% {
			transform: translateX(-6px);
		}
		70% {
			transform: translateX(+4px);
		}
		90% {
			transform: translateX(-2px);
		}
		100% {
			transform: translateX(0);
		}
	}
</style>

```


####### packages/create-svelte/templates/default/src/routes/sverdle/reduced-motion.ts #######

```

import { readable } from 'svelte/store';
import { browser } from '$app/environment';

const reduced_motion_query = '(prefers-reduced-motion: reduce)';

const get_initial_motion_preference = () => {
	if (!browser) return false;
	return window.matchMedia(reduced_motion_query).matches;
};

export const reduced_motion = readable(get_initial_motion_preference(), (set) => {
	if (browser) {
		/**
		 * @param {MediaQueryListEvent} event
		 */
		const set_reduced_motion = (event: MediaQueryListEvent) => {
			set(event.matches);
		};
		const media_query_list = window.matchMedia(reduced_motion_query);
		media_query_list.addEventListener('change', set_reduced_motion);

		return () => {
			media_query_list.removeEventListener('change', set_reduced_motion);
		};
	}
});

```


####### packages/create-svelte/templates/default/src/routes/sverdle/words.server.ts #######

```

/** The list of possible words */
export const words = [
	'aback',
	'abase',
	'abate',
	'abbey',
	'abbot',
	'abhor',
	'abide',
	'abled',
	'abode',
	'abort',
	'about',
	'above',
	'abuse',
	'abyss',
	'acorn',
	'acrid',
	'actor',
	'acute',
	'adage',
	'adapt',
	'adept',
	'admin',
	'admit',
	'adobe',
	'adopt',
	'adore',
	'adorn',
	'adult',
	'affix',
	'afire',
	'afoot',
	'afoul',
	'after',
	'again',
	'agape',
	'agate',
	'agent',
	'agile',
	'aging',
	'aglow',
	'agony',
	'agora',
	'agree',
	'ahead',
	'aider',
	'aisle',
	'alarm',
	'album',
	'alert',
	'algae',
	'alibi',
	'alien',
	'align',
	'alike',
	'alive',
	'allay',
	'alley',
	'allot',
	'allow',
	'alloy',
	'aloft',
	'alone',
	'along',
	'aloof',
	'aloud',
	'alpha',
	'altar',
	'alter',
	'amass',
	'amaze',
	'amber',
	'amble',
	'amend',
	'amiss',
	'amity',
	'among',
	'ample',
	'amply',
	'amuse',
	'angel',
	'anger',
	'angle',
	'angry',
	'angst',
	'anime',
	'ankle',
	'annex',
	'annoy',
	'annul',
	'anode',
	'antic',
	'anvil',
	'aorta',
	'apart',
	'aphid',
	'aping',
	'apnea',
	'apple',
	'apply',
	'apron',
	'aptly',
	'arbor',
	'ardor',
	'arena',
	'argue',
	'arise',
	'armor',
	'aroma',
	'arose',
	'array',
	'arrow',
	'arson',
	'artsy',
	'ascot',
	'ashen',
	'aside',
	'askew',
	'assay',
	'asset',
	'atoll',
	'atone',
	'attic',
	'audio',
	'audit',
	'augur',
	'aunty',
	'avail',
	'avert',
	'avian',
	'avoid',
	'await',
	'awake',
	'award',
	'aware',
	'awash',
	'awful',
	'awoke',
	'axial',
	'axiom',
	'axion',
	'azure',
	'bacon',
	'badge',
	'badly',
	'bagel',
	'baggy',
	'baker',
	'baler',
	'balmy',
	'banal',
	'banjo',
	'barge',
	'baron',
	'basal',
	'basic',
	'basil',
	'basin',
	'basis',
	'baste',
	'batch',
	'bathe',
	'baton',
	'batty',
	'bawdy',
	'bayou',
	'beach',
	'beady',
	'beard',
	'beast',
	'beech',
	'beefy',
	'befit',
	'began',
	'begat',
	'beget',
	'begin',
	'begun',
	'being',
	'belch',
	'belie',
	'belle',
	'belly',
	'below',
	'bench',
	'beret',
	'berry',
	'berth',
	'beset',
	'betel',
	'bevel',
	'bezel',
	'bible',
	'bicep',
	'biddy',
	'bigot',
	'bilge',
	'billy',
	'binge',
	'bingo',
	'biome',
	'birch',
	'birth',
	'bison',
	'bitty',
	'black',
	'blade',
	'blame',
	'bland',
	'blank',
	'blare',
	'blast',
	'blaze',
	'bleak',
	'bleat',
	'bleed',
	'bleep',
	'blend',
	'bless',
	'blimp',
	'blind',
	'blink',
	'bliss',
	'blitz',
	'bloat',
	'block',
	'bloke',
	'blond',
	'blood',
	'bloom',
	'blown',
	'bluer',
	'bluff',
	'blunt',
	'blurb',
	'blurt',
	'blush',
	'board',
	'boast',
	'bobby',
	'boney',
	'bongo',
	'bonus',
	'booby',
	'boost',
	'booth',
	'booty',
	'booze',
	'boozy',
	'borax',
	'borne',
	'bosom',
	'bossy',
	'botch',
	'bough',
	'boule',
	'bound',
	'bowel',
	'boxer',
	'brace',
	'braid',
	'brain',
	'brake',
	'brand',
	'brash',
	'brass',
	'brave',
	'bravo',
	'brawl',
	'brawn',
	'bread',
	'break',
	'breed',
	'briar',
	'bribe',
	'brick',
	'bride',
	'brief',
	'brine',
	'bring',
	'brink',
	'briny',
	'brisk',
	'broad',
	'broil',
	'broke',
	'brood',
	'brook',
	'broom',
	'broth',
	'brown',
	'brunt',
	'brush',
	'brute',
	'buddy',
	'budge',
	'buggy',
	'bugle',
	'build',
	'built',
	'bulge',
	'bulky',
	'bully',
	'bunch',
	'bunny',
	'burly',
	'burnt',
	'burst',
	'bused',
	'bushy',
	'butch',
	'butte',
	'buxom',
	'buyer',
	'bylaw',
	'cabal',
	'cabby',
	'cabin',
	'cable',
	'cacao',
	'cache',
	'cacti',
	'caddy',
	'cadet',
	'cagey',
	'cairn',
	'camel',
	'cameo',
	'canal',
	'candy',
	'canny',
	'canoe',
	'canon',
	'caper',
	'caput',
	'carat',
	'cargo',
	'carol',
	'carry',
	'carve',
	'caste',
	'catch',
	'cater',
	'catty',
	'caulk',
	'cause',
	'cavil',
	'cease',
	'cedar',
	'cello',
	'chafe',
	'chaff',
	'chain',
	'chair',
	'chalk',
	'champ',
	'chant',
	'chaos',
	'chard',
	'charm',
	'chart',
	'chase',
	'chasm',
	'cheap',
	'cheat',
	'check',
	'cheek',
	'cheer',
	'chess',
	'chest',
	'chick',
	'chide',
	'chief',
	'child',
	'chili',
	'chill',
	'chime',
	'china',
	'chirp',
	'chock',
	'choir',
	'choke',
	'chord',
	'chore',
	'chose',
	'chuck',
	'chump',
	'chunk',
	'churn',
	'chute',
	'cider',
	'cigar',
	'cinch',
	'circa',
	'civic',
	'civil',
	'clack',
	'claim',
	'clamp',
	'clang',
	'clank',
	'clash',
	'clasp',
	'class',
	'clean',
	'clear',
	'cleat',
	'cleft',
	'clerk',
	'click',
	'cliff',
	'climb',
	'cling',
	'clink',
	'cloak',
	'clock',
	'clone',
	'close',
	'cloth',
	'cloud',
	'clout',
	'clove',
	'clown',
	'cluck',
	'clued',
	'clump',
	'clung',
	'coach',
	'coast',
	'cobra',
	'cocoa',
	'colon',
	'color',
	'comet',
	'comfy',
	'comic',
	'comma',
	'conch',
	'condo',
	'conic',
	'copse',
	'coral',
	'corer',
	'corny',
	'couch',
	'cough',
	'could',
	'count',
	'coupe',
	'court',
	'coven',
	'cover',
	'covet',
	'covey',
	'cower',
	'coyly',
	'crack',
	'craft',
	'cramp',
	'crane',
	'crank',
	'crash',
	'crass',
	'crate',
	'crave',
	'crawl',
	'craze',
	'crazy',
	'creak',
	'cream',
	'credo',
	'creed',
	'creek',
	'creep',
	'creme',
	'crepe',
	'crept',
	'cress',
	'crest',
	'crick',
	'cried',
	'crier',
	'crime',
	'crimp',
	'crisp',
	'croak',
	'crock',
	'crone',
	'crony',
	'crook',
	'cross',
	'croup',
	'crowd',
	'crown',
	'crude',
	'cruel',
	'crumb',
	'crump',
	'crush',
	'crust',
	'crypt',
	'cubic',
	'cumin',
	'curio',
	'curly',
	'curry',
	'curse',
	'curve',
	'curvy',
	'cutie',
	'cyber',
	'cycle',
	'cynic',
	'daddy',
	'daily',
	'dairy',
	'daisy',
	'dally',
	'dance',
	'dandy',
	'datum',
	'daunt',
	'dealt',
	'death',
	'debar',
	'debit',
	'debug',
	'debut',
	'decal',
	'decay',
	'decor',
	'decoy',
	'decry',
	'defer',
	'deign',
	'deity',
	'delay',
	'delta',
	'delve',
	'demon',
	'demur',
	'denim',
	'dense',
	'depot',
	'depth',
	'derby',
	'deter',
	'detox',
	'deuce',
	'devil',
	'diary',
	'dicey',
	'digit',
	'dilly',
	'dimly',
	'diner',
	'dingo',
	'dingy',
	'diode',
	'dirge',
	'dirty',
	'disco',
	'ditch',
	'ditto',
	'ditty',
	'diver',
	'dizzy',
	'dodge',
	'dodgy',
	'dogma',
	'doing',
	'dolly',
	'donor',
	'donut',
	'dopey',
	'doubt',
	'dough',
	'dowdy',
	'dowel',
	'downy',
	'dowry',
	'dozen',
	'draft',
	'drain',
	'drake',
	'drama',
	'drank',
	'drape',
	'drawl',
	'drawn',
	'dread',
	'dream',
	'dress',
	'dried',
	'drier',
	'drift',
	'drill',
	'drink',
	'drive',
	'droit',
	'droll',
	'drone',
	'drool',
	'droop',
	'dross',
	'drove',
	'drown',
	'druid',
	'drunk',
	'dryer',
	'dryly',
	'duchy',
	'dully',
	'dummy',
	'dumpy',
	'dunce',
	'dusky',
	'dusty',
	'dutch',
	'duvet',
	'dwarf',
	'dwell',
	'dwelt',
	'dying',
	'eager',
	'eagle',
	'early',
	'earth',
	'easel',
	'eaten',
	'eater',
	'ebony',
	'eclat',
	'edict',
	'edify',
	'eerie',
	'egret',
	'eight',
	'eject',
	'eking',
	'elate',
	'elbow',
	'elder',
	'elect',
	'elegy',
	'elfin',
	'elide',
	'elite',
	'elope',
	'elude',
	'email',
	'embed',
	'ember',
	'emcee',
	'empty',
	'enact',
	'endow',
	'enema',
	'enemy',
	'enjoy',
	'ennui',
	'ensue',
	'enter',
	'entry',
	'envoy',
	'epoch',
	'epoxy',
	'equal',
	'equip',
	'erase',
	'erect',
	'erode',
	'error',
	'erupt',
	'essay',
	'ester',
	'ether',
	'ethic',
	'ethos',
	'etude',
	'evade',
	'event',
	'every',
	'evict',
	'evoke',
	'exact',
	'exalt',
	'excel',
	'exert',
	'exile',
	'exist',
	'expel',
	'extol',
	'extra',
	'exult',
	'eying',
	'fable',
	'facet',
	'faint',
	'fairy',
	'faith',
	'false',
	'fancy',
	'fanny',
	'farce',
	'fatal',
	'fatty',
	'fault',
	'fauna',
	'favor',
	'feast',
	'fecal',
	'feign',
	'fella',
	'felon',
	'femme',
	'femur',
	'fence',
	'feral',
	'ferry',
	'fetal',
	'fetch',
	'fetid',
	'fetus',
	'fever',
	'fewer',
	'fiber',
	'fibre',
	'ficus',
	'field',
	'fiend',
	'fiery',
	'fifth',
	'fifty',
	'fight',
	'filer',
	'filet',
	'filly',
	'filmy',
	'filth',
	'final',
	'finch',
	'finer',
	'first',
	'fishy',
	'fixer',
	'fizzy',
	'fjord',
	'flack',
	'flail',
	'flair',
	'flake',
	'flaky',
	'flame',
	'flank',
	'flare',
	'flash',
	'flask',
	'fleck',
	'fleet',
	'flesh',
	'flick',
	'flier',
	'fling',
	'flint',
	'flirt',
	'float',
	'flock',
	'flood',
	'floor',
	'flora',
	'floss',
	'flour',
	'flout',
	'flown',
	'fluff',
	'fluid',
	'fluke',
	'flume',
	'flung',
	'flunk',
	'flush',
	'flute',
	'flyer',
	'foamy',
	'focal',
	'focus',
	'foggy',
	'foist',
	'folio',
	'folly',
	'foray',
	'force',
	'forge',
	'forgo',
	'forte',
	'forth',
	'forty',
	'forum',
	'found',
	'foyer',
	'frail',
	'frame',
	'frank',
	'fraud',
	'freak',
	'freed',
	'freer',
	'fresh',
	'friar',
	'fried',
	'frill',
	'frisk',
	'fritz',
	'frock',
	'frond',
	'front',
	'frost',
	'froth',
	'frown',
	'froze',
	'fruit',
	'fudge',
	'fugue',
	'fully',
	'fungi',
	'funky',
	'funny',
	'furor',
	'furry',
	'fussy',
	'fuzzy',
	'gaffe',
	'gaily',
	'gamer',
	'gamma',
	'gamut',
	'gassy',
	'gaudy',
	'gauge',
	'gaunt',
	'gauze',
	'gavel',
	'gawky',
	'gayer',
	'gayly',
	'gazer',
	'gecko',
	'geeky',
	'geese',
	'genie',
	'genre',
	'ghost',
	'ghoul',
	'giant',
	'giddy',
	'gipsy',
	'girly',
	'girth',
	'given',
	'giver',
	'glade',
	'gland',
	'glare',
	'glass',
	'glaze',
	'gleam',
	'glean',
	'glide',
	'glint',
	'gloat',
	'globe',
	'gloom',
	'glory',
	'gloss',
	'glove',
	'glyph',
	'gnash',
	'gnome',
	'godly',
	'going',
	'golem',
	'golly',
	'gonad',
	'goner',
	'goody',
	'gooey',
	'goofy',
	'goose',
	'gorge',
	'gouge',
	'gourd',
	'grace',
	'grade',
	'graft',
	'grail',
	'grain',
	'grand',
	'grant',
	'grape',
	'graph',
	'grasp',
	'grass',
	'grate',
	'grave',
	'gravy',
	'graze',
	'great',
	'greed',
	'green',
	'greet',
	'grief',
	'grill',
	'grime',
	'grimy',
	'grind',
	'gripe',
	'groan',
	'groin',
	'groom',
	'grope',
	'gross',
	'group',
	'grout',
	'grove',
	'growl',
	'grown',
	'gruel',
	'gruff',
	'grunt',
	'guard',
	'guava',
	'guess',
	'guest',
	'guide',
	'guild',
	'guile',
	'guilt',
	'guise',
	'gulch',
	'gully',
	'gumbo',
	'gummy',
	'guppy',
	'gusto',
	'gusty',
	'gypsy',
	'habit',
	'hairy',
	'halve',
	'handy',
	'happy',
	'hardy',
	'harem',
	'harpy',
	'harry',
	'harsh',
	'haste',
	'hasty',
	'hatch',
	'hater',
	'haunt',
	'haute',
	'haven',
	'havoc',
	'hazel',
	'heady',
	'heard',
	'heart',
	'heath',
	'heave',
	'heavy',
	'hedge',
	'hefty',
	'heist',
	'helix',
	'hello',
	'hence',
	'heron',
	'hilly',
	'hinge',
	'hippo',
	'hippy',
	'hitch',
	'hoard',
	'hobby',
	'hoist',
	'holly',
	'homer',
	'honey',
	'honor',
	'horde',
	'horny',
	'horse',
	'hotel',
	'hotly',
	'hound',
	'house',
	'hovel',
	'hover',
	'howdy',
	'human',
	'humid',
	'humor',
	'humph',
	'humus',
	'hunch',
	'hunky',
	'hurry',
	'husky',
	'hussy',
	'hutch',
	'hydro',
	'hyena',
	'hymen',
	'hyper',
	'icily',
	'icing',
	'ideal',
	'idiom',
	'idiot',
	'idler',
	'idyll',
	'igloo',
	'iliac',
	'image',
	'imbue',
	'impel',
	'imply',
	'inane',
	'inbox',
	'incur',
	'index',
	'inept',
	'inert',
	'infer',
	'ingot',
	'inlay',
	'inlet',
	'inner',
	'input',
	'inter',
	'intro',
	'ionic',
	'irate',
	'irony',
	'islet',
	'issue',
	'itchy',
	'ivory',
	'jaunt',
	'jazzy',
	'jelly',
	'jerky',
	'jetty',
	'jewel',
	'jiffy',
	'joint',
	'joist',
	'joker',
	'jolly',
	'joust',
	'judge',
	'juice',
	'juicy',
	'jumbo',
	'jumpy',
	'junta',
	'junto',
	'juror',
	'kappa',
	'karma',
	'kayak',
	'kebab',
	'khaki',
	'kinky',
	'kiosk',
	'kitty',
	'knack',
	'knave',
	'knead',
	'kneed',
	'kneel',
	'knelt',
	'knife',
	'knock',
	'knoll',
	'known',
	'koala',
	'krill',
	'label',
	'labor',
	'laden',
	'ladle',
	'lager',
	'lance',
	'lanky',
	'lapel',
	'lapse',
	'large',
	'larva',
	'lasso',
	'latch',
	'later',
	'lathe',
	'latte',
	'laugh',
	'layer',
	'leach',
	'leafy',
	'leaky',
	'leant',
	'leapt',
	'learn',
	'lease',
	'leash',
	'least',
	'leave',
	'ledge',
	'leech',
	'leery',
	'lefty',
	'legal',
	'leggy',
	'lemon',
	'lemur',
	'leper',
	'level',
	'lever',
	'libel',
	'liege',
	'light',
	'liken',
	'lilac',
	'limbo',
	'limit',
	'linen',
	'liner',
	'lingo',
	'lipid',
	'lithe',
	'liver',
	'livid',
	'llama',
	'loamy',
	'loath',
	'lobby',
	'local',
	'locus',
	'lodge',
	'lofty',
	'logic',
	'login',
	'loopy',
	'loose',
	'lorry',
	'loser',
	'louse',
	'lousy',
	'lover',
	'lower',
	'lowly',
	'loyal',
	'lucid',
	'lucky',
	'lumen',
	'lumpy',
	'lunar',
	'lunch',
	'lunge',
	'lupus',
	'lurch',
	'lurid',
	'lusty',
	'lying',
	'lymph',
	'lynch',
	'lyric',
	'macaw',
	'macho',
	'macro',
	'madam',
	'madly',
	'mafia',
	'magic',
	'magma',
	'maize',
	'major',
	'maker',
	'mambo',
	'mamma',
	'mammy',
	'manga',
	'mange',
	'mango',
	'mangy',
	'mania',
	'manic',
	'manly',
	'manor',
	'maple',
	'march',
	'marry',
	'marsh',
	'mason',
	'masse',
	'match',
	'matey',
	'mauve',
	'maxim',
	'maybe',
	'mayor',
	'mealy',
	'meant',
	'meaty',
	'mecca',
	'medal',
	'media',
	'medic',
	'melee',
	'melon',
	'mercy',
	'merge',
	'merit',
	'merry',
	'metal',
	'meter',
	'metro',
	'micro',
	'midge',
	'midst',
	'might',
	'milky',
	'mimic',
	'mince',
	'miner',
	'minim',
	'minor',
	'minty',
	'minus',
	'mirth',
	'miser',
	'missy',
	'mocha',
	'modal',
	'model',
	'modem',
	'mogul',
	'moist',
	'molar',
	'moldy',
	'money',
	'month',
	'moody',
	'moose',
	'moral',
	'moron',
	'morph',
	'mossy',
	'motel',
	'motif',
	'motor',
	'motto',
	'moult',
	'mound',
	'mount',
	'mourn',
	'mouse',
	'mouth',
	'mover',
	'movie',
	'mower',
	'mucky',
	'mucus',
	'muddy',
	'mulch',
	'mummy',
	'munch',
	'mural',
	'murky',
	'mushy',
	'music',
	'musky',
	'musty',
	'myrrh',
	'nadir',
	'naive',
	'nanny',
	'nasal',
	'nasty',
	'natal',
	'naval',
	'navel',
	'needy',
	'neigh',
	'nerdy',
	'nerve',
	'never',
	'newer',
	'newly',
	'nicer',
	'niche',
	'niece',
	'night',
	'ninja',
	'ninny',
	'ninth',
	'noble',
	'nobly',
	'noise',
	'noisy',
	'nomad',
	'noose',
	'north',
	'nosey',
	'notch',
	'novel',
	'nudge',
	'nurse',
	'nutty',
	'nylon',
	'nymph',
	'oaken',
	'obese',
	'occur',
	'ocean',
	'octal',
	'octet',
	'odder',
	'oddly',
	'offal',
	'offer',
	'often',
	'olden',
	'older',
	'olive',
	'ombre',
	'omega',
	'onion',
	'onset',
	'opera',
	'opine',
	'opium',
	'optic',
	'orbit',
	'order',
	'organ',
	'other',
	'otter',
	'ought',
	'ounce',
	'outdo',
	'outer',
	'outgo',
	'ovary',
	'ovate',
	'overt',
	'ovine',
	'ovoid',
	'owing',
	'owner',
	'oxide',
	'ozone',
	'paddy',
	'pagan',
	'paint',
	'paler',
	'palsy',
	'panel',
	'panic',
	'pansy',
	'papal',
	'paper',
	'parer',
	'parka',
	'parry',
	'parse',
	'party',
	'pasta',
	'paste',
	'pasty',
	'patch',
	'patio',
	'patsy',
	'patty',
	'pause',
	'payee',
	'payer',
	'peace',
	'peach',
	'pearl',
	'pecan',
	'pedal',
	'penal',
	'pence',
	'penne',
	'penny',
	'perch',
	'peril',
	'perky',
	'pesky',
	'pesto',
	'petal',
	'petty',
	'phase',
	'phone',
	'phony',
	'photo',
	'piano',
	'picky',
	'piece',
	'piety',
	'piggy',
	'pilot',
	'pinch',
	'piney',
	'pinky',
	'pinto',
	'piper',
	'pique',
	'pitch',
	'pithy',
	'pivot',
	'pixel',
	'pixie',
	'pizza',
	'place',
	'plaid',
	'plain',
	'plait',
	'plane',
	'plank',
	'plant',
	'plate',
	'plaza',
	'plead',
	'pleat',
	'plied',
	'plier',
	'pluck',
	'plumb',
	'plume',
	'plump',
	'plunk',
	'plush',
	'poesy',
	'point',
	'poise',
	'poker',
	'polar',
	'polka',
	'polyp',
	'pooch',
	'poppy',
	'porch',
	'poser',
	'posit',
	'posse',
	'pouch',
	'pound',
	'pouty',
	'power',
	'prank',
	'prawn',
	'preen',
	'press',
	'price',
	'prick',
	'pride',
	'pried',
	'prime',
	'primo',
	'print',
	'prior',
	'prism',
	'privy',
	'prize',
	'probe',
	'prone',
	'prong',
	'proof',
	'prose',
	'proud',
	'prove',
	'prowl',
	'proxy',
	'prude',
	'prune',
	'psalm',
	'pubic',
	'pudgy',
	'puffy',
	'pulpy',
	'pulse',
	'punch',
	'pupal',
	'pupil',
	'puppy',
	'puree',
	'purer',
	'purge',
	'purse',
	'pushy',
	'putty',
	'pygmy',
	'quack',
	'quail',
	'quake',
	'qualm',
	'quark',
	'quart',
	'quash',
	'quasi',
	'queen',
	'queer',
	'quell',
	'query',
	'quest',
	'queue',
	'quick',
	'quiet',
	'quill',
	'quilt',
	'quirk',
	'quite',
	'quota',
	'quote',
	'quoth',
	'rabbi',
	'rabid',
	'racer',
	'radar',
	'radii',
	'radio',
	'rainy',
	'raise',
	'rajah',
	'rally',
	'ralph',
	'ramen',
	'ranch',
	'randy',
	'range',
	'rapid',
	'rarer',
	'raspy',
	'ratio',
	'ratty',
	'raven',
	'rayon',
	'razor',
	'reach',
	'react',
	'ready',
	'realm',
	'rearm',
	'rebar',
	'rebel',
	'rebus',
	'rebut',
	'recap',
	'recur',
	'recut',
	'reedy',
	'refer',
	'refit',
	'regal',
	'rehab',
	'reign',
	'relax',
	'relay',
	'relic',
	'remit',
	'renal',
	'renew',
	'repay',
	'repel',
	'reply',
	'rerun',
	'reset',
	'resin',
	'retch',
	'retro',
	'retry',
	'reuse',
	'revel',
	'revue',
	'rhino',
	'rhyme',
	'rider',
	'ridge',
	'rifle',
	'right',
	'rigid',
	'rigor',
	'rinse',
	'ripen',
	'riper',
	'risen',
	'riser',
	'risky',
	'rival',
	'river',
	'rivet',
	'roach',
	'roast',
	'robin',
	'robot',
	'rocky',
	'rodeo',
	'roger',
	'rogue',
	'roomy',
	'roost',
	'rotor',
	'rouge',
	'rough',
	'round',
	'rouse',
	'route',
	'rover',
	'rowdy',
	'rower',
	'royal',
	'ruddy',
	'ruder',
	'rugby',
	'ruler',
	'rumba',
	'rumor',
	'rupee',
	'rural',
	'rusty',
	'sadly',
	'safer',
	'saint',
	'salad',
	'sally',
	'salon',
	'salsa',
	'salty',
	'salve',
	'salvo',
	'sandy',
	'saner',
	'sappy',
	'sassy',
	'satin',
	'satyr',
	'sauce',
	'saucy',
	'sauna',
	'saute',
	'savor',
	'savoy',
	'savvy',
	'scald',
	'scale',
	'scalp',
	'scaly',
	'scamp',
	'scant',
	'scare',
	'scarf',
	'scary',
	'scene',
	'scent',
	'scion',
	'scoff',
	'scold',
	'scone',
	'scoop',
	'scope',
	'score',
	'scorn',
	'scour',
	'scout',
	'scowl',
	'scram',
	'scrap',
	'scree',
	'screw',
	'scrub',
	'scrum',
	'scuba',
	'sedan',
	'seedy',
	'segue',
	'seize',
	'semen',
	'sense',
	'sepia',
	'serif',
	'serum',
	'serve',
	'setup',
	'seven',
	'sever',
	'sewer',
	'shack',
	'shade',
	'shady',
	'shaft',
	'shake',
	'shaky',
	'shale',
	'shall',
	'shalt',
	'shame',
	'shank',
	'shape',
	'shard',
	'share',
	'shark',
	'sharp',
	'shave',
	'shawl',
	'shear',
	'sheen',
	'sheep',
	'sheer',
	'sheet',
	'sheik',
	'shelf',
	'shell',
	'shied',
	'shift',
	'shine',
	'shiny',
	'shire',
	'shirk',
	'shirt',
	'shoal',
	'shock',
	'shone',
	'shook',
	'shoot',
	'shore',
	'shorn',
	'short',
	'shout',
	'shove',
	'shown',
	'showy',
	'shrew',
	'shrub',
	'shrug',
	'shuck',
	'shunt',
	'shush',
	'shyly',
	'siege',
	'sieve',
	'sight',
	'sigma',
	'silky',
	'silly',
	'since',
	'sinew',
	'singe',
	'siren',
	'sissy',
	'sixth',
	'sixty',
	'skate',
	'skier',
	'skiff',
	'skill',
	'skimp',
	'skirt',
	'skulk',
	'skull',
	'skunk',
	'slack',
	'slain',
	'slang',
	'slant',
	'slash',
	'slate',
	'slave',
	'sleek',
	'sleep',
	'sleet',
	'slept',
	'slice',
	'slick',
	'slide',
	'slime',
	'slimy',
	'sling',
	'slink',
	'sloop',
	'slope',
	'slosh',
	'sloth',
	'slump',
	'slung',
	'slunk',
	'slurp',
	'slush',
	'slyly',
	'smack',
	'small',
	'smart',
	'smash',
	'smear',
	'smell',
	'smelt',
	'smile',
	'smirk',
	'smite',
	'smith',
	'smock',
	'smoke',
	'smoky',
	'smote',
	'snack',
	'snail',
	'snake',
	'snaky',
	'snare',
	'snarl',
	'sneak',
	'sneer',
	'snide',
	'sniff',
	'snipe',
	'snoop',
	'snore',
	'snort',
	'snout',
	'snowy',
	'snuck',
	'snuff',
	'soapy',
	'sober',
	'soggy',
	'solar',
	'solid',
	'solve',
	'sonar',
	'sonic',
	'sooth',
	'sooty',
	'sorry',
	'sound',
	'south',
	'sower',
	'space',
	'spade',
	'spank',
	'spare',
	'spark',
	'spasm',
	'spawn',
	'speak',
	'spear',
	'speck',
	'speed',
	'spell',
	'spelt',
	'spend',
	'spent',
	'sperm',
	'spice',
	'spicy',
	'spied',
	'spiel',
	'spike',
	'spiky',
	'spill',
	'spilt',
	'spine',
	'spiny',
	'spire',
	'spite',
	'splat',
	'split',
	'spoil',
	'spoke',
	'spoof',
	'spook',
	'spool',
	'spoon',
	'spore',
	'sport',
	'spout',
	'spray',
	'spree',
	'sprig',
	'spunk',
	'spurn',
	'spurt',
	'squad',
	'squat',
	'squib',
	'stack',
	'staff',
	'stage',
	'staid',
	'stain',
	'stair',
	'stake',
	'stale',
	'stalk',
	'stall',
	'stamp',
	'stand',
	'stank',
	'stare',
	'stark',
	'start',
	'stash',
	'state',
	'stave',
	'stead',
	'steak',
	'steal',
	'steam',
	'steed',
	'steel',
	'steep',
	'steer',
	'stein',
	'stern',
	'stick',
	'stiff',
	'still',
	'stilt',
	'sting',
	'stink',
	'stint',
	'stock',
	'stoic',
	'stoke',
	'stole',
	'stomp',
	'stone',
	'stony',
	'stood',
	'stool',
	'stoop',
	'store',
	'stork',
	'storm',
	'story',
	'stout',
	'stove',
	'strap',
	'straw',
	'stray',
	'strip',
	'strut',
	'stuck',
	'study',
	'stuff',
	'stump',
	'stung',
	'stunk',
	'stunt',
	'style',
	'suave',
	'sugar',
	'suing',
	'suite',
	'sulky',
	'sully',
	'sumac',
	'sunny',
	'super',
	'surer',
	'surge',
	'surly',
	'sushi',
	'swami',
	'swamp',
	'swarm',
	'swash',
	'swath',
	'swear',
	'sweat',
	'sweep',
	'sweet',
	'swell',
	'swept',
	'swift',
	'swill',
	'swine',
	'swing',
	'swirl',
	'swish',
	'swoon',
	'swoop',
	'sword',
	'swore',
	'sworn',
	'swung',
	'synod',
	'syrup',
	'tabby',
	'table',
	'taboo',
	'tacit',
	'tacky',
	'taffy',
	'taint',
	'taken',
	'taker',
	'tally',
	'talon',
	'tamer',
	'tango',
	'tangy',
	'taper',
	'tapir',
	'tardy',
	'tarot',
	'taste',
	'tasty',
	'tatty',
	'taunt',
	'tawny',
	'teach',
	'teary',
	'tease',
	'teddy',
	'teeth',
	'tempo',
	'tenet',
	'tenor',
	'tense',
	'tenth',
	'tepee',
	'tepid',
	'terra',
	'terse',
	'testy',
	'thank',
	'theft',
	'their',
	'theme',
	'there',
	'these',
	'theta',
	'thick',
	'thief',
	'thigh',
	'thing',
	'think',
	'third',
	'thong',
	'thorn',
	'those',
	'three',
	'threw',
	'throb',
	'throw',
	'thrum',
	'thumb',
	'thump',
	'thyme',
	'tiara',
	'tibia',
	'tidal',
	'tiger',
	'tight',
	'tilde',
	'timer',
	'timid',
	'tipsy',
	'titan',
	'tithe',
	'title',
	'toast',
	'today',
	'toddy',
	'token',
	'tonal',
	'tonga',
	'tonic',
	'tooth',
	'topaz',
	'topic',
	'torch',
	'torso',
	'torus',
	'total',
	'totem',
	'touch',
	'tough',
	'towel',
	'tower',
	'toxic',
	'toxin',
	'trace',
	'track',
	'tract',
	'trade',
	'trail',
	'train',
	'trait',
	'tramp',
	'trash',
	'trawl',
	'tread',
	'treat',
	'trend',
	'triad',
	'trial',
	'tribe',
	'trice',
	'trick',
	'tried',
	'tripe',
	'trite',
	'troll',
	'troop',
	'trope',
	'trout',
	'trove',
	'truce',
	'truck',
	'truer',
	'truly',
	'trump',
	'trunk',
	'truss',
	'trust',
	'truth',
	'tryst',
	'tubal',
	'tuber',
	'tulip',
	'tulle',
	'tumor',
	'tunic',
	'turbo',
	'tutor',
	'twang',
	'tweak',
	'tweed',
	'tweet',
	'twice',
	'twine',
	'twirl',
	'twist',
	'twixt',
	'tying',
	'udder',
	'ulcer',
	'ultra',
	'umbra',
	'uncle',
	'uncut',
	'under',
	'undid',
	'undue',
	'unfed',
	'unfit',
	'unify',
	'union',
	'unite',
	'unity',
	'unlit',
	'unmet',
	'unset',
	'untie',
	'until',
	'unwed',
	'unzip',
	'upper',
	'upset',
	'urban',
	'urine',
	'usage',
	'usher',
	'using',
	'usual',
	'usurp',
	'utile',
	'utter',
	'vague',
	'valet',
	'valid',
	'valor',
	'value',
	'valve',
	'vapid',
	'vapor',
	'vault',
	'vaunt',
	'vegan',
	'venom',
	'venue',
	'verge',
	'verse',
	'verso',
	'verve',
	'vicar',
	'video',
	'vigil',
	'vigor',
	'villa',
	'vinyl',
	'viola',
	'viper',
	'viral',
	'virus',
	'visit',
	'visor',
	'vista',
	'vital',
	'vivid',
	'vixen',
	'vocal',
	'vodka',
	'vogue',
	'voice',
	'voila',
	'vomit',
	'voter',
	'vouch',
	'vowel',
	'vying',
	'wacky',
	'wafer',
	'wager',
	'wagon',
	'waist',
	'waive',
	'waltz',
	'warty',
	'waste',
	'watch',
	'water',
	'waver',
	'waxen',
	'weary',
	'weave',
	'wedge',
	'weedy',
	'weigh',
	'weird',
	'welch',
	'welsh',
	'wench',
	'whack',
	'whale',
	'wharf',
	'wheat',
	'wheel',
	'whelp',
	'where',
	'which',
	'whiff',
	'while',
	'whine',
	'whiny',
	'whirl',
	'whisk',
	'white',
	'whole',
	'whoop',
	'whose',
	'widen',
	'wider',
	'widow',
	'width',
	'wield',
	'wight',
	'willy',
	'wimpy',
	'wince',
	'winch',
	'windy',
	'wiser',
	'wispy',
	'witch',
	'witty',
	'woken',
	'woman',
	'women',
	'woody',
	'wooer',
	'wooly',
	'woozy',
	'wordy',
	'world',
	'worry',
	'worse',
	'worst',
	'worth',
	'would',
	'wound',
	'woven',
	'wrack',
	'wrath',
	'wreak',
	'wreck',
	'wrest',
	'wring',
	'wrist',
	'write',
	'wrong',
	'wrote',
	'wrung',
	'wryly',
	'yacht',
	'yearn',
	'yeast',
	'yield',
	'young',
	'youth',
	'zebra',
	'zesty',
	'zonal'
];

/** The list of valid guesses, of which the list of possible words is a subset */
export const allowed = new Set([
	...words,
	'aahed',
	'aalii',
	'aargh',
	'aarti',
	'abaca',
	'abaci',
	'abacs',
	'abaft',
	'abaka',
	'abamp',
	'aband',
	'abash',
	'abask',
	'abaya',
	'abbas',
	'abbed',
	'abbes',
	'abcee',
	'abeam',
	'abear',
	'abele',
	'abers',
	'abets',
	'abies',
	'abler',
	'ables',
	'ablet',
	'ablow',
	'abmho',
	'abohm',
	'aboil',
	'aboma',
	'aboon',
	'abord',
	'abore',
	'abram',
	'abray',
	'abrim',
	'abrin',
	'abris',
	'absey',
	'absit',
	'abuna',
	'abune',
	'abuts',
	'abuzz',
	'abyes',
	'abysm',
	'acais',
	'acari',
	'accas',
	'accoy',
	'acerb',
	'acers',
	'aceta',
	'achar',
	'ached',
	'aches',
	'achoo',
	'acids',
	'acidy',
	'acing',
	'acini',
	'ackee',
	'acker',
	'acmes',
	'acmic',
	'acned',
	'acnes',
	'acock',
	'acold',
	'acred',
	'acres',
	'acros',
	'acted',
	'actin',
	'acton',
	'acyls',
	'adaws',
	'adays',
	'adbot',
	'addax',
	'added',
	'adder',
	'addio',
	'addle',
	'adeem',
	'adhan',
	'adieu',
	'adios',
	'adits',
	'adman',
	'admen',
	'admix',
	'adobo',
	'adown',
	'adoze',
	'adrad',
	'adred',
	'adsum',
	'aduki',
	'adunc',
	'adust',
	'advew',
	'adyta',
	'adzed',
	'adzes',
	'aecia',
	'aedes',
	'aegis',
	'aeons',
	'aerie',
	'aeros',
	'aesir',
	'afald',
	'afara',
	'afars',
	'afear',
	'aflaj',
	'afore',
	'afrit',
	'afros',
	'agama',
	'agami',
	'agars',
	'agast',
	'agave',
	'agaze',
	'agene',
	'agers',
	'agger',
	'aggie',
	'aggri',
	'aggro',
	'aggry',
	'aghas',
	'agila',
	'agios',
	'agism',
	'agist',
	'agita',
	'aglee',
	'aglet',
	'agley',
	'agloo',
	'aglus',
	'agmas',
	'agoge',
	'agone',
	'agons',
	'agood',
	'agria',
	'agrin',
	'agros',
	'agued',
	'agues',
	'aguna',
	'aguti',
	'aheap',
	'ahent',
	'ahigh',
	'ahind',
	'ahing',
	'ahint',
	'ahold',
	'ahull',
	'ahuru',
	'aidas',
	'aided',
	'aides',
	'aidoi',
	'aidos',
	'aiery',
	'aigas',
	'aight',
	'ailed',
	'aimed',
	'aimer',
	'ainee',
	'ainga',
	'aioli',
	'aired',
	'airer',
	'airns',
	'airth',
	'airts',
	'aitch',
	'aitus',
	'aiver',
	'aiyee',
	'aizle',
	'ajies',
	'ajiva',
	'ajuga',
	'ajwan',
	'akees',
	'akela',
	'akene',
	'aking',
	'akita',
	'akkas',
	'alaap',
	'alack',
	'alamo',
	'aland',
	'alane',
	'alang',
	'alans',
	'alant',
	'alapa',
	'alaps',
	'alary',
	'alate',
	'alays',
	'albas',
	'albee',
	'alcid',
	'alcos',
	'aldea',
	'alder',
	'aldol',
	'aleck',
	'alecs',
	'alefs',
	'aleft',
	'aleph',
	'alews',
	'aleye',
	'alfas',
	'algal',
	'algas',
	'algid',
	'algin',
	'algor',
	'algum',
	'alias',
	'alifs',
	'aline',
	'alist',
	'aliya',
	'alkie',
	'alkos',
	'alkyd',
	'alkyl',
	'allee',
	'allel',
	'allis',
	'allod',
	'allyl',
	'almah',
	'almas',
	'almeh',
	'almes',
	'almud',
	'almug',
	'alods',
	'aloed',
	'aloes',
	'aloha',
	'aloin',
	'aloos',
	'alowe',
	'altho',
	'altos',
	'alula',
	'alums',
	'alure',
	'alvar',
	'alway',
	'amahs',
	'amain',
	'amate',
	'amaut',
	'amban',
	'ambit',
	'ambos',
	'ambry',
	'ameba',
	'ameer',
	'amene',
	'amens',
	'ament',
	'amias',
	'amice',
	'amici',
	'amide',
	'amido',
	'amids',
	'amies',
	'amiga',
	'amigo',
	'amine',
	'amino',
	'amins',
	'amirs',
	'amlas',
	'amman',
	'ammon',
	'ammos',
	'amnia',
	'amnic',
	'amnio',
	'amoks',
	'amole',
	'amort',
	'amour',
	'amove',
	'amowt',
	'amped',
	'ampul',
	'amrit',
	'amuck',
	'amyls',
	'anana',
	'anata',
	'ancho',
	'ancle',
	'ancon',
	'andro',
	'anear',
	'anele',
	'anent',
	'angas',
	'anglo',
	'anigh',
	'anile',
	'anils',
	'anima',
	'animi',
	'anion',
	'anise',
	'anker',
	'ankhs',
	'ankus',
	'anlas',
	'annal',
	'annas',
	'annat',
	'anoas',
	'anole',
	'anomy',
	'ansae',
	'antae',
	'antar',
	'antas',
	'anted',
	'antes',
	'antis',
	'antra',
	'antre',
	'antsy',
	'anura',
	'anyon',
	'apace',
	'apage',
	'apaid',
	'apayd',
	'apays',
	'apeak',
	'apeek',
	'apers',
	'apert',
	'apery',
	'apgar',
	'aphis',
	'apian',
	'apiol',
	'apish',
	'apism',
	'apode',
	'apods',
	'apoop',
	'aport',
	'appal',
	'appay',
	'appel',
	'appro',
	'appui',
	'appuy',
	'apres',
	'apses',
	'apsis',
	'apsos',
	'apted',
	'apter',
	'aquae',
	'aquas',
	'araba',
	'araks',
	'arame',
	'arars',
	'arbas',
	'arced',
	'archi',
	'arcos',
	'arcus',
	'ardeb',
	'ardri',
	'aread',
	'areae',
	'areal',
	'arear',
	'areas',
	'areca',
	'aredd',
	'arede',
	'arefy',
	'areic',
	'arene',
	'arepa',
	'arere',
	'arete',
	'arets',
	'arett',
	'argal',
	'argan',
	'argil',
	'argle',
	'argol',
	'argon',
	'argot',
	'argus',
	'arhat',
	'arias',
	'ariel',
	'ariki',
	'arils',
	'ariot',
	'arish',
	'arked',
	'arled',
	'arles',
	'armed',
	'armer',
	'armet',
	'armil',
	'arnas',
	'arnut',
	'aroba',
	'aroha',
	'aroid',
	'arpas',
	'arpen',
	'arrah',
	'arras',
	'arret',
	'arris',
	'arroz',
	'arsed',
	'arses',
	'arsey',
	'arsis',
	'artal',
	'artel',
	'artic',
	'artis',
	'aruhe',
	'arums',
	'arval',
	'arvee',
	'arvos',
	'aryls',
	'asana',
	'ascon',
	'ascus',
	'asdic',
	'ashed',
	'ashes',
	'ashet',
	'asked',
	'asker',
	'askoi',
	'askos',
	'aspen',
	'asper',
	'aspic',
	'aspie',
	'aspis',
	'aspro',
	'assai',
	'assam',
	'asses',
	'assez',
	'assot',
	'aster',
	'astir',
	'astun',
	'asura',
	'asway',
	'aswim',
	'asyla',
	'ataps',
	'ataxy',
	'atigi',
	'atilt',
	'atimy',
	'atlas',
	'atman',
	'atmas',
	'atmos',
	'atocs',
	'atoke',
	'atoks',
	'atoms',
	'atomy',
	'atony',
	'atopy',
	'atria',
	'atrip',
	'attap',
	'attar',
	'atuas',
	'audad',
	'auger',
	'aught',
	'aulas',
	'aulic',
	'auloi',
	'aulos',
	'aumil',
	'aunes',
	'aunts',
	'aurae',
	'aural',
	'aurar',
	'auras',
	'aurei',
	'aures',
	'auric',
	'auris',
	'aurum',
	'autos',
	'auxin',
	'avale',
	'avant',
	'avast',
	'avels',
	'avens',
	'avers',
	'avgas',
	'avine',
	'avion',
	'avise',
	'aviso',
	'avize',
	'avows',
	'avyze',
	'awarn',
	'awato',
	'awave',
	'aways',
	'awdls',
	'aweel',
	'aweto',
	'awing',
	'awmry',
	'awned',
	'awner',
	'awols',
	'awork',
	'axels',
	'axile',
	'axils',
	'axing',
	'axite',
	'axled',
	'axles',
	'axman',
	'axmen',
	'axoid',
	'axone',
	'axons',
	'ayahs',
	'ayaya',
	'ayelp',
	'aygre',
	'ayins',
	'ayont',
	'ayres',
	'ayrie',
	'azans',
	'azide',
	'azido',
	'azine',
	'azlon',
	'azoic',
	'azole',
	'azons',
	'azote',
	'azoth',
	'azuki',
	'azurn',
	'azury',
	'azygy',
	'azyme',
	'azyms',
	'baaed',
	'baals',
	'babas',
	'babel',
	'babes',
	'babka',
	'baboo',
	'babul',
	'babus',
	'bacca',
	'bacco',
	'baccy',
	'bacha',
	'bachs',
	'backs',
	'baddy',
	'baels',
	'baffs',
	'baffy',
	'bafts',
	'baghs',
	'bagie',
	'bahts',
	'bahus',
	'bahut',
	'bails',
	'bairn',
	'baisa',
	'baith',
	'baits',
	'baiza',
	'baize',
	'bajan',
	'bajra',
	'bajri',
	'bajus',
	'baked',
	'baken',
	'bakes',
	'bakra',
	'balas',
	'balds',
	'baldy',
	'baled',
	'bales',
	'balks',
	'balky',
	'balls',
	'bally',
	'balms',
	'baloo',
	'balsa',
	'balti',
	'balun',
	'balus',
	'bambi',
	'banak',
	'banco',
	'bancs',
	'banda',
	'bandh',
	'bands',
	'bandy',
	'baned',
	'banes',
	'bangs',
	'bania',
	'banks',
	'banns',
	'bants',
	'bantu',
	'banty',
	'banya',
	'bapus',
	'barbe',
	'barbs',
	'barby',
	'barca',
	'barde',
	'bardo',
	'bards',
	'bardy',
	'bared',
	'barer',
	'bares',
	'barfi',
	'barfs',
	'baric',
	'barks',
	'barky',
	'barms',
	'barmy',
	'barns',
	'barny',
	'barps',
	'barra',
	'barre',
	'barro',
	'barry',
	'barye',
	'basan',
	'based',
	'basen',
	'baser',
	'bases',
	'basho',
	'basij',
	'basks',
	'bason',
	'basse',
	'bassi',
	'basso',
	'bassy',
	'basta',
	'basti',
	'basto',
	'basts',
	'bated',
	'bates',
	'baths',
	'batik',
	'batta',
	'batts',
	'battu',
	'bauds',
	'bauks',
	'baulk',
	'baurs',
	'bavin',
	'bawds',
	'bawks',
	'bawls',
	'bawns',
	'bawrs',
	'bawty',
	'bayed',
	'bayer',
	'bayes',
	'bayle',
	'bayts',
	'bazar',
	'bazoo',
	'beads',
	'beaks',
	'beaky',
	'beals',
	'beams',
	'beamy',
	'beano',
	'beans',
	'beany',
	'beare',
	'bears',
	'beath',
	'beats',
	'beaty',
	'beaus',
	'beaut',
	'beaux',
	'bebop',
	'becap',
	'becke',
	'becks',
	'bedad',
	'bedel',
	'bedes',
	'bedew',
	'bedim',
	'bedye',
	'beedi',
	'beefs',
	'beeps',
	'beers',
	'beery',
	'beets',
	'befog',
	'begad',
	'begar',
	'begem',
	'begot',
	'begum',
	'beige',
	'beigy',
	'beins',
	'bekah',
	'belah',
	'belar',
	'belay',
	'belee',
	'belga',
	'bells',
	'belon',
	'belts',
	'bemad',
	'bemas',
	'bemix',
	'bemud',
	'bends',
	'bendy',
	'benes',
	'benet',
	'benga',
	'benis',
	'benne',
	'benni',
	'benny',
	'bento',
	'bents',
	'benty',
	'bepat',
	'beray',
	'beres',
	'bergs',
	'berko',
	'berks',
	'berme',
	'berms',
	'berob',
	'beryl',
	'besat',
	'besaw',
	'besee',
	'beses',
	'besit',
	'besom',
	'besot',
	'besti',
	'bests',
	'betas',
	'beted',
	'betes',
	'beths',
	'betid',
	'beton',
	'betta',
	'betty',
	'bever',
	'bevor',
	'bevue',
	'bevvy',
	'bewet',
	'bewig',
	'bezes',
	'bezil',
	'bezzy',
	'bhais',
	'bhaji',
	'bhang',
	'bhats',
	'bhels',
	'bhoot',
	'bhuna',
	'bhuts',
	'biach',
	'biali',
	'bialy',
	'bibbs',
	'bibes',
	'biccy',
	'bices',
	'bided',
	'bider',
	'bides',
	'bidet',
	'bidis',
	'bidon',
	'bield',
	'biers',
	'biffo',
	'biffs',
	'biffy',
	'bifid',
	'bigae',
	'biggs',
	'biggy',
	'bigha',
	'bight',
	'bigly',
	'bigos',
	'bijou',
	'biked',
	'biker',
	'bikes',
	'bikie',
	'bilbo',
	'bilby',
	'biled',
	'biles',
	'bilgy',
	'bilks',
	'bills',
	'bimah',
	'bimas',
	'bimbo',
	'binal',
	'bindi',
	'binds',
	'biner',
	'bines',
	'bings',
	'bingy',
	'binit',
	'binks',
	'bints',
	'biogs',
	'biont',
	'biota',
	'biped',
	'bipod',
	'birds',
	'birks',
	'birle',
	'birls',
	'biros',
	'birrs',
	'birse',
	'birsy',
	'bises',
	'bisks',
	'bisom',
	'bitch',
	'biter',
	'bites',
	'bitos',
	'bitou',
	'bitsy',
	'bitte',
	'bitts',
	'bivia',
	'bivvy',
	'bizes',
	'bizzo',
	'bizzy',
	'blabs',
	'blads',
	'blady',
	'blaer',
	'blaes',
	'blaff',
	'blags',
	'blahs',
	'blain',
	'blams',
	'blart',
	'blase',
	'blash',
	'blate',
	'blats',
	'blatt',
	'blaud',
	'blawn',
	'blaws',
	'blays',
	'blear',
	'blebs',
	'blech',
	'blees',
	'blent',
	'blert',
	'blest',
	'blets',
	'bleys',
	'blimy',
	'bling',
	'blini',
	'blins',
	'bliny',
	'blips',
	'blist',
	'blite',
	'blits',
	'blive',
	'blobs',
	'blocs',
	'blogs',
	'blook',
	'bloop',
	'blore',
	'blots',
	'blows',
	'blowy',
	'blubs',
	'blude',
	'bluds',
	'bludy',
	'blued',
	'blues',
	'bluet',
	'bluey',
	'bluid',
	'blume',
	'blunk',
	'blurs',
	'blype',
	'boabs',
	'boaks',
	'boars',
	'boart',
	'boats',
	'bobac',
	'bobak',
	'bobas',
	'bobol',
	'bobos',
	'bocca',
	'bocce',
	'bocci',
	'boche',
	'bocks',
	'boded',
	'bodes',
	'bodge',
	'bodhi',
	'bodle',
	'boeps',
	'boets',
	'boeuf',
	'boffo',
	'boffs',
	'bogan',
	'bogey',
	'boggy',
	'bogie',
	'bogle',
	'bogue',
	'bogus',
	'bohea',
	'bohos',
	'boils',
	'boing',
	'boink',
	'boite',
	'boked',
	'bokeh',
	'bokes',
	'bokos',
	'bolar',
	'bolas',
	'bolds',
	'boles',
	'bolix',
	'bolls',
	'bolos',
	'bolts',
	'bolus',
	'bomas',
	'bombe',
	'bombo',
	'bombs',
	'bonce',
	'bonds',
	'boned',
	'boner',
	'bones',
	'bongs',
	'bonie',
	'bonks',
	'bonne',
	'bonny',
	'bonza',
	'bonze',
	'booai',
	'booay',
	'boobs',
	'boody',
	'booed',
	'boofy',
	'boogy',
	'boohs',
	'books',
	'booky',
	'bools',
	'booms',
	'boomy',
	'boong',
	'boons',
	'boord',
	'boors',
	'boose',
	'boots',
	'boppy',
	'borak',
	'boral',
	'boras',
	'borde',
	'bords',
	'bored',
	'boree',
	'borel',
	'borer',
	'bores',
	'borgo',
	'boric',
	'borks',
	'borms',
	'borna',
	'boron',
	'borts',
	'borty',
	'bortz',
	'bosie',
	'bosks',
	'bosky',
	'boson',
	'bosun',
	'botas',
	'botel',
	'botes',
	'bothy',
	'botte',
	'botts',
	'botty',
	'bouge',
	'bouks',
	'boult',
	'bouns',
	'bourd',
	'bourg',
	'bourn',
	'bouse',
	'bousy',
	'bouts',
	'bovid',
	'bowat',
	'bowed',
	'bower',
	'bowes',
	'bowet',
	'bowie',
	'bowls',
	'bowne',
	'bowrs',
	'bowse',
	'boxed',
	'boxen',
	'boxes',
	'boxla',
	'boxty',
	'boyar',
	'boyau',
	'boyed',
	'boyfs',
	'boygs',
	'boyla',
	'boyos',
	'boysy',
	'bozos',
	'braai',
	'brach',
	'brack',
	'bract',
	'brads',
	'braes',
	'brags',
	'brail',
	'braks',
	'braky',
	'brame',
	'brane',
	'brank',
	'brans',
	'brant',
	'brast',
	'brats',
	'brava',
	'bravi',
	'braws',
	'braxy',
	'brays',
	'braza',
	'braze',
	'bream',
	'brede',
	'breds',
	'breem',
	'breer',
	'brees',
	'breid',
	'breis',
	'breme',
	'brens',
	'brent',
	'brere',
	'brers',
	'breve',
	'brews',
	'breys',
	'brier',
	'bries',
	'brigs',
	'briki',
	'briks',
	'brill',
	'brims',
	'brins',
	'brios',
	'brise',
	'briss',
	'brith',
	'brits',
	'britt',
	'brize',
	'broch',
	'brock',
	'brods',
	'brogh',
	'brogs',
	'brome',
	'bromo',
	'bronc',
	'brond',
	'brool',
	'broos',
	'brose',
	'brosy',
	'brows',
	'brugh',
	'bruin',
	'bruit',
	'brule',
	'brume',
	'brung',
	'brusk',
	'brust',
	'bruts',
	'buats',
	'buaze',
	'bubal',
	'bubas',
	'bubba',
	'bubbe',
	'bubby',
	'bubus',
	'buchu',
	'bucko',
	'bucks',
	'bucku',
	'budas',
	'budis',
	'budos',
	'buffa',
	'buffe',
	'buffi',
	'buffo',
	'buffs',
	'buffy',
	'bufos',
	'bufty',
	'buhls',
	'buhrs',
	'buiks',
	'buist',
	'bukes',
	'bulbs',
	'bulgy',
	'bulks',
	'bulla',
	'bulls',
	'bulse',
	'bumbo',
	'bumfs',
	'bumph',
	'bumps',
	'bumpy',
	'bunas',
	'bunce',
	'bunco',
	'bunde',
	'bundh',
	'bunds',
	'bundt',
	'bundu',
	'bundy',
	'bungs',
	'bungy',
	'bunia',
	'bunje',
	'bunjy',
	'bunko',
	'bunks',
	'bunns',
	'bunts',
	'bunty',
	'bunya',
	'buoys',
	'buppy',
	'buran',
	'buras',
	'burbs',
	'burds',
	'buret',
	'burfi',
	'burgh',
	'burgs',
	'burin',
	'burka',
	'burke',
	'burks',
	'burls',
	'burns',
	'buroo',
	'burps',
	'burqa',
	'burro',
	'burrs',
	'burry',
	'bursa',
	'burse',
	'busby',
	'buses',
	'busks',
	'busky',
	'bussu',
	'busti',
	'busts',
	'busty',
	'buteo',
	'butes',
	'butle',
	'butoh',
	'butts',
	'butty',
	'butut',
	'butyl',
	'buzzy',
	'bwana',
	'bwazi',
	'byded',
	'bydes',
	'byked',
	'bykes',
	'byres',
	'byrls',
	'byssi',
	'bytes',
	'byway',
	'caaed',
	'cabas',
	'caber',
	'cabob',
	'caboc',
	'cabre',
	'cacas',
	'cacks',
	'cacky',
	'cadee',
	'cades',
	'cadge',
	'cadgy',
	'cadie',
	'cadis',
	'cadre',
	'caeca',
	'caese',
	'cafes',
	'caffs',
	'caged',
	'cager',
	'cages',
	'cagot',
	'cahow',
	'caids',
	'cains',
	'caird',
	'cajon',
	'cajun',
	'caked',
	'cakes',
	'cakey',
	'calfs',
	'calid',
	'calif',
	'calix',
	'calks',
	'calla',
	'calls',
	'calms',
	'calmy',
	'calos',
	'calpa',
	'calps',
	'calve',
	'calyx',
	'caman',
	'camas',
	'cames',
	'camis',
	'camos',
	'campi',
	'campo',
	'camps',
	'campy',
	'camus',
	'caned',
	'caneh',
	'caner',
	'canes',
	'cangs',
	'canid',
	'canna',
	'canns',
	'canso',
	'canst',
	'canto',
	'cants',
	'canty',
	'capas',
	'caped',
	'capes',
	'capex',
	'caphs',
	'capiz',
	'caple',
	'capon',
	'capos',
	'capot',
	'capri',
	'capul',
	'carap',
	'carbo',
	'carbs',
	'carby',
	'cardi',
	'cards',
	'cardy',
	'cared',
	'carer',
	'cares',
	'caret',
	'carex',
	'carks',
	'carle',
	'carls',
	'carns',
	'carny',
	'carob',
	'carom',
	'caron',
	'carpi',
	'carps',
	'carrs',
	'carse',
	'carta',
	'carte',
	'carts',
	'carvy',
	'casas',
	'casco',
	'cased',
	'cases',
	'casks',
	'casky',
	'casts',
	'casus',
	'cates',
	'cauda',
	'cauks',
	'cauld',
	'cauls',
	'caums',
	'caups',
	'cauri',
	'causa',
	'cavas',
	'caved',
	'cavel',
	'caver',
	'caves',
	'cavie',
	'cawed',
	'cawks',
	'caxon',
	'ceaze',
	'cebid',
	'cecal',
	'cecum',
	'ceded',
	'ceder',
	'cedes',
	'cedis',
	'ceiba',
	'ceili',
	'ceils',
	'celeb',
	'cella',
	'celli',
	'cells',
	'celom',
	'celts',
	'cense',
	'cento',
	'cents',
	'centu',
	'ceorl',
	'cepes',
	'cerci',
	'cered',
	'ceres',
	'cerge',
	'ceria',
	'ceric',
	'cerne',
	'ceroc',
	'ceros',
	'certs',
	'certy',
	'cesse',
	'cesta',
	'cesti',
	'cetes',
	'cetyl',
	'cezve',
	'chace',
	'chack',
	'chaco',
	'chado',
	'chads',
	'chaft',
	'chais',
	'chals',
	'chams',
	'chana',
	'chang',
	'chank',
	'chape',
	'chaps',
	'chapt',
	'chara',
	'chare',
	'chark',
	'charr',
	'chars',
	'chary',
	'chats',
	'chave',
	'chavs',
	'chawk',
	'chaws',
	'chaya',
	'chays',
	'cheep',
	'chefs',
	'cheka',
	'chela',
	'chelp',
	'chemo',
	'chems',
	'chere',
	'chert',
	'cheth',
	'chevy',
	'chews',
	'chewy',
	'chiao',
	'chias',
	'chibs',
	'chica',
	'chich',
	'chico',
	'chics',
	'chiel',
	'chiks',
	'chile',
	'chimb',
	'chimo',
	'chimp',
	'chine',
	'ching',
	'chink',
	'chino',
	'chins',
	'chips',
	'chirk',
	'chirl',
	'chirm',
	'chiro',
	'chirr',
	'chirt',
	'chiru',
	'chits',
	'chive',
	'chivs',
	'chivy',
	'chizz',
	'choco',
	'chocs',
	'chode',
	'chogs',
	'choil',
	'choko',
	'choky',
	'chola',
	'choli',
	'cholo',
	'chomp',
	'chons',
	'choof',
	'chook',
	'choom',
	'choon',
	'chops',
	'chota',
	'chott',
	'chout',
	'choux',
	'chowk',
	'chows',
	'chubs',
	'chufa',
	'chuff',
	'chugs',
	'chums',
	'churl',
	'churr',
	'chuse',
	'chuts',
	'chyle',
	'chyme',
	'chynd',
	'cibol',
	'cided',
	'cides',
	'ciels',
	'ciggy',
	'cilia',
	'cills',
	'cimar',
	'cimex',
	'cinct',
	'cines',
	'cinqs',
	'cions',
	'cippi',
	'circs',
	'cires',
	'cirls',
	'cirri',
	'cisco',
	'cissy',
	'cists',
	'cital',
	'cited',
	'citer',
	'cites',
	'cives',
	'civet',
	'civie',
	'civvy',
	'clach',
	'clade',
	'clads',
	'claes',
	'clags',
	'clame',
	'clams',
	'clans',
	'claps',
	'clapt',
	'claro',
	'clart',
	'clary',
	'clast',
	'clats',
	'claut',
	'clave',
	'clavi',
	'claws',
	'clays',
	'cleck',
	'cleek',
	'cleep',
	'clefs',
	'clegs',
	'cleik',
	'clems',
	'clepe',
	'clept',
	'cleve',
	'clews',
	'clied',
	'clies',
	'clift',
	'clime',
	'cline',
	'clint',
	'clipe',
	'clips',
	'clipt',
	'clits',
	'cloam',
	'clods',
	'cloff',
	'clogs',
	'cloke',
	'clomb',
	'clomp',
	'clonk',
	'clons',
	'cloop',
	'cloot',
	'clops',
	'clote',
	'clots',
	'clour',
	'clous',
	'clows',
	'cloye',
	'cloys',
	'cloze',
	'clubs',
	'clues',
	'cluey',
	'clunk',
	'clype',
	'cnida',
	'coact',
	'coady',
	'coala',
	'coals',
	'coaly',
	'coapt',
	'coarb',
	'coate',
	'coati',
	'coats',
	'cobbs',
	'cobby',
	'cobia',
	'coble',
	'cobza',
	'cocas',
	'cocci',
	'cocco',
	'cocks',
	'cocky',
	'cocos',
	'codas',
	'codec',
	'coded',
	'coden',
	'coder',
	'codes',
	'codex',
	'codon',
	'coeds',
	'coffs',
	'cogie',
	'cogon',
	'cogue',
	'cohab',
	'cohen',
	'cohoe',
	'cohog',
	'cohos',
	'coifs',
	'coign',
	'coils',
	'coins',
	'coirs',
	'coits',
	'coked',
	'cokes',
	'colas',
	'colby',
	'colds',
	'coled',
	'coles',
	'coley',
	'colic',
	'colin',
	'colls',
	'colly',
	'colog',
	'colts',
	'colza',
	'comae',
	'comal',
	'comas',
	'combe',
	'combi',
	'combo',
	'combs',
	'comby',
	'comer',
	'comes',
	'comix',
	'commo',
	'comms',
	'commy',
	'compo',
	'comps',
	'compt',
	'comte',
	'comus',
	'coned',
	'cones',
	'coney',
	'confs',
	'conga',
	'conge',
	'congo',
	'conia',
	'conin',
	'conks',
	'conky',
	'conne',
	'conns',
	'conte',
	'conto',
	'conus',
	'convo',
	'cooch',
	'cooed',
	'cooee',
	'cooer',
	'cooey',
	'coofs',
	'cooks',
	'cooky',
	'cools',
	'cooly',
	'coomb',
	'cooms',
	'coomy',
	'coons',
	'coops',
	'coopt',
	'coost',
	'coots',
	'cooze',
	'copal',
	'copay',
	'coped',
	'copen',
	'coper',
	'copes',
	'coppy',
	'copra',
	'copsy',
	'coqui',
	'coram',
	'corbe',
	'corby',
	'cords',
	'cored',
	'cores',
	'corey',
	'corgi',
	'coria',
	'corks',
	'corky',
	'corms',
	'corni',
	'corno',
	'corns',
	'cornu',
	'corps',
	'corse',
	'corso',
	'cosec',
	'cosed',
	'coses',
	'coset',
	'cosey',
	'cosie',
	'costa',
	'coste',
	'costs',
	'cotan',
	'coted',
	'cotes',
	'coths',
	'cotta',
	'cotts',
	'coude',
	'coups',
	'courb',
	'courd',
	'coure',
	'cours',
	'couta',
	'couth',
	'coved',
	'coves',
	'covin',
	'cowal',
	'cowan',
	'cowed',
	'cowks',
	'cowls',
	'cowps',
	'cowry',
	'coxae',
	'coxal',
	'coxed',
	'coxes',
	'coxib',
	'coyau',
	'coyed',
	'coyer',
	'coypu',
	'cozed',
	'cozen',
	'cozes',
	'cozey',
	'cozie',
	'craal',
	'crabs',
	'crags',
	'craic',
	'craig',
	'crake',
	'crame',
	'crams',
	'crans',
	'crape',
	'craps',
	'crapy',
	'crare',
	'craws',
	'crays',
	'creds',
	'creel',
	'crees',
	'crems',
	'crena',
	'creps',
	'crepy',
	'crewe',
	'crews',
	'crias',
	'cribs',
	'cries',
	'crims',
	'crine',
	'crios',
	'cripe',
	'crips',
	'crise',
	'crith',
	'crits',
	'croci',
	'crocs',
	'croft',
	'crogs',
	'cromb',
	'crome',
	'cronk',
	'crons',
	'crool',
	'croon',
	'crops',
	'crore',
	'crost',
	'crout',
	'crows',
	'croze',
	'cruck',
	'crudo',
	'cruds',
	'crudy',
	'crues',
	'cruet',
	'cruft',
	'crunk',
	'cruor',
	'crura',
	'cruse',
	'crusy',
	'cruve',
	'crwth',
	'cryer',
	'ctene',
	'cubby',
	'cubeb',
	'cubed',
	'cuber',
	'cubes',
	'cubit',
	'cuddy',
	'cuffo',
	'cuffs',
	'cuifs',
	'cuing',
	'cuish',
	'cuits',
	'cukes',
	'culch',
	'culet',
	'culex',
	'culls',
	'cully',
	'culms',
	'culpa',
	'culti',
	'cults',
	'culty',
	'cumec',
	'cundy',
	'cunei',
	'cunit',
	'cunts',
	'cupel',
	'cupid',
	'cuppa',
	'cuppy',
	'curat',
	'curbs',
	'curch',
	'curds',
	'curdy',
	'cured',
	'curer',
	'cures',
	'curet',
	'curfs',
	'curia',
	'curie',
	'curli',
	'curls',
	'curns',
	'curny',
	'currs',
	'cursi',
	'curst',
	'cusec',
	'cushy',
	'cusks',
	'cusps',
	'cuspy',
	'cusso',
	'cusum',
	'cutch',
	'cuter',
	'cutes',
	'cutey',
	'cutin',
	'cutis',
	'cutto',
	'cutty',
	'cutup',
	'cuvee',
	'cuzes',
	'cwtch',
	'cyano',
	'cyans',
	'cycad',
	'cycas',
	'cyclo',
	'cyder',
	'cylix',
	'cymae',
	'cymar',
	'cymas',
	'cymes',
	'cymol',
	'cysts',
	'cytes',
	'cyton',
	'czars',
	'daals',
	'dabba',
	'daces',
	'dacha',
	'dacks',
	'dadah',
	'dadas',
	'dados',
	'daffs',
	'daffy',
	'dagga',
	'daggy',
	'dagos',
	'dahls',
	'daiko',
	'daine',
	'daint',
	'daker',
	'daled',
	'dales',
	'dalis',
	'dalle',
	'dalts',
	'daman',
	'damar',
	'dames',
	'damme',
	'damns',
	'damps',
	'dampy',
	'dancy',
	'dangs',
	'danio',
	'danks',
	'danny',
	'dants',
	'daraf',
	'darbs',
	'darcy',
	'dared',
	'darer',
	'dares',
	'darga',
	'dargs',
	'daric',
	'daris',
	'darks',
	'darky',
	'darns',
	'darre',
	'darts',
	'darzi',
	'dashi',
	'dashy',
	'datal',
	'dated',
	'dater',
	'dates',
	'datos',
	'datto',
	'daube',
	'daubs',
	'dauby',
	'dauds',
	'dault',
	'daurs',
	'dauts',
	'daven',
	'davit',
	'dawah',
	'dawds',
	'dawed',
	'dawen',
	'dawks',
	'dawns',
	'dawts',
	'dayan',
	'daych',
	'daynt',
	'dazed',
	'dazer',
	'dazes',
	'deads',
	'deair',
	'deals',
	'deans',
	'deare',
	'dearn',
	'dears',
	'deary',
	'deash',
	'deave',
	'deaws',
	'deawy',
	'debag',
	'debby',
	'debel',
	'debes',
	'debts',
	'debud',
	'debur',
	'debus',
	'debye',
	'decad',
	'decaf',
	'decan',
	'decko',
	'decks',
	'decos',
	'dedal',
	'deeds',
	'deedy',
	'deely',
	'deems',
	'deens',
	'deeps',
	'deere',
	'deers',
	'deets',
	'deeve',
	'deevs',
	'defat',
	'deffo',
	'defis',
	'defog',
	'degas',
	'degum',
	'degus',
	'deice',
	'deids',
	'deify',
	'deils',
	'deism',
	'deist',
	'deked',
	'dekes',
	'dekko',
	'deled',
	'deles',
	'delfs',
	'delft',
	'delis',
	'dells',
	'delly',
	'delos',
	'delph',
	'delts',
	'deman',
	'demes',
	'demic',
	'demit',
	'demob',
	'demoi',
	'demos',
	'dempt',
	'denar',
	'denay',
	'dench',
	'denes',
	'denet',
	'denis',
	'dents',
	'deoxy',
	'derat',
	'deray',
	'dered',
	'deres',
	'derig',
	'derma',
	'derms',
	'derns',
	'derny',
	'deros',
	'derro',
	'derry',
	'derth',
	'dervs',
	'desex',
	'deshi',
	'desis',
	'desks',
	'desse',
	'devas',
	'devel',
	'devis',
	'devon',
	'devos',
	'devot',
	'dewan',
	'dewar',
	'dewax',
	'dewed',
	'dexes',
	'dexie',
	'dhaba',
	'dhaks',
	'dhals',
	'dhikr',
	'dhobi',
	'dhole',
	'dholl',
	'dhols',
	'dhoti',
	'dhows',
	'dhuti',
	'diact',
	'dials',
	'diane',
	'diazo',
	'dibbs',
	'diced',
	'dicer',
	'dices',
	'dicht',
	'dicks',
	'dicky',
	'dicot',
	'dicta',
	'dicts',
	'dicty',
	'diddy',
	'didie',
	'didos',
	'didst',
	'diebs',
	'diels',
	'diene',
	'diets',
	'diffs',
	'dight',
	'dikas',
	'diked',
	'diker',
	'dikes',
	'dikey',
	'dildo',
	'dilli',
	'dills',
	'dimbo',
	'dimer',
	'dimes',
	'dimps',
	'dinar',
	'dined',
	'dines',
	'dinge',
	'dings',
	'dinic',
	'dinks',
	'dinky',
	'dinna',
	'dinos',
	'dints',
	'diols',
	'diota',
	'dippy',
	'dipso',
	'diram',
	'direr',
	'dirke',
	'dirks',
	'dirls',
	'dirts',
	'disas',
	'disci',
	'discs',
	'dishy',
	'disks',
	'disme',
	'dital',
	'ditas',
	'dited',
	'dites',
	'ditsy',
	'ditts',
	'ditzy',
	'divan',
	'divas',
	'dived',
	'dives',
	'divis',
	'divna',
	'divos',
	'divot',
	'divvy',
	'diwan',
	'dixie',
	'dixit',
	'diyas',
	'dizen',
	'djinn',
	'djins',
	'doabs',
	'doats',
	'dobby',
	'dobes',
	'dobie',
	'dobla',
	'dobra',
	'dobro',
	'docht',
	'docks',
	'docos',
	'docus',
	'doddy',
	'dodos',
	'doeks',
	'doers',
	'doest',
	'doeth',
	'doffs',
	'dogan',
	'doges',
	'dogey',
	'doggo',
	'doggy',
	'dogie',
	'dohyo',
	'doilt',
	'doily',
	'doits',
	'dojos',
	'dolce',
	'dolci',
	'doled',
	'doles',
	'dolia',
	'dolls',
	'dolma',
	'dolor',
	'dolos',
	'dolts',
	'domal',
	'domed',
	'domes',
	'domic',
	'donah',
	'donas',
	'donee',
	'doner',
	'donga',
	'dongs',
	'donko',
	'donna',
	'donne',
	'donny',
	'donsy',
	'doobs',
	'dooce',
	'doody',
	'dooks',
	'doole',
	'dools',
	'dooly',
	'dooms',
	'doomy',
	'doona',
	'doorn',
	'doors',
	'doozy',
	'dopas',
	'doped',
	'doper',
	'dopes',
	'dorad',
	'dorba',
	'dorbs',
	'doree',
	'dores',
	'doric',
	'doris',
	'dorks',
	'dorky',
	'dorms',
	'dormy',
	'dorps',
	'dorrs',
	'dorsa',
	'dorse',
	'dorts',
	'dorty',
	'dosai',
	'dosas',
	'dosed',
	'doseh',
	'doser',
	'doses',
	'dosha',
	'dotal',
	'doted',
	'doter',
	'dotes',
	'dotty',
	'douar',
	'douce',
	'doucs',
	'douks',
	'doula',
	'douma',
	'doums',
	'doups',
	'doura',
	'douse',
	'douts',
	'doved',
	'doven',
	'dover',
	'doves',
	'dovie',
	'dowar',
	'dowds',
	'dowed',
	'dower',
	'dowie',
	'dowle',
	'dowls',
	'dowly',
	'downa',
	'downs',
	'dowps',
	'dowse',
	'dowts',
	'doxed',
	'doxes',
	'doxie',
	'doyen',
	'doyly',
	'dozed',
	'dozer',
	'dozes',
	'drabs',
	'drack',
	'draco',
	'draff',
	'drags',
	'drail',
	'drams',
	'drant',
	'draps',
	'drats',
	'drave',
	'draws',
	'drays',
	'drear',
	'dreck',
	'dreed',
	'dreer',
	'drees',
	'dregs',
	'dreks',
	'drent',
	'drere',
	'drest',
	'dreys',
	'dribs',
	'drice',
	'dries',
	'drily',
	'drips',
	'dript',
	'droid',
	'droil',
	'droke',
	'drole',
	'drome',
	'drony',
	'droob',
	'droog',
	'drook',
	'drops',
	'dropt',
	'drouk',
	'drows',
	'drubs',
	'drugs',
	'drums',
	'drupe',
	'druse',
	'drusy',
	'druxy',
	'dryad',
	'dryas',
	'dsobo',
	'dsomo',
	'duads',
	'duals',
	'duans',
	'duars',
	'dubbo',
	'ducal',
	'ducat',
	'duces',
	'ducks',
	'ducky',
	'ducts',
	'duddy',
	'duded',
	'dudes',
	'duels',
	'duets',
	'duett',
	'duffs',
	'dufus',
	'duing',
	'duits',
	'dukas',
	'duked',
	'dukes',
	'dukka',
	'dulce',
	'dules',
	'dulia',
	'dulls',
	'dulse',
	'dumas',
	'dumbo',
	'dumbs',
	'dumka',
	'dumky',
	'dumps',
	'dunam',
	'dunch',
	'dunes',
	'dungs',
	'dungy',
	'dunks',
	'dunno',
	'dunny',
	'dunsh',
	'dunts',
	'duomi',
	'duomo',
	'duped',
	'duper',
	'dupes',
	'duple',
	'duply',
	'duppy',
	'dural',
	'duras',
	'dured',
	'dures',
	'durgy',
	'durns',
	'duroc',
	'duros',
	'duroy',
	'durra',
	'durrs',
	'durry',
	'durst',
	'durum',
	'durzi',
	'dusks',
	'dusts',
	'duxes',
	'dwaal',
	'dwale',
	'dwalm',
	'dwams',
	'dwang',
	'dwaum',
	'dweeb',
	'dwile',
	'dwine',
	'dyads',
	'dyers',
	'dyked',
	'dykes',
	'dykey',
	'dykon',
	'dynel',
	'dynes',
	'dzhos',
	'eagre',
	'ealed',
	'eales',
	'eaned',
	'eards',
	'eared',
	'earls',
	'earns',
	'earnt',
	'earst',
	'eased',
	'easer',
	'eases',
	'easle',
	'easts',
	'eathe',
	'eaved',
	'eaves',
	'ebbed',
	'ebbet',
	'ebons',
	'ebook',
	'ecads',
	'eched',
	'eches',
	'echos',
	'ecrus',
	'edema',
	'edged',
	'edger',
	'edges',
	'edile',
	'edits',
	'educe',
	'educt',
	'eejit',
	'eensy',
	'eeven',
	'eevns',
	'effed',
	'egads',
	'egers',
	'egest',
	'eggar',
	'egged',
	'egger',
	'egmas',
	'ehing',
	'eider',
	'eidos',
	'eigne',
	'eiked',
	'eikon',
	'eilds',
	'eisel',
	'ejido',
	'ekkas',
	'elain',
	'eland',
	'elans',
	'elchi',
	'eldin',
	'elemi',
	'elfed',
	'eliad',
	'elint',
	'elmen',
	'eloge',
	'elogy',
	'eloin',
	'elops',
	'elpee',
	'elsin',
	'elute',
	'elvan',
	'elven',
	'elver',
	'elves',
	'emacs',
	'embar',
	'embay',
	'embog',
	'embow',
	'embox',
	'embus',
	'emeer',
	'emend',
	'emerg',
	'emery',
	'emeus',
	'emics',
	'emirs',
	'emits',
	'emmas',
	'emmer',
	'emmet',
	'emmew',
	'emmys',
	'emoji',
	'emong',
	'emote',
	'emove',
	'empts',
	'emule',
	'emure',
	'emyde',
	'emyds',
	'enarm',
	'enate',
	'ended',
	'ender',
	'endew',
	'endue',
	'enews',
	'enfix',
	'eniac',
	'enlit',
	'enmew',
	'ennog',
	'enoki',
	'enols',
	'enorm',
	'enows',
	'enrol',
	'ensew',
	'ensky',
	'entia',
	'enure',
	'enurn',
	'envoi',
	'enzym',
	'eorls',
	'eosin',
	'epact',
	'epees',
	'ephah',
	'ephas',
	'ephod',
	'ephor',
	'epics',
	'epode',
	'epopt',
	'epris',
	'eques',
	'equid',
	'erbia',
	'erevs',
	'ergon',
	'ergos',
	'ergot',
	'erhus',
	'erica',
	'erick',
	'erics',
	'ering',
	'erned',
	'ernes',
	'erose',
	'erred',
	'erses',
	'eruct',
	'erugo',
	'eruvs',
	'erven',
	'ervil',
	'escar',
	'escot',
	'esile',
	'eskar',
	'esker',
	'esnes',
	'esses',
	'estoc',
	'estop',
	'estro',
	'etage',
	'etape',
	'etats',
	'etens',
	'ethal',
	'ethne',
	'ethyl',
	'etics',
	'etnas',
	'ettin',
	'ettle',
	'etuis',
	'etwee',
	'etyma',
	'eughs',
	'euked',
	'eupad',
	'euros',
	'eusol',
	'evens',
	'evert',
	'evets',
	'evhoe',
	'evils',
	'evite',
	'evohe',
	'ewers',
	'ewest',
	'ewhow',
	'ewked',
	'exams',
	'exeat',
	'execs',
	'exeem',
	'exeme',
	'exfil',
	'exies',
	'exine',
	'exing',
	'exits',
	'exode',
	'exome',
	'exons',
	'expat',
	'expos',
	'exude',
	'exuls',
	'exurb',
	'eyass',
	'eyers',
	'eyots',
	'eyras',
	'eyres',
	'eyrie',
	'eyrir',
	'ezine',
	'fabby',
	'faced',
	'facer',
	'faces',
	'facia',
	'facta',
	'facts',
	'faddy',
	'faded',
	'fader',
	'fades',
	'fadge',
	'fados',
	'faena',
	'faery',
	'faffs',
	'faffy',
	'faggy',
	'fagin',
	'fagot',
	'faiks',
	'fails',
	'faine',
	'fains',
	'fairs',
	'faked',
	'faker',
	'fakes',
	'fakey',
	'fakie',
	'fakir',
	'falaj',
	'falls',
	'famed',
	'fames',
	'fanal',
	'fands',
	'fanes',
	'fanga',
	'fango',
	'fangs',
	'fanks',
	'fanon',
	'fanos',
	'fanum',
	'faqir',
	'farad',
	'farci',
	'farcy',
	'fards',
	'fared',
	'farer',
	'fares',
	'farle',
	'farls',
	'farms',
	'faros',
	'farro',
	'farse',
	'farts',
	'fasci',
	'fasti',
	'fasts',
	'fated',
	'fates',
	'fatly',
	'fatso',
	'fatwa',
	'faugh',
	'fauld',
	'fauns',
	'faurd',
	'fauts',
	'fauve',
	'favas',
	'favel',
	'faver',
	'faves',
	'favus',
	'fawns',
	'fawny',
	'faxed',
	'faxes',
	'fayed',
	'fayer',
	'fayne',
	'fayre',
	'fazed',
	'fazes',
	'feals',
	'feare',
	'fears',
	'feart',
	'fease',
	'feats',
	'feaze',
	'feces',
	'fecht',
	'fecit',
	'fecks',
	'fedex',
	'feebs',
	'feeds',
	'feels',
	'feens',
	'feers',
	'feese',
	'feeze',
	'fehme',
	'feint',
	'feist',
	'felch',
	'felid',
	'fells',
	'felly',
	'felts',
	'felty',
	'femal',
	'femes',
	'femmy',
	'fends',
	'fendy',
	'fenis',
	'fenks',
	'fenny',
	'fents',
	'feods',
	'feoff',
	'ferer',
	'feres',
	'feria',
	'ferly',
	'fermi',
	'ferms',
	'ferns',
	'ferny',
	'fesse',
	'festa',
	'fests',
	'festy',
	'fetas',
	'feted',
	'fetes',
	'fetor',
	'fetta',
	'fetts',
	'fetwa',
	'feuar',
	'feuds',
	'feued',
	'feyed',
	'feyer',
	'feyly',
	'fezes',
	'fezzy',
	'fiars',
	'fiats',
	'fibro',
	'fices',
	'fiche',
	'fichu',
	'ficin',
	'ficos',
	'fides',
	'fidge',
	'fidos',
	'fiefs',
	'fient',
	'fiere',
	'fiers',
	'fiest',
	'fifed',
	'fifer',
	'fifes',
	'fifis',
	'figgy',
	'figos',
	'fiked',
	'fikes',
	'filar',
	'filch',
	'filed',
	'files',
	'filii',
	'filks',
	'fille',
	'fillo',
	'fills',
	'filmi',
	'films',
	'filos',
	'filum',
	'finca',
	'finds',
	'fined',
	'fines',
	'finis',
	'finks',
	'finny',
	'finos',
	'fiord',
	'fiqhs',
	'fique',
	'fired',
	'firer',
	'fires',
	'firie',
	'firks',
	'firms',
	'firns',
	'firry',
	'firth',
	'fiscs',
	'fisks',
	'fists',
	'fisty',
	'fitch',
	'fitly',
	'fitna',
	'fitte',
	'fitts',
	'fiver',
	'fives',
	'fixed',
	'fixes',
	'fixit',
	'fjeld',
	'flabs',
	'flaff',
	'flags',
	'flaks',
	'flamm',
	'flams',
	'flamy',
	'flane',
	'flans',
	'flaps',
	'flary',
	'flats',
	'flava',
	'flawn',
	'flaws',
	'flawy',
	'flaxy',
	'flays',
	'fleam',
	'fleas',
	'fleek',
	'fleer',
	'flees',
	'flegs',
	'fleme',
	'fleur',
	'flews',
	'flexi',
	'flexo',
	'fleys',
	'flics',
	'flied',
	'flies',
	'flimp',
	'flims',
	'flips',
	'flirs',
	'flisk',
	'flite',
	'flits',
	'flitt',
	'flobs',
	'flocs',
	'floes',
	'flogs',
	'flong',
	'flops',
	'flors',
	'flory',
	'flosh',
	'flota',
	'flote',
	'flows',
	'flubs',
	'flued',
	'flues',
	'fluey',
	'fluky',
	'flump',
	'fluor',
	'flurr',
	'fluty',
	'fluyt',
	'flyby',
	'flype',
	'flyte',
	'foals',
	'foams',
	'foehn',
	'fogey',
	'fogie',
	'fogle',
	'fogou',
	'fohns',
	'foids',
	'foils',
	'foins',
	'folds',
	'foley',
	'folia',
	'folic',
	'folie',
	'folks',
	'folky',
	'fomes',
	'fonda',
	'fonds',
	'fondu',
	'fones',
	'fonly',
	'fonts',
	'foods',
	'foody',
	'fools',
	'foots',
	'footy',
	'foram',
	'forbs',
	'forby',
	'fordo',
	'fords',
	'forel',
	'fores',
	'forex',
	'forks',
	'forky',
	'forme',
	'forms',
	'forts',
	'forza',
	'forze',
	'fossa',
	'fosse',
	'fouat',
	'fouds',
	'fouer',
	'fouet',
	'foule',
	'fouls',
	'fount',
	'fours',
	'fouth',
	'fovea',
	'fowls',
	'fowth',
	'foxed',
	'foxes',
	'foxie',
	'foyle',
	'foyne',
	'frabs',
	'frack',
	'fract',
	'frags',
	'fraim',
	'franc',
	'frape',
	'fraps',
	'frass',
	'frate',
	'frati',
	'frats',
	'fraus',
	'frays',
	'frees',
	'freet',
	'freit',
	'fremd',
	'frena',
	'freon',
	'frere',
	'frets',
	'fribs',
	'frier',
	'fries',
	'frigs',
	'frise',
	'frist',
	'frith',
	'frits',
	'fritt',
	'frize',
	'frizz',
	'froes',
	'frogs',
	'frons',
	'frore',
	'frorn',
	'frory',
	'frosh',
	'frows',
	'frowy',
	'frugs',
	'frump',
	'frush',
	'frust',
	'fryer',
	'fubar',
	'fubby',
	'fubsy',
	'fucks',
	'fucus',
	'fuddy',
	'fudgy',
	'fuels',
	'fuero',
	'fuffs',
	'fuffy',
	'fugal',
	'fuggy',
	'fugie',
	'fugio',
	'fugle',
	'fugly',
	'fugus',
	'fujis',
	'fulls',
	'fumed',
	'fumer',
	'fumes',
	'fumet',
	'fundi',
	'funds',
	'fundy',
	'fungo',
	'fungs',
	'funks',
	'fural',
	'furan',
	'furca',
	'furls',
	'furol',
	'furrs',
	'furth',
	'furze',
	'furzy',
	'fused',
	'fusee',
	'fusel',
	'fuses',
	'fusil',
	'fusks',
	'fusts',
	'fusty',
	'futon',
	'fuzed',
	'fuzee',
	'fuzes',
	'fuzil',
	'fyces',
	'fyked',
	'fykes',
	'fyles',
	'fyrds',
	'fytte',
	'gabba',
	'gabby',
	'gable',
	'gaddi',
	'gades',
	'gadge',
	'gadid',
	'gadis',
	'gadje',
	'gadjo',
	'gadso',
	'gaffs',
	'gaged',
	'gager',
	'gages',
	'gaids',
	'gains',
	'gairs',
	'gaita',
	'gaits',
	'gaitt',
	'gajos',
	'galah',
	'galas',
	'galax',
	'galea',
	'galed',
	'gales',
	'galls',
	'gally',
	'galop',
	'galut',
	'galvo',
	'gamas',
	'gamay',
	'gamba',
	'gambe',
	'gambo',
	'gambs',
	'gamed',
	'games',
	'gamey',
	'gamic',
	'gamin',
	'gamme',
	'gammy',
	'gamps',
	'ganch',
	'gandy',
	'ganef',
	'ganev',
	'gangs',
	'ganja',
	'ganof',
	'gants',
	'gaols',
	'gaped',
	'gaper',
	'gapes',
	'gapos',
	'gappy',
	'garbe',
	'garbo',
	'garbs',
	'garda',
	'gares',
	'garis',
	'garms',
	'garni',
	'garre',
	'garth',
	'garum',
	'gases',
	'gasps',
	'gaspy',
	'gasts',
	'gatch',
	'gated',
	'gater',
	'gates',
	'gaths',
	'gator',
	'gauch',
	'gaucy',
	'gauds',
	'gauje',
	'gault',
	'gaums',
	'gaumy',
	'gaups',
	'gaurs',
	'gauss',
	'gauzy',
	'gavot',
	'gawcy',
	'gawds',
	'gawks',
	'gawps',
	'gawsy',
	'gayal',
	'gazal',
	'gazar',
	'gazed',
	'gazes',
	'gazon',
	'gazoo',
	'geals',
	'geans',
	'geare',
	'gears',
	'geats',
	'gebur',
	'gecks',
	'geeks',
	'geeps',
	'geest',
	'geist',
	'geits',
	'gelds',
	'gelee',
	'gelid',
	'gelly',
	'gelts',
	'gemel',
	'gemma',
	'gemmy',
	'gemot',
	'genal',
	'genas',
	'genes',
	'genet',
	'genic',
	'genii',
	'genip',
	'genny',
	'genoa',
	'genom',
	'genro',
	'gents',
	'genty',
	'genua',
	'genus',
	'geode',
	'geoid',
	'gerah',
	'gerbe',
	'geres',
	'gerle',
	'germs',
	'germy',
	'gerne',
	'gesse',
	'gesso',
	'geste',
	'gests',
	'getas',
	'getup',
	'geums',
	'geyan',
	'geyer',
	'ghast',
	'ghats',
	'ghaut',
	'ghazi',
	'ghees',
	'ghest',
	'ghyll',
	'gibed',
	'gibel',
	'giber',
	'gibes',
	'gibli',
	'gibus',
	'gifts',
	'gigas',
	'gighe',
	'gigot',
	'gigue',
	'gilas',
	'gilds',
	'gilet',
	'gills',
	'gilly',
	'gilpy',
	'gilts',
	'gimel',
	'gimme',
	'gimps',
	'gimpy',
	'ginch',
	'ginge',
	'gings',
	'ginks',
	'ginny',
	'ginzo',
	'gipon',
	'gippo',
	'gippy',
	'girds',
	'girls',
	'girns',
	'giron',
	'giros',
	'girrs',
	'girsh',
	'girts',
	'gismo',
	'gisms',
	'gists',
	'gitch',
	'gites',
	'giust',
	'gived',
	'gives',
	'gizmo',
	'glace',
	'glads',
	'glady',
	'glaik',
	'glair',
	'glams',
	'glans',
	'glary',
	'glaum',
	'glaur',
	'glazy',
	'gleba',
	'glebe',
	'gleby',
	'glede',
	'gleds',
	'gleed',
	'gleek',
	'glees',
	'gleet',
	'gleis',
	'glens',
	'glent',
	'gleys',
	'glial',
	'glias',
	'glibs',
	'gliff',
	'glift',
	'glike',
	'glime',
	'glims',
	'glisk',
	'glits',
	'glitz',
	'gloam',
	'globi',
	'globs',
	'globy',
	'glode',
	'glogg',
	'gloms',
	'gloop',
	'glops',
	'glost',
	'glout',
	'glows',
	'gloze',
	'glued',
	'gluer',
	'glues',
	'gluey',
	'glugs',
	'glume',
	'glums',
	'gluon',
	'glute',
	'gluts',
	'gnarl',
	'gnarr',
	'gnars',
	'gnats',
	'gnawn',
	'gnaws',
	'gnows',
	'goads',
	'goafs',
	'goals',
	'goary',
	'goats',
	'goaty',
	'goban',
	'gobar',
	'gobbi',
	'gobbo',
	'gobby',
	'gobis',
	'gobos',
	'godet',
	'godso',
	'goels',
	'goers',
	'goest',
	'goeth',
	'goety',
	'gofer',
	'goffs',
	'gogga',
	'gogos',
	'goier',
	'gojis',
	'golds',
	'goldy',
	'goles',
	'golfs',
	'golpe',
	'golps',
	'gombo',
	'gomer',
	'gompa',
	'gonch',
	'gonef',
	'gongs',
	'gonia',
	'gonif',
	'gonks',
	'gonna',
	'gonof',
	'gonys',
	'gonzo',
	'gooby',
	'goods',
	'goofs',
	'googs',
	'gooks',
	'gooky',
	'goold',
	'gools',
	'gooly',
	'goons',
	'goony',
	'goops',
	'goopy',
	'goors',
	'goory',
	'goosy',
	'gopak',
	'gopik',
	'goral',
	'goras',
	'gored',
	'gores',
	'goris',
	'gorms',
	'gormy',
	'gorps',
	'gorse',
	'gorsy',
	'gosht',
	'gosse',
	'gotch',
	'goths',
	'gothy',
	'gotta',
	'gouch',
	'gouks',
	'goura',
	'gouts',
	'gouty',
	'gowan',
	'gowds',
	'gowfs',
	'gowks',
	'gowls',
	'gowns',
	'goxes',
	'goyim',
	'goyle',
	'graal',
	'grabs',
	'grads',
	'graff',
	'graip',
	'grama',
	'grame',
	'gramp',
	'grams',
	'grana',
	'grans',
	'grapy',
	'gravs',
	'grays',
	'grebe',
	'grebo',
	'grece',
	'greek',
	'grees',
	'grege',
	'grego',
	'grein',
	'grens',
	'grese',
	'greve',
	'grews',
	'greys',
	'grice',
	'gride',
	'grids',
	'griff',
	'grift',
	'grigs',
	'grike',
	'grins',
	'griot',
	'grips',
	'gript',
	'gripy',
	'grise',
	'grist',
	'grisy',
	'grith',
	'grits',
	'grize',
	'groat',
	'grody',
	'grogs',
	'groks',
	'groma',
	'grone',
	'groof',
	'grosz',
	'grots',
	'grouf',
	'grovy',
	'grows',
	'grrls',
	'grrrl',
	'grubs',
	'grued',
	'grues',
	'grufe',
	'grume',
	'grump',
	'grund',
	'gryce',
	'gryde',
	'gryke',
	'grype',
	'grypt',
	'guaco',
	'guana',
	'guano',
	'guans',
	'guars',
	'gucks',
	'gucky',
	'gudes',
	'guffs',
	'gugas',
	'guids',
	'guimp',
	'guiro',
	'gulag',
	'gular',
	'gulas',
	'gules',
	'gulet',
	'gulfs',
	'gulfy',
	'gulls',
	'gulph',
	'gulps',
	'gulpy',
	'gumma',
	'gummi',
	'gumps',
	'gundy',
	'gunge',
	'gungy',
	'gunks',
	'gunky',
	'gunny',
	'guqin',
	'gurdy',
	'gurge',
	'gurls',
	'gurly',
	'gurns',
	'gurry',
	'gursh',
	'gurus',
	'gushy',
	'gusla',
	'gusle',
	'gusli',
	'gussy',
	'gusts',
	'gutsy',
	'gutta',
	'gutty',
	'guyed',
	'guyle',
	'guyot',
	'guyse',
	'gwine',
	'gyals',
	'gyans',
	'gybed',
	'gybes',
	'gyeld',
	'gymps',
	'gynae',
	'gynie',
	'gynny',
	'gynos',
	'gyoza',
	'gypos',
	'gyppo',
	'gyppy',
	'gyral',
	'gyred',
	'gyres',
	'gyron',
	'gyros',
	'gyrus',
	'gytes',
	'gyved',
	'gyves',
	'haafs',
	'haars',
	'hable',
	'habus',
	'hacek',
	'hacks',
	'hadal',
	'haded',
	'hades',
	'hadji',
	'hadst',
	'haems',
	'haets',
	'haffs',
	'hafiz',
	'hafts',
	'haggs',
	'hahas',
	'haick',
	'haika',
	'haiks',
	'haiku',
	'hails',
	'haily',
	'hains',
	'haint',
	'hairs',
	'haith',
	'hajes',
	'hajis',
	'hajji',
	'hakam',
	'hakas',
	'hakea',
	'hakes',
	'hakim',
	'hakus',
	'halal',
	'haled',
	'haler',
	'hales',
	'halfa',
	'halfs',
	'halid',
	'hallo',
	'halls',
	'halma',
	'halms',
	'halon',
	'halos',
	'halse',
	'halts',
	'halva',
	'halwa',
	'hamal',
	'hamba',
	'hamed',
	'hames',
	'hammy',
	'hamza',
	'hanap',
	'hance',
	'hanch',
	'hands',
	'hangi',
	'hangs',
	'hanks',
	'hanky',
	'hansa',
	'hanse',
	'hants',
	'haole',
	'haoma',
	'hapax',
	'haply',
	'happi',
	'hapus',
	'haram',
	'hards',
	'hared',
	'hares',
	'harim',
	'harks',
	'harls',
	'harms',
	'harns',
	'haros',
	'harps',
	'harts',
	'hashy',
	'hasks',
	'hasps',
	'hasta',
	'hated',
	'hates',
	'hatha',
	'hauds',
	'haufs',
	'haugh',
	'hauld',
	'haulm',
	'hauls',
	'hault',
	'hauns',
	'hause',
	'haver',
	'haves',
	'hawed',
	'hawks',
	'hawms',
	'hawse',
	'hayed',
	'hayer',
	'hayey',
	'hayle',
	'hazan',
	'hazed',
	'hazer',
	'hazes',
	'heads',
	'heald',
	'heals',
	'heame',
	'heaps',
	'heapy',
	'heare',
	'hears',
	'heast',
	'heats',
	'heben',
	'hebes',
	'hecht',
	'hecks',
	'heder',
	'hedgy',
	'heeds',
	'heedy',
	'heels',
	'heeze',
	'hefte',
	'hefts',
	'heids',
	'heigh',
	'heils',
	'heirs',
	'hejab',
	'hejra',
	'heled',
	'heles',
	'helio',
	'hells',
	'helms',
	'helos',
	'helot',
	'helps',
	'helve',
	'hemal',
	'hemes',
	'hemic',
	'hemin',
	'hemps',
	'hempy',
	'hench',
	'hends',
	'henge',
	'henna',
	'henny',
	'henry',
	'hents',
	'hepar',
	'herbs',
	'herby',
	'herds',
	'heres',
	'herls',
	'herma',
	'herms',
	'herns',
	'heros',
	'herry',
	'herse',
	'hertz',
	'herye',
	'hesps',
	'hests',
	'hetes',
	'heths',
	'heuch',
	'heugh',
	'hevea',
	'hewed',
	'hewer',
	'hewgh',
	'hexad',
	'hexed',
	'hexer',
	'hexes',
	'hexyl',
	'heyed',
	'hiant',
	'hicks',
	'hided',
	'hider',
	'hides',
	'hiems',
	'highs',
	'hight',
	'hijab',
	'hijra',
	'hiked',
	'hiker',
	'hikes',
	'hikoi',
	'hilar',
	'hilch',
	'hillo',
	'hills',
	'hilts',
	'hilum',
	'hilus',
	'himbo',
	'hinau',
	'hinds',
	'hings',
	'hinky',
	'hinny',
	'hints',
	'hiois',
	'hiply',
	'hired',
	'hiree',
	'hirer',
	'hires',
	'hissy',
	'hists',
	'hithe',
	'hived',
	'hiver',
	'hives',
	'hizen',
	'hoaed',
	'hoagy',
	'hoars',
	'hoary',
	'hoast',
	'hobos',
	'hocks',
	'hocus',
	'hodad',
	'hodja',
	'hoers',
	'hogan',
	'hogen',
	'hoggs',
	'hoghs',
	'hohed',
	'hoick',
	'hoied',
	'hoiks',
	'hoing',
	'hoise',
	'hokas',
	'hoked',
	'hokes',
	'hokey',
	'hokis',
	'hokku',
	'hokum',
	'holds',
	'holed',
	'holes',
	'holey',
	'holks',
	'holla',
	'hollo',
	'holme',
	'holms',
	'holon',
	'holos',
	'holts',
	'homas',
	'homed',
	'homes',
	'homey',
	'homie',
	'homme',
	'homos',
	'honan',
	'honda',
	'honds',
	'honed',
	'honer',
	'hones',
	'hongi',
	'hongs',
	'honks',
	'honky',
	'hooch',
	'hoods',
	'hoody',
	'hooey',
	'hoofs',
	'hooka',
	'hooks',
	'hooky',
	'hooly',
	'hoons',
	'hoops',
	'hoord',
	'hoors',
	'hoosh',
	'hoots',
	'hooty',
	'hoove',
	'hopak',
	'hoped',
	'hoper',
	'hopes',
	'hoppy',
	'horah',
	'horal',
	'horas',
	'horis',
	'horks',
	'horme',
	'horns',
	'horst',
	'horsy',
	'hosed',
	'hosel',
	'hosen',
	'hoser',
	'hoses',
	'hosey',
	'hosta',
	'hosts',
	'hotch',
	'hoten',
	'hotty',
	'houff',
	'houfs',
	'hough',
	'houri',
	'hours',
	'houts',
	'hovea',
	'hoved',
	'hoven',
	'hoves',
	'howbe',
	'howes',
	'howff',
	'howfs',
	'howks',
	'howls',
	'howre',
	'howso',
	'hoxed',
	'hoxes',
	'hoyas',
	'hoyed',
	'hoyle',
	'hubby',
	'hucks',
	'hudna',
	'hudud',
	'huers',
	'huffs',
	'huffy',
	'huger',
	'huggy',
	'huhus',
	'huias',
	'hulas',
	'hules',
	'hulks',
	'hulky',
	'hullo',
	'hulls',
	'hully',
	'humas',
	'humfs',
	'humic',
	'humps',
	'humpy',
	'hunks',
	'hunts',
	'hurds',
	'hurls',
	'hurly',
	'hurra',
	'hurst',
	'hurts',
	'hushy',
	'husks',
	'husos',
	'hutia',
	'huzza',
	'huzzy',
	'hwyls',
	'hydra',
	'hyens',
	'hygge',
	'hying',
	'hykes',
	'hylas',
	'hyleg',
	'hyles',
	'hylic',
	'hymns',
	'hynde',
	'hyoid',
	'hyped',
	'hypes',
	'hypha',
	'hyphy',
	'hypos',
	'hyrax',
	'hyson',
	'hythe',
	'iambi',
	'iambs',
	'ibrik',
	'icers',
	'iched',
	'iches',
	'ichor',
	'icier',
	'icker',
	'ickle',
	'icons',
	'ictal',
	'ictic',
	'ictus',
	'idant',
	'ideas',
	'idees',
	'ident',
	'idled',
	'idles',
	'idola',
	'idols',
	'idyls',
	'iftar',
	'igapo',
	'igged',
	'iglus',
	'ihram',
	'ikans',
	'ikats',
	'ikons',
	'ileac',
	'ileal',
	'ileum',
	'ileus',
	'iliad',
	'ilial',
	'ilium',
	'iller',
	'illth',
	'imago',
	'imams',
	'imari',
	'imaum',
	'imbar',
	'imbed',
	'imide',
	'imido',
	'imids',
	'imine',
	'imino',
	'immew',
	'immit',
	'immix',
	'imped',
	'impis',
	'impot',
	'impro',
	'imshi',
	'imshy',
	'inapt',
	'inarm',
	'inbye',
	'incel',
	'incle',
	'incog',
	'incus',
	'incut',
	'indew',
	'india',
	'indie',
	'indol',
	'indow',
	'indri',
	'indue',
	'inerm',
	'infix',
	'infos',
	'infra',
	'ingan',
	'ingle',
	'inion',
	'inked',
	'inker',
	'inkle',
	'inned',
	'innit',
	'inorb',
	'inrun',
	'inset',
	'inspo',
	'intel',
	'intil',
	'intis',
	'intra',
	'inula',
	'inure',
	'inurn',
	'inust',
	'invar',
	'inwit',
	'iodic',
	'iodid',
	'iodin',
	'iotas',
	'ippon',
	'irade',
	'irids',
	'iring',
	'irked',
	'iroko',
	'irone',
	'irons',
	'isbas',
	'ishes',
	'isled',
	'isles',
	'isnae',
	'issei',
	'istle',
	'items',
	'ither',
	'ivied',
	'ivies',
	'ixias',
	'ixnay',
	'ixora',
	'ixtle',
	'izard',
	'izars',
	'izzat',
	'jaaps',
	'jabot',
	'jacal',
	'jacks',
	'jacky',
	'jaded',
	'jades',
	'jafas',
	'jaffa',
	'jagas',
	'jager',
	'jaggs',
	'jaggy',
	'jagir',
	'jagra',
	'jails',
	'jaker',
	'jakes',
	'jakey',
	'jalap',
	'jalop',
	'jambe',
	'jambo',
	'jambs',
	'jambu',
	'james',
	'jammy',
	'jamon',
	'janes',
	'janns',
	'janny',
	'janty',
	'japan',
	'japed',
	'japer',
	'japes',
	'jarks',
	'jarls',
	'jarps',
	'jarta',
	'jarul',
	'jasey',
	'jaspe',
	'jasps',
	'jatos',
	'jauks',
	'jaups',
	'javas',
	'javel',
	'jawan',
	'jawed',
	'jaxie',
	'jeans',
	'jeats',
	'jebel',
	'jedis',
	'jeels',
	'jeely',
	'jeeps',
	'jeers',
	'jeeze',
	'jefes',
	'jeffs',
	'jehad',
	'jehus',
	'jelab',
	'jello',
	'jells',
	'jembe',
	'jemmy',
	'jenny',
	'jeons',
	'jerid',
	'jerks',
	'jerry',
	'jesse',
	'jests',
	'jesus',
	'jetes',
	'jeton',
	'jeune',
	'jewed',
	'jewie',
	'jhala',
	'jiaos',
	'jibba',
	'jibbs',
	'jibed',
	'jiber',
	'jibes',
	'jiffs',
	'jiggy',
	'jigot',
	'jihad',
	'jills',
	'jilts',
	'jimmy',
	'jimpy',
	'jingo',
	'jinks',
	'jinne',
	'jinni',
	'jinns',
	'jirds',
	'jirga',
	'jirre',
	'jisms',
	'jived',
	'jiver',
	'jives',
	'jivey',
	'jnana',
	'jobed',
	'jobes',
	'jocko',
	'jocks',
	'jocky',
	'jocos',
	'jodel',
	'joeys',
	'johns',
	'joins',
	'joked',
	'jokes',
	'jokey',
	'jokol',
	'joled',
	'joles',
	'jolls',
	'jolts',
	'jolty',
	'jomon',
	'jomos',
	'jones',
	'jongs',
	'jonty',
	'jooks',
	'joram',
	'jorum',
	'jotas',
	'jotty',
	'jotun',
	'joual',
	'jougs',
	'jouks',
	'joule',
	'jours',
	'jowar',
	'jowed',
	'jowls',
	'jowly',
	'joyed',
	'jubas',
	'jubes',
	'jucos',
	'judas',
	'judgy',
	'judos',
	'jugal',
	'jugum',
	'jujus',
	'juked',
	'jukes',
	'jukus',
	'julep',
	'jumar',
	'jumby',
	'jumps',
	'junco',
	'junks',
	'junky',
	'jupes',
	'jupon',
	'jural',
	'jurat',
	'jurel',
	'jures',
	'justs',
	'jutes',
	'jutty',
	'juves',
	'juvie',
	'kaama',
	'kabab',
	'kabar',
	'kabob',
	'kacha',
	'kacks',
	'kadai',
	'kades',
	'kadis',
	'kafir',
	'kagos',
	'kagus',
	'kahal',
	'kaiak',
	'kaids',
	'kaies',
	'kaifs',
	'kaika',
	'kaiks',
	'kails',
	'kaims',
	'kaing',
	'kains',
	'kakas',
	'kakis',
	'kalam',
	'kales',
	'kalif',
	'kalis',
	'kalpa',
	'kamas',
	'kames',
	'kamik',
	'kamis',
	'kamme',
	'kanae',
	'kanas',
	'kandy',
	'kaneh',
	'kanes',
	'kanga',
	'kangs',
	'kanji',
	'kants',
	'kanzu',
	'kaons',
	'kapas',
	'kaphs',
	'kapok',
	'kapow',
	'kapus',
	'kaput',
	'karas',
	'karat',
	'karks',
	'karns',
	'karoo',
	'karos',
	'karri',
	'karst',
	'karsy',
	'karts',
	'karzy',
	'kasha',
	'kasme',
	'katal',
	'katas',
	'katis',
	'katti',
	'kaugh',
	'kauri',
	'kauru',
	'kaury',
	'kaval',
	'kavas',
	'kawas',
	'kawau',
	'kawed',
	'kayle',
	'kayos',
	'kazis',
	'kazoo',
	'kbars',
	'kebar',
	'kebob',
	'kecks',
	'kedge',
	'kedgy',
	'keech',
	'keefs',
	'keeks',
	'keels',
	'keema',
	'keeno',
	'keens',
	'keeps',
	'keets',
	'keeve',
	'kefir',
	'kehua',
	'keirs',
	'kelep',
	'kelim',
	'kells',
	'kelly',
	'kelps',
	'kelpy',
	'kelts',
	'kelty',
	'kembo',
	'kembs',
	'kemps',
	'kempt',
	'kempy',
	'kenaf',
	'kench',
	'kendo',
	'kenos',
	'kente',
	'kents',
	'kepis',
	'kerbs',
	'kerel',
	'kerfs',
	'kerky',
	'kerma',
	'kerne',
	'kerns',
	'keros',
	'kerry',
	'kerve',
	'kesar',
	'kests',
	'ketas',
	'ketch',
	'ketes',
	'ketol',
	'kevel',
	'kevil',
	'kexes',
	'keyed',
	'keyer',
	'khadi',
	'khafs',
	'khans',
	'khaph',
	'khats',
	'khaya',
	'khazi',
	'kheda',
	'kheth',
	'khets',
	'khoja',
	'khors',
	'khoum',
	'khuds',
	'kiaat',
	'kiack',
	'kiang',
	'kibbe',
	'kibbi',
	'kibei',
	'kibes',
	'kibla',
	'kicks',
	'kicky',
	'kiddo',
	'kiddy',
	'kidel',
	'kidge',
	'kiefs',
	'kiers',
	'kieve',
	'kievs',
	'kight',
	'kikes',
	'kikoi',
	'kiley',
	'kilim',
	'kills',
	'kilns',
	'kilos',
	'kilps',
	'kilts',
	'kilty',
	'kimbo',
	'kinas',
	'kinda',
	'kinds',
	'kindy',
	'kines',
	'kings',
	'kinin',
	'kinks',
	'kinos',
	'kiore',
	'kipes',
	'kippa',
	'kipps',
	'kirby',
	'kirks',
	'kirns',
	'kirri',
	'kisan',
	'kissy',
	'kists',
	'kited',
	'kiter',
	'kites',
	'kithe',
	'kiths',
	'kitul',
	'kivas',
	'kiwis',
	'klang',
	'klaps',
	'klett',
	'klick',
	'klieg',
	'kliks',
	'klong',
	'kloof',
	'kluge',
	'klutz',
	'knags',
	'knaps',
	'knarl',
	'knars',
	'knaur',
	'knawe',
	'knees',
	'knell',
	'knish',
	'knits',
	'knive',
	'knobs',
	'knops',
	'knosp',
	'knots',
	'knout',
	'knowe',
	'knows',
	'knubs',
	'knurl',
	'knurr',
	'knurs',
	'knuts',
	'koans',
	'koaps',
	'koban',
	'kobos',
	'koels',
	'koffs',
	'kofta',
	'kogal',
	'kohas',
	'kohen',
	'kohls',
	'koine',
	'kojis',
	'kokam',
	'kokas',
	'koker',
	'kokra',
	'kokum',
	'kolas',
	'kolos',
	'kombu',
	'konbu',
	'kondo',
	'konks',
	'kooks',
	'kooky',
	'koori',
	'kopek',
	'kophs',
	'kopje',
	'koppa',
	'korai',
	'koras',
	'korat',
	'kores',
	'korma',
	'koros',
	'korun',
	'korus',
	'koses',
	'kotch',
	'kotos',
	'kotow',
	'koura',
	'kraal',
	'krabs',
	'kraft',
	'krais',
	'krait',
	'krang',
	'krans',
	'kranz',
	'kraut',
	'krays',
	'kreep',
	'kreng',
	'krewe',
	'krona',
	'krone',
	'kroon',
	'krubi',
	'krunk',
	'ksars',
	'kubie',
	'kudos',
	'kudus',
	'kudzu',
	'kufis',
	'kugel',
	'kuias',
	'kukri',
	'kukus',
	'kulak',
	'kulan',
	'kulas',
	'kulfi',
	'kumis',
	'kumys',
	'kuris',
	'kurre',
	'kurta',
	'kurus',
	'kusso',
	'kutas',
	'kutch',
	'kutis',
	'kutus',
	'kuzus',
	'kvass',
	'kvell',
	'kwela',
	'kyack',
	'kyaks',
	'kyang',
	'kyars',
	'kyats',
	'kybos',
	'kydst',
	'kyles',
	'kylie',
	'kylin',
	'kylix',
	'kyloe',
	'kynde',
	'kynds',
	'kypes',
	'kyrie',
	'kytes',
	'kythe',
	'laari',
	'labda',
	'labia',
	'labis',
	'labra',
	'laced',
	'lacer',
	'laces',
	'lacet',
	'lacey',
	'lacks',
	'laddy',
	'laded',
	'lader',
	'lades',
	'laers',
	'laevo',
	'lagan',
	'lahal',
	'lahar',
	'laich',
	'laics',
	'laids',
	'laigh',
	'laika',
	'laiks',
	'laird',
	'lairs',
	'lairy',
	'laith',
	'laity',
	'laked',
	'laker',
	'lakes',
	'lakhs',
	'lakin',
	'laksa',
	'laldy',
	'lalls',
	'lamas',
	'lambs',
	'lamby',
	'lamed',
	'lamer',
	'lames',
	'lamia',
	'lammy',
	'lamps',
	'lanai',
	'lanas',
	'lanch',
	'lande',
	'lands',
	'lanes',
	'lanks',
	'lants',
	'lapin',
	'lapis',
	'lapje',
	'larch',
	'lards',
	'lardy',
	'laree',
	'lares',
	'largo',
	'laris',
	'larks',
	'larky',
	'larns',
	'larnt',
	'larum',
	'lased',
	'laser',
	'lases',
	'lassi',
	'lassu',
	'lassy',
	'lasts',
	'latah',
	'lated',
	'laten',
	'latex',
	'lathi',
	'laths',
	'lathy',
	'latke',
	'latus',
	'lauan',
	'lauch',
	'lauds',
	'laufs',
	'laund',
	'laura',
	'laval',
	'lavas',
	'laved',
	'laver',
	'laves',
	'lavra',
	'lavvy',
	'lawed',
	'lawer',
	'lawin',
	'lawks',
	'lawns',
	'lawny',
	'laxed',
	'laxer',
	'laxes',
	'laxly',
	'layed',
	'layin',
	'layup',
	'lazar',
	'lazed',
	'lazes',
	'lazos',
	'lazzi',
	'lazzo',
	'leads',
	'leady',
	'leafs',
	'leaks',
	'leams',
	'leans',
	'leany',
	'leaps',
	'leare',
	'lears',
	'leary',
	'leats',
	'leavy',
	'leaze',
	'leben',
	'leccy',
	'ledes',
	'ledgy',
	'ledum',
	'leear',
	'leeks',
	'leeps',
	'leers',
	'leese',
	'leets',
	'leeze',
	'lefte',
	'lefts',
	'leger',
	'leges',
	'legge',
	'leggo',
	'legit',
	'lehrs',
	'lehua',
	'leirs',
	'leish',
	'leman',
	'lemed',
	'lemel',
	'lemes',
	'lemma',
	'lemme',
	'lends',
	'lenes',
	'lengs',
	'lenis',
	'lenos',
	'lense',
	'lenti',
	'lento',
	'leone',
	'lepid',
	'lepra',
	'lepta',
	'lered',
	'leres',
	'lerps',
	'lesbo',
	'leses',
	'lests',
	'letch',
	'lethe',
	'letup',
	'leuch',
	'leuco',
	'leuds',
	'leugh',
	'levas',
	'levee',
	'leves',
	'levin',
	'levis',
	'lewis',
	'lexes',
	'lexis',
	'lezes',
	'lezza',
	'lezzy',
	'liana',
	'liane',
	'liang',
	'liard',
	'liars',
	'liart',
	'liber',
	'libra',
	'libri',
	'lichi',
	'licht',
	'licit',
	'licks',
	'lidar',
	'lidos',
	'liefs',
	'liens',
	'liers',
	'lieus',
	'lieve',
	'lifer',
	'lifes',
	'lifts',
	'ligan',
	'liger',
	'ligge',
	'ligne',
	'liked',
	'liker',
	'likes',
	'likin',
	'lills',
	'lilos',
	'lilts',
	'liman',
	'limas',
	'limax',
	'limba',
	'limbi',
	'limbs',
	'limby',
	'limed',
	'limen',
	'limes',
	'limey',
	'limma',
	'limns',
	'limos',
	'limpa',
	'limps',
	'linac',
	'linch',
	'linds',
	'lindy',
	'lined',
	'lines',
	'liney',
	'linga',
	'lings',
	'lingy',
	'linin',
	'links',
	'linky',
	'linns',
	'linny',
	'linos',
	'lints',
	'linty',
	'linum',
	'linux',
	'lions',
	'lipas',
	'lipes',
	'lipin',
	'lipos',
	'lippy',
	'liras',
	'lirks',
	'lirot',
	'lisks',
	'lisle',
	'lisps',
	'lists',
	'litai',
	'litas',
	'lited',
	'liter',
	'lites',
	'litho',
	'liths',
	'litre',
	'lived',
	'liven',
	'lives',
	'livor',
	'livre',
	'llano',
	'loach',
	'loads',
	'loafs',
	'loams',
	'loans',
	'loast',
	'loave',
	'lobar',
	'lobed',
	'lobes',
	'lobos',
	'lobus',
	'loche',
	'lochs',
	'locie',
	'locis',
	'locks',
	'locos',
	'locum',
	'loden',
	'lodes',
	'loess',
	'lofts',
	'logan',
	'loges',
	'loggy',
	'logia',
	'logie',
	'logoi',
	'logon',
	'logos',
	'lohan',
	'loids',
	'loins',
	'loipe',
	'loirs',
	'lokes',
	'lolls',
	'lolly',
	'lolog',
	'lomas',
	'lomed',
	'lomes',
	'loner',
	'longa',
	'longe',
	'longs',
	'looby',
	'looed',
	'looey',
	'loofa',
	'loofs',
	'looie',
	'looks',
	'looky',
	'looms',
	'loons',
	'loony',
	'loops',
	'loord',
	'loots',
	'loped',
	'loper',
	'lopes',
	'loppy',
	'loral',
	'loran',
	'lords',
	'lordy',
	'lorel',
	'lores',
	'loric',
	'loris',
	'losed',
	'losel',
	'losen',
	'loses',
	'lossy',
	'lotah',
	'lotas',
	'lotes',
	'lotic',
	'lotos',
	'lotsa',
	'lotta',
	'lotte',
	'lotto',
	'lotus',
	'loued',
	'lough',
	'louie',
	'louis',
	'louma',
	'lound',
	'louns',
	'loupe',
	'loups',
	'loure',
	'lours',
	'loury',
	'louts',
	'lovat',
	'loved',
	'loves',
	'lovey',
	'lovie',
	'lowan',
	'lowed',
	'lowes',
	'lownd',
	'lowne',
	'lowns',
	'lowps',
	'lowry',
	'lowse',
	'lowts',
	'loxed',
	'loxes',
	'lozen',
	'luach',
	'luaus',
	'lubed',
	'lubes',
	'lubra',
	'luces',
	'lucks',
	'lucre',
	'ludes',
	'ludic',
	'ludos',
	'luffa',
	'luffs',
	'luged',
	'luger',
	'luges',
	'lulls',
	'lulus',
	'lumas',
	'lumbi',
	'lumme',
	'lummy',
	'lumps',
	'lunas',
	'lunes',
	'lunet',
	'lungi',
	'lungs',
	'lunks',
	'lunts',
	'lupin',
	'lured',
	'lurer',
	'lures',
	'lurex',
	'lurgi',
	'lurgy',
	'lurks',
	'lurry',
	'lurve',
	'luser',
	'lushy',
	'lusks',
	'lusts',
	'lusus',
	'lutea',
	'luted',
	'luter',
	'lutes',
	'luvvy',
	'luxed',
	'luxer',
	'luxes',
	'lweis',
	'lyams',
	'lyard',
	'lyart',
	'lyase',
	'lycea',
	'lycee',
	'lycra',
	'lymes',
	'lynes',
	'lyres',
	'lysed',
	'lyses',
	'lysin',
	'lysis',
	'lysol',
	'lyssa',
	'lyted',
	'lytes',
	'lythe',
	'lytic',
	'lytta',
	'maaed',
	'maare',
	'maars',
	'mabes',
	'macas',
	'maced',
	'macer',
	'maces',
	'mache',
	'machi',
	'machs',
	'macks',
	'macle',
	'macon',
	'madge',
	'madid',
	'madre',
	'maerl',
	'mafic',
	'mages',
	'maggs',
	'magot',
	'magus',
	'mahoe',
	'mahua',
	'mahwa',
	'maids',
	'maiko',
	'maiks',
	'maile',
	'maill',
	'mails',
	'maims',
	'mains',
	'maire',
	'mairs',
	'maise',
	'maist',
	'makar',
	'makes',
	'makis',
	'makos',
	'malam',
	'malar',
	'malas',
	'malax',
	'males',
	'malic',
	'malik',
	'malis',
	'malls',
	'malms',
	'malmy',
	'malts',
	'malty',
	'malus',
	'malva',
	'malwa',
	'mamas',
	'mamba',
	'mamee',
	'mamey',
	'mamie',
	'manas',
	'manat',
	'mandi',
	'maneb',
	'maned',
	'maneh',
	'manes',
	'manet',
	'mangs',
	'manis',
	'manky',
	'manna',
	'manos',
	'manse',
	'manta',
	'manto',
	'manty',
	'manul',
	'manus',
	'mapau',
	'maqui',
	'marae',
	'marah',
	'maras',
	'marcs',
	'mardy',
	'mares',
	'marge',
	'margs',
	'maria',
	'marid',
	'marka',
	'marks',
	'marle',
	'marls',
	'marly',
	'marms',
	'maron',
	'maror',
	'marra',
	'marri',
	'marse',
	'marts',
	'marvy',
	'masas',
	'mased',
	'maser',
	'mases',
	'mashy',
	'masks',
	'massa',
	'massy',
	'masts',
	'masty',
	'masus',
	'matai',
	'mated',
	'mater',
	'mates',
	'maths',
	'matin',
	'matlo',
	'matte',
	'matts',
	'matza',
	'matzo',
	'mauby',
	'mauds',
	'mauls',
	'maund',
	'mauri',
	'mausy',
	'mauts',
	'mauzy',
	'maven',
	'mavie',
	'mavin',
	'mavis',
	'mawed',
	'mawks',
	'mawky',
	'mawns',
	'mawrs',
	'maxed',
	'maxes',
	'maxis',
	'mayan',
	'mayas',
	'mayed',
	'mayos',
	'mayst',
	'mazed',
	'mazer',
	'mazes',
	'mazey',
	'mazut',
	'mbira',
	'meads',
	'meals',
	'meane',
	'means',
	'meany',
	'meare',
	'mease',
	'meath',
	'meats',
	'mebos',
	'mechs',
	'mecks',
	'medii',
	'medle',
	'meeds',
	'meers',
	'meets',
	'meffs',
	'meins',
	'meint',
	'meiny',
	'meith',
	'mekka',
	'melas',
	'melba',
	'melds',
	'melic',
	'melik',
	'mells',
	'melts',
	'melty',
	'memes',
	'memos',
	'menad',
	'mends',
	'mened',
	'menes',
	'menge',
	'mengs',
	'mensa',
	'mense',
	'mensh',
	'menta',
	'mento',
	'menus',
	'meous',
	'meows',
	'merch',
	'mercs',
	'merde',
	'mered',
	'merel',
	'merer',
	'meres',
	'meril',
	'meris',
	'merks',
	'merle',
	'merls',
	'merse',
	'mesal',
	'mesas',
	'mesel',
	'meses',
	'meshy',
	'mesic',
	'mesne',
	'meson',
	'messy',
	'mesto',
	'meted',
	'metes',
	'metho',
	'meths',
	'metic',
	'metif',
	'metis',
	'metol',
	'metre',
	'meuse',
	'meved',
	'meves',
	'mewed',
	'mewls',
	'meynt',
	'mezes',
	'mezze',
	'mezzo',
	'mhorr',
	'miaou',
	'miaow',
	'miasm',
	'miaul',
	'micas',
	'miche',
	'micht',
	'micks',
	'micky',
	'micos',
	'micra',
	'middy',
	'midgy',
	'midis',
	'miens',
	'mieve',
	'miffs',
	'miffy',
	'mifty',
	'miggs',
	'mihas',
	'mihis',
	'miked',
	'mikes',
	'mikra',
	'mikva',
	'milch',
	'milds',
	'miler',
	'miles',
	'milfs',
	'milia',
	'milko',
	'milks',
	'mille',
	'mills',
	'milor',
	'milos',
	'milpa',
	'milts',
	'milty',
	'miltz',
	'mimed',
	'mimeo',
	'mimer',
	'mimes',
	'mimsy',
	'minae',
	'minar',
	'minas',
	'mincy',
	'minds',
	'mined',
	'mines',
	'minge',
	'mings',
	'mingy',
	'minis',
	'minke',
	'minks',
	'minny',
	'minos',
	'mints',
	'mired',
	'mires',
	'mirex',
	'mirid',
	'mirin',
	'mirks',
	'mirky',
	'mirly',
	'miros',
	'mirvs',
	'mirza',
	'misch',
	'misdo',
	'mises',
	'misgo',
	'misos',
	'missa',
	'mists',
	'misty',
	'mitch',
	'miter',
	'mites',
	'mitis',
	'mitre',
	'mitts',
	'mixed',
	'mixen',
	'mixer',
	'mixes',
	'mixte',
	'mixup',
	'mizen',
	'mizzy',
	'mneme',
	'moans',
	'moats',
	'mobby',
	'mobes',
	'mobey',
	'mobie',
	'moble',
	'mochi',
	'mochs',
	'mochy',
	'mocks',
	'moder',
	'modes',
	'modge',
	'modii',
	'modus',
	'moers',
	'mofos',
	'moggy',
	'mohel',
	'mohos',
	'mohrs',
	'mohua',
	'mohur',
	'moile',
	'moils',
	'moira',
	'moire',
	'moits',
	'mojos',
	'mokes',
	'mokis',
	'mokos',
	'molal',
	'molas',
	'molds',
	'moled',
	'moles',
	'molla',
	'molls',
	'molly',
	'molto',
	'molts',
	'molys',
	'momes',
	'momma',
	'mommy',
	'momus',
	'monad',
	'monal',
	'monas',
	'monde',
	'mondo',
	'moner',
	'mongo',
	'mongs',
	'monic',
	'monie',
	'monks',
	'monos',
	'monte',
	'monty',
	'moobs',
	'mooch',
	'moods',
	'mooed',
	'mooks',
	'moola',
	'mooli',
	'mools',
	'mooly',
	'moong',
	'moons',
	'moony',
	'moops',
	'moors',
	'moory',
	'moots',
	'moove',
	'moped',
	'moper',
	'mopes',
	'mopey',
	'moppy',
	'mopsy',
	'mopus',
	'morae',
	'moras',
	'morat',
	'moray',
	'morel',
	'mores',
	'moria',
	'morne',
	'morns',
	'morra',
	'morro',
	'morse',
	'morts',
	'mosed',
	'moses',
	'mosey',
	'mosks',
	'mosso',
	'moste',
	'mosts',
	'moted',
	'moten',
	'motes',
	'motet',
	'motey',
	'moths',
	'mothy',
	'motis',
	'motte',
	'motts',
	'motty',
	'motus',
	'motza',
	'mouch',
	'moues',
	'mould',
	'mouls',
	'moups',
	'moust',
	'mousy',
	'moved',
	'moves',
	'mowas',
	'mowed',
	'mowra',
	'moxas',
	'moxie',
	'moyas',
	'moyle',
	'moyls',
	'mozed',
	'mozes',
	'mozos',
	'mpret',
	'mucho',
	'mucic',
	'mucid',
	'mucin',
	'mucks',
	'mucor',
	'mucro',
	'mudge',
	'mudir',
	'mudra',
	'muffs',
	'mufti',
	'mugga',
	'muggs',
	'muggy',
	'muhly',
	'muids',
	'muils',
	'muirs',
	'muist',
	'mujik',
	'mulct',
	'muled',
	'mules',
	'muley',
	'mulga',
	'mulie',
	'mulla',
	'mulls',
	'mulse',
	'mulsh',
	'mumms',
	'mumps',
	'mumsy',
	'mumus',
	'munga',
	'munge',
	'mungo',
	'mungs',
	'munis',
	'munts',
	'muntu',
	'muons',
	'muras',
	'mured',
	'mures',
	'murex',
	'murid',
	'murks',
	'murls',
	'murly',
	'murra',
	'murre',
	'murri',
	'murrs',
	'murry',
	'murti',
	'murva',
	'musar',
	'musca',
	'mused',
	'muser',
	'muses',
	'muset',
	'musha',
	'musit',
	'musks',
	'musos',
	'musse',
	'mussy',
	'musth',
	'musts',
	'mutch',
	'muted',
	'muter',
	'mutes',
	'mutha',
	'mutis',
	'muton',
	'mutts',
	'muxed',
	'muxes',
	'muzak',
	'muzzy',
	'mvule',
	'myall',
	'mylar',
	'mynah',
	'mynas',
	'myoid',
	'myoma',
	'myope',
	'myops',
	'myopy',
	'mysid',
	'mythi',
	'myths',
	'mythy',
	'myxos',
	'mzees',
	'naams',
	'naans',
	'nabes',
	'nabis',
	'nabks',
	'nabla',
	'nabob',
	'nache',
	'nacho',
	'nacre',
	'nadas',
	'naeve',
	'naevi',
	'naffs',
	'nagas',
	'naggy',
	'nagor',
	'nahal',
	'naiad',
	'naifs',
	'naiks',
	'nails',
	'naira',
	'nairu',
	'naked',
	'naker',
	'nakfa',
	'nalas',
	'naled',
	'nalla',
	'named',
	'namer',
	'names',
	'namma',
	'namus',
	'nanas',
	'nance',
	'nancy',
	'nandu',
	'nanna',
	'nanos',
	'nanua',
	'napas',
	'naped',
	'napes',
	'napoo',
	'nappa',
	'nappe',
	'nappy',
	'naras',
	'narco',
	'narcs',
	'nards',
	'nares',
	'naric',
	'naris',
	'narks',
	'narky',
	'narre',
	'nashi',
	'natch',
	'nates',
	'natis',
	'natty',
	'nauch',
	'naunt',
	'navar',
	'naves',
	'navew',
	'navvy',
	'nawab',
	'nazes',
	'nazir',
	'nazis',
	'nduja',
	'neafe',
	'neals',
	'neaps',
	'nears',
	'neath',
	'neats',
	'nebek',
	'nebel',
	'necks',
	'neddy',
	'needs',
	'neeld',
	'neele',
	'neemb',
	'neems',
	'neeps',
	'neese',
	'neeze',
	'negro',
	'negus',
	'neifs',
	'neist',
	'neive',
	'nelis',
	'nelly',
	'nemas',
	'nemns',
	'nempt',
	'nenes',
	'neons',
	'neper',
	'nepit',
	'neral',
	'nerds',
	'nerka',
	'nerks',
	'nerol',
	'nerts',
	'nertz',
	'nervy',
	'nests',
	'netes',
	'netop',
	'netts',
	'netty',
	'neuks',
	'neume',
	'neums',
	'nevel',
	'neves',
	'nevus',
	'newbs',
	'newed',
	'newel',
	'newie',
	'newsy',
	'newts',
	'nexts',
	'nexus',
	'ngaio',
	'ngana',
	'ngati',
	'ngoma',
	'ngwee',
	'nicad',
	'nicht',
	'nicks',
	'nicol',
	'nidal',
	'nided',
	'nides',
	'nidor',
	'nidus',
	'niefs',
	'nieve',
	'nifes',
	'niffs',
	'niffy',
	'nifty',
	'niger',
	'nighs',
	'nihil',
	'nikab',
	'nikah',
	'nikau',
	'nills',
	'nimbi',
	'nimbs',
	'nimps',
	'niner',
	'nines',
	'ninon',
	'nipas',
	'nippy',
	'niqab',
	'nirls',
	'nirly',
	'nisei',
	'nisse',
	'nisus',
	'niter',
	'nites',
	'nitid',
	'niton',
	'nitre',
	'nitro',
	'nitry',
	'nitty',
	'nival',
	'nixed',
	'nixer',
	'nixes',
	'nixie',
	'nizam',
	'nkosi',
	'noahs',
	'nobby',
	'nocks',
	'nodal',
	'noddy',
	'nodes',
	'nodus',
	'noels',
	'noggs',
	'nohow',
	'noils',
	'noily',
	'noint',
	'noirs',
	'noles',
	'nolls',
	'nolos',
	'nomas',
	'nomen',
	'nomes',
	'nomic',
	'nomoi',
	'nomos',
	'nonas',
	'nonce',
	'nones',
	'nonet',
	'nongs',
	'nonis',
	'nonny',
	'nonyl',
	'noobs',
	'nooit',
	'nooks',
	'nooky',
	'noons',
	'noops',
	'nopal',
	'noria',
	'noris',
	'norks',
	'norma',
	'norms',
	'nosed',
	'noser',
	'noses',
	'notal',
	'noted',
	'noter',
	'notes',
	'notum',
	'nould',
	'noule',
	'nouls',
	'nouns',
	'nouny',
	'noups',
	'novae',
	'novas',
	'novum',
	'noway',
	'nowed',
	'nowls',
	'nowts',
	'nowty',
	'noxal',
	'noxes',
	'noyau',
	'noyed',
	'noyes',
	'nubby',
	'nubia',
	'nucha',
	'nuddy',
	'nuder',
	'nudes',
	'nudie',
	'nudzh',
	'nuffs',
	'nugae',
	'nuked',
	'nukes',
	'nulla',
	'nulls',
	'numbs',
	'numen',
	'nummy',
	'nunny',
	'nurds',
	'nurdy',
	'nurls',
	'nurrs',
	'nutso',
	'nutsy',
	'nyaff',
	'nyala',
	'nying',
	'nyssa',
	'oaked',
	'oaker',
	'oakum',
	'oared',
	'oases',
	'oasis',
	'oasts',
	'oaten',
	'oater',
	'oaths',
	'oaves',
	'obang',
	'obeah',
	'obeli',
	'obeys',
	'obias',
	'obied',
	'obiit',
	'obits',
	'objet',
	'oboes',
	'obole',
	'oboli',
	'obols',
	'occam',
	'ocher',
	'oches',
	'ochre',
	'ochry',
	'ocker',
	'ocrea',
	'octad',
	'octan',
	'octas',
	'octyl',
	'oculi',
	'odahs',
	'odals',
	'odeon',
	'odeum',
	'odism',
	'odist',
	'odium',
	'odors',
	'odour',
	'odyle',
	'odyls',
	'ofays',
	'offed',
	'offie',
	'oflag',
	'ofter',
	'ogams',
	'ogeed',
	'ogees',
	'oggin',
	'ogham',
	'ogive',
	'ogled',
	'ogler',
	'ogles',
	'ogmic',
	'ogres',
	'ohias',
	'ohing',
	'ohmic',
	'ohone',
	'oidia',
	'oiled',
	'oiler',
	'oinks',
	'oints',
	'ojime',
	'okapi',
	'okays',
	'okehs',
	'okras',
	'oktas',
	'oldie',
	'oleic',
	'olein',
	'olent',
	'oleos',
	'oleum',
	'olios',
	'ollas',
	'ollav',
	'oller',
	'ollie',
	'ology',
	'olpae',
	'olpes',
	'omasa',
	'omber',
	'ombus',
	'omens',
	'omers',
	'omits',
	'omlah',
	'omovs',
	'omrah',
	'oncer',
	'onces',
	'oncet',
	'oncus',
	'onely',
	'oners',
	'onery',
	'onium',
	'onkus',
	'onlay',
	'onned',
	'ontic',
	'oobit',
	'oohed',
	'oomph',
	'oonts',
	'ooped',
	'oorie',
	'ooses',
	'ootid',
	'oozed',
	'oozes',
	'opahs',
	'opals',
	'opens',
	'opepe',
	'oping',
	'oppos',
	'opsin',
	'opted',
	'opter',
	'orach',
	'oracy',
	'orals',
	'orang',
	'orant',
	'orate',
	'orbed',
	'orcas',
	'orcin',
	'ordos',
	'oread',
	'orfes',
	'orgia',
	'orgic',
	'orgue',
	'oribi',
	'oriel',
	'orixa',
	'orles',
	'orlon',
	'orlop',
	'ormer',
	'ornis',
	'orpin',
	'orris',
	'ortho',
	'orval',
	'orzos',
	'oscar',
	'oshac',
	'osier',
	'osmic',
	'osmol',
	'ossia',
	'ostia',
	'otaku',
	'otary',
	'ottar',
	'ottos',
	'oubit',
	'oucht',
	'ouens',
	'ouija',
	'oulks',
	'oumas',
	'oundy',
	'oupas',
	'ouped',
	'ouphe',
	'ouphs',
	'ourie',
	'ousel',
	'ousts',
	'outby',
	'outed',
	'outre',
	'outro',
	'outta',
	'ouzel',
	'ouzos',
	'ovals',
	'ovels',
	'ovens',
	'overs',
	'ovist',
	'ovoli',
	'ovolo',
	'ovule',
	'owche',
	'owies',
	'owled',
	'owler',
	'owlet',
	'owned',
	'owres',
	'owrie',
	'owsen',
	'oxbow',
	'oxers',
	'oxeye',
	'oxids',
	'oxies',
	'oxime',
	'oxims',
	'oxlip',
	'oxter',
	'oyers',
	'ozeki',
	'ozzie',
	'paals',
	'paans',
	'pacas',
	'paced',
	'pacer',
	'paces',
	'pacey',
	'pacha',
	'packs',
	'pacos',
	'pacta',
	'pacts',
	'padis',
	'padle',
	'padma',
	'padre',
	'padri',
	'paean',
	'paedo',
	'paeon',
	'paged',
	'pager',
	'pages',
	'pagle',
	'pagod',
	'pagri',
	'paiks',
	'pails',
	'pains',
	'paire',
	'pairs',
	'paisa',
	'paise',
	'pakka',
	'palas',
	'palay',
	'palea',
	'paled',
	'pales',
	'palet',
	'palis',
	'palki',
	'palla',
	'palls',
	'pally',
	'palms',
	'palmy',
	'palpi',
	'palps',
	'palsa',
	'pampa',
	'panax',
	'pance',
	'panda',
	'pands',
	'pandy',
	'paned',
	'panes',
	'panga',
	'pangs',
	'panim',
	'panko',
	'panne',
	'panni',
	'panto',
	'pants',
	'panty',
	'paoli',
	'paolo',
	'papas',
	'papaw',
	'papes',
	'pappi',
	'pappy',
	'parae',
	'paras',
	'parch',
	'pardi',
	'pards',
	'pardy',
	'pared',
	'paren',
	'pareo',
	'pares',
	'pareu',
	'parev',
	'parge',
	'pargo',
	'paris',
	'parki',
	'parks',
	'parky',
	'parle',
	'parly',
	'parma',
	'parol',
	'parps',
	'parra',
	'parrs',
	'parti',
	'parts',
	'parve',
	'parvo',
	'paseo',
	'pases',
	'pasha',
	'pashm',
	'paska',
	'paspy',
	'passe',
	'pasts',
	'pated',
	'paten',
	'pater',
	'pates',
	'paths',
	'patin',
	'patka',
	'patly',
	'patte',
	'patus',
	'pauas',
	'pauls',
	'pavan',
	'paved',
	'paven',
	'paver',
	'paves',
	'pavid',
	'pavin',
	'pavis',
	'pawas',
	'pawaw',
	'pawed',
	'pawer',
	'pawks',
	'pawky',
	'pawls',
	'pawns',
	'paxes',
	'payed',
	'payor',
	'paysd',
	'peage',
	'peags',
	'peaks',
	'peaky',
	'peals',
	'peans',
	'peare',
	'pears',
	'peart',
	'pease',
	'peats',
	'peaty',
	'peavy',
	'peaze',
	'pebas',
	'pechs',
	'pecke',
	'pecks',
	'pecky',
	'pedes',
	'pedis',
	'pedro',
	'peece',
	'peeks',
	'peels',
	'peens',
	'peeoy',
	'peepe',
	'peeps',
	'peers',
	'peery',
	'peeve',
	'peggy',
	'peghs',
	'peins',
	'peise',
	'peize',
	'pekan',
	'pekes',
	'pekin',
	'pekoe',
	'pelas',
	'pelau',
	'peles',
	'pelfs',
	'pells',
	'pelma',
	'pelon',
	'pelta',
	'pelts',
	'pends',
	'pendu',
	'pened',
	'penes',
	'pengo',
	'penie',
	'penis',
	'penks',
	'penna',
	'penni',
	'pents',
	'peons',
	'peony',
	'pepla',
	'pepos',
	'peppy',
	'pepsi',
	'perai',
	'perce',
	'percs',
	'perdu',
	'perdy',
	'perea',
	'peres',
	'peris',
	'perks',
	'perms',
	'perns',
	'perog',
	'perps',
	'perry',
	'perse',
	'perst',
	'perts',
	'perve',
	'pervo',
	'pervs',
	'pervy',
	'pesos',
	'pests',
	'pesty',
	'petar',
	'peter',
	'petit',
	'petre',
	'petri',
	'petti',
	'petto',
	'pewee',
	'pewit',
	'peyse',
	'phage',
	'phang',
	'phare',
	'pharm',
	'pheer',
	'phene',
	'pheon',
	'phese',
	'phial',
	'phish',
	'phizz',
	'phlox',
	'phoca',
	'phono',
	'phons',
	'phots',
	'phpht',
	'phuts',
	'phyla',
	'phyle',
	'piani',
	'pians',
	'pibal',
	'pical',
	'picas',
	'piccy',
	'picks',
	'picot',
	'picra',
	'picul',
	'piend',
	'piers',
	'piert',
	'pieta',
	'piets',
	'piezo',
	'pight',
	'pigmy',
	'piing',
	'pikas',
	'pikau',
	'piked',
	'piker',
	'pikes',
	'pikey',
	'pikis',
	'pikul',
	'pilae',
	'pilaf',
	'pilao',
	'pilar',
	'pilau',
	'pilaw',
	'pilch',
	'pilea',
	'piled',
	'pilei',
	'piler',
	'piles',
	'pilis',
	'pills',
	'pilow',
	'pilum',
	'pilus',
	'pimas',
	'pimps',
	'pinas',
	'pined',
	'pines',
	'pingo',
	'pings',
	'pinko',
	'pinks',
	'pinna',
	'pinny',
	'pinon',
	'pinot',
	'pinta',
	'pints',
	'pinup',
	'pions',
	'piony',
	'pious',
	'pioye',
	'pioys',
	'pipal',
	'pipas',
	'piped',
	'pipes',
	'pipet',
	'pipis',
	'pipit',
	'pippy',
	'pipul',
	'pirai',
	'pirls',
	'pirns',
	'pirog',
	'pisco',
	'pises',
	'pisky',
	'pisos',
	'pissy',
	'piste',
	'pitas',
	'piths',
	'piton',
	'pitot',
	'pitta',
	'piums',
	'pixes',
	'pized',
	'pizes',
	'plaas',
	'plack',
	'plage',
	'plans',
	'plaps',
	'plash',
	'plasm',
	'plast',
	'plats',
	'platt',
	'platy',
	'playa',
	'plays',
	'pleas',
	'plebe',
	'plebs',
	'plena',
	'pleon',
	'plesh',
	'plews',
	'plica',
	'plies',
	'plims',
	'pling',
	'plink',
	'ploat',
	'plods',
	'plong',
	'plonk',
	'plook',
	'plops',
	'plots',
	'plotz',
	'plouk',
	'plows',
	'ploye',
	'ploys',
	'plues',
	'pluff',
	'plugs',
	'plums',
	'plumy',
	'pluot',
	'pluto',
	'plyer',
	'poach',
	'poaka',
	'poake',
	'poboy',
	'pocks',
	'pocky',
	'podal',
	'poddy',
	'podex',
	'podge',
	'podgy',
	'podia',
	'poems',
	'poeps',
	'poets',
	'pogey',
	'pogge',
	'pogos',
	'pohed',
	'poilu',
	'poind',
	'pokal',
	'poked',
	'pokes',
	'pokey',
	'pokie',
	'poled',
	'poler',
	'poles',
	'poley',
	'polio',
	'polis',
	'polje',
	'polks',
	'polls',
	'polly',
	'polos',
	'polts',
	'polys',
	'pombe',
	'pomes',
	'pommy',
	'pomos',
	'pomps',
	'ponce',
	'poncy',
	'ponds',
	'pones',
	'poney',
	'ponga',
	'pongo',
	'pongs',
	'pongy',
	'ponks',
	'ponts',
	'ponty',
	'ponzu',
	'poods',
	'pooed',
	'poofs',
	'poofy',
	'poohs',
	'pooja',
	'pooka',
	'pooks',
	'pools',
	'poons',
	'poops',
	'poopy',
	'poori',
	'poort',
	'poots',
	'poove',
	'poovy',
	'popes',
	'poppa',
	'popsy',
	'porae',
	'poral',
	'pored',
	'porer',
	'pores',
	'porge',
	'porgy',
	'porin',
	'porks',
	'porky',
	'porno',
	'porns',
	'porny',
	'porta',
	'ports',
	'porty',
	'posed',
	'poses',
	'posey',
	'posho',
	'posts',
	'potae',
	'potch',
	'poted',
	'potes',
	'potin',
	'potoo',
	'potsy',
	'potto',
	'potts',
	'potty',
	'pouff',
	'poufs',
	'pouke',
	'pouks',
	'poule',
	'poulp',
	'poult',
	'poupe',
	'poupt',
	'pours',
	'pouts',
	'powan',
	'powin',
	'pownd',
	'powns',
	'powny',
	'powre',
	'poxed',
	'poxes',
	'poynt',
	'poyou',
	'poyse',
	'pozzy',
	'praam',
	'prads',
	'prahu',
	'prams',
	'prana',
	'prang',
	'praos',
	'prase',
	'prate',
	'prats',
	'pratt',
	'praty',
	'praus',
	'prays',
	'predy',
	'preed',
	'prees',
	'preif',
	'prems',
	'premy',
	'prent',
	'preon',
	'preop',
	'preps',
	'presa',
	'prese',
	'prest',
	'preve',
	'prexy',
	'preys',
	'prial',
	'pricy',
	'prief',
	'prier',
	'pries',
	'prigs',
	'prill',
	'prima',
	'primi',
	'primp',
	'prims',
	'primy',
	'prink',
	'prion',
	'prise',
	'priss',
	'proas',
	'probs',
	'prods',
	'proem',
	'profs',
	'progs',
	'proin',
	'proke',
	'prole',
	'proll',
	'promo',
	'proms',
	'pronk',
	'props',
	'prore',
	'proso',
	'pross',
	'prost',
	'prosy',
	'proto',
	'proul',
	'prows',
	'proyn',
	'prunt',
	'pruta',
	'pryer',
	'pryse',
	'pseud',
	'pshaw',
	'psion',
	'psoae',
	'psoai',
	'psoas',
	'psora',
	'psych',
	'psyop',
	'pubco',
	'pubes',
	'pubis',
	'pucan',
	'pucer',
	'puces',
	'pucka',
	'pucks',
	'puddy',
	'pudge',
	'pudic',
	'pudor',
	'pudsy',
	'pudus',
	'puers',
	'puffa',
	'puffs',
	'puggy',
	'pugil',
	'puhas',
	'pujah',
	'pujas',
	'pukas',
	'puked',
	'puker',
	'pukes',
	'pukey',
	'pukka',
	'pukus',
	'pulao',
	'pulas',
	'puled',
	'puler',
	'pules',
	'pulik',
	'pulis',
	'pulka',
	'pulks',
	'pulli',
	'pulls',
	'pully',
	'pulmo',
	'pulps',
	'pulus',
	'pumas',
	'pumie',
	'pumps',
	'punas',
	'punce',
	'punga',
	'pungs',
	'punji',
	'punka',
	'punks',
	'punky',
	'punny',
	'punto',
	'punts',
	'punty',
	'pupae',
	'pupas',
	'pupus',
	'purda',
	'pured',
	'pures',
	'purin',
	'puris',
	'purls',
	'purpy',
	'purrs',
	'pursy',
	'purty',
	'puses',
	'pusle',
	'pussy',
	'putid',
	'puton',
	'putti',
	'putto',
	'putts',
	'puzel',
	'pwned',
	'pyats',
	'pyets',
	'pygal',
	'pyins',
	'pylon',
	'pyned',
	'pynes',
	'pyoid',
	'pyots',
	'pyral',
	'pyran',
	'pyres',
	'pyrex',
	'pyric',
	'pyros',
	'pyxed',
	'pyxes',
	'pyxie',
	'pyxis',
	'pzazz',
	'qadis',
	'qaids',
	'qajaq',
	'qanat',
	'qapik',
	'qibla',
	'qophs',
	'qorma',
	'quads',
	'quaff',
	'quags',
	'quair',
	'quais',
	'quaky',
	'quale',
	'quant',
	'quare',
	'quass',
	'quate',
	'quats',
	'quayd',
	'quays',
	'qubit',
	'quean',
	'queme',
	'quena',
	'quern',
	'queyn',
	'queys',
	'quich',
	'quids',
	'quiff',
	'quims',
	'quina',
	'quine',
	'quino',
	'quins',
	'quint',
	'quipo',
	'quips',
	'quipu',
	'quire',
	'quirt',
	'quist',
	'quits',
	'quoad',
	'quods',
	'quoif',
	'quoin',
	'quoit',
	'quoll',
	'quonk',
	'quops',
	'qursh',
	'quyte',
	'rabat',
	'rabic',
	'rabis',
	'raced',
	'races',
	'rache',
	'racks',
	'racon',
	'radge',
	'radix',
	'radon',
	'raffs',
	'rafts',
	'ragas',
	'ragde',
	'raged',
	'ragee',
	'rager',
	'rages',
	'ragga',
	'raggs',
	'raggy',
	'ragis',
	'ragus',
	'rahed',
	'rahui',
	'raias',
	'raids',
	'raiks',
	'raile',
	'rails',
	'raine',
	'rains',
	'raird',
	'raita',
	'raits',
	'rajas',
	'rajes',
	'raked',
	'rakee',
	'raker',
	'rakes',
	'rakia',
	'rakis',
	'rakus',
	'rales',
	'ramal',
	'ramee',
	'ramet',
	'ramie',
	'ramin',
	'ramis',
	'rammy',
	'ramps',
	'ramus',
	'ranas',
	'rance',
	'rands',
	'ranee',
	'ranga',
	'rangi',
	'rangs',
	'rangy',
	'ranid',
	'ranis',
	'ranke',
	'ranks',
	'rants',
	'raped',
	'raper',
	'rapes',
	'raphe',
	'rappe',
	'rared',
	'raree',
	'rares',
	'rarks',
	'rased',
	'raser',
	'rases',
	'rasps',
	'rasse',
	'rasta',
	'ratal',
	'ratan',
	'ratas',
	'ratch',
	'rated',
	'ratel',
	'rater',
	'rates',
	'ratha',
	'rathe',
	'raths',
	'ratoo',
	'ratos',
	'ratus',
	'rauns',
	'raupo',
	'raved',
	'ravel',
	'raver',
	'raves',
	'ravey',
	'ravin',
	'rawer',
	'rawin',
	'rawly',
	'rawns',
	'raxed',
	'raxes',
	'rayah',
	'rayas',
	'rayed',
	'rayle',
	'rayne',
	'razed',
	'razee',
	'razer',
	'razes',
	'razoo',
	'readd',
	'reads',
	'reais',
	'reaks',
	'realo',
	'reals',
	'reame',
	'reams',
	'reamy',
	'reans',
	'reaps',
	'rears',
	'reast',
	'reata',
	'reate',
	'reave',
	'rebbe',
	'rebec',
	'rebid',
	'rebit',
	'rebop',
	'rebuy',
	'recal',
	'recce',
	'recco',
	'reccy',
	'recit',
	'recks',
	'recon',
	'recta',
	'recti',
	'recto',
	'redan',
	'redds',
	'reddy',
	'reded',
	'redes',
	'redia',
	'redid',
	'redip',
	'redly',
	'redon',
	'redos',
	'redox',
	'redry',
	'redub',
	'redux',
	'redye',
	'reech',
	'reede',
	'reeds',
	'reefs',
	'reefy',
	'reeks',
	'reeky',
	'reels',
	'reens',
	'reest',
	'reeve',
	'refed',
	'refel',
	'reffo',
	'refis',
	'refix',
	'refly',
	'refry',
	'regar',
	'reges',
	'reggo',
	'regie',
	'regma',
	'regna',
	'regos',
	'regur',
	'rehem',
	'reifs',
	'reify',
	'reiki',
	'reiks',
	'reink',
	'reins',
	'reird',
	'reist',
	'reive',
	'rejig',
	'rejon',
	'reked',
	'rekes',
	'rekey',
	'relet',
	'relie',
	'relit',
	'rello',
	'reman',
	'remap',
	'remen',
	'remet',
	'remex',
	'remix',
	'renay',
	'rends',
	'reney',
	'renga',
	'renig',
	'renin',
	'renne',
	'renos',
	'rente',
	'rents',
	'reoil',
	'reorg',
	'repeg',
	'repin',
	'repla',
	'repos',
	'repot',
	'repps',
	'repro',
	'reran',
	'rerig',
	'resat',
	'resaw',
	'resay',
	'resee',
	'reses',
	'resew',
	'resid',
	'resit',
	'resod',
	'resow',
	'resto',
	'rests',
	'resty',
	'resus',
	'retag',
	'retax',
	'retem',
	'retia',
	'retie',
	'retox',
	'revet',
	'revie',
	'rewan',
	'rewax',
	'rewed',
	'rewet',
	'rewin',
	'rewon',
	'rewth',
	'rexes',
	'rezes',
	'rheas',
	'rheme',
	'rheum',
	'rhies',
	'rhime',
	'rhine',
	'rhody',
	'rhomb',
	'rhone',
	'rhumb',
	'rhyne',
	'rhyta',
	'riads',
	'rials',
	'riant',
	'riata',
	'ribas',
	'ribby',
	'ribes',
	'riced',
	'ricer',
	'rices',
	'ricey',
	'richt',
	'ricin',
	'ricks',
	'rides',
	'ridgy',
	'ridic',
	'riels',
	'riems',
	'rieve',
	'rifer',
	'riffs',
	'rifte',
	'rifts',
	'rifty',
	'riggs',
	'rigol',
	'riled',
	'riles',
	'riley',
	'rille',
	'rills',
	'rimae',
	'rimed',
	'rimer',
	'rimes',
	'rimus',
	'rinds',
	'rindy',
	'rines',
	'rings',
	'rinks',
	'rioja',
	'riots',
	'riped',
	'ripes',
	'ripps',
	'rises',
	'rishi',
	'risks',
	'risps',
	'risus',
	'rites',
	'ritts',
	'ritzy',
	'rivas',
	'rived',
	'rivel',
	'riven',
	'rives',
	'riyal',
	'rizas',
	'roads',
	'roams',
	'roans',
	'roars',
	'roary',
	'roate',
	'robed',
	'robes',
	'roble',
	'rocks',
	'roded',
	'rodes',
	'roguy',
	'rohes',
	'roids',
	'roils',
	'roily',
	'roins',
	'roist',
	'rojak',
	'rojis',
	'roked',
	'roker',
	'rokes',
	'rolag',
	'roles',
	'rolfs',
	'rolls',
	'romal',
	'roman',
	'romeo',
	'romps',
	'ronde',
	'rondo',
	'roneo',
	'rones',
	'ronin',
	'ronne',
	'ronte',
	'ronts',
	'roods',
	'roofs',
	'roofy',
	'rooks',
	'rooky',
	'rooms',
	'roons',
	'roops',
	'roopy',
	'roosa',
	'roose',
	'roots',
	'rooty',
	'roped',
	'roper',
	'ropes',
	'ropey',
	'roque',
	'roral',
	'rores',
	'roric',
	'rorid',
	'rorie',
	'rorts',
	'rorty',
	'rosed',
	'roses',
	'roset',
	'roshi',
	'rosin',
	'rosit',
	'rosti',
	'rosts',
	'rotal',
	'rotan',
	'rotas',
	'rotch',
	'roted',
	'rotes',
	'rotis',
	'rotls',
	'roton',
	'rotos',
	'rotte',
	'rouen',
	'roues',
	'roule',
	'rouls',
	'roums',
	'roups',
	'roupy',
	'roust',
	'routh',
	'routs',
	'roved',
	'roven',
	'roves',
	'rowan',
	'rowed',
	'rowel',
	'rowen',
	'rowie',
	'rowme',
	'rownd',
	'rowth',
	'rowts',
	'royne',
	'royst',
	'rozet',
	'rozit',
	'ruana',
	'rubai',
	'rubby',
	'rubel',
	'rubes',
	'rubin',
	'ruble',
	'rubli',
	'rubus',
	'ruche',
	'rucks',
	'rudas',
	'rudds',
	'rudes',
	'rudie',
	'rudis',
	'rueda',
	'ruers',
	'ruffe',
	'ruffs',
	'rugae',
	'rugal',
	'ruggy',
	'ruing',
	'ruins',
	'rukhs',
	'ruled',
	'rules',
	'rumal',
	'rumbo',
	'rumen',
	'rumes',
	'rumly',
	'rummy',
	'rumpo',
	'rumps',
	'rumpy',
	'runch',
	'runds',
	'runed',
	'runes',
	'rungs',
	'runic',
	'runny',
	'runts',
	'runty',
	'rupia',
	'rurps',
	'rurus',
	'rusas',
	'ruses',
	'rushy',
	'rusks',
	'rusma',
	'russe',
	'rusts',
	'ruths',
	'rutin',
	'rutty',
	'ryals',
	'rybat',
	'ryked',
	'rykes',
	'rymme',
	'rynds',
	'ryots',
	'ryper',
	'saags',
	'sabal',
	'sabed',
	'saber',
	'sabes',
	'sabha',
	'sabin',
	'sabir',
	'sable',
	'sabot',
	'sabra',
	'sabre',
	'sacks',
	'sacra',
	'saddo',
	'sades',
	'sadhe',
	'sadhu',
	'sadis',
	'sados',
	'sadza',
	'safed',
	'safes',
	'sagas',
	'sager',
	'sages',
	'saggy',
	'sagos',
	'sagum',
	'saheb',
	'sahib',
	'saice',
	'saick',
	'saics',
	'saids',
	'saiga',
	'sails',
	'saims',
	'saine',
	'sains',
	'sairs',
	'saist',
	'saith',
	'sajou',
	'sakai',
	'saker',
	'sakes',
	'sakia',
	'sakis',
	'sakti',
	'salal',
	'salat',
	'salep',
	'sales',
	'salet',
	'salic',
	'salix',
	'salle',
	'salmi',
	'salol',
	'salop',
	'salpa',
	'salps',
	'salse',
	'salto',
	'salts',
	'salue',
	'salut',
	'saman',
	'samas',
	'samba',
	'sambo',
	'samek',
	'samel',
	'samen',
	'sames',
	'samey',
	'samfu',
	'sammy',
	'sampi',
	'samps',
	'sands',
	'saned',
	'sanes',
	'sanga',
	'sangh',
	'sango',
	'sangs',
	'sanko',
	'sansa',
	'santo',
	'sants',
	'saola',
	'sapan',
	'sapid',
	'sapor',
	'saran',
	'sards',
	'sared',
	'saree',
	'sarge',
	'sargo',
	'sarin',
	'saris',
	'sarks',
	'sarky',
	'sarod',
	'saros',
	'sarus',
	'saser',
	'sasin',
	'sasse',
	'satai',
	'satay',
	'sated',
	'satem',
	'sates',
	'satis',
	'sauba',
	'sauch',
	'saugh',
	'sauls',
	'sault',
	'saunt',
	'saury',
	'sauts',
	'saved',
	'saver',
	'saves',
	'savey',
	'savin',
	'sawah',
	'sawed',
	'sawer',
	'saxes',
	'sayed',
	'sayer',
	'sayid',
	'sayne',
	'sayon',
	'sayst',
	'sazes',
	'scabs',
	'scads',
	'scaff',
	'scags',
	'scail',
	'scala',
	'scall',
	'scams',
	'scand',
	'scans',
	'scapa',
	'scape',
	'scapi',
	'scarp',
	'scars',
	'scart',
	'scath',
	'scats',
	'scatt',
	'scaud',
	'scaup',
	'scaur',
	'scaws',
	'sceat',
	'scena',
	'scend',
	'schav',
	'schmo',
	'schul',
	'schwa',
	'sclim',
	'scody',
	'scogs',
	'scoog',
	'scoot',
	'scopa',
	'scops',
	'scots',
	'scoug',
	'scoup',
	'scowp',
	'scows',
	'scrab',
	'scrae',
	'scrag',
	'scran',
	'scrat',
	'scraw',
	'scray',
	'scrim',
	'scrip',
	'scrob',
	'scrod',
	'scrog',
	'scrow',
	'scudi',
	'scudo',
	'scuds',
	'scuff',
	'scuft',
	'scugs',
	'sculk',
	'scull',
	'sculp',
	'sculs',
	'scums',
	'scups',
	'scurf',
	'scurs',
	'scuse',
	'scuta',
	'scute',
	'scuts',
	'scuzz',
	'scyes',
	'sdayn',
	'sdein',
	'seals',
	'seame',
	'seams',
	'seamy',
	'seans',
	'seare',
	'sears',
	'sease',
	'seats',
	'seaze',
	'sebum',
	'secco',
	'sechs',
	'sects',
	'seder',
	'sedes',
	'sedge',
	'sedgy',
	'sedum',
	'seeds',
	'seeks',
	'seeld',
	'seels',
	'seely',
	'seems',
	'seeps',
	'seepy',
	'seers',
	'sefer',
	'segar',
	'segni',
	'segno',
	'segol',
	'segos',
	'sehri',
	'seifs',
	'seils',
	'seine',
	'seirs',
	'seise',
	'seism',
	'seity',
	'seiza',
	'sekos',
	'sekts',
	'selah',
	'seles',
	'selfs',
	'sella',
	'selle',
	'sells',
	'selva',
	'semee',
	'semes',
	'semie',
	'semis',
	'senas',
	'sends',
	'senes',
	'sengi',
	'senna',
	'senor',
	'sensa',
	'sensi',
	'sente',
	'senti',
	'sents',
	'senvy',
	'senza',
	'sepad',
	'sepal',
	'sepic',
	'sepoy',
	'septa',
	'septs',
	'serac',
	'serai',
	'seral',
	'sered',
	'serer',
	'seres',
	'serfs',
	'serge',
	'seric',
	'serin',
	'serks',
	'seron',
	'serow',
	'serra',
	'serre',
	'serrs',
	'serry',
	'servo',
	'sesey',
	'sessa',
	'setae',
	'setal',
	'seton',
	'setts',
	'sewan',
	'sewar',
	'sewed',
	'sewel',
	'sewen',
	'sewin',
	'sexed',
	'sexer',
	'sexes',
	'sexto',
	'sexts',
	'seyen',
	'shads',
	'shags',
	'shahs',
	'shako',
	'shakt',
	'shalm',
	'shaly',
	'shama',
	'shams',
	'shand',
	'shans',
	'shaps',
	'sharn',
	'shash',
	'shaul',
	'shawm',
	'shawn',
	'shaws',
	'shaya',
	'shays',
	'shchi',
	'sheaf',
	'sheal',
	'sheas',
	'sheds',
	'sheel',
	'shend',
	'shent',
	'sheol',
	'sherd',
	'shere',
	'shero',
	'shets',
	'sheva',
	'shewn',
	'shews',
	'shiai',
	'shiel',
	'shier',
	'shies',
	'shill',
	'shily',
	'shims',
	'shins',
	'ships',
	'shirr',
	'shirs',
	'shish',
	'shiso',
	'shist',
	'shite',
	'shits',
	'shiur',
	'shiva',
	'shive',
	'shivs',
	'shlep',
	'shlub',
	'shmek',
	'shmoe',
	'shoat',
	'shoed',
	'shoer',
	'shoes',
	'shogi',
	'shogs',
	'shoji',
	'shojo',
	'shola',
	'shool',
	'shoon',
	'shoos',
	'shope',
	'shops',
	'shorl',
	'shote',
	'shots',
	'shott',
	'showd',
	'shows',
	'shoyu',
	'shred',
	'shris',
	'shrow',
	'shtik',
	'shtum',
	'shtup',
	'shule',
	'shuln',
	'shuls',
	'shuns',
	'shura',
	'shute',
	'shuts',
	'shwas',
	'shyer',
	'sials',
	'sibbs',
	'sibyl',
	'sices',
	'sicht',
	'sicko',
	'sicks',
	'sicky',
	'sidas',
	'sided',
	'sider',
	'sides',
	'sidha',
	'sidhe',
	'sidle',
	'sield',
	'siens',
	'sient',
	'sieth',
	'sieur',
	'sifts',
	'sighs',
	'sigil',
	'sigla',
	'signa',
	'signs',
	'sijos',
	'sikas',
	'siker',
	'sikes',
	'silds',
	'siled',
	'silen',
	'siler',
	'siles',
	'silex',
	'silks',
	'sills',
	'silos',
	'silts',
	'silty',
	'silva',
	'simar',
	'simas',
	'simba',
	'simis',
	'simps',
	'simul',
	'sinds',
	'sined',
	'sines',
	'sings',
	'sinhs',
	'sinks',
	'sinky',
	'sinus',
	'siped',
	'sipes',
	'sippy',
	'sired',
	'siree',
	'sires',
	'sirih',
	'siris',
	'siroc',
	'sirra',
	'sirup',
	'sisal',
	'sises',
	'sista',
	'sists',
	'sitar',
	'sited',
	'sites',
	'sithe',
	'sitka',
	'situp',
	'situs',
	'siver',
	'sixer',
	'sixes',
	'sixmo',
	'sixte',
	'sizar',
	'sized',
	'sizel',
	'sizer',
	'sizes',
	'skags',
	'skail',
	'skald',
	'skank',
	'skart',
	'skats',
	'skatt',
	'skaws',
	'skean',
	'skear',
	'skeds',
	'skeed',
	'skeef',
	'skeen',
	'skeer',
	'skees',
	'skeet',
	'skegg',
	'skegs',
	'skein',
	'skelf',
	'skell',
	'skelm',
	'skelp',
	'skene',
	'skens',
	'skeos',
	'skeps',
	'skers',
	'skets',
	'skews',
	'skids',
	'skied',
	'skies',
	'skiey',
	'skimo',
	'skims',
	'skink',
	'skins',
	'skint',
	'skios',
	'skips',
	'skirl',
	'skirr',
	'skite',
	'skits',
	'skive',
	'skivy',
	'sklim',
	'skoal',
	'skody',
	'skoff',
	'skogs',
	'skols',
	'skool',
	'skort',
	'skosh',
	'skran',
	'skrik',
	'skuas',
	'skugs',
	'skyed',
	'skyer',
	'skyey',
	'skyfs',
	'skyre',
	'skyrs',
	'skyte',
	'slabs',
	'slade',
	'slaes',
	'slags',
	'slaid',
	'slake',
	'slams',
	'slane',
	'slank',
	'slaps',
	'slart',
	'slats',
	'slaty',
	'slaws',
	'slays',
	'slebs',
	'sleds',
	'sleer',
	'slews',
	'sleys',
	'slier',
	'slily',
	'slims',
	'slipe',
	'slips',
	'slipt',
	'slish',
	'slits',
	'slive',
	'sloan',
	'slobs',
	'sloes',
	'slogs',
	'sloid',
	'slojd',
	'slomo',
	'sloom',
	'sloot',
	'slops',
	'slopy',
	'slorm',
	'slots',
	'slove',
	'slows',
	'sloyd',
	'slubb',
	'slubs',
	'slued',
	'slues',
	'sluff',
	'slugs',
	'sluit',
	'slums',
	'slurb',
	'slurs',
	'sluse',
	'sluts',
	'slyer',
	'slype',
	'smaak',
	'smaik',
	'smalm',
	'smalt',
	'smarm',
	'smaze',
	'smeek',
	'smees',
	'smeik',
	'smeke',
	'smerk',
	'smews',
	'smirr',
	'smirs',
	'smits',
	'smogs',
	'smoko',
	'smolt',
	'smoor',
	'smoot',
	'smore',
	'smorg',
	'smout',
	'smowt',
	'smugs',
	'smurs',
	'smush',
	'smuts',
	'snabs',
	'snafu',
	'snags',
	'snaps',
	'snarf',
	'snark',
	'snars',
	'snary',
	'snash',
	'snath',
	'snaws',
	'snead',
	'sneap',
	'snebs',
	'sneck',
	'sneds',
	'sneed',
	'snees',
	'snell',
	'snibs',
	'snick',
	'snies',
	'snift',
	'snigs',
	'snips',
	'snipy',
	'snirt',
	'snits',
	'snobs',
	'snods',
	'snoek',
	'snoep',
	'snogs',
	'snoke',
	'snood',
	'snook',
	'snool',
	'snoot',
	'snots',
	'snowk',
	'snows',
	'snubs',
	'snugs',
	'snush',
	'snyes',
	'soaks',
	'soaps',
	'soare',
	'soars',
	'soave',
	'sobas',
	'socas',
	'soces',
	'socko',
	'socks',
	'socle',
	'sodas',
	'soddy',
	'sodic',
	'sodom',
	'sofar',
	'sofas',
	'softa',
	'softs',
	'softy',
	'soger',
	'sohur',
	'soils',
	'soily',
	'sojas',
	'sojus',
	'sokah',
	'soken',
	'sokes',
	'sokol',
	'solah',
	'solan',
	'solas',
	'solde',
	'soldi',
	'soldo',
	'solds',
	'soled',
	'solei',
	'soler',
	'soles',
	'solon',
	'solos',
	'solum',
	'solus',
	'soman',
	'somas',
	'sonce',
	'sonde',
	'sones',
	'songs',
	'sonly',
	'sonne',
	'sonny',
	'sonse',
	'sonsy',
	'sooey',
	'sooks',
	'sooky',
	'soole',
	'sools',
	'sooms',
	'soops',
	'soote',
	'soots',
	'sophs',
	'sophy',
	'sopor',
	'soppy',
	'sopra',
	'soral',
	'soras',
	'sorbo',
	'sorbs',
	'sorda',
	'sordo',
	'sords',
	'sored',
	'soree',
	'sorel',
	'sorer',
	'sores',
	'sorex',
	'sorgo',
	'sorns',
	'sorra',
	'sorta',
	'sorts',
	'sorus',
	'soths',
	'sotol',
	'souce',
	'souct',
	'sough',
	'souks',
	'souls',
	'soums',
	'soups',
	'soupy',
	'sours',
	'souse',
	'souts',
	'sowar',
	'sowce',
	'sowed',
	'sowff',
	'sowfs',
	'sowle',
	'sowls',
	'sowms',
	'sownd',
	'sowne',
	'sowps',
	'sowse',
	'sowth',
	'soyas',
	'soyle',
	'soyuz',
	'sozin',
	'spacy',
	'spado',
	'spaed',
	'spaer',
	'spaes',
	'spags',
	'spahi',
	'spail',
	'spain',
	'spait',
	'spake',
	'spald',
	'spale',
	'spall',
	'spalt',
	'spams',
	'spane',
	'spang',
	'spans',
	'spard',
	'spars',
	'spart',
	'spate',
	'spats',
	'spaul',
	'spawl',
	'spaws',
	'spayd',
	'spays',
	'spaza',
	'spazz',
	'speal',
	'spean',
	'speat',
	'specs',
	'spect',
	'speel',
	'speer',
	'speil',
	'speir',
	'speks',
	'speld',
	'spelk',
	'speos',
	'spets',
	'speug',
	'spews',
	'spewy',
	'spial',
	'spica',
	'spick',
	'spics',
	'spide',
	'spier',
	'spies',
	'spiff',
	'spifs',
	'spiks',
	'spile',
	'spims',
	'spina',
	'spink',
	'spins',
	'spirt',
	'spiry',
	'spits',
	'spitz',
	'spivs',
	'splay',
	'splog',
	'spode',
	'spods',
	'spoom',
	'spoor',
	'spoot',
	'spork',
	'sposh',
	'spots',
	'sprad',
	'sprag',
	'sprat',
	'spred',
	'sprew',
	'sprit',
	'sprod',
	'sprog',
	'sprue',
	'sprug',
	'spuds',
	'spued',
	'spuer',
	'spues',
	'spugs',
	'spule',
	'spume',
	'spumy',
	'spurs',
	'sputa',
	'spyal',
	'spyre',
	'squab',
	'squaw',
	'squeg',
	'squid',
	'squit',
	'squiz',
	'stabs',
	'stade',
	'stags',
	'stagy',
	'staig',
	'stane',
	'stang',
	'staph',
	'staps',
	'starn',
	'starr',
	'stars',
	'stats',
	'staun',
	'staws',
	'stays',
	'stean',
	'stear',
	'stedd',
	'stede',
	'steds',
	'steek',
	'steem',
	'steen',
	'steil',
	'stela',
	'stele',
	'stell',
	'steme',
	'stems',
	'stend',
	'steno',
	'stens',
	'stent',
	'steps',
	'stept',
	'stere',
	'stets',
	'stews',
	'stewy',
	'steys',
	'stich',
	'stied',
	'sties',
	'stilb',
	'stile',
	'stime',
	'stims',
	'stimy',
	'stipa',
	'stipe',
	'stire',
	'stirk',
	'stirp',
	'stirs',
	'stive',
	'stivy',
	'stoae',
	'stoai',
	'stoas',
	'stoat',
	'stobs',
	'stoep',
	'stogy',
	'stoit',
	'stoln',
	'stoma',
	'stond',
	'stong',
	'stonk',
	'stonn',
	'stook',
	'stoor',
	'stope',
	'stops',
	'stopt',
	'stoss',
	'stots',
	'stott',
	'stoun',
	'stoup',
	'stour',
	'stown',
	'stowp',
	'stows',
	'strad',
	'strae',
	'strag',
	'strak',
	'strep',
	'strew',
	'stria',
	'strig',
	'strim',
	'strop',
	'strow',
	'stroy',
	'strum',
	'stubs',
	'stude',
	'studs',
	'stull',
	'stulm',
	'stumm',
	'stums',
	'stuns',
	'stupa',
	'stupe',
	'sture',
	'sturt',
	'styed',
	'styes',
	'styli',
	'stylo',
	'styme',
	'stymy',
	'styre',
	'styte',
	'subah',
	'subas',
	'subby',
	'suber',
	'subha',
	'succi',
	'sucks',
	'sucky',
	'sucre',
	'sudds',
	'sudor',
	'sudsy',
	'suede',
	'suent',
	'suers',
	'suete',
	'suets',
	'suety',
	'sugan',
	'sughs',
	'sugos',
	'suhur',
	'suids',
	'suint',
	'suits',
	'sujee',
	'sukhs',
	'sukuk',
	'sulci',
	'sulfa',
	'sulfo',
	'sulks',
	'sulph',
	'sulus',
	'sumis',
	'summa',
	'sumos',
	'sumph',
	'sumps',
	'sunis',
	'sunks',
	'sunna',
	'sunns',
	'sunup',
	'supes',
	'supra',
	'surah',
	'sural',
	'suras',
	'surat',
	'surds',
	'sured',
	'sures',
	'surfs',
	'surfy',
	'surgy',
	'surra',
	'sused',
	'suses',
	'susus',
	'sutor',
	'sutra',
	'sutta',
	'swabs',
	'swack',
	'swads',
	'swage',
	'swags',
	'swail',
	'swain',
	'swale',
	'swaly',
	'swamy',
	'swang',
	'swank',
	'swans',
	'swaps',
	'swapt',
	'sward',
	'sware',
	'swarf',
	'swart',
	'swats',
	'swayl',
	'sways',
	'sweal',
	'swede',
	'sweed',
	'sweel',
	'sweer',
	'swees',
	'sweir',
	'swelt',
	'swerf',
	'sweys',
	'swies',
	'swigs',
	'swile',
	'swims',
	'swink',
	'swipe',
	'swire',
	'swiss',
	'swith',
	'swits',
	'swive',
	'swizz',
	'swobs',
	'swole',
	'swoln',
	'swops',
	'swopt',
	'swots',
	'swoun',
	'sybbe',
	'sybil',
	'syboe',
	'sybow',
	'sycee',
	'syces',
	'sycon',
	'syens',
	'syker',
	'sykes',
	'sylis',
	'sylph',
	'sylva',
	'symar',
	'synch',
	'syncs',
	'synds',
	'syned',
	'synes',
	'synth',
	'syped',
	'sypes',
	'syphs',
	'syrah',
	'syren',
	'sysop',
	'sythe',
	'syver',
	'taals',
	'taata',
	'taber',
	'tabes',
	'tabid',
	'tabis',
	'tabla',
	'tabor',
	'tabun',
	'tabus',
	'tacan',
	'taces',
	'tacet',
	'tache',
	'tacho',
	'tachs',
	'tacks',
	'tacos',
	'tacts',
	'taels',
	'tafia',
	'taggy',
	'tagma',
	'tahas',
	'tahrs',
	'taiga',
	'taigs',
	'taiko',
	'tails',
	'tains',
	'taira',
	'taish',
	'taits',
	'tajes',
	'takas',
	'takes',
	'takhi',
	'takin',
	'takis',
	'takky',
	'talak',
	'talaq',
	'talar',
	'talas',
	'talcs',
	'talcy',
	'talea',
	'taler',
	'tales',
	'talks',
	'talky',
	'talls',
	'talma',
	'talpa',
	'taluk',
	'talus',
	'tamal',
	'tamed',
	'tames',
	'tamin',
	'tamis',
	'tammy',
	'tamps',
	'tanas',
	'tanga',
	'tangi',
	'tangs',
	'tanhs',
	'tanka',
	'tanks',
	'tanky',
	'tanna',
	'tansy',
	'tanti',
	'tanto',
	'tanty',
	'tapas',
	'taped',
	'tapen',
	'tapes',
	'tapet',
	'tapis',
	'tappa',
	'tapus',
	'taras',
	'tardo',
	'tared',
	'tares',
	'targa',
	'targe',
	'tarns',
	'taroc',
	'tarok',
	'taros',
	'tarps',
	'tarre',
	'tarry',
	'tarsi',
	'tarts',
	'tarty',
	'tasar',
	'tased',
	'taser',
	'tases',
	'tasks',
	'tassa',
	'tasse',
	'tasso',
	'tatar',
	'tater',
	'tates',
	'taths',
	'tatie',
	'tatou',
	'tatts',
	'tatus',
	'taube',
	'tauld',
	'tauon',
	'taupe',
	'tauts',
	'tavah',
	'tavas',
	'taver',
	'tawai',
	'tawas',
	'tawed',
	'tawer',
	'tawie',
	'tawse',
	'tawts',
	'taxed',
	'taxer',
	'taxes',
	'taxis',
	'taxol',
	'taxon',
	'taxor',
	'taxus',
	'tayra',
	'tazza',
	'tazze',
	'teade',
	'teads',
	'teaed',
	'teaks',
	'teals',
	'teams',
	'tears',
	'teats',
	'teaze',
	'techs',
	'techy',
	'tecta',
	'teels',
	'teems',
	'teend',
	'teene',
	'teens',
	'teeny',
	'teers',
	'teffs',
	'teggs',
	'tegua',
	'tegus',
	'tehrs',
	'teiid',
	'teils',
	'teind',
	'teins',
	'telae',
	'telco',
	'teles',
	'telex',
	'telia',
	'telic',
	'tells',
	'telly',
	'teloi',
	'telos',
	'temed',
	'temes',
	'tempi',
	'temps',
	'tempt',
	'temse',
	'tench',
	'tends',
	'tendu',
	'tenes',
	'tenge',
	'tenia',
	'tenne',
	'tenno',
	'tenny',
	'tenon',
	'tents',
	'tenty',
	'tenue',
	'tepal',
	'tepas',
	'tepoy',
	'terai',
	'teras',
	'terce',
	'terek',
	'teres',
	'terfe',
	'terfs',
	'terga',
	'terms',
	'terne',
	'terns',
	'terry',
	'terts',
	'tesla',
	'testa',
	'teste',
	'tests',
	'tetes',
	'teths',
	'tetra',
	'tetri',
	'teuch',
	'teugh',
	'tewed',
	'tewel',
	'tewit',
	'texas',
	'texes',
	'texts',
	'thack',
	'thagi',
	'thaim',
	'thale',
	'thali',
	'thana',
	'thane',
	'thang',
	'thans',
	'thanx',
	'tharm',
	'thars',
	'thaws',
	'thawy',
	'thebe',
	'theca',
	'theed',
	'theek',
	'thees',
	'thegn',
	'theic',
	'thein',
	'thelf',
	'thema',
	'thens',
	'theow',
	'therm',
	'thesp',
	'thete',
	'thews',
	'thewy',
	'thigs',
	'thilk',
	'thill',
	'thine',
	'thins',
	'thiol',
	'thirl',
	'thoft',
	'thole',
	'tholi',
	'thoro',
	'thorp',
	'thous',
	'thowl',
	'thrae',
	'thraw',
	'thrid',
	'thrip',
	'throe',
	'thuds',
	'thugs',
	'thuja',
	'thunk',
	'thurl',
	'thuya',
	'thymi',
	'thymy',
	'tians',
	'tiars',
	'tical',
	'ticca',
	'ticed',
	'tices',
	'tichy',
	'ticks',
	'ticky',
	'tiddy',
	'tided',
	'tides',
	'tiers',
	'tiffs',
	'tifos',
	'tifts',
	'tiges',
	'tigon',
	'tikas',
	'tikes',
	'tikis',
	'tikka',
	'tilak',
	'tiled',
	'tiler',
	'tiles',
	'tills',
	'tilly',
	'tilth',
	'tilts',
	'timbo',
	'timed',
	'times',
	'timon',
	'timps',
	'tinas',
	'tinct',
	'tinds',
	'tinea',
	'tined',
	'tines',
	'tinge',
	'tings',
	'tinks',
	'tinny',
	'tints',
	'tinty',
	'tipis',
	'tippy',
	'tired',
	'tires',
	'tirls',
	'tiros',
	'tirrs',
	'titch',
	'titer',
	'titis',
	'titre',
	'titty',
	'titup',
	'tiyin',
	'tiyns',
	'tizes',
	'tizzy',
	'toads',
	'toady',
	'toaze',
	'tocks',
	'tocky',
	'tocos',
	'todde',
	'toeas',
	'toffs',
	'toffy',
	'tofts',
	'tofus',
	'togae',
	'togas',
	'toged',
	'toges',
	'togue',
	'tohos',
	'toile',
	'toils',
	'toing',
	'toise',
	'toits',
	'tokay',
	'toked',
	'toker',
	'tokes',
	'tokos',
	'tolan',
	'tolar',
	'tolas',
	'toled',
	'toles',
	'tolls',
	'tolly',
	'tolts',
	'tolus',
	'tolyl',
	'toman',
	'tombs',
	'tomes',
	'tomia',
	'tommy',
	'tomos',
	'tondi',
	'tondo',
	'toned',
	'toner',
	'tones',
	'toney',
	'tongs',
	'tonka',
	'tonks',
	'tonne',
	'tonus',
	'tools',
	'tooms',
	'toons',
	'toots',
	'toped',
	'topee',
	'topek',
	'toper',
	'topes',
	'tophe',
	'tophi',
	'tophs',
	'topis',
	'topoi',
	'topos',
	'toppy',
	'toque',
	'torah',
	'toran',
	'toras',
	'torcs',
	'tores',
	'toric',
	'torii',
	'toros',
	'torot',
	'torrs',
	'torse',
	'torsi',
	'torsk',
	'torta',
	'torte',
	'torts',
	'tosas',
	'tosed',
	'toses',
	'toshy',
	'tossy',
	'toted',
	'toter',
	'totes',
	'totty',
	'touks',
	'touns',
	'tours',
	'touse',
	'tousy',
	'touts',
	'touze',
	'touzy',
	'towed',
	'towie',
	'towns',
	'towny',
	'towse',
	'towsy',
	'towts',
	'towze',
	'towzy',
	'toyed',
	'toyer',
	'toyon',
	'toyos',
	'tozed',
	'tozes',
	'tozie',
	'trabs',
	'trads',
	'tragi',
	'traik',
	'trams',
	'trank',
	'tranq',
	'trans',
	'trant',
	'trape',
	'traps',
	'trapt',
	'trass',
	'trats',
	'tratt',
	'trave',
	'trayf',
	'trays',
	'treck',
	'treed',
	'treen',
	'trees',
	'trefa',
	'treif',
	'treks',
	'trema',
	'trems',
	'tress',
	'trest',
	'trets',
	'trews',
	'treyf',
	'treys',
	'triac',
	'tride',
	'trier',
	'tries',
	'triff',
	'trigo',
	'trigs',
	'trike',
	'trild',
	'trill',
	'trims',
	'trine',
	'trins',
	'triol',
	'trior',
	'trios',
	'trips',
	'tripy',
	'trist',
	'troad',
	'troak',
	'troat',
	'trock',
	'trode',
	'trods',
	'trogs',
	'trois',
	'troke',
	'tromp',
	'trona',
	'tronc',
	'trone',
	'tronk',
	'trons',
	'trooz',
	'troth',
	'trots',
	'trows',
	'troys',
	'trued',
	'trues',
	'trugo',
	'trugs',
	'trull',
	'tryer',
	'tryke',
	'tryma',
	'tryps',
	'tsade',
	'tsadi',
	'tsars',
	'tsked',
	'tsuba',
	'tsubo',
	'tuans',
	'tuart',
	'tuath',
	'tubae',
	'tubar',
	'tubas',
	'tubby',
	'tubed',
	'tubes',
	'tucks',
	'tufas',
	'tuffe',
	'tuffs',
	'tufts',
	'tufty',
	'tugra',
	'tuile',
	'tuina',
	'tuism',
	'tuktu',
	'tules',
	'tulpa',
	'tulsi',
	'tumid',
	'tummy',
	'tumps',
	'tumpy',
	'tunas',
	'tunds',
	'tuned',
	'tuner',
	'tunes',
	'tungs',
	'tunny',
	'tupek',
	'tupik',
	'tuple',
	'tuque',
	'turds',
	'turfs',
	'turfy',
	'turks',
	'turme',
	'turms',
	'turns',
	'turnt',
	'turps',
	'turrs',
	'tushy',
	'tusks',
	'tusky',
	'tutee',
	'tutti',
	'tutty',
	'tutus',
	'tuxes',
	'tuyer',
	'twaes',
	'twain',
	'twals',
	'twank',
	'twats',
	'tways',
	'tweel',
	'tween',
	'tweep',
	'tweer',
	'twerk',
	'twerp',
	'twier',
	'twigs',
	'twill',
	'twilt',
	'twink',
	'twins',
	'twiny',
	'twire',
	'twirp',
	'twite',
	'twits',
	'twoer',
	'twyer',
	'tyees',
	'tyers',
	'tyiyn',
	'tykes',
	'tyler',
	'tymps',
	'tynde',
	'tyned',
	'tynes',
	'typal',
	'typed',
	'types',
	'typey',
	'typic',
	'typos',
	'typps',
	'typto',
	'tyran',
	'tyred',
	'tyres',
	'tyros',
	'tythe',
	'tzars',
	'udals',
	'udons',
	'ugali',
	'ugged',
	'uhlan',
	'uhuru',
	'ukase',
	'ulama',
	'ulans',
	'ulema',
	'ulmin',
	'ulnad',
	'ulnae',
	'ulnar',
	'ulnas',
	'ulpan',
	'ulvas',
	'ulyie',
	'ulzie',
	'umami',
	'umbel',
	'umber',
	'umble',
	'umbos',
	'umbre',
	'umiac',
	'umiak',
	'umiaq',
	'ummah',
	'ummas',
	'ummed',
	'umped',
	'umphs',
	'umpie',
	'umpty',
	'umrah',
	'umras',
	'unais',
	'unapt',
	'unarm',
	'unary',
	'unaus',
	'unbag',
	'unban',
	'unbar',
	'unbed',
	'unbid',
	'unbox',
	'uncap',
	'unces',
	'uncia',
	'uncos',
	'uncoy',
	'uncus',
	'undam',
	'undee',
	'undos',
	'undug',
	'uneth',
	'unfix',
	'ungag',
	'unget',
	'ungod',
	'ungot',
	'ungum',
	'unhat',
	'unhip',
	'unica',
	'units',
	'unjam',
	'unked',
	'unket',
	'unkid',
	'unlaw',
	'unlay',
	'unled',
	'unlet',
	'unlid',
	'unman',
	'unmew',
	'unmix',
	'unpay',
	'unpeg',
	'unpen',
	'unpin',
	'unred',
	'unrid',
	'unrig',
	'unrip',
	'unsaw',
	'unsay',
	'unsee',
	'unsew',
	'unsex',
	'unsod',
	'untax',
	'untin',
	'unwet',
	'unwit',
	'unwon',
	'upbow',
	'upbye',
	'updos',
	'updry',
	'upend',
	'upjet',
	'uplay',
	'upled',
	'uplit',
	'upped',
	'upran',
	'uprun',
	'upsee',
	'upsey',
	'uptak',
	'upter',
	'uptie',
	'uraei',
	'urali',
	'uraos',
	'urare',
	'urari',
	'urase',
	'urate',
	'urbex',
	'urbia',
	'urdee',
	'ureal',
	'ureas',
	'uredo',
	'ureic',
	'urena',
	'urent',
	'urged',
	'urger',
	'urges',
	'urial',
	'urite',
	'urman',
	'urnal',
	'urned',
	'urped',
	'ursae',
	'ursid',
	'urson',
	'urubu',
	'urvas',
	'users',
	'usnea',
	'usque',
	'usure',
	'usury',
	'uteri',
	'uveal',
	'uveas',
	'uvula',
	'vacua',
	'vaded',
	'vades',
	'vagal',
	'vagus',
	'vails',
	'vaire',
	'vairs',
	'vairy',
	'vakas',
	'vakil',
	'vales',
	'valis',
	'valse',
	'vamps',
	'vampy',
	'vanda',
	'vaned',
	'vanes',
	'vangs',
	'vants',
	'vaped',
	'vaper',
	'vapes',
	'varan',
	'varas',
	'vardy',
	'varec',
	'vares',
	'varia',
	'varix',
	'varna',
	'varus',
	'varve',
	'vasal',
	'vases',
	'vasts',
	'vasty',
	'vatic',
	'vatus',
	'vauch',
	'vaute',
	'vauts',
	'vawte',
	'vaxes',
	'veale',
	'veals',
	'vealy',
	'veena',
	'veeps',
	'veers',
	'veery',
	'vegas',
	'veges',
	'vegie',
	'vegos',
	'vehme',
	'veils',
	'veily',
	'veins',
	'veiny',
	'velar',
	'velds',
	'veldt',
	'veles',
	'vells',
	'velum',
	'venae',
	'venal',
	'vends',
	'vendu',
	'veney',
	'venge',
	'venin',
	'vents',
	'venus',
	'verbs',
	'verra',
	'verry',
	'verst',
	'verts',
	'vertu',
	'vespa',
	'vesta',
	'vests',
	'vetch',
	'vexed',
	'vexer',
	'vexes',
	'vexil',
	'vezir',
	'vials',
	'viand',
	'vibes',
	'vibex',
	'vibey',
	'viced',
	'vices',
	'vichy',
	'viers',
	'views',
	'viewy',
	'vifda',
	'viffs',
	'vigas',
	'vigia',
	'vilde',
	'viler',
	'villi',
	'vills',
	'vimen',
	'vinal',
	'vinas',
	'vinca',
	'vined',
	'viner',
	'vines',
	'vinew',
	'vinic',
	'vinos',
	'vints',
	'viold',
	'viols',
	'vired',
	'vireo',
	'vires',
	'virga',
	'virge',
	'virid',
	'virls',
	'virtu',
	'visas',
	'vised',
	'vises',
	'visie',
	'visne',
	'vison',
	'visto',
	'vitae',
	'vitas',
	'vitex',
	'vitro',
	'vitta',
	'vivas',
	'vivat',
	'vivda',
	'viver',
	'vives',
	'vizir',
	'vizor',
	'vleis',
	'vlies',
	'vlogs',
	'voars',
	'vocab',
	'voces',
	'voddy',
	'vodou',
	'vodun',
	'voema',
	'vogie',
	'voids',
	'voile',
	'voips',
	'volae',
	'volar',
	'voled',
	'voles',
	'volet',
	'volks',
	'volta',
	'volte',
	'volti',
	'volts',
	'volva',
	'volve',
	'vomer',
	'voted',
	'votes',
	'vouge',
	'voulu',
	'vowed',
	'vower',
	'voxel',
	'vozhd',
	'vraic',
	'vrils',
	'vroom',
	'vrous',
	'vrouw',
	'vrows',
	'vuggs',
	'vuggy',
	'vughs',
	'vughy',
	'vulgo',
	'vulns',
	'vulva',
	'vutty',
	'waacs',
	'wacke',
	'wacko',
	'wacks',
	'wadds',
	'waddy',
	'waded',
	'wader',
	'wades',
	'wadge',
	'wadis',
	'wadts',
	'waffs',
	'wafts',
	'waged',
	'wages',
	'wagga',
	'wagyu',
	'wahoo',
	'waide',
	'waifs',
	'waift',
	'wails',
	'wains',
	'wairs',
	'waite',
	'waits',
	'wakas',
	'waked',
	'waken',
	'waker',
	'wakes',
	'wakfs',
	'waldo',
	'walds',
	'waled',
	'waler',
	'wales',
	'walie',
	'walis',
	'walks',
	'walla',
	'walls',
	'wally',
	'walty',
	'wamed',
	'wames',
	'wamus',
	'wands',
	'waned',
	'wanes',
	'waney',
	'wangs',
	'wanks',
	'wanky',
	'wanle',
	'wanly',
	'wanna',
	'wants',
	'wanty',
	'wanze',
	'waqfs',
	'warbs',
	'warby',
	'wards',
	'wared',
	'wares',
	'warez',
	'warks',
	'warms',
	'warns',
	'warps',
	'warre',
	'warst',
	'warts',
	'wases',
	'washy',
	'wasms',
	'wasps',
	'waspy',
	'wasts',
	'watap',
	'watts',
	'wauff',
	'waugh',
	'wauks',
	'waulk',
	'wauls',
	'waurs',
	'waved',
	'waves',
	'wavey',
	'wawas',
	'wawes',
	'wawls',
	'waxed',
	'waxer',
	'waxes',
	'wayed',
	'wazir',
	'wazoo',
	'weald',
	'weals',
	'weamb',
	'weans',
	'wears',
	'webby',
	'weber',
	'wecht',
	'wedel',
	'wedgy',
	'weeds',
	'weeke',
	'weeks',
	'weels',
	'weems',
	'weens',
	'weeny',
	'weeps',
	'weepy',
	'weest',
	'weete',
	'weets',
	'wefte',
	'wefts',
	'weids',
	'weils',
	'weirs',
	'weise',
	'weize',
	'wekas',
	'welds',
	'welke',
	'welks',
	'welkt',
	'wells',
	'welly',
	'welts',
	'wembs',
	'wends',
	'wenge',
	'wenny',
	'wents',
	'weros',
	'wersh',
	'wests',
	'wetas',
	'wetly',
	'wexed',
	'wexes',
	'whamo',
	'whams',
	'whang',
	'whaps',
	'whare',
	'whata',
	'whats',
	'whaup',
	'whaur',
	'wheal',
	'whear',
	'wheen',
	'wheep',
	'wheft',
	'whelk',
	'whelm',
	'whens',
	'whets',
	'whews',
	'wheys',
	'whids',
	'whift',
	'whigs',
	'whilk',
	'whims',
	'whins',
	'whios',
	'whips',
	'whipt',
	'whirr',
	'whirs',
	'whish',
	'whiss',
	'whist',
	'whits',
	'whity',
	'whizz',
	'whomp',
	'whoof',
	'whoot',
	'whops',
	'whore',
	'whorl',
	'whort',
	'whoso',
	'whows',
	'whump',
	'whups',
	'whyda',
	'wicca',
	'wicks',
	'wicky',
	'widdy',
	'wides',
	'wiels',
	'wifed',
	'wifes',
	'wifey',
	'wifie',
	'wifty',
	'wigan',
	'wigga',
	'wiggy',
	'wikis',
	'wilco',
	'wilds',
	'wiled',
	'wiles',
	'wilga',
	'wilis',
	'wilja',
	'wills',
	'wilts',
	'wimps',
	'winds',
	'wined',
	'wines',
	'winey',
	'winge',
	'wings',
	'wingy',
	'winks',
	'winna',
	'winns',
	'winos',
	'winze',
	'wiped',
	'wiper',
	'wipes',
	'wired',
	'wirer',
	'wires',
	'wirra',
	'wised',
	'wises',
	'wisha',
	'wisht',
	'wisps',
	'wists',
	'witan',
	'wited',
	'wites',
	'withe',
	'withs',
	'withy',
	'wived',
	'wiver',
	'wives',
	'wizen',
	'wizes',
	'woads',
	'woald',
	'wocks',
	'wodge',
	'woful',
	'wojus',
	'woker',
	'wokka',
	'wolds',
	'wolfs',
	'wolly',
	'wolve',
	'wombs',
	'womby',
	'womyn',
	'wonga',
	'wongi',
	'wonks',
	'wonky',
	'wonts',
	'woods',
	'wooed',
	'woofs',
	'woofy',
	'woold',
	'wools',
	'woons',
	'woops',
	'woopy',
	'woose',
	'woosh',
	'wootz',
	'words',
	'works',
	'worms',
	'wormy',
	'worts',
	'wowed',
	'wowee',
	'woxen',
	'wrang',
	'wraps',
	'wrapt',
	'wrast',
	'wrate',
	'wrawl',
	'wrens',
	'wrick',
	'wried',
	'wrier',
	'wries',
	'writs',
	'wroke',
	'wroot',
	'wroth',
	'wryer',
	'wuddy',
	'wudus',
	'wulls',
	'wurst',
	'wuses',
	'wushu',
	'wussy',
	'wuxia',
	'wyled',
	'wyles',
	'wynds',
	'wynns',
	'wyted',
	'wytes',
	'xebec',
	'xenia',
	'xenic',
	'xenon',
	'xeric',
	'xerox',
	'xerus',
	'xoana',
	'xrays',
	'xylan',
	'xylem',
	'xylic',
	'xylol',
	'xylyl',
	'xysti',
	'xysts',
	'yaars',
	'yabas',
	'yabba',
	'yabby',
	'yacca',
	'yacka',
	'yacks',
	'yaffs',
	'yager',
	'yages',
	'yagis',
	'yahoo',
	'yaird',
	'yakka',
	'yakow',
	'yales',
	'yamen',
	'yampy',
	'yamun',
	'yangs',
	'yanks',
	'yapok',
	'yapon',
	'yapps',
	'yappy',
	'yarak',
	'yarco',
	'yards',
	'yarer',
	'yarfa',
	'yarks',
	'yarns',
	'yarrs',
	'yarta',
	'yarto',
	'yates',
	'yauds',
	'yauld',
	'yaups',
	'yawed',
	'yawey',
	'yawls',
	'yawns',
	'yawny',
	'yawps',
	'ybore',
	'yclad',
	'ycled',
	'ycond',
	'ydrad',
	'ydred',
	'yeads',
	'yeahs',
	'yealm',
	'yeans',
	'yeard',
	'years',
	'yecch',
	'yechs',
	'yechy',
	'yedes',
	'yeeds',
	'yeesh',
	'yeggs',
	'yelks',
	'yells',
	'yelms',
	'yelps',
	'yelts',
	'yenta',
	'yente',
	'yerba',
	'yerds',
	'yerks',
	'yeses',
	'yesks',
	'yests',
	'yesty',
	'yetis',
	'yetts',
	'yeuks',
	'yeuky',
	'yeven',
	'yeves',
	'yewen',
	'yexed',
	'yexes',
	'yfere',
	'yiked',
	'yikes',
	'yills',
	'yince',
	'yipes',
	'yippy',
	'yirds',
	'yirks',
	'yirrs',
	'yirth',
	'yites',
	'yitie',
	'ylems',
	'ylike',
	'ylkes',
	'ymolt',
	'ympes',
	'yobbo',
	'yobby',
	'yocks',
	'yodel',
	'yodhs',
	'yodle',
	'yogas',
	'yogee',
	'yoghs',
	'yogic',
	'yogin',
	'yogis',
	'yoick',
	'yojan',
	'yoked',
	'yokel',
	'yoker',
	'yokes',
	'yokul',
	'yolks',
	'yolky',
	'yomim',
	'yomps',
	'yonic',
	'yonis',
	'yonks',
	'yoofs',
	'yoops',
	'yores',
	'yorks',
	'yorps',
	'youks',
	'yourn',
	'yours',
	'yourt',
	'youse',
	'yowed',
	'yowes',
	'yowie',
	'yowls',
	'yowza',
	'yrapt',
	'yrent',
	'yrivd',
	'yrneh',
	'ysame',
	'ytost',
	'yuans',
	'yucas',
	'yucca',
	'yucch',
	'yucko',
	'yucks',
	'yucky',
	'yufts',
	'yugas',
	'yuked',
	'yukes',
	'yukky',
	'yukos',
	'yulan',
	'yules',
	'yummo',
	'yummy',
	'yumps',
	'yupon',
	'yuppy',
	'yurta',
	'yurts',
	'yuzus',
	'zabra',
	'zacks',
	'zaida',
	'zaidy',
	'zaire',
	'zakat',
	'zaman',
	'zambo',
	'zamia',
	'zanja',
	'zante',
	'zanza',
	'zanze',
	'zappy',
	'zarfs',
	'zaris',
	'zatis',
	'zaxes',
	'zayin',
	'zazen',
	'zeals',
	'zebec',
	'zebub',
	'zebus',
	'zedas',
	'zeins',
	'zendo',
	'zerda',
	'zerks',
	'zeros',
	'zests',
	'zetas',
	'zexes',
	'zezes',
	'zhomo',
	'zibet',
	'ziffs',
	'zigan',
	'zilas',
	'zilch',
	'zilla',
	'zills',
	'zimbi',
	'zimbs',
	'zinco',
	'zincs',
	'zincy',
	'zineb',
	'zines',
	'zings',
	'zingy',
	'zinke',
	'zinky',
	'zippo',
	'zippy',
	'ziram',
	'zitis',
	'zizel',
	'zizit',
	'zlote',
	'zloty',
	'zoaea',
	'zobos',
	'zobus',
	'zocco',
	'zoeae',
	'zoeal',
	'zoeas',
	'zoism',
	'zoist',
	'zombi',
	'zonae',
	'zonda',
	'zoned',
	'zoner',
	'zones',
	'zonks',
	'zooea',
	'zooey',
	'zooid',
	'zooks',
	'zooms',
	'zoons',
	'zooty',
	'zoppa',
	'zoppo',
	'zoril',
	'zoris',
	'zorro',
	'zouks',
	'zowee',
	'zowie',
	'zulus',
	'zupan',
	'zupas',
	'zuppa',
	'zurfs',
	'zuzim',
	'zygal',
	'zygon',
	'zymes',
	'zymic'
]);

```


####### packages/create-svelte/templates/default/static/robots.txt #######

# https://www.robotstxt.org/robotstxt.html
User-agent: *
Disallow:

####### packages/create-svelte/templates/default/svelte.config.js #######

```

import adapter from '@sveltejs/adapter-auto';
import { vitePreprocess } from '@sveltejs/vite-plugin-svelte';

// This config is ignored and replaced with one of the configs in the shared folder when a project is created.

/** @type {import('@sveltejs/kit').Config} */
const config = {
	// Consult https://kit.svelte.dev/docs/integrations#preprocessors
	// for more information about preprocessors
	preprocess: vitePreprocess(),

	kit: {
		adapter: adapter()
	}
};

export default config;

```


####### packages/create-svelte/templates/default/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/create-svelte/templates/default/vercel.json #######

```

{
	"github": {
		"silent": true
	}
}

```


####### packages/create-svelte/templates/default/vite.config.js #######

```

import path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';
import { defineConfig } from 'vite';

export default defineConfig({
	plugins: [sveltekit()],

	server: {
		fs: {
			allow: [path.resolve('../../../kit')]
		}
	}
});

```


####### packages/create-svelte/templates/default/wrangler.toml #######

```

name = "svelte-kit-demo"
account_id = "32a8245cd45a24083dd0acae1d482048"
route = "cloudflare-workers-demo.svelte.dev/*"

main = "./.cloudflare/worker.js"
site.bucket = "./.cloudflare/public"

build.command = "npm run build"

compatibility_date = "2021-11-12"
workers_dev = true


```


####### packages/create-svelte/templates/skeletonlib/package.template.json #######

```

{
	"name": "~TODO~",
	"version": "0.0.1",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build && npm run package",
		"preview": "vite preview",
		"package": "svelte-kit sync && svelte-package && publint",
		"prepublishOnly": "npm run package"
	},
	"exports": {
		".": {
			"types": "./dist/index.d.ts",
			"svelte": "./dist/index.js"
		}
	},
	"files": ["dist", "!dist/**/*.test.*", "!dist/**/*.spec.*"],
	"peerDependencies": {
		"svelte": "^4.0.0"
	},
	"devDependencies": {
		"@sveltejs/adapter-auto": "^3.0.0",
		"@sveltejs/kit": "^2.0.0",
		"@sveltejs/package": "^2.0.0",
		"@sveltejs/vite-plugin-svelte": "^3.0.0",
		"publint": "^0.1.9",
		"svelte": "^4.2.7",
		"tslib": "^2.4.1",
		"typescript": "^5.3.2",
		"vite": "^5.0.11"
	},
	"svelte": "./dist/index.js",
	"types": "./dist/index.d.ts",
	"type": "module"
}

```


####### packages/create-svelte/templates/skeletonlib/src/app.d.ts #######

```

// See https://kit.svelte.dev/docs/types#app
// for information about these interfaces
declare global {
	namespace App {
		// interface Error {}
		// interface Locals {}
		// interface PageData {}
		// interface PageState {}
		// interface Platform {}
	}
}

export {};

```


####### packages/create-svelte/templates/skeletonlib/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover">
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/create-svelte/templates/skeletonlib/src/lib/index.ts #######

```

// Reexport your entry components here

```


####### packages/create-svelte/templates/skeletonlib/src/routes/+page.svelte #######

```

<h1>Welcome to your library project</h1>
<p>Create your package using @sveltejs/package and preview/showcase your work with SvelteKit</p>
<p>Visit <a href="https://kit.svelte.dev">kit.svelte.dev</a> to read the documentation</p>

```


####### packages/create-svelte/templates/skeletonlib/svelte.config.js #######

```

import adapter from '@sveltejs/adapter-auto';

// This config is ignored and replaced with one of the configs in the shared folder when a project is created.

/** @type {import('@sveltejs/package').Config} */
const config = {
	kit: {
		adapter: adapter()
	}
};

export default config;

```


####### packages/create-svelte/templates/skeletonlib/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import { defineConfig } from 'vite';

export default defineConfig({
	plugins: [sveltekit()]
});

```


####### packages/create-svelte/templates/skeleton/package.json #######

```

{
	"name": "skeleton-template",
	"private": true,
	"version": "0.0.1-next.0",
	"devDependencies": {
		"@sveltejs/adapter-auto": "workspace:*"
	},
	"type": "module"
}

```


####### packages/create-svelte/templates/skeleton/package.template.json #######

```

{
	"name": "~TODO~",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview"
	},
	"devDependencies": {
		"@sveltejs/adapter-auto": "^3.0.0",
		"@sveltejs/kit": "^2.0.0",
		"@sveltejs/vite-plugin-svelte": "^3.0.0",
		"svelte": "^4.2.7",
		"vite": "^5.0.3"
	},
	"type": "module"
}

```


####### packages/create-svelte/templates/skeleton/src/app.d.ts #######

```

// See https://kit.svelte.dev/docs/types#app
// for information about these interfaces
declare global {
	namespace App {
		// interface Error {}
		// interface Locals {}
		// interface PageData {}
		// interface PageState {}
		// interface Platform {}
	}
}

export {};

```


####### packages/create-svelte/templates/skeleton/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>

```


####### packages/create-svelte/templates/skeleton/src/lib/index.ts #######

```

// place files you want to import through the `$lib` alias in this folder.

```


####### packages/create-svelte/templates/skeleton/src/routes/+page.svelte #######

```

<h1>Welcome to SvelteKit</h1>
<p>Visit <a href="https://kit.svelte.dev">kit.svelte.dev</a> to read the documentation</p>

```


####### packages/create-svelte/templates/skeleton/svelte.config.js #######

```

import adapter from '@sveltejs/adapter-auto';

// This config is ignored and replaced with one of the configs in the shared folder when a project is created.

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter()
	}
};

export default config;

```


####### packages/create-svelte/templates/skeleton/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import { defineConfig } from 'vite';

export default defineConfig({
	plugins: [sveltekit()]
});

```


####### packages/create-svelte/test/check.js #######

```

import { exec, execSync } from 'node:child_process';
import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';
import { promisify } from 'node:util';
import glob from 'tiny-glob/sync.js';
import { beforeAll, describe, test } from 'vitest';
import { create } from '../index.js';

/**
 * Resolve the given path relative to the current file
 * @param {string} path
 */
const resolve_path = (path) => fileURLToPath(new URL(path, import.meta.url));

// use a directory outside of packages to ensure it isn't added to the pnpm workspace
const test_workspace_dir = resolve_path('../../../.test-tmp/create-svelte/');

const existing_workspace_overrides = JSON.parse(
	fs.readFileSync(resolve_path('../../../package.json'), 'utf-8')
).pnpm?.overrides;

const overrides = { ...existing_workspace_overrides };

for (const pkg_path of glob(resolve_path('../../../packages/*/package.json'))) {
	const name = JSON.parse(fs.readFileSync(pkg_path, 'utf-8')).name;
	// use `file:` protocol for opting into stricter resolve logic which catches more bugs,
	// but only on CI because it doesn't work locally for some reason
	const protocol = process.env.CI ? 'file:' : '';
	overrides[name] = `${protocol}${path.dirname(path.resolve(pkg_path))}`;
}

try {
	const kit_dir = resolve_path('../../../packages/kit');
	const ls_vite_result = execSync('pnpm ls --json vite', { cwd: kit_dir });
	const vite_version = JSON.parse(ls_vite_result.toString())[0].devDependencies.vite.version;
	overrides.vite = vite_version;
} catch (e) {
	console.error('failed to parse installed vite version from packages/kit');
	throw e;
}

// prepare test pnpm workspace
fs.rmSync(test_workspace_dir, { recursive: true, force: true });
fs.mkdirSync(test_workspace_dir, { recursive: true });
const workspace = {
	name: 'svelte-check-test-fake-pnpm-workspace',
	private: true,
	version: '0.0.0',
	pnpm: { overrides },
	devDependencies: overrides
};

fs.writeFileSync(
	path.join(test_workspace_dir, 'package.json'),
	JSON.stringify(workspace, null, '\t')
);

fs.writeFileSync(path.join(test_workspace_dir, 'pnpm-workspace.yaml'), 'packages:\n  - ./*\n');

const exec_async = promisify(exec);

beforeAll(async () => {
	await exec_async('pnpm install --no-frozen-lockfile', {
		cwd: test_workspace_dir
	});
}, 60000);

/** @param {any} pkg */
function patch_package_json(pkg) {
	Object.entries(overrides).forEach(([key, value]) => {
		if (pkg.devDependencies?.[key]) {
			pkg.devDependencies[key] = value;
		}

		if (pkg.dependencies?.[key]) {
			pkg.dependencies[key] = value;
		}

		if (!pkg.pnpm) {
			pkg.pnpm = {};
		}

		if (!pkg.pnpm.overrides) {
			pkg.pnpm.overrides = {};
		}

		pkg.pnpm.overrides = { ...pkg.pnpm.overrides, ...overrides };
	});
	pkg.private = true;
}

/**
 * Tests in different templates can be run concurrently for a nice speedup locally, but tests within a template must be run sequentially.
 * It'd be better to group tests by template, but vitest doesn't support that yet.
 * @type {Map<string, [string, () => import('node:child_process').PromiseWithChild<any>][]>}
 */
const script_test_map = new Map();

const templates = /** @type {Array<'default' | 'skeleton' | 'skeletonlib'>} */ (
	fs.readdirSync('templates')
);

for (const template of templates) {
	if (template[0] === '.') continue;

	for (const types of /** @type {const} */ (['checkjs', 'typescript'])) {
		const cwd = path.join(test_workspace_dir, `${template}-${types}`);
		fs.rmSync(cwd, { recursive: true, force: true });

		create(cwd, {
			name: `create-svelte-test-${template}-${types}`,
			template,
			types,
			prettier: true,
			eslint: true,
			playwright: false,
			vitest: false,
			svelte5: false
		});

		const pkg = JSON.parse(fs.readFileSync(path.join(cwd, 'package.json'), 'utf-8'));
		patch_package_json(pkg);

		fs.writeFileSync(path.join(cwd, 'package.json'), JSON.stringify(pkg, null, '\t') + '\n');

		// run provided scripts that are non-blocking. All of them should exit with 0
		// package script requires lib dir
		// TODO: lint should run before format
		const scripts_to_test = ['format', 'lint', 'check', 'build', 'package'].filter(
			(s) => s in pkg.scripts
		);

		for (const script of scripts_to_test) {
			const tests = script_test_map.get(script) ?? [];
			tests.push([`${template}-${types}`, () => exec_async(`pnpm ${script}`, { cwd })]);
			script_test_map.set(script, tests);
		}
	}
}

for (const [script, tests] of script_test_map) {
	describe.concurrent(
		script,
		() => {
			for (const [name, task] of tests) {
				test(name, task);
			}
		},
		{ timeout: 60000 }
	);
}

```


####### packages/create-svelte/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true,
		"target": "es2022",
		"module": "node16",
		"moduleResolution": "node16",
		"allowSyntheticDefaultImports": true,
		"strict": true
	},
	"include": ["./scripts/**/*", "./test/*.js", "./*.js"]
}

```


####### packages/create-svelte/types/index.d.ts #######

```

import { Options } from './internal.js';

/**
 * Create a new SvelteKit project.
 * @param {string} cwd - Path to the directory to create
 * @param {import('./internal').Options} options
 */
export function create(cwd: string, options: Options): Promise<void>;

```


####### packages/create-svelte/types/internal.d.ts #######

```

export type Options = {
	name: string;
	template: 'default' | 'skeleton' | 'skeletonlib';
	types: 'typescript' | 'checkjs' | null;
	prettier: boolean;
	eslint: boolean;
	playwright: boolean;
	vitest: boolean;
	svelte5?: boolean; // optional to not introduce a breaking change to the `create` API
};

export type File = {
	name: string;
	contents: string;
};

export type Condition =
	| 'eslint'
	| 'prettier'
	| 'typescript'
	| 'checkjs'
	| 'playwright'
	| 'vitest'
	| 'skeleton'
	| 'default'
	| 'skeletonlib'
	| 'svelte5';

export type Common = {
	files: Array<{
		name: string;
		include: Condition[];
		exclude: Condition[];
		contents: string;
	}>;
};

```


####### packages/create-svelte/utils.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';

/** @param {string} dir */
export function mkdirp(dir) {
	try {
		fs.mkdirSync(dir, { recursive: true });
	} catch (e) {
		if (/** @type {any} */ (e).code === 'EEXIST') return;
		throw e;
	}
}

/** @param {string} path */
export function rimraf(path) {
	(fs.rmSync || fs.rmdirSync)(path, { recursive: true, force: true });
}

/**
 * @template T
 * @param {T} x
 */
function identity(x) {
	return x;
}

/**
 * @param {string} from
 * @param {string} to
 * @param {(basename: string) => string} rename
 */
export function copy(from, to, rename = identity) {
	if (!fs.existsSync(from)) return;

	const stats = fs.statSync(from);

	if (stats.isDirectory()) {
		fs.readdirSync(from).forEach((file) => {
			copy(path.join(from, file), path.join(to, rename(file)));
		});
	} else {
		mkdirp(path.dirname(to));
		fs.copyFileSync(from, to);
	}
}

/** @param {string} path */
export function dist(path) {
	return fileURLToPath(new URL(`./dist/${path}`, import.meta.url).href);
}

/** @type {string} */
export const package_manager = get_package_manager() || 'npm';

/**
 * Supports npm, pnpm, Yarn, cnpm, bun and any other package manager that sets the
 * npm_config_user_agent env variable.
 * Thanks to https://github.com/zkochan/packages/tree/main/which-pm-runs for this code!
 */
function get_package_manager() {
	if (!process.env.npm_config_user_agent) {
		return undefined;
	}
	const user_agent = process.env.npm_config_user_agent;
	const pm_spec = user_agent.split(' ')[0];
	const separator_pos = pm_spec.lastIndexOf('/');
	const name = pm_spec.substring(0, separator_pos);
	return name === 'npminstall' ? 'cnpm' : name;
}

```


####### packages/create-svelte/vitest.config.js #######

```

import { defineConfig } from 'vitest/config';

export default defineConfig({
	test: { dir: './test', include: ['*.js'] }
});

```


####### packages/enhanced-img/CHANGELOG.md #######

# @sveltejs/enhanced-img

## 0.2.0

### Minor Changes

- feat: upgrade vite-imagetools to v7. caches build output by default ([#12055](https://github.com/sveltejs/kit/pull/12055))

## 0.1.9

### Patch Changes

- fix: support shorthand attribute syntax ([#11884](https://github.com/sveltejs/kit/pull/11884))

## 0.1.8

### Patch Changes

- fix: correct images cache key to avoid collisions when images have same name ([#11602](https://github.com/sveltejs/kit/pull/11602))

## 0.1.7

### Patch Changes

- chore: update primary branch from master to main ([`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d))

- fix: throw an error if image cannot be resolved ([#11346](https://github.com/sveltejs/kit/pull/11346))

- fix: attempt to address issues accessing images on filesystem ([#11403](https://github.com/sveltejs/kit/pull/11403))

## 0.1.6

### Patch Changes

- chore: upgrade vite-imagetools ([#11122](https://github.com/sveltejs/kit/pull/11122))

## 0.1.5

### Patch Changes

- fix: correctly generate client-side code ([#11059](https://github.com/sveltejs/kit/pull/11059))

## 0.1.4

### Patch Changes

- fix: avoid creating conflicting import statements ([#11047](https://github.com/sveltejs/kit/pull/11047))

## 0.1.3

### Patch Changes

- fix: only resolve images if optimizable ([#11041](https://github.com/sveltejs/kit/pull/11041))

## 0.1.2

### Patch Changes

- fix: refresh in dev mode when an image changes ([#11033](https://github.com/sveltejs/kit/pull/11033))

- fix: auto-import of svg images ([`4426daebe`](https://github.com/sveltejs/kit/commit/4426daebe1d345f60554225e3f12ea932b0110e4))

## 0.1.1

### Patch Changes

- feat: add experimental `@sveltejs/enhanced-img` package ([#10788](https://github.com/sveltejs/kit/pull/10788))

####### packages/enhanced-img/package.json #######

```

{
	"name": "@sveltejs/enhanced-img",
	"version": "0.2.0",
	"description": "Image optimization for your Svelte apps",
	"repository": {
		"type": "git",
		"url": "https://github.com/sveltejs/kit",
		"directory": "packages/image"
	},
	"license": "MIT",
	"homepage": "https://kit.svelte.dev",
	"type": "module",
	"scripts": {
		"lint": "prettier --check .",
		"check": "tsc",
		"format": "prettier --write .",
		"test": "vitest run"
	},
	"files": [
		"src",
		"types"
	],
	"exports": {
		"types": "./types/index.d.ts",
		"import": "./src/index.js"
	},
	"types": "types/index.d.ts",
	"dependencies": {
		"magic-string": "^0.30.5",
		"svelte-parse-markup": "^0.1.2",
		"vite-imagetools": "^7.0.1"
	},
	"devDependencies": {
		"@types/estree": "^1.0.5",
		"@types/node": "^18.19.3",
		"estree-walker": "^3.0.3",
		"rollup": "^4.14.2",
		"svelte": "^4.2.10",
		"typescript": "^5.3.3",
		"vite": "^5.2.8",
		"vitest": "^1.5.0"
	}
}

```


####### packages/enhanced-img/README.md #######

# `@sveltejs/enhanced-img`

A Vite plugin which runs a Svelte preprocessor to locate images and then transform them at build-time.

**WARNING**: This package is experimental. It uses pre-1.0 versioning and may introduce breaking changes with every minor version release.

## Docs

[Docs](https://kit.svelte.dev/docs/images)

## Changelog

[The Changelog for this package is available on GitHub](https://github.com/sveltejs/kit/blob/main/packages/enhanced-img/CHANGELOG.md).

## Acknowledgements

We'd like to thank the author of `svelte-preprocess-import-assets`, which this code is partially based off of. We'd also like to thank the authors of `vite-imagetools` which is used in `@sveltejs/enhanced-img`.

####### packages/enhanced-img/src/index.js #######

```

import path from 'node:path';
import { imagetools } from 'vite-imagetools';
import { image } from './preprocessor.js';

/**
 * @returns {Promise<import('vite').Plugin[]>}
 */
export async function enhancedImages() {
	const imagetools_instance = await imagetools_plugin();
	return !process.versions.webcontainer
		? [image_plugin(imagetools_instance), imagetools_instance]
		: [];
}

/**
 * Creates the Svelte image plugin which provides the preprocessor.
 * @param {import('vite').Plugin} imagetools_plugin
 * @returns {import('vite').Plugin}
 */
function image_plugin(imagetools_plugin) {
	/**
	 * @type {{
	 *   plugin_context: import('vite').Rollup.PluginContext
	 *   vite_config: import('vite').ResolvedConfig
	 *   imagetools_plugin: import('vite').Plugin
	 * }}
	 */
	const opts = {
		// @ts-expect-error populated when build starts so we cheat on type
		plugin_context: undefined,
		// @ts-expect-error populated when build starts so we cheat on type
		vite_config: undefined,
		imagetools_plugin
	};
	const preprocessor = image(opts);

	return {
		name: 'vite-plugin-enhanced-img',
		api: {
			sveltePreprocess: preprocessor
		},
		configResolved(config) {
			opts.vite_config = config;
		},
		buildStart() {
			opts.plugin_context = this;
		}
	};
}

/** @type {Record<string,string>} */
const fallback = {
	'.avif': 'png',
	'.gif': 'gif',
	'.heif': 'jpg',
	'.jpeg': 'jpg',
	'.jpg': 'jpg',
	'.png': 'png',
	'.tiff': 'jpg',
	'.webp': 'png'
};

async function imagetools_plugin() {
	/** @type {Partial<import('vite-imagetools').VitePluginOptions>} */
	const imagetools_opts = {
		defaultDirectives: async ({ pathname, searchParams: qs }, metadata) => {
			if (!qs.has('enhanced')) return new URLSearchParams();

			const img_width = qs.get('imgWidth');
			const width = img_width ? parseInt(img_width) : (await metadata()).width;
			if (!width) {
				console.warn(`Could not determine width of image ${pathname}`);
				return new URLSearchParams();
			}

			const { widths, kind } = get_widths(width, qs.get('imgSizes'));
			return new URLSearchParams({
				as: 'picture',
				format: `avif;webp;${fallback[path.extname(pathname)] ?? 'png'}`,
				w: widths.join(';'),
				...(kind === 'x' && !qs.has('w') && { basePixels: widths[0].toString() })
			});
		},
		namedExports: false
	};

	// TODO: should we make formats or sizes configurable besides just letting people override defaultDirectives?
	// TODO: generate img rather than picture if only a single format is provided
	//     by resolving the directives for the URL in the preprocessor
	return imagetools(imagetools_opts);
}

/**
 * @param {number} width
 * @param {string | null} sizes
 * @returns {{ widths: number[]; kind: 'w' | 'x' }}
 */
function get_widths(width, sizes) {
	// We don't really know what the user wants here. But if they have an image that's really big
	// then we can probably assume they're always displaying it full viewport/breakpoint.
	// If the user is displaying a responsive image then the size usually doesn't change that much
	// Instead, the number of columns in the design may reduce and the image may take a greater
	// fraction of the screen.
	// Assume if they're bothering to specify sizes that it's going to take most of the screen
	// as that's the case where an image may be rendered at very different sizes. Otherwise, it's
	// probably a responsive image and a single size is okay (two when accounting for HiDPI).
	if (sizes) {
		// Use common device sizes. Doesn't hurt to include larger sizes as the user will rarely
		// provide an image that large.
		// https://screensiz.es/
		// https://gs.statcounter.com/screen-resolution-stats (note: logical. we want physical)
		// Include 1080 because lighthouse uses a moto g4 with 360 logical pixels and 3x pixel ratio.
		const widths = [540, 768, 1080, 1366, 1536, 1920, 2560, 3000, 4096, 5120];
		widths.push(width);
		return { widths, kind: 'w' };
	}

	// Don't need more than 2x resolution. Note that due to this optimization, pixel density
	// descriptors will often end up being cheaper as many mobile devices have pixel density ratios
	// near 3 which would cause larger images to be chosen on mobile when using sizes.

	// Most OLED screens that say they are 3x resolution, are actually 3x in the green color, but
	// only 1.5x in the red and blue colors. Showing a 3x resolution image in the app vs a 2x
	// resolution image will be visually the same, though the 3x image takes significantly more
	// data. Even true 3x resolution screens are wasteful as the human eye cannot see that level of
	// detail without something like a magnifying glass.
	// https://blog.twitter.com/engineering/en_us/topics/infrastructure/2019/capping-image-fidelity-on-ultra-high-resolution-devices.html
	return { widths: [Math.round(width / 2), width], kind: 'x' };
}

```


####### packages/enhanced-img/src/preprocessor.js #######

```

import { existsSync } from 'node:fs';
import * as path from 'node:path';

import MagicString from 'magic-string';
import { asyncWalk } from 'estree-walker';
import { parse } from 'svelte-parse-markup';

const ASSET_PREFIX = '___ASSET___';

// TODO: expose this in vite-imagetools rather than duplicating it
const OPTIMIZABLE = /^[^?]+\.(avif|heif|gif|jpeg|jpg|png|tiff|webp)(\?.*)?$/;

/**
 * @param {{
 *   plugin_context: import('vite').Rollup.PluginContext
 *   vite_config: import('vite').ResolvedConfig
 *   imagetools_plugin: import('vite').Plugin
 * }} opts
 * @returns {import('svelte/types/compiler/preprocess').PreprocessorGroup}
 */
export function image(opts) {
	// TODO: clear this map in dev mode to avoid memory leak
	/**
	 * URL to image details
	 * @type {Map<string, import('vite-imagetools').Picture>}
	 */
	const images = new Map();

	return {
		async markup({ content, filename }) {
			if (!content.includes('<enhanced:img')) {
				return;
			}

			const s = new MagicString(content);
			const ast = parse(content, { filename });

			// Import path to import name
			// e.g. ./foo.png => ___ASSET___0
			/** @type {Map<string, string>} */
			const imports = new Map();

			/**
			 * @param {import('svelte/types/compiler/interfaces').TemplateNode} node
			 * @param {{ type: string, start: number, end: number, raw: string }} src_attribute
			 * @returns {Promise<void>}
			 */
			async function update_element(node, src_attribute) {
				// TODO: this will become ExpressionTag in Svelte 5
				if (src_attribute.type === 'MustacheTag') {
					const src_var_name = content
						.substring(src_attribute.start + 1, src_attribute.end - 1)
						.trim();
					s.update(node.start, node.end, dynamic_img_to_picture(content, node, src_var_name));
					return;
				} else if (src_attribute.type === 'AttributeShorthand') {
					const src_var_name = content.substring(src_attribute.start, src_attribute.end).trim();
					s.update(node.start, node.end, dynamic_img_to_picture(content, node, src_var_name));
					return;
				}

				const original_url = src_attribute.raw.trim();
				let url = original_url;

				const sizes = get_attr_value(node, 'sizes');
				const width = get_attr_value(node, 'width');
				url += url.includes('?') ? '&' : '?';
				if (sizes) {
					url += 'imgSizes=' + encodeURIComponent(sizes.raw) + '&';
				}
				if (width) {
					url += 'imgWidth=' + encodeURIComponent(width.raw) + '&';
				}
				url += 'enhanced';

				if (OPTIMIZABLE.test(url)) {
					// resolves the import so that we can build the entire picture template string and don't
					// need any logic blocks
					const resolved_id = (await opts.plugin_context.resolve(url, filename))?.id;
					if (!resolved_id) {
						const file_path = url.substring(0, url.indexOf('?'));
						if (existsSync(path.resolve(opts.vite_config.publicDir, file_path))) {
							throw new Error(
								`Could not locate ${file_path}. Please move it to be located relative to the page in the routes directory or reference it beginning with /static/. See https://vitejs.dev/guide/assets for more details on referencing assets.`
							);
						}
						throw new Error(
							`Could not locate ${file_path}. See https://vitejs.dev/guide/assets for more details on referencing assets.`
						);
					}

					let image = images.get(resolved_id);
					if (!image) {
						image = await process(resolved_id, opts);
						images.set(resolved_id, image);
					}
					s.update(node.start, node.end, img_to_picture(content, node, image));
				} else {
					// e.g. <img src="./foo.svg" /> => <img src={___ASSET___0} />
					const name = ASSET_PREFIX + imports.size;
					const { start, end } = src_attribute;
					// update src with reference to imported asset
					s.update(
						is_quote(content, start - 1) ? start - 1 : start,
						is_quote(content, end) ? end + 1 : end,
						`{${name}}`
					);
					// update `enhanced:img` to `img`
					s.update(node.start + 1, node.start + 1 + 'enhanced:img'.length, 'img');
					imports.set(original_url, name);
				}
			}

			// TODO: switch to zimmerframe with Svelte 5
			// @ts-ignore
			await asyncWalk(ast.html, {
				/**
				 * @param {import('svelte/types/compiler/interfaces').TemplateNode} node
				 */
				async enter(node) {
					if (node.type === 'Element') {
						// Compare node tag match
						if (node.name === 'enhanced:img') {
							const src = get_attr_value(node, 'src');
							if (!src) return;
							await update_element(node, src);
						}
					}
				}
			});

			// add imports
			if (imports.size) {
				let import_text = '';
				for (const [path, import_name] of imports.entries()) {
					import_text += `import ${import_name} from "${path}";`;
				}
				if (ast.instance) {
					// @ts-ignore
					s.appendLeft(ast.instance.content.start, import_text);
				} else {
					s.append(`<script>${import_text}</script>`);
				}
			}

			return {
				code: s.toString(),
				map: s.generateMap()
			};
		}
	};
}

/**
 * @param {string} content
 * @param {number} index
 * @returns {boolean}
 */
function is_quote(content, index) {
	return content.charAt(index) === '"' || content.charAt(index) === "'";
}

/**
 * @param {string} resolved_id
 * @param {{
 *   plugin_context: import('vite').Rollup.PluginContext
 *   imagetools_plugin: import('vite').Plugin
 * }} opts
 * @returns {Promise<import('vite-imagetools').Picture>}
 */
async function process(resolved_id, opts) {
	if (!opts.imagetools_plugin.load) {
		throw new Error('Invalid instance of vite-imagetools. Could not find load method.');
	}
	const hook = opts.imagetools_plugin.load;
	const handler = typeof hook === 'object' ? hook.handler : hook;
	const module_info = await handler.call(opts.plugin_context, resolved_id);
	if (!module_info) {
		throw new Error(`Could not load ${resolved_id}`);
	}
	const code = typeof module_info === 'string' ? module_info : module_info.code;
	return parseObject(code.replace('export default', '').replace(/;$/, '').trim());
}

/**
 * @param {string} str
 */
export function parseObject(str) {
	const updated = str
		.replaceAll(/{(\n\s*)?/gm, '{"')
		.replaceAll(':', '":')
		.replaceAll(/,(\n\s*)?([^ ])/g, ',"$2');
	try {
		return JSON.parse(updated);
	} catch (err) {
		throw new Error(`Failed parsing string to object: ${str}`);
	}
}

/**
 * @param {import('svelte/types/compiler/interfaces').TemplateNode} node
 * @param {string} attr
 */
function get_attr_value(node, attr) {
	const attribute = node.attributes.find(
		/** @param {any} v */ (v) => v.type === 'Attribute' && v.name === attr
	);

	if (!attribute) return;

	return attribute.value[0];
}

/**
 * @param {string} content
 * @param {Array<import('svelte/types/compiler/interfaces').BaseDirective | import('svelte/types/compiler/interfaces').Attribute | import('svelte/types/compiler/interfaces').SpreadAttribute>} attributes
 * @param {{
 *   src: string,
 *   width: string | number,
 *   height: string | number
 * }} details
 */
function img_attributes_to_markdown(content, attributes, details) {
	const attribute_strings = attributes.map((attribute) => {
		if (attribute.name === 'src') {
			return `src=${details.src}`;
		}
		return content.substring(attribute.start, attribute.end);
	});

	/** @type {number | undefined} */
	let user_width;
	/** @type {number | undefined} */
	let user_height;
	for (const attribute of attributes) {
		if (attribute.name === 'width') user_width = parseInt(attribute.value[0]);
		if (attribute.name === 'height') user_height = parseInt(attribute.value[0]);
	}
	if (!user_width && !user_height) {
		attribute_strings.push(`width=${details.width}`);
		attribute_strings.push(`height=${details.height}`);
	} else if (!user_width && user_height) {
		attribute_strings.push(
			`width=${Math.round(
				(stringToNumber(details.width) * user_height) / stringToNumber(details.height)
			)}`
		);
	} else if (!user_height && user_width) {
		attribute_strings.push(
			`height=${Math.round(
				(stringToNumber(details.height) * user_width) / stringToNumber(details.width)
			)}`
		);
	}

	return attribute_strings.join(' ');
}

/**
 * @param {string|number} param
 */
function stringToNumber(param) {
	return typeof param === 'string' ? parseInt(param) : param;
}

/**
 * @param {string} content
 * @param {import('svelte/types/compiler/interfaces').TemplateNode} node
 * @param {import('vite-imagetools').Picture} image
 */
function img_to_picture(content, node, image) {
	/** @type {Array<import('svelte/types/compiler/interfaces').BaseDirective | import('svelte/types/compiler/interfaces').Attribute | import('svelte/types/compiler/interfaces').SpreadAttribute>} attributes */
	const attributes = node.attributes;
	const index = attributes.findIndex((attribute) => attribute.name === 'sizes');
	let sizes_string = '';
	if (index >= 0) {
		sizes_string = ' ' + content.substring(attributes[index].start, attributes[index].end);
		attributes.splice(index, 1);
	}

	let res = '<picture>';
	for (const [format, srcset] of Object.entries(image.sources)) {
		res += `<source srcset={"${srcset}"}${sizes_string} type="image/${format}" />`;
	}
	// Need to handle src differently when using either Vite's renderBuiltUrl or relative base path in Vite.
	// See https://github.com/vitejs/vite/blob/b93dfe3e08f56cafe2e549efd80285a12a3dc2f0/packages/vite/src/node/plugins/asset.ts#L132
	const src =
		image.img.src.startsWith('"+') && image.img.src.endsWith('+"')
			? `{"${image.img.src.substring(2, image.img.src.length - 2)}"}`
			: `"${image.img.src}"`;
	res += `<img ${img_attributes_to_markdown(content, attributes, {
		src,
		width: image.img.w,
		height: image.img.h
	})} />`;
	res += '</picture>';
	return res;
}

/**
 * For images like `<img src={manually_imported} />`
 * @param {string} content
 * @param {import('svelte/types/compiler/interfaces').TemplateNode} node
 * @param {string} src_var_name
 */
function dynamic_img_to_picture(content, node, src_var_name) {
	/** @type {Array<import('svelte/types/compiler/interfaces').BaseDirective | import('svelte/types/compiler/interfaces').Attribute | import('svelte/types/compiler/interfaces').SpreadAttribute>} attributes */
	const attributes = node.attributes;
	const index = attributes.findIndex((attribute) => attribute.name === 'sizes');
	let sizes_string = '';
	if (index >= 0) {
		sizes_string = ' ' + content.substring(attributes[index].start, attributes[index].end);
		attributes.splice(index, 1);
	}

	const details = {
		src: `{${src_var_name}.img.src}`,
		width: `{${src_var_name}.img.w}`,
		height: `{${src_var_name}.img.h}`
	};

	return `{#if typeof ${src_var_name} === 'string'}
	<img ${img_attributes_to_markdown(content, node.attributes, details)} />
{:else}
	<picture>
		{#each Object.entries(${src_var_name}.sources) as [format, srcset]}
			<source {srcset}${sizes_string} type={'image/' + format} />
		{/each}
		<img ${img_attributes_to_markdown(content, attributes, details)} />
	</picture>
{/if}`;
}

```


####### packages/enhanced-img/test/Input.svelte #######

```

<script lang="ts">
	import manual_image1 from './no.png';
	import manual_image2 from './no.svg';

	const src = manual_image1;
	const images = [manual_image1, manual_image2];

	let foo: string = 'bar';
</script>

{foo}

<img src="./foo.png" alt="non-enhanced test" />

<enhanced:img src="./foo.png" alt="basic test" />

<enhanced:img src="./foo.png" width="5" height="10" alt="dimensions test" />

<enhanced:img src="./foo.png?blur=5" alt="directive test" />

<enhanced:img src="./foo.png" {...{ foo }} alt="spread attributes test" />

<enhanced:img
	src="./foo.png?w=1024,640,320"
	sizes="(min-width: 60rem) 80vw, (min-width: 40rem) 90vw, 100vw"
	alt="sizes test"
/>

<enhanced:img src="./foo.png" on:click={(foo = 'clicked an image!')} alt="event handler test" />

<enhanced:img src="$lib/foo.png" alt="alias test" />

<enhanced:img src="/src/foo.png" alt="absolute path test" />

<enhanced:img {src} alt="attribute shorthand test" />

<enhanced:img src="./foo.svg" alt="svg test" />

{#each images as image}
	<enhanced:img src={image} alt="opt-in test" />
{/each}

<picture>
	<source src="./foo.avif" />
	<source srcset="./foo.avif 500v ./bar.avif 100v" />
	<source srcset="./foo.avif, ./bar.avif 1v" />
</picture>

```


####### packages/enhanced-img/test/Output.svelte #######

```

<script lang="ts">
	import ___ASSET___0 from "./foo.svg";
	
	import manual_image1 from './no.png';
	
	import manual_image2 from './no.svg';

	const src = manual_image1;
	const images = [manual_image1, manual_image2];

	let foo: string = 'bar';
</script>

{foo}

<img src="./foo.png" alt="non-enhanced test" />

<picture><source srcset={"/1 1440w, /2 960w"} type="image/avif" /><source srcset={"/3 1440w, /4 960w"} type="image/webp" /><source srcset={"5 1440w, /6 960w"} type="image/png" /><img src="/7" alt="basic test" width=1440 height=1440 /></picture>

<picture><source srcset={"/1 1440w, /2 960w"} type="image/avif" /><source srcset={"/3 1440w, /4 960w"} type="image/webp" /><source srcset={"5 1440w, /6 960w"} type="image/png" /><img src="/7" width="5" height="10" alt="dimensions test" width=1440 height=1440 /></picture>

<picture><source srcset={"/1 1440w, /2 960w"} type="image/avif" /><source srcset={"/3 1440w, /4 960w"} type="image/webp" /><source srcset={"5 1440w, /6 960w"} type="image/png" /><img src="/7" alt="directive test" width=1440 height=1440 /></picture>

<picture><source srcset={"/1 1440w, /2 960w"} type="image/avif" /><source srcset={"/3 1440w, /4 960w"} type="image/webp" /><source srcset={"5 1440w, /6 960w"} type="image/png" /><img src="/7" {...{ foo }} alt="spread attributes test" width=1440 height=1440 /></picture>

<picture><source srcset={"/1 1440w, /2 960w"} sizes="(min-width: 60rem) 80vw, (min-width: 40rem) 90vw, 100vw" type="image/avif" /><source srcset={"/3 1440w, /4 960w"} sizes="(min-width: 60rem) 80vw, (min-width: 40rem) 90vw, 100vw" type="image/webp" /><source srcset={"5 1440w, /6 960w"} sizes="(min-width: 60rem) 80vw, (min-width: 40rem) 90vw, 100vw" type="image/png" /><img src="/7" alt="sizes test" width=1440 height=1440 /></picture>

<picture><source srcset={"/1 1440w, /2 960w"} type="image/avif" /><source srcset={"/3 1440w, /4 960w"} type="image/webp" /><source srcset={"5 1440w, /6 960w"} type="image/png" /><img src="/7" on:click={(foo = 'clicked an image!')} alt="event handler test" width=1440 height=1440 /></picture>

<picture><source srcset={"/1 1440w, /2 960w"} type="image/avif" /><source srcset={"/3 1440w, /4 960w"} type="image/webp" /><source srcset={"5 1440w, /6 960w"} type="image/png" /><img src="/7" alt="alias test" width=1440 height=1440 /></picture>

<picture><source srcset={"/1 1440w, /2 960w"} type="image/avif" /><source srcset={"/3 1440w, /4 960w"} type="image/webp" /><source srcset={"5 1440w, /6 960w"} type="image/png" /><img src="/7" alt="absolute path test" width=1440 height=1440 /></picture>

{#if typeof src === 'string'}
	<img src={src.img.src} alt="attribute shorthand test" width={src.img.w} height={src.img.h} />
{:else}
	<picture>
		{#each Object.entries(src.sources) as [format, srcset]}
			<source {srcset} type={'image/' + format} />
		{/each}
		<img src={src.img.src} alt="attribute shorthand test" width={src.img.w} height={src.img.h} />
	</picture>
{/if}

<img src={___ASSET___0} alt="svg test" />

{#each images as image}
	{#if typeof image === 'string'}
	<img src={image.img.src} alt="opt-in test" width={image.img.w} height={image.img.h} />
{:else}
	<picture>
		{#each Object.entries(image.sources) as [format, srcset]}
			<source {srcset} type={'image/' + format} />
		{/each}
		<img src={image.img.src} alt="opt-in test" width={image.img.w} height={image.img.h} />
	</picture>
{/if}
{/each}

<picture>
	<source src="./foo.avif" />
	<source srcset="./foo.avif 500v ./bar.avif 100v" />
	<source srcset="./foo.avif, ./bar.avif 1v" />
</picture>

```


####### packages/enhanced-img/test/preprocessor.spec.js #######

```

import fs from 'node:fs/promises';
import path from 'node:path';
import { preprocess } from 'svelte/compiler';
import { expect, it } from 'vitest';
import { image, parseObject } from '../src/preprocessor.js';

const resolve = /** @param {string} file */ (file) => path.resolve(__dirname, file);

it('Image preprocess snapshot test', async () => {
	const filename = 'Input.svelte';
	const processed = await preprocess(
		await fs.readFile(resolve(filename), { encoding: 'utf-8' }),
		[
			image({
				plugin_context: {
					// @ts-ignore
					resolve(url) {
						return { id: url };
					}
				},
				// @ts-ignore
				imagetools_plugin: {
					load() {
						return 'export default {sources:{avif:"/1 1440w, /2 960w",webp:"/3 1440w, /4 960w",png:"5 1440w, /6 960w"},img:{src:"/7",w:1440,h:1440}};';
					}
				}
			})
		],
		{ filename }
	);

	// Make imports readable
	const ouput = processed.code.replace(/import/g, '\n\timport');

	expect(ouput).toMatchFileSnapshot('./Output.svelte');
});

it('parses a minimized object', () => {
	const parsed = parseObject(
		'{sources:{avif:"/@imagetools/aa851ecbdef6d98bef38810ea9212d3d4cd9712c 1440w, /@imagetools/f5bc22df4071ea198fea2206d55b7bf5f5fc83e6 960w",webp:"/@imagetools/e8afd7da22a03ee0ae914cbfac6c714bded6daaf 1440w, /@imagetools/a5a1cd19d9fdd0754c3dc5122798c31ad3586041 960w",png:"/@imagetools/216a9a139bef55f2d6d70f91bcffe8584152136b 1440w, /@imagetools/e060ca6e665a6e50a24d00e3a7be2a7c96fdeb64 960w"},img:{src:"/@imagetools/216a9a139bef55f2d6d70f91bcffe8584152136b",w:1440,h:1440}}'
	);
	expect(parsed).toBeDefined();
});

it('parses a non-minimized object', () => {
	const parsed = parseObject(
		`{
			sources: {
				avif: "__VITE_ASSET__f63692be__ 1440w, __VITE_ASSET__7c12aaf8__ 960w",
				webp: "__VITE_ASSET__60e1d553__ 1440w, __VITE_ASSET__d0e3c982__ 960w",
				png: "__VITE_ASSET__ac99f329__ 1440w, __VITE_ASSET__33d52b23__ 960w"
			},
			img: {
				src: "__VITE_ASSET__ac99f329__",
				w: 1440,
				h: 1440
			}
		}`
	);
	expect(parsed).toBeDefined();
});

```


####### packages/enhanced-img/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true,
		"strict": true,
		"target": "es2022",
		"module": "node16",
		"moduleResolution": "node16",
		"allowSyntheticDefaultImports": true,
		"paths": {
			"types": ["./types/index"],
			"types/*": ["./types/*"]
		},
		"noUnusedLocals": true,
		"noUnusedParameters": true
	},
	"include": ["src/**/*", "types/**/*", "test/**/*"]
}

```


####### packages/enhanced-img/types/ambient.d.ts #######

```

declare module '*?enhanced' {
	const value: string;
	export default value;
}

```


####### packages/enhanced-img/types/index.d.ts #######

```

import type { Plugin } from 'vite';
import './ambient.js';
import { HTMLImgAttributes } from 'svelte/elements';

// https://svelte.dev/docs/typescript#enhancing-built-in-dom-types
declare module 'svelte/elements' {
	export interface SvelteHTMLElements {
		'enhanced:img': HTMLImgAttributes;
	}
}

export function enhancedImages(): Promise<Plugin[]>;

```


####### packages/kit/CHANGELOG.md #######

# @sveltejs/kit

## 2.5.7

### Patch Changes

- chore(deps): update devalue to v5 ignore non-enumerable symbols during serialization ([#12141](https://github.com/sveltejs/kit/pull/12141))

## 2.5.6

### Patch Changes

- fix: avoid incorrectly un- and re-escaping cookies collected during a server-side `fetch` ([#11904](https://github.com/sveltejs/kit/pull/11904))

## 2.5.5

### Patch Changes

- fix: only hydrate when page is server-rendered ([#12050](https://github.com/sveltejs/kit/pull/12050))

## 2.5.4

### Patch Changes

- fix: prevent navigation when `data-sveltekit-preload-data` fails to fetch due to network error ([#11944](https://github.com/sveltejs/kit/pull/11944))

## 2.5.3

### Patch Changes

- fix: revert tsconfig change that includes svelte.config.js ([#11908](https://github.com/sveltejs/kit/pull/11908))

- fix: exclude server worker from tsconfig again ([#11727](https://github.com/sveltejs/kit/pull/11727))

## 2.5.2

### Patch Changes

- fix: tsconfig includes should cover svelte.config.js ([#11886](https://github.com/sveltejs/kit/pull/11886))

## 2.5.1

### Patch Changes

- fix: prevent stale values after invalidation ([#11870](https://github.com/sveltejs/kit/pull/11870))

- fix: prevent false positive `history.pushState` and `history.replaceState` warnings ([#11858](https://github.com/sveltejs/kit/pull/11858))

- fix: relax status code types ([#11781](https://github.com/sveltejs/kit/pull/11781))

- fix: `popstate` navigations take `pushState` navigations into account ([#11765](https://github.com/sveltejs/kit/pull/11765))

## 2.5.0

### Minor Changes

- feat: dev/preview/prerender platform emulation ([#11730](https://github.com/sveltejs/kit/pull/11730))

### Patch Changes

- fix: strip `/@fs` prefix correctly on Windows when invoking `read()` in dev mode ([#11728](https://github.com/sveltejs/kit/pull/11728))

## 2.4.3

### Patch Changes

- fix: only disallow body with GET/HEAD ([#11710](https://github.com/sveltejs/kit/pull/11710))

## 2.4.2

### Patch Changes

- fix: ignore bodies sent with non-PUT/PATCH/POST requests ([#11708](https://github.com/sveltejs/kit/pull/11708))

## 2.4.1

### Patch Changes

- fix: use Vite's default value for `build.target` and respect override supplied by user ([#11688](https://github.com/sveltejs/kit/pull/11688))

- fix: properly decode base64 strings inside `read` ([#11682](https://github.com/sveltejs/kit/pull/11682))

- fix: default route config to `{}` for feature checking ([#11685](https://github.com/sveltejs/kit/pull/11685))

- fix: handle `onNavigate` callbacks correctly ([#11678](https://github.com/sveltejs/kit/pull/11678))

## 2.4.0

### Minor Changes

- feat: add `$app/server` module with `read` function for reading assets from filesystem ([#11649](https://github.com/sveltejs/kit/pull/11649))

## 2.3.5

### Patch Changes

- fix: log a warning if fallback page overwrites prerendered page ([#11661](https://github.com/sveltejs/kit/pull/11661))

## 2.3.4

### Patch Changes

- fix: don't stash away original `history` methods so other libs can monkeypatch it ([#11657](https://github.com/sveltejs/kit/pull/11657))

## 2.3.3

### Patch Changes

- fix: remove internal `__sveltekit/` module declarations from types ([#11620](https://github.com/sveltejs/kit/pull/11620))

## 2.3.2

### Patch Changes

- fix: return plaintext 404 for anything under appDir ([#11597](https://github.com/sveltejs/kit/pull/11597))

- fix: populate dynamic public env without using top-level await, which fails in Safari ([#11601](https://github.com/sveltejs/kit/pull/11601))

## 2.3.1

### Patch Changes

- fix: amend onNavigate type ([#11599](https://github.com/sveltejs/kit/pull/11599))

- fix: better error message when peer dependency cannot be found ([#11598](https://github.com/sveltejs/kit/pull/11598))

## 2.3.0

### Minor Changes

- feat: add `reroute` hook ([#11537](https://github.com/sveltejs/kit/pull/11537))

## 2.2.2

### Patch Changes

- fix: only add nonce to `style-src` CSP directive when `unsafe-inline` is not present ([#11575](https://github.com/sveltejs/kit/pull/11575))

## 2.2.1

### Patch Changes

- feat: add CSP support for style-src-elem ([#11562](https://github.com/sveltejs/kit/pull/11562))

- fix: address CSP conflicts with sha/nonce during dev ([#11562](https://github.com/sveltejs/kit/pull/11562))

## 2.2.0

### Minor Changes

- feat: expose `$env/static/public` in service workers ([#10994](https://github.com/sveltejs/kit/pull/10994))

### Patch Changes

- fix: reload page on startup if `document.URL` contains credentials ([#11179](https://github.com/sveltejs/kit/pull/11179))

## 2.1.2

### Patch Changes

- fix: restore invalid route error message during build process ([#11559](https://github.com/sveltejs/kit/pull/11559))

## 2.1.1

### Patch Changes

- fix: respect the trailing slash option when navigating from the basepath root page ([#11388](https://github.com/sveltejs/kit/pull/11388))

- chore: shrink error messages shipped to client ([#11551](https://github.com/sveltejs/kit/pull/11551))

## 2.1.0

### Minor Changes

- feat: make client router treeshakeable ([#11340](https://github.com/sveltejs/kit/pull/11340))

### Patch Changes

- chore: reduce client bundle size ([#11547](https://github.com/sveltejs/kit/pull/11547))

## 2.0.8

### Patch Changes

- fix: always scroll to top when clicking a # or #top link ([`099608c428a49504785eab3afe3b2e76a9317bdf`](https://github.com/sveltejs/kit/commit/099608c428a49504785eab3afe3b2e76a9317bdf))

- fix: add nonce or hash to "script-src-elem", "style-src-attr" and "style-src-elem" if defined in CSP config ([#11485](https://github.com/sveltejs/kit/pull/11485))

- fix: decode server data with `stream: true` during client-side navigation ([#11409](https://github.com/sveltejs/kit/pull/11409))

- fix: capture scroll position when using `pushState` ([#11540](https://github.com/sveltejs/kit/pull/11540))

- chore: use peer dependencies when linked ([#11433](https://github.com/sveltejs/kit/pull/11433))

## 2.0.7

### Patch Changes

- chore: removed deprecated config.package type ([#11462](https://github.com/sveltejs/kit/pull/11462))

## 2.0.6

### Patch Changes

- fix: allow dynamic env access when building but not prerendering ([#11436](https://github.com/sveltejs/kit/pull/11436))

## 2.0.5

### Patch Changes

- fix: render SPA shell when SSR is turned off and there is no server data ([#11405](https://github.com/sveltejs/kit/pull/11405))

- fix: upgrade `sirv` and `mrmime` to modernize javascript mime type ([#11419](https://github.com/sveltejs/kit/pull/11419))

## 2.0.4

### Patch Changes

- chore: update primary branch from master to main ([`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d))

- fix: adjust missing inner content warning ([#11394](https://github.com/sveltejs/kit/pull/11394))

- fix: prevent esbuild adding phantom exports to service worker ([#11400](https://github.com/sveltejs/kit/pull/11400))

- fix: goto type include state ([#11398](https://github.com/sveltejs/kit/pull/11398))

- fix: ensure assets are served gzip in preview ([#11377](https://github.com/sveltejs/kit/pull/11377))

## 2.0.3

### Patch Changes

- fix: reinstantiate state parameter for goto ([#11342](https://github.com/sveltejs/kit/pull/11342))

## 2.0.2

### Patch Changes

- fix: prevent endless SPA 404 loop ([#11354](https://github.com/sveltejs/kit/pull/11354))

## 2.0.1

### Patch Changes

- fix: correctly handle trailing slash redirect when navigating from the root page ([#11357](https://github.com/sveltejs/kit/pull/11357))

## 2.0.0

### Major Changes

- breaking: remove top-level promise awaiting ([#11176](https://github.com/sveltejs/kit/pull/11176))

- breaking: prevent use of dynamic env vars during prerendering, serve env vars dynamically ([#11277](https://github.com/sveltejs/kit/pull/11277))

- breaking: remove deprecated `use:enhance` callback values ([#11282](https://github.com/sveltejs/kit/pull/11282))

- breaking: turn `error` and `redirect` into commands ([#11165](https://github.com/sveltejs/kit/pull/11165))

- breaking: the type for `depends` now requires a `:` as part of the string ([#11201](https://github.com/sveltejs/kit/pull/11201))

- breaking: remove baseUrl fallback from generated tsconfig ([#11294](https://github.com/sveltejs/kit/pull/11294))

- breaking: fail if route with +page and +server is marked prerenderable ([#11256](https://github.com/sveltejs/kit/pull/11256))

- breaking: remove `resolvePath` in favour of `resolveRoute` from `$app/paths` ([#11265](https://github.com/sveltejs/kit/pull/11265))

- breaking: drop support for Svelte 3 ([#11168](https://github.com/sveltejs/kit/pull/11168))

- breaking: require Vite 5.0.3+ ([#11122](https://github.com/sveltejs/kit/pull/11122))

- breaking: generate `__data.json` files as sibling to `.html` files ([#11269](https://github.com/sveltejs/kit/pull/11269))

- breaking: fail if +page and +server have mismatched config ([#11256](https://github.com/sveltejs/kit/pull/11256))

- breaking: error if form without multipart/form-data enctype contains a file input ([#11282](https://github.com/sveltejs/kit/pull/11282))

- breaking: require paths pass to preloadCode to be prefixed with basepath ([#11259](https://github.com/sveltejs/kit/pull/11259))

- breaking: `@sveltejs/vite-plugin-svelte` is now a peer dependency and will need to be installed in each project using SvelteKit ([#11184](https://github.com/sveltejs/kit/pull/11184))

- breaking: stop re-exporting vitePreprocess ([#11297](https://github.com/sveltejs/kit/pull/11297))

- breaking: require path option when setting/deleting/serializing cookies ([#11240](https://github.com/sveltejs/kit/pull/11240))

- breaking: tighten up error handling ([#11289](https://github.com/sveltejs/kit/pull/11289))

- breaking: remove state option from goto in favor of shallow routing ([#11307](https://github.com/sveltejs/kit/pull/11307))

- breaking: disallow external navigation with `goto` ([#11207](https://github.com/sveltejs/kit/pull/11207))

- breaking: upgrade to TypeScript 5. Default `moduleResolution` to `bundler` in user projects to be permissive in consuming and `NodeNext` when running `package` to be strict in distributing ([#11160](https://github.com/sveltejs/kit/pull/11160))

- breaking: undefined is no longer a valid value for paths.relative ([#11185](https://github.com/sveltejs/kit/pull/11185))

- breaking: require Node 18.13 or newer ([#11172](https://github.com/sveltejs/kit/pull/11172))

- breaking: fix path resolution ([#11276](https://github.com/sveltejs/kit/pull/11276))

- breaking: remove `dangerZone.trackServerFetches` ([#11235](https://github.com/sveltejs/kit/pull/11235))

### Minor Changes

- feat: add untrack to load ([#11311](https://github.com/sveltejs/kit/pull/11311))

- feat: implement shallow routing ([#11307](https://github.com/sveltejs/kit/pull/11307))

- feat: provide SvelteKit html typings ([#11222](https://github.com/sveltejs/kit/pull/11222))

- feat: redact internal stack trace when reporting config errors ([#11292](https://github.com/sveltejs/kit/pull/11292))

- feat: allow for fine grained invalidation of search params ([#11258](https://github.com/sveltejs/kit/pull/11258))

### Patch Changes

- fix: prerender optional parameters as empty when `entries` contains `'*'` ([#11178](https://github.com/sveltejs/kit/pull/11178))

- fix: resolve route config correctly ([#11256](https://github.com/sveltejs/kit/pull/11256))

- fix: import Svelte types from svelte/compiler ([#11188](https://github.com/sveltejs/kit/pull/11188))

- fix: reset invalid resources after a successful invalidation ([#11268](https://github.com/sveltejs/kit/pull/11268))

- fix: Adjust fail method and ActionFailure type ([#11260](https://github.com/sveltejs/kit/pull/11260))

- chore(deps): upgrade cookies dependency ([#11189](https://github.com/sveltejs/kit/pull/11189))

## 1.30.3

### Patch Changes

- fix: correct documentation for beforeNavigate ([#11300](https://github.com/sveltejs/kit/pull/11300))

## 1.30.2

### Patch Changes

- fix: revert recent 'correctly return 415' and 'correctly return 404' changes ([#11295](https://github.com/sveltejs/kit/pull/11295))

## 1.30.1

### Patch Changes

- fix: prerendered root page with `paths.base` config uses correct trailing slash option ([#10763](https://github.com/sveltejs/kit/pull/10763))

- fix: correctly return 404 when a form action is not found ([#11278](https://github.com/sveltejs/kit/pull/11278))

## 1.30.0

### Minor Changes

- feat: inline `response.arrayBuffer()` during ssr ([#10535](https://github.com/sveltejs/kit/pull/10535))

### Patch Changes

- fix: allow `"false"` value for preload link options ([#10555](https://github.com/sveltejs/kit/pull/10555))

- fix: call worker `unref` instead of `terminate` ([#10120](https://github.com/sveltejs/kit/pull/10120))

- fix: correctly analyse exported server API methods during build ([#11019](https://github.com/sveltejs/kit/pull/11019))

- fix: avoid error when back navigating before page is initialized ([#10636](https://github.com/sveltejs/kit/pull/10636))

- fix: allow service-worker.js to import assets ([#9285](https://github.com/sveltejs/kit/pull/9285))

- fix: distinguish better between not-found and internal-error ([#11131](https://github.com/sveltejs/kit/pull/11131))

## 1.29.1

### Patch Changes

- fix: correctly return 415 when unexpected content types are submitted to actions ([#11255](https://github.com/sveltejs/kit/pull/11255))

- chore: deprecate `preloadCode` calls with multiple arguments ([#11266](https://github.com/sveltejs/kit/pull/11266))

## 1.29.0

### Minor Changes

- feat: add `resolveRoute` to `$app/paths`, deprecate `resolvePath` ([#11261](https://github.com/sveltejs/kit/pull/11261))

## 1.28.0

### Minor Changes

- chore: deprecate top level promise await behaviour ([#11175](https://github.com/sveltejs/kit/pull/11175))

### Patch Changes

- fix: resolve relative cookie paths before storing ([#11253](https://github.com/sveltejs/kit/pull/11253))

- chore: deprecate cookies.set/delete without path option ([#11237](https://github.com/sveltejs/kit/pull/11237))

- fix: make sure promises from fetch handle errors ([#11228](https://github.com/sveltejs/kit/pull/11228))

## 1.27.7

### Patch Changes

- fix: set runes option in generated root ([#11111](https://github.com/sveltejs/kit/pull/11111))

- fix: retain URL query string for trailing slash redirects to prerendered pages ([#11142](https://github.com/sveltejs/kit/pull/11142))

## 1.27.6

### Patch Changes

- fix: use runes in generated root when detecting Svelte 5 ([#11028](https://github.com/sveltejs/kit/pull/11028))

- fix: correctly prerender pages that use browser globals and have SSR turned off ([#11032](https://github.com/sveltejs/kit/pull/11032))

- fix: correctly show 404 for prerendered dynamic routes when navigating client-side without a root layout server load ([#11025](https://github.com/sveltejs/kit/pull/11025))

## 1.27.5

### Patch Changes

- fix: add vite.config.js to included files in generated tsconfig ([#10788](https://github.com/sveltejs/kit/pull/10788))

- fix: cache location.origin on startup ([#11004](https://github.com/sveltejs/kit/pull/11004))

## 1.27.4

### Patch Changes

- fix: generate `__data.json` for prerendered pages when SSR is turned off ([#10988](https://github.com/sveltejs/kit/pull/10988))

- chore: add experimental compatibility for Svelte 5 ([#11002](https://github.com/sveltejs/kit/pull/11002))

## 1.27.3

### Patch Changes

- fix: use correct environment file for rendering spa fallback page ([#10963](https://github.com/sveltejs/kit/pull/10963))

## 1.27.2

### Patch Changes

- fix: missing `File` Node polyfill for Node version 18.11.0+ ([#10948](https://github.com/sveltejs/kit/pull/10948))

## 1.27.1

### Patch Changes

- fix: only apply some polyfills below node 18.11 ([#10920](https://github.com/sveltejs/kit/pull/10920))

## 1.27.0

### Minor Changes

- feat: add `invalidateAll` boolean option to `enhance` callback ([#9889](https://github.com/sveltejs/kit/pull/9889))

## 1.26.0

### Minor Changes

- feat: infer route parameter type from matcher's guard check if applicable ([#10755](https://github.com/sveltejs/kit/pull/10755))

### Patch Changes

- fix: basic mime type handling for prerendered pages in preview ([#10851](https://github.com/sveltejs/kit/pull/10851))

- chore: use just a single library (mrmime) for mime type handling ([#10851](https://github.com/sveltejs/kit/pull/10851))

- chore: bump undici to address security issue ([#10885](https://github.com/sveltejs/kit/pull/10885))

- fix: follow whatwg fetch spec for handling redirect loops ([#10857](https://github.com/sveltejs/kit/pull/10857))

- fix: use `window.fetch` in `load` functions to allow libraries to patch it ([#10009](https://github.com/sveltejs/kit/pull/10009))

- chore(deps): update dependency undici to ~5.26.0 ([#10860](https://github.com/sveltejs/kit/pull/10860))

## 1.25.2

### Patch Changes

- fix: correctly update `$page.url.hash` when navigating history ([#10843](https://github.com/sveltejs/kit/pull/10843))

- fix: strip virtual module prefix from error messages ([#10776](https://github.com/sveltejs/kit/pull/10776))

- fix: cancel ongoing navigation when the browser back button is hit to prevent an incorrect page from being rendered ([#10727](https://github.com/sveltejs/kit/pull/10727))

- fix: only remove Vite manifest when copying files ([#10782](https://github.com/sveltejs/kit/pull/10782))

## 1.25.1

### Patch Changes

- fix: correct line numbers in stack trace ([#10769](https://github.com/sveltejs/kit/pull/10769))

- fix: correctly return 404 when navigating to a missing page and the root layout fetches a prerendered endpoint ([#10565](https://github.com/sveltejs/kit/pull/10565))

- fix: allow optional param in middle of route ([#10736](https://github.com/sveltejs/kit/pull/10736))

- chore: update `undici` ([#10641](https://github.com/sveltejs/kit/pull/10641))

## 1.25.0

### Minor Changes

- feat: add server endpoint catch-all method handler `fallback` ([#9755](https://github.com/sveltejs/kit/pull/9755))

### Patch Changes

- fix: allow calling `fetch` for any scheme ([#10699](https://github.com/sveltejs/kit/pull/10699))

## 1.24.1

### Patch Changes

- fix: mark aborted/cancelled navigation as handled ([#10666](https://github.com/sveltejs/kit/pull/10666))

## 1.24.0

### Minor Changes

- feat: onNavigate lifecycle function ([#9605](https://github.com/sveltejs/kit/pull/9605))

### Patch Changes

- fix: Use Proxy to track usage of client side load `event.route` ([#10576](https://github.com/sveltejs/kit/pull/10576))

## 1.23.1

### Patch Changes

- fix: process globs in `pkg.workspaces` ([#10625](https://github.com/sveltejs/kit/pull/10625))

## 1.23.0

### Minor Changes

- feat: add warning for mistyped route filenames ([#10558](https://github.com/sveltejs/kit/pull/10558))

- feat: accept `URL` in `redirect` ([#10570](https://github.com/sveltejs/kit/pull/10570))

### Patch Changes

- fix: adjust the type of `Navigation["type"]` ([#10599](https://github.com/sveltejs/kit/pull/10599))

- fix: allow logging `$page.url` during prerendering ([#10567](https://github.com/sveltejs/kit/pull/10567))

## 1.22.6

### Patch Changes

- fix: correctly restore trailing slash in url pathname for data requests ([#10475](https://github.com/sveltejs/kit/pull/10475))

- fix: load trailing slash option from server even when there's no load function ([#10475](https://github.com/sveltejs/kit/pull/10475))

## 1.22.5

### Patch Changes

- fix: make server assets available during `vite preview` ([#10511](https://github.com/sveltejs/kit/pull/10511))

- chore: upgrade `undici` to 5.23.0 ([#10240](https://github.com/sveltejs/kit/pull/10240))

## 1.22.4

### Patch Changes

- fix: prevent duplicate module preload ([#10442](https://github.com/sveltejs/kit/pull/10442))

- docs: Elaborate on credentialed `fetch` behaviour ([#10421](https://github.com/sveltejs/kit/pull/10421))

## 1.22.3

### Patch Changes

- fix: gracefully handle server endpoints that return `Response`s with immutable `Headers` ([#10367](https://github.com/sveltejs/kit/pull/10367))

## 1.22.2

### Patch Changes

- fix: wait a tick before announcing new page title ([#10363](https://github.com/sveltejs/kit/pull/10363))

- feat: more helpful error for preview if build output doesn't exist ([#10337](https://github.com/sveltejs/kit/pull/10337))

## 1.22.1

### Patch Changes

- perf: only have Vite generate relative paths when required ([#10287](https://github.com/sveltejs/kit/pull/10287))

## 1.22.0

### Minor Changes

- feat: add `HEAD` server method ([#9753](https://github.com/sveltejs/kit/pull/9753))

- feat: support caching of responses with `Vary` header (except for `Vary: *`) ([#9993](https://github.com/sveltejs/kit/pull/9993))

### Patch Changes

- fix: avoid running load function on invalid requests ([#9752](https://github.com/sveltejs/kit/pull/9752))

- fix: update page store when URL hash is changed from the address bar ([#10202](https://github.com/sveltejs/kit/pull/10202))

- fix: include `Vary: Accept` header to fix browser caching of adjacent pages and endpoints ([#9993](https://github.com/sveltejs/kit/pull/9993))

## 1.21.0

### Minor Changes

- feat: add `event.isSubRequest` boolean indicating whether this is a call to one of the app's own APIs during SSR (or prerendering) ([#10170](https://github.com/sveltejs/kit/pull/10170))

- feat: add `privatePrefix` to `config.kit.env` ([#9996](https://github.com/sveltejs/kit/pull/9996))

- feat: export `VERSION` from `@sveltejs/kit` ([#9969](https://github.com/sveltejs/kit/pull/9969))

### Patch Changes

- docs: update inline NavigationType documentation ([#10269](https://github.com/sveltejs/kit/pull/10269))

- perf: cache dynamic imports of nodes ([#10080](https://github.com/sveltejs/kit/pull/10080))

## 1.20.5

### Patch Changes

- fix: batch synchronous invalidate invocations ([#10145](https://github.com/sveltejs/kit/pull/10145))

- fix: allow rest params to be empty in resolvePath ([#10146](https://github.com/sveltejs/kit/pull/10146))

- fix: correctly close dialogs when form is enhanced ([#10093](https://github.com/sveltejs/kit/pull/10093))

- fix: precompress filter ([#10185](https://github.com/sveltejs/kit/pull/10185))

## 1.20.4

### Patch Changes

- fix: remove reference to tiny-glob from postinstall script ([#10174](https://github.com/sveltejs/kit/pull/10174))

## 1.20.3

### Patch Changes

- chore: remove `tiny-glob` as a dependency ([#10166](https://github.com/sveltejs/kit/pull/10166))

- fix: don't import types from `svelte/internal` ([#10172](https://github.com/sveltejs/kit/pull/10172))

- fix: don't skip rest parameter's matcher when there is a non-matching optional parameter ([#10020](https://github.com/sveltejs/kit/pull/10020))

- fix: ensure `fetch` respects headers from provided `Request` ([#10136](https://github.com/sveltejs/kit/pull/10136))

## 1.20.2

### Patch Changes

- fix: ensure optional routes with matchers and catch-all match correctly ([#9987](https://github.com/sveltejs/kit/pull/9987))

- fix: disallow `actions` export from a `+layout.server` file ([#10046](https://github.com/sveltejs/kit/pull/10046))

- fix: remove scrollbars from default error page ([#10059](https://github.com/sveltejs/kit/pull/10059))

## 1.20.1

### Patch Changes

- fix: don't copy public folder in service worker build ([#10082](https://github.com/sveltejs/kit/pull/10082))

## 1.20.0

### Minor Changes

- feat: support Svelte 4 ([#10048](https://github.com/sveltejs/kit/pull/10048))

## 1.19.0

### Minor Changes

- feat: allow link options to be set to `"true"` and `"false"` ([#10039](https://github.com/sveltejs/kit/pull/10039))

- feat: add `resolvePath` export for building relative paths from route IDs and parameters ([#9949](https://github.com/sveltejs/kit/pull/9949))

### Patch Changes

- fix: prevent history change when clicking same hash link ([#10032](https://github.com/sveltejs/kit/pull/10032))

- fix: gracefully handle server endpoints that return `Response`s with immutable `Headers` when prerendering ([#10030](https://github.com/sveltejs/kit/pull/10030))

- fix: do not add content-security-policy meta element if content is empty ([#10026](https://github.com/sveltejs/kit/pull/10026))

- docs: correct `ResolveOptions['preload']` inline documentation ([#10037](https://github.com/sveltejs/kit/pull/10037))

- fix: avoid creating update check timer on the server ([#10015](https://github.com/sveltejs/kit/pull/10015))

## 1.18.0

### Minor Changes

- security: Stop implicitly tracking URLs as dependencies in server-side `load`s ([#9945](https://github.com/sveltejs/kit/pull/9945))

## 1.17.1

### Patch Changes

- fix: ensure styles are loaded in dev mode for routes containing special characters ([#9894](https://github.com/sveltejs/kit/pull/9894))

- feat: warn users when enhancing forms with files but no `enctype="multipart/form-data"` ([#9888](https://github.com/sveltejs/kit/pull/9888))

## 1.17.0

### Minor Changes

- feat: unshadow `data` and `form` in `enhance` and warn about future deprecation when used in `dev` mode ([#9902](https://github.com/sveltejs/kit/pull/9902))

- feat: crawl URLs in `<meta>` tags ([#9900](https://github.com/sveltejs/kit/pull/9900))

### Patch Changes

- fix: avoid trying to inline raw or url css imports ([#9925](https://github.com/sveltejs/kit/pull/9925))

- feat: prerender in worker rather than subprocess to support Deno ([#9919](https://github.com/sveltejs/kit/pull/9919))

- perf: add `<script>` to prerendered redirects for faster redirects ([#9911](https://github.com/sveltejs/kit/pull/9911))

- fix: add typing for `vitePlugin` to `Config` ([#9946](https://github.com/sveltejs/kit/pull/9946))

- fix: stop setting Kit cookie defaults on cookies parsed from headers ([#9908](https://github.com/sveltejs/kit/pull/9908))

- fix: only skip hydration with vite overlay if current page is an error ([#9892](https://github.com/sveltejs/kit/pull/9892))

## 1.16.3

### Patch Changes

- fix: entry generation with mixed segments ([#9879](https://github.com/sveltejs/kit/pull/9879))

- fix: use `focusVisible: false` to prevent unwanted focus ring on navigation ([#9861](https://github.com/sveltejs/kit/pull/9861))

## 1.16.2

### Patch Changes

- fix: support Node 20 ([`6e2efcf62`](https://github.com/sveltejs/kit/commit/6e2efcf627ce8d179c941212d761aa93568b1724))

- fix: reset focus synchronously on navigation ([#9837](https://github.com/sveltejs/kit/pull/9837))

## 1.16.1

### Patch Changes

- fix: realign state.branch on the client on first load ([#9754](https://github.com/sveltejs/kit/pull/9754))

- fix: update `$page.data` correctly after invalidate ([#9798](https://github.com/sveltejs/kit/pull/9798))

- fix: file not found in manifest ([#9846](https://github.com/sveltejs/kit/pull/9846))

## 1.16.0

### Minor Changes

- feat: route-level entry generators via `export const entries` ([#9571](https://github.com/sveltejs/kit/pull/9571))

## 1.15.11

### Patch Changes

- chore: more compact representation for invalidated search param ([#9708](https://github.com/sveltejs/kit/pull/9708))

- chore: fix import path to app script on windows ([#9743](https://github.com/sveltejs/kit/pull/9743))

- fix: make $app/navigation more resilient to bundler reordering ([#9808](https://github.com/sveltejs/kit/pull/9808))

- fix: page load `fetch()` now accepts the same input types for the body as the native fetch function ([#9801](https://github.com/sveltejs/kit/pull/9801))

- fix: handle preload and filterSerializedResponseHeaders in sequence function ([#9741](https://github.com/sveltejs/kit/pull/9741))

## 1.15.10

### Patch Changes

- fix: log whole error object in default handleError ([#9791](https://github.com/sveltejs/kit/pull/9791))

## 1.15.9

### Patch Changes

- fix: correctly replace state when `data-sveltekit-replacestate` is used with a hash link ([#9751](https://github.com/sveltejs/kit/pull/9751))

- fix: compute trailing slash on page server / data request ([#9738](https://github.com/sveltejs/kit/pull/9738))

- fix: update vite-plugin-svelte to fix windows resolution issue ([#9769](https://github.com/sveltejs/kit/pull/9769))

## 1.15.8

### Patch Changes

- chore: revert undici pin and upgrade version ([#9740](https://github.com/sveltejs/kit/pull/9740))

- chore: upgrade vite-plugin-svelte for resolve improvements and warnings ([#9742](https://github.com/sveltejs/kit/pull/9742))

## 1.15.7

### Patch Changes

- fix: provide better error when prerendered routes conflict with each other ([#9692](https://github.com/sveltejs/kit/pull/9692))

- fix: prevent false positive warnings for fetch in Firefox and Safari ([#9680](https://github.com/sveltejs/kit/pull/9680))

- fix: allow embedding two pages generated into the same page in "embedded" mode ([#9610](https://github.com/sveltejs/kit/pull/9610))

- fix: don't include prerendered routes in default generateManifest ([#9471](https://github.com/sveltejs/kit/pull/9471))

- fix: better error messages for handleable prerender failures ([#9621](https://github.com/sveltejs/kit/pull/9621))

## 1.15.6

### Patch Changes

- fix: use correct relative paths when rendering base path ([#9343](https://github.com/sveltejs/kit/pull/9343))

- fix: handle redirect thrown in handle hook in response to form action ([#9658](https://github.com/sveltejs/kit/pull/9658))

- fix: do not call beforeNavigate for download links ([#9660](https://github.com/sveltejs/kit/pull/9660))

## 1.15.5

### Patch Changes

- fix: correct allow header methods list for 405s ([#9655](https://github.com/sveltejs/kit/pull/9655))

- fix: prevent routes/layouts from having conflicting files through resets or different extensions ([#9590](https://github.com/sveltejs/kit/pull/9590))

- fix: prevent unhandled exceptions for invalid header values ([#9638](https://github.com/sveltejs/kit/pull/9638))

## 1.15.4

### Patch Changes

- fix: gracefully handle failure to load hooks.server.js ([#9641](https://github.com/sveltejs/kit/pull/9641))

- feat: set sourcemapIgnoreList to filter out non-source directories ([#9619](https://github.com/sveltejs/kit/pull/9619))

## 1.15.3

### Patch Changes

- fix: prevent building duplicate CSS files ([#9382](https://github.com/sveltejs/kit/pull/9382))

## 1.15.2

### Patch Changes

- fix: address security advisory [CVE-2023-29008](https://github.com/sveltejs/kit/security/advisories/GHSA-gv7g-x59x-wf8f) by doing a case-insensitive comparison when checking header value ([`ba436c66`](https://github.com/sveltejs/kit/commit/ba436c6685e751d968a960fbda65f24cf7a82e9f))

## 1.15.1

### Patch Changes

- fix: pin undici to 5.20.0 ([#9591](https://github.com/sveltejs/kit/pull/9591))

- fix: address security advisory [CVE-2023-29003](https://github.com/sveltejs/kit/security/advisories/GHSA-5p75-vc5g-8rv2) by including `text/plain` and `PUT`/`PATCH`/`DELETE` requests in set of blocked cross-origin requests for CSRF protection ([`bb2253d5`](https://github.com/sveltejs/kit/commit/bb2253d51d00aba2e4353952d4fb0dcde6c77123))

## 1.15.0

### Minor Changes

- feat: expose stronger typed `SubmitFunction` through `./$types` ([#9201](https://github.com/sveltejs/kit/pull/9201))

### Patch Changes

- fix: throw error when file can't be found in Vite manifest ([#9558](https://github.com/sveltejs/kit/pull/9558))

- fix: make `error.message` enumerable when sending `ssrLoadModule` error to client ([#9440](https://github.com/sveltejs/kit/pull/9440))

- fix: pass `publicDir` Vite config in SSR ([#9565](https://github.com/sveltejs/kit/pull/9565))

- fix: balance parentheses in error about wrong content type for action ([#9513](https://github.com/sveltejs/kit/pull/9513))

## 1.14.0

### Minor Changes

- feat: add HMR to fallback error pages during dev ([#9497](https://github.com/sveltejs/kit/pull/9497))

### Patch Changes

- fix: add `submitter` type to `SumbitFunction` ([#9484](https://github.com/sveltejs/kit/pull/9484))

## 1.13.0

### Minor Changes

- feat: add dark mode styles to default error page ([#9460](https://github.com/sveltejs/kit/pull/9460))

### Patch Changes

- fix: recover from errors during dev by reloading ([#9441](https://github.com/sveltejs/kit/pull/9441))

## 1.12.0

### Minor Changes

- feat: expose submitter in use:enhance SubmitFunction ([#9425](https://github.com/sveltejs/kit/pull/9425))

- feat: add data-sveltekit-keepfocus and data-sveltekit-replacestate options to links (requires Svelte version 3.56 for type-checking with `svelte-check`) ([#9019](https://github.com/sveltejs/kit/pull/9019))

### Patch Changes

- fix: don't start debugger on 404s ([#9424](https://github.com/sveltejs/kit/pull/9424))

- fix: handle srcset attributes with newline after comma ([#9388](https://github.com/sveltejs/kit/pull/9388))

- fix: allow tsconfig to extend multiple other tsconfigs ([#9413](https://github.com/sveltejs/kit/pull/9413))

- chore: update Undici to 5.21.0 ([#9417](https://github.com/sveltejs/kit/pull/9417))

## 1.11.0

### Minor Changes

- feat: pause on debugger when falling back to full page reload during development ([#9305](https://github.com/sveltejs/kit/pull/9305))

- feat: expose `base` via `$service-worker`, make paths relative ([#9250](https://github.com/sveltejs/kit/pull/9250))

### Patch Changes

- fix: don't automatically prerender non-SSR'd pages ([#9352](https://github.com/sveltejs/kit/pull/9352))

- fix: use 308 responses for trailing slash redirects, instead of 301s ([#9351](https://github.com/sveltejs/kit/pull/9351))

- fix: remove buggy cookie path detection ([#9298](https://github.com/sveltejs/kit/pull/9298))

- fix: don't prevent `beforeNavigate` callbacks from running following a cancelled unloading navigation ([#9347](https://github.com/sveltejs/kit/pull/9347))

- fix: persist DOM state on beforeunload ([#9345](https://github.com/sveltejs/kit/pull/9345))

- fix: redirect to path with/without trailing slash when previewing prerendered pages ([#9353](https://github.com/sveltejs/kit/pull/9353))

- fix: avoid FOUC when using CSS modules in dev ([#9323](https://github.com/sveltejs/kit/pull/9323))

- fix: don't skip required parameters after missing optional parameters ([#9331](https://github.com/sveltejs/kit/pull/9331))

- fix: account for server-emitted assets when prerenering ([#9349](https://github.com/sveltejs/kit/pull/9349))

- fix: deal with fast consecutive promise resolutions when streaming ([#9332](https://github.com/sveltejs/kit/pull/9332))

- chore: replace deprecated property access in preparation for TS 5.0 ([#9361](https://github.com/sveltejs/kit/pull/9361))

## 1.10.1

### Patch Changes

- fix: respect `<base>` when crawling ([#9257](https://github.com/sveltejs/kit/pull/9257))

- fix: scroll before resetting focus, to avoid flash of unscrolled content ([#9311](https://github.com/sveltejs/kit/pull/9311))

- fix: omit hash from global during development ([#9310](https://github.com/sveltejs/kit/pull/9310))

## 1.10.0

### Minor Changes

- feat: add `cookies.getAll` ([#9287](https://github.com/sveltejs/kit/pull/9287))

### Patch Changes

- fix: always include `<link rel="stylesheet">`, even for stylesheets excluded from Link headers ([#9255](https://github.com/sveltejs/kit/pull/9255))

- fix: preserve form state when submitting a second time ([#9267](https://github.com/sveltejs/kit/pull/9267))

## 1.9.3

### Patch Changes

- fix: successive optional route parameters can now be empty ([#9266](https://github.com/sveltejs/kit/pull/9266))

## 1.9.2

### Patch Changes

- fix: correct undefined reference to global var with Vitest ([#9252](https://github.com/sveltejs/kit/pull/9252))

## 1.9.1

### Patch Changes

- feat: warn when calling depends(...) with special URI scheme ([#9246](https://github.com/sveltejs/kit/pull/9246))

## 1.9.0

### Minor Changes

- feat: add `paths.relative` option to control interpretation of `paths.assets` and `paths.base` ([#9220](https://github.com/sveltejs/kit/pull/9220))

## 1.8.8

### Patch Changes

- fix: always add `@sveltejs/kit` to `noExternal` for ssr build ([#9242](https://github.com/sveltejs/kit/pull/9242))
- feat: add `api.methods` and `page.methods` to `builder.routes` ([#9145](https://github.com/sveltejs/kit/pull/9145))

## 1.8.7

### Patch Changes

- fix: correct not found message when setting `paths.base` ([#9232](https://github.com/sveltejs/kit/pull/9232))

## 1.8.6

### Patch Changes

- fix: bundle SvelteKit when using Vitest ([#9172](https://github.com/sveltejs/kit/pull/9172))

## 1.8.5

### Patch Changes

- fix: allow relative fetch to endpoint outside app from within `handle` ([#9198](https://github.com/sveltejs/kit/pull/9198))

## 1.8.4

### Patch Changes

- fix: include .mjs files in precompression ([#9179](https://github.com/sveltejs/kit/pull/9179))

- fix: revert mjs extension usage by default, make it an option ([#9179](https://github.com/sveltejs/kit/pull/9179))

- chore: dummy changeset to force a release ([#9207](https://github.com/sveltejs/kit/pull/9207))

## 1.8.3

### Patch Changes

- fix: use a proprietary content-type to ensure response is not buffered ([#9142](https://github.com/sveltejs/kit/pull/9142))

## 1.8.2

### Patch Changes

- fix: append newline to trigger script evaluation ([#9139](https://github.com/sveltejs/kit/pull/9139))

## 1.8.1

### Patch Changes

- fix: encode streamed chunks ([#9136](https://github.com/sveltejs/kit/pull/9136))

## 1.8.0

### Minor Changes

- feat: implement streaming promises for server load functions ([#8901](https://github.com/sveltejs/kit/pull/8901))

### Patch Changes

- fix: set public env before starting app ([#8957](https://github.com/sveltejs/kit/pull/8957))

- fix: preload modules on Safari ([#8957](https://github.com/sveltejs/kit/pull/8957))

- fix: make `assets` work in client when app is served from a subfolder ([#8957](https://github.com/sveltejs/kit/pull/8957))

## 1.7.2

### Patch Changes

- fix: return correct asset list from `builder.writeClient()` ([#9095](https://github.com/sveltejs/kit/pull/9095))

## 1.7.1

### Patch Changes

- fix: deploy server assets. Only works with Vite 4.1+ ([#9073](https://github.com/sveltejs/kit/pull/9073))

## 1.7.0

### Minor Changes

- feat: richer error message for invalid exports ([#9055](https://github.com/sveltejs/kit/pull/9055))

### Patch Changes

- chore: throw more helpful error when encoding uri fails during prerendering ([#9053](https://github.com/sveltejs/kit/pull/9053))

## 1.6.0

### Minor Changes

- feat: add `OPTIONS` server method ([#8731](https://github.com/sveltejs/kit/pull/8731))

### Patch Changes

- fix: solve `missing "./paths" specifier in "@sveltejs/kit" package` error occurring in all projects ([#9050](https://github.com/sveltejs/kit/pull/9050))

## 1.5.7

### Patch Changes

- fix: use internal alias that won't collide with user aliases ([#9022](https://github.com/sveltejs/kit/pull/9022))

## 1.5.6

### Patch Changes

- fix: ssr defaults preventing minification for client build ([#9012](https://github.com/sveltejs/kit/pull/9012))

- fix: client-side trailing slash redirect when preloading data ([#8982](https://github.com/sveltejs/kit/pull/8982))

## 1.5.5

### Patch Changes

- fix: warn after failed data preloads in dev ([#8985](https://github.com/sveltejs/kit/pull/8985))

## 1.5.4

### Patch Changes

- fix: support all relevant vite cli flags ([#8977](https://github.com/sveltejs/kit/pull/8977))

## 1.5.3

### Patch Changes

- docs: clarify that `version.name` should be deterministic ([#8956](https://github.com/sveltejs/kit/pull/8956))

- fix: correctly include exported http methods in allow header ([#8968](https://github.com/sveltejs/kit/pull/8968))

- chore: polyfill File from node:buffer ([#8925](https://github.com/sveltejs/kit/pull/8925))

- fix: provide helpful error/warning when calling `fetch` during render ([#8551](https://github.com/sveltejs/kit/pull/8551))

- fix: print useful error when subscribing to SvelteKit's stores at the wrong time during SSR ([#8960](https://github.com/sveltejs/kit/pull/8960))

- fix: ignore external links when automatically preloading ([#8961](https://github.com/sveltejs/kit/pull/8961))

- chore: refactor fallback generation ([#8972](https://github.com/sveltejs/kit/pull/8972))

## 1.5.2

### Patch Changes

- fix: always default `paths.assets` to `paths.base` ([#8928](https://github.com/sveltejs/kit/pull/8928))

## 1.5.1

### Patch Changes

- fix: pick up config from endpoints ([#8933](https://github.com/sveltejs/kit/pull/8933))

- fix: don't reuse previous server load cache when there's no server load function ([#8893](https://github.com/sveltejs/kit/pull/8893))

- fix: deduplicate paths in tsconfig ([#8880](https://github.com/sveltejs/kit/pull/8880))

- docs: clarify version management feature ([#8941](https://github.com/sveltejs/kit/pull/8941))

## 1.5.0

### Minor Changes

- feat: support route-level configuration ([#8740](https://github.com/sveltejs/kit/pull/8740))

- feat: add snapshot mechanism for preserving ephemeral DOM state ([#8710](https://github.com/sveltejs/kit/pull/8710))

### Patch Changes

- chore(deps): update dependency undici to v5.18.0 ([#8884](https://github.com/sveltejs/kit/pull/8884))

## 1.4.0

### Minor Changes

- feat: allow $app/paths to be used without an app ([#8838](https://github.com/sveltejs/kit/pull/8838))

### Patch Changes

- fix: ensure types of all form actions are accessible even if differing ([#8877](https://github.com/sveltejs/kit/pull/8877))

- fix: correctly handle HttpErrors on the client side ([#8829](https://github.com/sveltejs/kit/pull/8829))

- docs: discourage use of `goto` with external URLs ([#8837](https://github.com/sveltejs/kit/pull/8837))

- fix: prevent crawling empty urls (`<img src="">`) ([#8883](https://github.com/sveltejs/kit/pull/8883))

- fix: correctly serialize request url when using load `fetch` ([#8876](https://github.com/sveltejs/kit/pull/8876))

- fix: ensure endpoints can fetch endpoints on the same host but not part of the application ([#8869](https://github.com/sveltejs/kit/pull/8869))

## 1.3.10

### Patch Changes

- fix: preserve build error messages ([#8846](https://github.com/sveltejs/kit/pull/8846))

## 1.3.9

### Patch Changes

- fix: output errors properly if pages fail to compile ([#8813](https://github.com/sveltejs/kit/pull/8813))

## 1.3.8

### Patch Changes

- fix: remove Vite manifest before running adapter ([#8815](https://github.com/sveltejs/kit/pull/8815))

## 1.3.7

### Patch Changes

- fix: only show prerendering message when actually prerendering ([#8809](https://github.com/sveltejs/kit/pull/8809))

- fix: handle anchors with special chars when navigating ([#8806](https://github.com/sveltejs/kit/pull/8806))

- fix: await finalise hook and run it only once ([#8817](https://github.com/sveltejs/kit/pull/8817))

## 1.3.6

### Patch Changes

- fix: allow rest parameters to follow multiple optional - or not - parameters ([#8761](https://github.com/sveltejs/kit/pull/8761))

- fix: consider headers when constructing request hash ([#8754](https://github.com/sveltejs/kit/pull/8754))

## 1.3.5

### Patch Changes

- docs: fix typo ([#8790](https://github.com/sveltejs/kit/pull/8790))

- fix: build error on layout with missing leaves ([#8792](https://github.com/sveltejs/kit/pull/8792))

- fix: handle hash links with non-ASCII characters when navigating ([#8767](https://github.com/sveltejs/kit/pull/8767))

## 1.3.4

### Patch Changes

- chore: bump devalue ([#8789](https://github.com/sveltejs/kit/pull/8789))

## 1.3.3

### Patch Changes

- fix: forward `process.env` to child process ([#8777](https://github.com/sveltejs/kit/pull/8777))

## 1.3.2

### Patch Changes

- fix: take base path into account when preloading code ([#8748](https://github.com/sveltejs/kit/pull/8748))

## 1.3.1

### Patch Changes

- fix: only fetch `__data.json` files for routes with a server `load` function ([#8636](https://github.com/sveltejs/kit/pull/8636))

- fix: add `ignoreDeprecations` flag for TS 5.x ([#8718](https://github.com/sveltejs/kit/pull/8718))

- fix: install polyfills when analysing code ([#8636](https://github.com/sveltejs/kit/pull/8636))

## 1.3.0

### Minor Changes

- feat: allow generated tsconfig to be modified ([#8606](https://github.com/sveltejs/kit/pull/8606))

### Patch Changes

- fix: skip navigation hooks on popstate events when only hash changed ([#8730](https://github.com/sveltejs/kit/pull/8730))

## 1.2.10

### Patch Changes

- chore: restrict methods allowed for POST ([#8721](https://github.com/sveltejs/kit/pull/8721))

- fix: provide proper error when POSTing to a missing page endpoint ([#8714](https://github.com/sveltejs/kit/pull/8714))

## 1.2.9

### Patch Changes

- fix: reapply exports alignment after Vite dependency optimizations ([#8690](https://github.com/sveltejs/kit/pull/8690))

## 1.2.8

### Patch Changes

- fix: include base path in path to start script ([#8651](https://github.com/sveltejs/kit/pull/8651))

## 1.2.7

### Patch Changes

- fix: set headers when throwing redirect in handle ([#8648](https://github.com/sveltejs/kit/pull/8648))

## 1.2.6

### Patch Changes

- fix: allow importing assets while using base path ([#8683](https://github.com/sveltejs/kit/pull/8683))

## 1.2.5

### Patch Changes

- fix: check for wrong return values from form actions ([#8553](https://github.com/sveltejs/kit/pull/8553))

## 1.2.4

### Patch Changes

- chore: update undici to v5.16.0 ([#8668](https://github.com/sveltejs/kit/pull/8668))

## 1.2.3

### Patch Changes

- fix: set environment variables before postbuild analysis ([#8647](https://github.com/sveltejs/kit/pull/8647))

## 1.2.2

### Patch Changes

- fix: focus management after navigation ([#8466](https://github.com/sveltejs/kit/pull/8466))

## 1.2.1

### Patch Changes

- feat: throw error if cookie exceeds size limit ([#8591](https://github.com/sveltejs/kit/pull/8591))

## 1.2.0

### Minor Changes

- feat: add `text(...)` helper for generating text responses ([#8371](https://github.com/sveltejs/kit/pull/8371))

- feat: enable access to public env within app.html ([#8449](https://github.com/sveltejs/kit/pull/8449))

- fix: add `Content-Length` header to SvelteKit-generated responses ([#8371](https://github.com/sveltejs/kit/pull/8371))

## 1.1.4

### Patch Changes

- fix: squelch unknown prop warning for `+error.svelte` components ([#8593](https://github.com/sveltejs/kit/pull/8593))

## 1.1.3

### Patch Changes

- docs: explain how to add ambient typings ([#8558](https://github.com/sveltejs/kit/pull/8558))

- fix: ignore `target="_blank"` links ([#8563](https://github.com/sveltejs/kit/pull/8563))

## 1.1.2

### Patch Changes

- fix: correct link in types documentation ([#8557](https://github.com/sveltejs/kit/pull/8557))

- fix: correctly detect changed data ([#8377](https://github.com/sveltejs/kit/pull/8377))

- fix: only generate type definitions with `sync` command ([#8552](https://github.com/sveltejs/kit/pull/8552))

- fix: remove baseUrl to prevent wrong TypeScript auto imports if possible ([#8568](https://github.com/sveltejs/kit/pull/8568))

## 1.1.1

### Patch Changes

- chore: upgrade devalue ([#8520](https://github.com/sveltejs/kit/pull/8520))

## 1.1.0

### Minor Changes

- feat: warn when usage of page options in `.svelte` files or missing `<slot />` in layout is detected ([#8475](https://github.com/sveltejs/kit/pull/8475))

### Patch Changes

- fix: exit postbuild step with code 0 ([#8514](https://github.com/sveltejs/kit/pull/8514))

- fix: only run missing page check in dev mode ([#8515](https://github.com/sveltejs/kit/pull/8515))

- fix: avoid input name clobbering form method check ([#8471](https://github.com/sveltejs/kit/pull/8471))

- fix: exclude service worker from tsconfig ([#8508](https://github.com/sveltejs/kit/pull/8508))

- fix: provide better error message in case of missing `+page.svelte` ([#8478](https://github.com/sveltejs/kit/pull/8478))

## 1.0.13

### Patch Changes

- chore: separate generated from non-generated server code ([#8429](https://github.com/sveltejs/kit/pull/8429))

## 1.0.12

### Patch Changes

- fix: make prerendered endpoint callable from non-prerendered server load ([#8453](https://github.com/sveltejs/kit/pull/8453))

- docs: add links to http status codes ([#8480](https://github.com/sveltejs/kit/pull/8480))

- fix: prerender page when prerender set to 'auto' and ssr set to true ([#8481](https://github.com/sveltejs/kit/pull/8481))

- fix: prevent false positive warnings for fetch uses in firefox ([#8456](https://github.com/sveltejs/kit/pull/8456))

- fix: check version on node fetch fail ([#8487](https://github.com/sveltejs/kit/pull/8487))

- fix: avoid unnecessary $page store updates ([#8457](https://github.com/sveltejs/kit/pull/8457))

## 1.0.11

### Patch Changes

- feat: warn that hydration may break if comments are removed from HTML ([#8423](https://github.com/sveltejs/kit/pull/8423))
- fix: ignore `<a>` elements with no `href` attribute when refocusing after navigation ([#8418](https://github.com/sveltejs/kit/pull/8418))
- fix: invalidate dependencies implicitly added by `fetch` in server load functions ([#8420](https://github.com/sveltejs/kit/pull/8420))

## 1.0.10

### Patch Changes

- fix: skip inline cache when vary header is present ([#8406](https://github.com/sveltejs/kit/pull/8406))

## 1.0.9

### Patch Changes

- fix: add `assetFileNames` to worker rollup options ([#8384](https://github.com/sveltejs/kit/pull/8384))

## 1.0.8

### Patch Changes

- feat: error in dev mode if global `fetch` is used with relative URL ([#8370](https://github.com/sveltejs/kit/pull/8370))
- fix: disable illegal import detection when running unit tests ([#8365](https://github.com/sveltejs/kit/pull/8365))
- fix: only prerender a given dependency once ([#8376](https://github.com/sveltejs/kit/pull/8376))
- fix: `updated.check()` type changed to `Promise<boolean>` ([#8400](https://github.com/sveltejs/kit/pull/8400))
- fix: don't strip body in no-cors mode on the server ([#8412](https://github.com/sveltejs/kit/pull/8412))
- fix: quote 'script' in CSP directives ([#8372](https://github.com/sveltejs/kit/pull/8372))
- fix: correctly compare route ids for load change detection ([#8399](https://github.com/sveltejs/kit/pull/8399))
- fix: don't add nonce attribute to `<link>` elements ([#8369](https://github.com/sveltejs/kit/pull/8369))

## 1.0.7

### Patch Changes

- fix: ignore `*.test.js` and `*.spec.js` files in `params` directory ([#8250](https://github.com/sveltejs/kit/pull/8250))

## 1.0.6

### Patch Changes

- fix: guarantee that `$page.route` has the correct shape ([#8359](https://github.com/sveltejs/kit/pull/8359))

## 1.0.5

### Patch Changes

- fix: update typings of `event.platform` to be possibly undefined ([#8232](https://github.com/sveltejs/kit/pull/8232))

## 1.0.4

### Patch Changes

- fix: don't polyfill undici if using Deno or Bun ([#8338](https://github.com/sveltejs/kit/pull/8338))

## 1.0.3

### Patch Changes

- feat: include submitter's value when progressively enhancing `<form method="get">` ([#8273](https://github.com/sveltejs/kit/pull/8273))

## 1.0.2

### Patch Changes

- fix: correct `filterSerializedResponseHeaders` error message ([#8348](https://github.com/sveltejs/kit/pull/8348))
- fix: correct form action redirect status code ([#8210](https://github.com/sveltejs/kit/pull/8210))

## 1.0.1

### Patch Changes

- fix: explicitly mark Node 17.x as not supported ([#8174](https://github.com/sveltejs/kit/pull/8174))

## 1.0.0

### Major Changes

First major release, see below for the history of changes that lead up to this.
Starting from now all releases follow semver and changes will be listed as Major/Minor/Patch

## 1.0.0-next.589

### Patch Changes

- breaking: remove warnings/errors about removed/changed APIs ([#8019](https://github.com/sveltejs/kit/pull/8019))

## 1.0.0-next.588

### Patch Changes

- fix: remove obsolete generated types correctly ([#8149](https://github.com/sveltejs/kit/pull/8149))

## 1.0.0-next.587

### Patch Changes

- breaking: prerender shells when ssr false and prerender not false ([#8131](https://github.com/sveltejs/kit/pull/8131))

## 1.0.0-next.586

### Patch Changes

- fix: don't de/encode initial and explicit string headers ([#8113](https://github.com/sveltejs/kit/pull/8113))

## 1.0.0-next.585

### Patch Changes

- fix: remove unused elements from default error component ([#8110](https://github.com/sveltejs/kit/pull/8110))

## 1.0.0-next.584

### Patch Changes

- fix: load errorTemplate from correct location ([#8096](https://github.com/sveltejs/kit/pull/8096))
- More robust manifest error recovery ([#8095](https://github.com/sveltejs/kit/pull/8095))

## 1.0.0-next.583

### Patch Changes

- restart vite dev-server on svelte config change ([#8087](https://github.com/sveltejs/kit/pull/8087))
- Set correct `$page.status` when using `enhance` and result is of type `'error'` ([#8073](https://github.com/sveltejs/kit/pull/8073))
- fix: ensure export conditions are resolve through Vite ([#8092](https://github.com/sveltejs/kit/pull/8092))
- fix: don't crash Vite dev server on manifest error ([#8093](https://github.com/sveltejs/kit/pull/8093))

## 1.0.0-next.582

### Patch Changes

- fix: improve split between Vite plugins ([#8055](https://github.com/sveltejs/kit/pull/8055))
- fix: set Vite base URL ([#8046](https://github.com/sveltejs/kit/pull/8046))
- add declaration for vitePreprocess reexport ([#8053](https://github.com/sveltejs/kit/pull/8053))

## 1.0.0-next.581

### Patch Changes

- feat: vitePreprocess ([#8036](https://github.com/sveltejs/kit/pull/8036))

## 1.0.0-next.580

### Patch Changes

- breaking: throw an error on invalid load response ([#8003](https://github.com/sveltejs/kit/pull/8003))
- fix: allow SvelteKit to be used without bundling ([#7950](https://github.com/sveltejs/kit/pull/7950))

## 1.0.0-next.579

### Patch Changes

- breaking: update svelte peerDependency to ^3.54.0 ([#7543](https://github.com/sveltejs/kit/pull/7543))
- update esbuild to ^0.16.3 ([#7543](https://github.com/sveltejs/kit/pull/7543))
- breaking: upgrade to Vite 4 ([#7543](https://github.com/sveltejs/kit/pull/7543))

## 1.0.0-next.578

### Patch Changes

- fix: respect fetch cache option ([#8024](https://github.com/sveltejs/kit/pull/8024))
- breaking: rename invalid() to fail() and ValidationError to ActionFailure ([#8012](https://github.com/sveltejs/kit/pull/8012))
- breaking: replace automatic fallback generation with `builder.generateFallback(fallback)` ([#8013](https://github.com/sveltejs/kit/pull/8013))

## 1.0.0-next.577

### Patch Changes

- breaking: add embedded option, turned off by default ([#7969](https://github.com/sveltejs/kit/pull/7969))

## 1.0.0-next.576

### Patch Changes

- breaking: make `sveltekit()` return a promise of array of Vite plugins ([#7994](https://github.com/sveltejs/kit/pull/7994))

## 1.0.0-next.575

### Patch Changes

- fix: throw error when using enhance on GET forms ([#7948](https://github.com/sveltejs/kit/pull/7948))
- breaking: strip `__data.json` from url ([#7979](https://github.com/sveltejs/kit/pull/7979))

## 1.0.0-next.574

### Patch Changes

- feat: split Vite plugin in two ([#7990](https://github.com/sveltejs/kit/pull/7990))

## 1.0.0-next.573

### Patch Changes

- fix: adjust ActionData type ([#7962](https://github.com/sveltejs/kit/pull/7962))
- breaking: disallow unknown exports (except when starting with an underscore) from `+(layout|page)(.server)?.js` and `+server.js` files ([#7878](https://github.com/sveltejs/kit/pull/7878))
- fix: continuous optionals should not throw conflict error ([#7939](https://github.com/sveltejs/kit/pull/7939))
- fix `enhance` error message when form action doesn't exist or csrf is enabled ([#7958](https://github.com/sveltejs/kit/pull/7958))

## 1.0.0-next.572

### Minor Changes

- Checks that element is not null before reading getAttribute ([#7930](https://github.com/sveltejs/kit/pull/7930))

### Patch Changes

- chore: update `magic-string` ([#7931](https://github.com/sveltejs/kit/pull/7931))
- add $app and $env to optimizeDeps.exclude so that libraries using these work correctly when prebundled ([#7933](https://github.com/sveltejs/kit/pull/7933))
- reload dev page on change of app.html ([#7944](https://github.com/sveltejs/kit/pull/7944))

## 1.0.0-next.571

### Patch Changes

- fix: use searchParams for x-sveltekit-invalidated ([#7912](https://github.com/sveltejs/kit/pull/7912))
- fix: correct Vite config merging with force option ([#7911](https://github.com/sveltejs/kit/pull/7911))
- fix: rebuild manifest when client hooks or param matcher file is added/removed ([#7915](https://github.com/sveltejs/kit/pull/7915))

## 1.0.0-next.570

### Patch Changes

- Remove prepublishOnly script ([#7893](https://github.com/sveltejs/kit/pull/7893))

## 1.0.0-next.569

### Patch Changes

- Ignore elements that are no longer in the document ([#7881](https://github.com/sveltejs/kit/pull/7881))
- breaking: Use client-side routing for `<form method="GET">` ([#7828](https://github.com/sveltejs/kit/pull/7828))

## 1.0.0-next.568

### Patch Changes

- fix: add migration hint for renamed methods ([#7874](https://github.com/sveltejs/kit/pull/7874))

## 1.0.0-next.567

### Patch Changes

- Co-locate synthetic types with other Kit types ([#7864](https://github.com/sveltejs/kit/pull/7864))

## 1.0.0-next.566

### Patch Changes

- Add more type documentation ([#7003](https://github.com/sveltejs/kit/pull/7003))
- breaking: move SubmitFunction into @sveltejs/kit ([#7003](https://github.com/sveltejs/kit/pull/7003))

## 1.0.0-next.565

### Patch Changes

- breaking: Replace `data-sveltekit-prefetch` with `-preload-code` and `-preload-data` ([#7776](https://github.com/sveltejs/kit/pull/7776))
- breaking: Rename `prefetch` to `preloadData` and `prefetchRoutes` to `preloadCode` ([#7776](https://github.com/sveltejs/kit/pull/7776))

## 1.0.0-next.564

### Patch Changes

- chore: upgrade undici ([#7830](https://github.com/sveltejs/kit/pull/7830))
- Make `$page.url` resilient against mutations ([#7827](https://github.com/sveltejs/kit/pull/7827))

## 1.0.0-next.563

### Patch Changes

- feat: allow handleError to return a promise ([#7780](https://github.com/sveltejs/kit/pull/7780))
- breaking: remove `format` option from `generateManifest(...)` ([#7820](https://github.com/sveltejs/kit/pull/7820))

## 1.0.0-next.562

### Patch Changes

- fix: handle redirects in handle hook while processing data request ([#7797](https://github.com/sveltejs/kit/pull/7797))
- Make touchstart listener passive ([#7818](https://github.com/sveltejs/kit/pull/7818))
- breaking: remove `getStaticDirectory()` from builder API ([#7809](https://github.com/sveltejs/kit/pull/7809))
- Make console.warn wrapper named rather than anonymous ([#7811](https://github.com/sveltejs/kit/pull/7811))

## 1.0.0-next.561

### Patch Changes

- Upgrade vite-plugin-svelte to ^1.3.1 ([#7760](https://github.com/sveltejs/kit/pull/7760))

## 1.0.0-next.560

### Patch Changes

- breaking: Rename `prerendering` to `building`, remove `config.kit.prerender.enabled` ([#7762](https://github.com/sveltejs/kit/pull/7762))

## 1.0.0-next.559

### Patch Changes

- Roll over non-matching optional parameters instead of 404ing ([#7753](https://github.com/sveltejs/kit/pull/7753))
- fix: enable Vite's modulePreload.polyfill ([#7770](https://github.com/sveltejs/kit/pull/7770))

## 1.0.0-next.558

### Patch Changes

- breaking: Disallow error status codes outside 400-599 ([#7767](https://github.com/sveltejs/kit/pull/7767))
- breaking: Make client-side router ignore links outside %sveltekit.body% ([#7766](https://github.com/sveltejs/kit/pull/7766))

## 1.0.0-next.557

### Patch Changes

- external fetch calls: ensure serialized cookie values are url-encoded [#7736] ([#7736](https://github.com/sveltejs/kit/pull/7736))

## 1.0.0-next.556

### Patch Changes

- fix: preserve Vite CLI opts ([#7749](https://github.com/sveltejs/kit/pull/7749))

## 1.0.0-next.555

### Patch Changes

- Made `config.kit.outDir` able to be located in `node_modules` ([#7707](https://github.com/sveltejs/kit/pull/7707))

## 1.0.0-next.554

### Patch Changes

- create stronger types for dynamically generated env modules ([#7735](https://github.com/sveltejs/kit/pull/7735))
- breaking: Make `trailingSlash` a page option, rather than configuration ([#7719](https://github.com/sveltejs/kit/pull/7719))
- Handle hash links with non-ASCII characters when prerendering ([#7729](https://github.com/sveltejs/kit/pull/7729))
- Ignore popstate events from outside the router ([#7721](https://github.com/sveltejs/kit/pull/7721))

## 1.0.0-next.553

### Patch Changes

- Prevent Vite from nuking logs on startup ([#7724](https://github.com/sveltejs/kit/pull/7724))

## 1.0.0-next.552

### Patch Changes

- Don't hardcode version in client bundle ([#7694](https://github.com/sveltejs/kit/pull/7694))
- Allow .d.ts files to have a + prefix ([#7682](https://github.com/sveltejs/kit/pull/7682))
- Expose version from `$app/environment` ([#7689](https://github.com/sveltejs/kit/pull/7689))
- fix: export HttpError/Redirect interface ([#7701](https://github.com/sveltejs/kit/pull/7701))
- fix: don't preload fonts by default ([#7704](https://github.com/sveltejs/kit/pull/7704))
- Always set `Accept` and `Accept-Language` headers when making a self-request ([#7722](https://github.com/sveltejs/kit/pull/7722))
- fix: adjust interfaces to fix type errors ([#7718](https://github.com/sveltejs/kit/pull/7718))

## 1.0.0-next.551

### Patch Changes

- Add `Access-Control-Allow-Origin: *` to static assets in dev ([#7688](https://github.com/sveltejs/kit/pull/7688))
- Ignore presence of `keepfocus` and `noscroll` in `goto` options if correctly-cased options are also present ([#7678](https://github.com/sveltejs/kit/pull/7678))

## 1.0.0-next.550

### Patch Changes

- feat: preload fonts and add preload customization ([#4963](https://github.com/sveltejs/kit/pull/4963))

## 1.0.0-next.549

### Patch Changes

- Always apply Node polyfills ([#7675](https://github.com/sveltejs/kit/pull/7675))

## 1.0.0-next.548

### Patch Changes

- Only apply polyfills where necessary ([#7668](https://github.com/sveltejs/kit/pull/7668))

## 1.0.0-next.547

### Patch Changes

- fix: safely join url segments in manifest ([#7653](https://github.com/sveltejs/kit/pull/7653))
- breaking: use devalue to (de)serialize action data ([#7494](https://github.com/sveltejs/kit/pull/7494))
- Warn if `%sveltekit.body%` is direct child of `<body>` ([#7652](https://github.com/sveltejs/kit/pull/7652))

## 1.0.0-next.546

### Patch Changes

- fix outdated config error ([#7649](https://github.com/sveltejs/kit/pull/7649))
- breaking: use hex/unicode escape sequences for encoding special characters in route directory names ([#7644](https://github.com/sveltejs/kit/pull/7644))
- fix `beforeNavigate` description — `routeId` -> `route.id` ([#7643](https://github.com/sveltejs/kit/pull/7643))

## 1.0.0-next.545

### Patch Changes

- fix: prerendering path and layout fixes ([#7639](https://github.com/sveltejs/kit/pull/7639))
- fix: add Promise return type to the `enhance` action ([#7629](https://github.com/sveltejs/kit/pull/7629))

## 1.0.0-next.544

### Patch Changes

- breaking: narrow down possible status codes for redirects to 300-308 ([#7615](https://github.com/sveltejs/kit/pull/7615))
- feat: add fallback component for layouts without one ([#7619](https://github.com/sveltejs/kit/pull/7619))

## 1.0.0-next.543

### Patch Changes

- Don't print search params error when prerendering fallback page ([#7598](https://github.com/sveltejs/kit/pull/7598))
- allow async function for `enhance` action parameter ([#7608](https://github.com/sveltejs/kit/pull/7608))
- Run service worker during development ([#7597](https://github.com/sveltejs/kit/pull/7597))
- feat: support throwing redirect in handle ([#7612](https://github.com/sveltejs/kit/pull/7612))
- Workaround for the DOM clobbering for use:enhance ([#7599](https://github.com/sveltejs/kit/pull/7599))
- fix: don't cache prefetch errors ([#7610](https://github.com/sveltejs/kit/pull/7610))

## 1.0.0-next.542

### Patch Changes

- Add support for linking to <a name="hash"> tags ([#7596](https://github.com/sveltejs/kit/pull/7596))
- breaking: don't run beforeNavigate during redirects ([#7588](https://github.com/sveltejs/kit/pull/7588))
- fix: respect autofocus following navigation or enhanced form submit ([#6643](https://github.com/sveltejs/kit/pull/6643))

## 1.0.0-next.541

### Minor Changes

- fix: don't clean build and output directories when using `--watch` ([#7516](https://github.com/sveltejs/kit/pull/7516))

### Patch Changes

- fix: handle expected errors thrown in handle hook correctly ([#7566](https://github.com/sveltejs/kit/pull/7566))

## 1.0.0-next.540

### Patch Changes

- Serve prerendered non-page files when running preview ([#7576](https://github.com/sveltejs/kit/pull/7576))
- fix: caching takes now into account the body payload ([#7546](https://github.com/sveltejs/kit/pull/7546))
- fix: handle locked readable stream when reading body ([#7565](https://github.com/sveltejs/kit/pull/7565))
- fix: prefetch should ignore links ignored by the router ([#7580](https://github.com/sveltejs/kit/pull/7580))
- fix: migration error when using $page.routeId ([#7574](https://github.com/sveltejs/kit/pull/7574))
- prevent loading of illegal modules in the browser, rather than during SSR ([#7507](https://github.com/sveltejs/kit/pull/7507))
- fix: prevent double decoding of path segment ([#7550](https://github.com/sveltejs/kit/pull/7550))

## 1.0.0-next.539

### Patch Changes

- Omit prerendered routes from server manifest ([#7541](https://github.com/sveltejs/kit/pull/7541))

## 1.0.0-next.538

### Patch Changes

- feat: enable caching for `__data.json` requests ([#7532](https://github.com/sveltejs/kit/pull/7532))
- fix: prevent double decoding of params ([#7521](https://github.com/sveltejs/kit/pull/7521))
- fix: take into account Request input when serializing fetch data ([#7531](https://github.com/sveltejs/kit/pull/7531))
- fix: better cookie warning checks ([#7528](https://github.com/sveltejs/kit/pull/7528))

## 1.0.0-next.537

### Patch Changes

- feat: better navigation interfaces ([#7529](https://github.com/sveltejs/kit/pull/7529))

## 1.0.0-next.536

### Patch Changes

- custom aliases resolved in service worker builds ([#7500](https://github.com/sveltejs/kit/pull/7500))

## 1.0.0-next.535

### Patch Changes

- breaking: call beforeNavigate once with type unload on external navigation, rename type 'load' to 'enter' and type 'unload' to 'leave', add 'willUnload' property ([#6813](https://github.com/sveltejs/kit/pull/6813))

## 1.0.0-next.534

### Patch Changes

- breaking: more consistent casing for goto options ([#7502](https://github.com/sveltejs/kit/pull/7502))
- breaking: replace routeId with route.id ([#7450](https://github.com/sveltejs/kit/pull/7450))
- Fix nullish data node reference ([#7503](https://github.com/sveltejs/kit/pull/7503))

## 1.0.0-next.533

### Patch Changes

- fix: bump required Vite version and address warning ([#7491](https://github.com/sveltejs/kit/pull/7491))

## 1.0.0-next.532

### Patch Changes

- Bump devalue version ([#7466](https://github.com/sveltejs/kit/pull/7466))

## 1.0.0-next.531

### Patch Changes

- breaking: change `config.kit.prerender.onError` to `handleHttpError`, and check for invalid fragment links ([#7375](https://github.com/sveltejs/kit/pull/7375))
- fix escaping bug in crawler ([#7375](https://github.com/sveltejs/kit/pull/7375))

## 1.0.0-next.530

### Patch Changes

- fix: fetch erroring on Cloudflare ([#7453](https://github.com/sveltejs/kit/pull/7453))
- Only simulate CORS errors for shared load functions ([#7454](https://github.com/sveltejs/kit/pull/7454))

## 1.0.0-next.529

### Patch Changes

- fix: better type generation for load functions with different return values ([#7425](https://github.com/sveltejs/kit/pull/7425))
- fix: correctly strip data suffix at root page ([#7445](https://github.com/sveltejs/kit/pull/7445))
- update dependencies ([#7355](https://github.com/sveltejs/kit/pull/7355))

## 1.0.0-next.528

### Patch Changes

- Restore `req.url` to `req.originalUrl` in dev and preview ([#7343](https://github.com/sveltejs/kit/pull/7343))

## 1.0.0-next.527

### Patch Changes

- fix: harmonize cookie path and add dev time warnings ([#7416](https://github.com/sveltejs/kit/pull/7416))
- feat: add invalidateAll option to goto ([#7407](https://github.com/sveltejs/kit/pull/7407))

## 1.0.0-next.526

### Patch Changes

- declare function type with named syntax ([#7396](https://github.com/sveltejs/kit/pull/7396))
- fix: optional params can be undefined ([#7379](https://github.com/sveltejs/kit/pull/7379))
- fix: support undici 5.12.0 and pin it ([#7412](https://github.com/sveltejs/kit/pull/7412))
- chore: upgrade to vite-plugin-svelte 1.1.0 and enable prebundleSvelteLibraries ([#7388](https://github.com/sveltejs/kit/pull/7388))
- Show more descriptive error if data returned from `load` is a non-POJO ([#7386](https://github.com/sveltejs/kit/pull/7386))

## 1.0.0-next.525

### Patch Changes

- Always avoid caching form submission on enhanced forms ([#7350](https://github.com/sveltejs/kit/pull/7350))

## 1.0.0-next.524

### Patch Changes

- fix: get type gen working again ([#7370](https://github.com/sveltejs/kit/pull/7370))
- fix: don't run matchers for empty optional params ([#7346](https://github.com/sveltejs/kit/pull/7346))

## 1.0.0-next.523

### Patch Changes

- fix: split route ids into correct segments ([#7367](https://github.com/sveltejs/kit/pull/7367))

## 1.0.0-next.522

### Patch Changes

- docs: rewrite load docs ([#7174](https://github.com/sveltejs/kit/pull/7174))
- breaking: Prefix all route IDs with / ([#7338](https://github.com/sveltejs/kit/pull/7338))

## 1.0.0-next.521

### Patch Changes

- feat: add reset option to update method of enhance ([#7326](https://github.com/sveltejs/kit/pull/7326))
- breaking: remove global fetch override when prerendering ([#7318](https://github.com/sveltejs/kit/pull/7318))
- Improve error message when prefetching fails ([#7314](https://github.com/sveltejs/kit/pull/7314))

## 1.0.0-next.520

### Patch Changes

- fix: ensure serialized headers check is always applied ([#7221](https://github.com/sveltejs/kit/pull/7221))

## 1.0.0-next.519

### Patch Changes

- breaking: throw error when routes conflict ([#7051](https://github.com/sveltejs/kit/pull/7051))
- feat: implement optional route params ([#7051](https://github.com/sveltejs/kit/pull/7051))

## 1.0.0-next.518

### Patch Changes

- Enable removal of non-browser code from client builds ([#7296](https://github.com/sveltejs/kit/pull/7296))
- feat: more info about prerendering errors, add strict option to adapter-static ([#7264](https://github.com/sveltejs/kit/pull/7264))

## 1.0.0-next.517

### Patch Changes

- fix: more informative serialization error messages ([#7303](https://github.com/sveltejs/kit/pull/7303))
- fix: add `$types` to includes for better DX ([#7301](https://github.com/sveltejs/kit/pull/7301))

## 1.0.0-next.516

### Patch Changes

- fix: better navigation protocol check ([#7067](https://github.com/sveltejs/kit/pull/7067))
- fix: forward cookie headers on etag response ([#7256](https://github.com/sveltejs/kit/pull/7256))
- Properly resolve absolute paths to relative on server build ([#7252](https://github.com/sveltejs/kit/pull/7252))

## 1.0.0-next.515

### Patch Changes

- Account for relative path to routes in `config.kit.files.routes` ([#7223](https://github.com/sveltejs/kit/pull/7223))
- Use config.kit.paths.base prefix for static assets ([#4448](https://github.com/sveltejs/kit/pull/4448))

## 1.0.0-next.514

### Patch Changes

- add helpful error message for `throw invalid()` in form actions ([#7225](https://github.com/sveltejs/kit/pull/7225))

## 1.0.0-next.513

### Patch Changes

- Transfer server data as devalue-encoded JSON ([#7177](https://github.com/sveltejs/kit/pull/7177))
- fix: remove groups from segments for adapters ([#7222](https://github.com/sveltejs/kit/pull/7222))

## 1.0.0-next.512

### Patch Changes

- Fix parsing content-type header for actions ([#7195](https://github.com/sveltejs/kit/pull/7195))
- fix: reset form in use:enhance after successful submit ([#7207](https://github.com/sveltejs/kit/pull/7207))
- fix: auto-update commented PageError ([#7189](https://github.com/sveltejs/kit/pull/7189))

## 1.0.0-next.511

### Patch Changes

- perf: render head links before other content ([#7160](https://github.com/sveltejs/kit/pull/7160))

## 1.0.0-next.510

### Patch Changes

- Add `fetch` to `RequestEvent` ([#7113](https://github.com/sveltejs/kit/pull/7113))

## 1.0.0-next.509

### Patch Changes

- Apply define config to service worker ([#7140](https://github.com/sveltejs/kit/pull/7140))
- chore: Skip removing HTTP/2 pseudo-headers, which is no longer necessary with undici ([#7142](https://github.com/sveltejs/kit/pull/7142))
- bump devalue to version 4 ([#7147](https://github.com/sveltejs/kit/pull/7147))

## 1.0.0-next.508

### Patch Changes

- chore: Upgrade undici so that we can use its multipart form data parsing instead of node-fetch's ([#7131](https://github.com/sveltejs/kit/pull/7131))

## 1.0.0-next.507

### Patch Changes

- Allow TypedArray request bodies in `fetch` in `load` ([#7065](https://github.com/sveltejs/kit/pull/7065))
- Use `FormData` polyfill from `undici` rather than `node-fetch` ([#7065](https://github.com/sveltejs/kit/pull/7065))

## 1.0.0-next.506

### Patch Changes

- Default to insecure cookies when serving on http://localhost ([#7090](https://github.com/sveltejs/kit/pull/7090))
- docs: explain ramifications of base path ([#7095](https://github.com/sveltejs/kit/pull/7095))
- fix: decode routeIds in headers for prerendering ([#7097](https://github.com/sveltejs/kit/pull/7097))
- feat: provide `update` to `use:enhance` callback ([#7083](https://github.com/sveltejs/kit/pull/7083))

## 1.0.0-next.505

### Patch Changes

- fix: handle form action returning nothing; handle page.(server).js without load functions ([#7050](https://github.com/sveltejs/kit/pull/7050))
- fix: add `RequestEvent` to `$types` when `+layout.server.js` present ([#7063](https://github.com/sveltejs/kit/pull/7063))

## 1.0.0-next.504

### Patch Changes

- Add the submitter value with name to formData for use:enhance ([#7012](https://github.com/sveltejs/kit/pull/7012))

## 1.0.0-next.503

### Patch Changes

- Added form property to \$page store ([#6986](https://github.com/sveltejs/kit/pull/6986))
- Throw an error if prerenderable routes are not prerendered ([#6974](https://github.com/sveltejs/kit/pull/6974))

## 1.0.0-next.502

### Patch Changes

- fix: prevent data types from becoming type `never`, notice moved/deleted files ([#7002](https://github.com/sveltejs/kit/pull/7002))
- Allow ActionData to be undefined ([#6994](https://github.com/sveltejs/kit/pull/6994))
- Respect `config.kit.env.dir` when running `vite preview` ([#7001](https://github.com/sveltejs/kit/pull/7001))
- Only run postinstall script if package.json exists ([#6998](https://github.com/sveltejs/kit/pull/6998))
- Use custom x-sveltekit-action header to route enhanced form submissions to +page.server.js over +server.js ([#6997](https://github.com/sveltejs/kit/pull/6997))

## 1.0.0-next.501

### Patch Changes

- fix: unwrap promises for load function data on the client ([#6972](https://github.com/sveltejs/kit/pull/6972))

## 1.0.0-next.500

### Patch Changes

- Allow prerendered pages to link to non-prerenderable endpoints ([#6977](https://github.com/sveltejs/kit/pull/6977))
- fix: handle SPA root data loading error ([#6918](https://github.com/sveltejs/kit/pull/6918))

## 1.0.0-next.499

### Patch Changes

- breaking: rename App.PageError to App.Error ([#6963](https://github.com/sveltejs/kit/pull/6963))

## 1.0.0-next.498

### Patch Changes

- chdir before attempting postinstall ([#6969](https://github.com/sveltejs/kit/pull/6969))

## 1.0.0-next.497

### Patch Changes

- Add origin header for non-GET and external requests made with server-side fetch ([#6901](https://github.com/sveltejs/kit/pull/6901))

## 1.0.0-next.496

### Patch Changes

- fix: update page status when applying action ([#6942](https://github.com/sveltejs/kit/pull/6942))
- fix: apply redirect/error logic for `use:enhance` ([#6828](https://github.com/sveltejs/kit/pull/6828))

## 1.0.0-next.495

### Patch Changes

- Run `svelte-kit sync` in all workspace directories during postinstall ([#6949](https://github.com/sveltejs/kit/pull/6949))

## 1.0.0-next.494

### Patch Changes

- Fix fetch type ([#6955](https://github.com/sveltejs/kit/pull/6955))
- Add csp wasm-unsafe-eval keyword ([#6958](https://github.com/sveltejs/kit/pull/6958))
- Register service worker with relative URL ([#6954](https://github.com/sveltejs/kit/pull/6954))

## 1.0.0-next.493

### Patch Changes

- fix: allow missing routes folder ([#6944](https://github.com/sveltejs/kit/pull/6944))
- Only forward set-cookie headers for internal fetches ([#6923](https://github.com/sveltejs/kit/pull/6923))

## 1.0.0-next.492

### Patch Changes

- fix: add missing depends function to ServerLoadEvent type ([#6935](https://github.com/sveltejs/kit/pull/6935))
- Redact error message if `getRequest` fails ([#6936](https://github.com/sveltejs/kit/pull/6936))
- Add cookies.serialize method ([#6925](https://github.com/sveltejs/kit/pull/6925))
- Always apply cookies, not just for matched routes ([#6925](https://github.com/sveltejs/kit/pull/6925))
- fix: tighten up navigation and invalidation logic ([#6924](https://github.com/sveltejs/kit/pull/6924))
- Respond with 413 if request body is too large ([#6936](https://github.com/sveltejs/kit/pull/6936))

## 1.0.0-next.491

### Patch Changes

- fix: symlink routes ([#6796](https://github.com/sveltejs/kit/pull/6796))

## 1.0.0-next.490

### Patch Changes

- fix `write_types` on windows using posixify() ([#6913](https://github.com/sveltejs/kit/pull/6913))
- Prevent caching of `__data.js` files ([#6904](https://github.com/sveltejs/kit/pull/6904))
- Make url property getters non-enumerable ([#6909](https://github.com/sveltejs/kit/pull/6909))

## 1.0.0-next.489

### Patch Changes

- fix: tighten up handling and documentation around 404 ([#6897](https://github.com/sveltejs/kit/pull/6897))

## 1.0.0-next.488

### Patch Changes

- Decode HTML entities in `href` attributes when crawling ([#6891](https://github.com/sveltejs/kit/pull/6891))

## 1.0.0-next.487

### Patch Changes

- feat: allow +server.js files next to +page files ([#6773](https://github.com/sveltejs/kit/pull/6773))

## 1.0.0-next.486

### Patch Changes

- fix: handle jsdoc without tags while generating proxy types ([#6884](https://github.com/sveltejs/kit/pull/6884))

## 1.0.0-next.485

### Patch Changes

- fix to ActionData type generation ([#6869](https://github.com/sveltejs/kit/pull/6869))
- The return type of cookies.get is string|undefined #6865 ([#6867](https://github.com/sveltejs/kit/pull/6867))

## 1.0.0-next.484

### Patch Changes

- fix: forward cookies from fetch on redirect response ([#6833](https://github.com/sveltejs/kit/pull/6833))
- adding missing `@types/cookie` dependency ([#6818](https://github.com/sveltejs/kit/pull/6818))
- fix `write_types` on windows ([#6843](https://github.com/sveltejs/kit/pull/6843))

## 1.0.0-next.483

### Patch Changes

- fix: various `cookies` fixes and improvements ([#6811](https://github.com/sveltejs/kit/pull/6811))

## 1.0.0-next.482

### Patch Changes

- fix: ActionData type ([#6748](https://github.com/sveltejs/kit/pull/6748))
- fix: reuse server data while not reusing client load ([#6778](https://github.com/sveltejs/kit/pull/6778))
- fix: update current.url on hashchange ([#6802](https://github.com/sveltejs/kit/pull/6802))
- Change illegal import message to reference public-facing code rather than client-side code ([#6646](https://github.com/sveltejs/kit/pull/6646))
- fix: silence prop warnings ([#6798](https://github.com/sveltejs/kit/pull/6798))
- chore: Refactor graph analysis for better unit tests ([#6727](https://github.com/sveltejs/kit/pull/6727))
- fix: error when using `paths.base` and `import` assets ([#6769](https://github.com/sveltejs/kit/pull/6769))

## 1.0.0-next.481

### Patch Changes

- fix: docs links in generated and published types ([#6741](https://github.com/sveltejs/kit/pull/6741))

## 1.0.0-next.480

### Patch Changes

- breaking: make action passed to enhance function a URL instead of a string ([#6678](https://github.com/sveltejs/kit/pull/6678))

## 1.0.0-next.479

### Patch Changes

- breaking: request creation cleanup ([#6681](https://github.com/sveltejs/kit/pull/6681))
- breaking: limit adapter-node request size ([#6684](https://github.com/sveltejs/kit/pull/6684))

## 1.0.0-next.478

### Patch Changes

- breaking: hooks file renames; error shape defined through handleError ([#6675](https://github.com/sveltejs/kit/pull/6675))
- breaking: remove element property; enhance can only be used on form elements ([#6662](https://github.com/sveltejs/kit/pull/6662))

## 1.0.0-next.477

### Patch Changes

- breaking: prevent import of `$lib/server` modules in client-facing code ([#6623](https://github.com/sveltejs/kit/pull/6623))
- breaking: change sveltekit.message to sveltekit.error.message ([#6659](https://github.com/sveltejs/kit/pull/6659))
- breaking: apply 304 logic after handle, so handle receives original response from resolve ([#6639](https://github.com/sveltejs/kit/pull/6639))

## 1.0.0-next.476

### Patch Changes

- breaking: change use:enhance signature to support `<button formaction>` ([#6633](https://github.com/sveltejs/kit/pull/6633))

## 1.0.0-next.475

### Patch Changes

- cookies.delete fix #6609 ([#6622](https://github.com/sveltejs/kit/pull/6622))
- feat: provide `SubmitFunction` type ([#6613](https://github.com/sveltejs/kit/pull/6613))
- fix: address Vite warning when using base or asset path ([#6621](https://github.com/sveltejs/kit/pull/6621))

## 1.0.0-next.474

### Patch Changes

- breaking: disallow default and named actions next to each other ([#6615](https://github.com/sveltejs/kit/pull/6615))

## 1.0.0-next.473

### Patch Changes

- fix: pass `form` prop to pages ([#6611](https://github.com/sveltejs/kit/pull/6611))

## 1.0.0-next.472

### Patch Changes

- breaking: add API for interacting with cookies ([#6593](https://github.com/sveltejs/kit/pull/6593))
- breaking: Replace `POST`/`PUT`/`PATCH`/`DELETE` in `+page.server.js` with `export const actions` ([#6469](https://github.com/sveltejs/kit/pull/6469))

## 1.0.0-next.471

### Patch Changes

- breaking: Allow users to designate modules as server-only ([#6422](https://github.com/sveltejs/kit/pull/6422))
- breaking: exclude headers from serialized responses by default, add `filterSerializedResponseHeaders` `resolve` option ([#6569](https://github.com/sveltejs/kit/pull/6569))

## 1.0.0-next.470

### Patch Changes

- Bump vite-plugin-svelte and required vite version ([#6583](https://github.com/sveltejs/kit/pull/6583))
- feat: Support for `$env/dynamic/*` in Vite ecosystem tools ([#6454](https://github.com/sveltejs/kit/pull/6454))
- breaking: Replace `externalFetch` with `handleFetch` ([#6565](https://github.com/sveltejs/kit/pull/6565))

## 1.0.0-next.469

### Patch Changes

- disable `rollupOptions.output.hoistTransitiveImports` by default ([#6560](https://github.com/sveltejs/kit/pull/6560))

## 1.0.0-next.468

### Patch Changes

- breaking: simulate CORS errors in server-side fetch ([#6550](https://github.com/sveltejs/kit/pull/6550))

## 1.0.0-next.467

### Patch Changes

- breaking: prevent server-side fetch from reading files with # character in the filename ([#6549](https://github.com/sveltejs/kit/pull/6549))

## 1.0.0-next.466

### Patch Changes

- breaking: change Navigation type to include from/to.params and from/to.routeId ([#6552](https://github.com/sveltejs/kit/pull/6552))
- Warn about incorrect data-sveltekit-x values ([#6546](https://github.com/sveltejs/kit/pull/6546))

## 1.0.0-next.465

### Patch Changes

- feat: add `type` to navigation object ([#6537](https://github.com/sveltejs/kit/pull/6537))

## 1.0.0-next.464

### Patch Changes

- Fix server manifest generation ([#6507](https://github.com/sveltejs/kit/pull/6507))
- Silently skip prefetching of external URLs when using `data-sveltekit-prefetch`. Warn like before when calling `prefetch()` for external URLs. ([#6518](https://github.com/sveltejs/kit/pull/6518))

## 1.0.0-next.463

### Patch Changes

- fix peer dependency warning on vite-3.1.0-beta.1 ([#6512](https://github.com/sveltejs/kit/pull/6512))
- breaking: respect cache-control max-age on the client for initially fetched responses ([#6461](https://github.com/sveltejs/kit/pull/6461))

## 1.0.0-next.462

### Patch Changes

- breaking: block cross-site form POSTs by default. disable with config.kit.csrf.checkOrigin ([#6510](https://github.com/sveltejs/kit/pull/6510))

## 1.0.0-next.461

### Patch Changes

- breaking: call `invalidate(fn)` predicates with a URL instead of a string ([#6493](https://github.com/sveltejs/kit/pull/6493))
- Prefer JSON responses when returning errors if accept header is `*/*` ([#6497](https://github.com/sveltejs/kit/pull/6497))
- breaking: replace invalidate() with invalidateAll() ([#6493](https://github.com/sveltejs/kit/pull/6493))

## 1.0.0-next.460

### Patch Changes

- breaking: Remove sveltekit:start event ([#6484](https://github.com/sveltejs/kit/pull/6484))

## 1.0.0-next.459

### Patch Changes

- Prevent validation_errors from being serialized twice ([#6468](https://github.com/sveltejs/kit/pull/6468))

## 1.0.0-next.458

### Patch Changes

- breaking: catch and render raw response when unexpected error occurs in endpoint ([#6434](https://github.com/sveltejs/kit/pull/6434))

## 1.0.0-next.457

### Patch Changes

- Print error if resolveOpts.ssr is set ([#6475](https://github.com/sveltejs/kit/pull/6475))

## 1.0.0-next.456

### Patch Changes

- Apply `data-sveltekit-prefetch/noscroll/reload` to all child `<a>` elements ([#6442](https://github.com/sveltejs/kit/pull/6442))
- fix: Saving the root route will write types now ([#6450](https://github.com/sveltejs/kit/pull/6450))

## 1.0.0-next.455

### Patch Changes

- bump vite-plugin-svelte to 1.0.3 to fix an issue with svelte-inspector in vite 3.1 ([#6443](https://github.com/sveltejs/kit/pull/6443))
- chore: bump ts version and ensure it works with latest changes ([#6428](https://github.com/sveltejs/kit/pull/6428))
- breaking: `ssr/hydrate/router/prerender.default` are now configurable in `+page(.server).js` and `+layout(.server).js` ([#6197](https://github.com/sveltejs/kit/pull/6197))
- breaking: add `error.html` page, rename `kit.config.files.template` to `kit.config.files.appTemplate` ([#6367](https://github.com/sveltejs/kit/pull/6367))
- breaking: merge resolve options when using sequence helper ([#6401](https://github.com/sveltejs/kit/pull/6401))
- breaking: replace `router`/`hydrate` page options with `csr` ([#6446](https://github.com/sveltejs/kit/pull/6446))
- breaking: add `prerender = 'auto'` option, and extend `prerender` option to endpoints ([#6392](https://github.com/sveltejs/kit/pull/6392))

## 1.0.0-next.454

### Patch Changes

- breaking: Replace `sveltekit:*` with valid HTML attributes like `data-sveltekit-*` ([#6170](https://github.com/sveltejs/kit/pull/6170))

## 1.0.0-next.453

### Patch Changes

- Include type descriptions for ambient declarations ([#6416](https://github.com/sveltejs/kit/pull/6416))

## 1.0.0-next.452

### Patch Changes

- breaking: remove App.PrivateEnv and App.PublicEnv in favour of generated types ([#6413](https://github.com/sveltejs/kit/pull/6413))

## 1.0.0-next.451

### Patch Changes

- Prevent infinite reloads on `/` when root `+layout.server.js` exports `load` ([#6405](https://github.com/sveltejs/kit/pull/6405))

## 1.0.0-next.450

### Patch Changes

- breaking: require Vite 3.1.0-beta.1 ([#6398](https://github.com/sveltejs/kit/pull/6398))

## 1.0.0-next.449

### Patch Changes

- fix: silence unused type hints in generated proxy files ([#6391](https://github.com/sveltejs/kit/pull/6391))

## 1.0.0-next.448

### Patch Changes

- prevent test suites from getting published ([#6386](https://github.com/sveltejs/kit/pull/6386))
- fix: remove unnecessary JSON serialization of server data ([#6382](https://github.com/sveltejs/kit/pull/6382))
- breaking: require Node 16.14 ([#6388](https://github.com/sveltejs/kit/pull/6388))

## 1.0.0-next.447

### Patch Changes

- Use devalue to serialize server-only `load` return values ([#6318](https://github.com/sveltejs/kit/pull/6318))

## 1.0.0-next.446

### Patch Changes

- fix: encode if root layout has server load ([#6352](https://github.com/sveltejs/kit/pull/6352))

## 1.0.0-next.445

### Patch Changes

- breaking: rename `$app/env` to `$app/environment`, to disambiguate with `$env/...` ([#6334](https://github.com/sveltejs/kit/pull/6334))

## 1.0.0-next.444

### Patch Changes

- set errors on root component ([#6330](https://github.com/sveltejs/kit/pull/6330))
- fix: do not call server and update `$page.data` unnecessarily ([#6311](https://github.com/sveltejs/kit/pull/6311))

## 1.0.0-next.443

### Patch Changes

- fix: prevent unused types warning ([#6293](https://github.com/sveltejs/kit/pull/6293))
- fix: don't reuse server load data from previous page if current doesn't have a load function ([#6309](https://github.com/sveltejs/kit/pull/6309))

## 1.0.0-next.442

### Patch Changes

- fix: handle case where parent() refers to missing load function ([#6282](https://github.com/sveltejs/kit/pull/6282))

## 1.0.0-next.441

### Patch Changes

- fix: Set `errors` prop on all layout/leaf components, not just page that happens to be deepest ([#6279](https://github.com/sveltejs/kit/pull/6279))
- Fix route sorting with groups ([#6288](https://github.com/sveltejs/kit/pull/6288))

## 1.0.0-next.440

### Patch Changes

- fix: type tweaks ([#6271](https://github.com/sveltejs/kit/pull/6271))
- Correctly determine whether route uses server data ([#6275](https://github.com/sveltejs/kit/pull/6275))

## 1.0.0-next.439

### Patch Changes

- feat: add App.PageData type ([#6226](https://github.com/sveltejs/kit/pull/6226))

## 1.0.0-next.438

### Patch Changes

- more granular URL property tracking during load ([#6237](https://github.com/sveltejs/kit/pull/6237))
- breaking: change event.clientAddress to event.getClientAddress() ([#6237](https://github.com/sveltejs/kit/pull/6237))
- Remove all enumerable getters from RequestEvent and LoadEvent ([#6237](https://github.com/sveltejs/kit/pull/6237))

## 1.0.0-next.437

### Patch Changes

- fix: only generate blank non-SSR pages when prerendering is enabled ([#6251](https://github.com/sveltejs/kit/pull/6251))

## 1.0.0-next.436

### Patch Changes

- fix: prerender routes in a (group) ([#6232](https://github.com/sveltejs/kit/pull/6232))

## 1.0.0-next.435

### Patch Changes

- fix: allow `@` route breakouts to layouts in `[foo]` or `(foo)` directories ([#6224](https://github.com/sveltejs/kit/pull/6224))

## 1.0.0-next.434

### Patch Changes

- Always create `$types` for a route with a layout, leaf or endpoint ([#6222](https://github.com/sveltejs/kit/pull/6222))

## 1.0.0-next.433

### Patch Changes

- feat: Moved hooks.js initialization from Server.respond into Server.init ([#6179](https://github.com/sveltejs/kit/pull/6179))

## 1.0.0-next.432

### Patch Changes

- breaking: implement new layout system (see the PR for migration instructions) ([#6174](https://github.com/sveltejs/kit/pull/6174))

## 1.0.0-next.431

### Patch Changes

- feat: Avoid running load on the server unnecessarily ([#6056](https://github.com/sveltejs/kit/pull/6056))

## 1.0.0-next.430

### Patch Changes

- feat: Added config.kit.env.dir, which allows users to set a directory to search for .env files ([#6175](https://github.com/sveltejs/kit/pull/6175))

## 1.0.0-next.429

### Patch Changes

- fix: Prevent import of `$env/*/private` in client ([#6018](https://github.com/sveltejs/kit/pull/6018))
- Fix vite.config.ts "Cannot find module '@sveltejs/kit/vite' or its corresponding type declarations." ([#6140](https://github.com/sveltejs/kit/pull/6140))

## 1.0.0-next.428

### Patch Changes

- Allow `$app/stores` to be used from anywhere on the browser ([#6100](https://github.com/sveltejs/kit/pull/6100))
- use `enumerable: false` on "[x] no longer exists" getters so that they are not triggered by spreading ([#6105](https://github.com/sveltejs/kit/pull/6105))
- Fix pattern matching for routes starting with an encoded `@` symbol ([#6110](https://github.com/sveltejs/kit/pull/6110))
- Fix typos in generating `LayoutServerLoad.{name}` type ([#6123](https://github.com/sveltejs/kit/pull/6123))
- Fix sorting of files into +layout, +error, everything else. ([#6108](https://github.com/sveltejs/kit/pull/6108))
- Add test folder to generated tsconfig ([#6085](https://github.com/sveltejs/kit/pull/6085))

## 1.0.0-next.427

### Patch Changes

- Throw error if browser.hydrate is false and browser.router is true ([#6086](https://github.com/sveltejs/kit/pull/6086))

## 1.0.0-next.426

### Patch Changes

- Avoid using [].at(-1) in the client ([#6082](https://github.com/sveltejs/kit/pull/6082))

## 1.0.0-next.425

### Patch Changes

- Silence more unknown prop warnings coming from SvelteKit ([#6078](https://github.com/sveltejs/kit/pull/6078))

## 1.0.0-next.424

### Patch Changes

- prevent duplicate module ids by disabling optimizeDeps for @sveltejs/kit ([#6057](https://github.com/sveltejs/kit/pull/6057))
- Generate types when Svelte file missing, fix layout params ([#6066](https://github.com/sveltejs/kit/pull/6066))
- Silence unknown prop warnings coming from SvelteKit ([#6071](https://github.com/sveltejs/kit/pull/6071))

## 1.0.0-next.423

### Patch Changes

- Accumulate data from parent layouts into `export let data` ([#6050](https://github.com/sveltejs/kit/pull/6050))

## 1.0.0-next.422

### Patch Changes

- breaking: remove ability for `+page.server.js` to respond to `GET` requests with JSON ([#6007](https://github.com/sveltejs/kit/pull/6007))
- Handle `throw error/redirect` in `+server.js` ([#6028](https://github.com/sveltejs/kit/pull/6028))
- handle `set-cookie` in `setHeaders` ([#6033](https://github.com/sveltejs/kit/pull/6033))
- Handle windows paths and regexp chars in kit.alias ([#6034](https://github.com/sveltejs/kit/pull/6034))
- Make errors type in Action type less restrictive ([#6022](https://github.com/sveltejs/kit/pull/6022))
- Check that data is serializable ([#5987](https://github.com/sveltejs/kit/pull/5987))
- Fix parent data type for layouts referencing named layouts in the same folder ([#6025](https://github.com/sveltejs/kit/pull/6025))

## 1.0.0-next.421

### Patch Changes

- Respect `export const prerender = false` in `+page.server.js` ([#6012](https://github.com/sveltejs/kit/pull/6012))

## 1.0.0-next.420

### Patch Changes

- fix: support linked `@sveltejs/kit` project in Vite 3.0.3+ ([#5861](https://github.com/sveltejs/kit/pull/5861))

## 1.0.0-next.419

### Patch Changes

- Return a 303 response when a `POST` handler provides a `location` ([#5989](https://github.com/sveltejs/kit/pull/5989))
- Generate `__data.json` files for server-side redirects when prerendering ([#5997](https://github.com/sveltejs/kit/pull/5997))
- chore: remove chokidar as dependency of kit ([#5996](https://github.com/sveltejs/kit/pull/5996))
- Use relative asset paths where possible ([#4250](https://github.com/sveltejs/kit/pull/4250))

## 1.0.0-next.418

### Patch Changes

- Prevent double import of env modules ([#5955](https://github.com/sveltejs/kit/pull/5955))
- Tighten up params typings, fix load function typings, add event typings to generated types ([#5974](https://github.com/sveltejs/kit/pull/5974))

## 1.0.0-next.417

### Patch Changes

- Render pages without a .svelte file in their proper layout/error files ([#5972](https://github.com/sveltejs/kit/pull/5972))

## 1.0.0-next.416

### Patch Changes

- fix: allow additional keys in svelte.config.js ([#5961](https://github.com/sveltejs/kit/pull/5961))

## 1.0.0-next.415

### Patch Changes

- breaking: Remove session object ([#5946](https://github.com/sveltejs/kit/pull/5946))

## 1.0.0-next.414

### Patch Changes

- Correctly provide server parent data ([#5916](https://github.com/sveltejs/kit/pull/5916))

## 1.0.0-next.413

### Patch Changes

- feat: `$env/static/*` are now virtual to prevent writing sensitive values to disk ([#5825](https://github.com/sveltejs/kit/pull/5825))

## 1.0.0-next.412

### Patch Changes

- Lazy load Svelte components to reenable no-ssr use cases ([#5930](https://github.com/sveltejs/kit/pull/5930))

## 1.0.0-next.411

### Patch Changes

- Hydration validation errors ([#5918](https://github.com/sveltejs/kit/pull/5918))
- Handle function without params when writing TS proxy ([#5928](https://github.com/sveltejs/kit/pull/5928))
- fix: prevent `Content-Length` header from being incorrectly inherited by requests made from `load`'s `fetch` during SSR ([#5922](https://github.com/sveltejs/kit/pull/5922))
- Provide helpful error message on invalid named layout reference ([#5912](https://github.com/sveltejs/kit/pull/5912))

## 1.0.0-next.410

### Patch Changes

- Fix generated path extension for `AwaitedProperties` ([#5917](https://github.com/sveltejs/kit/pull/5917))

## 1.0.0-next.409

### Patch Changes

- make generated type import path ends in `.js` ([#5907](https://github.com/sveltejs/kit/pull/5907))

## 1.0.0-next.408

### Patch Changes

- Only search for layout name in basename ([#5897](https://github.com/sveltejs/kit/pull/5897))

## 1.0.0-next.407

### Patch Changes

- Allow actions to return undefined ([#5892](https://github.com/sveltejs/kit/pull/5892))
- fix: avoid manifest collisions ([#5874](https://github.com/sveltejs/kit/pull/5874))
- Make package command remove `publishConfig.directory` from generated package.json ([#5848](https://github.com/sveltejs/kit/pull/5848))

## 1.0.0-next.406

### Patch Changes

- breaking: Overhaul filesystem-based router (https://github.com/sveltejs/kit/discussions/5774) ([#5778](https://github.com/sveltejs/kit/pull/5778))
- breaking: Change load API (https://github.com/sveltejs/kit/discussions/5774) ([#5778](https://github.com/sveltejs/kit/pull/5778))

## 1.0.0-next.405

### Patch Changes

- Move `compress` logic to `Builder` API ([#5822](https://github.com/sveltejs/kit/pull/5822))
- feat: implement Link header ([#5735](https://github.com/sveltejs/kit/pull/5735))

## 1.0.0-next.404

### Patch Changes

- Build server without removing `sveltekit` Vite plugin ([#5839](https://github.com/sveltejs/kit/pull/5839))

## 1.0.0-next.403

### Patch Changes

- chore: upgrade to Undici 5.8.1 ([#5804](https://github.com/sveltejs/kit/pull/5804))

## 1.0.0-next.402

### Patch Changes

- fix: Import analysis doesn't get stuck in an infinite loop when encountering cyclical imports ([#5794](https://github.com/sveltejs/kit/pull/5794))

## 1.0.0-next.401

### Patch Changes

- fix: chdir to user's application directory before running postinstall sync ([#5771](https://github.com/sveltejs/kit/pull/5771))

## 1.0.0-next.400

### Patch Changes

- More robust path aliasing ([#5582](https://github.com/sveltejs/kit/pull/5582))

## 1.0.0-next.399

### Patch Changes

- Use @sveltejs/kit postinstall lifecycle hook to invoke 'svelte-kit sync' instead of prepare in projects created by create-svelte ([#5760](https://github.com/sveltejs/kit/pull/5760))

## 1.0.0-next.398

### Patch Changes

- Check url protocol to avoid mailto links navigated by kit in mobile devices ([#5726](https://github.com/sveltejs/kit/pull/5726))
- fix: Windows correctly errors on `$env/*/private` imports and Illegal module analysis in dev ignores non-js|ts|svelte files ([#5739](https://github.com/sveltejs/kit/pull/5739))
- feat: include reference to `@sveltejs/kit` types in ambient file ([#5745](https://github.com/sveltejs/kit/pull/5745))

## 1.0.0-next.397

### Patch Changes

- load env before importing hooks during dev ([#5728](https://github.com/sveltejs/kit/pull/5728))
- Add DOM.Iterable to default tsconfig ([#5734](https://github.com/sveltejs/kit/pull/5734))

## 1.0.0-next.396

### Patch Changes

- fix: Environment variable generated types ([#5719](https://github.com/sveltejs/kit/pull/5719))

## 1.0.0-next.395

### Patch Changes

- Add `$env/static/private`, `$env/static/public`, `$env/dynamic/private` and `$env/dynamic/public` modules ([#5663](https://github.com/sveltejs/kit/pull/5663))

## 1.0.0-next.394

### Patch Changes

- Set Vite's publicDir and correctly serve public assets earlier in pipeline ([#5686](https://github.com/sveltejs/kit/pull/5686))
- prerender in a subprocess ([#5678](https://github.com/sveltejs/kit/pull/5678))

## 1.0.0-next.393

### Patch Changes

- Prevent needless prop updates causing rerenders ([#5671](https://github.com/sveltejs/kit/pull/5671))
- Support custom Vite config locations ([#5705](https://github.com/sveltejs/kit/pull/5705))
- Prevent rerender when route state did not change ([#5654](https://github.com/sveltejs/kit/pull/5654))

## 1.0.0-next.392

### Patch Changes

- Revert publicDir change from 1.0.0-next.387 ([#5683](https://github.com/sveltejs/kit/pull/5683))

## 1.0.0-next.391

### Patch Changes

- breaking: replace transformPage with transformPageChunk ([#5657](https://github.com/sveltejs/kit/pull/5657))

## 1.0.0-next.390

### Patch Changes

- fix: vite dev no longer covers errors ([#5563](https://github.com/sveltejs/kit/pull/5563))

## 1.0.0-next.389

### Patch Changes

- Only normalise internal URLs ([#5645](https://github.com/sveltejs/kit/pull/5645))

## 1.0.0-next.388

### Patch Changes

- Reset stack traces to avoid double-fix ([#5644](https://github.com/sveltejs/kit/pull/5644))

## 1.0.0-next.387

### Patch Changes

- set Vite's `publicDir` option ([#5648](https://github.com/sveltejs/kit/pull/5648))
- Normalize paths inside prerenderer, so they are correct inside \$service-worker ([#5641](https://github.com/sveltejs/kit/pull/5641))

## 1.0.0-next.386

### Patch Changes

- Ensure private cache when something is returned from getSession hook ([#5640](https://github.com/sveltejs/kit/pull/5640))
- fix: transform link[rel=icon] to be absolute to avoid console error when navigating ([#5583](https://github.com/sveltejs/kit/pull/5583))

## 1.0.0-next.385

### Patch Changes

- Make 404 error more helpful if paths.base is missing ([#5622](https://github.com/sveltejs/kit/pull/5622))
- fix: decode parameters on client ([`d02f1f25`](https://github.com/sveltejs/kit/commit/d02f1f25ac8acb29e21a06b94418c333928fb9bb))
- Add config.kit.prerender.origin ([#5627](https://github.com/sveltejs/kit/pull/5627))

## 1.0.0-next.384

### Patch Changes

- Respect custom Vite mode in SSR build ([#5602](https://github.com/sveltejs/kit/pull/5602))
- breaking: remove mode, prod and server from \$app/env ([#5602](https://github.com/sveltejs/kit/pull/5602))

## 1.0.0-next.383

### Patch Changes

- Add formData method in superclass rather than monkey-patch ([#5629](https://github.com/sveltejs/kit/pull/5629))

## 1.0.0-next.382

### Patch Changes

- fix: change Vite's output directory from `_app` to client ([#5620](https://github.com/sveltejs/kit/pull/5620))

## 1.0.0-next.381

### Patch Changes

- Handle errors in Node streams ([#5616](https://github.com/sveltejs/kit/pull/5616))

## 1.0.0-next.380

### Patch Changes

- Handle circular dependencies in dynamic imports ([#5619](https://github.com/sveltejs/kit/pull/5619))
- fix: handle binary data when prerendering ([#5497](https://github.com/sveltejs/kit/pull/5497))
- breaking: remove writeStatic to align with Vite ([#5618](https://github.com/sveltejs/kit/pull/5618))
- Reset navigating store upon return to site with a bfcache hit ([#5613](https://github.com/sveltejs/kit/pull/5613))

## 1.0.0-next.379

### Patch Changes

- Use define instead of import.meta.env.VITE_SVELTEKIT_FOO for internal values ([#5594](https://github.com/sveltejs/kit/pull/5594))

## 1.0.0-next.378

### Patch Changes

- Pause Node streams as necessary when converting to ReadableStream ([#5587](https://github.com/sveltejs/kit/pull/5587))
- improve vite version check to work with custom resolutions, eg. pnpm overrides ([#5586](https://github.com/sveltejs/kit/pull/5586))

## 1.0.0-next.377

### Patch Changes

- breaking: Endpoint method names uppercased to match HTTP specifications ([#5513](https://github.com/sveltejs/kit/pull/5513))

## 1.0.0-next.376

### Patch Changes

- fix: ensure completed_build is reset ([#5541](https://github.com/sveltejs/kit/pull/5541))

## 1.0.0-next.375

### Patch Changes

- fix: don't try adapting if build failed ([#5536](https://github.com/sveltejs/kit/pull/5536))
- Render generic error page if `__layout` returns error while rendering full error page ([#4665](https://github.com/sveltejs/kit/pull/4665))

## 1.0.0-next.374

### Patch Changes

- removed `vite` key from config definition ([#5530](https://github.com/sveltejs/kit/pull/5530))
- Render page with correct status code when non-get endpoint returns validation error ([#4328](https://github.com/sveltejs/kit/pull/4328))

## 1.0.0-next.373

### Patch Changes

- breaking: require vite 3 ([#5005](https://github.com/sveltejs/kit/pull/5005))

## 1.0.0-next.372

### Patch Changes

- ignore invalid accept header values instead of throwing an error ([#5502](https://github.com/sveltejs/kit/pull/5502))
- support CSP report-only mode ([#5496](https://github.com/sveltejs/kit/pull/5496))

## 1.0.0-next.371

### Patch Changes

- Pin vite-plugin-svelte to 1.0.0-next.49 ([#5498](https://github.com/sveltejs/kit/pull/5498))

## 1.0.0-next.370

### Patch Changes

- Don't automatically buffer request bodies ([#5442](https://github.com/sveltejs/kit/pull/5442))

## 1.0.0-next.369

### Patch Changes

- skip closeBundle hook during dev to prevent errors on restart ([#5466](https://github.com/sveltejs/kit/pull/5466))
- Normalize paths on prefetch (fixes [#5457](https://github.com/sveltejs/kit/issues/5457)) ([#5458](https://github.com/sveltejs/kit/pull/5458))
- clearer error on bad matcher names ([#5460](https://github.com/sveltejs/kit/pull/5460))

## 1.0.0-next.368

### Patch Changes

- fix: adapt in closeBundle ([#5439](https://github.com/sveltejs/kit/pull/5439))

## 1.0.0-next.367

### Patch Changes

- fix: allow Vite plugins to output mutable assets ([#5416](https://github.com/sveltejs/kit/pull/5416))

## 1.0.0-next.366

### Patch Changes

- reset selection in setTimeout after navigating, to ensure correct behaviour in Firefox ([#5058](https://github.com/sveltejs/kit/pull/5058))

## 1.0.0-next.365

### Patch Changes

- Serve static assets before routes in dev, but only if in an allowed directory ([#5070](https://github.com/sveltejs/kit/pull/5070))
- breaking: Allow %-encoded filenames ([#5056](https://github.com/sveltejs/kit/pull/5056))

## 1.0.0-next.364

### Patch Changes

- breaking: Use Vite defaults for port and strictPort ([#5392](https://github.com/sveltejs/kit/pull/5392))
- Use anonymous function in service worker init script to support legacy browsers ([#5417](https://github.com/sveltejs/kit/pull/5417))

## 1.0.0-next.363

### Patch Changes

- chore: upgrade TypeScript to 4.7.4 ([#5414](https://github.com/sveltejs/kit/pull/5414))

## 1.0.0-next.362

### Patch Changes

- Updated undici to fix #5383 ([#5420](https://github.com/sveltejs/kit/pull/5420))

## 1.0.0-next.361

### Patch Changes

- breaking: require Node 16.9 ([#5395](https://github.com/sveltejs/kit/pull/5395))
- remove FLoC protection, now that we vanquished Google ([#5018](https://github.com/sveltejs/kit/pull/5018))
- Prevent `Connection` header from being incorrectly inherited by requests made from `load`'s `fetch` during SSR ([#5393](https://github.com/sveltejs/kit/pull/5393))
- Returns errors from page endpoints as JSON where appropriate ([#5314](https://github.com/sveltejs/kit/pull/5314))
- Allow body to be a binary ReadableStream ([#5407](https://github.com/sveltejs/kit/pull/5407))

## 1.0.0-next.360

### Patch Changes

- fix: support conditional Vite configs ([#5376](https://github.com/sveltejs/kit/pull/5376))
- Allow server restart when config changed ([#5379](https://github.com/sveltejs/kit/pull/5379))
- Include dynamically imported styles during SSR ([#5138](https://github.com/sveltejs/kit/pull/5138))

## 1.0.0-next.359

### Patch Changes

- Adjust type imports to satisfy TS NodeNext moduleResolution ([#5360](https://github.com/sveltejs/kit/pull/5360))
- breaking: require vite.config.js ([#5332](https://github.com/sveltejs/kit/pull/5332))
- breaking: graduate @sveltejs/kit/vite from experimental ([#5332](https://github.com/sveltejs/kit/pull/5332))
- breaking: switch to vite CLI for dev, build, and preview commands ([#5332](https://github.com/sveltejs/kit/pull/5332))

## 1.0.0-next.358

### Patch Changes

- Only exit process in closeBundle hook if prerender is enabled ([#5356](https://github.com/sveltejs/kit/pull/5356))
- fix: don't log warning if root is configured ([#5330](https://github.com/sveltejs/kit/pull/5330))

## 1.0.0-next.357

### Patch Changes

- breaking: change endpointExtensions to moduleExtensions, and use to filter param matchers ([#5085](https://github.com/sveltejs/kit/pull/5085))
- fix server crash when accessing a malformed URI ([#5246](https://github.com/sveltejs/kit/pull/5246))

## 1.0.0-next.356

### Patch Changes

- Stream request bodies ([#5291](https://github.com/sveltejs/kit/pull/5291))
- Enable multipart formdata parsing with node-fetch ([#5292](https://github.com/sveltejs/kit/pull/5292))
- fix: allow user to set dev port ([#5303](https://github.com/sveltejs/kit/pull/5303))
- breaking: use undici instead of node-fetch ([#5117](https://github.com/sveltejs/kit/pull/5117))

## 1.0.0-next.355

### Patch Changes

- chore: Prerendering URL is now a subclass instead of a proxy ([#5278](https://github.com/sveltejs/kit/pull/5278))
- fix: support vite.config.js on Windows ([#5265](https://github.com/sveltejs/kit/pull/5265))
- Allow both string and URL as the first argument of `$app/navigation#goto` ([#5282](https://github.com/sveltejs/kit/pull/5282))
- rename `goto(href)` to `goto(url)` ([#5286](https://github.com/sveltejs/kit/pull/5286))
- Add types for @sveltejs/kit/experimental/vite ([#5266](https://github.com/sveltejs/kit/pull/5266))
- fix: port flag doesn't work in preview ([#5284](https://github.com/sveltejs/kit/pull/5284))

## 1.0.0-next.354

### Patch Changes

- Added `server` and `prod` env variables ([#5251](https://github.com/sveltejs/kit/pull/5251))

## 1.0.0-next.353

### Patch Changes

- Expose Vite plugin as @sveltejs/kit/experimental/vite ([#5094](https://github.com/sveltejs/kit/pull/5094))

## 1.0.0-next.352

### Patch Changes

- fix manifest not updating when adding routes ([#5157](https://github.com/sveltejs/kit/pull/5157))

## 1.0.0-next.351

### Patch Changes

- fix: URL instance methods now work in `load` ([#5183](https://github.com/sveltejs/kit/pull/5183))
- Upgrade vite-plugin-svelte ([`4e4625ea`](https://github.com/sveltejs/kit/commit/4e4625ea6d9a084bc767ae216704aacd95fe8730))

## 1.0.0-next.350

### Patch Changes

- breaking: revert removal of `kit.browser.hydrate` ([#5178](https://github.com/sveltejs/kit/pull/5178))

## 1.0.0-next.349

### Patch Changes

- breaking: remove kit.browser.hydrate config in favor of compilerOptions.hydratable ([#5155](https://github.com/sveltejs/kit/pull/5155))
- chore: upgrade to Vite 2.9.10 ([#5170](https://github.com/sveltejs/kit/pull/5170))

## 1.0.0-next.348

### Patch Changes

- Disallow access to `__data.json` for standalone endpoints ([#5149](https://github.com/sveltejs/kit/pull/5149))
- chore: introduce `KitConfig` type ([#5141](https://github.com/sveltejs/kit/pull/5141))
- Prevent incorrect redirect for `__data.json` request with `trailingSlash: 'always'` ([#5149](https://github.com/sveltejs/kit/pull/5149))

## 1.0.0-next.347

### Patch Changes

- Update dependencies ([#5121](https://github.com/sveltejs/kit/pull/5121))
- allow symlinked static assets in dev ([#5089](https://github.com/sveltejs/kit/pull/5089))

## 1.0.0-next.346

### Patch Changes

- chore: provide Vite config via plugin ([#5073](https://github.com/sveltejs/kit/pull/5073))
- Reload page to recover from HMR errors ([#5108](https://github.com/sveltejs/kit/pull/5108))
- chore: shared Vite build config ([#5105](https://github.com/sveltejs/kit/pull/5105))
- fix `BodyValidator` handling for nested object literals ([#5118](https://github.com/sveltejs/kit/pull/5118))
- fix: don't set `credentials` to `undefined` in server-side `fetch` ([#5116](https://github.com/sveltejs/kit/pull/5116))

## 1.0.0-next.345

### Patch Changes

- Prevent component double mounting caused by HMR invalidation ([#4891](https://github.com/sveltejs/kit/pull/4891))
- Only recreate manifest when files inside `config.kit.files.routes` are added or deleted ([#5076](https://github.com/sveltejs/kit/pull/5076))

## 1.0.0-next.344

### Patch Changes

- fix: svelte-kit sync no longer permanently deletes the types directory ([#5063](https://github.com/sveltejs/kit/pull/5063))
- chore: trigger sync and other setup from plugin ([#5067](https://github.com/sveltejs/kit/pull/5067))
- Update `engines` to specify that Node 16.7 is required ([#5062](https://github.com/sveltejs/kit/pull/5062))
- only serve `_app/immutable` with immutable cache header, not `_app/version.json` ([#5051](https://github.com/sveltejs/kit/pull/5051))

## 1.0.0-next.343

### Patch Changes

- chore: return config from server start methods ([#5043](https://github.com/sveltejs/kit/pull/5043))

## 1.0.0-next.342

### Patch Changes

- ensure static assets are only served if correct case is used ([#5047](https://github.com/sveltejs/kit/pull/5047))
- breaking: stop suppressing `/favicon.ico` requests, handle them as a valid route ([#5046](https://github.com/sveltejs/kit/pull/5046))
- don't warn about window.fetch during hydration ([#5041](https://github.com/sveltejs/kit/pull/5041))

## 1.0.0-next.341

### Patch Changes

- fix: page store correct after navigation when an identical route with a different hash had been prefetched ([#5039](https://github.com/sveltejs/kit/pull/5039))
- breaking: replace @sveltejs/kit/install-fetch with @sveltejs/kit/node/polyfills ([#4934](https://github.com/sveltejs/kit/pull/4934))
- fix: Prerendered pages fail if they access session. ([#4811](https://github.com/sveltejs/kit/pull/4811))

## 1.0.0-next.340

### Patch Changes

- feat: Pages marked for prerendering fail during ssr at runtime ([#4812](https://github.com/sveltejs/kit/pull/4812))
- Throw load validation errors so that they are caught by handleError ([#4953](https://github.com/sveltejs/kit/pull/4953))
- Allow symlinked directories in the routes folder ([#4957](https://github.com/sveltejs/kit/pull/4957))
- breaking: Rename LoadInput to LoadEvent ([#5015](https://github.com/sveltejs/kit/pull/5015))
- allow disableScrollHandling to be called in afterNavigate ([#4948](https://github.com/sveltejs/kit/pull/4948))
- Add `config.kit.alias` ([#4964](https://github.com/sveltejs/kit/pull/4964))
- use namespace import for vite to support upcoming vite 3.0 esm ([#5030](https://github.com/sveltejs/kit/pull/5030))

## 1.0.0-next.339

### Patch Changes

- breaking: resolve relative urls from the target page when using load's fetch ([#5025](https://github.com/sveltejs/kit/pull/5025))
- fix: `svelte-kit sync` gracefully handles a nonexistent routes folder ([#5020](https://github.com/sveltejs/kit/pull/5020))
- breaking: Replace `%svelte.body%` with `%sveltekit.body%`, etc. ([#5016](https://github.com/sveltejs/kit/pull/5016))

## 1.0.0-next.338

### Patch Changes

- breaking: remove amp config option in favour of amp.transform helper function ([#4710](https://github.com/sveltejs/kit/pull/4710))
- breaking: accessing url.hash from load now results in a helpful error ([#4983](https://github.com/sveltejs/kit/pull/4983))

## 1.0.0-next.337

### Patch Changes

- fix: don't watch `outDir`, except for the `generated` directory ([#4997](https://github.com/sveltejs/kit/pull/4997))
- Warn if load uses window.fetch ([#4958](https://github.com/sveltejs/kit/pull/4958))
- Only run `viteServeStaticMiddleware` after server has attempted response ([#4974](https://github.com/sveltejs/kit/pull/4974))

## 1.0.0-next.336

### Patch Changes

- Pass config to vite-plugin-svelte instead of reloading it ([#4760](https://github.com/sveltejs/kit/pull/4760))
- fix FOUC regression during dev ([#4990](https://github.com/sveltejs/kit/pull/4990))
- move `RequestEvent` and `ResolveOptions` as public types ([#4809](https://github.com/sveltejs/kit/pull/4809))
- breaking: write generated types to `__types` directories ([#4705](https://github.com/sveltejs/kit/pull/4705))

## 1.0.0-next.335

### Patch Changes

- breaking: change data-hydrate to data-sveltekit-hydrate ([#4972](https://github.com/sveltejs/kit/pull/4972))
- Fix default port override ([#4970](https://github.com/sveltejs/kit/pull/4970))

## 1.0.0-next.334

### Patch Changes

- fix: deduplicate injected css during dev ([#4920](https://github.com/sveltejs/kit/pull/4920))

## 1.0.0-next.333

### Patch Changes

- breaking: delay automatic service worker registration until load event ([#4950](https://github.com/sveltejs/kit/pull/4950))

## 1.0.0-next.332

### Patch Changes

- Revert dev command default options ([#4949](https://github.com/sveltejs/kit/pull/4949))

## 1.0.0-next.331

### Patch Changes

- fix `BodyValidator` for nested interfaces ([#4939](https://github.com/sveltejs/kit/pull/4939))
- breaking: drop Node 14 support ([#4922](https://github.com/sveltejs/kit/pull/4922))
- only skip files that were already written when prerendering ([#4928](https://github.com/sveltejs/kit/pull/4928))
- Set default options for dev command ([#4932](https://github.com/sveltejs/kit/pull/4932))

## 1.0.0-next.330

### Patch Changes

- Fix Safari scroll bug on ssr:false page reload ([#4846](https://github.com/sveltejs/kit/pull/4846))

## 1.0.0-next.329

### Patch Changes

- fix: stop flash of unstyled content when using CSS flavours ([#4882](https://github.com/sveltejs/kit/pull/4882))
- delegate `RequestHandler` generics `Body` validation ([#4897](https://github.com/sveltejs/kit/pull/4897))
- feat: more specific types for `kit.prerender.entries` config ([#4880](https://github.com/sveltejs/kit/pull/4880))
- Prevent unhandled rejections when loading page modules ([#4732](https://github.com/sveltejs/kit/pull/4732))

## 1.0.0-next.328

### Patch Changes

- Print useful 404 response when requesting unprefixed path in preview ([#4751](https://github.com/sveltejs/kit/pull/4751))
- Prevent naive path normalization during prerendering ([#4761](https://github.com/sveltejs/kit/pull/4761))

## 1.0.0-next.327

### Patch Changes

- generate tsconfig when running svelte-kit package ([#4824](https://github.com/sveltejs/kit/pull/4824))

## 1.0.0-next.326

### Patch Changes

- breaking: add lib, module, and target to generated tsconfig ([#4791](https://github.com/sveltejs/kit/pull/4791))

## 1.0.0-next.325

### Patch Changes

- Display network logs in node 18 ([#4778](https://github.com/sveltejs/kit/pull/4778))

## 1.0.0-next.324

### Patch Changes

- Throw errors on encountering named layout in directory ([#4756](https://github.com/sveltejs/kit/pull/4756))

## 1.0.0-next.323

### Patch Changes

- Default to target: node14.8, so that top-level await is supported in user code ([#4742](https://github.com/sveltejs/kit/pull/4742))
- Only complain about missing \$lib paths in tsconfig if src/lib exists ([#4735](https://github.com/sveltejs/kit/pull/4735))
- Include all assets in `$service-worker` build, not just CSS ([#4744](https://github.com/sveltejs/kit/pull/4744))

## 1.0.0-next.322

### Patch Changes

- Copy dotfiles from .svelte-kit/output ([#4725](https://github.com/sveltejs/kit/pull/4725))
- breaking: Ignore `trailingSlash` for endpoint requests, apply `trailingSlash` to pages consistently ([#4699](https://github.com/sveltejs/kit/pull/4699))

## 1.0.0-next.321

### Patch Changes

- Tweak error message for non-validating base paths ([#4713](https://github.com/sveltejs/kit/pull/4713))
- breaking: Supplying an empty `--host` option to `preview` exposes the server to both ipv4 and ipv6 networks ([#4729](https://github.com/sveltejs/kit/pull/4729))
- throw error on encountering infinite layout loop ([#4730](https://github.com/sveltejs/kit/pull/4730))

## 1.0.0-next.320

### Patch Changes

- breaking: Replace `maxage` with `cache` in `LoadOutput` ([#4690](https://github.com/sveltejs/kit/pull/4690))

## 1.0.0-next.319

### Patch Changes

- Add --watch flag to svelte-kit package ([#4658](https://github.com/sveltejs/kit/pull/4658))

## 1.0.0-next.318

### Patch Changes

- fix broken AdapterEntry type ([#4674](https://github.com/sveltejs/kit/pull/4674))

## 1.0.0-next.317

### Patch Changes

- Navigation to current URL is no longer a no-op ([#4664](https://github.com/sveltejs/kit/pull/4664))
- builder.createEntries returns a promise that awaits complete() callbacks ([#4663](https://github.com/sveltejs/kit/pull/4663))
- navigation store resets to null after aborted nav ([#4664](https://github.com/sveltejs/kit/pull/4664))

## 1.0.0-next.316

### Patch Changes

- `invalidate` with `predicate` function ([#4636](https://github.com/sveltejs/kit/pull/4636))

## 1.0.0-next.315

### Patch Changes

- Apply set-cookie headers from page dependencies ([#4588](https://github.com/sveltejs/kit/pull/4588))
- Include disallowed method name in 405 response, include Allow header ([#4614](https://github.com/sveltejs/kit/pull/4614))
- apply updated `props.page` when update or goto page ([#4392](https://github.com/sveltejs/kit/pull/4392))
- rename `data-svelte` attribute to `data-sveltekit` ([#4641](https://github.com/sveltejs/kit/pull/4641))

## 1.0.0-next.314

### Patch Changes

- Custom `load` `dependencies` in `LoadOutput` ([#4536](https://github.com/sveltejs/kit/pull/4536))
- Made LoadInput and LoadOutput types public, merged ErrorLoad and Load declarations ([#4515](https://github.com/sveltejs/kit/pull/4515))

## 1.0.0-next.313

### Patch Changes

- add `platform` to requests triggered by `fetch` in `load` during SSR ([#4599](https://github.com/sveltejs/kit/pull/4599))

## 1.0.0-next.312

### Patch Changes

- Only render fallback when prerendering is enabled ([#4604](https://github.com/sveltejs/kit/pull/4604))

## 1.0.0-next.311

### Patch Changes

- Skip client-side navigation for links with sveltekit:reload ([#4545](https://github.com/sveltejs/kit/pull/4545))
- breaking: Skip prerendering for rel="external" links ([#4545](https://github.com/sveltejs/kit/pull/4545))

## 1.0.0-next.310

### Patch Changes

- Remove credentials when creating request object in server-side fetch ([#4548](https://github.com/sveltejs/kit/pull/4548))

## 1.0.0-next.309

### Patch Changes

- Fix session store subscription tracking during SSR ([#4550](https://github.com/sveltejs/kit/pull/4550))

## 1.0.0-next.308

### Patch Changes

- Remove `static` directory from Vite's control ([#4535](https://github.com/sveltejs/kit/pull/4535))

## 1.0.0-next.307

### Patch Changes

- Allow index files to use named layouts ([#4527](https://github.com/sveltejs/kit/pull/4527))
- Respect ssr option when rendering 404 page ([#4513](https://github.com/sveltejs/kit/pull/4513))
- Remove unimplemented option from CLI ([#4507](https://github.com/sveltejs/kit/pull/4507))
- Move MaybePromise from RequestHandlerOutput to RequestHandler return value ([#4519](https://github.com/sveltejs/kit/pull/4519))

## 1.0.0-next.306

### Patch Changes

- Hint if `paths.base` is missing in dev ([#4510](https://github.com/sveltejs/kit/pull/4510))
- Respect `paths.base` when using `--open` ([#4510](https://github.com/sveltejs/kit/pull/4510))
- breaking: Add named layouts, remove `__layout.reset` ([#4388](https://github.com/sveltejs/kit/pull/4388))

## 1.0.0-next.305

### Patch Changes

- Generate correct types for routes with parameter matchers ([#4472](https://github.com/sveltejs/kit/pull/4472))

## 1.0.0-next.304

### Patch Changes

- Upgrade to Vite 2.9 ([#4468](https://github.com/sveltejs/kit/pull/4468))
- allow files and directories named `__tests__` and `__test__` in the routes directory ([#4438](https://github.com/sveltejs/kit/pull/4438))
- Create fallback page when prerendering is disabled ([#4443](https://github.com/sveltejs/kit/pull/4443))

## 1.0.0-next.303

### Patch Changes

- fix: don't use client-side navigation when clicking on a link to the same path on a different origin ([#4433](https://github.com/sveltejs/kit/pull/4433))

## 1.0.0-next.302

### Patch Changes

- fix: don't redirect to external URLs when normalizing paths ([#4414](https://github.com/sveltejs/kit/pull/4414))
- Fix error link for fallthrough replacement ([#4408](https://github.com/sveltejs/kit/pull/4408))

## 1.0.0-next.301

### Patch Changes

- Skip svelte-kit sync if no config file exists yet ([#4372](https://github.com/sveltejs/kit/pull/4372))

## 1.0.0-next.300

### Patch Changes

- fix: correctly populate `event.url.host` in dev mode when using `--https` ([#4364](https://github.com/sveltejs/kit/pull/4364))
- fix rest param type generation ([#4361](https://github.com/sveltejs/kit/pull/4361))
- breaking: Rename validators to matchers ([#4358](https://github.com/sveltejs/kit/pull/4358))

## 1.0.0-next.299

### Patch Changes

- Populate fallback page when trailingSlash is "always" ([#4351](https://github.com/sveltejs/kit/pull/4351))
- Expose `event.routeId` and `page.routeId` ([#4345](https://github.com/sveltejs/kit/pull/4345))
- breaking: remove fallthrough routes ([#4330](https://github.com/sveltejs/kit/pull/4330))
- Add param validators ([#4334](https://github.com/sveltejs/kit/pull/4334))
- breaking: disallow \$ character in dynamic parameters ([#4334](https://github.com/sveltejs/kit/pull/4334))
- Populate event.params before calling handle ([#4344](https://github.com/sveltejs/kit/pull/4344))

## 1.0.0-next.298

### Patch Changes

- fix: correctly detect removal of route ([#4333](https://github.com/sveltejs/kit/pull/4333))

## 1.0.0-next.297

### Patch Changes

- breaking: allow `InputProps` and `OutputProps` to be typed separately in generated `Load` ([#4305](https://github.com/sveltejs/kit/pull/4305))
- allow `Output` to be typed in generated `RequestHandler` ([#4305](https://github.com/sveltejs/kit/pull/4305))
- breaking: require adapters to supply a getClientAddress function ([#4289](https://github.com/sveltejs/kit/pull/4289))
- Allow page endpoint without GET handler ([#4318](https://github.com/sveltejs/kit/pull/4318))
- Return 404 when fetching missing data during prerender ([#4324](https://github.com/sveltejs/kit/pull/4324))
- expose client IP address as event.clientAddress ([#4289](https://github.com/sveltejs/kit/pull/4289))

## 1.0.0-next.296

### Patch Changes

- Allow adapter.adapt to be synchronous ([#4299](https://github.com/sveltejs/kit/pull/4299))
- Make `manifest.mimeTypes` part of the public API ([#4302](https://github.com/sveltejs/kit/pull/4302))
- load hooks after server initialisation, to ensure `prerendering` is correct ([#4322](https://github.com/sveltejs/kit/pull/4322))

## 1.0.0-next.295

### Patch Changes

- fix error message for invalid request object ([#4277](https://github.com/sveltejs/kit/pull/4277))
- Handle explicit redirects from endpoints ([#4260](https://github.com/sveltejs/kit/pull/4260))
- Allow routes with the same name as fallback components ([#4284](https://github.com/sveltejs/kit/pull/4284))

## 1.0.0-next.294

### Patch Changes

- breaking: Replace timestamp in \$service-worker with version ([#4213](https://github.com/sveltejs/kit/pull/4213))
- Remove declared `$lib` module ([#4227](https://github.com/sveltejs/kit/pull/4227))

## 1.0.0-next.293

### Patch Changes

- Expose Server and SSRManifest as public types ([#4220](https://github.com/sveltejs/kit/pull/4220))
- fetch `version.json` relative to `paths.assets`, if set ([#4234](https://github.com/sveltejs/kit/pull/4234))

## 1.0.0-next.292

### Patch Changes

- Prevent Vite from copying static assets if directory is called "public" ([#4214](https://github.com/sveltejs/kit/pull/4214))
- Add sync CLI command ([#4182](https://github.com/sveltejs/kit/pull/4182))
- breaking: expose entire config to adapters, rather than just appDir and trailingSlash ([#4192](https://github.com/sveltejs/kit/pull/4192))
- breaking: replace builder.prerender() with builder.writePrerendered() and builder.prerendered ([#4192](https://github.com/sveltejs/kit/pull/4192))
- breaking: prerender pages during build, regardless of adapter ([#4192](https://github.com/sveltejs/kit/pull/4192))
- Add config.kit.prerender.default option ([#4192](https://github.com/sveltejs/kit/pull/4192))
- Ensure props are loaded from matching endpoint during client-side navigation ([#4203](https://github.com/sveltejs/kit/pull/4203))
- Use prerendered pages in svelte-kit preview ([#4192](https://github.com/sveltejs/kit/pull/4192))
- Upgrade to TypeScript 4.6 ([#4190](https://github.com/sveltejs/kit/pull/4190))
- Fix `svelte-kit preview` ([#4207](https://github.com/sveltejs/kit/pull/4207))
- Make prerendered paths available to service workers ([#4192](https://github.com/sveltejs/kit/pull/4192))
- Update history immediately before updating DOM ([#4191](https://github.com/sveltejs/kit/pull/4191))
- Add config.kit.endpointExtensions option ([#4197](https://github.com/sveltejs/kit/pull/4197))

## 1.0.0-next.291

### Patch Changes

- Focus on `body` instead of `html` on navigation due to issues on Firefox ([#4184](https://github.com/sveltejs/kit/pull/4184))

## 1.0.0-next.290

### Patch Changes

- Add config.kit.outDir ([#4176](https://github.com/sveltejs/kit/pull/4176))
- breaking: allow `InputProps` and `OutputProps` to be typed separately in `Load` ([#4160](https://github.com/sveltejs/kit/pull/4160))

## 1.0.0-next.289

### Patch Changes

- Only fall back to full page reload if pathname has changed ([#4116](https://github.com/sveltejs/kit/pull/4116))
- Generate types for each page/endpoint ([#4120](https://github.com/sveltejs/kit/pull/4120))
- Extend user tsconfig from generated .svelte-kit/tsconfig.json ([#4118](https://github.com/sveltejs/kit/pull/4118))

## 1.0.0-next.288

### Patch Changes

- Fix XSS vulnerability on SSR pages with fetched data on `load()` ([#4128](https://github.com/sveltejs/kit/pull/4128))
- breaking: `tabindex="-1"` is no longer added to `<body>`; `<html>` only briefly receives it during navigation ([#4140](https://github.com/sveltejs/kit/pull/4140))
- `RequestHandlerOutput` accepts body when it has or maybe is `undefined` ([#4152](https://github.com/sveltejs/kit/pull/4152))

## 1.0.0-next.287

### Patch Changes

- breaking: Rename `__fetch_polyfill` to `installFetch`, remove fetch exports ([#4111](https://github.com/sveltejs/kit/pull/4111))

## 1.0.0-next.286

### Patch Changes

- Prevent double-fixing of error stack traces in dev mode ([#4041](https://github.com/sveltejs/kit/pull/4041))
- Expose Navigation type ([#4076](https://github.com/sveltejs/kit/pull/4076))
- add new `Page` type ([#4076](https://github.com/sveltejs/kit/pull/4076))
- breaking: separate public from private-but-documented types ([#4104](https://github.com/sveltejs/kit/pull/4104))

## 1.0.0-next.285

### Patch Changes

- breaking: referer header sent by fetch in load matches page's referer header, not the page itself ([#4070](https://github.com/sveltejs/kit/pull/4070))
- breaking: remove sveltekit:navigation-{start,end} events ([#4070](https://github.com/sveltejs/kit/pull/4070))
- breaking: defer pushState until navigation occurs ([#4070](https://github.com/sveltejs/kit/pull/4070))

## 1.0.0-next.284

### Patch Changes

- Disable meta http-equiv tags for static amp configuration ([#4073](https://github.com/sveltejs/kit/pull/4073))
- Ignore click event if url does not have origin (e.g. `mailto:`, `tel:`) ([#4072](https://github.com/sveltejs/kit/pull/4072))

## 1.0.0-next.283

### Patch Changes

- create `__data.json` for pathnames with trailing slashes, including `/` ([#4066](https://github.com/sveltejs/kit/pull/4066))

## 1.0.0-next.282

### Patch Changes

- fix: remove private methods to make Safari 14.1 work ([#4054](https://github.com/sveltejs/kit/pull/4054))

## 1.0.0-next.281

### Patch Changes

- Allow the `transformPage` resolve option to return a promise ([#4036](https://github.com/sveltejs/kit/pull/4036))

## 1.0.0-next.280

### Patch Changes

- breaking: rename `app.render` to `server.respond` ([#4034](https://github.com/sveltejs/kit/pull/4034))
- breaking: allow providing `Params` type argument for `RequestHandler` ([#3989](https://github.com/sveltejs/kit/pull/3989))

## 1.0.0-next.279

### Patch Changes

- Fix escaped html attributes ([#4015](https://github.com/sveltejs/kit/pull/4015))

## 1.0.0-next.278

### Patch Changes

- breaking: Crawl rel="external" links when prerendering ([#3826](https://github.com/sveltejs/kit/pull/3826))

## 1.0.0-next.277

### Patch Changes

- Fall back to full page reload if link href does not match route manifest ([#3969](https://github.com/sveltejs/kit/pull/3969))
- Update page store without rerunning load when hash changes ([#3975](https://github.com/sveltejs/kit/pull/3975))

## 1.0.0-next.276

### Patch Changes

- Track scroll position without scroll listener, and recover on reload ([#3938](https://github.com/sveltejs/kit/pull/3938))

## 1.0.0-next.275

### Patch Changes

- Invalidate shadow endpoint data when URL changes ([#3925](https://github.com/sveltejs/kit/pull/3925))

## 1.0.0-next.274

### Patch Changes

- Set `$page.url` to current URL in browser ([#3942](https://github.com/sveltejs/kit/pull/3942))

## 1.0.0-next.273

### Patch Changes

- Correctly identify readable node streams ([#3941](https://github.com/sveltejs/kit/pull/3941))
- remove 'Shadow' from error message ([#3943](https://github.com/sveltejs/kit/pull/3943))

## 1.0.0-next.272

### Patch Changes

- Make shadow endpoint `event.url` consistent between server and client navigation ([#3780](https://github.com/sveltejs/kit/pull/3780))
- Prevent duplicated history when navigating via hash link ([#3931](https://github.com/sveltejs/kit/pull/3931))

## 1.0.0-next.271

### Patch Changes

- Add `transformPage` option to `resolve` ([#3914](https://github.com/sveltejs/kit/pull/3914))

## 1.0.0-next.270

### Patch Changes

- handle HEAD requests in endpoints ([#3903](https://github.com/sveltejs/kit/pull/3903))
- Use shadow endpoint without defining a `get` endpoint ([#3816](https://github.com/sveltejs/kit/pull/3816))

## 1.0.0-next.269

### Patch Changes

- Ensure handleError hook is called for shadow endpoint errors ([#3879](https://github.com/sveltejs/kit/pull/3879))

## 1.0.0-next.268

### Patch Changes

- refactor: use one escape function for json in html script body instead of two slightly different ([#3804](https://github.com/sveltejs/kit/pull/3804))

## 1.0.0-next.267

### Patch Changes

- Set cookies when redirecting from shadow endpoint ([#3874](https://github.com/sveltejs/kit/pull/3874))

## 1.0.0-next.266

### Patch Changes

- fix casing of `.DS_Store` in the default config for `serviceWorker` ([#3823](https://github.com/sveltejs/kit/pull/3823))
- fix: avoid mutating response `Headers` ([#3829](https://github.com/sveltejs/kit/pull/3829))

## 1.0.0-next.265

### Patch Changes

- breaking: remove `createIndexFiles` option, derive from `trailingSlash` instead ([#3801](https://github.com/sveltejs/kit/pull/3801))
- Pass trailingSlash config to adapters ([#3820](https://github.com/sveltejs/kit/pull/3820))

## 1.0.0-next.264

### Patch Changes

- fix links pointing to multi-page docs ([#3815](https://github.com/sveltejs/kit/pull/3815))
- upgrade to TypeScript 4.5 ([#3809](https://github.com/sveltejs/kit/pull/3809))

## 1.0.0-next.263

### Patch Changes

- Handle numeric headers ([#3716](https://github.com/sveltejs/kit/pull/3716))
- fix: replace broken escaping with a working version ([#3798](https://github.com/sveltejs/kit/pull/3798))

## 1.0.0-next.262

### Patch Changes

- update to Vite 2.8 and esbuild 0.14 ([#3791](https://github.com/sveltejs/kit/pull/3791))

## 1.0.0-next.261

### Patch Changes

- Prevent full reload when router navigates and only removes hash ([#3757](https://github.com/sveltejs/kit/pull/3757))
- fixes shadow hydration escaping ([#3793](https://github.com/sveltejs/kit/pull/3793))
- fixes an error with fetching shadow endpoints if they are ending with '/' ([#3740](https://github.com/sveltejs/kit/pull/3740))

## 1.0.0-next.260

### Patch Changes

- Allow Response object to be returned without properties showing up in object constructor ([#3697](https://github.com/sveltejs/kit/pull/3697))
- Implement shadow endpoints ([#3679](https://github.com/sveltejs/kit/pull/3679))

## 1.0.0-next.259

### Patch Changes

- Prevent `Host` header from being incorrectly inherited by requests made from `load`'s `fetch` during SSR ([#3690](https://github.com/sveltejs/kit/pull/3690))

## 1.0.0-next.258

### Patch Changes

- Update \$app/stores page.stuff to use App.Stuff ([#3686](https://github.com/sveltejs/kit/pull/3686))

## 1.0.0-next.257

### Patch Changes

- Rename JSONString type to JSONValue ([#3683](https://github.com/sveltejs/kit/pull/3683))
- Add App namespace for app-level types ([#3670](https://github.com/sveltejs/kit/pull/3670))
- breaking: remove target option ([#3674](https://github.com/sveltejs/kit/pull/3674))

## 1.0.0-next.256

### Patch Changes

- fix regression in parsing HTML when crawling for pre-rendering ([#3677](https://github.com/sveltejs/kit/pull/3677))

## 1.0.0-next.255

### Patch Changes

- fix parsing during pre-render crawl when there are HTML attributes without a value ([#3668](https://github.com/sveltejs/kit/pull/3668))
- Correctly populate asset manifest when generating service worker ([#3673](https://github.com/sveltejs/kit/pull/3673))

## 1.0.0-next.254

### Patch Changes

- Add version config and expose updated store ([#3412](https://github.com/sveltejs/kit/pull/3412))
- fix: update types to match changes to Vite config handling ([#3662](https://github.com/sveltejs/kit/pull/3662))

## 1.0.0-next.253

### Patch Changes

- Allow config.kit.vite to be an async function ([#3565](https://github.com/sveltejs/kit/pull/3565))
- Include page request headers in server-side fetches ([#3631](https://github.com/sveltejs/kit/pull/3631))

## 1.0.0-next.252

### Patch Changes

- remove nonexistent `url` store from `$app/stores` ambient types ([#3640](https://github.com/sveltejs/kit/pull/3640))

## 1.0.0-next.251

### Patch Changes

- Handle non-compliant ReadableStream implementations ([#3624](https://github.com/sveltejs/kit/pull/3624))

## 1.0.0-next.250

### Patch Changes

- breaking: move `config.kit.hydrate` and `config.kit.router` to `config.kit.browser` ([#3578](https://github.com/sveltejs/kit/pull/3578))
- add `prerender.createIndexFiles` option ([#2632](https://github.com/sveltejs/kit/pull/2632))

## 1.0.0-next.249

### Patch Changes

- Include service worker in manifest ([#3570](https://github.com/sveltejs/kit/pull/3570))
- Add kit.routes config to customise public/private modules ([#3576](https://github.com/sveltejs/kit/pull/3576))

## 1.0.0-next.248

### Patch Changes

- Decode fetched resources before checking against manifest when prerendering ([#3571](https://github.com/sveltejs/kit/pull/3571))
- breaking: remove -H and (conflicting) -h shortcuts from CLI ([#3573](https://github.com/sveltejs/kit/pull/3573))

## 1.0.0-next.247

### Patch Changes

- fix handling an incoming request from HTTP/2 ([#3572](https://github.com/sveltejs/kit/pull/3572))

## 1.0.0-next.246

### Patch Changes

- `svelte-kit package` gives clearer error message when svelte2tsx and typescript are not installed ([#3562](https://github.com/sveltejs/kit/pull/3562))
- `svelte-kit package` errors when lib directory does not exist ([#3562](https://github.com/sveltejs/kit/pull/3562))
- chore: refactor AMP validation ([#3554](https://github.com/sveltejs/kit/pull/3554))

## 1.0.0-next.245

### Patch Changes

- Allow adapters to pass in `platform` object ([#3429](https://github.com/sveltejs/kit/pull/3429))
- favicon.ico is now requestable ([#3559](https://github.com/sveltejs/kit/pull/3559))

## 1.0.0-next.244

### Patch Changes

- fix: reading from same response body twice during prerender (#3473) ([#3521](https://github.com/sveltejs/kit/pull/3521))
- Add CSP support ([#3499](https://github.com/sveltejs/kit/pull/3499))
- chore: remove InternalHandle ([#3541](https://github.com/sveltejs/kit/pull/3541))
- Force Vite to use HTTP/1 in dev mode, so `dev --https` works again ([#3553](https://github.com/sveltejs/kit/pull/3553))

## 1.0.0-next.243

### Patch Changes

- fix: hydrate real HTTP requests ([#3547](https://github.com/sveltejs/kit/pull/3547))

## 1.0.0-next.242

### Patch Changes

- reinstate `EndpointOutput` generic ([#3537](https://github.com/sveltejs/kit/pull/3537))

## 1.0.0-next.241

### Patch Changes

- `svelte-kit package` only encodes text files ([#3522](https://github.com/sveltejs/kit/pull/3522))

## 1.0.0-next.240

### Patch Changes

- Error if handle hook returns something other than a Response ([#3496](https://github.com/sveltejs/kit/pull/3496))
- allow setting multiple set-cookie headers ([#3502](https://github.com/sveltejs/kit/pull/3502))
- fixed prerendering with base path configured ([#3500](https://github.com/sveltejs/kit/pull/3500))

## 1.0.0-next.239

### Patch Changes

- Insert <meta http-equiv> cache-control header when prerendering ([#3493](https://github.com/sveltejs/kit/pull/3493))

## 1.0.0-next.238

### Patch Changes

- Escape prerendered redirect locations, instead of encoding them ([#3456](https://github.com/sveltejs/kit/pull/3456))

## 1.0.0-next.237

### Patch Changes

- Type compilerOptions as CompileOptions instead of any ([#3486](https://github.com/sveltejs/kit/pull/3486))

## 1.0.0-next.236

### Patch Changes

- The redirect property returned from a module's load function must now be a properly encoded URI string value. ([#3404](https://github.com/sveltejs/kit/pull/3404))

## 1.0.0-next.235

### Patch Changes

- register service worker regardless of hydrate/router option ([#3435](https://github.com/sveltejs/kit/pull/3435))

## 1.0.0-next.234

### Patch Changes

- Allow endpoints to return a [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response), or an object with [Headers](https://developer.mozilla.org/en-US/docs/Web/API/Headers) ([docs](https://kit.svelte.dev/docs/routing#endpoints), [#3384](https://github.com/sveltejs/kit/pull/3384))
- breaking: Expose standard [Request](https://developer.mozilla.org/en-US/docs/Web/API/Request) object to endpoints and hooks. `method`, `headers`, and `body` now accessed through `request` field ([docs](https://kit.svelte.dev/docs/routing#endpoints), [#3384](https://github.com/sveltejs/kit/pull/3384))
- breaking: change `app.render` signature to (request: Request) => Promise<Response> ([#3384](https://github.com/sveltejs/kit/pull/3384))
- breaking: move protocol/host configuration options from Kit to adapter-node ([#3384](https://github.com/sveltejs/kit/pull/3384))

## 1.0.0-next.233

### Patch Changes

- fix: refactor navigation singletons to avoid storing undefined reference ([#3374](https://github.com/sveltejs/kit/pull/3374))
- fix: add media="(max-width: 0)" to prevent stylesheets from downloading ([#3396](https://github.com/sveltejs/kit/pull/3396))

## 1.0.0-next.232

### Patch Changes

- Preserve explicit ETag header ([#3348](https://github.com/sveltejs/kit/pull/3348))
- fix: ignore hash links during prerendering (again) ([#3367](https://github.com/sveltejs/kit/pull/3367))

## 1.0.0-next.231

### Patch Changes

- Handle requests for /basepath ([#3345](https://github.com/sveltejs/kit/pull/3345))
- Allow \_\_fetch_polyfill() to run several times ([#3357](https://github.com/sveltejs/kit/pull/3357))
- Handle static assets with /basepath in svelte-kit dev ([#3346](https://github.com/sveltejs/kit/pull/3346))

## 1.0.0-next.230

### Patch Changes

- Log errors to stderr rather than stdout ([#3328](https://github.com/sveltejs/kit/pull/3328))

## 1.0.0-next.229

### Patch Changes

- The path to a service worker is now rebased to the app's base path ([#3319](https://github.com/sveltejs/kit/pull/3319))

## 1.0.0-next.228

### Patch Changes

- Throw on accessing url.search/searchParams from page store during prerendering ([#3314](https://github.com/sveltejs/kit/pull/3314))
- Preserve relevant headers when serving 304s ([#3313](https://github.com/sveltejs/kit/pull/3313))

## 1.0.0-next.227

### Patch Changes

- Adds beforeNavigate/afterNavigate lifecycle functions ([#3293](https://github.com/sveltejs/kit/pull/3293))

## 1.0.0-next.226

### Patch Changes

- Fix srcset parsing ([#3301](https://github.com/sveltejs/kit/pull/3301))
- Change ReadOnlyFormData behavior to mimic the spec's FormData interface ([#3302](https://github.com/sveltejs/kit/pull/3302))

## 1.0.0-next.225

### Patch Changes

- add inlineStyleThreshold option, below which stylesheets are inlined into the page ([#2620](https://github.com/sveltejs/kit/pull/2620))

## 1.0.0-next.224

### Patch Changes

- More robust crawling of prerendered pages ([#3288](https://github.com/sveltejs/kit/pull/3288))

## 1.0.0-next.223

### Patch Changes

- Add methodOverride option for submitting PUT/PATCH/DELETE/etc with <form> elements ([#2989](https://github.com/sveltejs/kit/pull/2989))

## 1.0.0-next.222

### Patch Changes

- Remove `config.kit.ssr` and `export const ssr` in favour of `ssr` parameter for `resolve` function in `handle` ([#2804](https://github.com/sveltejs/kit/pull/2804))

## 1.0.0-next.221

### Patch Changes

- Add returned stuff from pages into \$page store ([#3252](https://github.com/sveltejs/kit/pull/3252))
- Fallthrough is now explicit and layout components now also support fallthrough ([#3217](https://github.com/sveltejs/kit/pull/3217))

## 1.0.0-next.220

### Patch Changes

- url hash is now properly reflected in page store ([#3273](https://github.com/sveltejs/kit/pull/3273))
- Strip hash fragments from URLs during prerendering ([#3251](https://github.com/sveltejs/kit/pull/3251))
- Allow prefixes and suffixes around rest parameters ([#3240](https://github.com/sveltejs/kit/pull/3240))

## 1.0.0-next.219

### Patch Changes

- Render error page if error happens in handle hook ([#3239](https://github.com/sveltejs/kit/pull/3239))
- chore: update dependency sirv to v2 ([#3263](https://github.com/sveltejs/kit/pull/3263))

## 1.0.0-next.218

### Patch Changes

- Expose appDir to adapters ([#3222](https://github.com/sveltejs/kit/pull/3222))
- Replace %svelte.assets% with relative path ([#3234](https://github.com/sveltejs/kit/pull/3234))

## 1.0.0-next.217

### Patch Changes

- Improve error message when svelte.config.js is not found ([#3219](https://github.com/sveltejs/kit/pull/3219))
- Support more text content types ([#2781](https://github.com/sveltejs/kit/pull/2781))

## 1.0.0-next.216

### Patch Changes

- make html template optional for `svelte-kit package` ([#3161](https://github.com/sveltejs/kit/pull/3161))
- Allow multiple different headers returned from one endpoint ([#3201](https://github.com/sveltejs/kit/pull/3201))

## 1.0.0-next.215

### Patch Changes

- Fix hash change focus behaviour ([#3177](https://github.com/sveltejs/kit/pull/3177))

## 1.0.0-next.214

### Patch Changes

- breaking: Add `disableScrollHandling` function (see https://kit.svelte.dev/docs/modules#$app-navigation) ([#3182](https://github.com/sveltejs/kit/pull/3182))

## 1.0.0-next.213

### Patch Changes

- Don't register service worker if there is none ([#3170](https://github.com/sveltejs/kit/pull/3170))
- Fix url pathname for prerenders ([#3178](https://github.com/sveltejs/kit/pull/3178))

## 1.0.0-next.212

### Patch Changes

- Add status and error to page store ([#3096](https://github.com/sveltejs/kit/pull/3096))
- Fix dev prebundling scanner ([#3169](https://github.com/sveltejs/kit/pull/3169))
- Sort rest endpoints before pages ([#3168](https://github.com/sveltejs/kit/pull/3168))

## 1.0.0-next.211

### Patch Changes

- Use Vite's filewatcher in dev mode instead of creating a new one

## 1.0.0-next.210

### Patch Changes

- Add path/query error getters in prod mode ([#3151](https://github.com/sveltejs/kit/pull/3151))

## 1.0.0-next.209

### Patch Changes

- Bundle SSR renderer with app ([#3144](https://github.com/sveltejs/kit/pull/3144))

## 1.0.0-next.208

### Patch Changes

- Overhaul adapter API ([#2931](https://github.com/sveltejs/kit/pull/2931))
- Replace config.kit.hostHeader with config.kit.headers.host, add config.kit.headers.protocol ([#2931](https://github.com/sveltejs/kit/pull/2931))
- Replace page.host with page.origin ([#2931](https://github.com/sveltejs/kit/pull/2931))
- fix: load CSS before JS preloads
- Error if adapter provides wrong input to app.render ([#3133](https://github.com/sveltejs/kit/pull/3133))
- Replace [request|page].[origin|path|query] with url object ([#3133](https://github.com/sveltejs/kit/pull/3133))

## 1.0.0-next.207

### Patch Changes

- Add serviceWorker.register option ([#2988](https://github.com/sveltejs/kit/pull/2988))

## 1.0.0-next.206

### Patch Changes

- Handle `Headers` instance in server-side `fetch` ([#3034](https://github.com/sveltejs/kit/pull/3034))

## 1.0.0-next.205

### Patch Changes

- Add `config.kit.prerender.concurrency` setting ([#3120](https://github.com/sveltejs/kit/pull/3120))

## 1.0.0-next.204

### Patch Changes

- fix `<Route> received an unexpected slot "default"` warning ([#3115](https://github.com/sveltejs/kit/pull/3115))

## 1.0.0-next.203

### Patch Changes

- Update vite-plugin-svelte to 1.0.0-next.32 ([#3048](https://github.com/sveltejs/kit/pull/3048))
- fix `sveltekit:prefetch` mouse detection ([#2995](https://github.com/sveltejs/kit/pull/2995))
- Sort rest routes alphabetically ([#3093](https://github.com/sveltejs/kit/pull/3093))
- Fix invalid amp-install-serviceworker ([#3075](https://github.com/sveltejs/kit/pull/3075))

## 1.0.0-next.202

### Patch Changes

- fix: upgrade to Vite 2.7 ([#3018](https://github.com/sveltejs/kit/pull/3018))
- Allow absolute file paths given to package.dir ([#3012](https://github.com/sveltejs/kit/pull/3012))
- update to esbuild 0.13.15 and other dependency updates ([#2957](https://github.com/sveltejs/kit/pull/2957))

## 1.0.0-next.201

### Patch Changes

- Ignore mailto: and tel: links ([#2915](https://github.com/sveltejs/kit/pull/2915))

## 1.0.0-next.200

### Patch Changes

- Follow redirects when prerendering ([#2832](https://github.com/sveltejs/kit/pull/2832))
- Fix types reference in exports in package.json ([#2896](https://github.com/sveltejs/kit/pull/2896))

## 1.0.0-next.199

### Patch Changes

- fix: support etag W/ prefix ([#2709](https://github.com/sveltejs/kit/pull/2709))
- fix: revert #2819 and add code comment ([#2883](https://github.com/sveltejs/kit/pull/2883))
- Don't create empty dirs when packaging ([#2831](https://github.com/sveltejs/kit/pull/2831))
- feat: Use `event.composedPath` to find anchors for prefetching and routing ([#2769](https://github.com/sveltejs/kit/pull/2769))

## 1.0.0-next.198

### Patch Changes

- Register custom service worker for AMP ([#2265](https://github.com/sveltejs/kit/pull/2265))

## 1.0.0-next.197

### Patch Changes

- fix: prevent text unselection for keepfocus ([#2857](https://github.com/sveltejs/kit/pull/2857))
- fix: use defaults when no opts passed to router ([#2819](https://github.com/sveltejs/kit/pull/2819))

## 1.0.0-next.196

### Patch Changes

- remove all selection before navigating to the next page ([#2755](https://github.com/sveltejs/kit/pull/2755))
- fix: properly scroll if body has margin ([#2761](https://github.com/sveltejs/kit/pull/2761))

## 1.0.0-next.195

### Patch Changes

- fix: increase scroll debounce timeout ([#2749](https://github.com/sveltejs/kit/pull/2749))
- fix: do not set inlineDynamicImports ([#2753](https://github.com/sveltejs/kit/pull/2753))

## 1.0.0-next.194

### Patch Changes

- fix: correct message when serving with strict:false ([#2726](https://github.com/sveltejs/kit/pull/2726))
- fix: reset scroll when navigated from scrolled page ([#2735](https://github.com/sveltejs/kit/pull/2735))

## 1.0.0-next.193

### Patch Changes

- fix: upgrade minor deps. fetch-blob 3.1.3 needed for Netlify deploys ([#2714](https://github.com/sveltejs/kit/pull/2714))
- fix: scroll to elements provided via URL hash ([#2668](https://github.com/sveltejs/kit/pull/2668))

## 1.0.0-next.192

### Patch Changes

- fix: allow overriding inlineDynamicImports ([#2702](https://github.com/sveltejs/kit/pull/2702))

## 1.0.0-next.191

### Patch Changes

- Return the copied files from the adapter's copy\_ utils. ([#2674](https://github.com/sveltejs/kit/pull/2674))
- fix: avoid infinite loop if no routes found ([#2614](https://github.com/sveltejs/kit/pull/2614))
- security: upgrade to Vite 2.6.12, specify allow list, and print warning ([#2691](https://github.com/sveltejs/kit/pull/2691))

## 1.0.0-next.190

### Patch Changes

- fix: upgrade to Vite 2.6.11 ([#2683](https://github.com/sveltejs/kit/pull/2683))
- Return an array of written files when prerendering. ([#2675](https://github.com/sveltejs/kit/pull/2675))

## 1.0.0-next.189

### Patch Changes

- breaking: only route pages on the client-side ([#2656](https://github.com/sveltejs/kit/pull/2656))

## 1.0.0-next.188

### Patch Changes

- fix: fire navigation-end event only at end of navigation ([#2649](https://github.com/sveltejs/kit/pull/2649))
- fix: allow passing certificates via config ([#2622](https://github.com/sveltejs/kit/pull/2622))

## 1.0.0-next.187

### Patch Changes

- Fix prerendering when paths.base but not paths.assets is specified ([#2643](https://github.com/sveltejs/kit/pull/2643))

## 1.0.0-next.186

### Patch Changes

- chore: upgrade to Vite 2.6.10 ([#2634](https://github.com/sveltejs/kit/pull/2634))

## 1.0.0-next.185

### Patch Changes

- Update vite-plugin-svelte to 1.0.0-next.30 ([#2626](https://github.com/sveltejs/kit/pull/2626))
- fix: allow users to override build target ([#2618](https://github.com/sveltejs/kit/pull/2618))

## 1.0.0-next.184

### Patch Changes

- breaking: drop Node 12 support ([#2604](https://github.com/sveltejs/kit/pull/2604))

## 1.0.0-next.183

### Patch Changes

- fix XSS vulnerability in `page.path` and `page.params` during SSR ([#2597](https://github.com/sveltejs/kit/pull/2597))

## 1.0.0-next.182

### Patch Changes

- fix: fixes for firing of hashchange event ([#2591](https://github.com/sveltejs/kit/pull/2591))

## 1.0.0-next.181

### Patch Changes

- fix: improve type of `init` ([#2544](https://github.com/sveltejs/kit/pull/2544))
- update dependencies ([#2574](https://github.com/sveltejs/kit/pull/2574))
- fix: implement support for hashchange event ([#2590](https://github.com/sveltejs/kit/pull/2590))
- chore: upgrade to Vite 2.6.7 ([#2586](https://github.com/sveltejs/kit/pull/2586))

## 1.0.0-next.180

### Patch Changes

- fix: don't expose prerender options ([#2543](https://github.com/sveltejs/kit/pull/2543))
- chore: upgrade to Vite 2.6.3" ([#2557](https://github.com/sveltejs/kit/pull/2557))
- upgrade commonjs plugin for better ignoreTryCatch default ([#2539](https://github.com/sveltejs/kit/pull/2539))

## 1.0.0-next.179

### Patch Changes

- Fix escaping of URLs of endpoint responses serialized into SSR response ([#2534](https://github.com/sveltejs/kit/pull/2534))

## 1.0.0-next.178

### Patch Changes

- fix: restore functioning of --host CLI flag with no arg ([#2525](https://github.com/sveltejs/kit/pull/2525))

## 1.0.0-next.177

### Patch Changes

- update to vite 2.6.0 and esbuild 0.13 ([#2522](https://github.com/sveltejs/kit/pull/2522))
- fix browser-only redirect during load. ([#2462](https://github.com/sveltejs/kit/pull/2462))

## 1.0.0-next.176

### Patch Changes

- feat: allow using Vite's `strict.port: false` option ([#2507](https://github.com/sveltejs/kit/pull/2507))
- fix: allow passing in https certs again' ([#2512](https://github.com/sveltejs/kit/pull/2512))

## 1.0.0-next.175

### Patch Changes

- chore: upgrade node-fetch to 3.0.0 final ([#2422](https://github.com/sveltejs/kit/pull/2422))
- fix: don't override application focus and scroll ([#2489](https://github.com/sveltejs/kit/pull/2489))

## 1.0.0-next.174

### Patch Changes

- Fix script and style tags without attributes crashing svelte-kit package ([#2492](https://github.com/sveltejs/kit/pull/2492))

## 1.0.0-next.173

### Patch Changes

- Exports and files property in config.kit.package now accepts a function rather than an object ([#2430](https://github.com/sveltejs/kit/pull/2430))
- Renamed property exclude to files in config.kit.serviceWorker and now accepts a function instead ([#2430](https://github.com/sveltejs/kit/pull/2430))
- Remove lang tag when packaging ([#2486](https://github.com/sveltejs/kit/pull/2486))

## 1.0.0-next.172

### Patch Changes

- chore: upgrade to Svelte 3.43.0" ([#2474](https://github.com/sveltejs/kit/pull/2474))
- breaking: rename the `context` parameter of the load function to `stuff` ([#2439](https://github.com/sveltejs/kit/pull/2439))

## 1.0.0-next.171

### Patch Changes

- Fix preview when `kit.paths.base` is set. ([#2409](https://github.com/sveltejs/kit/pull/2409))
- Resolve \$lib alias when packaging ([#2453](https://github.com/sveltejs/kit/pull/2453))

## 1.0.0-next.170

### Patch Changes

- Fix prerendering/adapter-static failing when `kit.paths.base` was set. ([#2407](https://github.com/sveltejs/kit/pull/2407))

## 1.0.0-next.169

### Patch Changes

- Add "svelte" field to package.json when running package command ([#2431](https://github.com/sveltejs/kit/pull/2431))
- fix: revert #2354 and fix double character decoding a different way ([#2435](https://github.com/sveltejs/kit/pull/2435))
- feat: use the Vite server options in dev mode ([#2232](https://github.com/sveltejs/kit/pull/2232))
- update dependencies ([#2447](https://github.com/sveltejs/kit/pull/2447))

## 1.0.0-next.168

### Patch Changes

- fix: encodeURI during prerender ([#2427](https://github.com/sveltejs/kit/pull/2427))
- chore: add links to repository and homepage to package.json ([#2425](https://github.com/sveltejs/kit/pull/2425))

## 1.0.0-next.167

### Patch Changes

- Update vite-plugin-svelte to 1.0.0-next.24 ([#2423](https://github.com/sveltejs/kit/pull/2423))
- Add a generic argument to allow typing Body from hooks ([#2413](https://github.com/sveltejs/kit/pull/2413))

## 1.0.0-next.166

### Patch Changes

- chore: upgrade Vite to 2.5.7
- fix: deeply-nested error components render with correct layout ([#2389](https://github.com/sveltejs/kit/pull/2389))
- Update vite-plugin-svelte to 1.0.0-next.23 ([#2402](https://github.com/sveltejs/kit/pull/2402))
- fix: pass along set-cookie headers during SSR ([#2362](https://github.com/sveltejs/kit/pull/2362))

## 1.0.0-next.165

### Patch Changes

- chore: upgrade Vite
- breaking: rename prerender.pages config option to prerender.entries ([#2380](https://github.com/sveltejs/kit/pull/2380))
- fix: anchor tag inside svg ([#2286](https://github.com/sveltejs/kit/pull/2286))

## 1.0.0-next.164

### Patch Changes

- fix: error components render with correct layout client-side as well as server-side ([#2378](https://github.com/sveltejs/kit/pull/2378))
- refactor `import.meta.env` usage in `$app/stores.js` to use `$app/env.js` to DRY code and make mocking easier ([#2353](https://github.com/sveltejs/kit/pull/2353))
- Trim `.js` extensions in package exports field ([#2345](https://github.com/sveltejs/kit/pull/2345))

## 1.0.0-next.163

### Patch Changes

- Update vite-plugin-svelte to 1.0.0-next.22 ([#2370](https://github.com/sveltejs/kit/pull/2370))
- fix: load function should not leak props to other components ([#2356](https://github.com/sveltejs/kit/pull/2356))
- packaging merge exports field by default ([#2327](https://github.com/sveltejs/kit/pull/2327))
- fix: don't decode URL when finding matching route ([#2354](https://github.com/sveltejs/kit/pull/2354))

## 1.0.0-next.162

### Patch Changes

- Enable nested dependency optimization by updating to @sveltejs/vite-plugin-svelte@1.0.0-next.21 ([#2343](https://github.com/sveltejs/kit/pull/2343))

## 1.0.0-next.161

### Patch Changes

- Allow service workers to access files using the \$lib alias ([#2326](https://github.com/sveltejs/kit/pull/2326))
- fix: remove Vite workaround now that dev deps can be bundled ([#2340](https://github.com/sveltejs/kit/pull/2340))
- support using arrays for kit.vite.resolve.alias ([#2328](https://github.com/sveltejs/kit/pull/2328))

## 1.0.0-next.160

### Patch Changes

- fix: upgrade to Vite 2.5.2 to fix URL decoding ([#2323](https://github.com/sveltejs/kit/pull/2323))
- Add `@sveltejs/kit` to `noExternal` in dev server as well ([#2332](https://github.com/sveltejs/kit/pull/2332))

## 1.0.0-next.159

### Patch Changes

- Add `@sveltejs/kit` to noExternal to resolve hooks module in dev server ([#2306](https://github.com/sveltejs/kit/pull/2306))
- fix: HMR on Windows ([#2315](https://github.com/sveltejs/kit/pull/2315))

## 1.0.0-next.158

### Patch Changes

- avoid setting rawBody/body to an empty Uint8Array when a load's fetch function is called with no body during SSR ([#2295](https://github.com/sveltejs/kit/pull/2295))

## 1.0.0-next.157

### Patch Changes

- chore: separate RequestHeaders and ResponseHeaders types ([#2248](https://github.com/sveltejs/kit/pull/2248))
- fix: don't de-indent user-rendered HTML ([#2292](https://github.com/sveltejs/kit/pull/2292))

## 1.0.0-next.156

### Patch Changes

- allow any top-level keys in svelte config ([#2267](https://github.com/sveltejs/kit/pull/2267))
- Exclude emitted declarations on packaging ([#2247](https://github.com/sveltejs/kit/pull/2247))

## 1.0.0-next.155

### Patch Changes

- chore: export App types ([#2259](https://github.com/sveltejs/kit/pull/2259))

## 1.0.0-next.154

### Patch Changes

- Upgrade to Vite 2.5.0 ([#2231](https://github.com/sveltejs/kit/pull/2231))

## 1.0.0-next.153

### Patch Changes

- rename serverFetch to externalFetch ([#2110](https://github.com/sveltejs/kit/pull/2110))

## 1.0.0-next.152

### Patch Changes

- Check ports usage in a more cross-platform way in dev server error logging ([#2209](https://github.com/sveltejs/kit/pull/2209))
- Ensure the raw body is an Uint8Array before passing it to request handlers ([#2215](https://github.com/sveltejs/kit/pull/2215))

## 1.0.0-next.151

### Patch Changes

- fix new route discovery in dev server ([#2198](https://github.com/sveltejs/kit/pull/2198))

## 1.0.0-next.150

### Patch Changes

- fix: match route against decoded path on client ([#2206](https://github.com/sveltejs/kit/pull/2206))

## 1.0.0-next.149

### Patch Changes

- export `HandleError` type ([#2200](https://github.com/sveltejs/kit/pull/2200))
- fix: match regex against route only once ([#2203](https://github.com/sveltejs/kit/pull/2203))

## 1.0.0-next.148

### Patch Changes

- update svelte peerDependency to 3.39.0 ([#2182](https://github.com/sveltejs/kit/pull/2182))
- Add hook to handle errors ([#2193](https://github.com/sveltejs/kit/pull/2193))
- Use /\_svelte_kit_assets when serving apps with specified paths.assets locally ([#2189](https://github.com/sveltejs/kit/pull/2189))
- Serve from basepath in svelte-kit dev/preview ([#2189](https://github.com/sveltejs/kit/pull/2189))
- Disallow non-absolute paths.assets option ([#2189](https://github.com/sveltejs/kit/pull/2189))
- Allow `EndpointOutput` response body objects to have a `toJSON` property ([#2170](https://github.com/sveltejs/kit/pull/2170))

## 1.0.0-next.147

### Patch Changes

- fix: handle paths consistently between dev and various production adapters ([#2171](https://github.com/sveltejs/kit/pull/2171))
- Replace function properties by methods on type declarations ([#2158](https://github.com/sveltejs/kit/pull/2158))
- fix: fallback should still be generated when prerender is disabled ([#2128](https://github.com/sveltejs/kit/pull/2128))
- update vite-plugin-svelte to 1.0.0-next.16 ([#2179](https://github.com/sveltejs/kit/pull/2179))
- Set optimizeDeps.entries to [] when building service worker ([#2180](https://github.com/sveltejs/kit/pull/2180))

## 1.0.0-next.146

### Patch Changes

- fix: enable Vite pre-bundling except for Svelte packages ([#2137](https://github.com/sveltejs/kit/pull/2137))

## 1.0.0-next.145

### Patch Changes

- feat: detect if app tries to access query with prerender enabled ([#2104](https://github.com/sveltejs/kit/pull/2104))

## 1.0.0-next.144

### Patch Changes

- 241dd623: fix: point at true dev entry point

## 1.0.0-next.143

### Patch Changes

- 8c0ffb8f: fix: provide explicit JS entry point for Vite dev mode ([#2134](https://github.com/sveltejs/kit/pull/2134))
- c3c25ee0: fix: take into account page-level options on error pages ([#2117](https://github.com/sveltejs/kit/pull/2117))

## 1.0.0-next.142

### Patch Changes

- aed1bd07: fix: fully initialize router before rendering ([#2089](https://github.com/sveltejs/kit/pull/2089))
- 970bb04c: restore reverted config changes ([#2093](https://github.com/sveltejs/kit/pull/2093))

## 1.0.0-next.141

### Patch Changes

- d109a394: fix: successfully load nested error pages ([#2076](https://github.com/sveltejs/kit/pull/2076))
- fab67c94: fix: successfully handle client errors ([#2077](https://github.com/sveltejs/kit/pull/2077))
- 943f5288: fix: solve regression parsing unicode URLs ([#2078](https://github.com/sveltejs/kit/pull/2078))
- 4435a659: fix: allow endpoint shadowing to work ([#2074](https://github.com/sveltejs/kit/pull/2074))
- ee73a265: fix: correctly do fallthrough in simple case ([#2072](https://github.com/sveltejs/kit/pull/2072))

## 1.0.0-next.140

### Patch Changes

- e55bc44a: fix: revert change to rendering options ([#2008](https://github.com/sveltejs/kit/pull/2008))
- d81de603: revert adapters automatically updating .gitignore ([#1924](https://github.com/sveltejs/kit/pull/1924))
- 5911b1c7: fix: consider protocol-relative URLs as external ([#2062](https://github.com/sveltejs/kit/pull/2062))

## 1.0.0-next.139

### Patch Changes

- 883d4b85: Add public API to let adapters update .gitignore ([#1924](https://github.com/sveltejs/kit/pull/1924))
- 8cbe3b05: Change `force` to `onError` in prerender config options ([#2030](https://github.com/sveltejs/kit/pull/2030))
- 1b18a844: Don't check external links on prerender ([#1679](https://github.com/sveltejs/kit/pull/1679))
- 7645399a: fix: correctly pass Vite options in preview mode ([#2036](https://github.com/sveltejs/kit/pull/2036))

## 1.0.0-next.138

### Patch Changes

- d6563169: chore: prefer interfaces to types ([#2010](https://github.com/sveltejs/kit/pull/2010))
- b18a45c1: explicitly set compilerOptions.hydratable to config.kit.hydrate ([#2024](https://github.com/sveltejs/kit/pull/2024))
- 538de3eb- feat: More powerful and configurable rendering options ([#2008](https://github.com/sveltejs/kit/pull/2008))
- 20dad18a: Remove the `prerender.force` option in favor of `prerender.onError` ([#2007](https://github.com/sveltejs/kit/pull/2007))

## 1.0.0-next.137

### Patch Changes

- bce1d76a: chore: improved typing for runtime and tests ([#1995](https://github.com/sveltejs/kit/pull/1995))
- 2a1e9795: chore: enable TypeScript strict mode ([#1998](https://github.com/sveltejs/kit/pull/1998))

## 1.0.0-next.136

### Patch Changes

- 69b92ec1: chore: improved typing on core library ([#1993](https://github.com/sveltejs/kit/pull/1993))

## 1.0.0-next.135

### Patch Changes

- 3b293f2a: update svelte to 3.40 and vite-plugin-svelte to 1.0.0-next.14 ([#1992](https://github.com/sveltejs/kit/pull/1992))
- 34b923d1: chore: stricter TypeScript checking ([#1989](https://github.com/sveltejs/kit/pull/1989))

## 1.0.0-next.134

### Patch Changes

- e1e5920a: fix: correctly find links during prerendering ([#1984](https://github.com/sveltejs/kit/pull/1984))
- c7db715e: Handle errors with incorrect type ([#1983](https://github.com/sveltejs/kit/pull/1983))

## 1.0.0-next.133

### Patch Changes

- 68190496: chore: Vite to ^2.4.3, vite-plugin-svelte to ^1.0.0-next.13 ([#1969](https://github.com/sveltejs/kit/pull/1969))
- 0cbcd7c3: fix: correctly detect external fetches ([#1980](https://github.com/sveltejs/kit/pull/1980))
- 51ec789f: Scrolling to an anchor via a hash now supports `scroll-*` CSS properties ([#1972](https://github.com/sveltejs/kit/pull/1972))

## 1.0.0-next.132

### Patch Changes

- 7b440b2b: Fix URL resolution for server-side fetch ([#1953](https://github.com/sveltejs/kit/pull/1953))

## 1.0.0-next.131

### Patch Changes

- 0bc1b309: Minor optimization in parse_body ([#1916](https://github.com/sveltejs/kit/pull/1916))

## 1.0.0-next.130

### Patch Changes

- 53e9285d: feat(config): Friendlier error messages for common errors ([#1910](https://github.com/sveltejs/kit/pull/1910))
- 41da1ebe: Handle 4xx and 5xx statuses without requiring `Error` instance ([#1811](https://github.com/sveltejs/kit/pull/1811))
- 073fc3b5: feat(cli): respect NODE_ENV when set by user ([#1915](https://github.com/sveltejs/kit/pull/1915))

## 1.0.0-next.129

### Patch Changes

- e246455: Passthrough server-side fetch cookies for most same-origin scenarios ([#1847](https://github.com/sveltejs/kit/pull/1847))

## 1.0.0-next.128

### Patch Changes

- 27e9067: Better error messages when something goes wrong while emitting types ([#1903](https://github.com/sveltejs/kit/pull/1903))
- 277029d: Change index.js exports to directory exports when packaging ([#1905](https://github.com/sveltejs/kit/pull/1905))

## 1.0.0-next.127

### Patch Changes

- bb3ae21: Fix endpoint validation to allow returning string for all content types ([#1900](https://github.com/sveltejs/kit/pull/1900))

## 1.0.0-next.126

### Patch Changes

- 4720b67: Default body parsing to binary ([#1890](https://github.com/sveltejs/kit/pull/1890))
- 6da07b8: fix returning null from endpoints ([#1886](https://github.com/sveltejs/kit/pull/1886))

## 1.0.0-next.125

### Patch Changes

- 7faf52f: Update and consolidate checks for binary body types ([#1687](https://github.com/sveltejs/kit/pull/1687))
- f854b89: Replace return type of Buffer with Uint8Array ([#1876](https://github.com/sveltejs/kit/pull/1876))
- f854b89: Remove Incoming from public types ([#1876](https://github.com/sveltejs/kit/pull/1876))

## 1.0.0-next.124

### Patch Changes

- 34d2049: handle undefined body on endpoint output ([#1808](https://github.com/sveltejs/kit/pull/1808))
- c826016: add config.kit.package.emitTypes ([#1852](https://github.com/sveltejs/kit/pull/1852))
- 8854e2f: Bump vite-plugin-svelte to 1.0.0-next.12 ([#1869](https://github.com/sveltejs/kit/pull/1869))
- af1aa54: copy essential root files on `svelte-kit package` ([#1747](https://github.com/sveltejs/kit/pull/1747))
- 872840a: Pass along custom properties added to Error ([#1821](https://github.com/sveltejs/kit/pull/1821))
- 868f97a: Preserve README casing and package.json contents on svelte-kit package ([#1735](https://github.com/sveltejs/kit/pull/1735))

## 1.0.0-next.123

### Patch Changes

- 4b25615: Fix ReadOnlyFormData keys and values method implementation ([#1837](https://github.com/sveltejs/kit/pull/1837))
- 64f749d: ServiceWorker files exclusion support available through svelte.config.js ([#1645](https://github.com/sveltejs/kit/pull/1645))
- 4d2fec5: Enable Vite's server.fs.strict by default ([#1842](https://github.com/sveltejs/kit/pull/1842))
- 1ec368a: Expose Vite.js mode from \$app/env ([#1789](https://github.com/sveltejs/kit/pull/1789))

## 1.0.0-next.122

### Patch Changes

- d09a4e1: Surface Svelte compiler errors ([#1827](https://github.com/sveltejs/kit/pull/1827))
- 79b4fe2: Update Vite to ^2.4.1 ([#1834](https://github.com/sveltejs/kit/pull/1834))
- 2ac5781: Use esbuild inject API to insert shims ([#1822](https://github.com/sveltejs/kit/pull/1822))

## 1.0.0-next.121

### Patch Changes

- 939188e: Use UTF-8 encoding for JSON endpoint responses by default ([#1669](https://github.com/sveltejs/kit/pull/1669))
- 5b3e1e6: Add types generation to svelte-kit package command ([#1646](https://github.com/sveltejs/kit/pull/1646))
- 8affef2: Fix type errors inside ReadOnlyFormData that didn't allow it to be used inside for..of loops ([#1830](https://github.com/sveltejs/kit/pull/1830))

## 1.0.0-next.120

### Patch Changes

- 9fbaeda: fix attribute validation in generated script tag ([#1768](https://github.com/sveltejs/kit/pull/1768))
- 9f0c54a: Externalize app initialization to adapters ([#1804](https://github.com/sveltejs/kit/pull/1804))
- 0d69e55: Add generic type for session ([#1791](https://github.com/sveltejs/kit/pull/1791))
- 325c223: Improve RequestHandler and EndpointOutput type declarations. ([#1778](https://github.com/sveltejs/kit/pull/1778))
- 6ef148d: Generate service worker registration code even with `router` and `hydration` disabled ([#1724](https://github.com/sveltejs/kit/pull/1724))
- ae3ef19: Fail if config.kit.appDir starts or ends with a slash ([#1695](https://github.com/sveltejs/kit/pull/1695))

## 1.0.0-next.119

### Patch Changes

- 064f848: Implement serverFetch hook
- 882fb12: Add keepfocus option to goto

## 1.0.0-next.118

### Patch Changes

- 5418254: Fix regex for getting links to crawl during prerendering ([#1743](https://github.com/sveltejs/kit/pull/1743))

## 1.0.0-next.117

### Patch Changes

- 828732c: Specify actual Svelte version requirement ([#1751](https://github.com/sveltejs/kit/pull/1751))

## 1.0.0-next.116

### Patch Changes

- ea8cd54: chore(kit): correct `engines` constraint ([#1696](https://github.com/sveltejs/kit/pull/1696))
- aedec24: Ensure router is initialized before parsing location ([#1691](https://github.com/sveltejs/kit/pull/1691))
- c7d5ce4: update vite to 2.3.8 and unpin ([#1715](https://github.com/sveltejs/kit/pull/1715))
- d259bca: Stricter regex for getting element attributes during prerendering ([#1700](https://github.com/sveltejs/kit/pull/1700))

## 1.0.0-next.115

### Patch Changes

- 523c3e2: Allow vite.alias to be an array ([#1640](https://github.com/sveltejs/kit/pull/1640))
- 6fd46d1: \* update vite-plugin-svelte to 1.0.0-next.11 and use its named export ([#1673](https://github.com/sveltejs/kit/pull/1673))
  - update vite to 2.3.7
- dc56d3c: Fix navigation when `base` path is set and validate that option's value ([#1666](https://github.com/sveltejs/kit/pull/1666))

## 1.0.0-next.114

### Patch Changes

- 5aa64ab: fix: SSL for HMR websockets #844 ([#1517](https://github.com/sveltejs/kit/pull/1517))
- fae75f1: add optional state parameter for goto function ([#1643](https://github.com/sveltejs/kit/pull/1643))
- fbd5f8a: package command can now transpile TypeScript files ([#1633](https://github.com/sveltejs/kit/pull/1633))

## 1.0.0-next.113

### Patch Changes

- 045c45c: update vite to 2.3.6 ([#1625](https://github.com/sveltejs/kit/pull/1625))

## 1.0.0-next.112

### Patch Changes

- cbe029e: Allow non-lowercase 'content-type' header in ssr fetch requests ([#1463](https://github.com/sveltejs/kit/pull/1463))
- 1bf1a02: Make it possible to type context, page params and props for LoadInput and LoadOutput ([#1447](https://github.com/sveltejs/kit/pull/1447))

## 1.0.0-next.111

### Patch Changes

- eae1b1d: Rename handle's render parameter to resolve ([#1566](https://github.com/sveltejs/kit/pull/1566))

## 1.0.0-next.110

### Patch Changes

- 6372690: Add svelte-kit package command ([#1499](https://github.com/sveltejs/kit/pull/1499))
- c3d36a3: ensure `content-length` limit respected; handle `getRawBody` error(s) ([#1528](https://github.com/sveltejs/kit/pull/1528))
- bf77940: bump `polka` and `sirv` dependency versions ([#1548](https://github.com/sveltejs/kit/pull/1548))
- 2172469: Upgrade to Vite 2.3.4 ([#1580](https://github.com/sveltejs/kit/pull/1580))
- 028abd9: Pass validated svelte config to adapter adapt function ([#1559](https://github.com/sveltejs/kit/pull/1559))

## 1.0.0-next.109

### Patch Changes

- 261ee1c: Update compatible Node versions ([#1470](https://github.com/sveltejs/kit/pull/1470))
- ec156c6: let hash only changes be handled by router ([#830](https://github.com/sveltejs/kit/pull/830))
- 586785d: Allow passing HTTPS key pair in Vite section of config ([#1456](https://github.com/sveltejs/kit/pull/1456))

## 1.0.0-next.108

### Patch Changes

- dad93fc: Fix workspace dependencies ([#1434](https://github.com/sveltejs/kit/pull/1434))
- 37fc04f: Ignore URLs that the app does not own ([#1487](https://github.com/sveltejs/kit/pull/1487))

## 1.0.0-next.107

### Patch Changes

- ad83d40: update vite to ^2.3.1 ([#1429](https://github.com/sveltejs/kit/pull/1429))

## 1.0.0-next.106

### Patch Changes

- fe0531d: temporarily pin vite to version 2.2.4 until issues with 2.3.0 are resolved ([#1423](https://github.com/sveltejs/kit/pull/1423))

## 1.0.0-next.105

### Patch Changes

- f3c50a0: Bump Vite to 2.3.0 ([#1413](https://github.com/sveltejs/kit/pull/1413))
- cfd6c3c: Use rendered CSS for AMP pages ([#1408](https://github.com/sveltejs/kit/pull/1408))
- 9a2cc0a: Add trailingSlash: 'never' | 'always' | 'ignore' option ([#1404](https://github.com/sveltejs/kit/pull/1404))

## 1.0.0-next.104

### Patch Changes

- 9b448a6: Rename @sveltejs/kit/http to @sveltejs/kit/node ([#1391](https://github.com/sveltejs/kit/pull/1391))

## 1.0.0-next.103

### Patch Changes

- 11e7840: Generate ETags for binary response bodies ([#1382](https://github.com/sveltejs/kit/pull/1382))
- 11e7840: Update request/response body types ([#1382](https://github.com/sveltejs/kit/pull/1382))
- 9e20873: Allow ServerResponse to have non-static set of headers ([#1375](https://github.com/sveltejs/kit/pull/1375))
- 2562ca0: Account for POST bodies when serializing fetches ([#1385](https://github.com/sveltejs/kit/pull/1385))

## 1.0.0-next.102

### Patch Changes

- b5ff7f5: Rename \$layout to \_\_layout etc ([#1370](https://github.com/sveltejs/kit/pull/1370))
- d871213: Make Vite a prod dep of SvelteKit ([#1374](https://github.com/sveltejs/kit/pull/1374))

## 1.0.0-next.101

### Patch Changes

- f5e626d: Reference Vite/Svelte types inside Kit types ([#1319](https://github.com/sveltejs/kit/pull/1319))

## 1.0.0-next.100

### Patch Changes

- 9890492: Use TypedArray.set to copy from Uint8Array when getting raw body in core/http ([#1349](https://github.com/sveltejs/kit/pull/1349))

## 1.0.0-next.99

### Patch Changes

- 051c026: Remove getContext in favour of request.locals ([#1332](https://github.com/sveltejs/kit/pull/1332))

## 1.0.0-next.98

### Patch Changes

- d279e36: Add invalidate(url) API for rerunning load functions ([#1303](https://github.com/sveltejs/kit/pull/1303))

## 1.0.0-next.97

### Patch Changes

- 694f5de: Fixes `navigating` store type ([#1322](https://github.com/sveltejs/kit/pull/1322))
- 0befffb: Rename .svelte to .svelte-kit ([#1321](https://github.com/sveltejs/kit/pull/1321))
- c6fde99: Switch to ESM in config files ([#1323](https://github.com/sveltejs/kit/pull/1323))

## 1.0.0-next.96

### Patch Changes

- 63eff1a: Add prerendering to \$app/env typings ([#1316](https://github.com/sveltejs/kit/pull/1316))

## 1.0.0-next.95

### Patch Changes

- 16cca89: Export AdapterUtils type for use in adapters ([#1300](https://github.com/sveltejs/kit/pull/1300))
- f3ef93d: Not calling JSON.stringify on endpoint's body if it's a string and the content-type header denotes json ([#1272](https://github.com/sveltejs/kit/pull/1272))
- 5023e98: Remove 'Navigated to' text from announcer' ([#1305](https://github.com/sveltejs/kit/pull/1305))
- b4d0d6c: Normalize keys of headers from server side requests
- 08ebcb5: Add esm config support ([#936](https://github.com/sveltejs/kit/pull/936))
- 427e8e0: Validate template file on startup ([#1304](https://github.com/sveltejs/kit/pull/1304))

## 1.0.0-next.94

### Patch Changes

- 72c78a4: Handle URLs that need to be decoded ([#1273](https://github.com/sveltejs/kit/pull/1273))

## 1.0.0-next.93

### Patch Changes

- 353afa1: Disable FLoC by default ([#1267](https://github.com/sveltejs/kit/pull/1267))

## 1.0.0-next.92

### Patch Changes

- 354e384: Allow FormData to be passed as RequestHandler type Body argument ([#1256](https://github.com/sveltejs/kit/pull/1256))
- b1bfe83: Show error page on unknown initial path. Fixes #1190.

## 1.0.0-next.91

### Patch Changes

- 82955ec: fix: adapt to svelte ids without ?import in vite 2.2.3

## 1.0.0-next.90

### Patch Changes

- ac60208: Exit process after adapting ([#1212](https://github.com/sveltejs/kit/pull/1212))

## 1.0.0-next.89

### Patch Changes

- 927e63c: update the error message of prerender to optionally include the parent variable ([#1200](https://github.com/sveltejs/kit/pull/1200))

## 1.0.0-next.88

### Patch Changes

- 6f2b4a6: Remove references to npm start ([#1196](https://github.com/sveltejs/kit/pull/1196))

## 1.0.0-next.87

### Patch Changes

- 4131467: Prerender fallback page for SPAs ([#1181](https://github.com/sveltejs/kit/pull/1181))

## 1.0.0-next.86

### Patch Changes

- 2130087: Support multiple rel values on anchor tag ([#884](https://github.com/sveltejs/kit/pull/884))
- ba732ff: Report errors in hooks.js ([#1178](https://github.com/sveltejs/kit/pull/1178))
- a2f3f4b: Rename `start` to `preview` in the CLI and package scripts

## 1.0.0-next.85

### Patch Changes

- 4645ad5: Force Vite to bundle Svelte component libraries in SSR ([#1148](https://github.com/sveltejs/kit/pull/1148))
- abf0248: Fix \$service-worker types

## 1.0.0-next.84

### Patch Changes

- 5c2665f: Prevent ...rest parameters from swallowing earlier characters ([#1128](https://github.com/sveltejs/kit/pull/1128))
- 4e1c4ea: Omit modulepreload links from pages with no JS ([#1131](https://github.com/sveltejs/kit/pull/1131))
- 5d864a6: Fix RequestHandler return type
- e1313d0: Make response.body optional

## 1.0.0-next.83

### Patch Changes

- a4a1075: Work around apparent Cloudflare Workers platform bugs ([#1123](https://github.com/sveltejs/kit/pull/1123))

## 1.0.0-next.82

### Patch Changes

- 4af45e1: Remove usage of node built-ins from runtime ([#1117](https://github.com/sveltejs/kit/pull/1117))

## 1.0.0-next.81

### Patch Changes

- 1237eb3: Expose rawBody on request, and expect rawBody from adapters ([#1109](https://github.com/sveltejs/kit/pull/1109))
- 1237eb3: Expose getRawBody from kit/http ([#1109](https://github.com/sveltejs/kit/pull/1109))

## 1.0.0-next.80

### Patch Changes

- 7a4b351: Expose install-fetch subpackage for adapters to use ([#1091](https://github.com/sveltejs/kit/pull/1091))

## 1.0.0-next.79

### Patch Changes

- d3abd97: Fix Windows build output containing backward slashes ([#1096](https://github.com/sveltejs/kit/pull/1096))

## 1.0.0-next.78

### Patch Changes

- 6e27880: Move server-side fetch to adapters instead of build step ([#1066](https://github.com/sveltejs/kit/pull/1066))
- 61d7fa0: Better error logging ([#1062](https://github.com/sveltejs/kit/pull/1062))
- 041b706: Implement layout resets ([#1061](https://github.com/sveltejs/kit/pull/1061))
- 148819a: Use latest vite-plugin-svelte ([#1057](https://github.com/sveltejs/kit/pull/1057))
- 9d54eed: Make sveltekit:prefetch a noop if <a> has no href ([#1060](https://github.com/sveltejs/kit/pull/1060))

## 1.0.0-next.77

### Patch Changes

- fee388a: Include CSS for entry point/generated component ([#1053](https://github.com/sveltejs/kit/pull/1053))

## 1.0.0-next.76

### Patch Changes

- f870909: Pin vite-plugin-svelte version ([#1026](https://github.com/sveltejs/kit/pull/1026))
- de2466f: Fix stale prerendering bug ([#1040](https://github.com/sveltejs/kit/pull/1040))

## 1.0.0-next.75

### Patch Changes

- 0c02dc0: Use global URLSearchParams instead of import from node url ([#1020](https://github.com/sveltejs/kit/pull/1020))
- 8021d6b: Fix default error page ([#1021](https://github.com/sveltejs/kit/pull/1021))
- 11ec751: Fix build warnings about missing exports in hooks file ([#1003](https://github.com/sveltejs/kit/pull/1003))

## 1.0.0-next.74

### Patch Changes

- 4c45784: Add ambient types to published files ([#980](https://github.com/sveltejs/kit/pull/980))

## 1.0.0-next.73

### Patch Changes

- 1007f67: Allow non-root \$error.svelte components ([#901](https://github.com/sveltejs/kit/pull/901))
- ca108a6: Change `handle` hook from positional arguments to named arguments ([#959](https://github.com/sveltejs/kit/pull/959))

## 1.0.0-next.72

### Patch Changes

- 1d5228c: Make --open option work with --https ([#921](https://github.com/sveltejs/kit/pull/921))
- 39b6967: Add ambient type definitions for \$app imports ([#917](https://github.com/sveltejs/kit/pull/917))
- 1d5228c: Make --open option work on WSL ([#921](https://github.com/sveltejs/kit/pull/921))
- bb2d97d: Fix argument type for RequestHandler ([#914](https://github.com/sveltejs/kit/pull/914))

## 1.0.0-next.71

### Patch Changes

- 108c26c: Always return a response from render function in handle ([#847](https://github.com/sveltejs/kit/pull/847))

## 1.0.0-next.70

### Patch Changes

- 6d9f7b1: Only include CSS on an SSR'd page ([#839](https://github.com/sveltejs/kit/pull/839))
- 6ecfa2c: Remove duplicate &lt;style&gt; element ([#845](https://github.com/sveltejs/kit/pull/845))

## 1.0.0-next.69

### Patch Changes

- 4d2cd62: Add prerendering to \$app/env ([#833](https://github.com/sveltejs/kit/pull/833))
- e2eeeea: Call load when path changes if page.path is used ([#838](https://github.com/sveltejs/kit/pull/838))
- 50b5526: Pass through credentials when fetching in load ([#835](https://github.com/sveltejs/kit/pull/835))
- 6384af6: Only inline data if hydrate=true ([#837](https://github.com/sveltejs/kit/pull/837))

## 1.0.0-next.68

### Patch Changes

- 24fab19: Add --https flag to dev and start ([#462](https://github.com/sveltejs/kit/pull/462))
- ba4f9b7: Check port, only expose to network with --host flag ([#819](https://github.com/sveltejs/kit/pull/819))

## 1.0.0-next.67

### Patch Changes

- 679e997: Fix client-side redirect loop detection ([#811](https://github.com/sveltejs/kit/pull/811))
- 8d453c8: Specify minimum Node version number in @sveltejs/kit and add .npmrc to enforce it ([#787](https://github.com/sveltejs/kit/pull/787))
- 78aec0c: Detect service worker support
- f33a22c: Make ...rest parameters optional ([#768](https://github.com/sveltejs/kit/pull/768))

## 1.0.0-next.66

### Patch Changes

- d9ce2a2: Correct response type for fetch ([#799](https://github.com/sveltejs/kit/pull/799))

## 1.0.0-next.65

### Patch Changes

- c0b9873: Always apply layout props when hydrating ([#794](https://github.com/sveltejs/kit/pull/794))
- b8a8e53: Add type to config.kit.vite ([#786](https://github.com/sveltejs/kit/pull/786))
- 9b09bcc: Prevent XSS when serializing fetch results ([#769](https://github.com/sveltejs/kit/pull/769))

## 1.0.0-next.64

### Patch Changes

- 7f58512: Prevent Vite prebundling from crashing on startup ([#759](https://github.com/sveltejs/kit/pull/759))

## 1.0.0-next.63

### Patch Changes

- 31f94fe: Add ssr, router and hydrate options

## 1.0.0-next.62

### Patch Changes

- 864c3d4: Assets imported from css and js/ts files are emitted as files instead of being inlined ([#461](https://github.com/sveltejs/kit/pull/461))

## 1.0.0-next.61

### Patch Changes

- 4b2c97e: Initialise router with history.state

## 1.0.0-next.60

### Patch Changes

- 84e9023: Fix host property ([#657](https://github.com/sveltejs/kit/pull/657))
- 272148b: Rename \$service-worker::assets to files, per the docs ([#658](https://github.com/sveltejs/kit/pull/658))
- d5071c5: Hydrate initial page before starting router ([#654](https://github.com/sveltejs/kit/pull/654))
- 4a1c04a: More accurate MODULE_NOT_FOUND errors ([#665](https://github.com/sveltejs/kit/pull/665))
- d881b7e: Replace setup with hooks ([#670](https://github.com/sveltejs/kit/pull/670))

## 1.0.0-next.59

### Patch Changes

- 826f39e: Make prefetching work ([#620](https://github.com/sveltejs/kit/pull/620))

## 1.0.0-next.58

### Patch Changes

- 26893b0: Allow first argument to fetch in load to be a request ([#619](https://github.com/sveltejs/kit/pull/619))
- 924db15: Add copy function to Builder.js ([#630](https://github.com/sveltejs/kit/pull/630))

## 1.0.0-next.57

### Patch Changes

- 391189f: Check for options.initiator in correct place ([#615](https://github.com/sveltejs/kit/pull/615))

## 1.0.0-next.56

### Patch Changes

- 82cbe2b: Shrink client manifest ([#593](https://github.com/sveltejs/kit/pull/593))
- 8024178: remove @sveltejs/app-utils ([#600](https://github.com/sveltejs/kit/pull/600))

## 1.0.0-next.55

### Patch Changes

- d0a7019: switch to @sveltejs/vite-plugin-svelte ([#584](https://github.com/sveltejs/kit/pull/584))
- 8a88fad: Replace regex routes with fallthrough routes ([#583](https://github.com/sveltejs/kit/pull/583))

## 1.0.0-next.54

### Patch Changes

- 3037530: Create history entry for initial route ([#582](https://github.com/sveltejs/kit/pull/582))
- 04f17f5: Prevent erronous <style>undefined</style> ([#578](https://github.com/sveltejs/kit/pull/578))
- 8805c6d: Pass adapters directly to svelte.config.cjs ([#579](https://github.com/sveltejs/kit/pull/579))

## 1.0.0-next.53

### Patch Changes

- 9cf2f21: Only require page components to export prerender ([#577](https://github.com/sveltejs/kit/pull/577))
- e860de0: Invalidate page when query changes ([#575](https://github.com/sveltejs/kit/pull/575))
- 7bb1cf0: Disable vite-plugin-svelte transform cache ([#576](https://github.com/sveltejs/kit/pull/576))

## 1.0.0-next.52

### Patch Changes

- ac3669e: Move Vite config into svelte.config.cjs ([#569](https://github.com/sveltejs/kit/pull/569))

## 1.0.0-next.51

### Patch Changes

- 34a00f9: Bypass router on hydration ([#563](https://github.com/sveltejs/kit/pull/563))

## 1.0.0-next.50

### Patch Changes

- 0512fd1: Remove startGlobal option ([#559](https://github.com/sveltejs/kit/pull/559))
- 9212aa5: Add options to adapter-node, and add adapter types ([#531](https://github.com/sveltejs/kit/pull/531))
- 0512fd1: Fire custom events for start, and navigation start/end ([#559](https://github.com/sveltejs/kit/pull/559))

## 1.0.0-next.49

### Patch Changes

- ab28c0a: kit: include missing types.d.ts ([#538](https://github.com/sveltejs/kit/pull/538))
- c76c9bf: Upgrade Vite ([#544](https://github.com/sveltejs/kit/pull/544))

## 1.0.0-next.48

### Patch Changes

- e37a302: Make getSession future-proof ([#524](https://github.com/sveltejs/kit/pull/524))

## 1.0.0-next.47

### Patch Changes

- 5554acc: Add \$lib alias ([#511](https://github.com/sveltejs/kit/pull/511))
- 5cd6f11: bump vite-plugin-svelte to 0.11.0 ([#513](https://github.com/sveltejs/kit/pull/513))

## 1.0.0-next.46

### Patch Changes

- f35a5cd: Change adapter signature ([#505](https://github.com/sveltejs/kit/pull/505))

## 1.0.0-next.45

### Patch Changes

- 925638a: Remove endpoints from the files built for the client ([#490](https://github.com/sveltejs/kit/pull/490))
- c3cf3f3: Bump deps ([#492](https://github.com/sveltejs/kit/pull/492))
- 625747d: kit: bundle @sveltejs/kit into built application ([#486](https://github.com/sveltejs/kit/pull/486))
- Updated dependencies [c3cf3f3]
  - @sveltejs/vite-plugin-svelte@1.0.0-next.3

## 1.0.0-next.44

### Patch Changes

- e6449d2: Fix AMP styles for real ([#494](https://github.com/sveltejs/kit/pull/494))

## 1.0.0-next.43

### Patch Changes

- 672e9be: Fix AMP styles, again ([#491](https://github.com/sveltejs/kit/pull/491))

## 1.0.0-next.42

### Patch Changes

- 0f54ebc: Fix AMP styles ([#488](https://github.com/sveltejs/kit/pull/488))

## 1.0.0-next.41

### Patch Changes

- 4aa5a73: Future-proof prepare argument ([#471](https://github.com/sveltejs/kit/pull/471))
- 58dc400: Call correct set_paths function ([#487](https://github.com/sveltejs/kit/pull/487))
- 2322291: Update to node-fetch@3

## 1.0.0-next.40

### Patch Changes

- 4c5fd3c: Include layout/error styles in SSR ([#472](https://github.com/sveltejs/kit/pull/472))

## 1.0.0-next.39

### Patch Changes

- b7fdb0d: Skip pre-bundling ([#468](https://github.com/sveltejs/kit/pull/468))

## 1.0.0-next.38

### Patch Changes

- 15402b1: Add service worker support ([#463](https://github.com/sveltejs/kit/pull/463))
- 0c630b5: Ignore dynamically imported components when constructing styles in dev mode ([#443](https://github.com/sveltejs/kit/pull/443))
- ac06af5: Fix svelte-kit adapt for Windows ([#435](https://github.com/sveltejs/kit/pull/435))
- 061fa46: Implement improved redirect API
- b800049: Include type declarations ([#442](https://github.com/sveltejs/kit/pull/442))
- 07c6de4: Use posix paths in manifest even on Windows ([#436](https://github.com/sveltejs/kit/pull/436))
- 27ba872: Error if preload function exists ([#455](https://github.com/sveltejs/kit/pull/455))
- 0c630b5: Add default paths in case singletons module is invalidated ([#443](https://github.com/sveltejs/kit/pull/443))
- 73dd998: Allow custom extensions ([#411](https://github.com/sveltejs/kit/pull/411))

## 1.0.0-next.37

### Patch Changes

- 230c6d9: Indicate which request failed, if fetch fails inside load function ([#427](https://github.com/sveltejs/kit/pull/427))
- f1bc218: Run adapt via svelte-kit build ([#430](https://github.com/sveltejs/kit/pull/430))
- 6850ddc: Fix svelte-kit start for Windows ([#425](https://github.com/sveltejs/kit/pull/425))

## 1.0.0-next.36

### Patch Changes

- 7b70a33: Force version bump so that Kit uses updated vite-plugin-svelte ([#419](https://github.com/sveltejs/kit/pull/419))

## 1.0.0-next.35

### Patch Changes

- Use Vite
- Fix Windows issues
- Preserve load context during navigation
- Return error from load

## 1.0.0-next.34

### Patch Changes

- Fix adapters and convert to ES modules

## 1.0.0-next.33

### Patch Changes

- 474070e: Better errors when modules cannot be found ([#381](https://github.com/sveltejs/kit/pull/381))

## 1.0.0-next.32

### Patch Changes

- Convert everything to ESM

## 1.0.0-next.31

### Patch Changes

- b6c2434: app.js -> app.cjs ([#362](https://github.com/sveltejs/kit/pull/362))

## 1.0.0-next.30

### Patch Changes

- 00cbaf6: Rename `_.config.js` to `_.config.cjs` ([#356](https://github.com/sveltejs/kit/pull/356))

## 1.0.0-next.29

### Patch Changes

- 4c0edce: Use addEventListener instead of onload ([#347](https://github.com/sveltejs/kit/pull/347))

## 1.0.0-next.28

### Patch Changes

- 4353025: Prevent infinite loop when fetching bad URLs inside error responses ([#340](https://github.com/sveltejs/kit/pull/340))
- 2860065: Handle assets path when prerendering ([#341](https://github.com/sveltejs/kit/pull/341))

## 1.0.0-next.27

### Patch Changes

- Fail build if prerender errors
- Hide logging behind --verbose option

## 1.0.0-next.26

### Patch Changes

- Fix svelte-announcer CSS

## 1.0.0-next.25

### Patch Changes

- Surface stack traces for endpoint/page rendering errors

## 1.0.0-next.24

### Patch Changes

- 26643df: Account for config.paths when prerendering ([#322](https://github.com/sveltejs/kit/pull/322))

## 1.0.0-next.23

### Patch Changes

- 9b758aa: Upgrade to Snowpack 3 ([#321](https://github.com/sveltejs/kit/pull/321))

## 1.0.0-next.22

### Patch Changes

- bb68595: use readFileSync instead of createReadStream ([#320](https://github.com/sveltejs/kit/pull/320))

## 1.0.0-next.21

### Patch Changes

- 217e4cc: Set paths to empty string before prerender ([#317](https://github.com/sveltejs/kit/pull/317))

## 1.0.0-next.20

### Patch Changes

- ccf4aa7: Implement prerender config ([#315](https://github.com/sveltejs/kit/pull/315))

## 1.0.0-next.19

### Patch Changes

- deda984: Make navigating store contain from and to properties ([#313](https://github.com/sveltejs/kit/pull/313))

## 1.0.0-next.18

### Patch Changes

- c29b61e: Announce page changes ([#311](https://github.com/sveltejs/kit/pull/311))
- 72da270: Reset focus properly ([#309](https://github.com/sveltejs/kit/pull/309))

## 1.0.0-next.17

### Patch Changes

- f7dea55: Set process.env.NODE_ENV when invoking via the CLI ([#304](https://github.com/sveltejs/kit/pull/304))

## 1.0.0-next.16

### Patch Changes

- Remove temporary logging
- Add sveltekit:prefetch and sveltekit:noscroll

## 1.0.0-next.15

### Patch Changes

- 6d1bb11: Fix AMP CSS ([#286](https://github.com/sveltejs/kit/pull/286))
- d8b53af: Ignore $layout and $error files when finding static paths
- Better scroll tracking

## 1.0.0-next.14

### Patch Changes

- Fix dev loader

## 1.0.0-next.13

### Patch Changes

- 1ea4d6b: More robust CSS extraction ([#279](https://github.com/sveltejs/kit/pull/279))

## 1.0.0-next.12

### Patch Changes

- e7c88dd: Tweak AMP validation screen

## 1.0.0-next.11

### Patch Changes

- a31f218: Fix SSR loader invalidation ([#277](https://github.com/sveltejs/kit/pull/277))

## 1.0.0-next.10

### Patch Changes

- 8b14d29: Omit svelte-data scripts from AMP pages ([#276](https://github.com/sveltejs/kit/pull/276))

## 1.0.0-next.9

### Patch Changes

- f5fa223: AMP support ([#274](https://github.com/sveltejs/kit/pull/274))
- 47f2ee1: Always remove trailing slashes ([#267](https://github.com/sveltejs/kit/pull/267))
- 1becb94: Replace preload with load

## 1.0.0-next.8

### Patch Changes

- 15dd751: Use meta http-equiv=refresh ([#256](https://github.com/sveltejs/kit/pull/256))
- be7e031: Fix handling of static files ([#258](https://github.com/sveltejs/kit/pull/258))
- ed6b8fd: Implement \$app/env ([#251](https://github.com/sveltejs/kit/pull/251))

## 1.0.0-next.7

### Patch Changes

- 76705b0: make HMR work outside localhost ([#246](https://github.com/sveltejs/kit/pull/246))

## 1.0.0-next.6

### Patch Changes

- 0e45255: Move options behind kit namespace, change paths -> kit.files ([#236](https://github.com/sveltejs/kit/pull/236))
- fa7f2b2: Implement live bindings for SSR code ([#245](https://github.com/sveltejs/kit/pull/245))

## 1.0.0-next.5

### Patch Changes

- Return dependencies from render

## 1.0.0-next.4

### Patch Changes

- af01b0d: Move renderer out of app assets folder

## 1.0.0-next.3

### Patch Changes

- Add paths to manifest, for static prerendering

## 1.0.0-next.2

### Patch Changes

- Fix typo causing misnamed assets folder

## 1.0.0-next.1

### Patch Changes

- a4bc090: Transform exported functions correctly ([#225](https://github.com/sveltejs/kit/pull/225))
- 00bbf98: Fix nested layouts ([#227](https://github.com/sveltejs/kit/pull/227))

## 0.0.31-next.0

### Patch Changes

- ffd7bba: Fix SSR cache invalidation ([#217](https://github.com/sveltejs/kit/pull/217))

## 0.0.30

### Patch Changes

- Add back stores(), but with deprecation warning
- Rename stores.preloading to stores.navigating
- Rewrite routing logic

## 0.0.29

### Patch Changes

- 10872cc: Normalize request.query ([#196](https://github.com/sveltejs/kit/pull/196))

## 0.0.28

### Patch Changes

- Add svelte-kit start command

## 0.0.27

### Patch Changes

- rename CLI to svelte-kit
- 0904e22: rename svelte CLI to svelte-kit ([#186](https://github.com/sveltejs/kit/pull/186))
- Validate route responses
- Make paths and target configurable

## 0.0.26

### Patch Changes

- b475ed4: Overhaul adapter API - fixes #166 ([#180](https://github.com/sveltejs/kit/pull/180))
- Updated dependencies [b475ed4]
  - @sveltejs/app-utils@0.0.18

## 0.0.25

### Patch Changes

- Updated dependencies [3bdf33b]
  - @sveltejs/app-utils@0.0.17

## 0.0.24

### Patch Changes

- 67eaeea: Move app-utils stuff into subpackages
- 7f8df30: Move kit runtime code, expose via \$app aliases
- Updated dependencies [67eaeea]
  - @sveltejs/app-utils@0.0.16

## 0.0.23

### Patch Changes

- a163000: Parse body on incoming requests
- a346eab: Copy over latest Sapper router code ([#6](https://github.com/sveltejs/kit/pull/6))
- Updated dependencies [a163000]
  - @sveltejs/app-utils@0.0.15

## 0.0.22

### Patch Changes

- Force bump version

## 0.0.21

### Patch Changes

- Build setup entry point
- Work around pkg.exports constraint
- Respond with 500s if render fails
- Updated dependencies [undefined]
- Updated dependencies [undefined]
- Updated dependencies [undefined]
  - @sveltejs/app-utils@0.0.14

## 0.0.20

### Patch Changes

- Pass setup module to renderer
- Bump Snowpack version
- Updated dependencies [undefined]
- Updated dependencies [96c06d8]
  - @sveltejs/app-utils@0.0.13

## 0.0.19

### Patch Changes

- fa9d7ce: Handle import.meta in SSR module loader
- 0320208: Rename 'server route' to 'endpoint'
- b9444d2: Update to Snowpack 2.15
- 5ca907c: Use shared mkdirp helper
- Updated dependencies [0320208]
- Updated dependencies [5ca907c]
  - @sveltejs/app-utils@0.0.12

## 0.0.18

### Patch Changes

- Updated dependencies [undefined]
  - @sveltejs/app-utils@0.0.11

## 0.0.17

### Patch Changes

- 19323e9: Update Snowpack
- Updated dependencies [19323e9]
  - @sveltejs/app-utils@0.0.10

## 0.0.16

### Patch Changes

- Updated dependencies [90a98ae]
  - @sveltejs/app-utils@0.0.9

## 0.0.15

### Patch Changes

- Updated dependencies [undefined]
  - @sveltejs/app-utils@0.0.8

## 0.0.14

### Patch Changes

- various
- Updated dependencies [undefined]
  - @sveltejs/app-utils@0.0.7

####### packages/kit/kit.vitest.config.js #######

```

import { defineConfig } from 'vitest/config';

// this file needs a custom name so that the numerous test subprojects don't all pick it up
export default defineConfig({
	test: {
		// shave a couple seconds off the tests
		isolate: false,
		singleThread: true,
		include: ['src/**/*.spec.js'],
		exclude: [
			'**/node_modules/**',
			'**/.svelte-kit/**',
			'**/.{idea,git,cache,output,temp}/**',
			'**/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress,tsup,build}.config.*'
		],
		watchExclude: ['**/node_modules/**', '**/.svelte-kit/**']
	}
});

```


####### packages/kit/package.json #######

```

{
	"name": "@sveltejs/kit",
	"version": "2.5.7",
	"description": "The fastest way to build Svelte apps",
	"repository": {
		"type": "git",
		"url": "https://github.com/sveltejs/kit",
		"directory": "packages/kit"
	},
	"license": "MIT",
	"homepage": "https://kit.svelte.dev",
	"type": "module",
	"dependencies": {
		"@types/cookie": "^0.6.0",
		"cookie": "^0.6.0",
		"devalue": "^5.0.0",
		"esm-env": "^1.0.0",
		"import-meta-resolve": "^4.0.0",
		"kleur": "^4.1.5",
		"magic-string": "^0.30.5",
		"mrmime": "^2.0.0",
		"sade": "^1.8.1",
		"set-cookie-parser": "^2.6.0",
		"sirv": "^2.0.4",
		"tiny-glob": "^0.2.9"
	},
	"devDependencies": {
		"@playwright/test": "^1.41.0",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"@types/connect": "^3.4.38",
		"@types/node": "^18.19.3",
		"@types/sade": "^1.7.8",
		"@types/set-cookie-parser": "^2.4.7",
		"dts-buddy": "0.4.6",
		"rollup": "^4.14.2",
		"svelte": "^4.2.10",
		"svelte-preprocess": "^5.1.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8",
		"vitest": "^1.5.0"
	},
	"peerDependencies": {
		"@sveltejs/vite-plugin-svelte": "^3.0.0",
		"svelte": "^4.0.0 || ^5.0.0-next.0",
		"vite": "^5.0.3"
	},
	"bin": {
		"svelte-kit": "svelte-kit.js"
	},
	"files": [
		"src",
		"!src/**/*.spec.js",
		"!src/core/**/fixtures",
		"!src/core/**/test",
		"types",
		"svelte-kit.js",
		"postinstall.js"
	],
	"scripts": {
		"lint": "prettier --config ../../.prettierrc --check .",
		"check": "tsc && cd ./test/types && tsc",
		"check:all": "tsc && pnpm -r --filter=\"./**\" check",
		"format": "prettier --config ../../.prettierrc --write .",
		"test": "pnpm test:unit && pnpm test:integration",
		"test:integration": "pnpm -r --workspace-concurrency 1 --filter=\"./test/**\" test",
		"test:cross-platform:dev": "pnpm -r --workspace-concurrency 1 --filter=\"./test/**\" test:cross-platform:dev",
		"test:cross-platform:build": "pnpm test:unit && pnpm -r --workspace-concurrency 1 --filter=\"./test/**\" test:cross-platform:build",
		"test:unit": "vitest --config kit.vitest.config.js run",
		"postinstall": "node postinstall.js",
		"prepublishOnly": "pnpm generate:types",
		"generate:version": "node scripts/generate-version.js",
		"generate:types": "node scripts/generate-dts.js"
	},
	"exports": {
		"./package.json": "./package.json",
		".": {
			"types": "./types/index.d.ts",
			"import": "./src/exports/index.js"
		},
		"./node": {
			"types": "./types/index.d.ts",
			"import": "./src/exports/node/index.js"
		},
		"./node/polyfills": {
			"types": "./types/index.d.ts",
			"import": "./src/exports/node/polyfills.js"
		},
		"./hooks": {
			"types": "./types/index.d.ts",
			"import": "./src/exports/hooks/index.js"
		},
		"./vite": {
			"types": "./types/index.d.ts",
			"import": "./src/exports/vite/index.js"
		}
	},
	"types": "types/index.d.ts",
	"engines": {
		"node": ">=18.13"
	}
}

```


####### packages/kit/postinstall.js #######

```

import { load_config } from './src/core/config/index.js';
import * as sync from './src/core/sync/sync.js';
import glob from 'tiny-glob/sync.js';
import fs from 'node:fs';

try {
	const cwd = process.env.INIT_CWD ?? process.cwd();
	process.chdir(cwd);

	if (fs.existsSync('package.json')) {
		const pkg = JSON.parse(fs.readFileSync('package.json', 'utf8'));

		const workspaces = [];

		if (pkg.workspaces) {
			// Find all npm and Yarn workspace glob patterns
			// https://classic.yarnpkg.com/blog/2018/02/15/nohoist/
			// https://docs.npmjs.com/cli/v9/configuring-npm/package-json#workspaces
			const patterns = Array.isArray(pkg.workspaces) ? pkg.workspaces : pkg.workspaces.packages;

			for (const pattern of patterns) {
				workspaces.push(
					...glob(pattern, { cwd, absolute: true }).filter((path) =>
						fs.statSync(path).isDirectory()
					)
				);
			}
		} else {
			workspaces.push(cwd);
		}

		for (const cwd of workspaces) {
			process.chdir(cwd);

			if (!fs.existsSync('package.json')) continue;
			if (!fs.existsSync('svelte.config.js')) continue;

			const pkg = JSON.parse(fs.readFileSync('package.json', 'utf8'));
			if (!pkg.dependencies?.['@sveltejs/kit'] && !pkg.devDependencies?.['@sveltejs/kit']) continue;

			try {
				const config = await load_config();
				await sync.all(config, 'development');
			} catch (error) {
				console.error('Error while trying to sync SvelteKit config');
				console.error(error);
			}
		}
	}
} catch (error) {
	console.error(error);
}

```


####### packages/kit/README.md #######

# The fastest way to build Svelte apps

This is the [SvelteKit](https://kit.svelte.dev) framework and CLI.

The quickest way to get started is via the [create-svelte](https://github.com/sveltejs/kit/tree/main/packages/create-svelte) package:

```bash
npm create svelte@latest my-app
cd my-app
npm install
npm run dev
```

See the [documentation](https://kit.svelte.dev/docs) to learn more.

## Changelog

[The Changelog for this package is available on GitHub](https://github.com/sveltejs/kit/blob/main/packages/kit/CHANGELOG.md).

####### packages/kit/scripts/cp.js #######

```

import { copy } from '../src/utils/filesystem.js';

const [src, dest] = process.argv.slice(2);

copy(src, dest);

```


####### packages/kit/scripts/generate-dts.js #######

```

import { createBundle } from 'dts-buddy';
import { readFileSync } from 'node:fs';

await createBundle({
	output: 'types/index.d.ts',
	modules: {
		'@sveltejs/kit': 'src/exports/public.d.ts',
		'@sveltejs/kit/hooks': 'src/exports/hooks/index.js',
		'@sveltejs/kit/node': 'src/exports/node/index.js',
		'@sveltejs/kit/node/polyfills': 'src/exports/node/polyfills.js',
		'@sveltejs/kit/vite': 'src/exports/vite/index.js',
		'$app/environment': 'src/runtime/app/environment/types.d.ts',
		'$app/forms': 'src/runtime/app/forms.js',
		'$app/navigation': 'src/runtime/app/navigation.js',
		'$app/paths': 'src/runtime/app/paths/types.d.ts',
		'$app/server': 'src/runtime/app/server/index.js',
		'$app/stores': 'src/runtime/app/stores.js'
	},
	include: ['src']
});

// dts-buddy doesn't inline imports of module declaration in ambient-private.d.ts but also doesn't include them, resulting in broken types - guard against that
const types = readFileSync('./types/index.d.ts', 'utf-8');
if (types.includes('__sveltekit/')) {
	throw new Error(
		'Found __sveltekit/ in types/index.d.ts - make sure to hide internal modules by not just reexporting them. Contents:\n\n' +
			types
	);
}

```


####### packages/kit/scripts/generate-version.js #######

```

import fs from 'node:fs';

const pkg = JSON.parse(fs.readFileSync('package.json', 'utf-8'));

fs.writeFileSync(
	'./src/version.js',
	`// generated during release, do not modify\n\n/** @type {string} */\nexport const VERSION = '${pkg.version}';\n`
);

```


####### packages/kit/src/cli.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import colors from 'kleur';
import sade from 'sade';
import { load_config } from './core/config/index.js';
import { coalesce_to_error } from './utils/error.js';

/** @param {unknown} e */
function handle_error(e) {
	const error = coalesce_to_error(e);

	if (error.name === 'SyntaxError') throw error;

	console.error(colors.bold().red(`> ${error.message}`));
	if (error.stack) {
		console.error(colors.gray(error.stack.split('\n').slice(1).join('\n')));
	}

	process.exit(1);
}

const pkg = JSON.parse(fs.readFileSync(new URL('../package.json', import.meta.url), 'utf-8'));
const prog = sade('svelte-kit').version(pkg.version);

prog
	.command('sync')
	.describe('Synchronise generated type definitions')
	.option('--mode', 'Specify a mode for loading environment variables', 'development')
	.action(async ({ mode }) => {
		if (!fs.existsSync('svelte.config.js')) {
			console.warn(`Missing ${path.resolve('svelte.config.js')} — skipping`);
			return;
		}

		try {
			const config = await load_config();
			const sync = await import('./core/sync/sync.js');
			await sync.all_types(config, mode);
		} catch (error) {
			handle_error(error);
		}
	});

prog.parse(process.argv, { unknown: (arg) => `Unknown option: ${arg}` });

```


####### packages/kit/src/constants.js #######

```

/**
 * A fake asset path used in `vite dev` and `vite preview`, so that we can
 * serve local assets while verifying that requests are correctly prefixed
 */
export const SVELTE_KIT_ASSETS = '/_svelte_kit_assets';

export const GENERATED_COMMENT = '// this file is generated — do not edit it\n';

export const ENDPOINT_METHODS = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS', 'HEAD'];

export const PAGE_METHODS = ['GET', 'POST', 'HEAD'];

```


####### packages/kit/src/core/adapt/builder.js #######

```

import colors from 'kleur';
import { createReadStream, createWriteStream, existsSync, statSync } from 'node:fs';
import { extname, resolve } from 'node:path';
import { pipeline } from 'node:stream';
import { promisify } from 'node:util';
import zlib from 'node:zlib';
import { copy, rimraf, mkdirp } from '../../utils/filesystem.js';
import { generate_manifest } from '../generate_manifest/index.js';
import { get_route_segments } from '../../utils/routing.js';
import { get_env } from '../../exports/vite/utils.js';
import generate_fallback from '../postbuild/fallback.js';
import { write } from '../sync/utils.js';
import { list_files } from '../utils.js';
import { find_server_assets } from '../generate_manifest/find_server_assets.js';

const pipe = promisify(pipeline);
const extensions = ['.html', '.js', '.mjs', '.json', '.css', '.svg', '.xml', '.wasm'];

/**
 * Creates the Builder which is passed to adapters for building the application.
 * @param {{
 *   config: import('types').ValidatedConfig;
 *   build_data: import('types').BuildData;
 *   server_metadata: import('types').ServerMetadata;
 *   route_data: import('types').RouteData[];
 *   prerendered: import('types').Prerendered;
 *   prerender_map: import('types').PrerenderMap;
 *   log: import('types').Logger;
 *   vite_config: import('vite').ResolvedConfig;
 * }} opts
 * @returns {import('@sveltejs/kit').Builder}
 */
export function create_builder({
	config,
	build_data,
	server_metadata,
	route_data,
	prerendered,
	prerender_map,
	log,
	vite_config
}) {
	/** @type {Map<import('@sveltejs/kit').RouteDefinition, import('types').RouteData>} */
	const lookup = new Map();

	/**
	 * Rather than exposing the internal `RouteData` type, which is subject to change,
	 * we expose a stable type that adapters can use to group/filter routes
	 */
	const routes = route_data.map((route) => {
		const { config, methods, page, api } = /** @type {import('types').ServerMetadataRoute} */ (
			server_metadata.routes.get(route.id)
		);

		/** @type {import('@sveltejs/kit').RouteDefinition} */
		const facade = {
			id: route.id,
			api,
			page,
			segments: get_route_segments(route.id).map((segment) => ({
				dynamic: segment.includes('['),
				rest: segment.includes('[...'),
				content: segment
			})),
			pattern: route.pattern,
			prerender: prerender_map.get(route.id) ?? false,
			methods,
			config
		};

		lookup.set(facade, route);

		return facade;
	});

	return {
		log,
		rimraf,
		mkdirp,
		copy,

		config,
		prerendered,
		routes,

		async compress(directory) {
			if (!existsSync(directory)) {
				return;
			}

			const files = list_files(directory, (file) => extensions.includes(extname(file))).map(
				(file) => resolve(directory, file)
			);

			await Promise.all(
				files.flatMap((file) => [compress_file(file, 'gz'), compress_file(file, 'br')])
			);
		},

		async createEntries(fn) {
			const seen = new Set();

			for (let i = 0; i < route_data.length; i += 1) {
				const route = route_data[i];
				if (prerender_map.get(route.id) === true) continue;
				const { id, filter, complete } = fn(routes[i]);

				if (seen.has(id)) continue;
				seen.add(id);

				const group = [route];

				// figure out which lower priority routes should be considered fallbacks
				for (let j = i + 1; j < route_data.length; j += 1) {
					if (prerender_map.get(routes[j].id) === true) continue;
					if (filter(routes[j])) {
						group.push(route_data[j]);
					}
				}

				const filtered = new Set(group);

				// heuristic: if /foo/[bar] is included, /foo/[bar].json should
				// also be included, since the page likely needs the endpoint
				// TODO is this still necessary, given the new way of doing things?
				filtered.forEach((route) => {
					if (route.page) {
						const endpoint = route_data.find((candidate) => candidate.id === route.id + '.json');

						if (endpoint) {
							filtered.add(endpoint);
						}
					}
				});

				if (filtered.size > 0) {
					await complete({
						generateManifest: ({ relativePath }) =>
							generate_manifest({
								build_data,
								relative_path: relativePath,
								routes: Array.from(filtered)
							})
					});
				}
			}
		},

		findServerAssets(route_data) {
			return find_server_assets(
				build_data,
				route_data.map((route) => /** @type {import('types').RouteData} */ (lookup.get(route)))
			);
		},

		async generateFallback(dest) {
			const manifest_path = `${config.kit.outDir}/output/server/manifest-full.js`;
			const env = get_env(config.kit.env, vite_config.mode);

			const fallback = await generate_fallback({
				manifest_path,
				env: { ...env.private, ...env.public }
			});

			if (existsSync(dest)) {
				console.log(
					colors
						.bold()
						.yellow(
							`Overwriting ${dest} with fallback page. Consider using a different name for the fallback.`
						)
				);
			}

			write(dest, fallback);
		},

		generateEnvModule() {
			const dest = `${config.kit.outDir}/output/prerendered/dependencies/${config.kit.appDir}/env.js`;
			const env = get_env(config.kit.env, vite_config.mode);

			write(dest, `export const env=${JSON.stringify(env.public)}`);
		},

		generateManifest({ relativePath, routes: subset }) {
			return generate_manifest({
				build_data,
				relative_path: relativePath,
				routes: subset
					? subset.map((route) => /** @type {import('types').RouteData} */ (lookup.get(route)))
					: route_data.filter((route) => prerender_map.get(route.id) !== true)
			});
		},

		getBuildDirectory(name) {
			return `${config.kit.outDir}/${name}`;
		},

		getClientDirectory() {
			return `${config.kit.outDir}/output/client`;
		},

		getServerDirectory() {
			return `${config.kit.outDir}/output/server`;
		},

		getAppPath() {
			return build_data.app_path;
		},

		writeClient(dest) {
			return copy(`${config.kit.outDir}/output/client`, dest, {
				// avoid making vite build artefacts public
				filter: (basename) => basename !== '.vite'
			});
		},

		writePrerendered(dest) {
			const source = `${config.kit.outDir}/output/prerendered`;
			return [...copy(`${source}/pages`, dest), ...copy(`${source}/dependencies`, dest)];
		},

		writeServer(dest) {
			return copy(`${config.kit.outDir}/output/server`, dest);
		}
	};
}

/**
 * @param {string} file
 * @param {'gz' | 'br'} format
 */
async function compress_file(file, format = 'gz') {
	const compress =
		format == 'br'
			? zlib.createBrotliCompress({
					params: {
						[zlib.constants.BROTLI_PARAM_MODE]: zlib.constants.BROTLI_MODE_TEXT,
						[zlib.constants.BROTLI_PARAM_QUALITY]: zlib.constants.BROTLI_MAX_QUALITY,
						[zlib.constants.BROTLI_PARAM_SIZE_HINT]: statSync(file).size
					}
				})
			: zlib.createGzip({ level: zlib.constants.Z_BEST_COMPRESSION });

	const source = createReadStream(file);
	const destination = createWriteStream(`${file}.${format}`);

	await pipe(source, compress, destination);
}

```


####### packages/kit/src/core/adapt/builder.spec.js #######

```

import { existsSync, rmSync } from 'node:fs';
import { join, dirname } from 'node:path';
import { fileURLToPath } from 'node:url';
import { assert, expect, test } from 'vitest';
import { create_builder } from './builder.js';
import { posixify } from '../../utils/filesystem.js';
import { list_files } from '../utils.js';

const __filename = fileURLToPath(import.meta.url);
const __dirname = join(__filename, '..');

test('copy files', () => {
	const cwd = join(__dirname, 'fixtures/basic');
	const outDir = join(cwd, '.svelte-kit');

	/** @type {import('@sveltejs/kit').Config} */
	const mocked = {
		extensions: ['.svelte'],
		kit: {
			appDir: '_app',
			files: {
				assets: join(__dirname, 'fixtures/basic/static')
			},
			outDir
		}
	};

	const builder = create_builder({
		config: /** @type {import('types').ValidatedConfig} */ (mocked),
		// @ts-expect-error
		build_data: {},
		// @ts-expect-error
		server_metadata: {},
		route_data: [],
		// @ts-expect-error
		prerendered: {
			paths: []
		},
		// @ts-expect-error
		prerender_map: {},
		// @ts-expect-error
		log: {}
	});

	const dest = join(__dirname, 'output');

	rmSync(dest, { recursive: true, force: true });

	expect(builder.writeClient(dest)).toEqual(list_files(dest).map(posixify));
	expect(
		list_files(`${outDir}/output/client`).filter((file) => !file.startsWith('.vite/'))
	).toEqual(list_files(dest));

	rmSync(dest, { recursive: true, force: true });

	expect(builder.writeServer(dest)).toEqual(list_files(dest).map(posixify));
	expect(list_files(`${outDir}/output/server`)).toEqual(list_files(dest));

	rmSync(dest, { force: true, recursive: true });
});

test('compress files', async () => {
	// @ts-expect-error - we don't need the whole config for this test
	const builder = create_builder({
		route_data: []
	});

	const target = fileURLToPath(new URL('./fixtures/compress/foo.css', import.meta.url));
	rmSync(target + '.br', { force: true });
	rmSync(target + '.gz', { force: true });
	await builder.compress(dirname(target));
	assert.ok(existsSync(target + '.br'));
	assert.ok(existsSync(target + '.gz'));
});

```


####### packages/kit/src/core/adapt/fixtures/basic/static/answer.md #######

42

####### packages/kit/src/core/adapt/fixtures/compress/foo.css #######

```


```


####### packages/kit/src/core/adapt/index.js #######

```

import colors from 'kleur';
import { create_builder } from './builder.js';

/**
 * @param {import('types').ValidatedConfig} config
 * @param {import('types').BuildData} build_data
 * @param {import('types').ServerMetadata} server_metadata
 * @param {import('types').Prerendered} prerendered
 * @param {import('types').PrerenderMap} prerender_map
 * @param {import('types').Logger} log
 * @param {import('vite').ResolvedConfig} vite_config
 */
export async function adapt(
	config,
	build_data,
	server_metadata,
	prerendered,
	prerender_map,
	log,
	vite_config
) {
	// This is only called when adapter is truthy, so the cast is safe
	const { name, adapt } = /** @type {import('@sveltejs/kit').Adapter} */ (config.kit.adapter);

	console.log(colors.bold().cyan(`\n> Using ${name}`));

	const builder = create_builder({
		config,
		build_data,
		server_metadata,
		route_data: build_data.manifest_data.routes.filter((route) => route.page || route.endpoint),
		prerendered,
		prerender_map,
		log,
		vite_config
	});

	await adapt(builder);

	log.success('done');
}

```


####### packages/kit/src/core/config/default-error.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>%sveltekit.error.message%</title>

		<style>
			body {
				--bg: white;
				--fg: #222;
				--divider: #ccc;
				background: var(--bg);
				color: var(--fg);
				font-family:
					system-ui,
					-apple-system,
					BlinkMacSystemFont,
					'Segoe UI',
					Roboto,
					Oxygen,
					Ubuntu,
					Cantarell,
					'Open Sans',
					'Helvetica Neue',
					sans-serif;
				display: flex;
				align-items: center;
				justify-content: center;
				height: 100vh;
				margin: 0;
			}

			.error {
				display: flex;
				align-items: center;
				max-width: 32rem;
				margin: 0 1rem;
			}

			.status {
				font-weight: 200;
				font-size: 3rem;
				line-height: 1;
				position: relative;
				top: -0.05rem;
			}

			.message {
				border-left: 1px solid var(--divider);
				padding: 0 0 0 1rem;
				margin: 0 0 0 1rem;
				min-height: 2.5rem;
				display: flex;
				align-items: center;
			}

			.message h1 {
				font-weight: 400;
				font-size: 1em;
				margin: 0;
			}

			@media (prefers-color-scheme: dark) {
				body {
					--bg: #222;
					--fg: #ddd;
					--divider: #666;
				}
			}
		</style>
	</head>
	<body>
		<div class="error">
			<span class="status">%sveltekit.status%</span>
			<div class="message">
				<h1>%sveltekit.error.message%</h1>
			</div>
		</div>
	</body>
</html>

```


####### packages/kit/src/core/config/fixtures/default/svelte.config.js #######

```

export default {};

```


####### packages/kit/src/core/config/fixtures/export-string/svelte.config.js #######

```

export default 'invalid';

```


####### packages/kit/src/core/config/index.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import * as url from 'node:url';
import options from './options.js';

/**
 * Loads the template (src/app.html by default) and validates that it has the
 * required content.
 * @param {string} cwd
 * @param {import('types').ValidatedConfig} config
 */
export function load_template(cwd, { kit }) {
	const { env, files } = kit;

	const relative = path.relative(cwd, files.appTemplate);

	if (!fs.existsSync(files.appTemplate)) {
		throw new Error(`${relative} does not exist`);
	}

	const contents = fs.readFileSync(files.appTemplate, 'utf8');

	const expected_tags = ['%sveltekit.head%', '%sveltekit.body%'];
	expected_tags.forEach((tag) => {
		if (contents.indexOf(tag) === -1) {
			throw new Error(`${relative} is missing ${tag}`);
		}
	});

	for (const match of contents.matchAll(/%sveltekit\.env\.([^%]+)%/g)) {
		if (!match[1].startsWith(env.publicPrefix)) {
			throw new Error(
				`Environment variables in ${relative} must start with ${env.publicPrefix} (saw %sveltekit.env.${match[1]}%)`
			);
		}
	}

	return contents;
}

/**
 * Loads the error page (src/error.html by default) if it exists.
 * Falls back to a generic error page content.
 * @param {import('types').ValidatedConfig} config
 */
export function load_error_page(config) {
	let { errorTemplate } = config.kit.files;

	// Don't do this inside resolving the config, because that would mean
	// adding/removing error.html isn't detected and would require a restart.
	if (!fs.existsSync(config.kit.files.errorTemplate)) {
		errorTemplate = url.fileURLToPath(new URL('./default-error.html', import.meta.url));
	}

	return fs.readFileSync(errorTemplate, 'utf-8');
}

/**
 * Loads and validates svelte.config.js
 * @param {{ cwd?: string }} options
 * @returns {Promise<import('types').ValidatedConfig>}
 */
export async function load_config({ cwd = process.cwd() } = {}) {
	const config_file = path.join(cwd, 'svelte.config.js');

	if (!fs.existsSync(config_file)) {
		return process_config({}, { cwd });
	}

	const config = await import(`${url.pathToFileURL(config_file).href}?ts=${Date.now()}`);

	try {
		return process_config(config.default, { cwd });
	} catch (e) {
		const error = /** @type {Error} */ (e);

		// redact the stack trace — it's not helpful to users
		error.stack = `Could not load svelte.config.js: ${error.message}\n`;
		throw error;
	}
}

/**
 * @param {import('@sveltejs/kit').Config} config
 * @returns {import('types').ValidatedConfig}
 */
function process_config(config, { cwd = process.cwd() } = {}) {
	const validated = validate_config(config);

	validated.kit.outDir = path.resolve(cwd, validated.kit.outDir);

	for (const key in validated.kit.files) {
		if (key === 'hooks') {
			validated.kit.files.hooks.client = path.resolve(cwd, validated.kit.files.hooks.client);
			validated.kit.files.hooks.server = path.resolve(cwd, validated.kit.files.hooks.server);
			validated.kit.files.hooks.universal = path.resolve(cwd, validated.kit.files.hooks.universal);
		} else {
			// @ts-expect-error
			validated.kit.files[key] = path.resolve(cwd, validated.kit.files[key]);
		}
	}

	return validated;
}

/**
 * @param {import('@sveltejs/kit').Config} config
 * @returns {import('types').ValidatedConfig}
 */
export function validate_config(config) {
	if (typeof config !== 'object') {
		throw new Error(
			'svelte.config.js must have a configuration object as its default export. See https://kit.svelte.dev/docs/configuration'
		);
	}

	return options(config, 'config');
}

```


####### packages/kit/src/core/config/index.spec.js #######

```

import { join } from 'node:path';
import { fileURLToPath } from 'node:url';
import { assert, expect, test } from 'vitest';
import { validate_config, load_config } from './index.js';

const __filename = fileURLToPath(import.meta.url);
const __dirname = join(__filename, '..');

/**
 * mutates and remove keys from an object when check callback returns true
 * @param {Record<string, any>} o any object
 * @param {([key, value]: [string, any]) => boolean} check callback with access
 * 		to the key-value pair and returns a boolean that decides the deletion of key
 */
function remove_keys(o, check) {
	for (const key in o) {
		if (!Object.hasOwnProperty.call(o, key)) continue;
		if (check([key, o[key]])) delete o[key];
		const nested = typeof o[key] === 'object' && !Array.isArray(o[key]);
		if (nested) remove_keys(o[key], check);
	}
}

const directive_defaults = {
	'child-src': undefined,
	'default-src': undefined,
	'frame-src': undefined,
	'worker-src': undefined,
	'connect-src': undefined,
	'font-src': undefined,
	'img-src': undefined,
	'manifest-src': undefined,
	'media-src': undefined,
	'object-src': undefined,
	'prefetch-src': undefined,
	'script-src': undefined,
	'script-src-elem': undefined,
	'script-src-attr': undefined,
	'style-src': undefined,
	'style-src-elem': undefined,
	'style-src-attr': undefined,
	'base-uri': undefined,
	sandbox: undefined,
	'form-action': undefined,
	'frame-ancestors': undefined,
	'navigate-to': undefined,
	'report-uri': undefined,
	'report-to': undefined,
	'require-trusted-types-for': undefined,
	'trusted-types': undefined,
	'upgrade-insecure-requests': false,
	'require-sri-for': undefined,
	'block-all-mixed-content': false,
	'plugin-types': undefined,
	referrer: undefined
};

const get_defaults = (prefix = '') => ({
	extensions: ['.svelte'],
	kit: {
		adapter: null,
		alias: {},
		appDir: '_app',
		csp: {
			mode: 'auto',
			directives: directive_defaults,
			reportOnly: directive_defaults
		},
		csrf: {
			checkOrigin: true
		},
		embedded: false,
		env: {
			dir: process.cwd(),
			publicPrefix: 'PUBLIC_',
			privatePrefix: ''
		},
		files: {
			assets: join(prefix, 'static'),
			hooks: {
				client: join(prefix, 'src/hooks.client'),
				server: join(prefix, 'src/hooks.server'),
				universal: join(prefix, 'src/hooks')
			},
			lib: join(prefix, 'src/lib'),
			params: join(prefix, 'src/params'),
			routes: join(prefix, 'src/routes'),
			serviceWorker: join(prefix, 'src/service-worker'),
			appTemplate: join(prefix, 'src/app.html'),
			errorTemplate: join(prefix, 'src/error.html')
		},
		inlineStyleThreshold: 0,
		moduleExtensions: ['.js', '.ts'],
		output: { preloadStrategy: 'modulepreload' },
		outDir: join(prefix, '.svelte-kit'),
		serviceWorker: {
			register: true
		},
		typescript: {},
		paths: {
			base: '',
			assets: '',
			relative: true
		},
		prerender: {
			concurrency: 1,
			crawl: true,
			entries: ['*'],
			origin: 'http://sveltekit-prerender'
		},
		version: {
			name: Date.now().toString(),
			pollInterval: 0
		}
	}
});

test('fills in defaults', () => {
	const validated = validate_config({});

	assert.equal(validated.kit.serviceWorker.files(''), true);

	remove_keys(validated, ([, v]) => typeof v === 'function');

	const defaults = get_defaults();
	defaults.kit.version.name = validated.kit.version.name;

	expect(validated).toEqual(defaults);
});

test('errors on invalid values', () => {
	assert.throws(() => {
		validate_config({
			kit: {
				// @ts-expect-error - given value expected to throw
				appDir: 42
			}
		});
	}, /^config\.kit\.appDir should be a string, if specified$/);
});

test('errors on invalid nested values', () => {
	assert.throws(() => {
		validate_config({
			kit: {
				files: {
					// @ts-expect-error - given value expected to throw
					potato: 'blah'
				}
			}
		});
	}, /^Unexpected option config\.kit\.files\.potato$/);
});

test('does not error on invalid top-level values', () => {
	assert.doesNotThrow(() => {
		validate_config({
			onwarn: () => {}
		});
	});
});

test('errors on extension without leading .', () => {
	assert.throws(() => {
		validate_config({
			extensions: ['blah']
		});
	}, /Each member of config\.extensions must start with '\.' — saw 'blah'/);
});

test('fills in partial blanks', () => {
	const validated = validate_config({
		kit: {
			files: {
				assets: 'public'
			},
			version: {
				name: '0'
			}
		}
	});

	assert.equal(validated.kit.serviceWorker.files(''), true);

	remove_keys(validated, ([, v]) => typeof v === 'function');

	const config = get_defaults();
	config.kit.files.assets = 'public';
	config.kit.version.name = '0';

	expect(validated).toEqual(config);
});

test('fails if kit.appDir is blank', () => {
	assert.throws(() => {
		validate_config({
			kit: {
				appDir: ''
			}
		});
	}, /^config\.kit\.appDir cannot be empty$/);
});

test('fails if kit.appDir is only slash', () => {
	assert.throws(() => {
		validate_config({
			kit: {
				appDir: '/'
			}
		});
	}, /^config\.kit\.appDir cannot start or end with '\/'. See https:\/\/kit\.svelte\.dev\/docs\/configuration$/);
});

test('fails if kit.appDir starts with slash', () => {
	assert.throws(() => {
		validate_config({
			kit: {
				appDir: '/_app'
			}
		});
	}, /^config\.kit\.appDir cannot start or end with '\/'. See https:\/\/kit\.svelte\.dev\/docs\/configuration$/);
});

test('fails if kit.appDir ends with slash', () => {
	assert.throws(() => {
		validate_config({
			kit: {
				appDir: '_app/'
			}
		});
	}, /^config\.kit\.appDir cannot start or end with '\/'. See https:\/\/kit\.svelte\.dev\/docs\/configuration$/);
});

test('fails if paths.base is not root-relative', () => {
	assert.throws(() => {
		validate_config({
			kit: {
				paths: {
					// @ts-expect-error
					base: 'https://example.com/somewhere/else'
				}
			}
		});
	}, /^config\.kit\.paths\.base option must either be the empty string or a root-relative path that starts but doesn't end with '\/'. See https:\/\/kit\.svelte\.dev\/docs\/configuration#paths$/);
});

test("fails if paths.base ends with '/'", () => {
	assert.throws(() => {
		validate_config({
			kit: {
				paths: {
					base: '/github-pages/'
				}
			}
		});
	}, /^config\.kit\.paths\.base option must either be the empty string or a root-relative path that starts but doesn't end with '\/'. See https:\/\/kit\.svelte\.dev\/docs\/configuration#paths$/);
});

test('fails if paths.assets is relative', () => {
	assert.throws(() => {
		validate_config({
			kit: {
				paths: {
					// @ts-expect-error
					assets: 'foo'
				}
			}
		});
	}, /^config\.kit\.paths\.assets option must be an absolute path, if specified. See https:\/\/kit\.svelte\.dev\/docs\/configuration#paths$/);
});

test('fails if paths.assets has trailing slash', () => {
	assert.throws(() => {
		validate_config({
			kit: {
				paths: {
					assets: 'https://cdn.example.com/stuff/'
				}
			}
		});
	}, /^config\.kit\.paths\.assets option must not end with '\/'. See https:\/\/kit\.svelte\.dev\/docs\/configuration#paths$/);
});

test('fails if prerender.entries are invalid', () => {
	assert.throws(() => {
		validate_config({
			kit: {
				prerender: {
					// @ts-expect-error - given value expected to throw
					entries: ['foo']
				}
			}
		});
	}, /^Each member of config\.kit.prerender.entries must be either '\*' or an absolute path beginning with '\/' — saw 'foo'$/);
});

/**
 * @param {string} name
 * @param {import('@sveltejs/kit').KitConfig['paths']} input
 * @param {import('@sveltejs/kit').KitConfig['paths']} output
 */
function validate_paths(name, input, output) {
	test(name, () => {
		expect(
			validate_config({
				kit: {
					paths: input
				}
			}).kit.paths
		).toEqual(output);
	});
}

validate_paths(
	'empty assets relative to base path',
	{
		base: '/path/to/base'
	},
	{
		base: '/path/to/base',
		assets: '',
		relative: true
	}
);

validate_paths(
	'external assets',
	{
		assets: 'https://cdn.example.com'
	},
	{
		base: '',
		assets: 'https://cdn.example.com',
		relative: true
	}
);

validate_paths(
	'external assets with base',
	{
		base: '/path/to/base',
		assets: 'https://cdn.example.com'
	},
	{
		base: '/path/to/base',
		assets: 'https://cdn.example.com',
		relative: true
	}
);

test('load default config (esm)', async () => {
	const cwd = join(__dirname, 'fixtures/default');

	const config = await load_config({ cwd });
	remove_keys(config, ([, v]) => typeof v === 'function');

	const defaults = get_defaults(cwd + '/');
	defaults.kit.version.name = config.kit.version.name;

	expect(config).toEqual(defaults);
});

test('errors on loading config with incorrect default export', async () => {
	let message = null;

	try {
		const cwd = join(__dirname, 'fixtures', 'export-string');
		await load_config({ cwd });
	} catch (/** @type {any} */ e) {
		message = e.message;
	}

	assert.equal(
		message,
		'svelte.config.js must have a configuration object as its default export. See https://kit.svelte.dev/docs/configuration'
	);
});

```


####### packages/kit/src/core/config/options.js #######

```

import { join } from 'node:path';

/** @typedef {import('./types.js').Validator} Validator */

const directives = object({
	'child-src': string_array(),
	'default-src': string_array(),
	'frame-src': string_array(),
	'worker-src': string_array(),
	'connect-src': string_array(),
	'font-src': string_array(),
	'img-src': string_array(),
	'manifest-src': string_array(),
	'media-src': string_array(),
	'object-src': string_array(),
	'prefetch-src': string_array(),
	'script-src': string_array(),
	'script-src-elem': string_array(),
	'script-src-attr': string_array(),
	'style-src': string_array(),
	'style-src-elem': string_array(),
	'style-src-attr': string_array(),
	'base-uri': string_array(),
	sandbox: string_array(),
	'form-action': string_array(),
	'frame-ancestors': string_array(),
	'navigate-to': string_array(),
	'report-uri': string_array(),
	'report-to': string_array(),
	'require-trusted-types-for': string_array(),
	'trusted-types': string_array(),
	'upgrade-insecure-requests': boolean(false),
	'require-sri-for': string_array(),
	'block-all-mixed-content': boolean(false),
	'plugin-types': string_array(),
	referrer: string_array()
});

/** @type {Validator} */
const options = object(
	{
		extensions: validate(['.svelte'], (input, keypath) => {
			if (!Array.isArray(input) || !input.every((page) => typeof page === 'string')) {
				throw new Error(`${keypath} must be an array of strings`);
			}

			input.forEach((extension) => {
				if (extension[0] !== '.') {
					throw new Error(`Each member of ${keypath} must start with '.' — saw '${extension}'`);
				}

				if (!/^(\.[a-z0-9]+)+$/i.test(extension)) {
					throw new Error(`File extensions must be alphanumeric — saw '${extension}'`);
				}
			});

			return input;
		}),

		kit: object({
			adapter: validate(null, (input, keypath) => {
				if (typeof input !== 'object' || !input.adapt) {
					let message = `${keypath} should be an object with an "adapt" method`;

					if (Array.isArray(input) || typeof input === 'string') {
						// for the early adapter adopters
						message += ', rather than the name of an adapter';
					}

					throw new Error(`${message}. See https://kit.svelte.dev/docs/adapters`);
				}

				return input;
			}),

			alias: validate({}, (input, keypath) => {
				if (typeof input !== 'object') {
					throw new Error(`${keypath} should be an object`);
				}

				for (const key in input) {
					assert_string(input[key], `${keypath}.${key}`);
				}

				return input;
			}),

			appDir: validate('_app', (input, keypath) => {
				assert_string(input, keypath);

				if (input) {
					if (input.startsWith('/') || input.endsWith('/')) {
						throw new Error(
							"config.kit.appDir cannot start or end with '/'. See https://kit.svelte.dev/docs/configuration"
						);
					}
				} else {
					throw new Error(`${keypath} cannot be empty`);
				}

				return input;
			}),

			csp: object({
				mode: list(['auto', 'hash', 'nonce']),
				directives,
				reportOnly: directives
			}),

			csrf: object({
				checkOrigin: boolean(true)
			}),

			embedded: boolean(false),

			env: object({
				dir: string(process.cwd()),
				publicPrefix: string('PUBLIC_'),
				privatePrefix: string('')
			}),

			files: object({
				assets: string('static'),
				hooks: object({
					client: string(join('src', 'hooks.client')),
					server: string(join('src', 'hooks.server')),
					universal: string(join('src', 'hooks'))
				}),
				lib: string(join('src', 'lib')),
				params: string(join('src', 'params')),
				routes: string(join('src', 'routes')),
				serviceWorker: string(join('src', 'service-worker')),
				appTemplate: string(join('src', 'app.html')),
				errorTemplate: string(join('src', 'error.html'))
			}),

			inlineStyleThreshold: number(0),

			moduleExtensions: string_array(['.js', '.ts']),

			outDir: string('.svelte-kit'),

			output: object({
				preloadStrategy: list(['modulepreload', 'preload-js', 'preload-mjs'], 'modulepreload')
			}),

			paths: object({
				base: validate('', (input, keypath) => {
					assert_string(input, keypath);

					if (input !== '' && (input.endsWith('/') || !input.startsWith('/'))) {
						throw new Error(
							`${keypath} option must either be the empty string or a root-relative path that starts but doesn't end with '/'. See https://kit.svelte.dev/docs/configuration#paths`
						);
					}

					return input;
				}),
				assets: validate('', (input, keypath) => {
					assert_string(input, keypath);

					if (input) {
						if (!/^[a-z]+:\/\//.test(input)) {
							throw new Error(
								`${keypath} option must be an absolute path, if specified. See https://kit.svelte.dev/docs/configuration#paths`
							);
						}

						if (input.endsWith('/')) {
							throw new Error(
								`${keypath} option must not end with '/'. See https://kit.svelte.dev/docs/configuration#paths`
							);
						}
					}

					return input;
				}),
				relative: boolean(true)
			}),

			prerender: object({
				concurrency: number(1),
				crawl: boolean(true),
				entries: validate(['*'], (input, keypath) => {
					if (!Array.isArray(input) || !input.every((page) => typeof page === 'string')) {
						throw new Error(`${keypath} must be an array of strings`);
					}

					input.forEach((page) => {
						if (page !== '*' && page[0] !== '/') {
							throw new Error(
								`Each member of ${keypath} must be either '*' or an absolute path beginning with '/' — saw '${page}'`
							);
						}
					});

					return input;
				}),

				handleHttpError: validate(
					(/** @type {any} */ { message }) => {
						throw new Error(
							message +
								'\nTo suppress or handle this error, implement `handleHttpError` in https://kit.svelte.dev/docs/configuration#prerender'
						);
					},
					(input, keypath) => {
						if (typeof input === 'function') return input;
						if (['fail', 'warn', 'ignore'].includes(input)) return input;
						throw new Error(`${keypath} should be "fail", "warn", "ignore" or a custom function`);
					}
				),

				handleMissingId: validate(
					(/** @type {any} */ { message }) => {
						throw new Error(
							message +
								'\nTo suppress or handle this error, implement `handleMissingId` in https://kit.svelte.dev/docs/configuration#prerender'
						);
					},
					(input, keypath) => {
						if (typeof input === 'function') return input;
						if (['fail', 'warn', 'ignore'].includes(input)) return input;
						throw new Error(`${keypath} should be "fail", "warn", "ignore" or a custom function`);
					}
				),

				handleEntryGeneratorMismatch: validate(
					(/** @type {any} */ { message }) => {
						throw new Error(
							message +
								'\nTo suppress or handle this error, implement `handleEntryGeneratorMismatch` in https://kit.svelte.dev/docs/configuration#prerender'
						);
					},
					(input, keypath) => {
						if (typeof input === 'function') return input;
						if (['fail', 'warn', 'ignore'].includes(input)) return input;
						throw new Error(`${keypath} should be "fail", "warn", "ignore" or a custom function`);
					}
				),

				origin: validate('http://sveltekit-prerender', (input, keypath) => {
					assert_string(input, keypath);

					let origin;

					try {
						origin = new URL(input).origin;
					} catch (e) {
						throw new Error(`${keypath} must be a valid origin`);
					}

					if (input !== origin) {
						throw new Error(`${keypath} must be a valid origin (${origin} rather than ${input})`);
					}

					return origin;
				})
			}),

			serviceWorker: object({
				register: boolean(true),
				files: fun((filename) => !/\.DS_Store/.test(filename))
			}),

			typescript: object({
				config: fun((config) => config)
			}),

			version: object({
				name: string(Date.now().toString()),
				pollInterval: number(0)
			})
		})
	},
	true
);

/**
 * @param {Record<string, Validator>} children
 * @param {boolean} [allow_unknown]
 * @returns {Validator}
 */
function object(children, allow_unknown = false) {
	return (input, keypath) => {
		/** @type {Record<string, any>} */
		const output = {};

		if ((input && typeof input !== 'object') || Array.isArray(input)) {
			throw new Error(`${keypath} should be an object`);
		}

		for (const key in input) {
			if (!(key in children)) {
				if (allow_unknown) {
					output[key] = input[key];
				} else {
					let message = `Unexpected option ${keypath}.${key}`;

					// special case
					if (keypath === 'config.kit' && key in options) {
						message += ` (did you mean config.${key}?)`;
					}

					throw new Error(message);
				}
			}
		}

		for (const key in children) {
			const validator = children[key];
			output[key] = validator(input && input[key], `${keypath}.${key}`);
		}

		return output;
	};
}

/**
 * @param {any} fallback
 * @param {(value: any, keypath: string) => any} fn
 * @returns {Validator}
 */
function validate(fallback, fn) {
	return (input, keypath) => {
		return input === undefined ? fallback : fn(input, keypath);
	};
}

/**
 * @param {string | null} fallback
 * @param {boolean} allow_empty
 * @returns {Validator}
 */
function string(fallback, allow_empty = true) {
	return validate(fallback, (input, keypath) => {
		assert_string(input, keypath);

		if (!allow_empty && input === '') {
			throw new Error(`${keypath} cannot be empty`);
		}

		return input;
	});
}

/**
 * @param {string[] | undefined} [fallback]
 * @returns {Validator}
 */
function string_array(fallback) {
	return validate(fallback, (input, keypath) => {
		if (!Array.isArray(input) || input.some((value) => typeof value !== 'string')) {
			throw new Error(`${keypath} must be an array of strings, if specified`);
		}

		return input;
	});
}

/**
 * @param {number} fallback
 * @returns {Validator}
 */
function number(fallback) {
	return validate(fallback, (input, keypath) => {
		if (typeof input !== 'number') {
			throw new Error(`${keypath} should be a number, if specified`);
		}
		return input;
	});
}

/**
 * @param {boolean} fallback
 * @returns {Validator}
 */
function boolean(fallback) {
	return validate(fallback, (input, keypath) => {
		if (typeof input !== 'boolean') {
			throw new Error(`${keypath} should be true or false, if specified`);
		}
		return input;
	});
}

/**
 * @param {string[]} options
 * @returns {Validator}
 */
function list(options, fallback = options[0]) {
	return validate(fallback, (input, keypath) => {
		if (!options.includes(input)) {
			// prettier-ignore
			const msg = options.length > 2
				? `${keypath} should be one of ${options.slice(0, -1).map(input => `"${input}"`).join(', ')} or "${options[options.length - 1]}"`
				: `${keypath} should be either "${options[0]}" or "${options[1]}"`;

			throw new Error(msg);
		}
		return input;
	});
}

/**
 * @param {(...args: any) => any} fallback
 * @returns {Validator}
 */
function fun(fallback) {
	return validate(fallback, (input, keypath) => {
		if (typeof input !== 'function') {
			throw new Error(`${keypath} should be a function, if specified`);
		}
		return input;
	});
}

/**
 * @param {string} input
 * @param {string} keypath
 */
function assert_string(input, keypath) {
	if (typeof input !== 'string') {
		throw new Error(`${keypath} should be a string, if specified`);
	}
}

export default options;

```


####### packages/kit/src/core/config/types.d.ts #######

```

export type Validator<T = any> = (input: T, keypath: string) => T;

```


####### packages/kit/src/core/env.js #######

```

import { GENERATED_COMMENT } from '../constants.js';
import { dedent } from './sync/utils.js';
import { runtime_base } from './utils.js';

/**
 * @typedef {'public' | 'private'} EnvType
 */

/**
 * @param {string} id
 * @param {Record<string, string>} env
 * @returns {string}
 */
export function create_static_module(id, env) {
	/** @type {string[]} */
	const declarations = [];

	for (const key in env) {
		if (!valid_identifier.test(key) || reserved.has(key)) {
			continue;
		}

		const comment = `/** @type {import('${id}').${key}} */`;
		const declaration = `export const ${key} = ${JSON.stringify(env[key])};`;

		declarations.push(`${comment}\n${declaration}`);
	}

	return GENERATED_COMMENT + declarations.join('\n\n');
}

/**
 * @param {EnvType} type
 * @param {Record<string, string> | undefined} dev_values If in a development mode, values to pre-populate the module with.
 */
export function create_dynamic_module(type, dev_values) {
	if (dev_values) {
		const keys = Object.entries(dev_values).map(
			([k, v]) => `${JSON.stringify(k)}: ${JSON.stringify(v)}`
		);
		return `export const env = {\n${keys.join(',\n')}\n}`;
	}
	return `export { ${type}_env as env } from '${runtime_base}/shared-server.js';`;
}

/**
 * @param {EnvType} id
 * @param {import('types').Env} env
 * @returns {string}
 */
export function create_static_types(id, env) {
	const declarations = Object.keys(env[id])
		.filter((k) => valid_identifier.test(k))
		.map((k) => `export const ${k}: string;`);

	return dedent`
		declare module '$env/static/${id}' {
			${declarations.join('\n')}
		}
	`;
}

/**
 * @param {EnvType} id
 * @param {import('types').Env} env
 * @param {{
 * 	public_prefix: string;
 * 	private_prefix: string;
 * }} prefixes
 * @returns {string}
 */
export function create_dynamic_types(id, env, { public_prefix, private_prefix }) {
	const properties = Object.keys(env[id])
		.filter((k) => valid_identifier.test(k))
		.map((k) => `${k}: string;`);

	const public_prefixed = `[key: \`${public_prefix}\${string}\`]`;
	const private_prefixed = `[key: \`${private_prefix}\${string}\`]`;

	if (id === 'private') {
		if (public_prefix) {
			properties.push(`${public_prefixed}: undefined;`);
		}
		properties.push(`${private_prefixed}: string | undefined;`);
	} else {
		if (private_prefix) {
			properties.push(`${private_prefixed}: undefined;`);
		}
		properties.push(`${public_prefixed}: string | undefined;`);
	}

	return dedent`
		declare module '$env/dynamic/${id}' {
			export const env: {
				${properties.join('\n')}
			}
		}
	`;
}

export const reserved = new Set([
	'do',
	'if',
	'in',
	'for',
	'let',
	'new',
	'try',
	'var',
	'case',
	'else',
	'enum',
	'eval',
	'null',
	'this',
	'true',
	'void',
	'with',
	'await',
	'break',
	'catch',
	'class',
	'const',
	'false',
	'super',
	'throw',
	'while',
	'yield',
	'delete',
	'export',
	'import',
	'public',
	'return',
	'static',
	'switch',
	'typeof',
	'default',
	'extends',
	'finally',
	'package',
	'private',
	'continue',
	'debugger',
	'function',
	'arguments',
	'interface',
	'protected',
	'implements',
	'instanceof'
]);

export const valid_identifier = /^[a-zA-Z_$][a-zA-Z0-9_$]*$/;

```


####### packages/kit/src/core/generate_manifest/find_server_assets.js #######

```

import { find_deps } from '../../exports/vite/build/utils.js';

/**
 * Finds all the assets that are imported by server files associated with `routes`
 * @param {import('types').BuildData} build_data
 * @param {import('types').RouteData[]} routes
 */
export function find_server_assets(build_data, routes) {
	/**
	 * All nodes actually used in the routes definition (prerendered routes are omitted).
	 * Root layout/error is always included as they are needed for 404 and root errors.
	 * @type {Set<any>}
	 */
	const used_nodes = new Set([0, 1]);

	// TODO add hooks.server.js asset imports
	/** @type {Set<string>} */
	const server_assets = new Set();

	/** @param {string} id */
	function add_assets(id) {
		if (id in build_data.server_manifest) {
			const deps = find_deps(build_data.server_manifest, id, false);
			for (const asset of deps.assets) {
				server_assets.add(asset);
			}
		}
	}

	for (const route of routes) {
		if (route.page) {
			for (const i of route.page.layouts) used_nodes.add(i);
			for (const i of route.page.errors) used_nodes.add(i);
			used_nodes.add(route.page.leaf);
		}

		if (route.endpoint) {
			add_assets(route.endpoint.file);
		}
	}

	for (const n of used_nodes) {
		const node = build_data.manifest_data.nodes[n];
		if (node?.server) add_assets(node.server);
	}

	if (build_data.manifest_data.hooks.server) {
		add_assets(build_data.manifest_data.hooks.server);
	}

	return Array.from(server_assets);
}

```


####### packages/kit/src/core/generate_manifest/index.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import * as mime from 'mrmime';
import { s } from '../../utils/misc.js';
import { get_mime_lookup } from '../utils.js';
import { resolve_symlinks } from '../../exports/vite/build/utils.js';
import { compact } from '../../utils/array.js';
import { join_relative } from '../../utils/filesystem.js';
import { dedent } from '../sync/utils.js';
import { find_server_assets } from './find_server_assets.js';

/**
 * Generates the data used to write the server-side manifest.js file. This data is used in the Vite
 * build process, to power routing, etc.
 * @param {{
 *   build_data: import('types').BuildData;
 *   relative_path: string;
 *   routes: import('types').RouteData[];
 * }} opts
 */
export function generate_manifest({ build_data, relative_path, routes }) {
	/**
	 * @type {Map<any, number>} The new index of each node in the filtered nodes array
	 */
	const reindexed = new Map();
	/**
	 * All nodes actually used in the routes definition (prerendered routes are omitted).
	 * Root layout/error is always included as they are needed for 404 and root errors.
	 * @type {Set<any>}
	 */
	const used_nodes = new Set([0, 1]);

	const server_assets = find_server_assets(build_data, routes);

	for (const route of routes) {
		if (route.page) {
			for (const i of route.page.layouts) used_nodes.add(i);
			for (const i of route.page.errors) used_nodes.add(i);
			used_nodes.add(route.page.leaf);
		}
	}

	const node_paths = compact(
		build_data.manifest_data.nodes.map((_, i) => {
			if (used_nodes.has(i)) {
				reindexed.set(i, reindexed.size);
				return join_relative(relative_path, `/nodes/${i}.js`);
			}
		})
	);

	/** @type {(path: string) => string} */
	const loader = (path) => `__memo(() => import('${path}'))`;

	const assets = build_data.manifest_data.assets.map((asset) => asset.file);
	if (build_data.service_worker) {
		assets.push(build_data.service_worker);
	}

	const matchers = new Set();

	/** @param {Array<number | undefined>} indexes */
	function get_nodes(indexes) {
		const string = indexes.map((n) => reindexed.get(n) ?? '').join(',');

		// since JavaScript ignores trailing commas, we need to insert a dummy
		// comma so that the array has the correct length if the last item
		// is undefined
		return `[${string},]`;
	}

	const mime_types = get_mime_lookup(build_data.manifest_data);

	/** @type {Record<string, number>} */
	const files = {};
	for (const file of server_assets) {
		files[file] = fs.statSync(path.resolve(build_data.out_dir, 'server', file)).size;

		const ext = path.extname(file);
		mime_types[ext] ??= mime.lookup(ext) || '';
	}

	// prettier-ignore
	// String representation of
	/** @template {import('@sveltejs/kit').SSRManifest} T */
	const manifest_expr = dedent`
		{
			appDir: ${s(build_data.app_dir)},
			appPath: ${s(build_data.app_path)},
			assets: new Set(${s(assets)}),
			mimeTypes: ${s(mime_types)},
			_: {
				client: ${s(build_data.client)},
				nodes: [
					${(node_paths).map(loader).join(',\n')}
				],
				routes: [
					${routes.map(route => {
						if (!route.page && !route.endpoint) return;

						route.params.forEach(param => {
							if (param.matcher) matchers.add(param.matcher);
						});

						return dedent`
							{
								id: ${s(route.id)},
								pattern: ${route.pattern},
								params: ${s(route.params)},
								page: ${route.page ? `{ layouts: ${get_nodes(route.page.layouts)}, errors: ${get_nodes(route.page.errors)}, leaf: ${reindexed.get(route.page.leaf)} }` : 'null'},
								endpoint: ${route.endpoint ? loader(join_relative(relative_path, resolve_symlinks(build_data.server_manifest, route.endpoint.file).chunk.file)) : 'null'}
							}
						`;
					}).filter(Boolean).join(',\n')}
				],
				matchers: async () => {
					${Array.from(
						matchers,
						type => `const { match: ${type} } = await import ('${(join_relative(relative_path, `/entries/matchers/${type}.js`))}')`
					).join('\n')}
					return { ${Array.from(matchers).join(', ')} };
				},
				server_assets: ${s(files)}
			}
		}
	`;

	// Memoize the loaders to prevent Node from doing unnecessary work
	// on every dynamic import call
	return dedent`
		(() => {
		function __memo(fn) {
			let value;
			return () => value ??= (value = fn());
		}

		return ${manifest_expr}
		})()
	`;
}

```


####### packages/kit/src/core/postbuild/analyse.js #######

```

import { join } from 'node:path';
import { pathToFileURL } from 'node:url';
import { get_option } from '../../utils/options.js';
import {
	validate_layout_exports,
	validate_layout_server_exports,
	validate_page_exports,
	validate_page_server_exports,
	validate_server_exports
} from '../../utils/exports.js';
import { load_config } from '../config/index.js';
import { forked } from '../../utils/fork.js';
import { installPolyfills } from '../../exports/node/polyfills.js';
import { ENDPOINT_METHODS } from '../../constants.js';
import { filter_private_env, filter_public_env } from '../../utils/env.js';
import { resolve_route } from '../../utils/routing.js';
import { get_page_config } from '../../utils/route_config.js';
import { check_feature } from '../../utils/features.js';
import { createReadableStream } from '@sveltejs/kit/node';

export default forked(import.meta.url, analyse);

/**
 * @param {{
 *   manifest_path: string;
 *   manifest_data: import('types').ManifestData;
 *   server_manifest: import('vite').Manifest;
 *   tracked_features: Record<string, string[]>;
 *   env: Record<string, string>
 * }} opts
 */
async function analyse({ manifest_path, manifest_data, server_manifest, tracked_features, env }) {
	/** @type {import('@sveltejs/kit').SSRManifest} */
	const manifest = (await import(pathToFileURL(manifest_path).href)).manifest;

	/** @type {import('types').ValidatedKitConfig} */
	const config = (await load_config()).kit;

	const server_root = join(config.outDir, 'output');

	/** @type {import('types').ServerInternalModule} */
	const internal = await import(pathToFileURL(`${server_root}/server/internal.js`).href);

	installPolyfills();

	// configure `import { building } from '$app/environment'` —
	// essential we do this before analysing the code
	internal.set_building();

	// set env, in case it's used in initialisation
	const { publicPrefix: public_prefix, privatePrefix: private_prefix } = config.env;
	const private_env = filter_private_env(env, { public_prefix, private_prefix });
	const public_env = filter_public_env(env, { public_prefix, private_prefix });
	internal.set_private_env(private_env);
	internal.set_public_env(public_env);
	internal.set_safe_public_env(public_env);
	internal.set_manifest(manifest);
	internal.set_read_implementation((file) => createReadableStream(`${server_root}/server/${file}`));

	/** @type {import('types').ServerMetadata} */
	const metadata = {
		nodes: [],
		routes: new Map()
	};

	const nodes = await Promise.all(manifest._.nodes.map((loader) => loader()));

	// analyse nodes
	for (const node of nodes) {
		metadata.nodes[node.index] = {
			has_server_load: node.server?.load !== undefined || node.server?.trailingSlash !== undefined
		};
	}

	// analyse routes
	for (const route of manifest._.routes) {
		const page =
			route.page &&
			analyse_page(
				route.page.layouts.map((n) => (n === undefined ? n : nodes[n])),
				nodes[route.page.leaf]
			);

		const endpoint = route.endpoint && analyse_endpoint(route, await route.endpoint());

		if (page?.prerender && endpoint?.prerender) {
			throw new Error(`Cannot prerender a route with both +page and +server files (${route.id})`);
		}

		if (page?.config && endpoint?.config) {
			for (const key in { ...page.config, ...endpoint.config }) {
				if (JSON.stringify(page.config[key]) !== JSON.stringify(endpoint.config[key])) {
					throw new Error(
						`Mismatched route config for ${route.id} — the +page and +server files must export the same config, if any`
					);
				}
			}
		}

		const route_config = page?.config ?? endpoint?.config ?? {};
		const prerender = page?.prerender ?? endpoint?.prerender;

		if (prerender !== true) {
			for (const feature of list_features(
				route,
				manifest_data,
				server_manifest,
				tracked_features
			)) {
				check_feature(route.id, route_config, feature, config.adapter);
			}
		}

		const page_methods = page?.methods ?? [];
		const api_methods = endpoint?.methods ?? [];
		const entries = page?.entries ?? endpoint?.entries;

		metadata.routes.set(route.id, {
			config: route_config,
			methods: Array.from(new Set([...page_methods, ...api_methods])),
			page: {
				methods: page_methods
			},
			api: {
				methods: api_methods
			},
			prerender,
			entries:
				entries && (await entries()).map((entry_object) => resolve_route(route.id, entry_object))
		});
	}

	return metadata;
}

/**
 * @param {import('types').SSRRoute} route
 * @param {import('types').SSREndpoint} mod
 */
function analyse_endpoint(route, mod) {
	validate_server_exports(mod, route.id);

	if (mod.prerender && (mod.POST || mod.PATCH || mod.PUT || mod.DELETE)) {
		throw new Error(
			`Cannot prerender a +server file with POST, PATCH, PUT, or DELETE (${route.id})`
		);
	}

	/** @type {Array<import('types').HttpMethod | '*'>} */
	const methods = [];

	for (const method of /** @type {import('types').HttpMethod[]} */ (ENDPOINT_METHODS)) {
		if (mod[method]) methods.push(method);
	}

	if (mod.fallback) {
		methods.push('*');
	}

	return {
		config: mod.config,
		entries: mod.entries,
		methods,
		prerender: mod.prerender ?? false
	};
}

/**
 * @param {Array<import('types').SSRNode | undefined>} layouts
 * @param {import('types').SSRNode} leaf
 */
function analyse_page(layouts, leaf) {
	for (const layout of layouts) {
		if (layout) {
			validate_layout_server_exports(layout.server, layout.server_id);
			validate_layout_exports(layout.universal, layout.universal_id);
		}
	}

	/** @type {Array<'GET' | 'POST'>} */
	const methods = ['GET'];
	if (leaf.server?.actions) methods.push('POST');

	validate_page_server_exports(leaf.server, leaf.server_id);
	validate_page_exports(leaf.universal, leaf.universal_id);

	return {
		config: get_page_config([...layouts, leaf]),
		entries: leaf.universal?.entries ?? leaf.server?.entries,
		methods,
		prerender: get_option([...layouts, leaf], 'prerender') ?? false
	};
}

/**
 * @param {import('types').SSRRoute} route
 * @param {import('types').ManifestData} manifest_data
 * @param {import('vite').Manifest} server_manifest
 * @param {Record<string, string[]>} tracked_features
 */
function list_features(route, manifest_data, server_manifest, tracked_features) {
	const features = new Set();

	const route_data = /** @type {import('types').RouteData} */ (
		manifest_data.routes.find((r) => r.id === route.id)
	);

	/** @param {string} id */
	function visit(id) {
		const chunk = server_manifest[id];
		if (!chunk) return;

		if (chunk.file in tracked_features) {
			for (const feature of tracked_features[chunk.file]) {
				features.add(feature);
			}
		}

		if (chunk.imports) {
			for (const id of chunk.imports) {
				visit(id);
			}
		}
	}

	let page_node = route_data?.leaf;
	while (page_node) {
		if (page_node.server) visit(page_node.server);
		page_node = page_node.parent ?? null;
	}

	if (route_data.endpoint) {
		visit(route_data.endpoint.file);
	}

	if (manifest_data.hooks.server) {
		// TODO if hooks.server.js imports `read`, it will be in the entry chunk
		// we don't currently account for that case
		visit(manifest_data.hooks.server);
	}

	return Array.from(features);
}

```


####### packages/kit/src/core/postbuild/crawl.js #######

```

import { resolve } from '../../utils/url.js';
import { decode } from './entities.js';

const DOCTYPE = 'DOCTYPE';
const CDATA_OPEN = '[CDATA[';
const CDATA_CLOSE = ']]>';
const COMMENT_OPEN = '--';
const COMMENT_CLOSE = '-->';

const TAG_OPEN = /[a-zA-Z]/;
const TAG_CHAR = /[a-zA-Z0-9]/;
const ATTRIBUTE_NAME = /[^\t\n\f />"'=]/;

const WHITESPACE = /[\s\n\r]/;

const CRAWLABLE_META_NAME_ATTRS = new Set([
	'og:url',
	'og:image',
	'og:image:url',
	'og:image:secure_url',
	'og:video',
	'og:video:url',
	'og:video:secure_url',
	'og:audio',
	'og:audio:url',
	'og:audio:secure_url',
	'twitter:image'
]);

/**
 * @param {string} html
 * @param {string} base
 */
export function crawl(html, base) {
	/** @type {string[]} */
	const ids = [];

	/** @type {string[]} */
	const hrefs = [];

	let i = 0;
	main: while (i < html.length) {
		const char = html[i];

		if (char === '<') {
			if (html[i + 1] === '!') {
				i += 2;

				if (html.slice(i, i + DOCTYPE.length).toUpperCase() === DOCTYPE) {
					i += DOCTYPE.length;
					while (i < html.length) {
						if (html[i++] === '>') {
							continue main;
						}
					}
				}

				// skip cdata
				if (html.slice(i, i + CDATA_OPEN.length) === CDATA_OPEN) {
					i += CDATA_OPEN.length;
					while (i < html.length) {
						if (html.slice(i, i + CDATA_CLOSE.length) === CDATA_CLOSE) {
							i += CDATA_CLOSE.length;
							continue main;
						}

						i += 1;
					}
				}

				// skip comments
				if (html.slice(i, i + COMMENT_OPEN.length) === COMMENT_OPEN) {
					i += COMMENT_OPEN.length;
					while (i < html.length) {
						if (html.slice(i, i + COMMENT_CLOSE.length) === COMMENT_CLOSE) {
							i += COMMENT_CLOSE.length;
							continue main;
						}

						i += 1;
					}
				}
			}

			// parse opening tags
			const start = ++i;
			if (TAG_OPEN.test(html[start])) {
				while (i < html.length) {
					if (!TAG_CHAR.test(html[i])) {
						break;
					}

					i += 1;
				}

				const tag = html.slice(start, i).toUpperCase();

				/** @type {Record<string, string>} */
				const attributes = {};

				if (tag === 'SCRIPT' || tag === 'STYLE') {
					while (i < html.length) {
						if (
							html[i] === '<' &&
							html[i + 1] === '/' &&
							html.slice(i + 2, i + 2 + tag.length).toUpperCase() === tag
						) {
							continue main;
						}

						i += 1;
					}
				}

				while (i < html.length) {
					const start = i;

					const char = html[start];
					if (char === '>') break;

					if (ATTRIBUTE_NAME.test(char)) {
						i += 1;

						while (i < html.length) {
							if (!ATTRIBUTE_NAME.test(html[i])) {
								break;
							}

							i += 1;
						}

						const name = html.slice(start, i).toLowerCase();

						while (WHITESPACE.test(html[i])) i += 1;

						if (html[i] === '=') {
							i += 1;
							while (WHITESPACE.test(html[i])) i += 1;

							let value;

							if (html[i] === "'" || html[i] === '"') {
								const quote = html[i++];

								const start = i;
								let escaped = false;

								while (i < html.length) {
									if (escaped) {
										escaped = false;
									} else {
										const char = html[i];

										if (html[i] === quote) {
											break;
										}

										if (char === '\\') {
											escaped = true;
										}
									}

									i += 1;
								}

								value = html.slice(start, i);
							} else {
								const start = i;
								while (html[i] !== '>' && !WHITESPACE.test(html[i])) i += 1;
								value = html.slice(start, i);

								i -= 1;
							}

							value = decode(value);
							attributes[name] = value;
						} else {
							i -= 1;
						}
					}

					i += 1;
				}

				const { href, id, name, property, rel, src, srcset, content } = attributes;

				if (href) {
					if (tag === 'BASE') {
						base = resolve(base, href);
					} else if (!rel || !/\bexternal\b/i.test(rel)) {
						hrefs.push(resolve(base, href));
					}
				}

				if (id) {
					ids.push(id);
				}

				if (name && tag === 'A') {
					ids.push(name);
				}

				if (src) {
					hrefs.push(resolve(base, src));
				}

				if (srcset) {
					let value = srcset;
					const candidates = [];
					let insideURL = true;
					value = value.trim();
					for (let i = 0; i < value.length; i++) {
						if (value[i] === ',' && (!insideURL || (insideURL && WHITESPACE.test(value[i + 1])))) {
							candidates.push(value.slice(0, i));
							value = value.substring(i + 1).trim();
							i = 0;
							insideURL = true;
						} else if (WHITESPACE.test(value[i])) {
							insideURL = false;
						}
					}
					candidates.push(value);
					for (const candidate of candidates) {
						const src = candidate.split(WHITESPACE)[0];
						if (src) hrefs.push(resolve(base, src));
					}
				}

				if (tag === 'META' && content) {
					const attr = name ?? property;

					if (attr && CRAWLABLE_META_NAME_ATTRS.has(attr)) {
						hrefs.push(resolve(base, content));
					}
				}
			}
		}

		i += 1;
	}

	return { ids, hrefs };
}

```


####### packages/kit/src/core/postbuild/crawl.spec.js #######

```

import fs from 'node:fs';
import { fileURLToPath } from 'node:url';
import { expect, test } from 'vitest';
import { crawl } from './crawl.js';

const fixtures = fileURLToPath(new URL('./fixtures', import.meta.url));

for (const fixture of fs.readdirSync(fixtures)) {
	test(fixture, () => {
		const input = fs.readFileSync(`${fixtures}/${fixture}/input.html`, 'utf8');
		const expected = JSON.parse(fs.readFileSync(`${fixtures}/${fixture}/output.json`, 'utf8'));

		// const start = Date.now();

		const output = crawl(input, '/');

		// uncomment to see how long it took
		// console.error(fixture, Date.now() - start);

		expect(output).toEqual(expected);
	});
}

```


####### packages/kit/src/core/postbuild/entities.js #######

```

/**
 * A list of all named HTML entities, from https://html.spec.whatwg.org/multipage/named-characters.html
 * @type {Record<string, string>}
 */
const entities = {
	AElig: 'Æ',
	'AElig;': 'Æ',
	AMP: '&',
	'AMP;': '&',
	Aacute: 'Á',
	'Aacute;': 'Á',
	'Abreve;': 'Ă',
	Acirc: 'Â',
	'Acirc;': 'Â',
	'Acy;': 'А',
	'Afr;': '𝔄',
	Agrave: 'À',
	'Agrave;': 'À',
	'Alpha;': 'Α',
	'Amacr;': 'Ā',
	'And;': '⩓',
	'Aogon;': 'Ą',
	'Aopf;': '𝔸',
	'ApplyFunction;': '⁡',
	Aring: 'Å',
	'Aring;': 'Å',
	'Ascr;': '𝒜',
	'Assign;': '≔',
	Atilde: 'Ã',
	'Atilde;': 'Ã',
	Auml: 'Ä',
	'Auml;': 'Ä',
	'Backslash;': '∖',
	'Barv;': '⫧',
	'Barwed;': '⌆',
	'Bcy;': 'Б',
	'Because;': '∵',
	'Bernoullis;': 'ℬ',
	'Beta;': 'Β',
	'Bfr;': '𝔅',
	'Bopf;': '𝔹',
	'Breve;': '˘',
	'Bscr;': 'ℬ',
	'Bumpeq;': '≎',
	'CHcy;': 'Ч',
	COPY: '©',
	'COPY;': '©',
	'Cacute;': 'Ć',
	'Cap;': '⋒',
	'CapitalDifferentialD;': 'ⅅ',
	'Cayleys;': 'ℭ',
	'Ccaron;': 'Č',
	Ccedil: 'Ç',
	'Ccedil;': 'Ç',
	'Ccirc;': 'Ĉ',
	'Cconint;': '∰',
	'Cdot;': 'Ċ',
	'Cedilla;': '¸',
	'CenterDot;': '·',
	'Cfr;': 'ℭ',
	'Chi;': 'Χ',
	'CircleDot;': '⊙',
	'CircleMinus;': '⊖',
	'CirclePlus;': '⊕',
	'CircleTimes;': '⊗',
	'ClockwiseContourIntegral;': '∲',
	'CloseCurlyDoubleQuote;': '”',
	'CloseCurlyQuote;': '’',
	'Colon;': '∷',
	'Colone;': '⩴',
	'Congruent;': '≡',
	'Conint;': '∯',
	'ContourIntegral;': '∮',
	'Copf;': 'ℂ',
	'Coproduct;': '∐',
	'CounterClockwiseContourIntegral;': '∳',
	'Cross;': '⨯',
	'Cscr;': '𝒞',
	'Cup;': '⋓',
	'CupCap;': '≍',
	'DD;': 'ⅅ',
	'DDotrahd;': '⤑',
	'DJcy;': 'Ђ',
	'DScy;': 'Ѕ',
	'DZcy;': 'Џ',
	'Dagger;': '‡',
	'Darr;': '↡',
	'Dashv;': '⫤',
	'Dcaron;': 'Ď',
	'Dcy;': 'Д',
	'Del;': '∇',
	'Delta;': 'Δ',
	'Dfr;': '𝔇',
	'DiacriticalAcute;': '´',
	'DiacriticalDot;': '˙',
	'DiacriticalDoubleAcute;': '˝',
	'DiacriticalGrave;': '`',
	'DiacriticalTilde;': '˜',
	'Diamond;': '⋄',
	'DifferentialD;': 'ⅆ',
	'Dopf;': '𝔻',
	'Dot;': '¨',
	'DotDot;': '⃜',
	'DotEqual;': '≐',
	'DoubleContourIntegral;': '∯',
	'DoubleDot;': '¨',
	'DoubleDownArrow;': '⇓',
	'DoubleLeftArrow;': '⇐',
	'DoubleLeftRightArrow;': '⇔',
	'DoubleLeftTee;': '⫤',
	'DoubleLongLeftArrow;': '⟸',
	'DoubleLongLeftRightArrow;': '⟺',
	'DoubleLongRightArrow;': '⟹',
	'DoubleRightArrow;': '⇒',
	'DoubleRightTee;': '⊨',
	'DoubleUpArrow;': '⇑',
	'DoubleUpDownArrow;': '⇕',
	'DoubleVerticalBar;': '∥',
	'DownArrow;': '↓',
	'DownArrowBar;': '⤓',
	'DownArrowUpArrow;': '⇵',
	'DownBreve;': '̑',
	'DownLeftRightVector;': '⥐',
	'DownLeftTeeVector;': '⥞',
	'DownLeftVector;': '↽',
	'DownLeftVectorBar;': '⥖',
	'DownRightTeeVector;': '⥟',
	'DownRightVector;': '⇁',
	'DownRightVectorBar;': '⥗',
	'DownTee;': '⊤',
	'DownTeeArrow;': '↧',
	'Downarrow;': '⇓',
	'Dscr;': '𝒟',
	'Dstrok;': 'Đ',
	'ENG;': 'Ŋ',
	ETH: 'Ð',
	'ETH;': 'Ð',
	Eacute: 'É',
	'Eacute;': 'É',
	'Ecaron;': 'Ě',
	Ecirc: 'Ê',
	'Ecirc;': 'Ê',
	'Ecy;': 'Э',
	'Edot;': 'Ė',
	'Efr;': '𝔈',
	Egrave: 'È',
	'Egrave;': 'È',
	'Element;': '∈',
	'Emacr;': 'Ē',
	'EmptySmallSquare;': '◻',
	'EmptyVerySmallSquare;': '▫',
	'Eogon;': 'Ę',
	'Eopf;': '𝔼',
	'Epsilon;': 'Ε',
	'Equal;': '⩵',
	'EqualTilde;': '≂',
	'Equilibrium;': '⇌',
	'Escr;': 'ℰ',
	'Esim;': '⩳',
	'Eta;': 'Η',
	Euml: 'Ë',
	'Euml;': 'Ë',
	'Exists;': '∃',
	'ExponentialE;': 'ⅇ',
	'Fcy;': 'Ф',
	'Ffr;': '𝔉',
	'FilledSmallSquare;': '◼',
	'FilledVerySmallSquare;': '▪',
	'Fopf;': '𝔽',
	'ForAll;': '∀',
	'Fouriertrf;': 'ℱ',
	'Fscr;': 'ℱ',
	'GJcy;': 'Ѓ',
	GT: '>',
	'GT;': '>',
	'Gamma;': 'Γ',
	'Gammad;': 'Ϝ',
	'Gbreve;': 'Ğ',
	'Gcedil;': 'Ģ',
	'Gcirc;': 'Ĝ',
	'Gcy;': 'Г',
	'Gdot;': 'Ġ',
	'Gfr;': '𝔊',
	'Gg;': '⋙',
	'Gopf;': '𝔾',
	'GreaterEqual;': '≥',
	'GreaterEqualLess;': '⋛',
	'GreaterFullEqual;': '≧',
	'GreaterGreater;': '⪢',
	'GreaterLess;': '≷',
	'GreaterSlantEqual;': '⩾',
	'GreaterTilde;': '≳',
	'Gscr;': '𝒢',
	'Gt;': '≫',
	'HARDcy;': 'Ъ',
	'Hacek;': 'ˇ',
	'Hat;': '^',
	'Hcirc;': 'Ĥ',
	'Hfr;': 'ℌ',
	'HilbertSpace;': 'ℋ',
	'Hopf;': 'ℍ',
	'HorizontalLine;': '─',
	'Hscr;': 'ℋ',
	'Hstrok;': 'Ħ',
	'HumpDownHump;': '≎',
	'HumpEqual;': '≏',
	'IEcy;': 'Е',
	'IJlig;': 'Ĳ',
	'IOcy;': 'Ё',
	Iacute: 'Í',
	'Iacute;': 'Í',
	Icirc: 'Î',
	'Icirc;': 'Î',
	'Icy;': 'И',
	'Idot;': 'İ',
	'Ifr;': 'ℑ',
	Igrave: 'Ì',
	'Igrave;': 'Ì',
	'Im;': 'ℑ',
	'Imacr;': 'Ī',
	'ImaginaryI;': 'ⅈ',
	'Implies;': '⇒',
	'Int;': '∬',
	'Integral;': '∫',
	'Intersection;': '⋂',
	'InvisibleComma;': '⁣',
	'InvisibleTimes;': '⁢',
	'Iogon;': 'Į',
	'Iopf;': '𝕀',
	'Iota;': 'Ι',
	'Iscr;': 'ℐ',
	'Itilde;': 'Ĩ',
	'Iukcy;': 'І',
	Iuml: 'Ï',
	'Iuml;': 'Ï',
	'Jcirc;': 'Ĵ',
	'Jcy;': 'Й',
	'Jfr;': '𝔍',
	'Jopf;': '𝕁',
	'Jscr;': '𝒥',
	'Jsercy;': 'Ј',
	'Jukcy;': 'Є',
	'KHcy;': 'Х',
	'KJcy;': 'Ќ',
	'Kappa;': 'Κ',
	'Kcedil;': 'Ķ',
	'Kcy;': 'К',
	'Kfr;': '𝔎',
	'Kopf;': '𝕂',
	'Kscr;': '𝒦',
	'LJcy;': 'Љ',
	LT: '<',
	'LT;': '<',
	'Lacute;': 'Ĺ',
	'Lambda;': 'Λ',
	'Lang;': '⟪',
	'Laplacetrf;': 'ℒ',
	'Larr;': '↞',
	'Lcaron;': 'Ľ',
	'Lcedil;': 'Ļ',
	'Lcy;': 'Л',
	'LeftAngleBracket;': '⟨',
	'LeftArrow;': '←',
	'LeftArrowBar;': '⇤',
	'LeftArrowRightArrow;': '⇆',
	'LeftCeiling;': '⌈',
	'LeftDoubleBracket;': '⟦',
	'LeftDownTeeVector;': '⥡',
	'LeftDownVector;': '⇃',
	'LeftDownVectorBar;': '⥙',
	'LeftFloor;': '⌊',
	'LeftRightArrow;': '↔',
	'LeftRightVector;': '⥎',
	'LeftTee;': '⊣',
	'LeftTeeArrow;': '↤',
	'LeftTeeVector;': '⥚',
	'LeftTriangle;': '⊲',
	'LeftTriangleBar;': '⧏',
	'LeftTriangleEqual;': '⊴',
	'LeftUpDownVector;': '⥑',
	'LeftUpTeeVector;': '⥠',
	'LeftUpVector;': '↿',
	'LeftUpVectorBar;': '⥘',
	'LeftVector;': '↼',
	'LeftVectorBar;': '⥒',
	'Leftarrow;': '⇐',
	'Leftrightarrow;': '⇔',
	'LessEqualGreater;': '⋚',
	'LessFullEqual;': '≦',
	'LessGreater;': '≶',
	'LessLess;': '⪡',
	'LessSlantEqual;': '⩽',
	'LessTilde;': '≲',
	'Lfr;': '𝔏',
	'Ll;': '⋘',
	'Lleftarrow;': '⇚',
	'Lmidot;': 'Ŀ',
	'LongLeftArrow;': '⟵',
	'LongLeftRightArrow;': '⟷',
	'LongRightArrow;': '⟶',
	'Longleftarrow;': '⟸',
	'Longleftrightarrow;': '⟺',
	'Longrightarrow;': '⟹',
	'Lopf;': '𝕃',
	'LowerLeftArrow;': '↙',
	'LowerRightArrow;': '↘',
	'Lscr;': 'ℒ',
	'Lsh;': '↰',
	'Lstrok;': 'Ł',
	'Lt;': '≪',
	'Map;': '⤅',
	'Mcy;': 'М',
	'MediumSpace;': ' ',
	'Mellintrf;': 'ℳ',
	'Mfr;': '𝔐',
	'MinusPlus;': '∓',
	'Mopf;': '𝕄',
	'Mscr;': 'ℳ',
	'Mu;': 'Μ',
	'NJcy;': 'Њ',
	'Nacute;': 'Ń',
	'Ncaron;': 'Ň',
	'Ncedil;': 'Ņ',
	'Ncy;': 'Н',
	'NegativeMediumSpace;': '​',
	'NegativeThickSpace;': '​',
	'NegativeThinSpace;': '​',
	'NegativeVeryThinSpace;': '​',
	'NestedGreaterGreater;': '≫',
	'NestedLessLess;': '≪',
	'NewLine;': '\n',
	'Nfr;': '𝔑',
	'NoBreak;': '⁠',
	'NonBreakingSpace;': ' ',
	'Nopf;': 'ℕ',
	'Not;': '⫬',
	'NotCongruent;': '≢',
	'NotCupCap;': '≭',
	'NotDoubleVerticalBar;': '∦',
	'NotElement;': '∉',
	'NotEqual;': '≠',
	'NotEqualTilde;': '≂̸',
	'NotExists;': '∄',
	'NotGreater;': '≯',
	'NotGreaterEqual;': '≱',
	'NotGreaterFullEqual;': '≧̸',
	'NotGreaterGreater;': '≫̸',
	'NotGreaterLess;': '≹',
	'NotGreaterSlantEqual;': '⩾̸',
	'NotGreaterTilde;': '≵',
	'NotHumpDownHump;': '≎̸',
	'NotHumpEqual;': '≏̸',
	'NotLeftTriangle;': '⋪',
	'NotLeftTriangleBar;': '⧏̸',
	'NotLeftTriangleEqual;': '⋬',
	'NotLess;': '≮',
	'NotLessEqual;': '≰',
	'NotLessGreater;': '≸',
	'NotLessLess;': '≪̸',
	'NotLessSlantEqual;': '⩽̸',
	'NotLessTilde;': '≴',
	'NotNestedGreaterGreater;': '⪢̸',
	'NotNestedLessLess;': '⪡̸',
	'NotPrecedes;': '⊀',
	'NotPrecedesEqual;': '⪯̸',
	'NotPrecedesSlantEqual;': '⋠',
	'NotReverseElement;': '∌',
	'NotRightTriangle;': '⋫',
	'NotRightTriangleBar;': '⧐̸',
	'NotRightTriangleEqual;': '⋭',
	'NotSquareSubset;': '⊏̸',
	'NotSquareSubsetEqual;': '⋢',
	'NotSquareSuperset;': '⊐̸',
	'NotSquareSupersetEqual;': '⋣',
	'NotSubset;': '⊂⃒',
	'NotSubsetEqual;': '⊈',
	'NotSucceeds;': '⊁',
	'NotSucceedsEqual;': '⪰̸',
	'NotSucceedsSlantEqual;': '⋡',
	'NotSucceedsTilde;': '≿̸',
	'NotSuperset;': '⊃⃒',
	'NotSupersetEqual;': '⊉',
	'NotTilde;': '≁',
	'NotTildeEqual;': '≄',
	'NotTildeFullEqual;': '≇',
	'NotTildeTilde;': '≉',
	'NotVerticalBar;': '∤',
	'Nscr;': '𝒩',
	Ntilde: 'Ñ',
	'Ntilde;': 'Ñ',
	'Nu;': 'Ν',
	'OElig;': 'Œ',
	Oacute: 'Ó',
	'Oacute;': 'Ó',
	Ocirc: 'Ô',
	'Ocirc;': 'Ô',
	'Ocy;': 'О',
	'Odblac;': 'Ő',
	'Ofr;': '𝔒',
	Ograve: 'Ò',
	'Ograve;': 'Ò',
	'Omacr;': 'Ō',
	'Omega;': 'Ω',
	'Omicron;': 'Ο',
	'Oopf;': '𝕆',
	'OpenCurlyDoubleQuote;': '“',
	'OpenCurlyQuote;': '‘',
	'Or;': '⩔',
	'Oscr;': '𝒪',
	Oslash: 'Ø',
	'Oslash;': 'Ø',
	Otilde: 'Õ',
	'Otilde;': 'Õ',
	'Otimes;': '⨷',
	Ouml: 'Ö',
	'Ouml;': 'Ö',
	'OverBar;': '‾',
	'OverBrace;': '⏞',
	'OverBracket;': '⎴',
	'OverParenthesis;': '⏜',
	'PartialD;': '∂',
	'Pcy;': 'П',
	'Pfr;': '𝔓',
	'Phi;': 'Φ',
	'Pi;': 'Π',
	'PlusMinus;': '±',
	'Poincareplane;': 'ℌ',
	'Popf;': 'ℙ',
	'Pr;': '⪻',
	'Precedes;': '≺',
	'PrecedesEqual;': '⪯',
	'PrecedesSlantEqual;': '≼',
	'PrecedesTilde;': '≾',
	'Prime;': '″',
	'Product;': '∏',
	'Proportion;': '∷',
	'Proportional;': '∝',
	'Pscr;': '𝒫',
	'Psi;': 'Ψ',
	QUOT: '"',
	'QUOT;': '"',
	'Qfr;': '𝔔',
	'Qopf;': 'ℚ',
	'Qscr;': '𝒬',
	'RBarr;': '⤐',
	REG: '®',
	'REG;': '®',
	'Racute;': 'Ŕ',
	'Rang;': '⟫',
	'Rarr;': '↠',
	'Rarrtl;': '⤖',
	'Rcaron;': 'Ř',
	'Rcedil;': 'Ŗ',
	'Rcy;': 'Р',
	'Re;': 'ℜ',
	'ReverseElement;': '∋',
	'ReverseEquilibrium;': '⇋',
	'ReverseUpEquilibrium;': '⥯',
	'Rfr;': 'ℜ',
	'Rho;': 'Ρ',
	'RightAngleBracket;': '⟩',
	'RightArrow;': '→',
	'RightArrowBar;': '⇥',
	'RightArrowLeftArrow;': '⇄',
	'RightCeiling;': '⌉',
	'RightDoubleBracket;': '⟧',
	'RightDownTeeVector;': '⥝',
	'RightDownVector;': '⇂',
	'RightDownVectorBar;': '⥕',
	'RightFloor;': '⌋',
	'RightTee;': '⊢',
	'RightTeeArrow;': '↦',
	'RightTeeVector;': '⥛',
	'RightTriangle;': '⊳',
	'RightTriangleBar;': '⧐',
	'RightTriangleEqual;': '⊵',
	'RightUpDownVector;': '⥏',
	'RightUpTeeVector;': '⥜',
	'RightUpVector;': '↾',
	'RightUpVectorBar;': '⥔',
	'RightVector;': '⇀',
	'RightVectorBar;': '⥓',
	'Rightarrow;': '⇒',
	'Ropf;': 'ℝ',
	'RoundImplies;': '⥰',
	'Rrightarrow;': '⇛',
	'Rscr;': 'ℛ',
	'Rsh;': '↱',
	'RuleDelayed;': '⧴',
	'SHCHcy;': 'Щ',
	'SHcy;': 'Ш',
	'SOFTcy;': 'Ь',
	'Sacute;': 'Ś',
	'Sc;': '⪼',
	'Scaron;': 'Š',
	'Scedil;': 'Ş',
	'Scirc;': 'Ŝ',
	'Scy;': 'С',
	'Sfr;': '𝔖',
	'ShortDownArrow;': '↓',
	'ShortLeftArrow;': '←',
	'ShortRightArrow;': '→',
	'ShortUpArrow;': '↑',
	'Sigma;': 'Σ',
	'SmallCircle;': '∘',
	'Sopf;': '𝕊',
	'Sqrt;': '√',
	'Square;': '□',
	'SquareIntersection;': '⊓',
	'SquareSubset;': '⊏',
	'SquareSubsetEqual;': '⊑',
	'SquareSuperset;': '⊐',
	'SquareSupersetEqual;': '⊒',
	'SquareUnion;': '⊔',
	'Sscr;': '𝒮',
	'Star;': '⋆',
	'Sub;': '⋐',
	'Subset;': '⋐',
	'SubsetEqual;': '⊆',
	'Succeeds;': '≻',
	'SucceedsEqual;': '⪰',
	'SucceedsSlantEqual;': '≽',
	'SucceedsTilde;': '≿',
	'SuchThat;': '∋',
	'Sum;': '∑',
	'Sup;': '⋑',
	'Superset;': '⊃',
	'SupersetEqual;': '⊇',
	'Supset;': '⋑',
	THORN: 'Þ',
	'THORN;': 'Þ',
	'TRADE;': '™',
	'TSHcy;': 'Ћ',
	'TScy;': 'Ц',
	'Tab;': '\t',
	'Tau;': 'Τ',
	'Tcaron;': 'Ť',
	'Tcedil;': 'Ţ',
	'Tcy;': 'Т',
	'Tfr;': '𝔗',
	'Therefore;': '∴',
	'Theta;': 'Θ',
	'ThickSpace;': '  ',
	'ThinSpace;': ' ',
	'Tilde;': '∼',
	'TildeEqual;': '≃',
	'TildeFullEqual;': '≅',
	'TildeTilde;': '≈',
	'Topf;': '𝕋',
	'TripleDot;': '⃛',
	'Tscr;': '𝒯',
	'Tstrok;': 'Ŧ',
	Uacute: 'Ú',
	'Uacute;': 'Ú',
	'Uarr;': '↟',
	'Uarrocir;': '⥉',
	'Ubrcy;': 'Ў',
	'Ubreve;': 'Ŭ',
	Ucirc: 'Û',
	'Ucirc;': 'Û',
	'Ucy;': 'У',
	'Udblac;': 'Ű',
	'Ufr;': '𝔘',
	Ugrave: 'Ù',
	'Ugrave;': 'Ù',
	'Umacr;': 'Ū',
	'UnderBar;': '_',
	'UnderBrace;': '⏟',
	'UnderBracket;': '⎵',
	'UnderParenthesis;': '⏝',
	'Union;': '⋃',
	'UnionPlus;': '⊎',
	'Uogon;': 'Ų',
	'Uopf;': '𝕌',
	'UpArrow;': '↑',
	'UpArrowBar;': '⤒',
	'UpArrowDownArrow;': '⇅',
	'UpDownArrow;': '↕',
	'UpEquilibrium;': '⥮',
	'UpTee;': '⊥',
	'UpTeeArrow;': '↥',
	'Uparrow;': '⇑',
	'Updownarrow;': '⇕',
	'UpperLeftArrow;': '↖',
	'UpperRightArrow;': '↗',
	'Upsi;': 'ϒ',
	'Upsilon;': 'Υ',
	'Uring;': 'Ů',
	'Uscr;': '𝒰',
	'Utilde;': 'Ũ',
	Uuml: 'Ü',
	'Uuml;': 'Ü',
	'VDash;': '⊫',
	'Vbar;': '⫫',
	'Vcy;': 'В',
	'Vdash;': '⊩',
	'Vdashl;': '⫦',
	'Vee;': '⋁',
	'Verbar;': '‖',
	'Vert;': '‖',
	'VerticalBar;': '∣',
	'VerticalLine;': '|',
	'VerticalSeparator;': '❘',
	'VerticalTilde;': '≀',
	'VeryThinSpace;': ' ',
	'Vfr;': '𝔙',
	'Vopf;': '𝕍',
	'Vscr;': '𝒱',
	'Vvdash;': '⊪',
	'Wcirc;': 'Ŵ',
	'Wedge;': '⋀',
	'Wfr;': '𝔚',
	'Wopf;': '𝕎',
	'Wscr;': '𝒲',
	'Xfr;': '𝔛',
	'Xi;': 'Ξ',
	'Xopf;': '𝕏',
	'Xscr;': '𝒳',
	'YAcy;': 'Я',
	'YIcy;': 'Ї',
	'YUcy;': 'Ю',
	Yacute: 'Ý',
	'Yacute;': 'Ý',
	'Ycirc;': 'Ŷ',
	'Ycy;': 'Ы',
	'Yfr;': '𝔜',
	'Yopf;': '𝕐',
	'Yscr;': '𝒴',
	'Yuml;': 'Ÿ',
	'ZHcy;': 'Ж',
	'Zacute;': 'Ź',
	'Zcaron;': 'Ž',
	'Zcy;': 'З',
	'Zdot;': 'Ż',
	'ZeroWidthSpace;': '​',
	'Zeta;': 'Ζ',
	'Zfr;': 'ℨ',
	'Zopf;': 'ℤ',
	'Zscr;': '𝒵',
	aacute: 'á',
	'aacute;': 'á',
	'abreve;': 'ă',
	'ac;': '∾',
	'acE;': '∾̳',
	'acd;': '∿',
	acirc: 'â',
	'acirc;': 'â',
	acute: '´',
	'acute;': '´',
	'acy;': 'а',
	aelig: 'æ',
	'aelig;': 'æ',
	'af;': '⁡',
	'afr;': '𝔞',
	agrave: 'à',
	'agrave;': 'à',
	'alefsym;': 'ℵ',
	'aleph;': 'ℵ',
	'alpha;': 'α',
	'amacr;': 'ā',
	'amalg;': '⨿',
	amp: '&',
	'amp;': '&',
	'and;': '∧',
	'andand;': '⩕',
	'andd;': '⩜',
	'andslope;': '⩘',
	'andv;': '⩚',
	'ang;': '∠',
	'ange;': '⦤',
	'angle;': '∠',
	'angmsd;': '∡',
	'angmsdaa;': '⦨',
	'angmsdab;': '⦩',
	'angmsdac;': '⦪',
	'angmsdad;': '⦫',
	'angmsdae;': '⦬',
	'angmsdaf;': '⦭',
	'angmsdag;': '⦮',
	'angmsdah;': '⦯',
	'angrt;': '∟',
	'angrtvb;': '⊾',
	'angrtvbd;': '⦝',
	'angsph;': '∢',
	'angst;': 'Å',
	'angzarr;': '⍼',
	'aogon;': 'ą',
	'aopf;': '𝕒',
	'ap;': '≈',
	'apE;': '⩰',
	'apacir;': '⩯',
	'ape;': '≊',
	'apid;': '≋',
	'apos;': "'",
	'approx;': '≈',
	'approxeq;': '≊',
	aring: 'å',
	'aring;': 'å',
	'ascr;': '𝒶',
	'ast;': '*',
	'asymp;': '≈',
	'asympeq;': '≍',
	atilde: 'ã',
	'atilde;': 'ã',
	auml: 'ä',
	'auml;': 'ä',
	'awconint;': '∳',
	'awint;': '⨑',
	'bNot;': '⫭',
	'backcong;': '≌',
	'backepsilon;': '϶',
	'backprime;': '‵',
	'backsim;': '∽',
	'backsimeq;': '⋍',
	'barvee;': '⊽',
	'barwed;': '⌅',
	'barwedge;': '⌅',
	'bbrk;': '⎵',
	'bbrktbrk;': '⎶',
	'bcong;': '≌',
	'bcy;': 'б',
	'bdquo;': '„',
	'becaus;': '∵',
	'because;': '∵',
	'bemptyv;': '⦰',
	'bepsi;': '϶',
	'bernou;': 'ℬ',
	'beta;': 'β',
	'beth;': 'ℶ',
	'between;': '≬',
	'bfr;': '𝔟',
	'bigcap;': '⋂',
	'bigcirc;': '◯',
	'bigcup;': '⋃',
	'bigodot;': '⨀',
	'bigoplus;': '⨁',
	'bigotimes;': '⨂',
	'bigsqcup;': '⨆',
	'bigstar;': '★',
	'bigtriangledown;': '▽',
	'bigtriangleup;': '△',
	'biguplus;': '⨄',
	'bigvee;': '⋁',
	'bigwedge;': '⋀',
	'bkarow;': '⤍',
	'blacklozenge;': '⧫',
	'blacksquare;': '▪',
	'blacktriangle;': '▴',
	'blacktriangledown;': '▾',
	'blacktriangleleft;': '◂',
	'blacktriangleright;': '▸',
	'blank;': '␣',
	'blk12;': '▒',
	'blk14;': '░',
	'blk34;': '▓',
	'block;': '█',
	'bne;': '=⃥',
	'bnequiv;': '≡⃥',
	'bnot;': '⌐',
	'bopf;': '𝕓',
	'bot;': '⊥',
	'bottom;': '⊥',
	'bowtie;': '⋈',
	'boxDL;': '╗',
	'boxDR;': '╔',
	'boxDl;': '╖',
	'boxDr;': '╓',
	'boxH;': '═',
	'boxHD;': '╦',
	'boxHU;': '╩',
	'boxHd;': '╤',
	'boxHu;': '╧',
	'boxUL;': '╝',
	'boxUR;': '╚',
	'boxUl;': '╜',
	'boxUr;': '╙',
	'boxV;': '║',
	'boxVH;': '╬',
	'boxVL;': '╣',
	'boxVR;': '╠',
	'boxVh;': '╫',
	'boxVl;': '╢',
	'boxVr;': '╟',
	'boxbox;': '⧉',
	'boxdL;': '╕',
	'boxdR;': '╒',
	'boxdl;': '┐',
	'boxdr;': '┌',
	'boxh;': '─',
	'boxhD;': '╥',
	'boxhU;': '╨',
	'boxhd;': '┬',
	'boxhu;': '┴',
	'boxminus;': '⊟',
	'boxplus;': '⊞',
	'boxtimes;': '⊠',
	'boxuL;': '╛',
	'boxuR;': '╘',
	'boxul;': '┘',
	'boxur;': '└',
	'boxv;': '│',
	'boxvH;': '╪',
	'boxvL;': '╡',
	'boxvR;': '╞',
	'boxvh;': '┼',
	'boxvl;': '┤',
	'boxvr;': '├',
	'bprime;': '‵',
	'breve;': '˘',
	brvbar: '¦',
	'brvbar;': '¦',
	'bscr;': '𝒷',
	'bsemi;': '⁏',
	'bsim;': '∽',
	'bsime;': '⋍',
	'bsol;': '\\',
	'bsolb;': '⧅',
	'bsolhsub;': '⟈',
	'bull;': '•',
	'bullet;': '•',
	'bump;': '≎',
	'bumpE;': '⪮',
	'bumpe;': '≏',
	'bumpeq;': '≏',
	'cacute;': 'ć',
	'cap;': '∩',
	'capand;': '⩄',
	'capbrcup;': '⩉',
	'capcap;': '⩋',
	'capcup;': '⩇',
	'capdot;': '⩀',
	'caps;': '∩︀',
	'caret;': '⁁',
	'caron;': 'ˇ',
	'ccaps;': '⩍',
	'ccaron;': 'č',
	ccedil: 'ç',
	'ccedil;': 'ç',
	'ccirc;': 'ĉ',
	'ccups;': '⩌',
	'ccupssm;': '⩐',
	'cdot;': 'ċ',
	cedil: '¸',
	'cedil;': '¸',
	'cemptyv;': '⦲',
	cent: '¢',
	'cent;': '¢',
	'centerdot;': '·',
	'cfr;': '𝔠',
	'chcy;': 'ч',
	'check;': '✓',
	'checkmark;': '✓',
	'chi;': 'χ',
	'cir;': '○',
	'cirE;': '⧃',
	'circ;': 'ˆ',
	'circeq;': '≗',
	'circlearrowleft;': '↺',
	'circlearrowright;': '↻',
	'circledR;': '®',
	'circledS;': 'Ⓢ',
	'circledast;': '⊛',
	'circledcirc;': '⊚',
	'circleddash;': '⊝',
	'cire;': '≗',
	'cirfnint;': '⨐',
	'cirmid;': '⫯',
	'cirscir;': '⧂',
	'clubs;': '♣',
	'clubsuit;': '♣',
	'colon;': ':',
	'colone;': '≔',
	'coloneq;': '≔',
	'comma;': ',',
	'commat;': '@',
	'comp;': '∁',
	'compfn;': '∘',
	'complement;': '∁',
	'complexes;': 'ℂ',
	'cong;': '≅',
	'congdot;': '⩭',
	'conint;': '∮',
	'copf;': '𝕔',
	'coprod;': '∐',
	copy: '©',
	'copy;': '©',
	'copysr;': '℗',
	'crarr;': '↵',
	'cross;': '✗',
	'cscr;': '𝒸',
	'csub;': '⫏',
	'csube;': '⫑',
	'csup;': '⫐',
	'csupe;': '⫒',
	'ctdot;': '⋯',
	'cudarrl;': '⤸',
	'cudarrr;': '⤵',
	'cuepr;': '⋞',
	'cuesc;': '⋟',
	'cularr;': '↶',
	'cularrp;': '⤽',
	'cup;': '∪',
	'cupbrcap;': '⩈',
	'cupcap;': '⩆',
	'cupcup;': '⩊',
	'cupdot;': '⊍',
	'cupor;': '⩅',
	'cups;': '∪︀',
	'curarr;': '↷',
	'curarrm;': '⤼',
	'curlyeqprec;': '⋞',
	'curlyeqsucc;': '⋟',
	'curlyvee;': '⋎',
	'curlywedge;': '⋏',
	curren: '¤',
	'curren;': '¤',
	'curvearrowleft;': '↶',
	'curvearrowright;': '↷',
	'cuvee;': '⋎',
	'cuwed;': '⋏',
	'cwconint;': '∲',
	'cwint;': '∱',
	'cylcty;': '⌭',
	'dArr;': '⇓',
	'dHar;': '⥥',
	'dagger;': '†',
	'daleth;': 'ℸ',
	'darr;': '↓',
	'dash;': '‐',
	'dashv;': '⊣',
	'dbkarow;': '⤏',
	'dblac;': '˝',
	'dcaron;': 'ď',
	'dcy;': 'д',
	'dd;': 'ⅆ',
	'ddagger;': '‡',
	'ddarr;': '⇊',
	'ddotseq;': '⩷',
	deg: '°',
	'deg;': '°',
	'delta;': 'δ',
	'demptyv;': '⦱',
	'dfisht;': '⥿',
	'dfr;': '𝔡',
	'dharl;': '⇃',
	'dharr;': '⇂',
	'diam;': '⋄',
	'diamond;': '⋄',
	'diamondsuit;': '♦',
	'diams;': '♦',
	'die;': '¨',
	'digamma;': 'ϝ',
	'disin;': '⋲',
	'div;': '÷',
	divide: '÷',
	'divide;': '÷',
	'divideontimes;': '⋇',
	'divonx;': '⋇',
	'djcy;': 'ђ',
	'dlcorn;': '⌞',
	'dlcrop;': '⌍',
	'dollar;': '$',
	'dopf;': '𝕕',
	'dot;': '˙',
	'doteq;': '≐',
	'doteqdot;': '≑',
	'dotminus;': '∸',
	'dotplus;': '∔',
	'dotsquare;': '⊡',
	'doublebarwedge;': '⌆',
	'downarrow;': '↓',
	'downdownarrows;': '⇊',
	'downharpoonleft;': '⇃',
	'downharpoonright;': '⇂',
	'drbkarow;': '⤐',
	'drcorn;': '⌟',
	'drcrop;': '⌌',
	'dscr;': '𝒹',
	'dscy;': 'ѕ',
	'dsol;': '⧶',
	'dstrok;': 'đ',
	'dtdot;': '⋱',
	'dtri;': '▿',
	'dtrif;': '▾',
	'duarr;': '⇵',
	'duhar;': '⥯',
	'dwangle;': '⦦',
	'dzcy;': 'џ',
	'dzigrarr;': '⟿',
	'eDDot;': '⩷',
	'eDot;': '≑',
	eacute: 'é',
	'eacute;': 'é',
	'easter;': '⩮',
	'ecaron;': 'ě',
	'ecir;': '≖',
	ecirc: 'ê',
	'ecirc;': 'ê',
	'ecolon;': '≕',
	'ecy;': 'э',
	'edot;': 'ė',
	'ee;': 'ⅇ',
	'efDot;': '≒',
	'efr;': '𝔢',
	'eg;': '⪚',
	egrave: 'è',
	'egrave;': 'è',
	'egs;': '⪖',
	'egsdot;': '⪘',
	'el;': '⪙',
	'elinters;': '⏧',
	'ell;': 'ℓ',
	'els;': '⪕',
	'elsdot;': '⪗',
	'emacr;': 'ē',
	'empty;': '∅',
	'emptyset;': '∅',
	'emptyv;': '∅',
	'emsp13;': ' ',
	'emsp14;': ' ',
	'emsp;': ' ',
	'eng;': 'ŋ',
	'ensp;': ' ',
	'eogon;': 'ę',
	'eopf;': '𝕖',
	'epar;': '⋕',
	'eparsl;': '⧣',
	'eplus;': '⩱',
	'epsi;': 'ε',
	'epsilon;': 'ε',
	'epsiv;': 'ϵ',
	'eqcirc;': '≖',
	'eqcolon;': '≕',
	'eqsim;': '≂',
	'eqslantgtr;': '⪖',
	'eqslantless;': '⪕',
	'equals;': '=',
	'equest;': '≟',
	'equiv;': '≡',
	'equivDD;': '⩸',
	'eqvparsl;': '⧥',
	'erDot;': '≓',
	'erarr;': '⥱',
	'escr;': 'ℯ',
	'esdot;': '≐',
	'esim;': '≂',
	'eta;': 'η',
	eth: 'ð',
	'eth;': 'ð',
	euml: 'ë',
	'euml;': 'ë',
	'euro;': '€',
	'excl;': '!',
	'exist;': '∃',
	'expectation;': 'ℰ',
	'exponentiale;': 'ⅇ',
	'fallingdotseq;': '≒',
	'fcy;': 'ф',
	'female;': '♀',
	'ffilig;': 'ﬃ',
	'fflig;': 'ﬀ',
	'ffllig;': 'ﬄ',
	'ffr;': '𝔣',
	'filig;': 'ﬁ',
	'fjlig;': 'fj',
	'flat;': '♭',
	'fllig;': 'ﬂ',
	'fltns;': '▱',
	'fnof;': 'ƒ',
	'fopf;': '𝕗',
	'forall;': '∀',
	'fork;': '⋔',
	'forkv;': '⫙',
	'fpartint;': '⨍',
	frac12: '½',
	'frac12;': '½',
	'frac13;': '⅓',
	frac14: '¼',
	'frac14;': '¼',
	'frac15;': '⅕',
	'frac16;': '⅙',
	'frac18;': '⅛',
	'frac23;': '⅔',
	'frac25;': '⅖',
	frac34: '¾',
	'frac34;': '¾',
	'frac35;': '⅗',
	'frac38;': '⅜',
	'frac45;': '⅘',
	'frac56;': '⅚',
	'frac58;': '⅝',
	'frac78;': '⅞',
	'frasl;': '⁄',
	'frown;': '⌢',
	'fscr;': '𝒻',
	'gE;': '≧',
	'gEl;': '⪌',
	'gacute;': 'ǵ',
	'gamma;': 'γ',
	'gammad;': 'ϝ',
	'gap;': '⪆',
	'gbreve;': 'ğ',
	'gcirc;': 'ĝ',
	'gcy;': 'г',
	'gdot;': 'ġ',
	'ge;': '≥',
	'gel;': '⋛',
	'geq;': '≥',
	'geqq;': '≧',
	'geqslant;': '⩾',
	'ges;': '⩾',
	'gescc;': '⪩',
	'gesdot;': '⪀',
	'gesdoto;': '⪂',
	'gesdotol;': '⪄',
	'gesl;': '⋛︀',
	'gesles;': '⪔',
	'gfr;': '𝔤',
	'gg;': '≫',
	'ggg;': '⋙',
	'gimel;': 'ℷ',
	'gjcy;': 'ѓ',
	'gl;': '≷',
	'glE;': '⪒',
	'gla;': '⪥',
	'glj;': '⪤',
	'gnE;': '≩',
	'gnap;': '⪊',
	'gnapprox;': '⪊',
	'gne;': '⪈',
	'gneq;': '⪈',
	'gneqq;': '≩',
	'gnsim;': '⋧',
	'gopf;': '𝕘',
	'grave;': '`',
	'gscr;': 'ℊ',
	'gsim;': '≳',
	'gsime;': '⪎',
	'gsiml;': '⪐',
	gt: '>',
	'gt;': '>',
	'gtcc;': '⪧',
	'gtcir;': '⩺',
	'gtdot;': '⋗',
	'gtlPar;': '⦕',
	'gtquest;': '⩼',
	'gtrapprox;': '⪆',
	'gtrarr;': '⥸',
	'gtrdot;': '⋗',
	'gtreqless;': '⋛',
	'gtreqqless;': '⪌',
	'gtrless;': '≷',
	'gtrsim;': '≳',
	'gvertneqq;': '≩︀',
	'gvnE;': '≩︀',
	'hArr;': '⇔',
	'hairsp;': ' ',
	'half;': '½',
	'hamilt;': 'ℋ',
	'hardcy;': 'ъ',
	'harr;': '↔',
	'harrcir;': '⥈',
	'harrw;': '↭',
	'hbar;': 'ℏ',
	'hcirc;': 'ĥ',
	'hearts;': '♥',
	'heartsuit;': '♥',
	'hellip;': '…',
	'hercon;': '⊹',
	'hfr;': '𝔥',
	'hksearow;': '⤥',
	'hkswarow;': '⤦',
	'hoarr;': '⇿',
	'homtht;': '∻',
	'hookleftarrow;': '↩',
	'hookrightarrow;': '↪',
	'hopf;': '𝕙',
	'horbar;': '―',
	'hscr;': '𝒽',
	'hslash;': 'ℏ',
	'hstrok;': 'ħ',
	'hybull;': '⁃',
	'hyphen;': '‐',
	iacute: 'í',
	'iacute;': 'í',
	'ic;': '⁣',
	icirc: 'î',
	'icirc;': 'î',
	'icy;': 'и',
	'iecy;': 'е',
	iexcl: '¡',
	'iexcl;': '¡',
	'iff;': '⇔',
	'ifr;': '𝔦',
	igrave: 'ì',
	'igrave;': 'ì',
	'ii;': 'ⅈ',
	'iiiint;': '⨌',
	'iiint;': '∭',
	'iinfin;': '⧜',
	'iiota;': '℩',
	'ijlig;': 'ĳ',
	'imacr;': 'ī',
	'image;': 'ℑ',
	'imagline;': 'ℐ',
	'imagpart;': 'ℑ',
	'imath;': 'ı',
	'imof;': '⊷',
	'imped;': 'Ƶ',
	'in;': '∈',
	'incare;': '℅',
	'infin;': '∞',
	'infintie;': '⧝',
	'inodot;': 'ı',
	'int;': '∫',
	'intcal;': '⊺',
	'integers;': 'ℤ',
	'intercal;': '⊺',
	'intlarhk;': '⨗',
	'intprod;': '⨼',
	'iocy;': 'ё',
	'iogon;': 'į',
	'iopf;': '𝕚',
	'iota;': 'ι',
	'iprod;': '⨼',
	iquest: '¿',
	'iquest;': '¿',
	'iscr;': '𝒾',
	'isin;': '∈',
	'isinE;': '⋹',
	'isindot;': '⋵',
	'isins;': '⋴',
	'isinsv;': '⋳',
	'isinv;': '∈',
	'it;': '⁢',
	'itilde;': 'ĩ',
	'iukcy;': 'і',
	iuml: 'ï',
	'iuml;': 'ï',
	'jcirc;': 'ĵ',
	'jcy;': 'й',
	'jfr;': '𝔧',
	'jmath;': 'ȷ',
	'jopf;': '𝕛',
	'jscr;': '𝒿',
	'jsercy;': 'ј',
	'jukcy;': 'є',
	'kappa;': 'κ',
	'kappav;': 'ϰ',
	'kcedil;': 'ķ',
	'kcy;': 'к',
	'kfr;': '𝔨',
	'kgreen;': 'ĸ',
	'khcy;': 'х',
	'kjcy;': 'ќ',
	'kopf;': '𝕜',
	'kscr;': '𝓀',
	'lAarr;': '⇚',
	'lArr;': '⇐',
	'lAtail;': '⤛',
	'lBarr;': '⤎',
	'lE;': '≦',
	'lEg;': '⪋',
	'lHar;': '⥢',
	'lacute;': 'ĺ',
	'laemptyv;': '⦴',
	'lagran;': 'ℒ',
	'lambda;': 'λ',
	'lang;': '⟨',
	'langd;': '⦑',
	'langle;': '⟨',
	'lap;': '⪅',
	laquo: '«',
	'laquo;': '«',
	'larr;': '←',
	'larrb;': '⇤',
	'larrbfs;': '⤟',
	'larrfs;': '⤝',
	'larrhk;': '↩',
	'larrlp;': '↫',
	'larrpl;': '⤹',
	'larrsim;': '⥳',
	'larrtl;': '↢',
	'lat;': '⪫',
	'latail;': '⤙',
	'late;': '⪭',
	'lates;': '⪭︀',
	'lbarr;': '⤌',
	'lbbrk;': '❲',
	'lbrace;': '{',
	'lbrack;': '[',
	'lbrke;': '⦋',
	'lbrksld;': '⦏',
	'lbrkslu;': '⦍',
	'lcaron;': 'ľ',
	'lcedil;': 'ļ',
	'lceil;': '⌈',
	'lcub;': '{',
	'lcy;': 'л',
	'ldca;': '⤶',
	'ldquo;': '“',
	'ldquor;': '„',
	'ldrdhar;': '⥧',
	'ldrushar;': '⥋',
	'ldsh;': '↲',
	'le;': '≤',
	'leftarrow;': '←',
	'leftarrowtail;': '↢',
	'leftharpoondown;': '↽',
	'leftharpoonup;': '↼',
	'leftleftarrows;': '⇇',
	'leftrightarrow;': '↔',
	'leftrightarrows;': '⇆',
	'leftrightharpoons;': '⇋',
	'leftrightsquigarrow;': '↭',
	'leftthreetimes;': '⋋',
	'leg;': '⋚',
	'leq;': '≤',
	'leqq;': '≦',
	'leqslant;': '⩽',
	'les;': '⩽',
	'lescc;': '⪨',
	'lesdot;': '⩿',
	'lesdoto;': '⪁',
	'lesdotor;': '⪃',
	'lesg;': '⋚︀',
	'lesges;': '⪓',
	'lessapprox;': '⪅',
	'lessdot;': '⋖',
	'lesseqgtr;': '⋚',
	'lesseqqgtr;': '⪋',
	'lessgtr;': '≶',
	'lesssim;': '≲',
	'lfisht;': '⥼',
	'lfloor;': '⌊',
	'lfr;': '𝔩',
	'lg;': '≶',
	'lgE;': '⪑',
	'lhard;': '↽',
	'lharu;': '↼',
	'lharul;': '⥪',
	'lhblk;': '▄',
	'ljcy;': 'љ',
	'll;': '≪',
	'llarr;': '⇇',
	'llcorner;': '⌞',
	'llhard;': '⥫',
	'lltri;': '◺',
	'lmidot;': 'ŀ',
	'lmoust;': '⎰',
	'lmoustache;': '⎰',
	'lnE;': '≨',
	'lnap;': '⪉',
	'lnapprox;': '⪉',
	'lne;': '⪇',
	'lneq;': '⪇',
	'lneqq;': '≨',
	'lnsim;': '⋦',
	'loang;': '⟬',
	'loarr;': '⇽',
	'lobrk;': '⟦',
	'longleftarrow;': '⟵',
	'longleftrightarrow;': '⟷',
	'longmapsto;': '⟼',
	'longrightarrow;': '⟶',
	'looparrowleft;': '↫',
	'looparrowright;': '↬',
	'lopar;': '⦅',
	'lopf;': '𝕝',
	'loplus;': '⨭',
	'lotimes;': '⨴',
	'lowast;': '∗',
	'lowbar;': '_',
	'loz;': '◊',
	'lozenge;': '◊',
	'lozf;': '⧫',
	'lpar;': '(',
	'lparlt;': '⦓',
	'lrarr;': '⇆',
	'lrcorner;': '⌟',
	'lrhar;': '⇋',
	'lrhard;': '⥭',
	'lrm;': '‎',
	'lrtri;': '⊿',
	'lsaquo;': '‹',
	'lscr;': '𝓁',
	'lsh;': '↰',
	'lsim;': '≲',
	'lsime;': '⪍',
	'lsimg;': '⪏',
	'lsqb;': '[',
	'lsquo;': '‘',
	'lsquor;': '‚',
	'lstrok;': 'ł',
	lt: '<',
	'lt;': '<',
	'ltcc;': '⪦',
	'ltcir;': '⩹',
	'ltdot;': '⋖',
	'lthree;': '⋋',
	'ltimes;': '⋉',
	'ltlarr;': '⥶',
	'ltquest;': '⩻',
	'ltrPar;': '⦖',
	'ltri;': '◃',
	'ltrie;': '⊴',
	'ltrif;': '◂',
	'lurdshar;': '⥊',
	'luruhar;': '⥦',
	'lvertneqq;': '≨︀',
	'lvnE;': '≨︀',
	'mDDot;': '∺',
	macr: '¯',
	'macr;': '¯',
	'male;': '♂',
	'malt;': '✠',
	'maltese;': '✠',
	'map;': '↦',
	'mapsto;': '↦',
	'mapstodown;': '↧',
	'mapstoleft;': '↤',
	'mapstoup;': '↥',
	'marker;': '▮',
	'mcomma;': '⨩',
	'mcy;': 'м',
	'mdash;': '—',
	'measuredangle;': '∡',
	'mfr;': '𝔪',
	'mho;': '℧',
	micro: 'µ',
	'micro;': 'µ',
	'mid;': '∣',
	'midast;': '*',
	'midcir;': '⫰',
	middot: '·',
	'middot;': '·',
	'minus;': '−',
	'minusb;': '⊟',
	'minusd;': '∸',
	'minusdu;': '⨪',
	'mlcp;': '⫛',
	'mldr;': '…',
	'mnplus;': '∓',
	'models;': '⊧',
	'mopf;': '𝕞',
	'mp;': '∓',
	'mscr;': '𝓂',
	'mstpos;': '∾',
	'mu;': 'μ',
	'multimap;': '⊸',
	'mumap;': '⊸',
	'nGg;': '⋙̸',
	'nGt;': '≫⃒',
	'nGtv;': '≫̸',
	'nLeftarrow;': '⇍',
	'nLeftrightarrow;': '⇎',
	'nLl;': '⋘̸',
	'nLt;': '≪⃒',
	'nLtv;': '≪̸',
	'nRightarrow;': '⇏',
	'nVDash;': '⊯',
	'nVdash;': '⊮',
	'nabla;': '∇',
	'nacute;': 'ń',
	'nang;': '∠⃒',
	'nap;': '≉',
	'napE;': '⩰̸',
	'napid;': '≋̸',
	'napos;': 'ŉ',
	'napprox;': '≉',
	'natur;': '♮',
	'natural;': '♮',
	'naturals;': 'ℕ',
	nbsp: ' ',
	'nbsp;': ' ',
	'nbump;': '≎̸',
	'nbumpe;': '≏̸',
	'ncap;': '⩃',
	'ncaron;': 'ň',
	'ncedil;': 'ņ',
	'ncong;': '≇',
	'ncongdot;': '⩭̸',
	'ncup;': '⩂',
	'ncy;': 'н',
	'ndash;': '–',
	'ne;': '≠',
	'neArr;': '⇗',
	'nearhk;': '⤤',
	'nearr;': '↗',
	'nearrow;': '↗',
	'nedot;': '≐̸',
	'nequiv;': '≢',
	'nesear;': '⤨',
	'nesim;': '≂̸',
	'nexist;': '∄',
	'nexists;': '∄',
	'nfr;': '𝔫',
	'ngE;': '≧̸',
	'nge;': '≱',
	'ngeq;': '≱',
	'ngeqq;': '≧̸',
	'ngeqslant;': '⩾̸',
	'nges;': '⩾̸',
	'ngsim;': '≵',
	'ngt;': '≯',
	'ngtr;': '≯',
	'nhArr;': '⇎',
	'nharr;': '↮',
	'nhpar;': '⫲',
	'ni;': '∋',
	'nis;': '⋼',
	'nisd;': '⋺',
	'niv;': '∋',
	'njcy;': 'њ',
	'nlArr;': '⇍',
	'nlE;': '≦̸',
	'nlarr;': '↚',
	'nldr;': '‥',
	'nle;': '≰',
	'nleftarrow;': '↚',
	'nleftrightarrow;': '↮',
	'nleq;': '≰',
	'nleqq;': '≦̸',
	'nleqslant;': '⩽̸',
	'nles;': '⩽̸',
	'nless;': '≮',
	'nlsim;': '≴',
	'nlt;': '≮',
	'nltri;': '⋪',
	'nltrie;': '⋬',
	'nmid;': '∤',
	'nopf;': '𝕟',
	not: '¬',
	'not;': '¬',
	'notin;': '∉',
	'notinE;': '⋹̸',
	'notindot;': '⋵̸',
	'notinva;': '∉',
	'notinvb;': '⋷',
	'notinvc;': '⋶',
	'notni;': '∌',
	'notniva;': '∌',
	'notnivb;': '⋾',
	'notnivc;': '⋽',
	'npar;': '∦',
	'nparallel;': '∦',
	'nparsl;': '⫽⃥',
	'npart;': '∂̸',
	'npolint;': '⨔',
	'npr;': '⊀',
	'nprcue;': '⋠',
	'npre;': '⪯̸',
	'nprec;': '⊀',
	'npreceq;': '⪯̸',
	'nrArr;': '⇏',
	'nrarr;': '↛',
	'nrarrc;': '⤳̸',
	'nrarrw;': '↝̸',
	'nrightarrow;': '↛',
	'nrtri;': '⋫',
	'nrtrie;': '⋭',
	'nsc;': '⊁',
	'nsccue;': '⋡',
	'nsce;': '⪰̸',
	'nscr;': '𝓃',
	'nshortmid;': '∤',
	'nshortparallel;': '∦',
	'nsim;': '≁',
	'nsime;': '≄',
	'nsimeq;': '≄',
	'nsmid;': '∤',
	'nspar;': '∦',
	'nsqsube;': '⋢',
	'nsqsupe;': '⋣',
	'nsub;': '⊄',
	'nsubE;': '⫅̸',
	'nsube;': '⊈',
	'nsubset;': '⊂⃒',
	'nsubseteq;': '⊈',
	'nsubseteqq;': '⫅̸',
	'nsucc;': '⊁',
	'nsucceq;': '⪰̸',
	'nsup;': '⊅',
	'nsupE;': '⫆̸',
	'nsupe;': '⊉',
	'nsupset;': '⊃⃒',
	'nsupseteq;': '⊉',
	'nsupseteqq;': '⫆̸',
	'ntgl;': '≹',
	ntilde: 'ñ',
	'ntilde;': 'ñ',
	'ntlg;': '≸',
	'ntriangleleft;': '⋪',
	'ntrianglelefteq;': '⋬',
	'ntriangleright;': '⋫',
	'ntrianglerighteq;': '⋭',
	'nu;': 'ν',
	'num;': '#',
	'numero;': '№',
	'numsp;': ' ',
	'nvDash;': '⊭',
	'nvHarr;': '⤄',
	'nvap;': '≍⃒',
	'nvdash;': '⊬',
	'nvge;': '≥⃒',
	'nvgt;': '>⃒',
	'nvinfin;': '⧞',
	'nvlArr;': '⤂',
	'nvle;': '≤⃒',
	'nvlt;': '<⃒',
	'nvltrie;': '⊴⃒',
	'nvrArr;': '⤃',
	'nvrtrie;': '⊵⃒',
	'nvsim;': '∼⃒',
	'nwArr;': '⇖',
	'nwarhk;': '⤣',
	'nwarr;': '↖',
	'nwarrow;': '↖',
	'nwnear;': '⤧',
	'oS;': 'Ⓢ',
	oacute: 'ó',
	'oacute;': 'ó',
	'oast;': '⊛',
	'ocir;': '⊚',
	ocirc: 'ô',
	'ocirc;': 'ô',
	'ocy;': 'о',
	'odash;': '⊝',
	'odblac;': 'ő',
	'odiv;': '⨸',
	'odot;': '⊙',
	'odsold;': '⦼',
	'oelig;': 'œ',
	'ofcir;': '⦿',
	'ofr;': '𝔬',
	'ogon;': '˛',
	ograve: 'ò',
	'ograve;': 'ò',
	'ogt;': '⧁',
	'ohbar;': '⦵',
	'ohm;': 'Ω',
	'oint;': '∮',
	'olarr;': '↺',
	'olcir;': '⦾',
	'olcross;': '⦻',
	'oline;': '‾',
	'olt;': '⧀',
	'omacr;': 'ō',
	'omega;': 'ω',
	'omicron;': 'ο',
	'omid;': '⦶',
	'ominus;': '⊖',
	'oopf;': '𝕠',
	'opar;': '⦷',
	'operp;': '⦹',
	'oplus;': '⊕',
	'or;': '∨',
	'orarr;': '↻',
	'ord;': '⩝',
	'order;': 'ℴ',
	'orderof;': 'ℴ',
	ordf: 'ª',
	'ordf;': 'ª',
	ordm: 'º',
	'ordm;': 'º',
	'origof;': '⊶',
	'oror;': '⩖',
	'orslope;': '⩗',
	'orv;': '⩛',
	'oscr;': 'ℴ',
	oslash: 'ø',
	'oslash;': 'ø',
	'osol;': '⊘',
	otilde: 'õ',
	'otilde;': 'õ',
	'otimes;': '⊗',
	'otimesas;': '⨶',
	ouml: 'ö',
	'ouml;': 'ö',
	'ovbar;': '⌽',
	'par;': '∥',
	para: '¶',
	'para;': '¶',
	'parallel;': '∥',
	'parsim;': '⫳',
	'parsl;': '⫽',
	'part;': '∂',
	'pcy;': 'п',
	'percnt;': '%',
	'period;': '.',
	'permil;': '‰',
	'perp;': '⊥',
	'pertenk;': '‱',
	'pfr;': '𝔭',
	'phi;': 'φ',
	'phiv;': 'ϕ',
	'phmmat;': 'ℳ',
	'phone;': '☎',
	'pi;': 'π',
	'pitchfork;': '⋔',
	'piv;': 'ϖ',
	'planck;': 'ℏ',
	'planckh;': 'ℎ',
	'plankv;': 'ℏ',
	'plus;': '+',
	'plusacir;': '⨣',
	'plusb;': '⊞',
	'pluscir;': '⨢',
	'plusdo;': '∔',
	'plusdu;': '⨥',
	'pluse;': '⩲',
	plusmn: '±',
	'plusmn;': '±',
	'plussim;': '⨦',
	'plustwo;': '⨧',
	'pm;': '±',
	'pointint;': '⨕',
	'popf;': '𝕡',
	pound: '£',
	'pound;': '£',
	'pr;': '≺',
	'prE;': '⪳',
	'prap;': '⪷',
	'prcue;': '≼',
	'pre;': '⪯',
	'prec;': '≺',
	'precapprox;': '⪷',
	'preccurlyeq;': '≼',
	'preceq;': '⪯',
	'precnapprox;': '⪹',
	'precneqq;': '⪵',
	'precnsim;': '⋨',
	'precsim;': '≾',
	'prime;': '′',
	'primes;': 'ℙ',
	'prnE;': '⪵',
	'prnap;': '⪹',
	'prnsim;': '⋨',
	'prod;': '∏',
	'profalar;': '⌮',
	'profline;': '⌒',
	'profsurf;': '⌓',
	'prop;': '∝',
	'propto;': '∝',
	'prsim;': '≾',
	'prurel;': '⊰',
	'pscr;': '𝓅',
	'psi;': 'ψ',
	'puncsp;': ' ',
	'qfr;': '𝔮',
	'qint;': '⨌',
	'qopf;': '𝕢',
	'qprime;': '⁗',
	'qscr;': '𝓆',
	'quaternions;': 'ℍ',
	'quatint;': '⨖',
	'quest;': '?',
	'questeq;': '≟',
	quot: '"',
	'quot;': '"',
	'rAarr;': '⇛',
	'rArr;': '⇒',
	'rAtail;': '⤜',
	'rBarr;': '⤏',
	'rHar;': '⥤',
	'race;': '∽̱',
	'racute;': 'ŕ',
	'radic;': '√',
	'raemptyv;': '⦳',
	'rang;': '⟩',
	'rangd;': '⦒',
	'range;': '⦥',
	'rangle;': '⟩',
	raquo: '»',
	'raquo;': '»',
	'rarr;': '→',
	'rarrap;': '⥵',
	'rarrb;': '⇥',
	'rarrbfs;': '⤠',
	'rarrc;': '⤳',
	'rarrfs;': '⤞',
	'rarrhk;': '↪',
	'rarrlp;': '↬',
	'rarrpl;': '⥅',
	'rarrsim;': '⥴',
	'rarrtl;': '↣',
	'rarrw;': '↝',
	'ratail;': '⤚',
	'ratio;': '∶',
	'rationals;': 'ℚ',
	'rbarr;': '⤍',
	'rbbrk;': '❳',
	'rbrace;': '}',
	'rbrack;': ']',
	'rbrke;': '⦌',
	'rbrksld;': '⦎',
	'rbrkslu;': '⦐',
	'rcaron;': 'ř',
	'rcedil;': 'ŗ',
	'rceil;': '⌉',
	'rcub;': '}',
	'rcy;': 'р',
	'rdca;': '⤷',
	'rdldhar;': '⥩',
	'rdquo;': '”',
	'rdquor;': '”',
	'rdsh;': '↳',
	'real;': 'ℜ',
	'realine;': 'ℛ',
	'realpart;': 'ℜ',
	'reals;': 'ℝ',
	'rect;': '▭',
	reg: '®',
	'reg;': '®',
	'rfisht;': '⥽',
	'rfloor;': '⌋',
	'rfr;': '𝔯',
	'rhard;': '⇁',
	'rharu;': '⇀',
	'rharul;': '⥬',
	'rho;': 'ρ',
	'rhov;': 'ϱ',
	'rightarrow;': '→',
	'rightarrowtail;': '↣',
	'rightharpoondown;': '⇁',
	'rightharpoonup;': '⇀',
	'rightleftarrows;': '⇄',
	'rightleftharpoons;': '⇌',
	'rightrightarrows;': '⇉',
	'rightsquigarrow;': '↝',
	'rightthreetimes;': '⋌',
	'ring;': '˚',
	'risingdotseq;': '≓',
	'rlarr;': '⇄',
	'rlhar;': '⇌',
	'rlm;': '‏',
	'rmoust;': '⎱',
	'rmoustache;': '⎱',
	'rnmid;': '⫮',
	'roang;': '⟭',
	'roarr;': '⇾',
	'robrk;': '⟧',
	'ropar;': '⦆',
	'ropf;': '𝕣',
	'roplus;': '⨮',
	'rotimes;': '⨵',
	'rpar;': ')',
	'rpargt;': '⦔',
	'rppolint;': '⨒',
	'rrarr;': '⇉',
	'rsaquo;': '›',
	'rscr;': '𝓇',
	'rsh;': '↱',
	'rsqb;': ']',
	'rsquo;': '’',
	'rsquor;': '’',
	'rthree;': '⋌',
	'rtimes;': '⋊',
	'rtri;': '▹',
	'rtrie;': '⊵',
	'rtrif;': '▸',
	'rtriltri;': '⧎',
	'ruluhar;': '⥨',
	'rx;': '℞',
	'sacute;': 'ś',
	'sbquo;': '‚',
	'sc;': '≻',
	'scE;': '⪴',
	'scap;': '⪸',
	'scaron;': 'š',
	'sccue;': '≽',
	'sce;': '⪰',
	'scedil;': 'ş',
	'scirc;': 'ŝ',
	'scnE;': '⪶',
	'scnap;': '⪺',
	'scnsim;': '⋩',
	'scpolint;': '⨓',
	'scsim;': '≿',
	'scy;': 'с',
	'sdot;': '⋅',
	'sdotb;': '⊡',
	'sdote;': '⩦',
	'seArr;': '⇘',
	'searhk;': '⤥',
	'searr;': '↘',
	'searrow;': '↘',
	sect: '§',
	'sect;': '§',
	'semi;': ';',
	'seswar;': '⤩',
	'setminus;': '∖',
	'setmn;': '∖',
	'sext;': '✶',
	'sfr;': '𝔰',
	'sfrown;': '⌢',
	'sharp;': '♯',
	'shchcy;': 'щ',
	'shcy;': 'ш',
	'shortmid;': '∣',
	'shortparallel;': '∥',
	shy: '­',
	'shy;': '­',
	'sigma;': 'σ',
	'sigmaf;': 'ς',
	'sigmav;': 'ς',
	'sim;': '∼',
	'simdot;': '⩪',
	'sime;': '≃',
	'simeq;': '≃',
	'simg;': '⪞',
	'simgE;': '⪠',
	'siml;': '⪝',
	'simlE;': '⪟',
	'simne;': '≆',
	'simplus;': '⨤',
	'simrarr;': '⥲',
	'slarr;': '←',
	'smallsetminus;': '∖',
	'smashp;': '⨳',
	'smeparsl;': '⧤',
	'smid;': '∣',
	'smile;': '⌣',
	'smt;': '⪪',
	'smte;': '⪬',
	'smtes;': '⪬︀',
	'softcy;': 'ь',
	'sol;': '/',
	'solb;': '⧄',
	'solbar;': '⌿',
	'sopf;': '𝕤',
	'spades;': '♠',
	'spadesuit;': '♠',
	'spar;': '∥',
	'sqcap;': '⊓',
	'sqcaps;': '⊓︀',
	'sqcup;': '⊔',
	'sqcups;': '⊔︀',
	'sqsub;': '⊏',
	'sqsube;': '⊑',
	'sqsubset;': '⊏',
	'sqsubseteq;': '⊑',
	'sqsup;': '⊐',
	'sqsupe;': '⊒',
	'sqsupset;': '⊐',
	'sqsupseteq;': '⊒',
	'squ;': '□',
	'square;': '□',
	'squarf;': '▪',
	'squf;': '▪',
	'srarr;': '→',
	'sscr;': '𝓈',
	'ssetmn;': '∖',
	'ssmile;': '⌣',
	'sstarf;': '⋆',
	'star;': '☆',
	'starf;': '★',
	'straightepsilon;': 'ϵ',
	'straightphi;': 'ϕ',
	'strns;': '¯',
	'sub;': '⊂',
	'subE;': '⫅',
	'subdot;': '⪽',
	'sube;': '⊆',
	'subedot;': '⫃',
	'submult;': '⫁',
	'subnE;': '⫋',
	'subne;': '⊊',
	'subplus;': '⪿',
	'subrarr;': '⥹',
	'subset;': '⊂',
	'subseteq;': '⊆',
	'subseteqq;': '⫅',
	'subsetneq;': '⊊',
	'subsetneqq;': '⫋',
	'subsim;': '⫇',
	'subsub;': '⫕',
	'subsup;': '⫓',
	'succ;': '≻',
	'succapprox;': '⪸',
	'succcurlyeq;': '≽',
	'succeq;': '⪰',
	'succnapprox;': '⪺',
	'succneqq;': '⪶',
	'succnsim;': '⋩',
	'succsim;': '≿',
	'sum;': '∑',
	'sung;': '♪',
	sup1: '¹',
	'sup1;': '¹',
	sup2: '²',
	'sup2;': '²',
	sup3: '³',
	'sup3;': '³',
	'sup;': '⊃',
	'supE;': '⫆',
	'supdot;': '⪾',
	'supdsub;': '⫘',
	'supe;': '⊇',
	'supedot;': '⫄',
	'suphsol;': '⟉',
	'suphsub;': '⫗',
	'suplarr;': '⥻',
	'supmult;': '⫂',
	'supnE;': '⫌',
	'supne;': '⊋',
	'supplus;': '⫀',
	'supset;': '⊃',
	'supseteq;': '⊇',
	'supseteqq;': '⫆',
	'supsetneq;': '⊋',
	'supsetneqq;': '⫌',
	'supsim;': '⫈',
	'supsub;': '⫔',
	'supsup;': '⫖',
	'swArr;': '⇙',
	'swarhk;': '⤦',
	'swarr;': '↙',
	'swarrow;': '↙',
	'swnwar;': '⤪',
	szlig: 'ß',
	'szlig;': 'ß',
	'target;': '⌖',
	'tau;': 'τ',
	'tbrk;': '⎴',
	'tcaron;': 'ť',
	'tcedil;': 'ţ',
	'tcy;': 'т',
	'tdot;': '⃛',
	'telrec;': '⌕',
	'tfr;': '𝔱',
	'there4;': '∴',
	'therefore;': '∴',
	'theta;': 'θ',
	'thetasym;': 'ϑ',
	'thetav;': 'ϑ',
	'thickapprox;': '≈',
	'thicksim;': '∼',
	'thinsp;': ' ',
	'thkap;': '≈',
	'thksim;': '∼',
	thorn: 'þ',
	'thorn;': 'þ',
	'tilde;': '˜',
	times: '×',
	'times;': '×',
	'timesb;': '⊠',
	'timesbar;': '⨱',
	'timesd;': '⨰',
	'tint;': '∭',
	'toea;': '⤨',
	'top;': '⊤',
	'topbot;': '⌶',
	'topcir;': '⫱',
	'topf;': '𝕥',
	'topfork;': '⫚',
	'tosa;': '⤩',
	'tprime;': '‴',
	'trade;': '™',
	'triangle;': '▵',
	'triangledown;': '▿',
	'triangleleft;': '◃',
	'trianglelefteq;': '⊴',
	'triangleq;': '≜',
	'triangleright;': '▹',
	'trianglerighteq;': '⊵',
	'tridot;': '◬',
	'trie;': '≜',
	'triminus;': '⨺',
	'triplus;': '⨹',
	'trisb;': '⧍',
	'tritime;': '⨻',
	'trpezium;': '⏢',
	'tscr;': '𝓉',
	'tscy;': 'ц',
	'tshcy;': 'ћ',
	'tstrok;': 'ŧ',
	'twixt;': '≬',
	'twoheadleftarrow;': '↞',
	'twoheadrightarrow;': '↠',
	'uArr;': '⇑',
	'uHar;': '⥣',
	uacute: 'ú',
	'uacute;': 'ú',
	'uarr;': '↑',
	'ubrcy;': 'ў',
	'ubreve;': 'ŭ',
	ucirc: 'û',
	'ucirc;': 'û',
	'ucy;': 'у',
	'udarr;': '⇅',
	'udblac;': 'ű',
	'udhar;': '⥮',
	'ufisht;': '⥾',
	'ufr;': '𝔲',
	ugrave: 'ù',
	'ugrave;': 'ù',
	'uharl;': '↿',
	'uharr;': '↾',
	'uhblk;': '▀',
	'ulcorn;': '⌜',
	'ulcorner;': '⌜',
	'ulcrop;': '⌏',
	'ultri;': '◸',
	'umacr;': 'ū',
	uml: '¨',
	'uml;': '¨',
	'uogon;': 'ų',
	'uopf;': '𝕦',
	'uparrow;': '↑',
	'updownarrow;': '↕',
	'upharpoonleft;': '↿',
	'upharpoonright;': '↾',
	'uplus;': '⊎',
	'upsi;': 'υ',
	'upsih;': 'ϒ',
	'upsilon;': 'υ',
	'upuparrows;': '⇈',
	'urcorn;': '⌝',
	'urcorner;': '⌝',
	'urcrop;': '⌎',
	'uring;': 'ů',
	'urtri;': '◹',
	'uscr;': '𝓊',
	'utdot;': '⋰',
	'utilde;': 'ũ',
	'utri;': '▵',
	'utrif;': '▴',
	'uuarr;': '⇈',
	uuml: 'ü',
	'uuml;': 'ü',
	'uwangle;': '⦧',
	'vArr;': '⇕',
	'vBar;': '⫨',
	'vBarv;': '⫩',
	'vDash;': '⊨',
	'vangrt;': '⦜',
	'varepsilon;': 'ϵ',
	'varkappa;': 'ϰ',
	'varnothing;': '∅',
	'varphi;': 'ϕ',
	'varpi;': 'ϖ',
	'varpropto;': '∝',
	'varr;': '↕',
	'varrho;': 'ϱ',
	'varsigma;': 'ς',
	'varsubsetneq;': '⊊︀',
	'varsubsetneqq;': '⫋︀',
	'varsupsetneq;': '⊋︀',
	'varsupsetneqq;': '⫌︀',
	'vartheta;': 'ϑ',
	'vartriangleleft;': '⊲',
	'vartriangleright;': '⊳',
	'vcy;': 'в',
	'vdash;': '⊢',
	'vee;': '∨',
	'veebar;': '⊻',
	'veeeq;': '≚',
	'vellip;': '⋮',
	'verbar;': '|',
	'vert;': '|',
	'vfr;': '𝔳',
	'vltri;': '⊲',
	'vnsub;': '⊂⃒',
	'vnsup;': '⊃⃒',
	'vopf;': '𝕧',
	'vprop;': '∝',
	'vrtri;': '⊳',
	'vscr;': '𝓋',
	'vsubnE;': '⫋︀',
	'vsubne;': '⊊︀',
	'vsupnE;': '⫌︀',
	'vsupne;': '⊋︀',
	'vzigzag;': '⦚',
	'wcirc;': 'ŵ',
	'wedbar;': '⩟',
	'wedge;': '∧',
	'wedgeq;': '≙',
	'weierp;': '℘',
	'wfr;': '𝔴',
	'wopf;': '𝕨',
	'wp;': '℘',
	'wr;': '≀',
	'wreath;': '≀',
	'wscr;': '𝓌',
	'xcap;': '⋂',
	'xcirc;': '◯',
	'xcup;': '⋃',
	'xdtri;': '▽',
	'xfr;': '𝔵',
	'xhArr;': '⟺',
	'xharr;': '⟷',
	'xi;': 'ξ',
	'xlArr;': '⟸',
	'xlarr;': '⟵',
	'xmap;': '⟼',
	'xnis;': '⋻',
	'xodot;': '⨀',
	'xopf;': '𝕩',
	'xoplus;': '⨁',
	'xotime;': '⨂',
	'xrArr;': '⟹',
	'xrarr;': '⟶',
	'xscr;': '𝓍',
	'xsqcup;': '⨆',
	'xuplus;': '⨄',
	'xutri;': '△',
	'xvee;': '⋁',
	'xwedge;': '⋀',
	yacute: 'ý',
	'yacute;': 'ý',
	'yacy;': 'я',
	'ycirc;': 'ŷ',
	'ycy;': 'ы',
	yen: '¥',
	'yen;': '¥',
	'yfr;': '𝔶',
	'yicy;': 'ї',
	'yopf;': '𝕪',
	'yscr;': '𝓎',
	'yucy;': 'ю',
	yuml: 'ÿ',
	'yuml;': 'ÿ',
	'zacute;': 'ź',
	'zcaron;': 'ž',
	'zcy;': 'з',
	'zdot;': 'ż',
	'zeetrf;': 'ℨ',
	'zeta;': 'ζ',
	'zfr;': '𝔷',
	'zhcy;': 'ж',
	'zigrarr;': '⇝',
	'zopf;': '𝕫',
	'zscr;': '𝓏',
	'zwj;': '‍',
	'zwnj;': '‌'
};

const numeric = /&#(x)?([0-9a-f]+);/i;
const named = new RegExp(
	`&(${Object.keys(entities)
		.sort((a, b) => b.length - a.length)
		.join('|')})`,
	'g'
);

/** @param {string} str */
export function decode(str) {
	return str
		.replace(numeric, (_match, hex, code) => String.fromCharCode(hex ? parseInt(code, 16) : +code))
		.replace(named, (_match, entity) => entities[entity]);
}

```


####### packages/kit/src/core/postbuild/entities.spec.js #######

```

import { assert, test } from 'vitest';
import { decode } from './entities.js';

/*
Test cases shamelessly stolen from https://github.com/fb55/entities/blob/main/src/decode.spec.ts
Reproduced under BSD 2 license
---
Copyright (c) Felix Böhm
All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

THIS IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS,
EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

const tests = [
	{ input: '&amp;amp;', output: '&amp;' },
	{ input: '&amp;#38;', output: '&#38;' },
	{ input: '&amp;#x26;', output: '&#x26;' },
	{ input: '&amp;#X26;', output: '&#X26;' },
	{ input: '&#38;#38;', output: '&#38;' },
	{ input: '&#x26;#38;', output: '&#38;' },
	{ input: '&#X26;#38;', output: '&#38;' },
	{ input: '&#x3a;', output: ':' },
	{ input: '&#x3A;', output: ':' },
	{ input: '&#X3a;', output: ':' },
	{ input: '&#X3A;', output: ':' },
	{ input: '&>', output: '&>' },
	{ input: 'id=770&#anchor', output: 'id=770&#anchor' }
];

for (const { input, output } of tests) {
	test(input, () => {
		assert.equal(decode(input), output);
	});
}

test('should HTML decode partial legacy entity', () => {
	assert.equal(decode('&timesbar'), '×bar');
});

test('should HTML decode legacy entities according to spec', () => {
	assert.equal(decode('?&image_uri=1&ℑ=2&image=3'), '?&image_uri=1&ℑ=2&image=3');
});

test('should back out of legacy entities', () => {
	assert.equal(decode('&ampa'), '&a');
});

test('should parse &nbsp followed by < (#852)', () => {
	assert.equal(decode('&nbsp<'), '\u00a0<');
});

```


####### packages/kit/src/core/postbuild/fallback.js #######

```

import { readFileSync } from 'node:fs';
import { join } from 'node:path';
import { pathToFileURL } from 'node:url';
import { installPolyfills } from '../../exports/node/polyfills.js';
import { load_config } from '../config/index.js';
import { forked } from '../../utils/fork.js';

export default forked(import.meta.url, generate_fallback);

/**
 * @param {{
 *   manifest_path: string;
 *   env: Record<string, string>
 * }} opts
 */
async function generate_fallback({ manifest_path, env }) {
	/** @type {import('types').ValidatedKitConfig} */
	const config = (await load_config()).kit;

	installPolyfills();

	const server_root = join(config.outDir, 'output');

	/** @type {import('types').ServerInternalModule} */
	const { set_building } = await import(pathToFileURL(`${server_root}/server/internal.js`).href);

	/** @type {import('types').ServerModule} */
	const { Server } = await import(pathToFileURL(`${server_root}/server/index.js`).href);

	/** @type {import('@sveltejs/kit').SSRManifest} */
	const manifest = (await import(pathToFileURL(manifest_path).href)).manifest;

	set_building();

	const server = new Server(manifest);
	await server.init({ env });

	const response = await server.respond(new Request(config.prerender.origin + '/[fallback]'), {
		getClientAddress: () => {
			throw new Error('Cannot read clientAddress during prerendering');
		},
		prerendering: {
			fallback: true,
			dependencies: new Map()
		},
		read: (file) => readFileSync(join(config.files.assets, file))
	});

	if (response.ok) {
		return await response.text();
	}

	throw new Error(`Could not create a fallback page — failed with status ${response.status}`);
}

```


####### packages/kit/src/core/postbuild/fixtures/base/input.html #######

```

<!DOCTYPE html>
<html>
	<head>
		<base href="/base-path/" />
		<link rel="stylesheet" href="styles.css" />
		<link rel="icon" href="favicon.png" />
	</head>
	<body>
		<a href="https://external.com">https://external.com</a>
		<a href="wheee">/wheee</a>
		<a data-sveltekit-prefetch href="wheee2">/wheee</a>
		<a href="wheee3" data-sveltekit-prefetch>/wheee</a>
		<a href="wheee4">/wheee</a>
	</body>
</html>

```


####### packages/kit/src/core/postbuild/fixtures/base/output.json #######

```

{
	"hrefs": [
		"/base-path/styles.css",
		"/base-path/favicon.png",
		"https://external.com/",
		"/base-path/wheee",
		"/base-path/wheee2",
		"/base-path/wheee3",
		"/base-path/wheee4"
	],
	"ids": []
}

```


####### packages/kit/src/core/postbuild/fixtures/basic-href/input.html #######

```

<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="/styles.css" />
		<link rel="icon" href="/favicon.png" />
	</head>
	<body>
		<a href="https://external.com">https://external.com</a>
		<a href="/wheee">/wheee</a>
		<a data-sveltekit-prefetch href="/wheee2">/wheee</a>
		<a href="/wheee3" data-sveltekit-prefetch>/wheee</a>
		<a href="/wheee4">/wheee</a>
	</body>
</html>

```


####### packages/kit/src/core/postbuild/fixtures/basic-href/output.json #######

```

{
	"hrefs": [
		"/styles.css",
		"/favicon.png",
		"https://external.com/",
		"/wheee",
		"/wheee2",
		"/wheee3",
		"/wheee4"
	],
	"ids": []
}

```


####### packages/kit/src/core/postbuild/fixtures/basic-src/input.html #######

```

<!DOCTYPE html>
<html>
	<head></head>
	<body>
		<img alt="A potato" src="/potato.jpg" />
		<img alt="empty" src="" />
	</body>
</html>

```


####### packages/kit/src/core/postbuild/fixtures/basic-src/output.json #######

```

{
	"hrefs": ["/potato.jpg"],
	"ids": []
}

```


####### packages/kit/src/core/postbuild/fixtures/basic-srcset/input.html #######

```

<!DOCTYPE html>
<html>
	<head></head>
	<body>
		<img
			alt="A header"
			src="header.png"
			srcset="https://example.com/w_200,q_100/header.png 200w, header640.png 640w, header960.png 960w, header1024.png 1024w, header.png"
		/>
		<img
			alt="Troublesome srcset"
			src="issue-9369.png"
			srcset="/issue-9369_newline-after-comma-is-bad.png,
							/issue-9369_800px.png 800,"
		/>
	</body>
</html>

```


####### packages/kit/src/core/postbuild/fixtures/basic-srcset/output.json #######

```

{
	"hrefs": [
		"/header.png",
		"https://example.com/w_200,q_100/header.png",
		"/header640.png",
		"/header960.png",
		"/header1024.png",
		"/header.png",
		"/issue-9369.png",
		"/issue-9369_newline-after-comma-is-bad.png",
		"/issue-9369_800px.png"
	],
	"ids": []
}

```


####### packages/kit/src/core/postbuild/fixtures/href-with-character-reference/input.html #######

```

<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="/styles.css" />
		<link rel="icon" href="/favicon.png" />
	</head>
	<body>
		<a href="/test&amp;ampersand">/test&amp;ampersand</a>
		<a href="/test&quot;quotation">/test&quot;quotation</a>
		<a href="/test&#9825;decimal">/test&#9825;decimal</a>
		<a href="/test&#x2665;hex">/test&#x2665;hex</a>
	</body>
</html>

```


####### packages/kit/src/core/postbuild/fixtures/href-with-character-reference/output.json #######

```

{
	"hrefs": [
		"/styles.css",
		"/favicon.png",
		"/test&ampersand",
		"/test%22quotation",
		"/test%E2%99%A1decimal",
		"/test%E2%99%A5hex"
	],
	"ids": []
}

```


####### packages/kit/src/core/postbuild/fixtures/ids/input.html #######

```

<h2 id="before">before</h2>
<span data-x='"\\"'>backslash</span>
<h2 id="after">after</h2>
<h2 id="encöded">
	<a href="#encöded">encöded</a>
</h2>

```


####### packages/kit/src/core/postbuild/fixtures/ids/output.json #######

```

{
	"hrefs": ["/#enc%C3%B6ded"],
	"ids": ["before", "after", "encöded"]
}

```


####### packages/kit/src/core/postbuild/fixtures/include-rel-external/input.html #######

```

<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="/styles.css" />
		<link rel="icon" href="/favicon.png" />
	</head>
	<body>
		<a href="https://external.com">https://external.com</a>
		<a href="/wheee" rel="external">/wheee</a>
	</body>
</html>

```


####### packages/kit/src/core/postbuild/fixtures/include-rel-external/output.json #######

```

{
	"hrefs": ["/styles.css", "/favicon.png", "https://external.com/"],
	"ids": []
}

```


####### packages/kit/src/core/postbuild/fixtures/meta/input.html #######

```

<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="description" content="This is a description" />

		<!--Only these should get crawled-->
		<meta content="https://external.com" name="twitter:image" />
		<meta name="og:image" content="/og-image.jpg" />
		<meta property="og:audio" content="https://example.com/audio.mp3" />
		<meta content="/video.mp4" property="og:video"/>
	</head>
	<body></body>
</html>

```


####### packages/kit/src/core/postbuild/fixtures/meta/output.json #######

```

{
	"hrefs": [
		"https://external.com/",
		"/og-image.jpg",
		"https://example.com/audio.mp3",
		"/video.mp4"
	],
	"ids": []
}

```


####### packages/kit/src/core/postbuild/fixtures/unquoted-attributes/input.html #######

```

<!DOCTYPE html>
<html>
	<head>
		<link rel=stylesheet href=/styles.css /> <link rel=icon href=/favicon.png />
	</head>
	<body>
		<a href=https://external.com>https://external.com</a>
		<a href=/wheee>/wheee</a>
	</body>
</html>

```


####### packages/kit/src/core/postbuild/fixtures/unquoted-attributes/output.json #######

```

{
	"hrefs": ["/styles.css", "/favicon.png", "https://external.com/", "/wheee"],
	"ids": []
}

```


####### packages/kit/src/core/postbuild/prerender.js #######

```

import { existsSync, readFileSync, statSync, writeFileSync } from 'node:fs';
import { dirname, join } from 'node:path';
import { pathToFileURL } from 'node:url';
import { installPolyfills } from '../../exports/node/polyfills.js';
import { mkdirp, posixify, walk } from '../../utils/filesystem.js';
import { decode_uri, is_root_relative, resolve } from '../../utils/url.js';
import { escape_html_attr } from '../../utils/escape.js';
import { logger } from '../utils.js';
import { load_config } from '../config/index.js';
import { get_route_segments } from '../../utils/routing.js';
import { queue } from './queue.js';
import { crawl } from './crawl.js';
import { forked } from '../../utils/fork.js';
import * as devalue from 'devalue';
import { createReadableStream } from '@sveltejs/kit/node';

export default forked(import.meta.url, prerender);

/**
 * @param {{
 *   out: string;
 *   manifest_path: string;
 *   metadata: import('types').ServerMetadata;
 *   verbose: boolean;
 *   env: Record<string, string>
 * }} opts
 */
async function prerender({ out, manifest_path, metadata, verbose, env }) {
	/** @type {import('@sveltejs/kit').SSRManifest} */
	const manifest = (await import(pathToFileURL(manifest_path).href)).manifest;

	/** @type {import('types').ServerInternalModule} */
	const internal = await import(pathToFileURL(`${out}/server/internal.js`).href);

	/** @type {import('types').ServerModule} */
	const { Server } = await import(pathToFileURL(`${out}/server/index.js`).href);

	// configure `import { building } from '$app/environment'` —
	// essential we do this before analysing the code
	internal.set_building();
	internal.set_prerendering();

	/**
	 * @template {{message: string}} T
	 * @template {Omit<T, 'message'>} K
	 * @param {import('types').Logger} log
	 * @param {'fail' | 'warn' | 'ignore' | ((details: T) => void)} input
	 * @param {(details: K) => string} format
	 * @returns {(details: K) => void}
	 */
	function normalise_error_handler(log, input, format) {
		switch (input) {
			case 'fail':
				return (details) => {
					throw new Error(format(details));
				};
			case 'warn':
				return (details) => {
					log.error(format(details));
				};
			case 'ignore':
				return () => {};
			default:
				// @ts-expect-error TS thinks T might be of a different kind, but it's not
				return (details) => input({ ...details, message: format(details) });
		}
	}

	const OK = 2;
	const REDIRECT = 3;

	/** @type {import('types').Prerendered} */
	const prerendered = {
		pages: new Map(),
		assets: new Map(),
		redirects: new Map(),
		paths: []
	};

	/** @type {import('types').PrerenderMap} */
	const prerender_map = new Map();

	for (const [id, { prerender }] of metadata.routes) {
		if (prerender !== undefined) {
			prerender_map.set(id, prerender);
		}
	}

	/** @type {Set<string>} */
	const prerendered_routes = new Set();

	/** @type {import('types').ValidatedKitConfig} */
	const config = (await load_config()).kit;

	const emulator = await config.adapter?.emulate?.();

	/** @type {import('types').Logger} */
	const log = logger({ verbose });

	installPolyfills();

	/** @type {Map<string, string>} */
	const saved = new Map();

	const handle_http_error = normalise_error_handler(
		log,
		config.prerender.handleHttpError,
		({ status, path, referrer, referenceType }) => {
			const message =
				status === 404 && !path.startsWith(config.paths.base)
					? `${path} does not begin with \`base\`, which is configured in \`paths.base\` and can be imported from \`$app/paths\` - see https://kit.svelte.dev/docs/configuration#paths for more info`
					: path;

			return `${status} ${message}${referrer ? ` (${referenceType} from ${referrer})` : ''}`;
		}
	);

	const handle_missing_id = normalise_error_handler(
		log,
		config.prerender.handleMissingId,
		({ path, id, referrers }) => {
			return (
				`The following pages contain links to ${path}#${id}, but no element with id="${id}" exists on ${path} - see the \`handleMissingId\` option in https://kit.svelte.dev/docs/configuration#prerender for more info:` +
				referrers.map((l) => `\n  - ${l}`).join('')
			);
		}
	);

	const handle_entry_generator_mismatch = normalise_error_handler(
		log,
		config.prerender.handleEntryGeneratorMismatch,
		({ generatedFromId, entry, matchedId }) => {
			return `The entries export from ${generatedFromId} generated entry ${entry}, which was matched by ${matchedId} - see the \`handleEntryGeneratorMismatch\` option in https://kit.svelte.dev/docs/configuration#prerender for more info.`;
		}
	);

	const q = queue(config.prerender.concurrency);

	/**
	 * @param {string} path
	 * @param {boolean} is_html
	 */
	function output_filename(path, is_html) {
		const file = path.slice(config.paths.base.length + 1) || 'index.html';

		if (is_html && !file.endsWith('.html')) {
			return file + (file.endsWith('/') ? 'index.html' : '.html');
		}

		return file;
	}

	const files = new Set(walk(`${out}/client`).map(posixify));
	files.add(`${config.appDir}/env.js`);

	const immutable = `${config.appDir}/immutable`;
	if (existsSync(`${out}/server/${immutable}`)) {
		for (const file of walk(`${out}/server/${immutable}`)) {
			files.add(posixify(`${config.appDir}/immutable/${file}`));
		}
	}
	const seen = new Set();
	const written = new Set();

	/** @type {Map<string, Set<string>>} */
	const expected_hashlinks = new Map();

	/** @type {Map<string, string[]>} */
	const actual_hashlinks = new Map();

	/**
	 * @param {string | null} referrer
	 * @param {string} decoded
	 * @param {string} [encoded]
	 * @param {string} [generated_from_id]
	 */
	function enqueue(referrer, decoded, encoded, generated_from_id) {
		if (seen.has(decoded)) return;
		seen.add(decoded);

		const file = decoded.slice(config.paths.base.length + 1);
		if (files.has(file)) return;

		return q.add(() => visit(decoded, encoded || encodeURI(decoded), referrer, generated_from_id));
	}

	/**
	 * @param {string} decoded
	 * @param {string} encoded
	 * @param {string?} referrer
	 * @param {string} [generated_from_id]
	 */
	async function visit(decoded, encoded, referrer, generated_from_id) {
		if (!decoded.startsWith(config.paths.base)) {
			handle_http_error({ status: 404, path: decoded, referrer, referenceType: 'linked' });
			return;
		}

		/** @type {Map<string, import('types').PrerenderDependency>} */
		const dependencies = new Map();

		const response = await server.respond(new Request(config.prerender.origin + encoded), {
			getClientAddress() {
				throw new Error('Cannot read clientAddress during prerendering');
			},
			prerendering: {
				dependencies
			},
			read: (file) => {
				// stuff we just wrote
				const filepath = saved.get(file);
				if (filepath) return readFileSync(filepath);

				// stuff in `static`
				return readFileSync(join(config.files.assets, file));
			},
			emulator
		});

		const encoded_id = response.headers.get('x-sveltekit-routeid');
		const decoded_id = encoded_id && decode_uri(encoded_id);
		if (
			decoded_id !== null &&
			generated_from_id !== undefined &&
			decoded_id !== generated_from_id
		) {
			handle_entry_generator_mismatch({
				generatedFromId: generated_from_id,
				entry: decoded,
				matchedId: decoded_id
			});
		}

		const body = Buffer.from(await response.arrayBuffer());

		save('pages', response, body, decoded, encoded, referrer, 'linked');

		for (const [dependency_path, result] of dependencies) {
			// this seems circuitous, but using new URL allows us to not care
			// whether dependency_path is encoded or not
			const encoded_dependency_path = new URL(dependency_path, 'http://localhost').pathname;
			const decoded_dependency_path = decode_uri(encoded_dependency_path);

			const headers = Object.fromEntries(result.response.headers);

			const prerender = headers['x-sveltekit-prerender'];
			if (prerender) {
				const encoded_route_id = headers['x-sveltekit-routeid'];
				if (encoded_route_id != null) {
					const route_id = decode_uri(encoded_route_id);
					const existing_value = prerender_map.get(route_id);
					if (existing_value !== 'auto') {
						prerender_map.set(route_id, prerender === 'true' ? true : 'auto');
					}
				}
			}

			const body = result.body ?? new Uint8Array(await result.response.arrayBuffer());

			save(
				'dependencies',
				result.response,
				body,
				decoded_dependency_path,
				encoded_dependency_path,
				decoded,
				'fetched'
			);
		}

		// avoid triggering `filterSerializeResponseHeaders` guard
		const headers = Object.fromEntries(response.headers);

		if (config.prerender.crawl && headers['content-type'] === 'text/html') {
			const { ids, hrefs } = crawl(body.toString(), decoded);

			actual_hashlinks.set(decoded, ids);

			for (const href of hrefs) {
				if (!is_root_relative(href)) continue;

				const { pathname, search, hash } = new URL(href, 'http://localhost');

				if (search) {
					// TODO warn that query strings have no effect on statically-exported pages
				}

				if (hash) {
					const key = decode_uri(pathname + hash);

					if (!expected_hashlinks.has(key)) {
						expected_hashlinks.set(key, new Set());
					}

					/** @type {Set<string>} */ (expected_hashlinks.get(key)).add(decoded);
				}

				enqueue(decoded, decode_uri(pathname), pathname);
			}
		}
	}

	/**
	 * @param {'pages' | 'dependencies'} category
	 * @param {Response} response
	 * @param {string | Uint8Array} body
	 * @param {string} decoded
	 * @param {string} encoded
	 * @param {string | null} referrer
	 * @param {'linked' | 'fetched'} referenceType
	 */
	function save(category, response, body, decoded, encoded, referrer, referenceType) {
		const response_type = Math.floor(response.status / 100);
		const headers = Object.fromEntries(response.headers);

		const type = headers['content-type'];
		const is_html = response_type === REDIRECT || type === 'text/html';

		const file = output_filename(decoded, is_html);
		const dest = `${config.outDir}/output/prerendered/${category}/${file}`;

		if (written.has(file)) return;

		const encoded_route_id = response.headers.get('x-sveltekit-routeid');
		const route_id = encoded_route_id != null ? decode_uri(encoded_route_id) : null;
		if (route_id !== null) prerendered_routes.add(route_id);

		if (response_type === REDIRECT) {
			const location = headers['location'];

			if (location) {
				const resolved = resolve(encoded, location);
				if (is_root_relative(resolved)) {
					enqueue(decoded, decode_uri(resolved), resolved);
				}

				if (!headers['x-sveltekit-normalize']) {
					mkdirp(dirname(dest));

					log.warn(`${response.status} ${decoded} -> ${location}`);

					writeFileSync(
						dest,
						`<script>location.href=${devalue.uneval(
							location
						)};</script><meta http-equiv="refresh" content=${escape_html_attr(
							`0;url=${location}`
						)}>`
					);

					written.add(file);

					if (!prerendered.redirects.has(decoded)) {
						prerendered.redirects.set(decoded, {
							status: response.status,
							location: resolved
						});

						prerendered.paths.push(decoded);
					}
				}
			} else {
				log.warn(`location header missing on redirect received from ${decoded}`);
			}

			return;
		}

		if (response.status === 200) {
			if (existsSync(dest) && statSync(dest).isDirectory()) {
				throw new Error(
					`Cannot save ${decoded} as it is already a directory. See https://kit.svelte.dev/docs/page-options#prerender-route-conflicts for more information`
				);
			}

			const dir = dirname(dest);

			if (existsSync(dir) && !statSync(dir).isDirectory()) {
				const parent = decoded.split('/').slice(0, -1).join('/');
				throw new Error(
					`Cannot save ${decoded} as ${parent} is already a file. See https://kit.svelte.dev/docs/page-options#prerender-route-conflicts for more information`
				);
			}

			mkdirp(dir);

			log.info(`${response.status} ${decoded}`);
			writeFileSync(dest, body);
			written.add(file);

			if (is_html) {
				prerendered.pages.set(decoded, {
					file
				});
			} else {
				prerendered.assets.set(decoded, {
					type
				});
			}

			prerendered.paths.push(decoded);
		} else if (response_type !== OK) {
			handle_http_error({ status: response.status, path: decoded, referrer, referenceType });
		}

		manifest.assets.add(file);
		saved.set(file, dest);
	}

	/** @type {Array<{ id: string, entries: Array<string>}>} */
	const route_level_entries = [];
	for (const [id, { entries }] of metadata.routes.entries()) {
		if (entries) {
			route_level_entries.push({ id, entries });
		}
	}

	let has_prerenderable_routes = false;

	for (const value of prerender_map.values()) {
		if (value) {
			has_prerenderable_routes = true;
			break;
		}
	}

	if (
		(config.prerender.entries.length === 0 && route_level_entries.length === 0) ||
		!has_prerenderable_routes
	) {
		return { prerendered, prerender_map };
	}

	log.info('Prerendering');

	const server = new Server(manifest);
	await server.init({
		env,
		read: (file) => createReadableStream(`${config.outDir}/output/server/${file}`)
	});

	for (const entry of config.prerender.entries) {
		if (entry === '*') {
			for (const [id, prerender] of prerender_map) {
				if (prerender) {
					// remove optional parameters from the route
					const segments = get_route_segments(id).filter((segment) => !segment.startsWith('[['));
					const processed_id = '/' + segments.join('/');

					if (processed_id.includes('[')) continue;
					const path = `/${get_route_segments(processed_id).join('/')}`;
					enqueue(null, config.paths.base + path);
				}
			}
		} else {
			enqueue(null, config.paths.base + entry);
		}
	}

	for (const { id, entries } of route_level_entries) {
		for (const entry of entries) {
			enqueue(null, config.paths.base + entry, undefined, id);
		}
	}

	await q.done();

	// handle invalid fragment links
	for (const [key, referrers] of expected_hashlinks) {
		const index = key.indexOf('#');
		const path = key.slice(0, index);
		const id = key.slice(index + 1);

		const hashlinks = actual_hashlinks.get(path);
		// ignore fragment links to pages that were not prerendered
		if (!hashlinks) continue;

		if (!hashlinks.includes(id)) {
			handle_missing_id({ id, path, referrers: Array.from(referrers) });
		}
	}

	/** @type {string[]} */
	const not_prerendered = [];

	for (const [route_id, prerender] of prerender_map) {
		if (prerender === true && !prerendered_routes.has(route_id)) {
			not_prerendered.push(route_id);
		}
	}

	if (not_prerendered.length > 0) {
		const list = not_prerendered.map((id) => `  - ${id}`).join('\n');

		throw new Error(
			`The following routes were marked as prerenderable, but were not prerendered because they were not found while crawling your app:\n${list}\n\nSee https://kit.svelte.dev/docs/page-options#prerender-troubleshooting for info on how to solve this`
		);
	}

	return { prerendered, prerender_map };
}

```


####### packages/kit/src/core/postbuild/queue.js #######

```

/**
 * @typedef {{
 *   fn: () => Promise<any>,
 *   fulfil: (value: any) => void,
 *   reject: (error: Error) => void
 * }} Task
 */

/** @param {number} concurrency */
export function queue(concurrency) {
	/** @type {Task[]} */
	const tasks = [];

	let current = 0;

	/** @type {(value?: any) => void} */
	let fulfil;

	/** @type {(error: Error) => void} */
	let reject;

	let closed = false;

	const done = new Promise((f, r) => {
		fulfil = f;
		reject = r;
	});

	done.catch(() => {
		// this is necessary in case a catch handler is never added
		// to the done promise by the user
	});

	function dequeue() {
		if (current < concurrency) {
			const task = tasks.shift();

			if (task) {
				current += 1;
				const promise = Promise.resolve(task.fn());

				promise
					.then(task.fulfil, (err) => {
						task.reject(err);
						reject(err);
					})
					.then(() => {
						current -= 1;
						dequeue();
					});
			} else if (current === 0) {
				closed = true;
				fulfil();
			}
		}
	}

	return {
		/** @param {() => any} fn */
		add: (fn) => {
			if (closed) throw new Error('Cannot add tasks to a queue that has ended');

			const promise = new Promise((fulfil, reject) => {
				tasks.push({ fn, fulfil, reject });
			});

			dequeue();
			return promise;
		},

		done: () => {
			if (current === 0) {
				closed = true;
				fulfil();
			}

			return done;
		}
	};
}

```


####### packages/kit/src/core/postbuild/queue.spec.js #######

```

import { assert, expect, test } from 'vitest';
import { queue } from './queue.js';

/** @param {number} ms */
function sleep(ms) {
	return new Promise((f) => setTimeout(f, ms));
}

test('q.add resolves to the correct value', async () => {
	const q = queue(1);

	const value = await q.add(() => 42);
	assert.equal(value, 42);
});

test('q.add rejects if task rejects', async () => {
	const q = queue(1);

	try {
		await q.add(async () => {
			await sleep(1);
			throw new Error('nope');
		});

		assert.ok(false);
	} catch (e) {
		assert.equal(/** @type {Error} */ (e).message, 'nope');
	}
});

test('starts tasks in sequence', async () => {
	const q = queue(2);

	const promises = [];

	/** @type {Array<(value?: any) => void>} */
	const fulfils = [];

	const started = [false, false, false, false];
	const finished = [false, false, false, false];

	for (let i = 0; i < 4; i += 1) {
		promises[i] = q
			.add(() => {
				started[i] = true;
				return new Promise((f) => {
					fulfils.push(f);
				});
			})
			.then(() => {
				finished[i] = true;
			});
	}

	expect(started).toEqual([true, true, false, false]);
	expect(finished).toEqual([false, false, false, false]);

	fulfils[0]();
	await promises[0];

	expect(started).toEqual([true, true, true, false]);
	expect(finished).toEqual([true, false, false, false]);

	fulfils[1]();
	await promises[1];

	expect(started).toEqual([true, true, true, true]);
	expect(finished).toEqual([true, true, false, false]);

	fulfils[2]();
	fulfils[3]();
	await q.done();

	expect(finished).toEqual([true, true, true, true]);
});

test('q.add fails if queue is already finished', async () => {
	const q = queue(1);
	q.add(() => {});

	await q.done();
	assert.throws(() => q.add(() => {}), /Cannot add tasks to a queue that has ended/);
});

test('q.done() resolves if nothing was added to the queue', async () => {
	const q = queue(100);
	await Promise.race([
		q.done(),
		sleep(1).then(() => {
			throw new Error('Timed out');
		})
	]);
});

test('q.done() rejects if task rejects', async () => {
	const q = queue(1);

	q.add(async () => {
		await sleep(1);
		throw new Error('nope');
	}).catch((e) => {
		assert.equal(e.message, 'nope');
	});

	try {
		await q.done();
		assert.ok(false);
	} catch (e) {
		assert.equal(/** @type {Error} */ (e).message, 'nope');
	}
});

```


####### packages/kit/src/core/sync/create_manifest_data/conflict.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/index.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import colors from 'kleur';
import { lookup } from 'mrmime';
import { list_files, runtime_directory } from '../../utils.js';
import { posixify, resolve_entry } from '../../../utils/filesystem.js';
import { parse_route_id } from '../../../utils/routing.js';
import { sort_routes } from './sort.js';

/**
 * Generates the manifest data used for the client-side manifest and types generation.
 * @param {{
 *   config: import('types').ValidatedConfig;
 *   fallback?: string;
 *   cwd?: string;
 * }} opts
 * @returns {import('types').ManifestData}
 */
export default function create_manifest_data({
	config,
	fallback = `${runtime_directory}/components`,
	cwd = process.cwd()
}) {
	const assets = create_assets(config);
	const hooks = create_hooks(config, cwd);
	const matchers = create_matchers(config, cwd);
	const { nodes, routes } = create_routes_and_nodes(cwd, config, fallback);

	for (const route of routes) {
		for (const param of route.params) {
			if (param.matcher && !matchers[param.matcher]) {
				throw new Error(`No matcher found for parameter '${param.matcher}' in route ${route.id}`);
			}
		}
	}

	return {
		assets,
		hooks,
		matchers,
		nodes,
		routes
	};
}

/**
 * @param {import('types').ValidatedConfig} config
 */
export function create_assets(config) {
	return list_files(config.kit.files.assets).map((file) => ({
		file,
		size: fs.statSync(path.resolve(config.kit.files.assets, file)).size,
		type: lookup(file) || null
	}));
}

/**
 * @param {import('types').ValidatedConfig} config
 * @param {string} cwd
 */
function create_hooks(config, cwd) {
	const client = resolve_entry(config.kit.files.hooks.client);
	const server = resolve_entry(config.kit.files.hooks.server);
	const universal = resolve_entry(config.kit.files.hooks.universal);

	return {
		client: client && posixify(path.relative(cwd, client)),
		server: server && posixify(path.relative(cwd, server)),
		universal: universal && posixify(path.relative(cwd, universal))
	};
}

/**
 * @param {import('types').ValidatedConfig} config
 * @param {string} cwd
 */
function create_matchers(config, cwd) {
	const params_base = path.relative(cwd, config.kit.files.params);

	/** @type {Record<string, string>} */
	const matchers = {};
	if (fs.existsSync(config.kit.files.params)) {
		for (const file of fs.readdirSync(config.kit.files.params)) {
			const ext = path.extname(file);
			if (!config.kit.moduleExtensions.includes(ext)) continue;
			const type = file.slice(0, -ext.length);

			if (/^\w+$/.test(type)) {
				const matcher_file = path.join(params_base, file);

				// Disallow same matcher with different extensions
				if (matchers[type]) {
					throw new Error(`Duplicate matchers: ${matcher_file} and ${matchers[type]}`);
				} else {
					matchers[type] = matcher_file;
				}
			} else {
				// Allow for matcher test collocation
				if (type.endsWith('.test') || type.endsWith('.spec')) continue;

				throw new Error(
					`Matcher names can only have underscores and alphanumeric characters — "${file}" is invalid`
				);
			}
		}
	}

	return matchers;
}

/**
 * @param {import('types').ValidatedConfig} config
 * @param {string} cwd
 * @param {string} fallback
 */
function create_routes_and_nodes(cwd, config, fallback) {
	/** @type {import('types').RouteData[]} */
	const routes = [];

	const routes_base = posixify(path.relative(cwd, config.kit.files.routes));

	const valid_extensions = [...config.extensions, ...config.kit.moduleExtensions];

	/** @type {import('types').PageNode[]} */
	const nodes = [];

	if (fs.existsSync(config.kit.files.routes)) {
		/**
		 * @param {number} depth
		 * @param {string} id
		 * @param {string} segment
		 * @param {import('types').RouteData | null} parent
		 */
		const walk = (depth, id, segment, parent) => {
			const unescaped = id.replace(/\[([ux])\+([^\]]+)\]/gi, (match, type, code) => {
				if (match !== match.toLowerCase()) {
					throw new Error(`Character escape sequence in ${id} must be lowercase`);
				}

				if (!/[0-9a-f]+/.test(code)) {
					throw new Error(`Invalid character escape sequence in ${id}`);
				}

				if (type === 'x') {
					if (code.length !== 2) {
						throw new Error(`Hexadecimal escape sequence in ${id} must be two characters`);
					}

					return String.fromCharCode(parseInt(code, 16));
				} else {
					if (code.length < 4 || code.length > 6) {
						throw new Error(
							`Unicode escape sequence in ${id} must be between four and six characters`
						);
					}

					return String.fromCharCode(parseInt(code, 16));
				}
			});

			if (/\]\[/.test(unescaped)) {
				throw new Error(`Invalid route ${id} — parameters must be separated`);
			}

			if (count_occurrences('[', id) !== count_occurrences(']', id)) {
				throw new Error(`Invalid route ${id} — brackets are unbalanced`);
			}

			if (/#/.test(segment)) {
				// Vite will barf on files with # in them
				throw new Error(`Route ${id} should be renamed to ${id.replace(/#/g, '[x+23]')}`);
			}

			if (/\[\.\.\.\w+\]\/\[\[/.test(id)) {
				throw new Error(
					`Invalid route ${id} — an [[optional]] route segment cannot follow a [...rest] route segment`
				);
			}

			if (/\[\[\.\.\./.test(id)) {
				throw new Error(
					`Invalid route ${id} — a rest route segment is always optional, remove the outer square brackets`
				);
			}

			const { pattern, params } = parse_route_id(id);

			/** @type {import('types').RouteData} */
			const route = {
				id,
				parent,

				segment,
				pattern,
				params,

				layout: null,
				error: null,
				leaf: null,
				page: null,
				endpoint: null
			};

			// important to do this before walking children, so that child
			// routes appear later
			routes.push(route);

			// if we don't do this, the route map becomes unwieldy to console.log
			Object.defineProperty(route, 'parent', { enumerable: false });

			const dir = path.join(cwd, routes_base, id);

			// We can't use withFileTypes because of a NodeJs bug which returns wrong results
			// with isDirectory() in case of symlinks: https://github.com/nodejs/node/issues/30646
			const files = fs.readdirSync(dir).map((name) => ({
				is_dir: fs.statSync(path.join(dir, name)).isDirectory(),
				name
			}));

			// process files first
			for (const file of files) {
				if (file.is_dir) continue;

				const ext = valid_extensions.find((ext) => file.name.endsWith(ext));
				if (!ext) continue;

				if (!file.name.startsWith('+')) {
					const name = file.name.slice(0, -ext.length);
					// check if it is a valid route filename but missing the + prefix
					const typo =
						/^(?:(page(?:@(.*))?)|(layout(?:@(.*))?)|(error))$/.test(name) ||
						/^(?:(server)|(page(?:(@[a-zA-Z0-9_-]*))?(\.server)?)|(layout(?:(@[a-zA-Z0-9_-]*))?(\.server)?))$/.test(
							name
						);
					if (typo) {
						console.log(
							colors
								.bold()
								.yellow(
									`Missing route file prefix. Did you mean +${file.name}?` +
										` at ${path.join(dir, file.name)}`
								)
						);
					}

					continue;
				}

				if (file.name.endsWith('.d.ts')) {
					let name = file.name.slice(0, -5);
					const ext = valid_extensions.find((ext) => name.endsWith(ext));
					if (ext) name = name.slice(0, -ext.length);

					const valid =
						/^\+(?:(page(?:@(.*))?)|(layout(?:@(.*))?)|(error))$/.test(name) ||
						/^\+(?:(server)|(page(?:(@[a-zA-Z0-9_-]*))?(\.server)?)|(layout(?:(@[a-zA-Z0-9_-]*))?(\.server)?))$/.test(
							name
						);

					if (valid) continue;
				}

				const project_relative = posixify(path.relative(cwd, path.join(dir, file.name)));

				const item = analyze(
					project_relative,
					file.name,
					config.extensions,
					config.kit.moduleExtensions
				);

				/**
				 * @param {string} type
				 * @param {string} existing_file
				 */
				function duplicate_files_error(type, existing_file) {
					return new Error(
						`Multiple ${type} files found in ${routes_base}${route.id} : ${path.basename(
							existing_file
						)} and ${file.name}`
					);
				}

				if (item.kind === 'component') {
					if (item.is_error) {
						route.error = {
							depth,
							component: project_relative
						};
					} else if (item.is_layout) {
						if (!route.layout) {
							route.layout = { depth, child_pages: [] };
						} else if (route.layout.component) {
							throw duplicate_files_error('layout component', route.layout.component);
						}

						route.layout.component = project_relative;
						if (item.uses_layout !== undefined) route.layout.parent_id = item.uses_layout;
					} else {
						if (!route.leaf) {
							route.leaf = { depth };
						} else if (route.leaf.component) {
							throw duplicate_files_error('page component', route.leaf.component);
						}

						route.leaf.component = project_relative;
						if (item.uses_layout !== undefined) route.leaf.parent_id = item.uses_layout;
					}
				} else if (item.is_layout) {
					if (!route.layout) {
						route.layout = { depth, child_pages: [] };
					} else if (route.layout[item.kind]) {
						throw duplicate_files_error(
							item.kind + ' layout module',
							/** @type {string} */ (route.layout[item.kind])
						);
					}

					route.layout[item.kind] = project_relative;
				} else if (item.is_page) {
					if (!route.leaf) {
						route.leaf = { depth };
					} else if (route.leaf[item.kind]) {
						throw duplicate_files_error(
							item.kind + ' page module',
							/** @type {string} */ (route.leaf[item.kind])
						);
					}

					route.leaf[item.kind] = project_relative;
				} else {
					if (route.endpoint) {
						throw duplicate_files_error('endpoint', route.endpoint.file);
					}

					route.endpoint = {
						file: project_relative
					};
				}
			}

			// then handle children
			for (const file of files) {
				if (file.is_dir) {
					walk(depth + 1, path.posix.join(id, file.name), file.name, route);
				}
			}
		};

		walk(0, '/', '', null);

		if (routes.length === 1) {
			const root = routes[0];
			if (!root.leaf && !root.error && !root.layout && !root.endpoint) {
				throw new Error(
					'No routes found. If you are using a custom src/routes directory, make sure it is specified in svelte.config.js'
				);
			}
		}
	} else {
		// If there's no routes directory, we'll just create a single empty route. This ensures the root layout and
		// error components are included in the manifest, which is needed for subsequent build/dev commands to work
		routes.push({
			id: '/',
			segment: '',
			pattern: /^$/,
			params: [],
			parent: null,
			layout: null,
			error: null,
			leaf: null,
			page: null,
			endpoint: null
		});
	}

	prevent_conflicts(routes);

	const root = routes[0];

	if (!root.layout?.component) {
		if (!root.layout) root.layout = { depth: 0, child_pages: [] };
		root.layout.component = posixify(path.relative(cwd, `${fallback}/layout.svelte`));
	}

	if (!root.error?.component) {
		if (!root.error) root.error = { depth: 0 };
		root.error.component = posixify(path.relative(cwd, `${fallback}/error.svelte`));
	}

	// we do layouts/errors first as they are more likely to be reused,
	// and smaller indexes take fewer bytes. also, this guarantees that
	// the default error/layout are 0/1
	for (const route of routes) {
		if (route.layout) {
			if (!route.layout?.component) {
				route.layout.component = posixify(path.relative(cwd, `${fallback}/layout.svelte`));
			}
			nodes.push(route.layout);
		}
		if (route.error) nodes.push(route.error);
	}

	for (const route of routes) {
		if (route.leaf) nodes.push(route.leaf);
	}

	const indexes = new Map(nodes.map((node, i) => [node, i]));

	for (const route of routes) {
		if (!route.leaf) continue;

		route.page = {
			layouts: [],
			errors: [],
			leaf: /** @type {number} */ (indexes.get(route.leaf))
		};

		/** @type {import('types').RouteData | null} */
		let current_route = route;
		let current_node = route.leaf;
		let parent_id = route.leaf.parent_id;

		while (current_route) {
			if (parent_id === undefined || current_route.segment === parent_id) {
				if (current_route.layout || current_route.error) {
					route.page.layouts.unshift(
						current_route.layout ? indexes.get(current_route.layout) : undefined
					);
					route.page.errors.unshift(
						current_route.error ? indexes.get(current_route.error) : undefined
					);
				}

				if (current_route.layout) {
					/** @type {import('types').PageNode[]} */ (current_route.layout.child_pages).push(
						route.leaf
					);
					current_node.parent = current_node = current_route.layout;
					parent_id = current_node.parent_id;
				} else {
					parent_id = undefined;
				}
			}

			current_route = current_route.parent;
		}

		if (parent_id !== undefined) {
			throw new Error(`${current_node.component} references missing segment "${parent_id}"`);
		}
	}

	return {
		nodes,
		routes: sort_routes(routes)
	};
}

/**
 * @param {string} project_relative
 * @param {string} file
 * @param {string[]} component_extensions
 * @param {string[]} module_extensions
 * @returns {import('./types.js').RouteFile}
 */
function analyze(project_relative, file, component_extensions, module_extensions) {
	const component_extension = component_extensions.find((ext) => file.endsWith(ext));
	if (component_extension) {
		const name = file.slice(0, -component_extension.length);
		const pattern = /^\+(?:(page(?:@(.*))?)|(layout(?:@(.*))?)|(error))$/;
		const match = pattern.exec(name);
		if (!match) {
			throw new Error(`Files prefixed with + are reserved (saw ${project_relative})`);
		}

		return {
			kind: 'component',
			is_page: !!match[1],
			is_layout: !!match[3],
			is_error: !!match[5],
			uses_layout: match[2] ?? match[4]
		};
	}

	const module_extension = module_extensions.find((ext) => file.endsWith(ext));
	if (module_extension) {
		const name = file.slice(0, -module_extension.length);
		const pattern =
			/^\+(?:(server)|(page(?:(@[a-zA-Z0-9_-]*))?(\.server)?)|(layout(?:(@[a-zA-Z0-9_-]*))?(\.server)?))$/;
		const match = pattern.exec(name);
		if (!match) {
			throw new Error(`Files prefixed with + are reserved (saw ${project_relative})`);
		} else if (match[3] || match[6]) {
			throw new Error(
				// prettier-ignore
				`Only Svelte files can reference named layouts. Remove '${match[3] || match[6]}' from ${file} (at ${project_relative})`
			);
		}

		const kind = match[1] || match[4] || match[7] ? 'server' : 'universal';

		return {
			kind,
			is_page: !!match[2],
			is_layout: !!match[5]
		};
	}

	throw new Error(`Files and directories prefixed with + are reserved (saw ${project_relative})`);
}

/**
 * @param {string} needle
 * @param {string} haystack
 */
function count_occurrences(needle, haystack) {
	let count = 0;
	for (let i = 0; i < haystack.length; i += 1) {
		if (haystack[i] === needle) count += 1;
	}
	return count;
}

/** @param {import('types').RouteData[]} routes */
function prevent_conflicts(routes) {
	/** @type {Map<string, string>} */
	const lookup = new Map();

	for (const route of routes) {
		if (!route.leaf && !route.endpoint) continue;

		const normalized = normalize_route_id(route.id);

		// find all permutations created by optional parameters
		const split = normalized.split(/<\?(.+?)>/g);

		let permutations = [/** @type {string} */ (split[0])];

		// turn `x/[[optional]]/y` into `x/y` and `x/[required]/y`
		for (let i = 1; i < split.length; i += 2) {
			const matcher = split[i];
			const next = split[i + 1];

			permutations = permutations.reduce((a, b) => {
				a.push(b + next);
				if (!(matcher === '*' && b.endsWith('//'))) a.push(b + `<${matcher}>${next}`);
				return a;
			}, /** @type {string[]} */ ([]));
		}

		for (const permutation of permutations) {
			// remove leading/trailing/duplicated slashes caused by prior
			// manipulation of optional parameters and (groups)
			const key = permutation
				.replace(/\/{2,}/, '/')
				.replace(/^\//, '')
				.replace(/\/$/, '');

			if (lookup.has(key)) {
				throw new Error(
					`The "${lookup.get(key)}" and "${route.id}" routes conflict with each other`
				);
			}

			lookup.set(key, route.id);
		}
	}
}

/** @param {string} id */
function normalize_route_id(id) {
	return (
		id
			// remove groups
			.replace(/(?<=^|\/)\(.+?\)(?=$|\/)/g, '')

			.replace(/\[[ux]\+([0-9a-f]+)\]/g, (_, x) =>
				String.fromCharCode(parseInt(x, 16)).replace(/\//g, '%2f')
			)

			// replace `[param]` with `<*>`, `[param=x]` with `<x>`, and `[[param]]` with `<?*>`
			.replace(
				/\[(?:(\[)|(\.\.\.))?.+?(=.+?)?\]\]?/g,
				(_, optional, rest, matcher) => `<${optional ? '?' : ''}${rest ?? ''}${matcher ?? '*'}>`
			)
	);
}

```


####### packages/kit/src/core/sync/create_manifest_data/index.spec.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';
import { assert, expect, test } from 'vitest';
import create_manifest_data from './index.js';
import options from '../../config/options.js';
import { sort_routes } from './sort.js';

const cwd = fileURLToPath(new URL('./test', import.meta.url));

/**
 * @param {string} dir
 * @param {import('@sveltejs/kit').Config} config
 */
const create = (dir, config = {}) => {
	const initial = options(config, 'config');

	initial.kit.files.assets = path.resolve(cwd, 'static');
	initial.kit.files.params = path.resolve(cwd, 'params');
	initial.kit.files.routes = path.resolve(cwd, dir);

	return create_manifest_data({
		config: /** @type {import('types').ValidatedConfig} */ (initial),
		fallback: cwd,
		cwd
	});
};

const default_layout = {
	component: 'layout.svelte'
};

const default_error = {
	component: 'error.svelte'
};

/** @param {import('types').PageNode} node */
function simplify_node(node) {
	/** @type {import('types').PageNode} */
	const simplified = {};

	if (node.component) simplified.component = node.component;
	if (node.universal) simplified.universal = node.universal;
	if (node.server) simplified.server = node.server;
	if (node.parent_id !== undefined) simplified.parent_id = node.parent_id;

	return simplified;
}

/** @param {import('types').RouteData} route */
function simplify_route(route) {
	/** @type {{ id: string, pattern: string, page?: import('types').PageNodeIndexes, endpoint?: { file: string } }} */
	const simplified = {
		id: route.id,
		pattern: route.pattern.toString().replace(/\\\//g, '/').replace(/\\\./g, '.')
	};

	if (route.page) simplified.page = route.page;
	if (route.endpoint) simplified.endpoint = route.endpoint;

	return simplified;
}

test('creates routes', () => {
	const { nodes, routes } = create('samples/basic');

	expect(nodes.map(simplify_node)).toEqual([
		default_layout,
		default_error,
		{ component: 'samples/basic/+page.svelte' },
		{ component: 'samples/basic/about/+page.svelte' },
		{ component: 'samples/basic/blog/+page.svelte' },
		{ component: 'samples/basic/blog/[slug]/+page.svelte' }
	]);

	expect(routes.map(simplify_route)).toEqual([
		{
			id: '/',
			pattern: '/^/$/',
			page: { layouts: [0], errors: [1], leaf: 2 }
		},
		{
			id: '/about',
			pattern: '/^/about/?$/',
			page: { layouts: [0], errors: [1], leaf: 3 }
		},
		{
			id: '/blog.json',
			pattern: '/^/blog.json/?$/',
			endpoint: { file: 'samples/basic/blog.json/+server.js' }
		},
		{
			id: '/blog',
			pattern: '/^/blog/?$/',
			page: { layouts: [0], errors: [1], leaf: 4 }
		},
		{
			id: '/blog/[slug].json',
			pattern: '/^/blog/([^/]+?).json/?$/',
			endpoint: {
				file: 'samples/basic/blog/[slug].json/+server.ts'
			}
		},
		{
			id: '/blog/[slug]',
			pattern: '/^/blog/([^/]+?)/?$/',
			page: { layouts: [0], errors: [1], leaf: 5 }
		}
	]);
});

const symlink_survived_git = fs
	.statSync(path.join(cwd, 'samples/symlinks/routes/foo'))
	.isSymbolicLink();

const test_symlinks = symlink_survived_git ? test : test.skip;

test_symlinks('creates symlinked routes', () => {
	const { nodes, routes } = create('samples/symlinks/routes');

	expect(nodes.map(simplify_node)).toEqual([
		default_layout,
		default_error,
		{ component: 'samples/symlinks/routes/foo/index.svelte' },
		{ component: 'samples/symlinks/routes/index.svelte' }
	]);

	expect(routes).toEqual([
		{
			id: '/',
			pattern: '/^/$/',
			page: { layouts: [0], errors: [1], leaf: 1 }
		},

		{
			id: '/foo',
			pattern: '/^/foo/?$/',
			page: { layouts: [0], errors: [1], leaf: 2 }
		}
	]);
});

test('creates routes with layout', () => {
	const { nodes, routes } = create('samples/basic-layout');

	expect(nodes.map(simplify_node)).toEqual([
		{ component: 'samples/basic-layout/+layout.svelte' },
		default_error,
		{ component: 'samples/basic-layout/foo/+layout.svelte' },
		{ component: 'samples/basic-layout/+page.svelte' },
		{ component: 'samples/basic-layout/foo/+page.svelte' }
	]);

	expect(routes.map(simplify_route)).toEqual([
		{
			id: '/',
			pattern: '/^/$/',
			page: { layouts: [0], errors: [1], leaf: 3 }
		},

		{
			id: '/foo',
			pattern: '/^/foo/?$/',
			page: { layouts: [0, 2], errors: [1, undefined], leaf: 4 }
		}
	]);
});

test('succeeds when routes does not exist', () => {
	const { nodes, routes } = create('samples/basic/routes');
	expect(nodes.map(simplify_node)).toEqual([
		{ component: 'layout.svelte' },
		{ component: 'error.svelte' }
	]);
	expect(routes.map(simplify_route)).toEqual([
		{
			id: '/',
			pattern: '/^$/'
		}
	]);
});

test('encodes invalid characters', () => {
	const { nodes, routes } = create('samples/encoding');

	const quote = { component: 'samples/encoding/[x+22]/+page.svelte' };
	const hash = { component: 'samples/encoding/[x+23]/+page.svelte' };
	const question_mark = { component: 'samples/encoding/[x+3f]/+page.svelte' };

	expect(nodes.map(simplify_node)).toEqual([
		default_layout,
		default_error,
		quote,
		hash,
		question_mark
	]);

	expect(routes.map((p) => p.pattern.toString())).toEqual(
		[/^\/$/, /^\/%3[Ff]\/?$/, /^\/%23\/?$/, /^\/"\/?$/].map((pattern) => pattern.toString())
	);
});

test('sorts routes correctly', () => {
	const expected = [
		'/',
		'/a',
		'/b',
		'/b/[required]',
		'/c',
		'/c/bar',
		'/c/b[x].json',
		'/c/b[x]',
		'/c/foo',
		'/d/e',
		'/d/e[...rest]',
		'/e/f',
		'/e/[...rest]/f',
		'/f/static[...rest]',
		'/f/[...rest]static',
		'/g/[[optional]]/static',
		'/g/[required]',
		'/g/[...rest]/[required]',
		'/h/a/b',
		'/h/a/[required]/b',
		'/h/a/[...rest]/b',
		'/x/[...rest]',
		'/[...rest]/x',
		'/[...rest]/x/[...deep_rest]/y',
		'/[...rest]/x/[...deep_rest]',
		'/[required=matcher]',
		'/[required]',
		'/[...rest]'
	];

	const routes = /** @type {import('types').RouteData[]} */ (expected.map((id) => ({ id })));

	const actual = sort_routes(routes.sort(() => (Math.random() > 0.5 ? 1 : -1))).map(
		(route) => route.id
	);

	expect(actual).toEqual(expected);
});

test('sorts routes with rest correctly', () => {
	const { nodes, routes } = create('samples/rest');

	expect(nodes.map(simplify_node)).toEqual([
		default_layout,
		default_error,
		{
			component: 'samples/rest/a/[...rest]/+page.svelte',
			server: 'samples/rest/a/[...rest]/+page.server.js'
		},
		{
			component: 'samples/rest/b/[...rest]/+page.svelte',
			server: 'samples/rest/b/[...rest]/+page.server.ts'
		}
	]);

	expect(routes.map(simplify_route)).toEqual([
		{
			id: '/',
			pattern: '/^/$/'
		},
		{
			id: '/a',
			pattern: '/^/a/?$/'
		},
		{
			id: '/a/[...rest]',
			pattern: '/^/a(?:/(.*))?/?$/',
			page: { layouts: [0], errors: [1], leaf: 2 }
		},
		{
			id: '/b',
			pattern: '/^/b/?$/'
		},
		{
			id: '/b/[...rest]',
			pattern: '/^/b(?:/(.*))?/?$/',
			page: { layouts: [0], errors: [1], leaf: 3 }
		}
	]);
});

test('allows rest parameters inside segments', () => {
	const { nodes, routes } = create('samples/rest-prefix-suffix');

	expect(nodes.map(simplify_node)).toEqual([
		default_layout,
		default_error,
		{
			component: 'samples/rest-prefix-suffix/prefix-[...rest]/+page.svelte'
		}
	]);

	expect(routes.map(simplify_route)).toEqual([
		{
			id: '/',
			pattern: '/^/$/'
		},
		{
			id: '/prefix-[...rest]',
			pattern: '/^/prefix-(.*?)/?$/',
			page: { layouts: [0], errors: [1], leaf: 2 }
		},
		{
			id: '/[...rest].json',
			pattern: '/^/(.*?).json/?$/',
			endpoint: {
				file: 'samples/rest-prefix-suffix/[...rest].json/+server.js'
			}
		}
	]);
});

test('optional parameters', () => {
	const { nodes, routes } = create('samples/optional');

	expect(
		nodes
			.map(simplify_node)
			// for some reason linux and windows have a different order, which is why
			// we need sort the nodes using a sort function (doesn't work either without),
			// resulting in the following expected node order
			.sort((a, b) => a.component?.localeCompare(b.component ?? '') ?? 1)
	).toEqual([
		default_error,
		default_layout,
		{
			component: 'samples/optional/[[optional]]/+page.svelte'
		},
		{
			component: 'samples/optional/nested/[[optional]]/sub/+page.svelte'
		},
		{
			component: 'samples/optional/prefix[[suffix]]/+page.svelte'
		}
	]);

	expect(routes.map(simplify_route)).toEqual([
		{
			id: '/',
			pattern: '/^/$/'
		},
		{
			id: '/[[foo]]bar',
			pattern: '/^/([^/]*)?bar/?$/',
			endpoint: { file: 'samples/optional/[[foo]]bar/+server.js' }
		},
		{ id: '/nested', pattern: '/^/nested/?$/' },
		{
			id: '/nested/[[optional]]/sub',
			pattern: '/^/nested(?:/([^/]+))?/sub/?$/',
			page: {
				layouts: [0],
				errors: [1],
				// see above, linux/windows difference -> find the index dynamically
				leaf: nodes.findIndex((node) => node.component?.includes('nested/[[optional]]'))
			}
		},
		{ id: '/nested/[[optional]]', pattern: '/^/nested(?:/([^/]+))?/?$/' },
		{
			id: '/prefix[[suffix]]',
			pattern: '/^/prefix([^/]*)?/?$/',
			page: {
				layouts: [0],
				errors: [1],
				// see above, linux/windows difference -> find the index dynamically
				leaf: nodes.findIndex((node) => node.component?.includes('prefix[[suffix]]'))
			}
		},
		{
			id: '/[[optional]]',
			pattern: '/^(?:/([^/]+))?/?$/',
			page: {
				layouts: [0],
				errors: [1],
				// see above, linux/windows difference -> find the index dynamically
				leaf: nodes.findIndex((node) => node.component?.includes('optional/[[optional]]'))
			}
		}
	]);
});

test('nested optionals', () => {
	const { nodes, routes } = create('samples/nested-optionals');
	expect(nodes.map(simplify_node)).toEqual([
		default_layout,
		default_error,
		{ component: 'samples/nested-optionals/[[a]]/[[b]]/+page.svelte' }
	]);

	expect(routes.map(simplify_route)).toEqual([
		{
			id: '/',
			pattern: '/^/$/'
		},
		{
			id: '/[[a]]/[[b]]',
			pattern: '/^(?:/([^/]+))?(?:/([^/]+))?/?$/',
			page: {
				layouts: [0],
				errors: [1],
				leaf: nodes.findIndex((node) => node.component?.includes('/[[a]]/[[b]]'))
			}
		},
		{
			id: '/[[a]]',
			pattern: '/^(?:/([^/]+))?/?$/'
		}
	]);
});

test('ignores files and directories with leading underscores', () => {
	const { routes } = create('samples/hidden-underscore');

	expect(routes.map((r) => r.endpoint?.file).filter(Boolean)).toEqual([
		'samples/hidden-underscore/e/f/g/h/+server.js'
	]);
});

test('ignores files and directories with leading dots except .well-known', () => {
	const { routes } = create('samples/hidden-dot');

	expect(routes.map((r) => r.endpoint?.file).filter(Boolean)).toEqual([
		'samples/hidden-dot/.well-known/dnt-policy.txt/+server.js'
	]);
});

test('allows multiple slugs', () => {
	const { routes } = create('samples/multiple-slugs');

	expect(routes.filter((route) => route.endpoint).map(simplify_route)).toEqual([
		{
			id: '/[file].[ext]',
			pattern: '/^/([^/]+?).([^/]+?)/?$/',
			endpoint: {
				file: 'samples/multiple-slugs/[file].[ext]/+server.js'
			}
		}
	]);
});

test('fails if dynamic params are not separated', () => {
	assert.throws(() => {
		create('samples/invalid-params');
	}, /Invalid route \/\[foo\]\[bar\] — parameters must be separated/);
});

test('ignores things that look like lockfiles', () => {
	const { routes } = create('samples/lockfiles');

	expect(routes.map(simplify_route)).toEqual([
		{
			id: '/',
			pattern: '/^/$/'
		},
		{
			id: '/foo',
			pattern: '/^/foo/?$/',
			endpoint: {
				file: 'samples/lockfiles/foo/+server.js'
			}
		}
	]);
});

test('works with custom extensions', () => {
	const { nodes, routes } = create('samples/custom-extension', {
		extensions: ['.jazz', '.beebop', '.funk', '.svelte']
	});

	expect(nodes.map(simplify_node)).toEqual([
		default_layout,
		default_error,
		{ component: 'samples/custom-extension/+page.funk' },
		{ component: 'samples/custom-extension/about/+page.jazz' },
		{ component: 'samples/custom-extension/blog/+page.svelte' },
		{ component: 'samples/custom-extension/blog/[slug]/+page.beebop' }
	]);

	expect(routes.map(simplify_route)).toEqual([
		{
			id: '/',
			pattern: '/^/$/',
			page: { layouts: [0], errors: [1], leaf: 2 }
		},
		{
			id: '/about',
			pattern: '/^/about/?$/',
			page: { layouts: [0], errors: [1], leaf: 3 }
		},
		{
			id: '/blog.json',
			pattern: '/^/blog.json/?$/',
			endpoint: {
				file: 'samples/custom-extension/blog.json/+server.js'
			}
		},
		{
			id: '/blog',
			pattern: '/^/blog/?$/',
			page: { layouts: [0], errors: [1], leaf: 4 }
		},
		{
			id: '/blog/[slug].json',
			pattern: '/^/blog/([^/]+?).json/?$/',
			endpoint: {
				file: 'samples/custom-extension/blog/[slug].json/+server.js'
			}
		},
		{
			id: '/blog/[slug]',
			pattern: '/^/blog/([^/]+?)/?$/',
			page: { layouts: [0], errors: [1], leaf: 5 }
		}
	]);
});

test('lists static assets', () => {
	const { assets } = create('samples/basic');

	expect(assets).toEqual([
		{
			file: 'bar/baz.txt',
			size: 14,
			type: 'text/plain'
		},
		{
			file: 'foo.txt',
			size: 9,
			type: 'text/plain'
		}
	]);
});

test('includes nested error components', () => {
	const { nodes, routes } = create('samples/nested-errors');

	expect(nodes.map(simplify_node)).toEqual([
		default_layout,
		default_error,
		{ component: 'samples/nested-errors/foo/+layout.svelte' },
		{ component: 'samples/nested-errors/foo/bar/+error.svelte' },
		{ component: 'samples/nested-errors/foo/bar/baz/+layout.svelte' },
		{ component: 'samples/nested-errors/foo/bar/baz/+error.svelte' },
		{ component: 'samples/nested-errors/foo/bar/baz/+page.svelte' }
	]);

	expect(routes.map(simplify_route)).toEqual([
		{
			id: '/',
			pattern: '/^/$/'
		},
		{
			id: '/foo',
			pattern: '/^/foo/?$/'
		},
		{
			id: '/foo/bar',
			pattern: '/^/foo/bar/?$/'
		},
		{
			id: '/foo/bar/baz',
			pattern: '/^/foo/bar/baz/?$/',
			page: { layouts: [0, 2, undefined, 4], errors: [1, undefined, 3, 5], leaf: 6 }
		}
	]);
});

test('creates routes with named layouts', () => {
	const { nodes, routes } = create('samples/named-layouts');

	expect(nodes.map(simplify_node)).toEqual([
		// layouts
		{ component: 'samples/named-layouts/+layout.svelte' }, // 0
		default_error, // 1
		{
			component: 'samples/named-layouts/(special)/+layout.svelte',
			universal: 'samples/named-layouts/(special)/+layout.js',
			server: 'samples/named-layouts/(special)/+layout.server.js'
		}, // 2
		{ component: 'samples/named-layouts/(special)/(alsospecial)/+layout.svelte' }, // 3
		{ component: 'samples/named-layouts/a/+layout.svelte' }, // 4
		{ component: 'samples/named-layouts/b/c/+layout.svelte' }, // 5
		{ component: 'samples/named-layouts/b/d/(special)/+layout.svelte' }, // 6
		{ component: 'samples/named-layouts/b/d/(special)/(extraspecial)/+layout.svelte' }, // 7

		// pages
		{ component: 'samples/named-layouts/(special)/(alsospecial)/b/c/c1/+page.svelte' }, // 8
		{ component: 'samples/named-layouts/(special)/a/a2/+page.svelte' }, // 9
		{ component: 'samples/named-layouts/a/a1/+page.svelte' }, // 10
		{ component: 'samples/named-layouts/b/c/c2/+page@.svelte', parent_id: '' }, // 11
		{ component: 'samples/named-layouts/b/d/(special)/+page.svelte' }, // 12
		{ component: 'samples/named-layouts/b/d/(special)/(extraspecial)/d2/+page.svelte' }, // 13
		{
			component: 'samples/named-layouts/b/d/(special)/(extraspecial)/d3/+page@(special).svelte',
			parent_id: '(special)'
		}, // 14
		{ component: 'samples/named-layouts/b/d/d1/+page.svelte' } // 15
	]);

	expect(routes.filter((route) => route.page).map(simplify_route)).toEqual([
		{
			id: '/a/a1',
			pattern: '/^/a/a1/?$/',
			page: { layouts: [0, 4], errors: [1, undefined], leaf: 10 }
		},
		{
			id: '/(special)/a/a2',
			pattern: '/^/a/a2/?$/',
			page: { layouts: [0, 2], errors: [1, undefined], leaf: 9 }
		},
		{
			id: '/(special)/(alsospecial)/b/c/c1',
			pattern: '/^/b/c/c1/?$/',
			page: { layouts: [0, 2, 3], errors: [1, undefined, undefined], leaf: 8 }
		},
		{
			id: '/b/c/c2',
			pattern: '/^/b/c/c2/?$/',
			page: { layouts: [0], errors: [1], leaf: 11 }
		},
		{
			id: '/b/d/(special)',
			pattern: '/^/b/d/?$/',
			page: { layouts: [0, 6], errors: [1, undefined], leaf: 12 }
		},
		{
			id: '/b/d/d1',
			pattern: '/^/b/d/d1/?$/',
			page: { layouts: [0], errors: [1], leaf: 15 }
		},
		{
			id: '/b/d/(special)/(extraspecial)/d2',
			pattern: '/^/b/d/d2/?$/',
			page: { layouts: [0, 6, 7], errors: [1, undefined, undefined], leaf: 13 }
		},
		{
			id: '/b/d/(special)/(extraspecial)/d3',
			pattern: '/^/b/d/d3/?$/',
			page: { layouts: [0, 6], errors: [1, undefined], leaf: 14 }
		}
	]);
});

test('handles pages without .svelte file', () => {
	const { nodes, routes } = create('samples/page-without-svelte-file');

	expect(nodes.map(simplify_node)).toEqual([
		default_layout,
		default_error,
		{ component: 'samples/page-without-svelte-file/error/+error.svelte' },
		{ component: 'samples/page-without-svelte-file/layout/+layout.svelte' },
		{ ...default_layout, universal: 'samples/page-without-svelte-file/layout/exists/+layout.js' },
		{ component: 'samples/page-without-svelte-file/+page.svelte' },
		{ universal: 'samples/page-without-svelte-file/error/[...path]/+page.js' },
		{ component: 'samples/page-without-svelte-file/layout/exists/+page.svelte' },
		{ server: 'samples/page-without-svelte-file/layout/redirect/+page.server.js' }
	]);

	expect(routes.map(simplify_route)).toEqual([
		{
			id: '/',
			pattern: '/^/$/',
			page: { layouts: [0], errors: [1], leaf: 5 }
		},
		{
			id: '/error',
			pattern: '/^/error/?$/'
		},
		{
			id: '/error/[...path]',
			pattern: '/^/error(?:/(.*))?/?$/',
			page: { layouts: [0, undefined], errors: [1, 2], leaf: 6 }
		},
		{
			id: '/layout',
			pattern: '/^/layout/?$/'
		},
		{
			id: '/layout/exists',
			pattern: '/^/layout/exists/?$/',
			page: { layouts: [0, 3, 4], errors: [1, undefined, undefined], leaf: 7 }
		},
		{
			id: '/layout/redirect',
			pattern: '/^/layout/redirect/?$/',
			page: { layouts: [0, 3], errors: [1, undefined], leaf: 8 }
		}
	]);
});

test('errors on missing layout', () => {
	assert.throws(
		() => create('samples/named-layout-missing'),
		/samples\/named-layout-missing\/\+page@missing.svelte references missing segment "missing"/
	);
});

test('errors on invalid named layout reference', () => {
	assert.throws(
		() => create('samples/invalid-named-layout-reference'),
		/Only Svelte files can reference named layouts. Remove '@' from \+page@.js \(at samples\/invalid-named-layout-reference\/x\/\+page@.js\)/
	);
});

test('creates param matchers', () => {
	const { matchers } = create('samples/basic'); // directory doesn't matter for the test

	expect(matchers).toEqual({
		foo: path.join('params', 'foo.js'),
		bar: path.join('params', 'bar.js')
	});
});

test('errors on param matchers with bad names', () => {
	const boogaloo = path.resolve(cwd, 'params', 'boo-galoo.js');
	fs.writeFileSync(boogaloo, '');
	try {
		assert.throws(() => create('samples/basic'), /Matcher names can only have/);
	} finally {
		fs.unlinkSync(boogaloo);
	}
});

test('errors on duplicate matchers', () => {
	const ts_foo = path.resolve(cwd, 'params', 'foo.ts');
	fs.writeFileSync(ts_foo, '');
	try {
		assert.throws(() => {
			create('samples/basic', {
				kit: {
					moduleExtensions: ['.js', '.ts']
				}
			});
		}, /Duplicate matchers/);
	} finally {
		fs.unlinkSync(ts_foo);
	}
});

test('prevents route conflicts between groups', () => {
	assert.throws(
		() => create('samples/conflicting-groups'),
		/The "\/\(x\)\/a" and "\/\(y\)\/a" routes conflict with each other/
	);
});

test('errors with multiple layouts on same directory', () => {
	assert.throws(
		() => create('samples/multiple-layouts'),
		/^Multiple layout component files found in samples\/multiple-layouts\/ : \+layout\.svelte and \+layout@\.svelte/
	);
});

test('errors with multiple pages on same directory', () => {
	assert.throws(
		() => create('samples/multiple-pages'),
		/^Multiple page component files found in samples\/multiple-pages\/ : \+page\.svelte and \+page@\.svelte/
	);
});

test('errors with both ts and js handlers for the same route', () => {
	assert.throws(
		() => create('samples/conflicting-ts-js-handlers-page'),
		/^Multiple universal page module files found in samples\/conflicting-ts-js-handlers-page\/ : \+page\.js and \+page\.ts/
	);

	assert.throws(
		() => create('samples/conflicting-ts-js-handlers-layout'),
		/^Multiple server layout module files found in samples\/conflicting-ts-js-handlers-layout\/ : \+layout\.server\.js and \+layout\.server\.ts/
	);

	assert.throws(
		() => create('samples/conflicting-ts-js-handlers-server'),
		/^Multiple endpoint files found in samples\/conflicting-ts-js-handlers-server\/ : \+server\.js and \+server\.ts/
	);
});

```


####### packages/kit/src/core/sync/create_manifest_data/sort.js #######

```

import { get_route_segments } from '../../../utils/routing.js';

/**
 * @typedef {{
 *   type: 'static' | 'required' | 'optional' | 'rest';
 *   content: string;
 *   matched: boolean;
 * }} Part
 */

/**
 * @typedef {Part[]} Segment
 */

const EMPTY = { type: 'static', content: '', matched: false };

/** @param {import('types').RouteData[]} routes */
export function sort_routes(routes) {
	/** @type {Map<string, Part[]>} */
	const segment_cache = new Map();

	/** @param {string} segment */
	function get_parts(segment) {
		if (!segment_cache.has(segment)) {
			segment_cache.set(segment, split(segment));
		}

		return segment_cache.get(segment);
	}

	/** @param {string} id */
	function split(id) {
		/** @type {Part[]} */
		const parts = [];

		let i = 0;
		while (i <= id.length) {
			const start = id.indexOf('[', i);
			if (start === -1) {
				parts.push({ type: 'static', content: id.slice(i), matched: false });
				break;
			}

			parts.push({ type: 'static', content: id.slice(i, start), matched: false });

			const type = id[start + 1] === '[' ? 'optional' : id[start + 1] === '.' ? 'rest' : 'required';
			const delimiter = type === 'optional' ? ']]' : ']';
			const end = id.indexOf(delimiter, start);

			if (end === -1) {
				throw new Error(`Invalid route ID ${id}`);
			}

			const content = id.slice(start, (i = end + delimiter.length));

			parts.push({
				type,
				content,
				matched: content.includes('=')
			});
		}

		return parts;
	}

	return routes.sort((route_a, route_b) => {
		const segments_a = split_route_id(route_a.id).map(get_parts);
		const segments_b = split_route_id(route_b.id).map(get_parts);

		for (let i = 0; i < Math.max(segments_a.length, segments_b.length); i += 1) {
			const segment_a = segments_a[i] ?? [EMPTY];
			const segment_b = segments_b[i] ?? [EMPTY];

			for (let j = 0; j < Math.max(segment_a.length, segment_b.length); j += 1) {
				const a = segment_a[j];
				const b = segment_b[j];

				// first part of each segment is always static
				// (though it may be the empty string), then
				// it alternates between dynamic and static
				// (i.e. [foo][bar] is disallowed)
				const dynamic = j % 2 === 1;

				if (dynamic) {
					if (!a) return -1;
					if (!b) return +1;

					// get the next static chunk, so we can handle [...rest] edge cases
					const next_a = segment_a[j + 1].content || segments_a[i + 1]?.[0].content;
					const next_b = segment_b[j + 1].content || segments_b[i + 1]?.[0].content;

					// `[...rest]/x` outranks `[...rest]`
					if (a.type === 'rest' && b.type === 'rest') {
						if (next_a && next_b) continue;
						if (next_a) return -1;
						if (next_b) return +1;
					}

					// `[...rest]/x` outranks `[required]` or `[required]/[required]`
					// but not `[required]/x`
					if (a.type === 'rest') {
						return next_a && !next_b ? -1 : +1;
					}

					if (b.type === 'rest') {
						return next_b && !next_a ? +1 : -1;
					}

					// part with matcher outranks one without
					if (a.matched !== b.matched) {
						return a.matched ? -1 : +1;
					}

					if (a.type !== b.type) {
						// `[...rest]` has already been accounted for, so here
						// we're comparing between `[required]` and `[[optional]]`
						if (a.type === 'required') return -1;
						if (b.type === 'required') return +1;
					}
				} else if (a.content !== b.content) {
					// shallower path outranks deeper path
					if (a === EMPTY) return -1;
					if (b === EMPTY) return +1;

					return sort_static(a.content, b.content);
				}
			}
		}

		return route_a.id < route_b.id ? +1 : -1;
	});
}

/** @param {string} id */
function split_route_id(id) {
	return get_route_segments(
		id
			// remove all [[optional]] parts unless they're at the very end
			.replace(/\[\[[^\]]+\]\](?!$)/g, '')
	).filter(Boolean);
}

/**
 * Sort two strings lexicographically, except `foobar` outranks `foo`
 * @param {string} a
 * @param {string} b
 */
function sort_static(a, b) {
	if (a === b) return 0;

	for (let i = 0; true; i += 1) {
		const char_a = a[i];
		const char_b = b[i];

		if (char_a !== char_b) {
			if (char_a === undefined) return +1;
			if (char_b === undefined) return -1;
			return char_a < char_b ? -1 : +1;
		}
	}
}

```


####### packages/kit/src/core/sync/create_manifest_data/test/params/bar.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/params/foo.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/basic/about/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/basic/blog/default.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/basic/blog.json/+server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/basic/blog/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/basic/blog/[slug].json/+server.ts #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/basic/blog/[slug]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/basic-layout/foo/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/basic-layout/foo/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/basic-layout/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/basic-layout/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/basic/+page.d.ts #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/basic/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-groups/(x)/a/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-groups/(y)/a/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-params/[slug1]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-params/[slug2]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-ts-js-handlers-layout/+layout.server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-ts-js-handlers-layout/+layout.server.ts #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-ts-js-handlers-page/+page.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-ts-js-handlers-page/+page.ts #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-ts-js-handlers-server/+server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/conflicting-ts-js-handlers-server/+server.ts #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/about/+page.jazz #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/blog/_default.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/blog.json/+server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/blog/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/blog/[slug].json/+server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/blog/[slug]/+page.beebop #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/custom-extension/+page.funk #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/declared-layout/+layout-foo.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/encoding/[x+22]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/encoding/[x+23]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/encoding/[x+3f]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/hidden-underscore/a/_b/c/d.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/hidden-underscore/e/f/g/h/+server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/hidden-underscore/_foo.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/hidden-underscore/i/_j.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/hidden-underscore/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/invalid-named-layout-reference/x/+page@.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/invalid-named-layout-reference/x/+page@.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/invalid-params/[foo][bar]/+server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/lockfiles/foo/+server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/lockfiles/foo/+server.js_tmp #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/multiple-layouts/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/multiple-layouts/+layout@.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/multiple-pages/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/multiple-pages/+page@.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/multiple-slugs/[file].[ext]/+server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layout-missing/+page@missing.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/a/a1/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/a/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/c/c2/+page@.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/c/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/d/d1/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/d/(special)/(extraspecial)/d2/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/d/(special)/(extraspecial)/d3/+page@(special).svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/d/(special)/(extraspecial)/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/d/(special)/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/b/d/(special)/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/+layout.svelte #######

```

<!-- not referenced anywhere -->

```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/(special)/a/a2/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/(special)/(alsospecial)/b/c/c1/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/(special)/(alsospecial)/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/(special)/+layout.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/(special)/+layout.server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/named-layouts/(special)/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/nested-errors/foo/bar/baz/+error.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/nested-errors/foo/bar/baz/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/nested-errors/foo/bar/baz/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/nested-errors/foo/bar/+error.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/nested-errors/foo/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/nested-optionals/[[a]]/[[b]]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/optional/[[foo]]bar/+server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/optional/nested/[[optional]]/sub/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/optional/[[optional]]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/optional/prefix[[suffix]]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/error/+error.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/error/[...path]/+page.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/layout/exists/+layout.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/layout/exists/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/layout/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/layout/redirect/+page.server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/page-without-svelte-file/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/rest/a/[...rest]/+page.server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/rest/a/[...rest]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/rest/b/[...rest]/+page.server.ts #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/rest/b/[...rest]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/rest-prefix-suffix/prefix-[...rest]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/rest-prefix-suffix/[...rest].json/+server.js #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/symlinks/bar/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/samples/symlinks/routes/+page.svelte #######

```


```


####### packages/kit/src/core/sync/create_manifest_data/test/static/bar/baz.txt #######

some more text
####### packages/kit/src/core/sync/create_manifest_data/test/static/foo.txt #######

some text
####### packages/kit/src/core/sync/create_manifest_data/types.d.ts #######

```

import { PageNode } from 'types';

interface Part {
	dynamic: boolean;
	optional: boolean;
	rest: boolean;
	type: string | null;
}

interface RouteTreeNode {
	error: PageNode | undefined;
	layout: PageNode | undefined;
}

export type RouteTree = Map<string, RouteTreeNode>;

interface RouteComponent {
	kind: 'component';
	is_page: boolean;
	is_layout: boolean;
	is_error: boolean;
	uses_layout: string | undefined;
}

interface RouteSharedModule {
	kind: 'universal';
	is_page: boolean;
	is_layout: boolean;
}

interface RouteServerModule {
	kind: 'server';
	is_page: boolean;
	is_layout: boolean;
}

export type RouteFile = RouteComponent | RouteSharedModule | RouteServerModule;

```


####### packages/kit/src/core/sync/sync.js #######

```

import path from 'node:path';
import create_manifest_data from './create_manifest_data/index.js';
import { write_client_manifest } from './write_client_manifest.js';
import { write_root } from './write_root.js';
import { write_tsconfig } from './write_tsconfig.js';
import { write_types, write_all_types } from './write_types/index.js';
import { write_ambient } from './write_ambient.js';
import { write_non_ambient } from './write_non_ambient.js';
import { write_server } from './write_server.js';

/**
 * Initialize SvelteKit's generated files.
 * @param {import('types').ValidatedConfig} config
 * @param {string} mode
 */
export function init(config, mode) {
	write_tsconfig(config.kit);
	write_ambient(config.kit, mode);
	write_non_ambient(config.kit);
}

/**
 * Update SvelteKit's generated files
 * @param {import('types').ValidatedConfig} config
 */
export async function create(config) {
	const manifest_data = create_manifest_data({ config });

	const output = path.join(config.kit.outDir, 'generated');

	write_client_manifest(config.kit, manifest_data, `${output}/client`);
	write_server(config, output);
	write_root(manifest_data, output);
	await write_all_types(config, manifest_data);

	return { manifest_data };
}

/**
 * Update SvelteKit's generated files in response to a single file content update.
 * Do not call this when the file in question was created/deleted.
 *
 * @param {import('types').ValidatedConfig} config
 * @param {import('types').ManifestData} manifest_data
 * @param {string} file
 */
export async function update(config, manifest_data, file) {
	await write_types(config, manifest_data, file);

	return { manifest_data };
}

/**
 * Run sync.init and sync.create in series, returning the result from sync.create.
 * @param {import('types').ValidatedConfig} config
 * @param {string} mode The Vite mode
 */
export async function all(config, mode) {
	init(config, mode);
	return await create(config);
}

/**
 * Run sync.init and then generate all type files.
 * @param {import('types').ValidatedConfig} config
 * @param {string} mode The Vite mode
 */
export async function all_types(config, mode) {
	init(config, mode);
	const manifest_data = create_manifest_data({ config });
	await write_all_types(config, manifest_data);
}

/**
 * Regenerate __SERVER__/internal.js in response to src/{app.html,error.html,service-worker.js} changing
 * @param {import('types').ValidatedConfig} config
 */
export function server(config) {
	write_server(config, path.join(config.kit.outDir, 'generated'));
}

```


####### packages/kit/src/core/sync/ts.js #######

```

/** @type {import('typescript')} */
// @ts-ignore
export let ts = undefined;
try {
	ts = (await import('typescript')).default;
} catch {}

```


####### packages/kit/src/core/sync/utils.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import { VERSION } from 'svelte/compiler';
import { mkdirp } from '../../utils/filesystem.js';

/** @type {Map<string, string>} */
const previous_contents = new Map();

/**
 * @param {string} file
 * @param {string} code
 */
export function write_if_changed(file, code) {
	if (code !== previous_contents.get(file)) {
		write(file, code);
	}
}

/**
 * @param {string} file
 * @param {string} code
 */
export function write(file, code) {
	previous_contents.set(file, code);
	mkdirp(path.dirname(file));
	fs.writeFileSync(file, code);
}

/** @type {WeakMap<TemplateStringsArray, { strings: string[], indents: string[] }>} */
const dedent_map = new WeakMap();

/**
 * Allows indenting template strings without the extra indentation ending up in the result.
 * Still allows indentation of lines relative to one another in the template string.
 * @param {TemplateStringsArray} strings
 * @param {any[]} values
 */
export function dedent(strings, ...values) {
	let dedented = dedent_map.get(strings);

	if (!dedented) {
		const indentation = /** @type {RegExpExecArray} */ (/\n?([ \t]*)/.exec(strings[0]))[1];
		const pattern = new RegExp(`^${indentation}`, 'gm');

		dedented = {
			strings: strings.map((str) => str.replace(pattern, '')),
			indents: []
		};

		let current = '\n';

		for (let i = 0; i < values.length; i += 1) {
			const string = dedented.strings[i];
			const match = /\n([ \t]*)$/.exec(string);

			if (match) current = match[0];
			dedented.indents[i] = current;
		}

		dedent_map.set(strings, dedented);
	}

	let str = dedented.strings[0];
	for (let i = 0; i < values.length; i += 1) {
		str += String(values[i]).replace(/\n/g, dedented.indents[i]) + dedented.strings[i + 1];
	}

	str = str.trim();

	return str;
}

export function isSvelte5Plus() {
	return Number(VERSION[0]) >= 5;
}

```


####### packages/kit/src/core/sync/write_ambient.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';
import { get_env } from '../../exports/vite/utils.js';
import { GENERATED_COMMENT } from '../../constants.js';
import { create_dynamic_types, create_static_types } from '../env.js';
import { write_if_changed } from './utils.js';

// TODO these types should be described in a neutral place, rather than
// inside either `packages/kit` or `kit.svelte.dev`
const descriptions_dir = fileURLToPath(new URL('../../../src/types/synthetic', import.meta.url));

/** @param {string} filename */
function read_description(filename) {
	const content = fs.readFileSync(`${descriptions_dir}/${filename}`, 'utf8');
	return `/**\n${content
		.trim()
		.split('\n')
		.map((line) => ` * ${line}`)
		.join('\n')}\n */`;
}

/**
 * @param {import('types').Env} env
 * @param {{
 * 	public_prefix: string;
 * 	private_prefix: string;
 * }} prefixes
 */
const template = (env, prefixes) => `
${GENERATED_COMMENT}

/// <reference types="@sveltejs/kit" />

${read_description('$env+static+private.md')}
${create_static_types('private', env)}

${read_description('$env+static+public.md')}
${create_static_types('public', env)}

${read_description('$env+dynamic+private.md')}
${create_dynamic_types('private', env, prefixes)}

${read_description('$env+dynamic+public.md')}
${create_dynamic_types('public', env, prefixes)}
`;

/**
 * Writes ambient declarations including types reference to @sveltejs/kit,
 * and the existing environment variables in process.env to
 * $env/static/private and $env/static/public
 * @param {import('types').ValidatedKitConfig} config
 * @param {string} mode The Vite mode
 */
export function write_ambient(config, mode) {
	const env = get_env(config.env, mode);
	const { publicPrefix: public_prefix, privatePrefix: private_prefix } = config.env;

	write_if_changed(
		path.join(config.outDir, 'ambient.d.ts'),
		template(env, { public_prefix, private_prefix })
	);
}

```


####### packages/kit/src/core/sync/write_client_manifest.js #######

```

import path from 'node:path';
import { relative_path, resolve_entry } from '../../utils/filesystem.js';
import { s } from '../../utils/misc.js';
import { dedent, isSvelte5Plus, write_if_changed } from './utils.js';
import colors from 'kleur';

/**
 * Writes the client manifest to disk. The manifest is used to power the router. It contains the
 * list of routes and corresponding Svelte components (i.e. pages and layouts).
 * @param {import('types').ValidatedKitConfig} kit
 * @param {import('types').ManifestData} manifest_data
 * @param {string} output
 * @param {Array<{ has_server_load: boolean }>} [metadata]
 */
export function write_client_manifest(kit, manifest_data, output, metadata) {
	/**
	 * Creates a module that exports a `CSRPageNode`
	 * @param {import('types').PageNode} node
	 */
	function generate_node(node) {
		const declarations = [];

		if (node.universal) {
			declarations.push(
				`import * as universal from ${s(relative_path(`${output}/nodes`, node.universal))};`,
				'export { universal };'
			);
		}

		if (node.component) {
			declarations.push(
				`export { default as component } from ${s(
					relative_path(`${output}/nodes`, node.component)
				)};`
			);
		}

		return declarations.join('\n');
	}

	/** @type {Map<import('types').PageNode, number>} */
	const indices = new Map();
	const nodes = manifest_data.nodes
		.map((node, i) => {
			indices.set(node, i);

			write_if_changed(`${output}/nodes/${i}.js`, generate_node(node));
			return `() => import('./nodes/${i}')`;
		})
		.join(',\n');

	const layouts_with_server_load = new Set();

	const dictionary = dedent`
		{
			${manifest_data.routes
				.map((route) => {
					if (route.page) {
						const errors = route.page.errors.slice(1).map((n) => n ?? '');
						const layouts = route.page.layouts.slice(1).map((n) => n ?? '');

						while (layouts.at(-1) === '') layouts.pop();
						while (errors.at(-1) === '') errors.pop();

						let leaf_has_server_load = false;
						if (route.leaf) {
							if (metadata) {
								const i = /** @type {number} */ (indices.get(route.leaf));

								leaf_has_server_load = metadata[i].has_server_load;
							} else if (route.leaf.server) {
								leaf_has_server_load = true;
							}
						}

						// Encode whether or not the route uses server data
						// using the ones' complement, to save space
						const array = [`${leaf_has_server_load ? '~' : ''}${route.page.leaf}`];

						// Encode whether or not the layout uses server data.
						// It's a different method compared to pages because layouts
						// are reused across pages, so we save space by doing it this way.
						route.page.layouts.forEach((layout) => {
							if (layout == undefined) return;

							let layout_has_server_load = false;

							if (metadata) {
								layout_has_server_load = metadata[layout].has_server_load;
							} else if (manifest_data.nodes[layout].server) {
								layout_has_server_load = true;
							}

							if (layout_has_server_load) {
								layouts_with_server_load.add(layout);
							}
						});

						// only include non-root layout/error nodes if they exist
						if (layouts.length > 0 || errors.length > 0) array.push(`[${layouts.join(',')}]`);
						if (errors.length > 0) array.push(`[${errors.join(',')}]`);

						return `${s(route.id)}: [${array.join(',')}]`;
					}
				})
				.filter(Boolean)
				.join(',\n')}
		}
	`;

	const client_hooks_file = resolve_entry(kit.files.hooks.client);
	const universal_hooks_file = resolve_entry(kit.files.hooks.universal);

	const typo = resolve_entry('src/+hooks.client');
	if (typo) {
		console.log(
			colors
				.bold()
				.yellow(
					`Unexpected + prefix. Did you mean ${typo.split('/').at(-1)?.slice(1)}?` +
						` at ${path.resolve(typo)}`
				)
		);
	}

	write_if_changed(
		`${output}/app.js`,
		dedent`
			${
				client_hooks_file
					? `import * as client_hooks from '${relative_path(output, client_hooks_file)}';`
					: ''
			}
			${
				universal_hooks_file
					? `import * as universal_hooks from '${relative_path(output, universal_hooks_file)}';`
					: ''
			}

			export { matchers } from './matchers.js';

			export const nodes = [
				${nodes}
			];

			export const server_loads = [${[...layouts_with_server_load].join(',')}];

			export const dictionary = ${dictionary};

			export const hooks = {
				handleError: ${
					client_hooks_file ? 'client_hooks.handleError || ' : ''
				}(({ error }) => { console.error(error) }),

				reroute: ${universal_hooks_file ? 'universal_hooks.reroute || ' : ''}(() => {})
			};

			export { default as root } from '../root.${isSvelte5Plus() ? 'js' : 'svelte'}';
		`
	);

	// write matchers to a separate module so that we don't
	// need to worry about name conflicts
	const imports = [];
	const matchers = [];

	for (const key in manifest_data.matchers) {
		const src = manifest_data.matchers[key];

		imports.push(`import { match as ${key} } from ${s(relative_path(output, src))};`);
		matchers.push(key);
	}

	const module = imports.length
		? `${imports.join('\n')}\n\nexport const matchers = { ${matchers.join(', ')} };`
		: 'export const matchers = {};';

	write_if_changed(`${output}/matchers.js`, module);
}

```


####### packages/kit/src/core/sync/write_non_ambient.js #######

```

import path from 'node:path';
import { GENERATED_COMMENT } from '../../constants.js';
import { write_if_changed } from './utils.js';

// `declare module "svelte/elements"` needs to happen in a non-ambient module, and dts-buddy generates one big ambient module,
// so we can't add it there - therefore generate the typings ourselves here.
// We're not using the `declare namespace svelteHTML` variant because that one doesn't augment the HTMLAttributes interface
// people could use to type their own components.
// The T generic is needed or else there's a "all declarations must have identical type parameters" error.
const template = `
${GENERATED_COMMENT}

declare module "svelte/elements" {
	export interface HTMLAttributes<T> {
		'data-sveltekit-keepfocus'?: true | '' | 'off' | undefined | null;
		'data-sveltekit-noscroll'?: true | '' | 'off' | undefined | null;
		'data-sveltekit-preload-code'?:
			| true
			| ''
			| 'eager'
			| 'viewport'
			| 'hover'
			| 'tap'
			| 'off'
			| undefined
			| null;
		'data-sveltekit-preload-data'?: true | '' | 'hover' | 'tap' | 'off' | undefined | null;
		'data-sveltekit-reload'?: true | '' | 'off' | undefined | null;
		'data-sveltekit-replacestate'?: true | '' | 'off' | undefined | null;
	}
}

export {};
`;

/**
 * Writes non-ambient declarations to the output directory
 * @param {import('types').ValidatedKitConfig} config
 */
export function write_non_ambient(config) {
	write_if_changed(path.join(config.outDir, 'non-ambient.d.ts'), template);
}

```


####### packages/kit/src/core/sync/write_root.js #######

```

import { dedent, isSvelte5Plus, write_if_changed } from './utils.js';

/**
 * @param {import('types').ManifestData} manifest_data
 * @param {string} output
 */
export function write_root(manifest_data, output) {
	// TODO remove default layout altogether

	const max_depth = Math.max(
		...manifest_data.routes.map((route) =>
			route.page ? route.page.layouts.filter(Boolean).length + 1 : 0
		),
		1
	);

	const levels = [];
	for (let i = 0; i <= max_depth; i += 1) {
		levels.push(i);
	}

	let l = max_depth;

	let pyramid = `<svelte:component this={constructors[${l}]} bind:this={components[${l}]} data={data_${l}} {form} />`;

	while (l--) {
		pyramid = dedent`
			{#if constructors[${l + 1}]}
				<svelte:component this={constructors[${l}]} bind:this={components[${l}]} data={data_${l}}>
					${pyramid}
				</svelte:component>
			{:else}
				<svelte:component this={constructors[${l}]} bind:this={components[${l}]} data={data_${l}} {form} />
			{/if}
		`;
	}

	write_if_changed(
		`${output}/root.svelte`,
		dedent`
			<!-- This file is generated by @sveltejs/kit — do not edit it! -->
			${isSvelte5Plus() ? '<svelte:options runes={true} />' : ''}
			<script>
				import { setContext, ${isSvelte5Plus() ? '' : 'afterUpdate, '}onMount, tick } from 'svelte';
				import { browser } from '$app/environment';

				// stores
				${
					isSvelte5Plus()
						? dedent`
							let { stores, page, constructors, components = [], form, ${levels
								.map((l) => `data_${l} = null`)
								.join(', ')} } = $props();
						`
						: dedent`
							export let stores;
							export let page;

							export let constructors;
							export let components = [];
							export let form;
							${levels.map((l) => `export let data_${l} = null;`).join('\n')}
						`
				}

				if (!browser) {
					setContext('__svelte__', stores);
				}

				${
					isSvelte5Plus()
						? dedent`
							if (browser) {
								$effect.pre(() => stores.page.set(page));
							} else {
								stores.page.set(page);
							}
						`
						: '$: stores.page.set(page);'
				}
				${
					isSvelte5Plus()
						? dedent`
							$effect(() => {
								stores;page;constructors;components;form;${levels.map((l) => `data_${l}`).join(';')};
								stores.page.notify();
							});
						`
						: 'afterUpdate(stores.page.notify);'
				}

				let mounted = ${isSvelte5Plus() ? '$state(false)' : 'false'};
				let navigated = ${isSvelte5Plus() ? '$state(false)' : 'false'};
				let title = ${isSvelte5Plus() ? '$state(null)' : 'null'};

				onMount(() => {
					const unsubscribe = stores.page.subscribe(() => {
						if (mounted) {
							navigated = true;
							tick().then(() => {
								title = document.title || 'untitled page';
							});
						}
					});

					mounted = true;
					return unsubscribe;
				});
			</script>

			${pyramid}

			{#if mounted}
				<div id="svelte-announcer" aria-live="assertive" aria-atomic="true" style="position: absolute; left: 0; top: 0; clip: rect(0 0 0 0); clip-path: inset(50%); overflow: hidden; white-space: nowrap; width: 1px; height: 1px">
					{#if navigated}
						{title}
					{/if}
				</div>
			{/if}
		`
	);

	if (isSvelte5Plus()) {
		write_if_changed(
			`${output}/root.js`,
			dedent`
			import { asClassComponent } from 'svelte/legacy';
			import Root from './root.svelte';
			export default asClassComponent(Root);
		`
		);
	}
}

```


####### packages/kit/src/core/sync/write_server.js #######

```

import path from 'node:path';
import { hash } from '../../runtime/hash.js';
import { posixify, resolve_entry } from '../../utils/filesystem.js';
import { s } from '../../utils/misc.js';
import { load_error_page, load_template } from '../config/index.js';
import { runtime_directory } from '../utils.js';
import { isSvelte5Plus, write_if_changed } from './utils.js';
import colors from 'kleur';

/**
 * @param {{
 *   server_hooks: string | null;
 *   universal_hooks: string | null;
 *   config: import('types').ValidatedConfig;
 *   has_service_worker: boolean;
 *   runtime_directory: string;
 *   template: string;
 *   error_page: string;
 * }} opts
 */
const server_template = ({
	config,
	server_hooks,
	universal_hooks,
	has_service_worker,
	runtime_directory,
	template,
	error_page
}) => `
import root from '../root.${isSvelte5Plus() ? 'js' : 'svelte'}';
import { set_building, set_prerendering } from '__sveltekit/environment';
import { set_assets } from '__sveltekit/paths';
import { set_manifest, set_read_implementation } from '__sveltekit/server';
import { set_private_env, set_public_env, set_safe_public_env } from '${runtime_directory}/shared-server.js';

export const options = {
	app_dir: ${s(config.kit.appDir)},
	app_template_contains_nonce: ${template.includes('%sveltekit.nonce%')},
	csp: ${s(config.kit.csp)},
	csrf_check_origin: ${s(config.kit.csrf.checkOrigin)},
	embedded: ${config.kit.embedded},
	env_public_prefix: '${config.kit.env.publicPrefix}',
	env_private_prefix: '${config.kit.env.privatePrefix}',
	hooks: null, // added lazily, via \`get_hooks\`
	preload_strategy: ${s(config.kit.output.preloadStrategy)},
	root,
	service_worker: ${has_service_worker},
	templates: {
		app: ({ head, body, assets, nonce, env }) => ${s(template)
			.replace('%sveltekit.head%', '" + head + "')
			.replace('%sveltekit.body%', '" + body + "')
			.replace(/%sveltekit\.assets%/g, '" + assets + "')
			.replace(/%sveltekit\.nonce%/g, '" + nonce + "')
			.replace(
				/%sveltekit\.env\.([^%]+)%/g,
				(_match, capture) => `" + (env[${s(capture)}] ?? "") + "`
			)},
		error: ({ status, message }) => ${s(error_page)
			.replace(/%sveltekit\.status%/g, '" + status + "')
			.replace(/%sveltekit\.error\.message%/g, '" + message + "')}
	},
	version_hash: ${s(hash(config.kit.version.name))}
};

export async function get_hooks() {
	return {
		${server_hooks ? `...(await import(${s(server_hooks)})),` : ''}
		${universal_hooks ? `...(await import(${s(universal_hooks)})),` : ''}
	};
}

export { set_assets, set_building, set_manifest, set_prerendering, set_private_env, set_public_env, set_read_implementation, set_safe_public_env };
`;

// TODO need to re-run this whenever src/app.html or src/error.html are
// created or changed, or src/service-worker.js is created or deleted.
// Also, need to check that updating hooks.server.js works

/**
 * Write server configuration to disk
 * @param {import('types').ValidatedConfig} config
 * @param {string} output
 */
export function write_server(config, output) {
	const server_hooks_file = resolve_entry(config.kit.files.hooks.server);
	const universal_hooks_file = resolve_entry(config.kit.files.hooks.universal);

	const typo = resolve_entry('src/+hooks.server');
	if (typo) {
		console.log(
			colors
				.bold()
				.yellow(
					`Unexpected + prefix. Did you mean ${typo.split('/').at(-1)?.slice(1)}?` +
						` at ${path.resolve(typo)}`
				)
		);
	}

	/** @param {string} file */
	function relative(file) {
		return posixify(path.relative(`${output}/server`, file));
	}

	write_if_changed(
		`${output}/server/internal.js`,
		server_template({
			config,
			server_hooks: server_hooks_file ? relative(server_hooks_file) : null,
			universal_hooks: universal_hooks_file ? relative(universal_hooks_file) : null,
			has_service_worker:
				config.kit.serviceWorker.register && !!resolve_entry(config.kit.files.serviceWorker),
			runtime_directory: relative(runtime_directory),
			template: load_template(process.cwd(), config),
			error_page: load_error_page(config)
		})
	);
}

```


####### packages/kit/src/core/sync/write_tsconfig.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import colors from 'kleur';
import { posixify } from '../../utils/filesystem.js';
import { write_if_changed } from './utils.js';

/**
 * @param {string} cwd
 * @param {string} file
 */
function maybe_file(cwd, file) {
	const resolved = path.resolve(cwd, file);
	if (fs.existsSync(resolved)) {
		return resolved;
	}
}

/**
 * @param {string} file
 */
function project_relative(file) {
	return posixify(path.relative('.', file));
}

/**
 * @param {string} file
 */
function remove_trailing_slashstar(file) {
	if (file.endsWith('/*')) {
		return file.slice(0, -2);
	} else {
		return file;
	}
}

/**
 * Generates the tsconfig that the user's tsconfig inherits from.
 * @param {import('types').ValidatedKitConfig} kit
 */
export function write_tsconfig(kit, cwd = process.cwd()) {
	const out = path.join(kit.outDir, 'tsconfig.json');

	const user_config = load_user_tsconfig(cwd);
	if (user_config) validate_user_config(cwd, out, user_config);

	write_if_changed(out, JSON.stringify(get_tsconfig(kit), null, '\t'));
}

/**
 * Generates the tsconfig that the user's tsconfig inherits from.
 * @param {import('types').ValidatedKitConfig} kit
 */
export function get_tsconfig(kit) {
	/** @param {string} file */
	const config_relative = (file) => posixify(path.relative(kit.outDir, file));

	const include = new Set([
		'ambient.d.ts', // careful: changing this name would be a breaking change, because it's referenced in the service-workers documentation
		'non-ambient.d.ts',
		'./types/**/$types.d.ts',
		config_relative('vite.config.js'),
		config_relative('vite.config.ts')
	]);
	// TODO(v2): find a better way to include all src files. We can't just use routes/lib only because
	// people might have other folders/files in src that they want included.
	const src_includes = [kit.files.routes, kit.files.lib, path.resolve('src')].filter((dir) => {
		const relative = path.relative(path.resolve('src'), dir);
		return !relative || relative.startsWith('..');
	});
	for (const dir of src_includes) {
		include.add(config_relative(`${dir}/**/*.js`));
		include.add(config_relative(`${dir}/**/*.ts`));
		include.add(config_relative(`${dir}/**/*.svelte`));
	}

	// Test folder is a special case - we advocate putting tests in a top-level test folder
	// and it's not configurable (should we make it?)
	const test_folder = project_relative('tests');
	include.add(config_relative(`${test_folder}/**/*.js`));
	include.add(config_relative(`${test_folder}/**/*.ts`));
	include.add(config_relative(`${test_folder}/**/*.svelte`));

	const exclude = [config_relative('node_modules/**')];
	// Add service worker to exclude list so that worker types references in it don't spill over into the rest of the app
	// (i.e. suddenly ServiceWorkerGlobalScope would be available throughout the app, and some types might even clash)
	if (path.extname(kit.files.serviceWorker)) {
		exclude.push(config_relative(kit.files.serviceWorker));
	} else {
		exclude.push(config_relative(`${kit.files.serviceWorker}.js`));
		exclude.push(config_relative(`${kit.files.serviceWorker}.ts`));
		exclude.push(config_relative(`${kit.files.serviceWorker}.d.ts`));
	}

	const config = {
		compilerOptions: {
			// generated options
			paths: get_tsconfig_paths(kit),
			rootDirs: [config_relative('.'), './types'],

			// essential options
			// svelte-preprocess cannot figure out whether you have a value or a type, so tell TypeScript
			// to enforce using \`import type\` instead of \`import\` for Types.
			// Also, TypeScript doesn't know about import usages in the template because it only sees the
			// script of a Svelte file. Therefore preserve all value imports.
			verbatimModuleSyntax: true,
			// Vite compiles modules one at a time
			isolatedModules: true,

			// This is required for svelte-package to work as expected
			// Can be overwritten
			lib: ['esnext', 'DOM', 'DOM.Iterable'],
			moduleResolution: 'bundler',
			module: 'esnext',
			noEmit: true, // prevent tsconfig error "overwriting input files" - Vite handles the build and ignores this
			target: 'esnext'
		},
		include: [...include],
		exclude
	};

	return kit.typescript.config(config) ?? config;
}

/** @param {string} cwd */
function load_user_tsconfig(cwd) {
	const file = maybe_file(cwd, 'tsconfig.json') || maybe_file(cwd, 'jsconfig.json');

	if (!file) return;

	// we have to eval the file, since it's not parseable as JSON (contains comments)
	const json = fs.readFileSync(file, 'utf-8');

	return {
		kind: path.basename(file),
		options: (0, eval)(`(${json})`)
	};
}

/**
 * @param {string} cwd
 * @param {string} out
 * @param {{ kind: string, options: any }} config
 */
function validate_user_config(cwd, out, config) {
	// we need to check that the user's tsconfig extends the framework config
	const extend = config.options.extends;
	const extends_framework_config =
		typeof extend === 'string'
			? path.resolve(cwd, extend) === out
			: Array.isArray(extend)
				? extend.some((e) => path.resolve(cwd, e) === out)
				: false;

	const options = config.options.compilerOptions || {};

	if (extends_framework_config) {
		const { paths, baseUrl } = options;

		if (baseUrl || paths) {
			console.warn(
				colors
					.bold()
					.yellow(
						`You have specified a baseUrl and/or paths in your ${config.kind} which interferes with SvelteKit's auto-generated tsconfig.json. ` +
							'Remove it to avoid problems with intellisense. For path aliases, use `kit.alias` instead: https://kit.svelte.dev/docs/configuration#alias'
					)
			);
		}
	} else {
		let relative = posixify(path.relative('.', out));
		if (!relative.startsWith('./')) relative = './' + relative;

		console.warn(
			colors
				.bold()
				.yellow(`Your ${config.kind} should extend the configuration generated by SvelteKit:`)
		);
		console.warn(`{\n  "extends": "${relative}"\n}`);
	}
}

// <something><optional /*>
const alias_regex = /^(.+?)(\/\*)?$/;
// <path><optional /* or .fileending>
const value_regex = /^(.*?)((\/\*)|(\.\w+))?$/;

/**
 * Generates tsconfig path aliases from kit's aliases.
 * Related to vite alias creation.
 *
 * @param {import('types').ValidatedKitConfig} config
 */
function get_tsconfig_paths(config) {
	/** @param {string} file */
	const config_relative = (file) => posixify(path.relative(config.outDir, file));

	const alias = { ...config.alias };
	if (fs.existsSync(project_relative(config.files.lib))) {
		alias['$lib'] = project_relative(config.files.lib);
	}

	/** @type {Record<string, string[]>} */
	const paths = {};

	for (const [key, value] of Object.entries(alias)) {
		const key_match = alias_regex.exec(key);
		if (!key_match) throw new Error(`Invalid alias key: ${key}`);

		const value_match = value_regex.exec(value);
		if (!value_match) throw new Error(`Invalid alias value: ${value}`);

		const rel_path = config_relative(remove_trailing_slashstar(value));
		const slashstar = key_match[2];

		if (slashstar) {
			paths[key] = [rel_path + '/*'];
		} else {
			paths[key] = [rel_path];
			const fileending = value_match[4];

			if (!fileending && !(key + '/*' in alias)) {
				paths[key + '/*'] = [rel_path + '/*'];
			}
		}
	}

	return paths;
}

```


####### packages/kit/src/core/sync/write_tsconfig.spec.js #######

```

import { assert, expect, test } from 'vitest';
import { validate_config } from '../config/index.js';
import { get_tsconfig } from './write_tsconfig.js';

test('Creates tsconfig path aliases from kit.alias', () => {
	const { kit } = validate_config({
		kit: {
			alias: {
				simpleKey: 'simple/value',
				key: 'value',
				'key/*': 'some/other/value/*',
				keyToFile: 'path/to/file.ts'
			}
		}
	});

	const { compilerOptions } = get_tsconfig(kit);

	// $lib isn't part of the outcome because there's a "path exists"
	// check in the implementation
	expect(compilerOptions.paths).toEqual({
		simpleKey: ['../simple/value'],
		'simpleKey/*': ['../simple/value/*'],
		key: ['../value'],
		'key/*': ['../some/other/value/*'],
		keyToFile: ['../path/to/file.ts']
	});
});

test('Allows generated tsconfig to be mutated', () => {
	const { kit } = validate_config({
		kit: {
			typescript: {
				config: (config) => {
					config.extends = 'some/other/tsconfig.json';
				}
			}
		}
	});

	const config = get_tsconfig(kit);

	// @ts-expect-error
	assert.equal(config.extends, 'some/other/tsconfig.json');
});

test('Allows generated tsconfig to be replaced', () => {
	const { kit } = validate_config({
		kit: {
			typescript: {
				config: (config) => ({
					...config,
					extends: 'some/other/tsconfig.json'
				})
			}
		}
	});

	const config = get_tsconfig(kit);

	// @ts-expect-error
	assert.equal(config.extends, 'some/other/tsconfig.json');
});

test('Creates tsconfig include from kit.files', () => {
	const { kit } = validate_config({
		kit: {
			files: {
				lib: 'app'
			}
		}
	});

	const { include } = get_tsconfig(kit);

	expect(include).toEqual([
		'ambient.d.ts',
		'non-ambient.d.ts',
		'./types/**/$types.d.ts',
		'../vite.config.js',
		'../vite.config.ts',
		'../app/**/*.js',
		'../app/**/*.ts',
		'../app/**/*.svelte',
		'../src/**/*.js',
		'../src/**/*.ts',
		'../src/**/*.svelte',
		'../tests/**/*.js',
		'../tests/**/*.ts',
		'../tests/**/*.svelte'
	]);
});

```


####### packages/kit/src/core/sync/write_types/index.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import MagicString from 'magic-string';
import { posixify, rimraf, walk } from '../../../utils/filesystem.js';
import { compact } from '../../../utils/array.js';
import { ts } from '../ts.js';

/**
 *  @typedef {{
 *   file_name: string;
 *   modified: boolean;
 *   code: string;
 *   exports: any[];
 *  } | null} Proxy
 *
 *  @typedef {{
 *   server: Proxy,
 *   universal: Proxy
 *  }} Proxies
 *
 *  @typedef {Map<import('types').PageNode, {route: import('types').RouteData, proxies: Proxies}>} RoutesMap
 */

const cwd = process.cwd();

/**
 * Creates types for the whole manifest
 * @param {import('types').ValidatedConfig} config
 * @param {import('types').ManifestData} manifest_data
 */
export async function write_all_types(config, manifest_data) {
	if (!ts) return;

	const types_dir = `${config.kit.outDir}/types`;

	// empty out files that no longer need to exist
	const routes_dir = posixify(path.relative('.', config.kit.files.routes)).replace(/\.\.\//g, '');
	const expected_directories = new Set(
		manifest_data.routes.map((route) => path.join(routes_dir, route.id))
	);

	if (fs.existsSync(types_dir)) {
		for (const file of walk(types_dir)) {
			const dir = path.dirname(file);
			if (!expected_directories.has(dir)) {
				rimraf(path.join(types_dir, file));
			}
		}
	}

	// Read/write meta data on each invocation, not once per node process,
	// it could be invoked by another process in the meantime.
	const meta_data_file = `${types_dir}/route_meta_data.json`;
	const has_meta_data = fs.existsSync(meta_data_file);
	const meta_data = has_meta_data
		? /** @type {Record<string, string[]>} */ (JSON.parse(fs.readFileSync(meta_data_file, 'utf-8')))
		: {};
	const routes_map = create_routes_map(manifest_data);
	// For each directory, write $types.d.ts
	for (const route of manifest_data.routes) {
		if (!route.leaf && !route.layout && !route.endpoint) continue; // nothing to do

		const outdir = path.join(config.kit.outDir, 'types', routes_dir, route.id);

		// check if the types are out of date
		/** @type {string[]} */
		const input_files = [];

		/** @type {import('types').PageNode | null} */
		let node = route.leaf;
		while (node) {
			if (node.universal) input_files.push(node.universal);
			if (node.server) input_files.push(node.server);
			node = node.parent ?? null;
		}

		/** @type {import('types').PageNode | null} */
		node = route.layout;
		while (node) {
			if (node.universal) input_files.push(node.universal);
			if (node.server) input_files.push(node.server);
			node = node.parent ?? null;
		}

		if (route.endpoint) {
			input_files.push(route.endpoint.file);
		}

		try {
			fs.mkdirSync(outdir, { recursive: true });
		} catch {}

		const output_files = compact(
			fs.readdirSync(outdir).map((name) => {
				const stats = fs.statSync(path.join(outdir, name));
				if (stats.isDirectory()) return;
				return {
					name,
					updated: stats.mtimeMs
				};
			})
		);

		const source_last_updated = Math.max(
			// ctimeMs includes move operations whereas mtimeMs does not
			...input_files.map((file) => fs.statSync(file).ctimeMs)
		);
		const types_last_updated = Math.max(...output_files.map((file) => file.updated));

		const should_generate =
			// source files were generated more recently than the types
			source_last_updated > types_last_updated ||
			// no meta data file exists yet
			!has_meta_data ||
			// some file was deleted
			!meta_data[route.id]?.every((file) => input_files.includes(file));

		if (should_generate) {
			// track which old files end up being surplus to requirements
			const to_delete = new Set(output_files.map((file) => file.name));
			update_types(config, routes_map, route, to_delete);
			meta_data[route.id] = input_files;
		}
	}

	fs.writeFileSync(meta_data_file, JSON.stringify(meta_data, null, '\t'));
}

/**
 * Creates types related to the given file. This should only be called
 * if the file in question was edited, not if it was created/deleted/moved.
 * @param {import('types').ValidatedConfig} config
 * @param {import('types').ManifestData} manifest_data
 * @param {string} file
 */
export async function write_types(config, manifest_data, file) {
	if (!ts) return;

	if (!path.basename(file).startsWith('+')) {
		// Not a route file
		return;
	}

	const id = '/' + posixify(path.relative(config.kit.files.routes, path.dirname(file)));

	const route = manifest_data.routes.find((route) => route.id === id);
	if (!route) return;
	if (!route.leaf && !route.layout && !route.endpoint) return; // nothing to do

	update_types(config, create_routes_map(manifest_data), route);
}

/**
 * Collect all leafs into a leaf -> route map
 * @param {import('types').ManifestData} manifest_data
 */
function create_routes_map(manifest_data) {
	/** @type {RoutesMap} */
	const map = new Map();
	for (const route of manifest_data.routes) {
		if (route.leaf) {
			map.set(route.leaf, { route, proxies: { server: null, universal: null } });
		}
	}
	return map;
}

/**
 * Update types for a specific route
 * @param {import('types').ValidatedConfig} config
 * @param {RoutesMap} routes
 * @param {import('types').RouteData} route
 * @param {Set<string>} [to_delete]
 */
function update_types(config, routes, route, to_delete = new Set()) {
	const routes_dir = posixify(path.relative('.', config.kit.files.routes)).replace(/\.\.\//g, '');
	const outdir = path.join(config.kit.outDir, 'types', routes_dir, route.id);

	// now generate new types
	const imports = ["import type * as Kit from '@sveltejs/kit';"];

	/** @type {string[]} */
	const declarations = [];

	/** @type {string[]} */
	const exports = [];

	// add 'Expand' helper
	// Makes sure a type is "repackaged" and therefore more readable
	declarations.push('type Expand<T> = T extends infer O ? { [K in keyof O]: O[K] } : never;');

	// returns the predicate of a matcher's type guard - or string if there is no type guard
	declarations.push(
		// TS complains on infer U, which seems weird, therefore ts-ignore it
		[
			'// @ts-ignore',
			'type MatcherParam<M> = M extends (param : string) => param is infer U ? U extends string ? U : string : string;'
		].join('\n')
	);

	declarations.push(
		'type RouteParams = ' + generate_params_type(route.params, outdir, config) + ';'
	);

	if (route.params.length > 0) {
		exports.push(
			'export type EntryGenerator = () => Promise<Array<RouteParams>> | Array<RouteParams>;'
		);
	}

	declarations.push(`type RouteId = '${route.id}';`);

	// These could also be placed in our public types, but it would bloat them unnecessarily and we may want to change these in the future
	if (route.layout || route.leaf) {
		declarations.push(
			// If T extends the empty object, void is also allowed as a return type
			'type MaybeWithVoid<T> = {} extends T ? T | void : T;',

			// Returns the key of the object whose values are required.
			'export type RequiredKeys<T> = { [K in keyof T]-?: {} extends { [P in K]: T[K] } ? never : K; }[keyof T];',

			// Helper type to get the correct output type for load functions. It should be passed the parent type to check what types from App.PageData are still required.
			// If none, void is also allowed as a return type.
			'type OutputDataShape<T> = MaybeWithVoid<Omit<App.PageData, RequiredKeys<T>> & Partial<Pick<App.PageData, keyof T & keyof App.PageData>> & Record<string, any>>',

			// null & {} == null, we need to prevent that in some situations
			'type EnsureDefined<T> = T extends null | undefined ? {} : T;',

			// Takes a union type and returns a union type where each type also has all properties
			// of all possible types (typed as undefined), making accessing them more ergonomic
			'type OptionalUnion<U extends Record<string, any>, A extends keyof U = U extends U ? keyof U : never> = U extends unknown ? { [P in Exclude<A, keyof U>]?: never } & U : never;',

			// Re-export `Snapshot` from @sveltejs/kit — in future we could use this to infer <T> from the return type of `snapshot.capture`
			'export type Snapshot<T = any> = Kit.Snapshot<T>;'
		);
	}

	if (route.leaf) {
		let route_info = routes.get(route.leaf);
		if (!route_info) {
			// This should be defined, but belts and braces
			route_info = { route, proxies: { server: null, universal: null } };
			routes.set(route.leaf, route_info);
		}

		const {
			declarations: d,
			exports: e,
			proxies
		} = process_node(route.leaf, outdir, true, route_info.proxies);

		exports.push(...e);
		declarations.push(...d);

		if (proxies.server) {
			route_info.proxies.server = proxies.server;
			if (proxies.server?.modified) to_delete.delete(proxies.server.file_name);
		}
		if (proxies.universal) {
			route_info.proxies.universal = proxies.universal;
			if (proxies.universal?.modified) to_delete.delete(proxies.universal.file_name);
		}

		if (route.leaf.server) {
			exports.push(
				'export type Action<OutputData extends Record<string, any> | void = Record<string, any> | void> = Kit.Action<RouteParams, OutputData, RouteId>'
			);
			exports.push(
				'export type Actions<OutputData extends Record<string, any> | void = Record<string, any> | void> = Kit.Actions<RouteParams, OutputData, RouteId>'
			);
		}
	}

	if (route.layout) {
		let all_pages_have_load = true;
		/** @type {import('types').RouteParam[]} */
		const layout_params = [];
		const ids = ['RouteId'];

		route.layout.child_pages?.forEach((page) => {
			const leaf = routes.get(page);
			if (leaf) {
				if (leaf.route.page) ids.push(`"${leaf.route.id}"`);

				for (const param of leaf.route.params) {
					// skip if already added
					if (layout_params.some((p) => p.name === param.name)) continue;
					layout_params.push({ ...param, optional: true });
				}

				ensureProxies(page, leaf.proxies);

				if (
					// Be defensive - if a proxy doesn't exist (because it couldn't be created), assume a load function exists.
					// If we didn't and it's a false negative, the user could wrongfully get a type error on layouts.
					(leaf.proxies.server && !leaf.proxies.server.exports.includes('load')) ||
					(leaf.proxies.universal && !leaf.proxies.universal.exports.includes('load'))
				) {
					all_pages_have_load = false;
				}
			}
			if (!page.server && !page.universal) {
				all_pages_have_load = false;
			}
		});

		if (route.id === '/') {
			// root layout is used for fallback error page, where ID can be null
			ids.push('null');
		}

		declarations.push(`type LayoutRouteId = ${ids.join(' | ')}`);

		declarations.push(
			'type LayoutParams = RouteParams & ' + generate_params_type(layout_params, outdir, config)
		);

		const {
			exports: e,
			declarations: d,
			proxies
		} = process_node(
			route.layout,
			outdir,
			false,
			{ server: null, universal: null },
			all_pages_have_load
		);

		exports.push(...e);
		declarations.push(...d);

		if (proxies.server?.modified) to_delete.delete(proxies.server.file_name);
		if (proxies.universal?.modified) to_delete.delete(proxies.universal.file_name);
	}

	if (route.endpoint) {
		exports.push('export type RequestHandler = Kit.RequestHandler<RouteParams, RouteId>;');
	}

	if (route.leaf?.server || route.layout?.server || route.endpoint) {
		exports.push('export type RequestEvent = Kit.RequestEvent<RouteParams, RouteId>;');
	}

	const output = [imports.join('\n'), declarations.join('\n'), exports.join('\n')]
		.filter(Boolean)
		.join('\n\n');

	fs.writeFileSync(`${outdir}/$types.d.ts`, output);
	to_delete.delete('$types.d.ts');

	for (const file of to_delete) {
		fs.unlinkSync(path.join(outdir, file));
	}
}

/**
 * @param {import('types').PageNode} node
 * @param {string} outdir
 * @param {boolean} is_page
 * @param {Proxies} proxies
 * @param {boolean} [all_pages_have_load]
 */
function process_node(node, outdir, is_page, proxies, all_pages_have_load = true) {
	const params = `${is_page ? 'Route' : 'Layout'}Params`;
	const prefix = is_page ? 'Page' : 'Layout';

	const route_id = is_page ? 'RouteId' : 'LayoutRouteId';

	/** @type {string[]} */
	const declarations = [];
	/** @type {string[]} */
	const exports = [];

	/** @type {string} */
	let server_data;
	/** @type {string} */
	let data;

	ensureProxies(node, proxies);

	if (node.server) {
		const basename = path.basename(node.server);
		const proxy = proxies.server;
		if (proxy?.modified) {
			fs.writeFileSync(`${outdir}/proxy${basename}`, proxy.code);
		}

		server_data = get_data_type(node.server, 'null', proxy, true);

		const parent_type = `${prefix}ServerParentData`;

		declarations.push(`type ${parent_type} = ${get_parent_type(node, 'LayoutServerData')};`);

		// +page.js load present -> server can return all-optional data
		const output_data_shape =
			node.universal || (!is_page && all_pages_have_load)
				? 'Partial<App.PageData> & Record<string, any> | void'
				: `OutputDataShape<${parent_type}>`;
		exports.push(
			`export type ${prefix}ServerLoad<OutputData extends ${output_data_shape} = ${output_data_shape}> = Kit.ServerLoad<${params}, ${parent_type}, OutputData, ${route_id}>;`
		);

		exports.push(`export type ${prefix}ServerLoadEvent = Parameters<${prefix}ServerLoad>[0];`);

		if (is_page) {
			let type = 'unknown';
			if (proxy && proxy.exports.includes('actions')) {
				// If the file wasn't tweaked, we can use the return type of the original file.
				// The advantage is that type updates are reflected without saving.
				const from = proxy.modified
					? `./proxy${replace_ext_with_js(basename)}`
					: path_to_original(outdir, node.server);

				exports.push(
					'type ExcludeActionFailure<T> = T extends Kit.ActionFailure<any> ? never : T extends void ? never : T;',
					'type ActionsSuccess<T extends Record<string, (...args: any) => any>> = { [Key in keyof T]: ExcludeActionFailure<Awaited<ReturnType<T[Key]>>>; }[keyof T];',
					'type ExtractActionFailure<T> = T extends Kit.ActionFailure<infer X>	? X extends void ? never : X : never;',
					'type ActionsFailure<T extends Record<string, (...args: any) => any>> = { [Key in keyof T]: Exclude<ExtractActionFailure<Awaited<ReturnType<T[Key]>>>, void>; }[keyof T];',
					`type ActionsExport = typeof import('${from}').actions`,
					'export type SubmitFunction = Kit.SubmitFunction<Expand<ActionsSuccess<ActionsExport>>, Expand<ActionsFailure<ActionsExport>>>'
				);

				type = 'Expand<Kit.AwaitedActions<ActionsExport>> | null';
			}
			exports.push(`export type ActionData = ${type};`);
		}
	} else {
		server_data = 'null';
	}
	exports.push(`export type ${prefix}ServerData = ${server_data};`);

	const parent_type = `${prefix}ParentData`;
	declarations.push(`type ${parent_type} = ${get_parent_type(node, 'LayoutData')};`);

	if (node.universal) {
		const proxy = proxies.universal;
		if (proxy?.modified) {
			fs.writeFileSync(`${outdir}/proxy${path.basename(node.universal)}`, proxy.code);
		}

		const type = get_data_type(
			node.universal,
			`${parent_type} & EnsureDefined<${prefix}ServerData>`,
			proxy
		);

		data = `Expand<Omit<${parent_type}, keyof ${type}> & OptionalUnion<EnsureDefined<${type}>>>`;

		const output_data_shape =
			!is_page && all_pages_have_load
				? 'Partial<App.PageData> & Record<string, any> | void'
				: `OutputDataShape<${parent_type}>`;
		exports.push(
			`export type ${prefix}Load<OutputData extends ${output_data_shape} = ${output_data_shape}> = Kit.Load<${params}, ${prefix}ServerData, ${parent_type}, OutputData, ${route_id}>;`
		);

		exports.push(`export type ${prefix}LoadEvent = Parameters<${prefix}Load>[0];`);
	} else if (server_data === 'null') {
		data = `Expand<${parent_type}>`;
	} else {
		data = `Expand<Omit<${parent_type}, keyof ${prefix}ServerData> & EnsureDefined<${prefix}ServerData>>`;
	}

	exports.push(`export type ${prefix}Data = ${data};`);

	return { declarations, exports, proxies };

	/**
	 * @param {string} file_path
	 * @param {string} fallback
	 * @param {Proxy} proxy
	 * @param {boolean} expand
	 */
	function get_data_type(file_path, fallback, proxy, expand = false) {
		if (proxy) {
			if (proxy.exports.includes('load')) {
				// If the file wasn't tweaked, we can use the return type of the original file.
				// The advantage is that type updates are reflected without saving.
				const from = proxy.modified
					? `./proxy${replace_ext_with_js(path.basename(file_path))}`
					: path_to_original(outdir, file_path);
				const type = `Kit.LoadProperties<Awaited<ReturnType<typeof import('${from}').load>>>`;
				return expand ? `Expand<OptionalUnion<EnsureDefined<${type}>>>` : type;
			} else {
				return fallback;
			}
		} else {
			return 'unknown';
		}
	}
}

/**
 * This function populates the proxies object, if necessary and not already done.
 * Proxies are used to tweak the code of a file before it's typechecked.
 * They are needed in two places - when generating the types for a page or layout.
 * To not do the same work twice, we generate the proxies once and pass them around.
 *
 * @param {import('types').PageNode} node
 * @param {Proxies} proxies
 */
function ensureProxies(node, proxies) {
	if (node.server && !proxies.server) {
		proxies.server = createProxy(node.server, true);
	}

	if (node.universal && !proxies.universal) {
		proxies.universal = createProxy(node.universal, false);
	}
}

/**
 * @param {string} file_path
 * @param {boolean} is_server
 * @returns {Proxy}
 */
function createProxy(file_path, is_server) {
	const proxy = tweak_types(fs.readFileSync(file_path, 'utf8'), is_server);
	if (proxy) {
		return {
			...proxy,
			file_name: `proxy${path.basename(file_path)}`
		};
	} else {
		return null;
	}
}

/**
 * Get the parent type string by recursively looking up the parent layout and accumulate them to one type.
 * @param {import('types').PageNode} node
 * @param {string} type
 */
function get_parent_type(node, type) {
	const parent_imports = [];

	let parent = node.parent;

	while (parent) {
		const d = node.depth - parent.depth;
		// unshift because we need it the other way round for the import string
		parent_imports.unshift(
			`${d === 0 ? '' : `import('${'../'.repeat(d)}${'$types.js'}').`}${type}`
		);
		parent = parent.parent;
	}

	let parent_str = `EnsureDefined<${parent_imports[0] || '{}'}>`;
	for (let i = 1; i < parent_imports.length; i++) {
		// Omit is necessary because a parent could have a property with the same key which would
		// cause a type conflict. At runtime the child overwrites the parent property in this case,
		// so reflect that in the type definition.
		// EnsureDefined is necessary because {something: string} & null becomes null.
		// Output types of server loads can be null but when passed in through the `parent` parameter they are the empty object instead.
		parent_str = `Omit<${parent_str}, keyof ${parent_imports[i]}> & EnsureDefined<${parent_imports[i]}>`;
	}
	return parent_str;
}

/**
 * @param {string} outdir
 * @param {string} file_path
 */
function path_to_original(outdir, file_path) {
	return posixify(path.relative(outdir, path.join(cwd, replace_ext_with_js(file_path))));
}

/**
 * @param {string} file_path
 */
function replace_ext_with_js(file_path) {
	// Another extension than `.js` (or nothing, but that fails with node16 moduleResolution)
	// will result in TS failing to lookup the file
	const ext = path.extname(file_path);
	return file_path.slice(0, -ext.length) + '.js';
}

/**
 * @param {import('types').RouteParam[]} params
 * @param {string} outdir
 * @param {import('types').ValidatedConfig} config
 */
function generate_params_type(params, outdir, config) {
	/** @param {string} matcher */
	const path_to_matcher = (matcher) =>
		posixify(path.relative(outdir, path.join(config.kit.files.params, matcher)));

	return `{ ${params
		.map(
			(param) =>
				`${param.name}${param.optional ? '?' : ''}: ${
					param.matcher
						? `MatcherParam<typeof import('${path_to_matcher(param.matcher)}').match>`
						: 'string'
				}`
		)
		.join('; ')} }`;
}

/**
 * @param {string} content
 * @param {boolean} is_server
 * @returns {Omit<NonNullable<Proxy>, 'file_name'> | null}
 */
export function tweak_types(content, is_server) {
	const names = new Set(is_server ? ['load', 'actions'] : ['load']);

	try {
		let modified = false;

		const ast = ts.createSourceFile(
			'filename.ts',
			content,
			ts.ScriptTarget.Latest,
			false,
			ts.ScriptKind.TS
		);

		const code = new MagicString(content);

		const exports = new Map();

		ast.forEachChild((node) => {
			if (
				ts.isExportDeclaration(node) &&
				node.exportClause &&
				ts.isNamedExports(node.exportClause)
			) {
				node.exportClause.elements.forEach((element) => {
					const exported = element.name;
					if (names.has(element.name.text)) {
						const local = element.propertyName || element.name;
						exports.set(exported.text, local.text);
					}
				});
			}

			if (
				ts.canHaveModifiers(node) &&
				ts.getModifiers(node)?.some((modifier) => modifier.kind === ts.SyntaxKind.ExportKeyword)
			) {
				if (ts.isFunctionDeclaration(node) && node.name?.text && names.has(node.name?.text)) {
					exports.set(node.name.text, node.name.text);
				}

				if (ts.isVariableStatement(node)) {
					node.declarationList.declarations.forEach((declaration) => {
						if (ts.isIdentifier(declaration.name) && names.has(declaration.name.text)) {
							exports.set(declaration.name.text, declaration.name.text);
						}
					});
				}
			}
		});

		/**
		 * @param {import('typescript').Node} node
		 * @param {import('typescript').Node} value
		 */
		function replace_jsdoc_type_tags(node, value) {
			let _modified = false;
			// @ts-ignore
			if (node.jsDoc) {
				// @ts-ignore
				for (const comment of node.jsDoc) {
					for (const tag of comment.tags ?? []) {
						if (ts.isJSDocTypeTag(tag)) {
							const is_fn =
								ts.isFunctionDeclaration(value) ||
								ts.isFunctionExpression(value) ||
								ts.isArrowFunction(value);

							if (is_fn && value.parameters?.length > 0) {
								const name = ts.isIdentifier(value.parameters[0].name)
									? value.parameters[0].name.text
									: 'event';
								code.overwrite(tag.tagName.pos, tag.tagName.end, 'param');
								code.prependRight(tag.typeExpression.pos + 1, 'Parameters<');
								code.appendLeft(tag.typeExpression.end - 1, '>[0]');
								code.appendLeft(tag.typeExpression.end, ` ${name}`);
							} else {
								code.overwrite(tag.pos, tag.end, '');
							}
							_modified = true;
						}
					}
				}
			}
			modified = modified || _modified;
			return _modified;
		}

		ast.forEachChild((node) => {
			if (ts.isFunctionDeclaration(node) && node.name?.text && node.name?.text === 'load') {
				// remove JSDoc comment above `export function load ...`
				replace_jsdoc_type_tags(node, node);
			}

			if (ts.isVariableStatement(node)) {
				// remove JSDoc comment above `export const load = ...`
				if (
					ts.isIdentifier(node.declarationList.declarations[0].name) &&
					names.has(node.declarationList.declarations[0].name.text) &&
					node.declarationList.declarations[0].initializer
				) {
					replace_jsdoc_type_tags(node, node.declarationList.declarations[0].initializer);
				}

				for (const declaration of node.declarationList.declarations) {
					if (
						ts.isIdentifier(declaration.name) &&
						declaration.name.text === 'load' &&
						declaration.initializer
					) {
						// edge case — remove JSDoc comment above individual export
						replace_jsdoc_type_tags(declaration, declaration.initializer);

						// remove type from `export const load: Load ...`
						if (declaration.type) {
							let a = declaration.type.pos;
							const b = declaration.type.end;
							while (/\s/.test(content[a])) a += 1;

							const type = content.slice(a, b);
							code.remove(declaration.name.end, declaration.type.end);

							const rhs = declaration.initializer;

							if (
								rhs &&
								(ts.isArrowFunction(rhs) || ts.isFunctionExpression(rhs)) &&
								rhs.parameters.length
							) {
								const arg = rhs.parameters[0];
								const add_parens = content[arg.pos - 1] !== '(';

								if (add_parens) code.prependRight(arg.pos, '(');

								if (arg && !arg.type) {
									code.appendLeft(
										arg.name.end,
										`: Parameters<${type}>[0]` + (add_parens ? ')' : '')
									);
								} else {
									// prevent "type X is imported but not used" (isn't silenced by @ts-nocheck) when svelte-check runs
									code.append(`;null as any as ${type};`);
								}
							} else {
								// prevent "type X is imported but not used" (isn't silenced by @ts-nocheck) when svelte-check runs
								code.append(`;null as any as ${type};`);
							}

							modified = true;
						}
					} else if (
						is_server &&
						ts.isIdentifier(declaration.name) &&
						declaration.name?.text === 'actions' &&
						declaration.initializer
					) {
						// remove JSDoc comment from `export const actions = ..`
						const removed = replace_jsdoc_type_tags(node, declaration.initializer);
						// ... and move type to each individual action
						if (removed) {
							const rhs = declaration.initializer;
							if (ts.isObjectLiteralExpression(rhs)) {
								for (const prop of rhs.properties) {
									if (ts.isPropertyAssignment(prop) && ts.isIdentifier(prop.name)) {
										const rhs = prop.initializer;
										const replaced = replace_jsdoc_type_tags(prop, rhs);
										if (
											!replaced &&
											rhs &&
											(ts.isArrowFunction(rhs) || ts.isFunctionExpression(rhs)) &&
											rhs.parameters?.[0]
										) {
											const name = ts.isIdentifier(rhs.parameters[0].name)
												? rhs.parameters[0].name.text
												: 'event';
											code.prependRight(
												rhs.pos,
												`/** @param {import('./$types').RequestEvent} ${name} */ `
											);
										}
									}
								}
							}
						}

						// remove type from `export const actions: Actions ...`
						if (declaration.type) {
							let a = declaration.type.pos;
							const b = declaration.type.end;
							while (/\s/.test(content[a])) a += 1;

							const type = content.slice(a, b);
							code.remove(declaration.name.end, declaration.type.end);
							code.append(`;null as any as ${type};`);
							modified = true;

							// ... and move type to each individual action
							const rhs = declaration.initializer;
							if (ts.isObjectLiteralExpression(rhs)) {
								for (const prop of rhs.properties) {
									if (ts.isPropertyAssignment(prop) && ts.isIdentifier(prop.name)) {
										const rhs = prop.initializer;

										if (
											rhs &&
											(ts.isArrowFunction(rhs) || ts.isFunctionExpression(rhs)) &&
											rhs.parameters.length
										) {
											const arg = rhs.parameters[0];
											const add_parens = content[arg.pos - 1] !== '(';

											if (add_parens) code.prependRight(arg.pos, '(');

											if (arg && !arg.type) {
												code.appendLeft(
													arg.name.end,
													": import('./$types').RequestEvent" + (add_parens ? ')' : '')
												);
											}
										}
									}
								}
							}
						}
					}
				}
			}
		});

		if (modified) {
			// Ignore all type errors so they don't show up twice when svelte-check runs
			// Account for possible @ts-check which would overwrite @ts-nocheck
			if (code.original.startsWith('// @ts-check')) {
				code.prependLeft('// @ts-check'.length, '\n// @ts-nocheck\n');
			} else {
				code.prepend('// @ts-nocheck\n');
			}
		}

		return {
			modified,
			code: code.toString(),
			exports: Array.from(exports.keys())
		};
	} catch {
		return null;
	}
}

```


####### packages/kit/src/core/sync/write_types/index.spec.js #######

```

import { execSync } from 'node:child_process';
import path from 'node:path';
import { fileURLToPath } from 'node:url';
import { assert, expect, test } from 'vitest';
import { rimraf } from '../../../utils/filesystem.js';
import options from '../../config/options.js';
import create_manifest_data from '../create_manifest_data/index.js';
import { tweak_types, write_all_types } from './index.js';

const cwd = fileURLToPath(new URL('./test', import.meta.url));

/**
 * @param {string} dir
 */
async function run_test(dir) {
	rimraf(path.join(cwd, dir, '.svelte-kit'));

	const initial = options({}, 'config');

	initial.kit.files.assets = path.resolve(cwd, 'static');
	initial.kit.files.params = path.resolve(cwd, dir, 'params');
	initial.kit.files.routes = path.resolve(cwd, dir);
	initial.kit.outDir = path.resolve(cwd, path.join(dir, '.svelte-kit'));

	const manifest = create_manifest_data({
		config: /** @type {import('types').ValidatedConfig} */ (initial)
	});
	await write_all_types(initial, manifest);
}

test('Creates correct $types', async () => {
	// To save us from creating a real SvelteKit project for each of the tests,
	// we first run the type generation directly for each test case, and then
	// call `tsc` to check that the generated types are valid.
	await run_test('actions');
	await run_test('simple-page-shared-only');
	await run_test('simple-page-server-only');
	await run_test('simple-page-server-and-shared');
	await run_test('layout');
	await run_test('layout-advanced');
	await run_test('slugs');
	await run_test('slugs-layout-not-all-pages-have-load');
	await run_test('param-type-inference');
	try {
		execSync('pnpm testtypes', { cwd });
	} catch (e) {
		console.error(/** @type {any} */ (e).stdout.toString());
		throw new Error('Type tests failed');
	}
});

test('Rewrites types for a TypeScript module', () => {
	const source = `
		export const load: Get = ({ params }) => {
			return {
				a: 1
			};
		};
	`;

	const rewritten = tweak_types(source, false);

	expect(rewritten?.exports).toEqual(['load']);
	assert.equal(
		rewritten?.code,
		`// @ts-nocheck

		export const load = ({ params }: Parameters<Get>[0]) => {
			return {
				a: 1
			};
		};
	`
	);
});

test('Rewrites types for a TypeScript module without param', () => {
	const source = `
		export const load: Get = () => {
			return {
				a: 1
			};
		};
	`;

	const rewritten = tweak_types(source, false);

	expect(rewritten?.exports).toEqual(['load']);
	assert.equal(
		rewritten?.code,
		`// @ts-nocheck

		export const load = () => {
			return {
				a: 1
			};
		};
	;null as any as Get;`
	);
});

test('Rewrites types for a TypeScript module without param and jsdoc without types', () => {
	const source = `
		/** test */
		export const load: Get = () => {
			return {
				a: 1
			};
		};
	`;

	const rewritten = tweak_types(source, false);

	expect(rewritten?.exports).toEqual(['load']);
	assert.equal(
		rewritten?.code,
		`// @ts-nocheck

		/** test */
		export const load = () => {
			return {
				a: 1
			};
		};
	;null as any as Get;`
	);
});

test('Rewrites types for a JavaScript module with `function`', () => {
	const source = `
		/** @type {import('./$types').Get} */
		export function load({ params }) {
			return {
				a: 1
			};
		};
	`;

	const rewritten = tweak_types(source, false);

	expect(rewritten?.exports).toEqual(['load']);
	assert.equal(
		rewritten?.code,
		`// @ts-nocheck

		/** @param {Parameters<import('./$types').Get>[0]} event */
		export function load({ params }) {
			return {
				a: 1
			};
		};
	`
	);
});

test('Rewrites types for a JavaScript module with `const`', () => {
	const source = `
		/** @type {import('./$types').Get} */
		export const load = ({ params }) => {
			return {
				a: 1
			};
		};
	`;

	const rewritten = tweak_types(source, false);

	expect(rewritten?.exports).toEqual(['load']);
	assert.equal(
		rewritten?.code,
		`// @ts-nocheck

		/** @param {Parameters<import('./$types').Get>[0]} event */
		export const load = ({ params }) => {
			return {
				a: 1
			};
		};
	`
	);
});

test('Appends @ts-nocheck after @ts-check', () => {
	const source = `// @ts-check
		/** @type {import('./$types').Get} */
		export const load = ({ params }) => {
			return {
				a: 1
			};
		};
	`;

	const rewritten = tweak_types(source, false);

	expect(rewritten?.exports).toEqual(['load']);
	assert.equal(
		rewritten?.code,
		`// @ts-check
// @ts-nocheck

		/** @param {Parameters<import('./$types').Get>[0]} event */
		export const load = ({ params }) => {
			return {
				a: 1
			};
		};
	`
	);
});

test('Rewrites action types for a JavaScript module', () => {
	const source = `
		/** @type {import('./$types').Actions} */
		export const actions = {
			a: () => {},
			b: (param) => {},
			/** @type {import('./$types').Action} */
			c: (param) => {},
		}
	`;

	const rewritten = tweak_types(source, true);

	expect(rewritten?.exports).toEqual(['actions']);
	assert.equal(
		rewritten?.code,
		`// @ts-nocheck

		/** */
		export const actions = {
			a: () => {},
			b:/** @param {import('./$types').RequestEvent} param */  (param) => {},
			/** @param {Parameters<import('./$types').Action>[0]} param */
			c: (param) => {},
		}
	`
	);
});

test('Rewrites action types for a TypeScript module', () => {
	const source = `
		import type { Actions, RequestEvent } from './$types';

		export const actions: Actions = {
			a: () => {},
			b: (param: RequestEvent) => {},
			c: (param) => {},
		}
	`;

	const rewritten = tweak_types(source, true);

	expect(rewritten?.exports).toEqual(['actions']);
	assert.equal(
		rewritten?.code,
		`// @ts-nocheck

		import type { Actions, RequestEvent } from './$types';

		export const actions = {
			a: () => {},
			b: (param: RequestEvent) => {},
			c: (param: import('./$types').RequestEvent) => {},
		}
	;null as any as Actions;`
	);
});

test('Leaves satisfies operator untouched', () => {
	const source = `
		import type { Actions, PageServerLoad, RequestEvent } from './$types';
		export function load({ params }) {
			return {
				a: 1
			};
		} satisfies PageServerLoad
		export const actions = {
			a: () => {},
			b: (param: RequestEvent) => {},
			c: (param) => {},
		} satisfies Actions
	`;

	const rewritten = tweak_types(source, true);

	expect(rewritten?.exports).toEqual(['load', 'actions']);
	assert.equal(rewritten?.modified, false);
	assert.equal(rewritten?.code, source);
});

```


####### packages/kit/src/core/sync/write_types/test/actions/+page.server.js #######

```

import { fail } from '../../../../../../src/exports/index.js';

const condition = false;

export const actions = {
	default: () => {
		if (condition) {
			return fail(400, {
				fail: 'oops'
			});
		}

		return {
			success: true
		};
	},
	successWithPayload: () => {
		return {
			id: 42,
			username: 'John Doe',
			profession: 'Svelte specialist'
		};
	},
	successWithoutPayload: () => {},
	failWithPayload: () => {
		return fail(400, {
			reason: {
				error: {
					code: /** @type {const} */ ('VALIDATION_FAILED')
				}
			}
		});
	},
	failWithoutPayload: () => {
		return fail(400);
	}
};

/**
 * Ordinarily this would live in a +page.svelte, but to make it easy to run the tests, we put it here.
 * The `export` is so that eslint doesn't throw a hissy fit about the unused variable
 * @type {import('./.svelte-kit/types/src/core/sync/write_types/test/actions/$types').SubmitFunction}
 */
export const submit = () => {
	return ({ result }) => {
		if (result.type === 'success') {
			// @ts-expect-error does only exist on `failure` result
			result.data?.fail;
			// @ts-expect-error unknown property
			result.data?.something;

			if (result.data && 'success' in result.data) {
				result.data.success === true;
				// @ts-expect-error should be of type `boolean`
				result.data.success === 'success';
				// @ts-expect-error does not exist in this branch
				result.data.id;
			}

			if (result.data && 'id' in result.data) {
				result.data.id === 42;
				// @ts-expect-error should be of type `number`
				result.data.id === 'John';
				// @ts-expect-error does not exist in this branch
				result.data.success;
			}
		}

		if (result.type === 'failure') {
			result.data;
			// @ts-expect-error does only exist on `success` result
			result.data.success;
			// @ts-expect-error unknown property
			result.data.unknown;

			if (result.data && 'fail' in result.data) {
				result.data.fail === '';
				// @ts-expect-error does not exist in this branch
				result.data.reason;
			}

			if (result.data && 'reason' in result.data) {
				result.data.reason.error.code === 'VALIDATION_FAILED';
				// @ts-expect-error should be a const
				result.data.reason.error.code === '';
				// @ts-expect-error does not exist in this branch
				result.data.fail;
			}
		}
	};
};

```


####### packages/kit/src/core/sync/write_types/test/layout-advanced/+layout.js #######

```

export function load() {
	return {
		root: 'root'
	};
}

```


####### packages/kit/src/core/sync/write_types/test/layout-advanced/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/layout-advanced/(main)/+layout.server.js #######

```

export function load() {
	return {
		main: 'main'
	};
}

```


####### packages/kit/src/core/sync/write_types/test/layout-advanced/(main)/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/layout-advanced/(main)/+page.js #######

```

// test to see if layout adjusts correctly if +page.js exists, but no load function

/** @type {import('../.svelte-kit/types/src/core/sync/write_types/test/layout-advanced/(main)/$types').PageData} */
const data = {
	root: ''
};
data.root;
// @ts-expect-error
data.main;

```


####### packages/kit/src/core/sync/write_types/test/layout-advanced/(main)/+page@.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/layout-advanced/(main)/sub/+page.js #######

```

/** @type {import('../../.svelte-kit/types/src/core/sync/write_types/test/layout-advanced/(main)/sub/$types').PageLoad} */
export async function load({ parent }) {
	const p = await parent();
	p.main;
	p.root;
	// @ts-expect-error
	p.sub;
	return {
		sub: 'sub'
	};
}

/** @type {import('../../.svelte-kit/types/src/core/sync/write_types/test/layout-advanced/(main)/sub/$types').PageData} */
const data = {
	main: '',
	root: '',
	sub: ''
};
data.main;
data.root;
data.sub;

```


####### packages/kit/src/core/sync/write_types/test/layout-advanced/(main)/sub/+page.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/layout/+layout.js #######

```

/** @type {import('./.svelte-kit/types/src/core/sync/write_types/test/layout/$types').LayoutLoad} */
export function load({ data }) {
	data.server;
	// @ts-expect-error
	data.shared;
	return {
		shared: 'shared'
	};
}

```


####### packages/kit/src/core/sync/write_types/test/layout/+layout.server.js #######

```

/** @type {import('./.svelte-kit/types/src/core/sync/write_types/test/layout/$types').LayoutServerLoad} */
export function load() {
	return {
		server: 'server'
	};
}

```


####### packages/kit/src/core/sync/write_types/test/layout/+layout.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/layout/+page.js #######

```

/** @type {import('./.svelte-kit/types/src/core/sync/write_types/test/layout/$types').PageLoad} */
export function load({ data }) {
	data.pageServer;
	// @ts-expect-error
	data.pageShared;
	return {
		pageShared: 'pageShared'
	};
}

/** @type {import('./.svelte-kit/types/src/core/sync/write_types/test/layout/$types').PageData} */
const data = {
	shared: 'asd',
	pageShared: 'asd'
};
data.shared;
data.pageShared;

```


####### packages/kit/src/core/sync/write_types/test/layout/+page.server.js #######

```

export function load() {
	return {
		pageServer: 'pageServer'
	};
}

```


####### packages/kit/src/core/sync/write_types/test/layout/+page.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/package.json #######

```

{
	"private": true,
	"type": "module",
	"scripts": {
		"testtypes": "tsc"
	}
}

```


####### packages/kit/src/core/sync/write_types/test/param-type-inference/optional/[[optionalNarrowedParam=narrowed]]/+page.js #######

```

/* eslint-disable */

/** @type {import('../../.svelte-kit/types/src/core/sync/write_types/test/param-type-inference/optional/[[optionalNarrowedParam=narrowed]]/$types').PageLoad} */
export function load({ params }) {
	if (params.optionalNarrowedParam) {
		/** @type {"a" | "b"} */
		let a;
		a = params.optionalNarrowedParam;
		return { a };
	}
}

```


####### packages/kit/src/core/sync/write_types/test/param-type-inference/params/narrowed.js #######

```

/**
 * @param {string} param
 * @returns {param is "a" | "b"}
 */
export const match = (param) => ['a', 'b'].includes(param);

```


####### packages/kit/src/core/sync/write_types/test/param-type-inference/params/not_narrowed.js #######

```

/* eslint-disable */

/**
 * @param {string} param
 * @returns {boolean}
 */
export const match = (param) => true;

```


####### packages/kit/src/core/sync/write_types/test/param-type-inference/required/+layout.js #######

```

/* eslint-disable */

/** @type {import('../.svelte-kit/types/src/core/sync/write_types/test/param-type-inference/required/$types').LayoutLoad} */
export function load({ params }) {
	if (params.narrowedParam) {
		/** @type {"a" | "b"} */
		const a = params.narrowedParam;
	}

	if (params.regularParam) {
		/** @type {"a" | "b"} */
		let a;

		//@ts-expect-error
		a = params.regularParam;

		/** @type {string} b*/
		const b = params.regularParam;
	}
}

```


####### packages/kit/src/core/sync/write_types/test/param-type-inference/required/[narrowedParam=narrowed]/+page.js #######

```

/* eslint-disable */

/** @type {import('../../.svelte-kit/types/src/core/sync/write_types/test/param-type-inference/required/[narrowedParam=narrowed]/$types').PageLoad} */
export function load({ params }) {
	/** @type {"a" | "b"} */
	let a;
	a = params.narrowedParam;
}

```


####### packages/kit/src/core/sync/write_types/test/param-type-inference/required/[regularParam=not_narrowed]/+page.js #######

```

/* eslint-disable */

/** @type {import('../../.svelte-kit/types/src/core/sync/write_types/test/param-type-inference/required/[regularParam=not_narrowed]/$types').PageLoad} */
export function load({ params }) {
	/** @type {string} a*/
	const a = params.regularParam;

	/** @type {"a" | "b"} b*/
	let b;

	//@ts-expect-error
	b = params.regularParam;
}

```


####### packages/kit/src/core/sync/write_types/test/param-type-inference/spread/[...spread=narrowed]/+page.js #######

```

/* eslint-disable */

/** @type {import('../../.svelte-kit/types/src/core/sync/write_types/test/param-type-inference/spread/[...spread=narrowed]/$types').PageLoad} */
export function load({ params }) {
	/** @type {"a" | "b"} */
	let a;
	a = params.spread;
}

```


####### packages/kit/src/core/sync/write_types/test/simple-page-server-and-shared/+page.js #######

```

/** @type {import('./.svelte-kit/types/src/core/sync/write_types/test/simple-page-server-and-shared/$types').PageLoad} */
export function load({ data }) {
	data.server;
	// @ts-expect-error
	data.shared;
	return {
		shared: 'shared'
	};
}

/** @type {import('./.svelte-kit/types/src/core/sync/write_types/test/simple-page-server-and-shared/$types').PageData} */
const data = {
	shared: 'asd'
};
data.shared;
// @ts-expect-error
data.server;

```


####### packages/kit/src/core/sync/write_types/test/simple-page-server-and-shared/+page.server.js #######

```

export function load() {
	return {
		server: 'server'
	};
}

```


####### packages/kit/src/core/sync/write_types/test/simple-page-server-and-shared/+page.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/simple-page-server-only/+page.server.js #######

```

export function load() {
	return {
		foo: 'bar'
	};
}

export const actions = {
	default: () => ({ action: 'bar' })
};

/** @type {import('./.svelte-kit/types/src/core/sync/write_types/test/simple-page-server-only/$types').PageData} */
const data = {
	foo: 'asd'
};
data.foo;
// @ts-expect-error
data.bar;

/** @type {import('./.svelte-kit/types/src/core/sync/write_types/test/simple-page-server-only/$types').ActionData} */
const actionData = { action: 'bar' };
actionData.action;
// @ts-expect-error
actionData.foo;

```


####### packages/kit/src/core/sync/write_types/test/simple-page-server-only/+page.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/simple-page-server-only/sub/+page.server.js #######

```

/** @type {import('../.svelte-kit/types/src/core/sync/write_types/test/simple-page-server-only/sub/$types').PageServerLoad} */
export function load() {
	if (Math.random() > 0.5) {
		return {
			foo: 'bar'
		};
	}
}

/** @type {import('../.svelte-kit/types/src/core/sync/write_types/test/simple-page-server-only/sub/$types').PageData} */
const data = /** @type {any} */ ({
	foo: 'bar'
}); // the any cast prevents TypeScript from narrowing this to foo being defined
data.foo;
// @ts-expect-error
data.foo.charAt(0);

```


####### packages/kit/src/core/sync/write_types/test/simple-page-server-only/sub/+page.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/simple-page-shared-only/+page.js #######

```

export function load() {
	return {
		shared: 'shared'
	};
}

/** @type {import('./.svelte-kit/types/src/core/sync/write_types/test/simple-page-shared-only/$types').PageData} */
const data = {
	shared: 'asd'
};
data.shared;
// @ts-expect-error
data.bar;

```


####### packages/kit/src/core/sync/write_types/test/simple-page-shared-only/+page.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/simple-page-shared-only/sub/+page.js #######

```

/** @type {import('../.svelte-kit/types/src/core/sync/write_types/test/simple-page-shared-only/sub/$types').PageLoad} */
export function load() {
	if (Math.random() > 0.5) {
		return {
			foo: 'bar'
		};
	}
}

/** @type {import('../.svelte-kit/types/src/core/sync/write_types/test/simple-page-shared-only/sub/$types').PageData} */
const data = /** @type {any} */ ({
	foo: 'bar'
}); // the any cast prevents TypeScript from narrowing this to foo being defined
data.foo;
// @ts-expect-error
data.foo.charAt(0);

```


####### packages/kit/src/core/sync/write_types/test/simple-page-shared-only/sub/+page.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/slugs/+layout.js #######

```

/** @type {import('./.svelte-kit/types/src/core/sync/write_types/test/slugs/$types').LayoutLoad} */
export function load({ params }) {
	params.optional;
	params.rest;
	params.slug;
	// @ts-expect-error
	params.foo;
	// @ts-expect-error
	params.optional.charAt(1);
	// @ts-expect-error
	params.rest.charAt(1);
	// @ts-expect-error
	params.slug.charAt(1);
}

```


####### packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/+layout.js #######

```

/** @type {import('./.svelte-kit/types/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/$types').LayoutLoad} */
export function load({ params }) {
	params.rest;
	params.slug;
}

```


####### packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/+layout.svelte #######

```

export function load() &lcub;&rcub;

```


####### packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/nested/+layout.js #######

```

/** @type {import('../.svelte-kit/types/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/nested/$types').LayoutLoad} */
export function load({ params }) {
	params.rest;
	// @ts-expect-error
	params.slug;
}

```


####### packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/nested/+layout.svelte #######

```

export function load() &lcub;&rcub;

```


####### packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/nested/[...rest]/+page.js #######

```

export function load() {
	return { rest: 'rest' };
}

```


####### packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/nested/[...rest]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/slugs-layout-not-all-pages-have-load/nested/[slug]/+page@.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/slugs/+layout.svelte #######

```

export function load() &lcub;&rcub;

```


####### packages/kit/src/core/sync/write_types/test/slugs/[...rest]/+page.js #######

```

/** @type {import('../.svelte-kit/types/src/core/sync/write_types/test/slugs/[...rest]/$types').PageLoad} */
export function load({ params }) {
	params.rest.charAt(1);
	// @ts-expect-error
	params.optional;
	// @ts-expect-error
	params.slug;

	return { rest: 'rest' };
}

```


####### packages/kit/src/core/sync/write_types/test/slugs/[...rest]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/slugs/[slug]/+page.js #######

```

/** @type {import('../.svelte-kit/types/src/core/sync/write_types/test/slugs/[slug]/$types').PageLoad} */
export function load({ params }) {
	params.slug.charAt(1);
	// @ts-expect-error
	params.optional;
	// @ts-expect-error
	params.rest;

	return { slug: 'slug' };
}

```


####### packages/kit/src/core/sync/write_types/test/slugs/[slug]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/slugs/x/[[optional]]/+page.js #######

```

/** @type {import('../../.svelte-kit/types/src/core/sync/write_types/test/slugs/x/[[optional]]/$types').PageLoad} */
export async function load({ parent, params }) {
	const p = await parent();
	/** @type {NonNullable<typeof p>} */
	const a = p;
	// @ts-expect-error
	p.foo;
	// @ts-expect-error
	a.foo;

	params.optional;
	params.optional?.charAt(1);
	// @ts-expect-error
	params.optional.charAt(1);
	// @ts-expect-error
	params.slug;
	// @ts-expect-error
	params.rest;

	return { optional: 'optional' };
}

```


####### packages/kit/src/core/sync/write_types/test/slugs/x/[[optional]]/+page.svelte #######

```


```


####### packages/kit/src/core/sync/write_types/test/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true,
		"strict": true,
		"target": "es2022",
		"module": "es2022",
		"moduleResolution": "bundler",
		"allowSyntheticDefaultImports": true,
		"baseUrl": ".",
		"paths": {
			"@sveltejs/kit": ["../../../../exports/public"],
			"types": ["../../../../types/internal"]
		}
	},
	"include": ["./**/*.js"],
	"exclude": ["./**/.svelte-kit/**"]
}

```


####### packages/kit/src/core/utils.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';
import colors from 'kleur';
import { posixify, to_fs } from '../utils/filesystem.js';

/**
 * Resolved path of the `runtime` directory
 *
 * TODO Windows issue:
 * Vite or sth else somehow sets the driver letter inconsistently to lower or upper case depending on the run environment.
 * In playwright debug mode run through VS Code this a root-to-lowercase conversion is needed in order for the tests to run.
 * If we do this conversion in other cases it has the opposite effect though and fails.
 */
export const runtime_directory = posixify(fileURLToPath(new URL('../runtime', import.meta.url)));

/**
 * This allows us to import SvelteKit internals that aren't exposed via `pkg.exports` in a
 * way that works whether `@sveltejs/kit` is installed inside the project's `node_modules`
 * or in a workspace root
 */
export const runtime_base = runtime_directory.startsWith(process.cwd())
	? `/${path.relative('.', runtime_directory)}`
	: to_fs(runtime_directory);

function noop() {}

/** @param {{ verbose: boolean }} opts */
export function logger({ verbose }) {
	/** @type {import('types').Logger} */
	const log = (msg) => console.log(msg.replace(/^/gm, '  '));

	/** @param {string} msg */
	const err = (msg) => console.error(msg.replace(/^/gm, '  '));

	log.success = (msg) => log(colors.green(`✔ ${msg}`));
	log.error = (msg) => err(colors.bold().red(msg));
	log.warn = (msg) => log(colors.bold().yellow(msg));

	log.minor = verbose ? (msg) => log(colors.grey(msg)) : noop;
	log.info = verbose ? log : noop;

	return log;
}

/** @param {import('types').ManifestData} manifest_data */
export function get_mime_lookup(manifest_data) {
	/** @type {Record<string, string>} */
	const mime = {};

	manifest_data.assets.forEach((asset) => {
		if (asset.type) {
			const ext = path.extname(asset.file);
			mime[ext] = asset.type;
		}
	});

	return mime;
}

/**
 * @param {string} dir
 * @param {(file: string) => boolean} [filter]
 */
export function list_files(dir, filter) {
	/** @type {string[]} */
	const files = [];

	/** @param {string} current */
	function walk(current) {
		for (const file of fs.readdirSync(path.resolve(dir, current))) {
			const child = path.posix.join(current, file);
			if (fs.statSync(path.resolve(dir, child)).isDirectory()) {
				walk(child);
			} else {
				if (!filter || filter(child)) {
					files.push(child);
				}
			}
		}
	}

	if (fs.existsSync(dir)) walk('');

	return files;
}

```


####### packages/kit/src/exports/hooks/index.js #######

```

export { sequence } from './sequence.js';

```


####### packages/kit/src/exports/hooks/sequence.js #######

```

/**
 * A helper function for sequencing multiple `handle` calls in a middleware-like manner.
 * The behavior for the `handle` options is as follows:
 * - `transformPageChunk` is applied in reverse order and merged
 * - `preload` is applied in forward order, the first option "wins" and no `preload` options after it are called
 * - `filterSerializedResponseHeaders` behaves the same as `preload`
 *
 * ```js
 * /// file: src/hooks.server.js
 * import { sequence } from '@sveltejs/kit/hooks';
 *
 * /// type: import('@sveltejs/kit').Handle
 * async function first({ event, resolve }) {
 * 	console.log('first pre-processing');
 * 	const result = await resolve(event, {
 * 		transformPageChunk: ({ html }) => {
 * 			// transforms are applied in reverse order
 * 			console.log('first transform');
 * 			return html;
 * 		},
 * 		preload: () => {
 * 			// this one wins as it's the first defined in the chain
 * 			console.log('first preload');
 * 		}
 * 	});
 * 	console.log('first post-processing');
 * 	return result;
 * }
 *
 * /// type: import('@sveltejs/kit').Handle
 * async function second({ event, resolve }) {
 * 	console.log('second pre-processing');
 * 	const result = await resolve(event, {
 * 		transformPageChunk: ({ html }) => {
 * 			console.log('second transform');
 * 			return html;
 * 		},
 * 		preload: () => {
 * 			console.log('second preload');
 * 		},
 * 		filterSerializedResponseHeaders: () => {
 * 			// this one wins as it's the first defined in the chain
 *    		console.log('second filterSerializedResponseHeaders');
 * 		}
 * 	});
 * 	console.log('second post-processing');
 * 	return result;
 * }
 *
 * export const handle = sequence(first, second);
 * ```
 *
 * The example above would print:
 *
 * ```
 * first pre-processing
 * first preload
 * second pre-processing
 * second filterSerializedResponseHeaders
 * second transform
 * first transform
 * second post-processing
 * first post-processing
 * ```
 *
 * @param {...import('@sveltejs/kit').Handle} handlers The chain of `handle` functions
 * @returns {import('@sveltejs/kit').Handle}
 */
export function sequence(...handlers) {
	const length = handlers.length;
	if (!length) return ({ event, resolve }) => resolve(event);

	return ({ event, resolve }) => {
		return apply_handle(0, event, {});

		/**
		 * @param {number} i
		 * @param {import('@sveltejs/kit').RequestEvent} event
		 * @param {import('@sveltejs/kit').ResolveOptions | undefined} parent_options
		 * @returns {import('types').MaybePromise<Response>}
		 */
		function apply_handle(i, event, parent_options) {
			const handle = handlers[i];

			return handle({
				event,
				resolve: (event, options) => {
					/** @type {import('@sveltejs/kit').ResolveOptions['transformPageChunk']} */
					const transformPageChunk = async ({ html, done }) => {
						if (options?.transformPageChunk) {
							html = (await options.transformPageChunk({ html, done })) ?? '';
						}

						if (parent_options?.transformPageChunk) {
							html = (await parent_options.transformPageChunk({ html, done })) ?? '';
						}

						return html;
					};

					/** @type {import('@sveltejs/kit').ResolveOptions['filterSerializedResponseHeaders']} */
					const filterSerializedResponseHeaders =
						parent_options?.filterSerializedResponseHeaders ??
						options?.filterSerializedResponseHeaders;

					/** @type {import('@sveltejs/kit').ResolveOptions['preload']} */
					const preload = parent_options?.preload ?? options?.preload;

					return i < length - 1
						? apply_handle(i + 1, event, {
								transformPageChunk,
								filterSerializedResponseHeaders,
								preload
							})
						: resolve(event, { transformPageChunk, filterSerializedResponseHeaders, preload });
				}
			});
		}
	};
}

```


####### packages/kit/src/exports/hooks/sequence.spec.js #######

```

import { assert, expect, test } from 'vitest';
import { sequence } from './sequence.js';
import { installPolyfills } from '../node/polyfills.js';

installPolyfills();

test('applies handlers in sequence', async () => {
	/** @type {string[]} */
	const order = [];

	const handler = sequence(
		async ({ event, resolve }) => {
			order.push('1a');
			const response = await resolve(event);
			order.push('1b');
			return response;
		},
		async ({ event, resolve }) => {
			order.push('2a');
			const response = await resolve(event);
			order.push('2b');
			return response;
		},
		async ({ event, resolve }) => {
			order.push('3a');
			const response = await resolve(event);
			order.push('3b');
			return response;
		}
	);

	const event = /** @type {import('@sveltejs/kit').RequestEvent} */ ({});
	const response = new Response();

	assert.equal(await handler({ event, resolve: () => response }), response);
	expect(order).toEqual(['1a', '2a', '3a', '3b', '2b', '1b']);
});

test('uses transformPageChunk option passed to non-terminal handle function', async () => {
	const handler = sequence(
		async ({ event, resolve }) => {
			return resolve(event, {
				transformPageChunk: ({ html, done }) => html + (done ? '-1-done' : '-1')
			});
		},
		async ({ event, resolve }) => resolve(event),
		async ({ event, resolve }) => resolve(event)
	);

	const event = /** @type {import('@sveltejs/kit').RequestEvent} */ ({});
	const response = await handler({
		event,
		resolve: async (_event, opts = {}) => {
			let html = '';

			const { transformPageChunk = ({ html }) => html } = opts;

			html += await transformPageChunk({ html: '0', done: false });
			html += await transformPageChunk({ html: ' 0', done: true });

			return new Response(html);
		}
	});

	assert.equal(await response.text(), '0-1 0-1-done');
});

test('merges transformPageChunk option', async () => {
	const handler = sequence(
		async ({ event, resolve }) => {
			return resolve(event, {
				transformPageChunk: ({ html, done }) => html + (done ? '-1-done' : '-1')
			});
		},
		async ({ event, resolve }) => {
			return resolve(event, {
				transformPageChunk: ({ html, done }) => html + (done ? '-2-done' : '-2')
			});
		},
		async ({ event, resolve }) => {
			return resolve(event, {
				transformPageChunk: ({ html, done }) => html + (done ? '-3-done' : '-3')
			});
		}
	);

	const event = /** @type {import('@sveltejs/kit').RequestEvent} */ ({});
	const response = await handler({
		event,
		resolve: async (_event, opts = {}) => {
			let html = '';

			const { transformPageChunk = ({ html }) => html } = opts;

			html += await transformPageChunk({ html: '0', done: false });
			html += await transformPageChunk({ html: ' 0', done: true });

			return new Response(html);
		}
	});

	assert.equal(await response.text(), '0-3-2-1 0-3-done-2-done-1-done');
});

test('uses first defined preload option', async () => {
	const handler = sequence(
		async ({ event, resolve }) => resolve(event),
		async ({ event, resolve }) => {
			return resolve(event, {
				preload: ({ type }) => type === 'js'
			});
		},
		async ({ event, resolve }) => {
			return resolve(event, {
				preload: () => true
			});
		}
	);

	const event = /** @type {import('@sveltejs/kit').RequestEvent} */ ({});
	const response = await handler({
		event,
		resolve: async (_event, opts = {}) => {
			let html = '';

			const { preload = () => false } = opts;

			html += preload({ path: '', type: 'js' });
			html += preload({ path: '', type: 'css' });

			return new Response(html);
		}
	});

	assert.equal(await response.text(), 'truefalse');
});

test('uses first defined filterSerializedResponseHeaders option', async () => {
	const handler = sequence(
		async ({ event, resolve }) => resolve(event),
		async ({ event, resolve }) => {
			return resolve(event, {
				filterSerializedResponseHeaders: (name) => name === 'a'
			});
		},
		async ({ event, resolve }) => {
			return resolve(event, {
				filterSerializedResponseHeaders: () => true
			});
		}
	);

	const event = /** @type {import('@sveltejs/kit').RequestEvent} */ ({});
	const response = await handler({
		event,
		resolve: async (_event, opts = {}) => {
			let html = '';

			const { filterSerializedResponseHeaders = () => false } = opts;

			html += filterSerializedResponseHeaders('a', '');
			html += filterSerializedResponseHeaders('b', '');

			return new Response(html);
		}
	});

	assert.equal(await response.text(), 'truefalse');
});

```


####### packages/kit/src/exports/index.js #######

```

import { HttpError, Redirect, ActionFailure } from '../runtime/control.js';
import { BROWSER, DEV } from 'esm-env';

export { VERSION } from '../version.js';

// TODO 3.0: remove these types as they are not used anymore (we can't remove them yet because that would be a breaking change)
/**
 * @template {number} TNumber
 * @template {any[]} [TArray=[]]
 * @typedef {TNumber extends TArray['length'] ? TArray[number] : LessThan<TNumber, [...TArray, TArray['length']]>} LessThan
 */

/**
 * @template {number} TStart
 * @template {number} TEnd
 * @typedef {Exclude<TEnd | LessThan<TEnd>, LessThan<TStart>>} NumericRange
 */

// Keep the status codes as `number` because restricting to certain numbers makes it unnecessarily hard to use compared to the benefits
// (we have runtime errors already to check for invalid codes). Also see https://github.com/sveltejs/kit/issues/11780

// we have to repeat the JSDoc because the display for function overloads is broken
// see https://github.com/microsoft/TypeScript/issues/55056

/**
 * Throws an error with a HTTP status code and an optional message.
 * When called during request handling, this will cause SvelteKit to
 * return an error response without invoking `handleError`.
 * Make sure you're not catching the thrown error, which would prevent SvelteKit from handling it.
 * @param {number} status The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses). Must be in the range 400-599.
 * @param {App.Error} body An object that conforms to the App.Error type. If a string is passed, it will be used as the message property.
 * @overload
 * @param {number} status
 * @param {App.Error} body
 * @return {never}
 * @throws {HttpError} This error instructs SvelteKit to initiate HTTP error handling.
 * @throws {Error} If the provided status is invalid (not between 400 and 599).
 */
/**
 * Throws an error with a HTTP status code and an optional message.
 * When called during request handling, this will cause SvelteKit to
 * return an error response without invoking `handleError`.
 * Make sure you're not catching the thrown error, which would prevent SvelteKit from handling it.
 * @param {number} status The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses). Must be in the range 400-599.
 * @param {{ message: string } extends App.Error ? App.Error | string | undefined : never} [body] An object that conforms to the App.Error type. If a string is passed, it will be used as the message property.
 * @overload
 * @param {number} status
 * @param {{ message: string } extends App.Error ? App.Error | string | undefined : never} [body]
 * @return {never}
 * @throws {HttpError} This error instructs SvelteKit to initiate HTTP error handling.
 * @throws {Error} If the provided status is invalid (not between 400 and 599).
 */
/**
 * Throws an error with a HTTP status code and an optional message.
 * When called during request handling, this will cause SvelteKit to
 * return an error response without invoking `handleError`.
 * Make sure you're not catching the thrown error, which would prevent SvelteKit from handling it.
 * @param {number} status The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses). Must be in the range 400-599.
 * @param {{ message: string } extends App.Error ? App.Error | string | undefined : never} body An object that conforms to the App.Error type. If a string is passed, it will be used as the message property.
 * @return {never}
 * @throws {HttpError} This error instructs SvelteKit to initiate HTTP error handling.
 * @throws {Error} If the provided status is invalid (not between 400 and 599).
 */
export function error(status, body) {
	if ((!BROWSER || DEV) && (isNaN(status) || status < 400 || status > 599)) {
		throw new Error(`HTTP error status codes must be between 400 and 599 — ${status} is invalid`);
	}

	throw new HttpError(status, body);
}

/**
 * Checks whether this is an error thrown by {@link error}.
 * @template {number} T
 * @param {unknown} e
 * @param {T} [status] The status to filter for.
 * @return {e is (HttpError & { status: T extends undefined ? never : T })}
 */
export function isHttpError(e, status) {
	if (!(e instanceof HttpError)) return false;
	return !status || e.status === status;
}

/**
 * Redirect a request. When called during request handling, SvelteKit will return a redirect response.
 * Make sure you're not catching the thrown redirect, which would prevent SvelteKit from handling it.
 * @param {300 | 301 | 302 | 303 | 304 | 305 | 306 | 307 | 308 | ({} & number)} status The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#redirection_messages). Must be in the range 300-308.
 * @param {string | URL} location The location to redirect to.
 * @throws {Redirect} This error instructs SvelteKit to redirect to the specified location.
 * @throws {Error} If the provided status is invalid.
 * @return {never}
 */
export function redirect(status, location) {
	if ((!BROWSER || DEV) && (isNaN(status) || status < 300 || status > 308)) {
		throw new Error('Invalid status code');
	}

	throw new Redirect(
		// @ts-ignore
		status,
		location.toString()
	);
}

/**
 * Checks whether this is a redirect thrown by {@link redirect}.
 * @param {unknown} e The object to check.
 * @return {e is Redirect}
 */
export function isRedirect(e) {
	return e instanceof Redirect;
}

/**
 * Create a JSON `Response` object from the supplied data.
 * @param {any} data The value that will be serialized as JSON.
 * @param {ResponseInit} [init] Options such as `status` and `headers` that will be added to the response. `Content-Type: application/json` and `Content-Length` headers will be added automatically.
 */
export function json(data, init) {
	// TODO deprecate this in favour of `Response.json` when it's
	// more widely supported
	const body = JSON.stringify(data);

	// we can't just do `text(JSON.stringify(data), init)` because
	// it will set a default `content-type` header. duplicated code
	// means less duplicated work
	const headers = new Headers(init?.headers);
	if (!headers.has('content-length')) {
		headers.set('content-length', encoder.encode(body).byteLength.toString());
	}

	if (!headers.has('content-type')) {
		headers.set('content-type', 'application/json');
	}

	return new Response(body, {
		...init,
		headers
	});
}

const encoder = new TextEncoder();

/**
 * Create a `Response` object from the supplied body.
 * @param {string} body The value that will be used as-is.
 * @param {ResponseInit} [init] Options such as `status` and `headers` that will be added to the response. A `Content-Length` header will be added automatically.
 */
export function text(body, init) {
	const headers = new Headers(init?.headers);
	if (!headers.has('content-length')) {
		const encoded = encoder.encode(body);
		headers.set('content-length', encoded.byteLength.toString());
		return new Response(encoded, {
			...init,
			headers
		});
	}

	return new Response(body, {
		...init,
		headers
	});
}

/**
 * Create an `ActionFailure` object.
 * @param {number} status The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses). Must be in the range 400-599.
 * @overload
 * @param {number} status
 * @returns {import('./public.js').ActionFailure<undefined>}
 */
/**
 * Create an `ActionFailure` object.
 * @template {Record<string, unknown> | undefined} [T=undefined]
 * @param {number} status The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses). Must be in the range 400-599.
 * @param {T} data Data associated with the failure (e.g. validation errors)
 * @overload
 * @param {number} status
 * @param {T} data
 * @returns {import('./public.js').ActionFailure<T>}
 */
/**
 * Create an `ActionFailure` object.
 * @param {number} status
 * @param {any} [data]
 * @returns {import('./public.js').ActionFailure<any>}
 */
export function fail(status, data) {
	// @ts-expect-error unique symbol missing
	return new ActionFailure(status, data);
}

```


####### packages/kit/src/exports/node/index.js #######

```

import { createReadStream } from 'node:fs';
import { Readable } from 'node:stream';
import * as set_cookie_parser from 'set-cookie-parser';
import { SvelteKitError } from '../../runtime/control.js';

/**
 * @param {import('http').IncomingMessage} req
 * @param {number} [body_size_limit]
 */
function get_raw_body(req, body_size_limit) {
	const h = req.headers;

	if (!h['content-type']) {
		return null;
	}

	const content_length = Number(h['content-length']);

	// check if no request body
	if (
		(req.httpVersionMajor === 1 && isNaN(content_length) && h['transfer-encoding'] == null) ||
		content_length === 0
	) {
		return null;
	}

	if (req.destroyed) {
		const readable = new ReadableStream();
		readable.cancel();
		return readable;
	}

	let size = 0;
	let cancelled = false;

	return new ReadableStream({
		start(controller) {
			if (body_size_limit !== undefined && content_length > body_size_limit) {
				let message = `Content-length of ${content_length} exceeds limit of ${body_size_limit} bytes.`;

				if (body_size_limit === 0) {
					// https://github.com/sveltejs/kit/pull/11589
					// TODO this exists to aid migration — remove in a future version
					message += ' To disable body size limits, specify Infinity rather than 0.';
				}

				const error = new SvelteKitError(413, 'Payload Too Large', message);

				controller.error(error);
				return;
			}

			req.on('error', (error) => {
				cancelled = true;
				controller.error(error);
			});

			req.on('end', () => {
				if (cancelled) return;
				controller.close();
			});

			req.on('data', (chunk) => {
				if (cancelled) return;

				size += chunk.length;
				if (size > content_length) {
					cancelled = true;

					const constraint = content_length ? 'content-length' : 'BODY_SIZE_LIMIT';
					const message = `request body size exceeded ${constraint} of ${content_length}`;

					const error = new SvelteKitError(413, 'Payload Too Large', message);
					controller.error(error);

					return;
				}

				controller.enqueue(chunk);

				if (controller.desiredSize === null || controller.desiredSize <= 0) {
					req.pause();
				}
			});
		},

		pull() {
			req.resume();
		},

		cancel(reason) {
			cancelled = true;
			req.destroy(reason);
		}
	});
}

/**
 * @param {{
 *   request: import('http').IncomingMessage;
 *   base: string;
 *   bodySizeLimit?: number;
 * }} options
 * @returns {Promise<Request>}
 */
export async function getRequest({ request, base, bodySizeLimit }) {
	return new Request(base + request.url, {
		// @ts-expect-error
		duplex: 'half',
		method: request.method,
		headers: /** @type {Record<string, string>} */ (request.headers),
		body:
			request.method === 'GET' || request.method === 'HEAD'
				? undefined
				: get_raw_body(request, bodySizeLimit)
	});
}

/**
 * @param {import('http').ServerResponse} res
 * @param {Response} response
 * @returns {Promise<void>}
 */
export async function setResponse(res, response) {
	for (const [key, value] of response.headers) {
		try {
			res.setHeader(
				key,
				key === 'set-cookie'
					? set_cookie_parser.splitCookiesString(
							// This is absurd but necessary, TODO: investigate why
							/** @type {string}*/ (response.headers.get(key))
						)
					: value
			);
		} catch (error) {
			res.getHeaderNames().forEach((name) => res.removeHeader(name));
			res.writeHead(500).end(String(error));
			return;
		}
	}

	res.writeHead(response.status);

	if (!response.body) {
		res.end();
		return;
	}

	if (response.body.locked) {
		res.end(
			'Fatal error: Response body is locked. ' +
				"This can happen when the response was already read (for example through 'response.json()' or 'response.text()')."
		);
		return;
	}

	const reader = response.body.getReader();

	if (res.destroyed) {
		reader.cancel();
		return;
	}

	const cancel = (/** @type {Error|undefined} */ error) => {
		res.off('close', cancel);
		res.off('error', cancel);

		// If the reader has already been interrupted with an error earlier,
		// then it will appear here, it is useless, but it needs to be catch.
		reader.cancel(error).catch(() => {});
		if (error) res.destroy(error);
	};

	res.on('close', cancel);
	res.on('error', cancel);

	next();
	async function next() {
		try {
			for (;;) {
				const { done, value } = await reader.read();

				if (done) break;

				if (!res.write(value)) {
					res.once('drain', next);
					return;
				}
			}
			res.end();
		} catch (error) {
			cancel(error instanceof Error ? error : new Error(String(error)));
		}
	}
}

/**
 * Converts a file on disk to a readable stream
 * @param {string} file
 * @returns {ReadableStream}
 * @since 2.4.0
 */
export function createReadableStream(file) {
	return /** @type {ReadableStream} */ (Readable.toWeb(createReadStream(file)));
}

```


####### packages/kit/src/exports/node/polyfills.js #######

```

import buffer from 'node:buffer';
import { webcrypto as crypto } from 'node:crypto';

// `buffer.File` was added in Node 18.13.0 while the `File` global was added in Node 20.0.0
const File = /** @type {import('node:buffer') & { File?: File}} */ (buffer).File;

/** @type {Record<string, any>} */
const globals = {
	crypto,
	File
};

// exported for dev/preview and node environments
/**
 * Make various web APIs available as globals:
 * - `crypto`
 * - `File`
 */
export function installPolyfills() {
	for (const name in globals) {
		if (name in globalThis) continue;

		Object.defineProperty(globalThis, name, {
			enumerable: true,
			configurable: true,
			writable: true,
			value: globals[name]
		});
	}
}

```


####### packages/kit/src/exports/public.d.ts #######

```

import 'svelte'; // pick up `declare module "*.svelte"`
import 'vite/client'; // pick up `declare module "*.jpg"`, etc.
import '../types/ambient.js';

import { CompileOptions } from 'svelte/compiler';
import {
	AdapterEntry,
	CspDirectives,
	HttpMethod,
	Logger,
	MaybePromise,
	Prerendered,
	PrerenderEntryGeneratorMismatchHandlerValue,
	PrerenderHttpErrorHandlerValue,
	PrerenderMissingIdHandlerValue,
	PrerenderOption,
	RequestOptions,
	RouteSegment
} from '../types/private.js';
import { BuildData, SSRNodeLoader, SSRRoute, ValidatedConfig } from 'types';
import type { PluginOptions } from '@sveltejs/vite-plugin-svelte';

export { PrerenderOption } from '../types/private.js';

/**
 * [Adapters](https://kit.svelte.dev/docs/adapters) are responsible for taking the production build and turning it into something that can be deployed to a platform of your choosing.
 */
export interface Adapter {
	/**
	 * The name of the adapter, using for logging. Will typically correspond to the package name.
	 */
	name: string;
	/**
	 * This function is called after SvelteKit has built your app.
	 * @param builder An object provided by SvelteKit that contains methods for adapting the app
	 */
	adapt(builder: Builder): MaybePromise<void>;
	/**
	 * Checks called during dev and build to determine whether specific features will work in production with this adapter
	 */
	supports?: {
		/**
		 * Test support for `read` from `$app/server`
		 * @param config The merged route config
		 */
		read?: (details: { config: any; route: { id: string } }) => boolean;
	};
	/**
	 * Creates an `Emulator`, which allows the adapter to influence the environment
	 * during dev, build and prerendering
	 */
	emulate?(): MaybePromise<Emulator>;
}

export type LoadProperties<input extends Record<string, any> | void> = input extends void
	? undefined // needs to be undefined, because void will break intellisense
	: input extends Record<string, any>
		? input
		: unknown;

export type AwaitedActions<T extends Record<string, (...args: any) => any>> = OptionalUnion<
	{
		[Key in keyof T]: UnpackValidationError<Awaited<ReturnType<T[Key]>>>;
	}[keyof T]
>;

// Takes a union type and returns a union type where each type also has all properties
// of all possible types (typed as undefined), making accessing them more ergonomic
type OptionalUnion<
	U extends Record<string, any>, // not unknown, else interfaces don't satisfy this constraint
	A extends keyof U = U extends U ? keyof U : never
> = U extends unknown ? { [P in Exclude<A, keyof U>]?: never } & U : never;

declare const uniqueSymbol: unique symbol;

export interface ActionFailure<T extends Record<string, unknown> | undefined = undefined> {
	status: number;
	data: T;
	[uniqueSymbol]: true; // necessary or else UnpackValidationError could wrongly unpack objects with the same shape as ActionFailure
}

type UnpackValidationError<T> =
	T extends ActionFailure<infer X>
		? X
		: T extends void
			? undefined // needs to be undefined, because void will corrupt union type
			: T;

/**
 * This object is passed to the `adapt` function of adapters.
 * It contains various methods and properties that are useful for adapting the app.
 */
export interface Builder {
	/** Print messages to the console. `log.info` and `log.minor` are silent unless Vite's `logLevel` is `info`. */
	log: Logger;
	/** Remove `dir` and all its contents. */
	rimraf(dir: string): void;
	/** Create `dir` and any required parent directories. */
	mkdirp(dir: string): void;

	/** The fully resolved `svelte.config.js`. */
	config: ValidatedConfig;
	/** Information about prerendered pages and assets, if any. */
	prerendered: Prerendered;
	/** An array of all routes (including prerendered) */
	routes: RouteDefinition[];

	// TODO 3.0 remove this method
	/**
	 * Create separate functions that map to one or more routes of your app.
	 * @param fn A function that groups a set of routes into an entry point
	 * @deprecated Use `builder.routes` instead
	 */
	createEntries(fn: (route: RouteDefinition) => AdapterEntry): Promise<void>;

	/**
	 * Find all the assets imported by server files belonging to `routes`
	 */
	findServerAssets(routes: RouteDefinition[]): string[];

	/**
	 * Generate a fallback page for a static webserver to use when no route is matched. Useful for single-page apps.
	 */
	generateFallback(dest: string): Promise<void>;

	/**
	 * Generate a module exposing build-time environment variables as `$env/dynamic/public`.
	 */
	generateEnvModule(): void;

	/**
	 * Generate a server-side manifest to initialise the SvelteKit [server](https://kit.svelte.dev/docs/types#public-types-server) with.
	 * @param opts a relative path to the base directory of the app and optionally in which format (esm or cjs) the manifest should be generated
	 */
	generateManifest(opts: { relativePath: string; routes?: RouteDefinition[] }): string;

	/**
	 * Resolve a path to the `name` directory inside `outDir`, e.g. `/path/to/.svelte-kit/my-adapter`.
	 * @param name path to the file, relative to the build directory
	 */
	getBuildDirectory(name: string): string;
	/** Get the fully resolved path to the directory containing client-side assets, including the contents of your `static` directory. */
	getClientDirectory(): string;
	/** Get the fully resolved path to the directory containing server-side code. */
	getServerDirectory(): string;
	/** Get the application path including any configured `base` path, e.g. `my-base-path/_app`. */
	getAppPath(): string;

	/**
	 * Write client assets to `dest`.
	 * @param dest the destination folder
	 * @returns an array of files written to `dest`
	 */
	writeClient(dest: string): string[];
	/**
	 * Write prerendered files to `dest`.
	 * @param dest the destination folder
	 * @returns an array of files written to `dest`
	 */
	writePrerendered(dest: string): string[];
	/**
	 * Write server-side code to `dest`.
	 * @param dest the destination folder
	 * @returns an array of files written to `dest`
	 */
	writeServer(dest: string): string[];
	/**
	 * Copy a file or directory.
	 * @param from the source file or directory
	 * @param to the destination file or directory
	 * @param opts.filter a function to determine whether a file or directory should be copied
	 * @param opts.replace a map of strings to replace
	 * @returns an array of files that were copied
	 */
	copy(
		from: string,
		to: string,
		opts?: {
			filter?(basename: string): boolean;
			replace?: Record<string, string>;
		}
	): string[];

	/**
	 * Compress files in `directory` with gzip and brotli, where appropriate. Generates `.gz` and `.br` files alongside the originals.
	 * @param {string} directory The directory containing the files to be compressed
	 */
	compress(directory: string): Promise<void>;
}

export interface Config {
	/**
	 * Options passed to [`svelte.compile`](https://svelte.dev/docs#compile-time-svelte-compile).
	 * @default {}
	 */
	compilerOptions?: CompileOptions;
	/**
	 * List of file extensions that should be treated as Svelte files.
	 * @default [".svelte"]
	 */
	extensions?: string[];
	/** SvelteKit options */
	kit?: KitConfig;
	/** Preprocessor options, if any. Preprocessing can alternatively also be done through Vite's preprocessor capabilities. */
	preprocess?: any;
	/** `vite-plugin-svelte` plugin options. */
	vitePlugin?: PluginOptions;
	/** Any additional options required by tooling that integrates with Svelte. */
	[key: string]: any;
}

export interface Cookies {
	/**
	 * Gets a cookie that was previously set with `cookies.set`, or from the request headers.
	 * @param name the name of the cookie
	 * @param opts the options, passed directly to `cookie.parse`. See documentation [here](https://github.com/jshttp/cookie#cookieparsestr-options)
	 */
	get(name: string, opts?: import('cookie').CookieParseOptions): string | undefined;

	/**
	 * Gets all cookies that were previously set with `cookies.set`, or from the request headers.
	 * @param opts the options, passed directly to `cookie.parse`. See documentation [here](https://github.com/jshttp/cookie#cookieparsestr-options)
	 */
	getAll(opts?: import('cookie').CookieParseOptions): Array<{ name: string; value: string }>;

	/**
	 * Sets a cookie. This will add a `set-cookie` header to the response, but also make the cookie available via `cookies.get` or `cookies.getAll` during the current request.
	 *
	 * The `httpOnly` and `secure` options are `true` by default (except on http://localhost, where `secure` is `false`), and must be explicitly disabled if you want cookies to be readable by client-side JavaScript and/or transmitted over HTTP. The `sameSite` option defaults to `lax`.
	 *
	 * You must specify a `path` for the cookie. In most cases you should explicitly set `path: '/'` to make the cookie available throughout your app. You can use relative paths, or set `path: ''` to make the cookie only available on the current path and its children
	 * @param name the name of the cookie
	 * @param value the cookie value
	 * @param opts the options, passed directly to `cookie.serialize`. See documentation [here](https://github.com/jshttp/cookie#cookieserializename-value-options)
	 */
	set(
		name: string,
		value: string,
		opts: import('cookie').CookieSerializeOptions & { path: string }
	): void;

	/**
	 * Deletes a cookie by setting its value to an empty string and setting the expiry date in the past.
	 *
	 * You must specify a `path` for the cookie. In most cases you should explicitly set `path: '/'` to make the cookie available throughout your app. You can use relative paths, or set `path: ''` to make the cookie only available on the current path and its children
	 * @param name the name of the cookie
	 * @param opts the options, passed directly to `cookie.serialize`. The `path` must match the path of the cookie you want to delete. See documentation [here](https://github.com/jshttp/cookie#cookieserializename-value-options)
	 */
	delete(name: string, opts: import('cookie').CookieSerializeOptions & { path: string }): void;

	/**
	 * Serialize a cookie name-value pair into a `Set-Cookie` header string, but don't apply it to the response.
	 *
	 * The `httpOnly` and `secure` options are `true` by default (except on http://localhost, where `secure` is `false`), and must be explicitly disabled if you want cookies to be readable by client-side JavaScript and/or transmitted over HTTP. The `sameSite` option defaults to `lax`.
	 *
	 * You must specify a `path` for the cookie. In most cases you should explicitly set `path: '/'` to make the cookie available throughout your app. You can use relative paths, or set `path: ''` to make the cookie only available on the current path and its children
	 *
	 * @param name the name of the cookie
	 * @param value the cookie value
	 * @param opts the options, passed directly to `cookie.serialize`. See documentation [here](https://github.com/jshttp/cookie#cookieserializename-value-options)
	 */
	serialize(
		name: string,
		value: string,
		opts: import('cookie').CookieSerializeOptions & { path: string }
	): string;
}

/**
 * A collection of functions that influence the environment during dev, build and prerendering
 */
export interface Emulator {
	/**
	 * A function that is called with the current route `config` and `prerender` option
	 * and returns an `App.Platform` object
	 */
	platform?(details: { config: any; prerender: PrerenderOption }): MaybePromise<App.Platform>;
}

export interface KitConfig {
	/**
	 * Your [adapter](https://kit.svelte.dev/docs/adapters) is run when executing `vite build`. It determines how the output is converted for different platforms.
	 * @default undefined
	 */
	adapter?: Adapter;
	/**
	 * An object containing zero or more aliases used to replace values in `import` statements. These aliases are automatically passed to Vite and TypeScript.
	 *
	 * ```js
	 * /// file: svelte.config.js
	 * /// type: import('@sveltejs/kit').Config
	 * const config = {
	 *   kit: {
	 *     alias: {
	 *       // this will match a file
	 *       'my-file': 'path/to/my-file.js',
	 *
	 *       // this will match a directory and its contents
	 *       // (`my-directory/x` resolves to `path/to/my-directory/x`)
	 *       'my-directory': 'path/to/my-directory',
	 *
	 *       // an alias ending /* will only match
	 *       // the contents of a directory, not the directory itself
	 *       'my-directory/*': 'path/to/my-directory/*'
	 *     }
	 *   }
	 * };
	 * ```
	 *
	 * > The built-in `$lib` alias is controlled by `config.kit.files.lib` as it is used for packaging.
	 *
	 * > You will need to run `npm run dev` to have SvelteKit automatically generate the required alias configuration in `jsconfig.json` or `tsconfig.json`.
	 * @default {}
	 */
	alias?: Record<string, string>;
	/**
	 * The directory where SvelteKit keeps its stuff, including static assets (such as JS and CSS) and internally-used routes.
	 *
	 * If `paths.assets` is specified, there will be two app directories — `${paths.assets}/${appDir}` and `${paths.base}/${appDir}`.
	 * @default "_app"
	 */
	appDir?: string;
	/**
	 * [Content Security Policy](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy) configuration. CSP helps to protect your users against cross-site scripting (XSS) attacks, by limiting the places resources can be loaded from. For example, a configuration like this...
	 *
	 * ```js
	 * /// file: svelte.config.js
	 * /// type: import('@sveltejs/kit').Config
	 * const config = {
	 *   kit: {
	 *     csp: {
	 *       directives: {
	 *         'script-src': ['self']
	 *       },
	 *       reportOnly: {
	 *         'script-src': ['self']
	 *       }
	 *     }
	 *   }
	 * };
	 *
	 * export default config;
	 * ```
	 *
	 * ...would prevent scripts loading from external sites. SvelteKit will augment the specified directives with nonces or hashes (depending on `mode`) for any inline styles and scripts it generates.
	 *
	 * To add a nonce for scripts and links manually included in `src/app.html`, you may use the placeholder `%sveltekit.nonce%` (for example `<script nonce="%sveltekit.nonce%">`).
	 *
	 * When pages are prerendered, the CSP header is added via a `<meta http-equiv>` tag (note that in this case, `frame-ancestors`, `report-uri` and `sandbox` directives will be ignored).
	 *
	 * > When `mode` is `'auto'`, SvelteKit will use nonces for dynamically rendered pages and hashes for prerendered pages. Using nonces with prerendered pages is insecure and therefore forbidden.
	 *
	 * > Note that most [Svelte transitions](https://svelte.dev/tutorial/transition) work by creating an inline `<style>` element. If you use these in your app, you must either leave the `style-src` directive unspecified or add `unsafe-inline`.
	 *
	 * If this level of configuration is insufficient and you have more dynamic requirements, you can use the [`handle` hook](https://kit.svelte.dev/docs/hooks#server-hooks-handle) to roll your own CSP.
	 */
	csp?: {
		/**
		 * Whether to use hashes or nonces to restrict `<script>` and `<style>` elements. `'auto'` will use hashes for prerendered pages, and nonces for dynamically rendered pages.
		 */
		mode?: 'hash' | 'nonce' | 'auto';
		/**
		 * Directives that will be added to `Content-Security-Policy` headers.
		 */
		directives?: CspDirectives;
		/**
		 * Directives that will be added to `Content-Security-Policy-Report-Only` headers.
		 */
		reportOnly?: CspDirectives;
	};
	/**
	 * Protection against [cross-site request forgery (CSRF)](https://owasp.org/www-community/attacks/csrf) attacks.
	 */
	csrf?: {
		/**
		 * Whether to check the incoming `origin` header for `POST`, `PUT`, `PATCH`, or `DELETE` form submissions and verify that it matches the server's origin.
		 *
		 * To allow people to make `POST`, `PUT`, `PATCH`, or `DELETE` requests with a `Content-Type` of `application/x-www-form-urlencoded`, `multipart/form-data`, or `text/plain` to your app from other origins, you will need to disable this option. Be careful!
		 * @default true
		 */
		checkOrigin?: boolean;
	};
	/**
	 * Whether or not the app is embedded inside a larger app. If `true`, SvelteKit will add its event listeners related to navigation etc on the parent of `%sveltekit.body%` instead of `window`, and will pass `params` from the server rather than inferring them from `location.pathname`.
	 * Note that it is generally not supported to embed multiple SvelteKit apps on the same page and use client-side SvelteKit features within them (things such as pushing to the history state assume a single instance).
	 * @default false
	 */
	embedded?: boolean;
	/**
	 * Environment variable configuration
	 */
	env?: {
		/**
		 * The directory to search for `.env` files.
		 * @default "."
		 */
		dir?: string;
		/**
		 * A prefix that signals that an environment variable is safe to expose to client-side code. See [`$env/static/public`](/docs/modules#$env-static-public) and [`$env/dynamic/public`](/docs/modules#$env-dynamic-public). Note that Vite's [`envPrefix`](https://vitejs.dev/config/shared-options.html#envprefix) must be set separately if you are using Vite's environment variable handling - though use of that feature should generally be unnecessary.
		 * @default "PUBLIC_"
		 */
		publicPrefix?: string;
		/**
		 * A prefix that signals that an environment variable is unsafe to expose to client-side code. Environment variables matching neither the public nor the private prefix will be discarded completely. See [`$env/static/private`](/docs/modules#$env-static-private) and [`$env/dynamic/private`](/docs/modules#$env-dynamic-private).
		 * @default ""
		 * @since 1.21.0
		 */
		privatePrefix?: string;
	};
	/**
	 * Where to find various files within your project.
	 */
	files?: {
		/**
		 * a place to put static files that should have stable URLs and undergo no processing, such as `favicon.ico` or `manifest.json`
		 * @default "static"
		 */
		assets?: string;
		hooks?: {
			/**
			 * The location of your client [hooks](https://kit.svelte.dev/docs/hooks).
			 * @default "src/hooks.client"
			 */
			client?: string;
			/**
			 * The location of your server [hooks](https://kit.svelte.dev/docs/hooks).
			 * @default "src/hooks.server"
			 */
			server?: string;
			/**
			 * The location of your universal [hooks](https://kit.svelte.dev/docs/hooks).
			 * @default "src/hooks"
			 * @since 2.3.0
			 */
			universal?: string;
		};
		/**
		 * your app's internal library, accessible throughout the codebase as `$lib`
		 * @default "src/lib"
		 */
		lib?: string;
		/**
		 * a directory containing [parameter matchers](https://kit.svelte.dev/docs/advanced-routing#matching)
		 * @default "src/params"
		 */
		params?: string;
		/**
		 * the files that define the structure of your app (see [Routing](https://kit.svelte.dev/docs/routing))
		 * @default "src/routes"
		 */
		routes?: string;
		/**
		 * the location of your service worker's entry point (see [Service workers](https://kit.svelte.dev/docs/service-workers))
		 * @default "src/service-worker"
		 */
		serviceWorker?: string;
		/**
		 * the location of the template for HTML responses
		 * @default "src/app.html"
		 */
		appTemplate?: string;
		/**
		 * the location of the template for fallback error responses
		 * @default "src/error.html"
		 */
		errorTemplate?: string;
	};
	/**
	 * Inline CSS inside a `<style>` block at the head of the HTML. This option is a number that specifies the maximum length of a CSS file in UTF-16 code units, as specified by the [String.length](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/length) property, to be inlined. All CSS files needed for the page and smaller than this value are merged and inlined in a `<style>` block.
	 *
	 * > This results in fewer initial requests and can improve your [First Contentful Paint](https://web.dev/first-contentful-paint) score. However, it generates larger HTML output and reduces the effectiveness of browser caches. Use it advisedly.
	 * @default 0
	 */
	inlineStyleThreshold?: number;
	/**
	 * An array of file extensions that SvelteKit will treat as modules. Files with extensions that match neither `config.extensions` nor `config.kit.moduleExtensions` will be ignored by the router.
	 * @default [".js", ".ts"]
	 */
	moduleExtensions?: string[];
	/**
	 * The directory that SvelteKit writes files to during `dev` and `build`. You should exclude this directory from version control.
	 * @default ".svelte-kit"
	 */
	outDir?: string;
	/**
	 * Options related to the build output format
	 */
	output?: {
		/**
		 * SvelteKit will preload the JavaScript modules needed for the initial page to avoid import 'waterfalls', resulting in faster application startup. There
		 * are three strategies with different trade-offs:
		 * - `modulepreload` - uses `<link rel="modulepreload">`. This delivers the best results in Chromium-based browsers, in Firefox 115+, and Safari 17+. It is ignored in older browsers.
		 * - `preload-js` - uses `<link rel="preload">`. Prevents waterfalls in Chromium and Safari, but Chromium will parse each module twice (once as a script, once as a module). Causes modules to be requested twice in Firefox. This is a good setting if you want to maximise performance for users on iOS devices at the cost of a very slight degradation for Chromium users.
		 * - `preload-mjs` - uses `<link rel="preload">` but with the `.mjs` extension which prevents double-parsing in Chromium. Some static webservers will fail to serve .mjs files with a `Content-Type: application/javascript` header, which will cause your application to break. If that doesn't apply to you, this is the option that will deliver the best performance for the largest number of users, until `modulepreload` is more widely supported.
		 * @default "modulepreload"
		 * @since 1.8.4
		 */
		preloadStrategy?: 'modulepreload' | 'preload-js' | 'preload-mjs';
	};
	paths?: {
		/**
		 * An absolute path that your app's files are served from. This is useful if your files are served from a storage bucket of some kind.
		 * @default ""
		 */
		assets?: '' | `http://${string}` | `https://${string}`;
		/**
		 * A root-relative path that must start, but not end with `/` (e.g. `/base-path`), unless it is the empty string. This specifies where your app is served from and allows the app to live on a non-root path. Note that you need to prepend all your root-relative links with the base value or they will point to the root of your domain, not your `base` (this is how the browser works). You can use [`base` from `$app/paths`](/docs/modules#$app-paths-base) for that: `<a href="{base}/your-page">Link</a>`. If you find yourself writing this often, it may make sense to extract this into a reusable component.
		 * @default ""
		 */
		base?: '' | `/${string}`;
		/**
		 * Whether to use relative asset paths.
		 *
		 * If `true`, `base` and `assets` imported from `$app/paths` will be replaced with relative asset paths during server-side rendering, resulting in more portable HTML.
		 * If `false`, `%sveltekit.assets%` and references to build artifacts will always be root-relative paths, unless `paths.assets` is an external URL
		 *
		 * [Single-page app](https://kit.svelte.dev/docs/single-page-apps) fallback pages will always use absolute paths, regardless of this setting.
		 *
		 * If your app uses a `<base>` element, you should set this to `false`, otherwise asset URLs will incorrectly be resolved against the `<base>` URL rather than the current page.
		 *
		 * In 1.0, `undefined` was a valid value, which was set by default. In that case, if `paths.assets` was not external, SvelteKit would replace `%sveltekit.assets%` with a relative path and use relative paths to reference build artifacts, but `base` and `assets` imported from `$app/paths` would be as specified in your config.
		 *
		 * @default true
		 * @since 1.9.0
		 */
		relative?: boolean;
	};
	/**
	 * See [Prerendering](https://kit.svelte.dev/docs/page-options#prerender).
	 */
	prerender?: {
		/**
		 * How many pages can be prerendered simultaneously. JS is single-threaded, but in cases where prerendering performance is network-bound (for example loading content from a remote CMS) this can speed things up by processing other tasks while waiting on the network response.
		 * @default 1
		 */
		concurrency?: number;
		/**
		 * Whether SvelteKit should find pages to prerender by following links from `entries`.
		 * @default true
		 */
		crawl?: boolean;
		/**
		 * An array of pages to prerender, or start crawling from (if `crawl: true`). The `*` string includes all routes containing no required `[parameters]`  with optional parameters included as being empty (since SvelteKit doesn't know what value any parameters should have).
		 * @default ["*"]
		 */
		entries?: Array<'*' | `/${string}`>;
		/**
		 * How to respond to HTTP errors encountered while prerendering the app.
		 *
		 * - `'fail'` — fail the build
		 * - `'ignore'` - silently ignore the failure and continue
		 * - `'warn'` — continue, but print a warning
		 * - `(details) => void` — a custom error handler that takes a `details` object with `status`, `path`, `referrer`, `referenceType` and `message` properties. If you `throw` from this function, the build will fail
		 *
		 * ```js
		 * /// file: svelte.config.js
		 * /// type: import('@sveltejs/kit').Config
		 * const config = {
		 *   kit: {
		 *     prerender: {
		 *       handleHttpError: ({ path, referrer, message }) => {
		 *         // ignore deliberate link to shiny 404 page
		 *         if (path === '/not-found' && referrer === '/blog/how-we-built-our-404-page') {
		 *           return;
		 *         }
		 *
		 *         // otherwise fail the build
		 *         throw new Error(message);
		 *       }
		 *     }
		 *   }
		 * };
		 * ```
		 *
		 * @default "fail"
		 * @since 1.15.7
		 */
		handleHttpError?: PrerenderHttpErrorHandlerValue;
		/**
		 * How to respond when hash links from one prerendered page to another don't correspond to an `id` on the destination page.
		 *
		 * - `'fail'` — fail the build
		 * - `'ignore'` - silently ignore the failure and continue
		 * - `'warn'` — continue, but print a warning
		 * - `(details) => void` — a custom error handler that takes a `details` object with `path`, `id`, `referrers` and `message` properties. If you `throw` from this function, the build will fail
		 *
		 * @default "fail"
		 * @since 1.15.7
		 */
		handleMissingId?: PrerenderMissingIdHandlerValue;
		/**
		 * How to respond when an entry generated by the `entries` export doesn't match the route it was generated from.
		 *
		 * - `'fail'` — fail the build
		 * - `'ignore'` - silently ignore the failure and continue
		 * - `'warn'` — continue, but print a warning
		 * - `(details) => void` — a custom error handler that takes a `details` object with `generatedFromId`, `entry`, `matchedId` and `message` properties. If you `throw` from this function, the build will fail
		 *
		 * @default "fail"
		 * @since 1.16.0
		 */
		handleEntryGeneratorMismatch?: PrerenderEntryGeneratorMismatchHandlerValue;
		/**
		 * The value of `url.origin` during prerendering; useful if it is included in rendered content.
		 * @default "http://sveltekit-prerender"
		 */
		origin?: string;
	};
	serviceWorker?: {
		/**
		 * Whether to automatically register the service worker, if it exists.
		 * @default true
		 */
		register?: boolean;
		/**
		 * Determine which files in your `static` directory will be available in `$service-worker.files`.
		 * @default (filename) => !/\.DS_Store/.test(filename)
		 */
		files?(filepath: string): boolean;
	};
	typescript?: {
		/**
		 * A function that allows you to edit the generated `tsconfig.json`. You can mutate the config (recommended) or return a new one.
		 * This is useful for extending a shared `tsconfig.json` in a monorepo root, for example.
		 * @default (config) => config
		 * @since 1.3.0
		 */
		config?: (config: Record<string, any>) => Record<string, any> | void;
	};
	/**
	 * Client-side navigation can be buggy if you deploy a new version of your app while people are using it. If the code for the new page is already loaded, it may have stale content; if it isn't, the app's route manifest may point to a JavaScript file that no longer exists.
	 * SvelteKit helps you solve this problem through version management.
	 * If SvelteKit encounters an error while loading the page and detects that a new version has been deployed (using the `name` specified here, which defaults to a timestamp of the build) it will fall back to traditional full-page navigation.
	 * Not all navigations will result in an error though, for example if the JavaScript for the next page is already loaded. If you still want to force a full-page navigation in these cases, use techniques such as setting the `pollInterval` and then using `beforeNavigate`:
	 * ```html
	 * /// file: +layout.svelte
	 * <script>
	 *   import { beforeNavigate } from '$app/navigation';
	 *   import { updated } from '$app/stores';
	 *
	 *   beforeNavigate(({ willUnload, to }) => {
	 *     if ($updated && !willUnload && to?.url) {
	 *       location.href = to.url.href;
	 *     }
	 *   });
	 * </script>
	 * ```
	 *
	 * If you set `pollInterval` to a non-zero value, SvelteKit will poll for new versions in the background and set the value of the [`updated`](/docs/modules#$app-stores-updated) store to `true` when it detects one.
	 */
	version?: {
		/**
		 * The current app version string. If specified, this must be deterministic (e.g. a commit ref rather than `Math.random()` or `Date.now().toString()`), otherwise defaults to a timestamp of the build.
		 *
		 * For example, to use the current commit hash, you could do use `git rev-parse HEAD`:
		 *
		 * ```js
		 * /// file: svelte.config.js
		 * import * as child_process from 'node:child_process';
		 *
		 * export default {
		 *   kit: {
		 *     version: {
		 *       name: child_process.execSync('git rev-parse HEAD').toString().trim()
		 *     }
		 *   }
		 * };
		 * ```
		 */
		name?: string;
		/**
		 * The interval in milliseconds to poll for version changes. If this is `0`, no polling occurs.
		 * @default 0
		 */
		pollInterval?: number;
	};
}

/**
 * The [`handle`](https://kit.svelte.dev/docs/hooks#server-hooks-handle) hook runs every time the SvelteKit server receives a [request](https://kit.svelte.dev/docs/web-standards#fetch-apis-request) and
 * determines the [response](https://kit.svelte.dev/docs/web-standards#fetch-apis-response).
 * It receives an `event` object representing the request and a function called `resolve`, which renders the route and generates a `Response`.
 * This allows you to modify response headers or bodies, or bypass SvelteKit entirely (for implementing routes programmatically, for example).
 */
export type Handle = (input: {
	event: RequestEvent;
	resolve(event: RequestEvent, opts?: ResolveOptions): MaybePromise<Response>;
}) => MaybePromise<Response>;

/**
 * The server-side [`handleError`](https://kit.svelte.dev/docs/hooks#shared-hooks-handleerror) hook runs when an unexpected error is thrown while responding to a request.
 *
 * If an unexpected error is thrown during loading or rendering, this function will be called with the error and the event.
 * Make sure that this function _never_ throws an error.
 */
export type HandleServerError = (input: {
	error: unknown;
	event: RequestEvent;
	status: number;
	message: string;
}) => MaybePromise<void | App.Error>;

/**
 * The client-side [`handleError`](https://kit.svelte.dev/docs/hooks#shared-hooks-handleerror) hook runs when an unexpected error is thrown while navigating.
 *
 * If an unexpected error is thrown during loading or the following render, this function will be called with the error and the event.
 * Make sure that this function _never_ throws an error.
 */
export type HandleClientError = (input: {
	error: unknown;
	event: NavigationEvent;
	status: number;
	message: string;
}) => MaybePromise<void | App.Error>;

/**
 * The [`handleFetch`](https://kit.svelte.dev/docs/hooks#server-hooks-handlefetch) hook allows you to modify (or replace) a `fetch` request that happens inside a `load` function that runs on the server (or during pre-rendering)
 */
export type HandleFetch = (input: {
	event: RequestEvent;
	request: Request;
	fetch: typeof fetch;
}) => MaybePromise<Response>;

/**
 * The [`reroute`](https://kit.svelte.dev/docs/hooks#universal-hooks-reroute) hook allows you to modify the URL before it is used to determine which route to render.
 * @since 2.3.0
 */
export type Reroute = (event: { url: URL }) => void | string;

/**
 * The generic form of `PageLoad` and `LayoutLoad`. You should import those from `./$types` (see [generated types](https://kit.svelte.dev/docs/types#generated-types))
 * rather than using `Load` directly.
 */
export type Load<
	Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
	InputData extends Record<string, unknown> | null = Record<string, any> | null,
	ParentData extends Record<string, unknown> = Record<string, any>,
	OutputData extends Record<string, unknown> | void = Record<string, any> | void,
	RouteId extends string | null = string | null
> = (event: LoadEvent<Params, InputData, ParentData, RouteId>) => MaybePromise<OutputData>;

/**
 * The generic form of `PageLoadEvent` and `LayoutLoadEvent`. You should import those from `./$types` (see [generated types](https://kit.svelte.dev/docs/types#generated-types))
 * rather than using `LoadEvent` directly.
 */
export interface LoadEvent<
	Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
	Data extends Record<string, unknown> | null = Record<string, any> | null,
	ParentData extends Record<string, unknown> = Record<string, any>,
	RouteId extends string | null = string | null
> extends NavigationEvent<Params, RouteId> {
	/**
	 * `fetch` is equivalent to the [native `fetch` web API](https://developer.mozilla.org/en-US/docs/Web/API/fetch), with a few additional features:
	 *
	 * - It can be used to make credentialed requests on the server, as it inherits the `cookie` and `authorization` headers for the page request.
	 * - It can make relative requests on the server (ordinarily, `fetch` requires a URL with an origin when used in a server context).
	 * - Internal requests (e.g. for `+server.js` routes) go directly to the handler function when running on the server, without the overhead of an HTTP call.
	 * - During server-side rendering, the response will be captured and inlined into the rendered HTML by hooking into the `text` and `json` methods of the `Response` object. Note that headers will _not_ be serialized, unless explicitly included via [`filterSerializedResponseHeaders`](https://kit.svelte.dev/docs/hooks#server-hooks-handle)
	 * - During hydration, the response will be read from the HTML, guaranteeing consistency and preventing an additional network request.
	 *
	 * You can learn more about making credentialed requests with cookies [here](https://kit.svelte.dev/docs/load#cookies)
	 */
	fetch: typeof fetch;
	/**
	 * Contains the data returned by the route's server `load` function (in `+layout.server.js` or `+page.server.js`), if any.
	 */
	data: Data;
	/**
	 * If you need to set headers for the response, you can do so using the this method. This is useful if you want the page to be cached, for example:
	 *
	 *	```js
	 *	/// file: src/routes/blog/+page.js
	 *	export async function load({ fetch, setHeaders }) {
	 *		const url = `https://cms.example.com/articles.json`;
	 *		const response = await fetch(url);
	 *
	 *		setHeaders({
	 *			age: response.headers.get('age'),
	 *			'cache-control': response.headers.get('cache-control')
	 *		});
	 *
	 *		return response.json();
	 *	}
	 *	```
	 *
	 * Setting the same header multiple times (even in separate `load` functions) is an error — you can only set a given header once.
	 *
	 * You cannot add a `set-cookie` header with `setHeaders` — use the [`cookies`](https://kit.svelte.dev/docs/types#public-types-cookies) API in a server-only `load` function instead.
	 *
	 * `setHeaders` has no effect when a `load` function runs in the browser.
	 */
	setHeaders(headers: Record<string, string>): void;
	/**
	 * `await parent()` returns data from parent `+layout.js` `load` functions.
	 * Implicitly, a missing `+layout.js` is treated as a `({ data }) => data` function, meaning that it will return and forward data from parent `+layout.server.js` files.
	 *
	 * Be careful not to introduce accidental waterfalls when using `await parent()`. If for example you only want to merge parent data into the returned output, call it _after_ fetching your other data.
	 */
	parent(): Promise<ParentData>;
	/**
	 * This function declares that the `load` function has a _dependency_ on one or more URLs or custom identifiers, which can subsequently be used with [`invalidate()`](/docs/modules#$app-navigation-invalidate) to cause `load` to rerun.
	 *
	 * Most of the time you won't need this, as `fetch` calls `depends` on your behalf — it's only necessary if you're using a custom API client that bypasses `fetch`.
	 *
	 * URLs can be absolute or relative to the page being loaded, and must be [encoded](https://developer.mozilla.org/en-US/docs/Glossary/percent-encoding).
	 *
	 * Custom identifiers have to be prefixed with one or more lowercase letters followed by a colon to conform to the [URI specification](https://www.rfc-editor.org/rfc/rfc3986.html).
	 *
	 * The following example shows how to use `depends` to register a dependency on a custom identifier, which is `invalidate`d after a button click, making the `load` function rerun.
	 *
	 * ```js
	 * /// file: src/routes/+page.js
	 * let count = 0;
	 * export async function load({ depends }) {
	 * 	depends('increase:count');
	 *
	 * 	return { count: count++ };
	 * }
	 * ```
	 *
	 * ```html
	 * /// file: src/routes/+page.svelte
	 * <script>
	 * 	import { invalidate } from '$app/navigation';
	 *
	 * 	export let data;
	 *
	 * 	const increase = async () => {
	 * 		await invalidate('increase:count');
	 * 	}
	 * </script>
	 *
	 * <p>{data.count}<p>
	 * <button on:click={increase}>Increase Count</button>
	 * ```
	 */
	depends(...deps: Array<`${string}:${string}`>): void;
	/**
	 * Use this function to opt out of dependency tracking for everything that is synchronously called within the callback. Example:
	 *
	 * ```js
	 * /// file: src/routes/+page.server.js
	 * export async function load({ untrack, url }) {
	 * 	// Untrack url.pathname so that path changes don't trigger a rerun
	 * 	if (untrack(() => url.pathname === '/')) {
	 * 		return { message: 'Welcome!' };
	 * 	}
	 * }
	 * ```
	 */
	untrack<T>(fn: () => T): T;
}

export interface NavigationEvent<
	Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
	RouteId extends string | null = string | null
> {
	/**
	 * The parameters of the current page - e.g. for a route like `/blog/[slug]`, a `{ slug: string }` object
	 */
	params: Params;
	/**
	 * Info about the current route
	 */
	route: {
		/**
		 * The ID of the current route - e.g. for `src/routes/blog/[slug]`, it would be `/blog/[slug]`
		 */
		id: RouteId;
	};
	/**
	 * The URL of the current page
	 */
	url: URL;
}

/**
 * Information about the target of a specific navigation.
 */
export interface NavigationTarget {
	/**
	 * Parameters of the target page - e.g. for a route like `/blog/[slug]`, a `{ slug: string }` object.
	 * Is `null` if the target is not part of the SvelteKit app (could not be resolved to a route).
	 */
	params: Record<string, string> | null;
	/**
	 * Info about the target route
	 */
	route: { id: string | null };
	/**
	 * The URL that is navigated to
	 */
	url: URL;
}

/**
 * - `enter`: The app has hydrated
 * - `form`: The user submitted a `<form>` with a GET method
 * - `leave`: The user is leaving the app by closing the tab or using the back/forward buttons to go to a different document
 * - `link`: Navigation was triggered by a link click
 * - `goto`: Navigation was triggered by a `goto(...)` call or a redirect
 * - `popstate`: Navigation was triggered by back/forward navigation
 */
export type NavigationType = 'enter' | 'form' | 'leave' | 'link' | 'goto' | 'popstate';

export interface Navigation {
	/**
	 * Where navigation was triggered from
	 */
	from: NavigationTarget | null;
	/**
	 * Where navigation is going to/has gone to
	 */
	to: NavigationTarget | null;
	/**
	 * The type of navigation:
	 * - `form`: The user submitted a `<form>`
	 * - `leave`: The app is being left either because the tab is being closed or a navigation to a different document is occurring
	 * - `link`: Navigation was triggered by a link click
	 * - `goto`: Navigation was triggered by a `goto(...)` call or a redirect
	 * - `popstate`: Navigation was triggered by back/forward navigation
	 */
	type: Exclude<NavigationType, 'enter'>;
	/**
	 * Whether or not the navigation will result in the page being unloaded (i.e. not a client-side navigation)
	 */
	willUnload: boolean;
	/**
	 * In case of a history back/forward navigation, the number of steps to go back/forward
	 */
	delta?: number;
	/**
	 * A promise that resolves once the navigation is complete, and rejects if the navigation
	 * fails or is aborted. In the case of a `willUnload` navigation, the promise will never resolve
	 */
	complete: Promise<void>;
}

/**
 * The argument passed to [`beforeNavigate`](https://kit.svelte.dev/docs/modules#$app-navigation-beforenavigate) callbacks.
 */
export interface BeforeNavigate extends Navigation {
	/**
	 * Call this to prevent the navigation from starting.
	 */
	cancel(): void;
}

/**
 * The argument passed to [`onNavigate`](https://kit.svelte.dev/docs/modules#$app-navigation-onnavigate) callbacks.
 */
export interface OnNavigate extends Navigation {
	/**
	 * The type of navigation:
	 * - `form`: The user submitted a `<form>`
	 * - `link`: Navigation was triggered by a link click
	 * - `goto`: Navigation was triggered by a `goto(...)` call or a redirect
	 * - `popstate`: Navigation was triggered by back/forward navigation
	 */
	type: Exclude<NavigationType, 'enter' | 'leave'>;
	/**
	 * Since `onNavigate` callbacks are called immediately before a client-side navigation, they will never be called with a navigation that unloads the page.
	 */
	willUnload: false;
}

/**
 * The argument passed to [`afterNavigate`](https://kit.svelte.dev/docs/modules#$app-navigation-afternavigate) callbacks.
 */
export interface AfterNavigate extends Omit<Navigation, 'type'> {
	/**
	 * The type of navigation:
	 * - `enter`: The app has hydrated
	 * - `form`: The user submitted a `<form>`
	 * - `link`: Navigation was triggered by a link click
	 * - `goto`: Navigation was triggered by a `goto(...)` call or a redirect
	 * - `popstate`: Navigation was triggered by back/forward navigation
	 */
	type: Exclude<NavigationType, 'leave'>;
	/**
	 * Since `afterNavigate` callbacks are called after a navigation completes, they will never be called with a navigation that unloads the page.
	 */
	willUnload: false;
}

/**
 * The shape of the `$page` store
 */
export interface Page<
	Params extends Record<string, string> = Record<string, string>,
	RouteId extends string | null = string | null
> {
	/**
	 * The URL of the current page
	 */
	url: URL;
	/**
	 * The parameters of the current page - e.g. for a route like `/blog/[slug]`, a `{ slug: string }` object
	 */
	params: Params;
	/**
	 * Info about the current route
	 */
	route: {
		/**
		 * The ID of the current route - e.g. for `src/routes/blog/[slug]`, it would be `/blog/[slug]`
		 */
		id: RouteId;
	};
	/**
	 * Http status code of the current page
	 */
	status: number;
	/**
	 * The error object of the current page, if any. Filled from the `handleError` hooks.
	 */
	error: App.Error | null;
	/**
	 * The merged result of all data from all `load` functions on the current page. You can type a common denominator through `App.PageData`.
	 */
	data: App.PageData & Record<string, any>;
	/**
	 * The page state, which can be manipulated using the [`pushState`](https://kit.svelte.dev/docs/modules#$app-navigation-pushstate) and [`replaceState`](https://kit.svelte.dev/docs/modules#$app-navigation-replacestate) functions from `$app/navigation`.
	 */
	state: App.PageState;
	/**
	 * Filled only after a form submission. See [form actions](https://kit.svelte.dev/docs/form-actions) for more info.
	 */
	form: any;
}

/**
 * The shape of a param matcher. See [matching](https://kit.svelte.dev/docs/advanced-routing#matching) for more info.
 */
export type ParamMatcher = (param: string) => boolean;

export interface RequestEvent<
	Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
	RouteId extends string | null = string | null
> {
	/**
	 * Get or set cookies related to the current request
	 */
	cookies: Cookies;
	/**
	 * `fetch` is equivalent to the [native `fetch` web API](https://developer.mozilla.org/en-US/docs/Web/API/fetch), with a few additional features:
	 *
	 * - It can be used to make credentialed requests on the server, as it inherits the `cookie` and `authorization` headers for the page request.
	 * - It can make relative requests on the server (ordinarily, `fetch` requires a URL with an origin when used in a server context).
	 * - Internal requests (e.g. for `+server.js` routes) go directly to the handler function when running on the server, without the overhead of an HTTP call.
	 * - During server-side rendering, the response will be captured and inlined into the rendered HTML by hooking into the `text` and `json` methods of the `Response` object. Note that headers will _not_ be serialized, unless explicitly included via [`filterSerializedResponseHeaders`](https://kit.svelte.dev/docs/hooks#server-hooks-handle)
	 * - During hydration, the response will be read from the HTML, guaranteeing consistency and preventing an additional network request.
	 *
	 * You can learn more about making credentialed requests with cookies [here](https://kit.svelte.dev/docs/load#cookies)
	 */
	fetch: typeof fetch;
	/**
	 * The client's IP address, set by the adapter.
	 */
	getClientAddress(): string;
	/**
	 * Contains custom data that was added to the request within the [`handle hook`](https://kit.svelte.dev/docs/hooks#server-hooks-handle).
	 */
	locals: App.Locals;
	/**
	 * The parameters of the current route - e.g. for a route like `/blog/[slug]`, a `{ slug: string }` object
	 */
	params: Params;
	/**
	 * Additional data made available through the adapter.
	 */
	platform: Readonly<App.Platform> | undefined;
	/**
	 * The original request object
	 */
	request: Request;
	/**
	 * Info about the current route
	 */
	route: {
		/**
		 * The ID of the current route - e.g. for `src/routes/blog/[slug]`, it would be `/blog/[slug]`
		 */
		id: RouteId;
	};
	/**
	 * If you need to set headers for the response, you can do so using the this method. This is useful if you want the page to be cached, for example:
	 *
	 *	```js
	 *	/// file: src/routes/blog/+page.js
	 *	export async function load({ fetch, setHeaders }) {
	 *		const url = `https://cms.example.com/articles.json`;
	 *		const response = await fetch(url);
	 *
	 *		setHeaders({
	 *			age: response.headers.get('age'),
	 *			'cache-control': response.headers.get('cache-control')
	 *		});
	 *
	 *		return response.json();
	 *	}
	 *	```
	 *
	 * Setting the same header multiple times (even in separate `load` functions) is an error — you can only set a given header once.
	 *
	 * You cannot add a `set-cookie` header with `setHeaders` — use the [`cookies`](https://kit.svelte.dev/docs/types#public-types-cookies) API instead.
	 */
	setHeaders(headers: Record<string, string>): void;
	/**
	 * The requested URL.
	 */
	url: URL;
	/**
	 * `true` if the request comes from the client asking for `+page/layout.server.js` data. The `url` property will be stripped of the internal information
	 * related to the data request in this case. Use this property instead if the distinction is important to you.
	 */
	isDataRequest: boolean;
	/**
	 * `true` for `+server.js` calls coming from SvelteKit without the overhead of actually making an HTTP request. This happens when you make same-origin `fetch` requests on the server.
	 */
	isSubRequest: boolean;
}

/**
 * A `(event: RequestEvent) => Response` function exported from a `+server.js` file that corresponds to an HTTP verb (`GET`, `PUT`, `PATCH`, etc) and handles requests with that method.
 *
 * It receives `Params` as the first generic argument, which you can skip by using [generated types](https://kit.svelte.dev/docs/types#generated-types) instead.
 */
export type RequestHandler<
	Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
	RouteId extends string | null = string | null
> = (event: RequestEvent<Params, RouteId>) => MaybePromise<Response>;

export interface ResolveOptions {
	/**
	 * Applies custom transforms to HTML. If `done` is true, it's the final chunk. Chunks are not guaranteed to be well-formed HTML
	 * (they could include an element's opening tag but not its closing tag, for example)
	 * but they will always be split at sensible boundaries such as `%sveltekit.head%` or layout/page components.
	 * @param input the html chunk and the info if this is the last chunk
	 */
	transformPageChunk?(input: { html: string; done: boolean }): MaybePromise<string | undefined>;
	/**
	 * Determines which headers should be included in serialized responses when a `load` function loads a resource with `fetch`.
	 * By default, none will be included.
	 * @param name header name
	 * @param value header value
	 */
	filterSerializedResponseHeaders?(name: string, value: string): boolean;
	/**
	 * Determines what should be added to the `<head>` tag to preload it.
	 * By default, `js` and `css` files will be preloaded.
	 * @param input the type of the file and its path
	 */
	preload?(input: { type: 'font' | 'css' | 'js' | 'asset'; path: string }): boolean;
}

export interface RouteDefinition<Config = any> {
	id: string;
	api: {
		methods: Array<HttpMethod | '*'>;
	};
	page: {
		methods: Array<Extract<HttpMethod, 'GET' | 'POST'>>;
	};
	pattern: RegExp;
	prerender: PrerenderOption;
	segments: RouteSegment[];
	methods: Array<HttpMethod | '*'>;
	config: Config;
}

export class Server {
	constructor(manifest: SSRManifest);
	init(options: ServerInitOptions): Promise<void>;
	respond(request: Request, options: RequestOptions): Promise<Response>;
}

export interface ServerInitOptions {
	/** A map of environment variables */
	env: Record<string, string>;
	/** A function that turns an asset filename into a `ReadableStream`. Required for the `read` export from `$app/server` to work */
	read?: (file: string) => ReadableStream;
}

export interface SSRManifest {
	appDir: string;
	appPath: string;
	assets: Set<string>;
	mimeTypes: Record<string, string>;

	/** private fields */
	_: {
		client: NonNullable<BuildData['client']>;
		nodes: SSRNodeLoader[];
		routes: SSRRoute[];
		matchers(): Promise<Record<string, ParamMatcher>>;
		/** A `[file]: size` map of all assets imported by server code */
		server_assets: Record<string, number>;
	};
}

/**
 * The generic form of `PageServerLoad` and `LayoutServerLoad`. You should import those from `./$types` (see [generated types](https://kit.svelte.dev/docs/types#generated-types))
 * rather than using `ServerLoad` directly.
 */
export type ServerLoad<
	Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
	ParentData extends Record<string, any> = Record<string, any>,
	OutputData extends Record<string, any> | void = Record<string, any> | void,
	RouteId extends string | null = string | null
> = (event: ServerLoadEvent<Params, ParentData, RouteId>) => MaybePromise<OutputData>;

export interface ServerLoadEvent<
	Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
	ParentData extends Record<string, any> = Record<string, any>,
	RouteId extends string | null = string | null
> extends RequestEvent<Params, RouteId> {
	/**
	 * `await parent()` returns data from parent `+layout.server.js` `load` functions.
	 *
	 * Be careful not to introduce accidental waterfalls when using `await parent()`. If for example you only want to merge parent data into the returned output, call it _after_ fetching your other data.
	 */
	parent(): Promise<ParentData>;
	/**
	 * This function declares that the `load` function has a _dependency_ on one or more URLs or custom identifiers, which can subsequently be used with [`invalidate()`](/docs/modules#$app-navigation-invalidate) to cause `load` to rerun.
	 *
	 * Most of the time you won't need this, as `fetch` calls `depends` on your behalf — it's only necessary if you're using a custom API client that bypasses `fetch`.
	 *
	 * URLs can be absolute or relative to the page being loaded, and must be [encoded](https://developer.mozilla.org/en-US/docs/Glossary/percent-encoding).
	 *
	 * Custom identifiers have to be prefixed with one or more lowercase letters followed by a colon to conform to the [URI specification](https://www.rfc-editor.org/rfc/rfc3986.html).
	 *
	 * The following example shows how to use `depends` to register a dependency on a custom identifier, which is `invalidate`d after a button click, making the `load` function rerun.
	 *
	 * ```js
	 * /// file: src/routes/+page.js
	 * let count = 0;
	 * export async function load({ depends }) {
	 * 	depends('increase:count');
	 *
	 * 	return { count: count++ };
	 * }
	 * ```
	 *
	 * ```html
	 * /// file: src/routes/+page.svelte
	 * <script>
	 * 	import { invalidate } from '$app/navigation';
	 *
	 * 	export let data;
	 *
	 * 	const increase = async () => {
	 * 		await invalidate('increase:count');
	 * 	}
	 * </script>
	 *
	 * <p>{data.count}<p>
	 * <button on:click={increase}>Increase Count</button>
	 * ```
	 */
	depends(...deps: string[]): void;
	/**
	 * Use this function to opt out of dependency tracking for everything that is synchronously called within the callback. Example:
	 *
	 * ```js
	 * /// file: src/routes/+page.js
	 * export async function load({ untrack, url }) {
	 * 	// Untrack url.pathname so that path changes don't trigger a rerun
	 * 	if (untrack(() => url.pathname === '/')) {
	 * 		return { message: 'Welcome!' };
	 * 	}
	 * }
	 * ```
	 */
	untrack<T>(fn: () => T): T;
}

/**
 * Shape of a form action method that is part of `export const actions = {..}` in `+page.server.js`.
 * See [form actions](https://kit.svelte.dev/docs/form-actions) for more information.
 */
export type Action<
	Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
	OutputData extends Record<string, any> | void = Record<string, any> | void,
	RouteId extends string | null = string | null
> = (event: RequestEvent<Params, RouteId>) => MaybePromise<OutputData>;

/**
 * Shape of the `export const actions = {..}` object in `+page.server.js`.
 * See [form actions](https://kit.svelte.dev/docs/form-actions) for more information.
 */
export type Actions<
	Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
	OutputData extends Record<string, any> | void = Record<string, any> | void,
	RouteId extends string | null = string | null
> = Record<string, Action<Params, OutputData, RouteId>>;

/**
 * When calling a form action via fetch, the response will be one of these shapes.
 * ```svelte
 * <form method="post" use:enhance={() => {
 *   return ({ result }) => {
 * 		// result is of type ActionResult
 *   };
 * }}
 * ```
 */
export type ActionResult<
	Success extends Record<string, unknown> | undefined = Record<string, any>,
	Failure extends Record<string, unknown> | undefined = Record<string, any>
> =
	| { type: 'success'; status: number; data?: Success }
	| { type: 'failure'; status: number; data?: Failure }
	| { type: 'redirect'; status: number; location: string }
	| { type: 'error'; status?: number; error: any };

/**
 * The object returned by the [`error`](https://kit.svelte.dev/docs/modules#sveltejs-kit-error) function.
 */
export interface HttpError {
	/** The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses), in the range 400-599. */
	status: number;
	/** The content of the error. */
	body: App.Error;
}

/**
 * The object returned by the [`redirect`](https://kit.svelte.dev/docs/modules#sveltejs-kit-redirect) function
 */
export interface Redirect {
	/** The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#redirection_messages), in the range 300-308. */
	status: 300 | 301 | 302 | 303 | 304 | 305 | 306 | 307 | 308;
	/** The location to redirect to. */
	location: string;
}

export type SubmitFunction<
	Success extends Record<string, unknown> | undefined = Record<string, any>,
	Failure extends Record<string, unknown> | undefined = Record<string, any>
> = (input: {
	action: URL;
	formData: FormData;
	formElement: HTMLFormElement;
	controller: AbortController;
	submitter: HTMLElement | null;
	cancel(): void;
}) => MaybePromise<
	| void
	| ((opts: {
			formData: FormData;
			formElement: HTMLFormElement;
			action: URL;
			result: ActionResult<Success, Failure>;
			/**
			 * Call this to get the default behavior of a form submission response.
			 * @param options Set `reset: false` if you don't want the `<form>` values to be reset after a successful submission.
			 * @param invalidateAll Set `invalidateAll: false` if you don't want the action to call `invalidateAll` after submission.
			 */
			update(options?: { reset?: boolean; invalidateAll?: boolean }): Promise<void>;
	  }) => void)
>;

/**
 * The type of `export const snapshot` exported from a page or layout component.
 */
export interface Snapshot<T = any> {
	capture: () => T;
	restore: (snapshot: T) => void;
}

export * from './index.js';

```


####### packages/kit/src/exports/vite/build/build_server.js #######

```

import fs from 'node:fs';
import { mkdirp } from '../../../utils/filesystem.js';
import { find_deps, resolve_symlinks } from './utils.js';
import { s } from '../../../utils/misc.js';
import { normalizePath } from 'vite';

/**
 * @param {string} out
 * @param {import('types').ValidatedKitConfig} kit
 * @param {import('types').ManifestData} manifest_data
 * @param {import('vite').Manifest} server_manifest
 * @param {import('vite').Manifest | null} client_manifest
 * @param {import('vite').Rollup.OutputAsset[] | null} css
 */
export function build_server_nodes(out, kit, manifest_data, server_manifest, client_manifest, css) {
	mkdirp(`${out}/server/nodes`);
	mkdirp(`${out}/server/stylesheets`);

	const stylesheet_lookup = new Map();

	if (css) {
		css.forEach((asset) => {
			if (asset.source.length < kit.inlineStyleThreshold) {
				const index = stylesheet_lookup.size;
				const file = `${out}/server/stylesheets/${index}.js`;

				fs.writeFileSync(file, `// ${asset.fileName}\nexport default ${s(asset.source)};`);
				stylesheet_lookup.set(asset.fileName, index);
			}
		});
	}

	manifest_data.nodes.forEach((node, i) => {
		/** @type {string[]} */
		const imports = [];

		// String representation of
		/** @type {import('types').SSRNode} */
		/** @type {string[]} */
		const exports = [`export const index = ${i};`];

		/** @type {string[]} */
		const imported = [];

		/** @type {string[]} */
		const stylesheets = [];

		/** @type {string[]} */
		const fonts = [];

		if (node.component && client_manifest) {
			exports.push(
				'let component_cache;',
				`export const component = async () => component_cache ??= (await import('../${
					resolve_symlinks(server_manifest, node.component).chunk.file
				}')).default;`
			);
		}

		if (node.universal) {
			imports.push(`import * as universal from '../${server_manifest[node.universal].file}';`);
			exports.push('export { universal };');
			exports.push(`export const universal_id = ${s(node.universal)};`);
		}

		if (node.server) {
			imports.push(`import * as server from '../${server_manifest[node.server].file}';`);
			exports.push('export { server };');
			exports.push(`export const server_id = ${s(node.server)};`);
		}

		if (client_manifest && (node.universal || node.component)) {
			const entry = find_deps(
				client_manifest,
				`${normalizePath(kit.outDir)}/generated/client-optimized/nodes/${i}.js`,
				true
			);

			imported.push(...entry.imports);
			stylesheets.push(...entry.stylesheets);
			fonts.push(...entry.fonts);
		}

		exports.push(
			`export const imports = ${s(imported)};`,
			`export const stylesheets = ${s(stylesheets)};`,
			`export const fonts = ${s(fonts)};`
		);

		/** @type {string[]} */
		const styles = [];

		stylesheets.forEach((file) => {
			if (stylesheet_lookup.has(file)) {
				const index = stylesheet_lookup.get(file);
				const name = `stylesheet_${index}`;
				imports.push(`import ${name} from '../stylesheets/${index}.js';`);
				styles.push(`\t${s(file)}: ${name}`);
			}
		});

		if (styles.length > 0) {
			exports.push(`export const inline_styles = () => ({\n${styles.join(',\n')}\n});`);
		}

		fs.writeFileSync(
			`${out}/server/nodes/${i}.js`,
			`${imports.join('\n')}\n\n${exports.join('\n')}\n`
		);
	});
}

```


####### packages/kit/src/exports/vite/build/build_service_worker.js #######

```

import fs from 'node:fs';
import * as vite from 'vite';
import { dedent } from '../../../core/sync/utils.js';
import { s } from '../../../utils/misc.js';
import { get_config_aliases, strip_virtual_prefix, get_env } from '../utils.js';
import { create_static_module } from '../../../core/env.js';
import { env_static_public, service_worker } from '../module_ids.js';

/**
 * @param {string} out
 * @param {import('types').ValidatedKitConfig} kit
 * @param {import('vite').ResolvedConfig} vite_config
 * @param {import('types').ManifestData} manifest_data
 * @param {string} service_worker_entry_file
 * @param {import('types').Prerendered} prerendered
 * @param {import('vite').Manifest} client_manifest
 */
export async function build_service_worker(
	out,
	kit,
	vite_config,
	manifest_data,
	service_worker_entry_file,
	prerendered,
	client_manifest
) {
	const build = new Set();
	for (const key in client_manifest) {
		const { file, css = [], assets = [] } = client_manifest[key];
		build.add(file);
		css.forEach((file) => build.add(file));
		assets.forEach((file) => build.add(file));
	}

	// in a service worker, `location` is the location of the service worker itself,
	// which is guaranteed to be `<base>/service-worker.js`
	const base = "location.pathname.split('/').slice(0, -1).join('/')";

	const service_worker_code = dedent`
		export const base = /*@__PURE__*/ ${base};

		export const build = [
			${Array.from(build)
				.map((file) => `base + ${s(`/${file}`)}`)
				.join(',\n')}
		];

		export const files = [
			${manifest_data.assets
				.filter((asset) => kit.serviceWorker.files(asset.file))
				.map((asset) => `base + ${s(`/${asset.file}`)}`)
				.join(',\n')}
		];

		export const prerendered = [
			${prerendered.paths.map((path) => `base + ${s(path.replace(kit.paths.base, ''))}`).join(',\n')}
		];

		export const version = ${s(kit.version.name)};
	`;

	const env = get_env(kit.env, vite_config.mode);

	/**
	 * @type {import('vite').Plugin}
	 */
	const sw_virtual_modules = {
		name: 'service-worker-build-virtual-modules',
		async resolveId(id) {
			if (id.startsWith('$env/') || id.startsWith('$app/') || id === '$service-worker') {
				return `\0virtual:${id}`;
			}
		},

		async load(id) {
			if (!id.startsWith('\0virtual:')) return;

			if (id === service_worker) {
				return service_worker_code;
			}

			if (id === env_static_public) {
				return create_static_module('$env/static/public', env.public);
			}

			const stripped = strip_virtual_prefix(id);
			throw new Error(
				`Cannot import ${stripped} into service-worker code. Only the modules $service-worker and $env/static/public are available in service workers.`
			);
		}
	};

	await vite.build({
		build: {
			modulePreload: false,
			rollupOptions: {
				input: {
					'service-worker': service_worker_entry_file
				},
				output: {
					// .mjs so that esbuild doesn't incorrectly inject `export` https://github.com/vitejs/vite/issues/15379
					entryFileNames: 'service-worker.mjs',
					assetFileNames: `${kit.appDir}/immutable/assets/[name].[hash][extname]`,
					inlineDynamicImports: true
				}
			},
			outDir: `${out}/client`,
			emptyOutDir: false
		},
		configFile: false,
		define: vite_config.define,
		publicDir: false,
		plugins: [sw_virtual_modules],
		resolve: {
			alias: [...get_config_aliases(kit)]
		},
		experimental: {
			renderBuiltUrl(filename) {
				return {
					runtime: `new URL(${JSON.stringify(filename)}, location.href).pathname`
				};
			}
		}
	});

	// rename .mjs to .js to avoid incorrect MIME types with ancient webservers
	fs.renameSync(`${out}/client/service-worker.mjs`, `${out}/client/service-worker.js`);
}

```


####### packages/kit/src/exports/vite/build/utils.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import { normalizePath } from 'vite';

/**
 * Adds transitive JS and CSS dependencies to the js and css inputs.
 * @param {import('vite').Manifest} manifest
 * @param {string} entry
 * @param {boolean} add_dynamic_css
 * @returns {import('types').AssetDependencies}
 */
export function find_deps(manifest, entry, add_dynamic_css) {
	/** @type {Set<string>} */
	const seen = new Set();

	/** @type {Set<string>} */
	const imports = new Set();

	/** @type {Set<string>} */
	const stylesheets = new Set();

	/** @type {Set<string>} */
	const imported_assets = new Set();

	/**
	 * @param {string} current
	 * @param {boolean} add_js
	 */
	function traverse(current, add_js) {
		if (seen.has(current)) return;
		seen.add(current);

		const { chunk } = resolve_symlinks(manifest, current);

		if (add_js) imports.add(chunk.file);

		if (chunk.assets) {
			for (const asset of chunk.assets) {
				imported_assets.add(asset);
			}
		}

		if (chunk.css) {
			chunk.css.forEach((file) => stylesheets.add(file));
		}

		if (chunk.imports) {
			chunk.imports.forEach((file) => traverse(file, add_js));
		}

		if (add_dynamic_css && chunk.dynamicImports) {
			chunk.dynamicImports.forEach((file) => traverse(file, false));
		}
	}

	const { chunk, file } = resolve_symlinks(manifest, entry);

	traverse(file, true);

	const assets = Array.from(imported_assets);

	return {
		assets,
		file: chunk.file,
		imports: Array.from(imports),
		stylesheets: Array.from(stylesheets),
		// TODO do we need this separately?
		fonts: assets.filter((asset) => /\.(woff2?|ttf|otf)$/.test(asset))
	};
}

/**
 * @param {import('vite').Manifest} manifest
 * @param {string} file
 */
export function resolve_symlinks(manifest, file) {
	while (!manifest[file]) {
		const next = normalizePath(path.relative('.', fs.realpathSync(file)));
		if (next === file) throw new Error(`Could not find file "${file}" in Vite manifest`);
		file = next;
	}

	const chunk = manifest[file];

	return { chunk, file };
}

const method_names = new Set(['GET', 'HEAD', 'PUT', 'POST', 'DELETE', 'PATCH', 'OPTIONS']);

// If we'd written this in TypeScript, it could be easy...
/**
 * @param {string} str
 * @returns {str is import('types').HttpMethod}
 */
export function is_http_method(str) {
	return method_names.has(str);
}

/**
 * @param {import('types').ValidatedKitConfig} config
 * @returns {string}
 */
export function assets_base(config) {
	return (config.paths.assets || config.paths.base || '.') + '/';
}

```


####### packages/kit/src/exports/vite/dev/index.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import { URL } from 'node:url';
import { AsyncLocalStorage } from 'node:async_hooks';
import colors from 'kleur';
import sirv from 'sirv';
import { isCSSRequest, loadEnv, buildErrorMessage } from 'vite';
import { createReadableStream, getRequest, setResponse } from '../../../exports/node/index.js';
import { installPolyfills } from '../../../exports/node/polyfills.js';
import { coalesce_to_error } from '../../../utils/error.js';
import { from_fs, posixify, resolve_entry, to_fs } from '../../../utils/filesystem.js';
import { load_error_page } from '../../../core/config/index.js';
import { SVELTE_KIT_ASSETS } from '../../../constants.js';
import * as sync from '../../../core/sync/sync.js';
import { get_mime_lookup, runtime_base } from '../../../core/utils.js';
import { compact } from '../../../utils/array.js';
import { not_found } from '../utils.js';
import { SCHEME } from '../../../utils/url.js';
import { check_feature } from '../../../utils/features.js';

const cwd = process.cwd();

/**
 * @param {import('vite').ViteDevServer} vite
 * @param {import('vite').ResolvedConfig} vite_config
 * @param {import('types').ValidatedConfig} svelte_config
 * @return {Promise<Promise<() => void>>}
 */
export async function dev(vite, vite_config, svelte_config) {
	installPolyfills();

	const async_local_storage = new AsyncLocalStorage();

	globalThis.__SVELTEKIT_TRACK__ = (label) => {
		const context = async_local_storage.getStore();
		if (!context || context.prerender === true) return;

		check_feature(context.event.route.id, context.config, label, svelte_config.kit.adapter);
	};

	const fetch = globalThis.fetch;
	globalThis.fetch = (info, init) => {
		if (typeof info === 'string' && !SCHEME.test(info)) {
			throw new Error(
				`Cannot use relative URL (${info}) with global fetch — use \`event.fetch\` instead: https://kit.svelte.dev/docs/web-standards#fetch-apis`
			);
		}

		return fetch(info, init);
	};

	sync.init(svelte_config, vite_config.mode);

	/** @type {import('types').ManifestData} */
	let manifest_data;
	/** @type {import('@sveltejs/kit').SSRManifest} */
	let manifest;

	/** @type {Error | null} */
	let manifest_error = null;

	/** @param {string} url */
	async function loud_ssr_load_module(url) {
		try {
			return await vite.ssrLoadModule(url, { fixStacktrace: true });
		} catch (/** @type {any} */ err) {
			const msg = buildErrorMessage(err, [colors.red(`Internal server error: ${err.message}`)]);

			if (!vite.config.logger.hasErrorLogged(err)) {
				vite.config.logger.error(msg, { error: err });
			}

			vite.ws.send({
				type: 'error',
				err: {
					...err,
					// these properties are non-enumerable and will
					// not be serialized unless we explicitly include them
					message: err.message,
					stack: err.stack
				}
			});

			throw err;
		}
	}

	/** @param {string} id */
	async function resolve(id) {
		const url = id.startsWith('..') ? to_fs(path.posix.resolve(id)) : `/${id}`;

		const module = await loud_ssr_load_module(url);

		const module_node = await vite.moduleGraph.getModuleByUrl(url);
		if (!module_node) throw new Error(`Could not find node for ${url}`);

		return { module, module_node, url };
	}

	async function update_manifest() {
		try {
			({ manifest_data } = await sync.create(svelte_config));

			if (manifest_error) {
				manifest_error = null;
				vite.ws.send({ type: 'full-reload' });
			}
		} catch (error) {
			manifest_error = /** @type {Error} */ (error);

			console.error(colors.bold().red(manifest_error.message));
			vite.ws.send({
				type: 'error',
				err: {
					message: manifest_error.message ?? 'Invalid routes',
					stack: ''
				}
			});

			return;
		}

		manifest = {
			appDir: svelte_config.kit.appDir,
			appPath: svelte_config.kit.appDir,
			assets: new Set(manifest_data.assets.map((asset) => asset.file)),
			mimeTypes: get_mime_lookup(manifest_data),
			_: {
				client: {
					start: `${runtime_base}/client/entry.js`,
					app: `${to_fs(svelte_config.kit.outDir)}/generated/client/app.js`,
					imports: [],
					stylesheets: [],
					fonts: [],
					uses_env_dynamic_public: true
				},
				server_assets: new Proxy(
					{},
					{
						has: (_, /** @type {string} */ file) => fs.existsSync(from_fs(file)),
						get: (_, /** @type {string} */ file) => fs.statSync(from_fs(file)).size
					}
				),
				nodes: manifest_data.nodes.map((node, index) => {
					return async () => {
						/** @type {import('types').SSRNode} */
						const result = {};

						/** @type {import('vite').ModuleNode[]} */
						const module_nodes = [];

						result.index = index;

						// these are unused in dev, it's easier to include them
						result.imports = [];
						result.stylesheets = [];
						result.fonts = [];

						if (node.component) {
							result.component = async () => {
								const { module_node, module } = await resolve(
									/** @type {string} */ (node.component)
								);

								module_nodes.push(module_node);

								return module.default;
							};
						}

						if (node.universal) {
							const { module, module_node } = await resolve(node.universal);

							module_nodes.push(module_node);

							result.universal = module;
							result.universal_id = node.universal;
						}

						if (node.server) {
							const { module } = await resolve(node.server);
							result.server = module;
							result.server_id = node.server;
						}

						// in dev we inline all styles to avoid FOUC. this gets populated lazily so that
						// components/stylesheets loaded via import() during `load` are included
						result.inline_styles = async () => {
							const deps = new Set();

							for (const module_node of module_nodes) {
								await find_deps(vite, module_node, deps);
							}

							/** @type {Record<string, string>} */
							const styles = {};

							for (const dep of deps) {
								const url = new URL(dep.url, 'dummy:/');
								const query = url.searchParams;

								if (
									(isCSSRequest(dep.file) ||
										(query.has('svelte') && query.get('type') === 'style')) &&
									!(query.has('raw') || query.has('url') || query.has('inline'))
								) {
									try {
										query.set('inline', '');
										const mod = await vite.ssrLoadModule(
											`${decodeURI(url.pathname)}${url.search}${url.hash}`
										);
										styles[dep.url] = mod.default;
									} catch {
										// this can happen with dynamically imported modules, I think
										// because the Vite module graph doesn't distinguish between
										// static and dynamic imports? TODO investigate, submit fix
									}
								}
							}

							return styles;
						};

						return result;
					};
				}),
				routes: compact(
					manifest_data.routes.map((route) => {
						if (!route.page && !route.endpoint) return null;

						const endpoint = route.endpoint;

						return {
							id: route.id,
							pattern: route.pattern,
							params: route.params,
							page: route.page,
							endpoint: endpoint
								? async () => {
										const url = path.resolve(cwd, endpoint.file);
										return await loud_ssr_load_module(url);
									}
								: null,
							endpoint_id: endpoint?.file
						};
					})
				),
				matchers: async () => {
					/** @type {Record<string, import('@sveltejs/kit').ParamMatcher>} */
					const matchers = {};

					for (const key in manifest_data.matchers) {
						const file = manifest_data.matchers[key];
						const url = path.resolve(cwd, file);
						const module = await vite.ssrLoadModule(url, { fixStacktrace: true });

						if (module.match) {
							matchers[key] = module.match;
						} else {
							throw new Error(`${file} does not export a \`match\` function`);
						}
					}

					return matchers;
				}
			}
		};
	}

	/** @param {Error} error */
	function fix_stack_trace(error) {
		vite.ssrFixStacktrace(error);
		return error.stack;
	}

	await update_manifest();

	/**
	 * @param {string} event
	 * @param {(file: string) => void} cb
	 */
	const watch = (event, cb) => {
		vite.watcher.on(event, (file) => {
			if (
				file.startsWith(svelte_config.kit.files.routes + path.sep) ||
				file.startsWith(svelte_config.kit.files.params + path.sep) ||
				// in contrast to server hooks, client hooks are written to the client manifest
				// and therefore need rebuilding when they are added/removed
				file.startsWith(svelte_config.kit.files.hooks.client)
			) {
				cb(file);
			}
		});
	};
	/** @type {NodeJS.Timeout | null } */
	let timeout = null;
	/** @param {() => void} to_run */
	const debounce = (to_run) => {
		timeout && clearTimeout(timeout);
		timeout = setTimeout(() => {
			timeout = null;
			to_run();
		}, 100);
	};

	// flag to skip watchers if server is already restarting
	let restarting = false;

	// Debounce add/unlink events because in case of folder deletion or moves
	// they fire in rapid succession, causing needless invocations.
	watch('add', () => debounce(update_manifest));
	watch('unlink', () => debounce(update_manifest));
	watch('change', (file) => {
		// Don't run for a single file if the whole manifest is about to get updated
		if (timeout || restarting) return;

		sync.update(svelte_config, manifest_data, file);
	});

	const { appTemplate, errorTemplate, serviceWorker, hooks } = svelte_config.kit.files;

	// vite client only executes a full reload if the triggering html file path is index.html
	// kit defaults to src/app.html, so unless user changed that to index.html
	// send the vite client a full-reload event without path being set
	if (appTemplate !== 'index.html') {
		vite.watcher.on('change', (file) => {
			if (file === appTemplate && !restarting) {
				vite.ws.send({ type: 'full-reload' });
			}
		});
	}

	vite.watcher.on('all', (_, file) => {
		if (
			file === appTemplate ||
			file === errorTemplate ||
			file.startsWith(serviceWorker) ||
			file.startsWith(hooks.server)
		) {
			sync.server(svelte_config);
		}
	});

	// changing the svelte config requires restarting the dev server
	// the config is only read on start and passed on to vite-plugin-svelte
	// which needs up-to-date values to operate correctly
	vite.watcher.on('change', (file) => {
		if (path.basename(file) === 'svelte.config.js') {
			console.log(`svelte config changed, restarting vite dev-server. changed file: ${file}`);
			restarting = true;
			vite.restart();
		}
	});

	const assets = svelte_config.kit.paths.assets ? SVELTE_KIT_ASSETS : svelte_config.kit.paths.base;
	const asset_server = sirv(svelte_config.kit.files.assets, {
		dev: true,
		etag: true,
		maxAge: 0,
		extensions: [],
		setHeaders: (res) => {
			res.setHeader('access-control-allow-origin', '*');
		}
	});

	async function align_exports() {
		// This shameful hack allows us to load runtime server code via Vite
		// while apps load `HttpError` and `Redirect` in Node, without
		// causing `instanceof` checks to fail
		const control_module_node = await import('../../../runtime/control.js');
		const control_module_vite = await vite.ssrLoadModule(`${runtime_base}/control.js`);

		control_module_node.replace_implementations({
			ActionFailure: control_module_vite.ActionFailure,
			HttpError: control_module_vite.HttpError,
			Redirect: control_module_vite.Redirect,
			SvelteKitError: control_module_vite.SvelteKitError
		});
	}
	align_exports();
	const ws_send = vite.ws.send;
	/** @param {any} args */
	vite.ws.send = function (...args) {
		// We need to reapply the patch after Vite did dependency optimizations
		// because that clears the module resolutions
		if (args[0]?.type === 'full-reload' && args[0].path === '*') {
			align_exports();
		}
		return ws_send.apply(vite.ws, args);
	};

	vite.middlewares.use(async (req, res, next) => {
		try {
			const base = `${vite.config.server.https ? 'https' : 'http'}://${
				req.headers[':authority'] || req.headers.host
			}`;

			const decoded = decodeURI(new URL(base + req.url).pathname);

			if (decoded.startsWith(assets)) {
				const pathname = decoded.slice(assets.length);
				const file = svelte_config.kit.files.assets + pathname;

				if (fs.existsSync(file) && !fs.statSync(file).isDirectory()) {
					if (has_correct_case(file, svelte_config.kit.files.assets)) {
						req.url = encodeURI(pathname); // don't need query/hash
						asset_server(req, res);
						return;
					}
				}
			}

			next();
		} catch (e) {
			const error = coalesce_to_error(e);
			res.statusCode = 500;
			res.end(fix_stack_trace(error));
		}
	});

	const env = loadEnv(vite_config.mode, svelte_config.kit.env.dir, '');
	const emulator = await svelte_config.kit.adapter?.emulate?.();

	return () => {
		const serve_static_middleware = vite.middlewares.stack.find(
			(middleware) =>
				/** @type {function} */ (middleware.handle).name === 'viteServeStaticMiddleware'
		);

		// Vite will give a 403 on URLs like /test, /static, and /package.json preventing us from
		// serving routes with those names. See https://github.com/vitejs/vite/issues/7363
		remove_static_middlewares(vite.middlewares);

		vite.middlewares.use(async (req, res) => {
			// Vite's base middleware strips out the base path. Restore it
			const original_url = req.url;
			req.url = req.originalUrl;
			try {
				const base = `${vite.config.server.https ? 'https' : 'http'}://${
					req.headers[':authority'] || req.headers.host
				}`;

				const decoded = decodeURI(new URL(base + req.url).pathname);
				const file = posixify(path.resolve(decoded.slice(svelte_config.kit.paths.base.length + 1)));
				const is_file = fs.existsSync(file) && !fs.statSync(file).isDirectory();
				const allowed =
					!vite_config.server.fs.strict ||
					vite_config.server.fs.allow.some((dir) => file.startsWith(dir));

				if (is_file && allowed) {
					req.url = original_url;
					// @ts-expect-error
					serve_static_middleware.handle(req, res);
					return;
				}

				if (!decoded.startsWith(svelte_config.kit.paths.base)) {
					return not_found(req, res, svelte_config.kit.paths.base);
				}

				if (decoded === svelte_config.kit.paths.base + '/service-worker.js') {
					const resolved = resolve_entry(svelte_config.kit.files.serviceWorker);

					if (resolved) {
						res.writeHead(200, {
							'content-type': 'application/javascript'
						});
						res.end(`import '${to_fs(resolved)}';`);
					} else {
						res.writeHead(404);
						res.end('not found');
					}

					return;
				}

				// we have to import `Server` before calling `set_assets`
				const { Server } = /** @type {import('types').ServerModule} */ (
					await vite.ssrLoadModule(`${runtime_base}/server/index.js`, { fixStacktrace: true })
				);

				const { set_fix_stack_trace } = await vite.ssrLoadModule(
					`${runtime_base}/shared-server.js`
				);
				set_fix_stack_trace(fix_stack_trace);

				const { set_assets } = await vite.ssrLoadModule('__sveltekit/paths');
				set_assets(assets);

				const server = new Server(manifest);

				await server.init({
					env,
					read: (file) => createReadableStream(from_fs(file))
				});

				const request = await getRequest({
					base,
					request: req
				});

				if (manifest_error) {
					console.error(colors.bold().red(manifest_error.message));

					const error_page = load_error_page(svelte_config);

					/** @param {{ status: number; message: string }} opts */
					const error_template = ({ status, message }) => {
						return error_page
							.replace(/%sveltekit\.status%/g, String(status))
							.replace(/%sveltekit\.error\.message%/g, message);
					};

					res.writeHead(500, {
						'Content-Type': 'text/html; charset=utf-8'
					});
					res.end(
						error_template({ status: 500, message: manifest_error.message ?? 'Invalid routes' })
					);

					return;
				}

				const rendered = await server.respond(request, {
					getClientAddress: () => {
						const { remoteAddress } = req.socket;
						if (remoteAddress) return remoteAddress;
						throw new Error('Could not determine clientAddress');
					},
					read: (file) => fs.readFileSync(path.join(svelte_config.kit.files.assets, file)),
					before_handle: (event, config, prerender) => {
						async_local_storage.enterWith({ event, config, prerender });
					},
					emulator
				});

				if (rendered.status === 404) {
					// @ts-expect-error
					serve_static_middleware.handle(req, res, () => {
						setResponse(res, rendered);
					});
				} else {
					setResponse(res, rendered);
				}
			} catch (e) {
				const error = coalesce_to_error(e);
				res.statusCode = 500;
				res.end(fix_stack_trace(error));
			}
		});
	};
}

/**
 * @param {import('connect').Server} server
 */
function remove_static_middlewares(server) {
	const static_middlewares = ['viteServeStaticMiddleware', 'viteServePublicMiddleware'];
	for (let i = server.stack.length - 1; i > 0; i--) {
		// @ts-expect-error using internals
		if (static_middlewares.includes(server.stack[i].handle.name)) {
			server.stack.splice(i, 1);
		}
	}
}

/**
 * @param {import('vite').ViteDevServer} vite
 * @param {import('vite').ModuleNode} node
 * @param {Set<import('vite').ModuleNode>} deps
 */
async function find_deps(vite, node, deps) {
	// since `ssrTransformResult.deps` contains URLs instead of `ModuleNode`s, this process is asynchronous.
	// instead of using `await`, we resolve all branches in parallel.
	/** @type {Promise<void>[]} */
	const branches = [];

	/** @param {import('vite').ModuleNode} node */
	async function add(node) {
		if (!deps.has(node)) {
			deps.add(node);
			await find_deps(vite, node, deps);
		}
	}

	/** @param {string} url */
	async function add_by_url(url) {
		const node = await vite.moduleGraph.getModuleByUrl(url);

		if (node) {
			await add(node);
		}
	}

	if (node.ssrTransformResult) {
		if (node.ssrTransformResult.deps) {
			node.ssrTransformResult.deps.forEach((url) => branches.push(add_by_url(url)));
		}

		if (node.ssrTransformResult.dynamicDeps) {
			node.ssrTransformResult.dynamicDeps.forEach((url) => branches.push(add_by_url(url)));
		}
	} else {
		node.importedModules.forEach((node) => branches.push(add(node)));
	}

	await Promise.all(branches);
}

/**
 * Determine if a file is being requested with the correct case,
 * to ensure consistent behaviour between dev and prod and across
 * operating systems. Note that we can't use realpath here,
 * because we don't want to follow symlinks
 * @param {string} file
 * @param {string} assets
 * @returns {boolean}
 */
function has_correct_case(file, assets) {
	if (file === assets) return true;

	const parent = path.dirname(file);

	if (fs.readdirSync(parent).includes(path.basename(file))) {
		return has_correct_case(parent, assets);
	}

	return false;
}

```


####### packages/kit/src/exports/vite/graph_analysis/index.js #######

```

import path from 'node:path';
import { posixify } from '../../../utils/filesystem.js';
import { strip_virtual_prefix } from '../utils.js';
import { app_server, env_dynamic_private, env_static_private } from '../module_ids.js';

const ILLEGAL_IMPORTS = new Set([env_dynamic_private, env_static_private, app_server]);
const ILLEGAL_MODULE_NAME_PATTERN = /.*\.server\..+/;

/**
 * Checks if given id imports a module that is not allowed to be imported into client-side code.
 * @param {string} id
 * @param {{
 *   cwd: string;
 *   node_modules: string;
 *   server: string;
 * }} dirs
 */
export function is_illegal(id, dirs) {
	if (ILLEGAL_IMPORTS.has(id)) return true;
	if (!id.startsWith(dirs.cwd) || id.startsWith(dirs.node_modules)) return false;
	return ILLEGAL_MODULE_NAME_PATTERN.test(path.basename(id)) || id.startsWith(dirs.server);
}

/**
 * Creates a guard that checks that no id imports a module that is not allowed to be imported into client-side code.
 * @param {import('vite').Rollup.PluginContext} context
 * @param {{ cwd: string; lib: string }} paths
 */
export function module_guard(context, { cwd, lib }) {
	/** @type {Set<string>} */
	const seen = new Set();

	const dirs = {
		// ids will be posixified, so we need to posixify these, too
		cwd: posixify(cwd),
		node_modules: posixify(path.join(cwd, 'node_modules')),
		server: posixify(path.join(lib, 'server'))
	};

	/**
	 * @param {string} id
	 * @param {Array<{ id: string; dynamic: boolean }>} chain
	 */
	function follow(id, chain) {
		if (seen.has(id)) return;
		seen.add(id);

		if (is_illegal(id, dirs)) {
			chain.shift(); // discard the entry point
			id = normalize_id(id, lib, cwd);

			const pyramid =
				chain.map(({ id, dynamic }, i) => {
					id = normalize_id(id, lib, cwd);

					return `${' '.repeat(i * 2)}- ${strip_virtual_prefix(id)} ${
						dynamic ? 'dynamically imports' : 'imports'
					}\n`;
				}) + `${' '.repeat(chain.length)}- ${strip_virtual_prefix(id)}`;

			const message = `Cannot import ${strip_virtual_prefix(
				id
			)} into client-side code:\n${pyramid}`;

			throw new Error(message);
		}

		const module = context.getModuleInfo(id);

		if (module) {
			for (const child of module.importedIds) {
				follow(child, [...chain, { id, dynamic: false }]);
			}

			for (const child of module.dynamicallyImportedIds) {
				follow(child, [...chain, { id, dynamic: true }]);
			}
		}
	}

	return {
		/** @param {string} id should be posixified */
		check: (id) => {
			follow(id, []);
		}
	};
}

/**
 * Removes cwd/lib path from the start of the id
 * @param {string} id
 * @param {string} lib
 * @param {string} cwd
 */
export function normalize_id(id, lib, cwd) {
	if (id.startsWith(lib)) {
		id = id.replace(lib, '$lib');
	}

	if (id.startsWith(cwd)) {
		id = path.relative(cwd, id);
	}

	if (id === app_server) {
		return '$app/server';
	}

	return posixify(id);
}

```


####### packages/kit/src/exports/vite/graph_analysis/index.spec.js #######

```

import { assert, test } from 'vitest';
import { module_guard } from './index.js';

/**
 *
 * @param {Record<string, { importedIds?: string[]; dynamicallyImportedIds?: string[] }>} graph
 * @param {string} [expected_error]
 */
function check(graph, expected_error) {
	// @ts-expect-error
	const context = /** @type {import('vite').Rollup.PluginContext} */ ({
		/** @param {string} id */
		getModuleInfo(id) {
			return {
				importedIds: [],
				dynamicallyImportedIds: [],
				...graph[id]
			};
		}
	});

	const guard = module_guard(context, {
		cwd: '~',
		lib: '~/src/lib'
	});

	if (expected_error) {
		try {
			guard.check('~/src/entry');
			throw new Error('Expected an error');
		} catch (e) {
			// @ts-expect-error
			assert.equal(e.message, expected_error.replace(/^\t+/gm, ''));
		}
	} else {
		guard.check('~/src/entry');
	}
}

test('throws an error when importing $env/static/private', () => {
	check(
		{
			'~/src/entry': {
				importedIds: ['~/src/routes/+page.svelte']
			},
			'~/src/routes/+page.svelte': {
				importedIds: ['\0virtual:$env/static/private']
			}
		},
		`Cannot import $env/static/private into client-side code:
		- src/routes/+page.svelte imports
		 - $env/static/private`
	);
});

test('throws an error when dynamically importing $env/static/private', () => {
	check(
		{
			'~/src/entry': {
				importedIds: ['~/src/routes/+page.svelte']
			},
			'~/src/routes/+page.svelte': {
				dynamicallyImportedIds: ['\0virtual:$env/static/private']
			}
		},
		`Cannot import $env/static/private into client-side code:
		- src/routes/+page.svelte dynamically imports
		 - $env/static/private`
	);
});

test('throws an error when importing $env/dynamic/private', () => {
	check(
		{
			'~/src/entry': {
				importedIds: ['~/src/routes/+page.svelte']
			},
			'~/src/routes/+page.svelte': {
				importedIds: ['\0virtual:$env/dynamic/private']
			}
		},
		`Cannot import $env/dynamic/private into client-side code:
		- src/routes/+page.svelte imports
		 - $env/dynamic/private`
	);
});

test('throws an error when dynamically importing $env/dynamic/private', () => {
	check(
		{
			'~/src/entry': {
				importedIds: ['~/src/routes/+page.svelte']
			},
			'~/src/routes/+page.svelte': {
				dynamicallyImportedIds: ['\0virtual:$env/dynamic/private']
			}
		},
		`Cannot import $env/dynamic/private into client-side code:
		- src/routes/+page.svelte dynamically imports
		 - $env/dynamic/private`
	);
});

test('throws an error when importing a .server.js module', () => {
	check(
		{
			'~/src/entry': {
				importedIds: ['~/src/routes/+page.svelte']
			},
			'~/src/routes/+page.svelte': {
				importedIds: ['~/src/routes/illegal.server.js']
			},
			'~/src/routes/illegal.server.js': {}
		},
		`Cannot import src/routes/illegal.server.js into client-side code:
		- src/routes/+page.svelte imports
		 - src/routes/illegal.server.js`
	);
});

test('throws an error when importing a $lib/server/**/*.js module', () => {
	check(
		{
			'~/src/entry': {
				importedIds: ['~/src/routes/+page.svelte']
			},
			'~/src/routes/+page.svelte': {
				importedIds: ['~/src/lib/server/some/module.js']
			},
			'~/src/lib/server/some/module.js': {}
		},
		`Cannot import $lib/server/some/module.js into client-side code:
		- src/routes/+page.svelte imports
		 - $lib/server/some/module.js`
	);
});

test('ignores .server.js files in node_modules', () => {
	check({
		'~/src/entry': {
			importedIds: ['~/src/routes/+page.svelte']
		},
		'~/src/routes/+page.svelte': {
			importedIds: ['~/node_modules/illegal.server.js']
		},
		'~/node_modules/illegal.server.js': {}
	});
});

test('ignores .server.js files outside the project root', () => {
	check({
		'~/src/entry': {
			importedIds: ['~/src/routes/+page.svelte']
		},
		'~/src/routes/+page.svelte': {
			importedIds: ['/illegal.server.js']
		},
		'/illegal.server.js': {}
	});
});

```


####### packages/kit/src/exports/vite/graph_analysis/types.d.ts #######

```

export interface ImportGraph {
	readonly id: string;
	readonly dynamic: boolean;
	readonly children: Generator<ImportGraph>;
}

```


####### packages/kit/src/exports/vite/graph_analysis/utils.js #######

```

const query_pattern = /\?.*$/s;

/** @param {string} path */
export function remove_query_from_id(path) {
	return path.replace(query_pattern, '');
}

```


####### packages/kit/src/exports/vite/graph_analysis/utils.spec.js #######

```

import { assert, describe } from 'vitest';
import { remove_query_from_id } from './utils.js';

describe('remove_query_string_from_path', (test) => {
	const module_ids = [
		'$env/static/private',
		'some-normal-js-module.js',
		'c:\\\\some\\stupid\\windows\\path.js',
		'/some/normal/linux/path.js'
	];
	const query_module_ids = module_ids.map((module_id) => `${module_id}?hello=world,something=else`);

	test('does nothing to valid IDs', () => {
		module_ids.forEach((id) => {
			const query_stringless = remove_query_from_id(id);
			assert.equal(query_stringless, id);
		});
	});

	test('removes querystring from paths with querystrings at the end', () => {
		query_module_ids.forEach((id, i) => {
			const query_stringless = remove_query_from_id(id);
			assert.equal(query_stringless, module_ids[i]);
		});
	});
});

```


####### packages/kit/src/exports/vite/index.js #######

```

import fs from 'node:fs';
import path from 'node:path';

import * as imr from 'import-meta-resolve';
import colors from 'kleur';

import { copy, mkdirp, posixify, read, resolve_entry, rimraf } from '../../utils/filesystem.js';
import { create_static_module, create_dynamic_module } from '../../core/env.js';
import * as sync from '../../core/sync/sync.js';
import { create_assets } from '../../core/sync/create_manifest_data/index.js';
import { runtime_directory, logger } from '../../core/utils.js';
import { load_config } from '../../core/config/index.js';
import { generate_manifest } from '../../core/generate_manifest/index.js';
import { build_server_nodes } from './build/build_server.js';
import { build_service_worker } from './build/build_service_worker.js';
import { assets_base, find_deps } from './build/utils.js';
import { dev } from './dev/index.js';
import { is_illegal, module_guard, normalize_id } from './graph_analysis/index.js';
import { preview } from './preview/index.js';
import { get_config_aliases, get_env, strip_virtual_prefix } from './utils.js';
import { write_client_manifest } from '../../core/sync/write_client_manifest.js';
import prerender from '../../core/postbuild/prerender.js';
import analyse from '../../core/postbuild/analyse.js';
import { s } from '../../utils/misc.js';
import { hash } from '../../runtime/hash.js';
import { dedent, isSvelte5Plus } from '../../core/sync/utils.js';
import {
	env_dynamic_private,
	env_dynamic_public,
	env_static_private,
	env_static_public,
	service_worker,
	sveltekit_environment,
	sveltekit_paths,
	sveltekit_server
} from './module_ids.js';
import { pathToFileURL } from 'node:url';

const cwd = process.cwd();

/** @type {import('./types.js').EnforcedConfig} */
const enforced_config = {
	appType: true,
	base: true,
	build: {
		cssCodeSplit: true,
		emptyOutDir: true,
		lib: {
			entry: true,
			name: true,
			formats: true
		},
		manifest: true,
		outDir: true,
		rollupOptions: {
			input: true,
			output: {
				format: true,
				entryFileNames: true,
				chunkFileNames: true,
				assetFileNames: true
			},
			preserveEntrySignatures: true
		},
		ssr: true
	},
	publicDir: true,
	resolve: {
		alias: {
			$app: true,
			$lib: true,
			'$service-worker': true
		}
	},
	root: true
};

const options_regex = /(export\s+const\s+(prerender|csr|ssr|trailingSlash))\s*=/s;

/** @type {Set<string>} */
const warned = new Set();

/** @type {import('svelte/compiler').PreprocessorGroup} */
const warning_preprocessor = {
	script: ({ content, filename }) => {
		if (!filename) return;

		const basename = path.basename(filename);
		if (basename.startsWith('+page.') || basename.startsWith('+layout.')) {
			const match = content.match(options_regex);
			if (match) {
				const fixed = basename.replace('.svelte', '(.server).js/ts');

				const message =
					`\n${colors.bold().red(path.relative('.', filename))}\n` +
					`\`${match[1]}\` will be ignored — move it to ${fixed} instead. See https://kit.svelte.dev/docs/page-options for more information.`;

				if (!warned.has(message)) {
					console.log(message);
					warned.add(message);
				}
			}
		}
	},
	markup: ({ content, filename }) => {
		if (!filename) return;

		const basename = path.basename(filename);
		const has_children =
			content.includes('<slot') || (isSvelte5Plus() && content.includes('{@render'));

		if (basename.startsWith('+layout.') && !has_children) {
			const message =
				`\n${colors.bold().red(path.relative('.', filename))}\n` +
				`\`<slot />\`${isSvelte5Plus() ? ' or `{@render ...}` tag' : ''}` +
				' missing — inner content will not be rendered';

			if (!warned.has(message)) {
				console.log(message);
				warned.add(message);
			}
		}
	}
};

/**
 * Resolve a dependency relative to the current working directory,
 * rather than relative to this package
 * @param {string} dependency
 */
async function resolve_peer_dependency(dependency) {
	try {
		// @ts-expect-error the types are wrong
		const resolved = await imr.resolve(dependency, pathToFileURL(process.cwd() + '/dummy.js'));
		return import(resolved);
	} catch (e) {
		throw new Error(
			`Could not resolve peer dependency "${dependency}" relative to your project — please install it and try again.`
		);
	}
}

/**
 * Returns the SvelteKit Vite plugins.
 * @returns {Promise<import('vite').Plugin[]>}
 */
export async function sveltekit() {
	const svelte_config = await load_config();

	/** @type {import('@sveltejs/vite-plugin-svelte').Options['preprocess']} */
	let preprocess = svelte_config.preprocess;
	if (Array.isArray(preprocess)) {
		preprocess = [...preprocess, warning_preprocessor];
	} else if (preprocess) {
		preprocess = [preprocess, warning_preprocessor];
	} else {
		preprocess = warning_preprocessor;
	}

	/** @type {import('@sveltejs/vite-plugin-svelte').Options} */
	const vite_plugin_svelte_options = {
		configFile: false,
		extensions: svelte_config.extensions,
		preprocess,
		onwarn: svelte_config.onwarn,
		compilerOptions: {
			hydratable: isSvelte5Plus() ? undefined : true,
			...svelte_config.compilerOptions
		},
		...svelte_config.vitePlugin
	};

	const { svelte } = await resolve_peer_dependency('@sveltejs/vite-plugin-svelte');

	return [...svelte(vite_plugin_svelte_options), ...(await kit({ svelte_config }))];
}

// These variables live outside the `kit()` function because it is re-invoked by each Vite build

let secondary_build_started = false;

/** @type {import('types').ManifestData} */
let manifest_data;

/**
 * Returns the SvelteKit Vite plugin. Vite executes Rollup hooks as well as some of its own.
 * Background reading is available at:
 * - https://vitejs.dev/guide/api-plugin.html
 * - https://rollupjs.org/guide/en/#plugin-development
 *
 * You can get an idea of the lifecycle by looking at the flow charts here:
 * - https://rollupjs.org/guide/en/#build-hooks
 * - https://rollupjs.org/guide/en/#output-generation-hooks
 *
 * @param {{ svelte_config: import('types').ValidatedConfig }} options
 * @return {Promise<import('vite').Plugin[]>}
 */
async function kit({ svelte_config }) {
	const vite = await resolve_peer_dependency('vite');

	const { kit } = svelte_config;
	const out = `${kit.outDir}/output`;

	const version_hash = hash(kit.version.name);

	/** @type {import('vite').ResolvedConfig} */
	let vite_config;

	/** @type {import('vite').ConfigEnv} */
	let vite_config_env;

	/** @type {boolean} */
	let is_build;

	/** @type {{ public: Record<string, string>; private: Record<string, string> }} */
	let env;

	/** @type {() => Promise<void>} */
	let finalise;

	/** @type {import('vite').UserConfig} */
	let initial_config;

	const service_worker_entry_file = resolve_entry(kit.files.serviceWorker);
	const parsed_service_worker = path.parse(kit.files.serviceWorker);

	/**
	 * A map showing which features (such as `$app/server:read`) are defined
	 * in which chunks, so that we can later determine which routes use which features
	 * @type {Record<string, string[]>}
	 */
	const tracked_features = {};

	const sourcemapIgnoreList = /** @param {string} relative_path */ (relative_path) =>
		relative_path.includes('node_modules') || relative_path.includes(kit.outDir);

	/** @type {import('vite').Plugin} */
	const plugin_setup = {
		name: 'vite-plugin-sveltekit-setup',

		/**
		 * Build the SvelteKit-provided Vite config to be merged with the user's vite.config.js file.
		 * @see https://vitejs.dev/guide/api-plugin.html#config
		 */
		async config(config, config_env) {
			initial_config = config;
			vite_config_env = config_env;
			is_build = config_env.command === 'build';

			env = get_env(kit.env, vite_config_env.mode);

			const allow = new Set([
				kit.files.lib,
				kit.files.routes,
				kit.outDir,
				path.resolve('src'), // TODO this isn't correct if user changed all his files to sth else than src (like in test/options)
				path.resolve('node_modules'),
				path.resolve(vite.searchForWorkspaceRoot(cwd), 'node_modules')
			]);

			// We can only add directories to the allow list, so we find out
			// if there's a client hooks file and pass its directory
			const client_hooks = resolve_entry(kit.files.hooks.client);
			if (client_hooks) allow.add(path.dirname(client_hooks));

			const generated = path.posix.join(kit.outDir, 'generated');

			// dev and preview config can be shared
			/** @type {import('vite').UserConfig} */
			const new_config = {
				resolve: {
					alias: [
						{ find: '__SERVER__', replacement: `${generated}/server` },
						{ find: '$app', replacement: `${runtime_directory}/app` },
						...get_config_aliases(kit)
					]
				},
				root: cwd,
				server: {
					cors: { preflightContinue: true },
					fs: {
						allow: [...allow]
					},
					sourcemapIgnoreList,
					watch: {
						ignored: [
							// Ignore all siblings of config.kit.outDir/generated
							`${posixify(kit.outDir)}/!(generated)`
						]
					}
				},
				preview: {
					cors: { preflightContinue: true }
				},
				optimizeDeps: {
					exclude: [
						'@sveltejs/kit',
						// exclude kit features so that libraries using them work even when they are prebundled
						// this does not affect app code, just handling of imported libraries that use $app or $env
						'$app',
						'$env'
					]
				},
				ssr: {
					noExternal: [
						// This ensures that esm-env is inlined into the server output with the
						// export conditions resolved correctly through Vite. This prevents adapters
						// that bundle later on from resolving the export conditions incorrectly
						// and for example include browser-only code in the server output
						// because they for example use esbuild.build with `platform: 'browser'`
						'esm-env',
						// We need this for two reasons:
						// 1. Without this, `@sveltejs/kit` imports are kept as-is in the server output,
						//    and that causes modules and therefore classes like `Redirect` to be imported twice
						//    under different IDs, which breaks a bunch of stuff because of failing instanceof checks.
						// 2. Vitest bypasses Vite when loading external modules, so we bundle
						//    when it is detected to keep our virtual modules working.
						//    See https://github.com/sveltejs/kit/pull/9172
						//    and https://vitest.dev/config/#deps-registernodeloader
						'@sveltejs/kit'
					]
				}
			};

			if (is_build) {
				if (!new_config.build) new_config.build = {};
				new_config.build.ssr = !secondary_build_started;

				new_config.define = {
					__SVELTEKIT_ADAPTER_NAME__: s(kit.adapter?.name),
					__SVELTEKIT_APP_VERSION_FILE__: s(`${kit.appDir}/version.json`),
					__SVELTEKIT_APP_VERSION_POLL_INTERVAL__: s(kit.version.pollInterval),
					__SVELTEKIT_DEV__: 'false',
					__SVELTEKIT_EMBEDDED__: kit.embedded ? 'true' : 'false'
				};

				if (!secondary_build_started) {
					manifest_data = (await sync.all(svelte_config, config_env.mode)).manifest_data;
				}
			} else {
				new_config.define = {
					__SVELTEKIT_APP_VERSION_POLL_INTERVAL__: '0',
					__SVELTEKIT_DEV__: 'true',
					__SVELTEKIT_EMBEDDED__: kit.embedded ? 'true' : 'false'
				};

				// These Kit dependencies are packaged as CommonJS, which means they must always be externalized.
				// Without this, the tests will still pass but `pnpm dev` will fail in projects that link `@sveltejs/kit`.
				/** @type {NonNullable<import('vite').UserConfig['ssr']>} */ (new_config.ssr).external = [
					'cookie',
					'set-cookie-parser'
				];
			}

			warn_overridden_config(config, new_config);

			return new_config;
		},

		/**
		 * Stores the final config.
		 */
		configResolved(config) {
			vite_config = config;
		}
	};

	/** @type {import('vite').Plugin} */
	const plugin_virtual_modules = {
		name: 'vite-plugin-sveltekit-virtual-modules',

		async resolveId(id, importer) {
			// If importing from a service-worker, only allow $service-worker & $env/static/public, but none of the other virtual modules.
			// This check won't catch transitive imports, but it will warn when the import comes from a service-worker directly.
			// Transitive imports will be caught during the build.
			if (importer) {
				const parsed_importer = path.parse(importer);

				const importer_is_service_worker =
					parsed_importer.dir === parsed_service_worker.dir &&
					parsed_importer.name === parsed_service_worker.name;

				if (importer_is_service_worker && id !== '$service-worker' && id !== '$env/static/public') {
					throw new Error(
						`Cannot import ${id} into service-worker code. Only the modules $service-worker and $env/static/public are available in service workers.`
					);
				}
			}

			// treat $env/static/[public|private] as virtual
			if (id.startsWith('$env/') || id.startsWith('__sveltekit/') || id === '$service-worker') {
				return `\0virtual:${id}`;
			}
		},

		async load(id, options) {
			const browser = !options?.ssr;

			const global = is_build
				? `globalThis.__sveltekit_${version_hash}`
				: 'globalThis.__sveltekit_dev';

			if (options?.ssr === false && process.env.TEST !== 'true') {
				const normalized_cwd = vite.normalizePath(cwd);
				const normalized_lib = vite.normalizePath(kit.files.lib);
				if (
					is_illegal(id, {
						cwd: normalized_cwd,
						node_modules: vite.normalizePath(path.resolve('node_modules')),
						server: vite.normalizePath(path.join(normalized_lib, 'server'))
					})
				) {
					const relative = normalize_id(id, normalized_lib, normalized_cwd);
					throw new Error(`Cannot import ${strip_virtual_prefix(relative)} into client-side code`);
				}
			}

			switch (id) {
				case env_static_private:
					return create_static_module('$env/static/private', env.private);

				case env_static_public:
					return create_static_module('$env/static/public', env.public);

				case env_dynamic_private:
					return create_dynamic_module(
						'private',
						vite_config_env.command === 'serve' ? env.private : undefined
					);

				case env_dynamic_public:
					// populate `$env/dynamic/public` from `window`
					if (browser) {
						return `export const env = ${global}.env;`;
					}

					return create_dynamic_module(
						'public',
						vite_config_env.command === 'serve' ? env.public : undefined
					);

				case service_worker:
					return create_service_worker_module(svelte_config);

				// for internal use only. it's published as $app/paths externally
				// we use this alias so that we won't collide with user aliases
				case sveltekit_paths: {
					const { assets, base } = svelte_config.kit.paths;

					// use the values defined in `global`, but fall back to hard-coded values
					// for the sake of things like Vitest which may import this module
					// outside the context of a page
					if (browser) {
						return dedent`
							export const base = ${global}?.base ?? ${s(base)};
							export const assets = ${global}?.assets ?? ${assets ? s(assets) : 'base'};
						`;
					}

					return dedent`
						export let base = ${s(base)};
						export let assets = ${assets ? s(assets) : 'base'};

						export const relative = ${svelte_config.kit.paths.relative};

						const initial = { base, assets };

						export function override(paths) {
							base = paths.base;
							assets = paths.assets;
						}

						export function reset() {
							base = initial.base;
							assets = initial.assets;
						}

						/** @param {string} path */
						export function set_assets(path) {
							assets = initial.assets = path;
						}
					`;
				}

				case sveltekit_environment: {
					const { version } = svelte_config.kit;

					return dedent`
						export const version = ${s(version.name)};
						export let building = false;
						export let prerendering = false;

						export function set_building() {
							building = true;
						}

						export function set_prerendering() {
							prerendering = true;
						}
					`;
				}

				case sveltekit_server: {
					return dedent`
						export let read_implementation = null;

						export let manifest = null;

						export function set_read_implementation(fn) {
							read_implementation = fn;
						}

						export function set_manifest(_) {
							manifest = _;
						}
					`;
				}
			}
		}
	};

	/**
	 * Ensures that client-side code can't accidentally import server-side code,
	 * whether in `*.server.js` files, `$app/server`, `$lib/server`, or `$env/[static|dynamic]/private`
	 * @type {import('vite').Plugin}
	 */
	const plugin_guard = {
		name: 'vite-plugin-sveltekit-guard',

		writeBundle: {
			sequential: true,
			async handler(_options) {
				if (vite_config.build.ssr) return;

				const guard = module_guard(this, {
					cwd: vite.normalizePath(process.cwd()),
					lib: vite.normalizePath(kit.files.lib)
				});

				manifest_data.nodes.forEach((_node, i) => {
					const id = vite.normalizePath(
						path.resolve(kit.outDir, `generated/client-optimized/nodes/${i}.js`)
					);

					guard.check(id);
				});
			}
		}
	};

	/** @type {import('vite').Plugin} */
	const plugin_compile = {
		name: 'vite-plugin-sveltekit-compile',

		/**
		 * Build the SvelteKit-provided Vite config to be merged with the user's vite.config.js file.
		 * @see https://vitejs.dev/guide/api-plugin.html#config
		 */
		async config(config) {
			/** @type {import('vite').UserConfig} */
			let new_config;

			if (is_build) {
				const ssr = /** @type {boolean} */ (config.build?.ssr);
				const prefix = `${kit.appDir}/immutable`;

				/** @type {Record<string, string>} */
				const input = {};

				if (ssr) {
					input.index = `${runtime_directory}/server/index.js`;
					input.internal = `${kit.outDir}/generated/server/internal.js`;

					// add entry points for every endpoint...
					manifest_data.routes.forEach((route) => {
						if (route.endpoint) {
							const resolved = path.resolve(route.endpoint.file);
							const relative = decodeURIComponent(path.relative(kit.files.routes, resolved));
							const name = posixify(path.join('entries/endpoints', relative.replace(/\.js$/, '')));
							input[name] = resolved;
						}
					});

					// ...and every component used by pages...
					manifest_data.nodes.forEach((node) => {
						for (const file of [node.component, node.universal, node.server]) {
							if (file) {
								const resolved = path.resolve(file);
								const relative = decodeURIComponent(path.relative(kit.files.routes, resolved));

								const name = relative.startsWith('..')
									? posixify(path.join('entries/fallbacks', path.basename(file)))
									: posixify(path.join('entries/pages', relative.replace(/\.js$/, '')));
								input[name] = resolved;
							}
						}
					});

					// ...and every matcher
					Object.entries(manifest_data.matchers).forEach(([key, file]) => {
						const name = posixify(path.join('entries/matchers', key));
						input[name] = path.resolve(file);
					});
				} else {
					input['entry/start'] = `${runtime_directory}/client/entry.js`;
					input['entry/app'] = `${kit.outDir}/generated/client-optimized/app.js`;

					manifest_data.nodes.forEach((node, i) => {
						if (node.component || node.universal) {
							input[`nodes/${i}`] = `${kit.outDir}/generated/client-optimized/nodes/${i}.js`;
						}
					});
				}

				// see the kit.output.preloadStrategy option for details on why we have multiple options here
				const ext = kit.output.preloadStrategy === 'preload-mjs' ? 'mjs' : 'js';

				// We could always use a relative asset base path here, but it's better for performance not to.
				// E.g. Vite generates `new URL('/asset.png', import.meta).href` for a relative path vs just '/asset.png'.
				// That's larger and takes longer to run and also causes an HTML diff between SSR and client
				// causing us to do a more expensive hydration check.
				const client_base =
					kit.paths.relative !== false || kit.paths.assets ? './' : kit.paths.base || '/';

				new_config = {
					base: ssr ? assets_base(kit) : client_base,
					build: {
						copyPublicDir: !ssr,
						cssCodeSplit: true,
						cssMinify: initial_config.build?.minify == null ? true : !!initial_config.build.minify,
						// don't use the default name to avoid collisions with 'static/manifest.json'
						manifest: '.vite/manifest.json', // TODO: remove this after bumping peer dep to vite 5
						outDir: `${out}/${ssr ? 'server' : 'client'}`,
						rollupOptions: {
							input,
							output: {
								format: 'esm',
								entryFileNames: ssr ? '[name].js' : `${prefix}/[name].[hash].${ext}`,
								chunkFileNames: ssr ? 'chunks/[name].js' : `${prefix}/chunks/[name].[hash].${ext}`,
								assetFileNames: `${prefix}/assets/[name].[hash][extname]`,
								hoistTransitiveImports: false,
								sourcemapIgnoreList
							},
							preserveEntrySignatures: 'strict'
						},
						ssrEmitAssets: true,
						target: ssr ? 'node18.13' : undefined
					},
					publicDir: kit.files.assets,
					worker: {
						rollupOptions: {
							output: {
								entryFileNames: `${prefix}/workers/[name]-[hash].js`,
								chunkFileNames: `${prefix}/workers/chunks/[name]-[hash].js`,
								assetFileNames: `${prefix}/workers/assets/[name]-[hash][extname]`,
								hoistTransitiveImports: false
							}
						}
					}
				};
			} else {
				new_config = {
					appType: 'custom',
					base: kit.paths.base,
					build: {
						rollupOptions: {
							// Vite dependency crawler needs an explicit JS entry point
							// eventhough server otherwise works without it
							input: `${runtime_directory}/client/entry.js`
						}
					},
					publicDir: kit.files.assets
				};
			}

			warn_overridden_config(config, new_config);

			return new_config;
		},

		/**
		 * Adds the SvelteKit middleware to do SSR in dev mode.
		 * @see https://vitejs.dev/guide/api-plugin.html#configureserver
		 */
		async configureServer(vite) {
			return await dev(vite, vite_config, svelte_config);
		},

		/**
		 * Adds the SvelteKit middleware to do SSR in preview mode.
		 * @see https://vitejs.dev/guide/api-plugin.html#configurepreviewserver
		 */
		configurePreviewServer(vite) {
			return preview(vite, vite_config, svelte_config);
		},

		/**
		 * Clears the output directories.
		 */
		buildStart() {
			if (secondary_build_started) return;

			if (is_build) {
				if (!vite_config.build.watch) {
					rimraf(out);
				}
				mkdirp(out);
			}
		},

		renderChunk(code, chunk) {
			if (code.includes('__SVELTEKIT_TRACK__')) {
				return {
					code: code.replace(/__SVELTEKIT_TRACK__\('(.+?)'\)/g, (_, label) => {
						(tracked_features[chunk.name + '.js'] ??= []).push(label);
						// put extra whitespace at the end of the comment to preserve the source size and avoid interfering with source maps
						return `/* track ${label}            */`;
					}),
					map: null // TODO we may need to generate a sourcemap in future
				};
			}
		},

		generateBundle() {
			if (vite_config.build.ssr) return;

			this.emitFile({
				type: 'asset',
				fileName: `${kit.appDir}/version.json`,
				source: s({ version: kit.version.name })
			});
		},

		/**
		 * Vite builds a single bundle. We need three bundles: client, server, and service worker.
		 * The user's package.json scripts will invoke the Vite CLI to execute the server build. We
		 * then use this hook to kick off builds for the client and service worker.
		 */
		writeBundle: {
			sequential: true,
			async handler(_options) {
				if (secondary_build_started) return; // only run this once

				const verbose = vite_config.logLevel === 'info';
				const log = logger({ verbose });

				/** @type {import('vite').Manifest} */
				const server_manifest = JSON.parse(read(`${out}/server/${vite_config.build.manifest}`));

				/** @type {import('types').BuildData} */
				const build_data = {
					app_dir: kit.appDir,
					app_path: `${kit.paths.base.slice(1)}${kit.paths.base ? '/' : ''}${kit.appDir}`,
					manifest_data,
					out_dir: out,
					service_worker: service_worker_entry_file ? 'service-worker.js' : null, // TODO make file configurable?
					client: null,
					server_manifest
				};

				const manifest_path = `${out}/server/manifest-full.js`;
				fs.writeFileSync(
					manifest_path,
					`export const manifest = ${generate_manifest({
						build_data,
						relative_path: '.',
						routes: manifest_data.routes
					})};\n`
				);

				// first, build server nodes without the client manifest so we can analyse it
				log.info('Analysing routes');

				build_server_nodes(out, kit, manifest_data, server_manifest, null, null);

				const metadata = await analyse({
					manifest_path,
					manifest_data,
					server_manifest,
					tracked_features,
					env: { ...env.private, ...env.public }
				});

				log.info('Building app');

				// create client build
				write_client_manifest(
					kit,
					manifest_data,
					`${kit.outDir}/generated/client-optimized`,
					metadata.nodes
				);

				secondary_build_started = true;

				const { output } = /** @type {import('vite').Rollup.RollupOutput} */ (
					await vite.build({
						configFile: vite_config.configFile,
						// CLI args
						mode: vite_config_env.mode,
						logLevel: vite_config.logLevel,
						clearScreen: vite_config.clearScreen,
						build: {
							minify: initial_config.build?.minify,
							assetsInlineLimit: vite_config.build.assetsInlineLimit,
							sourcemap: vite_config.build.sourcemap
						},
						optimizeDeps: {
							force: vite_config.optimizeDeps.force
						}
					})
				);

				copy(
					`${out}/server/${kit.appDir}/immutable/assets`,
					`${out}/client/${kit.appDir}/immutable/assets`
				);

				/** @type {import('vite').Manifest} */
				const client_manifest = JSON.parse(read(`${out}/client/${vite_config.build.manifest}`));

				const deps_of = /** @param {string} f */ (f) =>
					find_deps(client_manifest, posixify(path.relative('.', f)), false);
				const start = deps_of(`${runtime_directory}/client/entry.js`);
				const app = deps_of(`${kit.outDir}/generated/client-optimized/app.js`);

				build_data.client = {
					start: start.file,
					app: app.file,
					imports: [...start.imports, ...app.imports],
					stylesheets: [...start.stylesheets, ...app.stylesheets],
					fonts: [...start.fonts, ...app.fonts],
					uses_env_dynamic_public: output.some(
						(chunk) => chunk.type === 'chunk' && chunk.modules[env_dynamic_public]
					)
				};

				const css = output.filter(
					/** @type {(value: any) => value is import('vite').Rollup.OutputAsset} */
					(value) => value.type === 'asset' && value.fileName.endsWith('.css')
				);

				// regenerate manifest now that we have client entry...
				fs.writeFileSync(
					manifest_path,
					`export const manifest = ${generate_manifest({
						build_data,
						relative_path: '.',
						routes: manifest_data.routes
					})};\n`
				);

				// regenerate nodes with the client manifest...
				build_server_nodes(out, kit, manifest_data, server_manifest, client_manifest, css);

				// ...and prerender
				const { prerendered, prerender_map } = await prerender({
					out,
					manifest_path,
					metadata,
					verbose,
					env: { ...env.private, ...env.public }
				});

				// generate a new manifest that doesn't include prerendered pages
				fs.writeFileSync(
					`${out}/server/manifest.js`,
					`export const manifest = ${generate_manifest({
						build_data,
						relative_path: '.',
						routes: manifest_data.routes.filter((route) => prerender_map.get(route.id) !== true)
					})};\n`
				);

				if (service_worker_entry_file) {
					if (kit.paths.assets) {
						throw new Error('Cannot use service worker alongside config.kit.paths.assets');
					}

					log.info('Building service worker');

					await build_service_worker(
						out,
						kit,
						vite_config,
						manifest_data,
						service_worker_entry_file,
						prerendered,
						client_manifest
					);
				}

				// we need to defer this to closeBundle, so that adapters copy files
				// created by other Vite plugins
				finalise = async () => {
					console.log(
						`\nRun ${colors
							.bold()
							.cyan('npm run preview')} to preview your production build locally.`
					);

					if (kit.adapter) {
						const { adapt } = await import('../../core/adapt/index.js');
						await adapt(
							svelte_config,
							build_data,
							metadata,
							prerendered,
							prerender_map,
							log,
							vite_config
						);
					} else {
						console.log(colors.bold().yellow('\nNo adapter specified'));

						const link = colors.bold().cyan('https://kit.svelte.dev/docs/adapters');
						console.log(
							`See ${link} to learn how to configure your app to run on the platform of your choosing`
						);
					}

					secondary_build_started = false;
				};
			}
		},

		/**
		 * Runs the adapter.
		 */
		closeBundle: {
			sequential: true,
			async handler() {
				if (!vite_config.build.ssr) return;
				await finalise?.();
			}
		}
	};

	return [plugin_setup, plugin_virtual_modules, plugin_guard, plugin_compile];
}

/**
 * @param {Record<string, any>} config
 * @param {Record<string, any>} resolved_config
 */
function warn_overridden_config(config, resolved_config) {
	const overridden = find_overridden_config(config, resolved_config, enforced_config, '', []);

	if (overridden.length > 0) {
		console.error(
			colors.bold().red('The following Vite config options will be overridden by SvelteKit:') +
				overridden.map((key) => `\n  - ${key}`).join('')
		);
	}
}

/**
 * @param {Record<string, any>} config
 * @param {Record<string, any>} resolved_config
 * @param {import('./types.js').EnforcedConfig} enforced_config
 * @param {string} path
 * @param {string[]} out used locally to compute the return value
 */
function find_overridden_config(config, resolved_config, enforced_config, path, out) {
	if (config == null || resolved_config == null) {
		return out;
	}

	for (const key in enforced_config) {
		if (typeof config === 'object' && key in config && key in resolved_config) {
			const enforced = enforced_config[key];

			if (enforced === true) {
				if (config[key] !== resolved_config[key]) {
					out.push(path + key);
				}
			} else {
				find_overridden_config(config[key], resolved_config[key], enforced, path + key + '.', out);
			}
		}
	}
	return out;
}

/**
 * @param {import('types').ValidatedConfig} config
 */
const create_service_worker_module = (config) => dedent`
	if (typeof self === 'undefined' || self instanceof ServiceWorkerGlobalScope === false) {
		throw new Error('This module can only be imported inside a service worker');
	}

	export const build = [];
	export const files = [
		${create_assets(config)
			.filter((asset) => config.kit.serviceWorker.files(asset.file))
			.map((asset) => `${s(`${config.kit.paths.base}/${asset.file}`)}`)
			.join(',\n')}
	];
	export const prerendered = [];
	export const version = ${s(config.kit.version.name)};
`;

```


####### packages/kit/src/exports/vite/module_ids.js #######

```

import { fileURLToPath } from 'node:url';

export const env_static_private = '\0virtual:$env/static/private';
export const env_static_public = '\0virtual:$env/static/public';
export const env_dynamic_private = '\0virtual:$env/dynamic/private';
export const env_dynamic_public = '\0virtual:$env/dynamic/public';

export const service_worker = '\0virtual:$service-worker';

export const sveltekit_environment = '\0virtual:__sveltekit/environment';
export const sveltekit_paths = '\0virtual:__sveltekit/paths';
export const sveltekit_server = '\0virtual:__sveltekit/server';

export const app_server = fileURLToPath(
	new URL('../../runtime/app/server/index.js', import.meta.url)
);

```


####### packages/kit/src/exports/vite/preview/index.js #######

```

import fs from 'node:fs';
import { join } from 'node:path';
import { pathToFileURL } from 'node:url';
import { lookup } from 'mrmime';
import sirv from 'sirv';
import { loadEnv, normalizePath } from 'vite';
import { createReadableStream, getRequest, setResponse } from '../../../exports/node/index.js';
import { installPolyfills } from '../../../exports/node/polyfills.js';
import { SVELTE_KIT_ASSETS } from '../../../constants.js';
import { not_found } from '../utils.js';

/** @typedef {import('http').IncomingMessage} Req */
/** @typedef {import('http').ServerResponse} Res */
/** @typedef {(req: Req, res: Res, next: () => void) => void} Handler */

/**
 * @param {{ middlewares: import('connect').Server }} vite
 * @param {import('vite').ResolvedConfig} vite_config
 * @param {import('types').ValidatedConfig} svelte_config
 */
export async function preview(vite, vite_config, svelte_config) {
	installPolyfills();

	const { paths } = svelte_config.kit;
	const base = paths.base;
	const assets = paths.assets ? SVELTE_KIT_ASSETS : paths.base;

	const protocol = vite_config.preview.https ? 'https' : 'http';

	const etag = `"${Date.now()}"`;

	const dir = join(svelte_config.kit.outDir, 'output/server');

	if (!fs.existsSync(dir)) {
		throw new Error(`Server files not found at ${dir}, did you run \`build\` first?`);
	}

	/** @type {import('types').ServerInternalModule} */
	const { set_assets } = await import(pathToFileURL(join(dir, 'internal.js')).href);

	/** @type {import('types').ServerModule} */
	const { Server } = await import(pathToFileURL(join(dir, 'index.js')).href);

	const { manifest } = await import(pathToFileURL(join(dir, 'manifest.js')).href);

	set_assets(assets);

	const server = new Server(manifest);
	await server.init({
		env: loadEnv(vite_config.mode, svelte_config.kit.env.dir, ''),
		read: (file) => createReadableStream(`${dir}/${file}`)
	});

	const emulator = await svelte_config.kit.adapter?.emulate?.();

	return () => {
		// Remove the base middleware. It screws with the URL.
		// It also only lets through requests beginning with the base path, so that requests beginning
		// with the assets URL never reach us. We could serve assets separately before the base
		// middleware, but we'd need that to occur after the compression and cors middlewares, so would
		// need to insert it manually into the stack, which would be at least as bad as doing this.
		for (let i = vite.middlewares.stack.length - 1; i > 0; i--) {
			// @ts-expect-error using internals
			if (vite.middlewares.stack[i].handle.name === 'viteBaseMiddleware') {
				vite.middlewares.stack.splice(i, 1);
			}
		}

		// generated client assets and the contents of `static`
		vite.middlewares.use(
			scoped(
				assets,
				sirv(join(svelte_config.kit.outDir, 'output/client'), {
					setHeaders: (res, pathname) => {
						// only apply to immutable directory, not e.g. version.json
						if (pathname.startsWith(`/${svelte_config.kit.appDir}/immutable`)) {
							res.setHeader('cache-control', 'public,max-age=31536000,immutable');
						}
					}
				})
			)
		);

		vite.middlewares.use((req, res, next) => {
			const original_url = /** @type {string} */ (req.url);
			const { pathname, search } = new URL(original_url, 'http://dummy');

			// if `paths.base === '/a/b/c`, then the root route is `/a/b/c/`,
			// regardless of the `trailingSlash` route option
			if (base.length > 1 && pathname === base) {
				let location = base + '/';
				if (search) location += search;
				res.writeHead(307, {
					location
				});
				res.end();
				return;
			}

			if (pathname.startsWith(base)) {
				next();
			} else {
				res.statusCode = 404;
				not_found(req, res, base);
			}
		});

		// prerendered dependencies
		vite.middlewares.use(
			scoped(base, mutable(join(svelte_config.kit.outDir, 'output/prerendered/dependencies')))
		);

		// prerendered pages (we can't just use sirv because we need to
		// preserve the correct trailingSlash behaviour)
		vite.middlewares.use(
			scoped(base, (req, res, next) => {
				let if_none_match_value = req.headers['if-none-match'];

				if (if_none_match_value?.startsWith('W/"')) {
					if_none_match_value = if_none_match_value.substring(2);
				}

				if (if_none_match_value === etag) {
					res.statusCode = 304;
					res.end();
					return;
				}

				const { pathname, search } = new URL(/** @type {string} */ (req.url), 'http://dummy');

				let filename = normalizePath(
					join(svelte_config.kit.outDir, 'output/prerendered/pages' + pathname)
				);
				let prerendered = is_file(filename);

				if (!prerendered) {
					const has_trailing_slash = pathname.endsWith('/');
					const html_filename = `${filename}${has_trailing_slash ? 'index.html' : '.html'}`;

					/** @type {string | undefined} */
					let redirect;

					if (is_file(html_filename)) {
						filename = html_filename;
						prerendered = true;
					} else if (has_trailing_slash) {
						if (is_file(filename.slice(0, -1) + '.html')) {
							redirect = pathname.slice(0, -1);
						}
					} else if (is_file(filename + '/index.html')) {
						redirect = pathname + '/';
					}

					if (redirect) {
						if (search) redirect += search;
						res.writeHead(307, {
							location: redirect
						});

						res.end();

						return;
					}
				}

				if (prerendered) {
					res.writeHead(200, {
						'content-type': lookup(pathname) || 'text/html',
						etag
					});

					fs.createReadStream(filename).pipe(res);
				} else {
					next();
				}
			})
		);

		// SSR
		vite.middlewares.use(async (req, res) => {
			const host = req.headers['host'];

			const request = await getRequest({
				base: `${protocol}://${host}`,
				request: req
			});

			setResponse(
				res,
				await server.respond(request, {
					getClientAddress: () => {
						const { remoteAddress } = req.socket;
						if (remoteAddress) return remoteAddress;
						throw new Error('Could not determine clientAddress');
					},
					read: (file) => fs.readFileSync(join(svelte_config.kit.files.assets, file)),
					emulator
				})
			);
		});
	};
}

/**
 * @param {string} dir
 * @returns {Handler}
 */
const mutable = (dir) =>
	fs.existsSync(dir)
		? sirv(dir, {
				etag: true,
				maxAge: 0
			})
		: (_req, _res, next) => next();

/**
 * @param {string} scope
 * @param {Handler} handler
 * @returns {Handler}
 */
function scoped(scope, handler) {
	if (scope === '') return handler;

	return (req, res, next) => {
		if (req.url?.startsWith(scope)) {
			const original_url = req.url;
			req.url = req.url.slice(scope.length);
			handler(req, res, () => {
				req.url = original_url;
				next();
			});
		} else {
			next();
		}
	};
}

/** @param {string} path */
function is_file(path) {
	return fs.existsSync(path) && !fs.statSync(path).isDirectory();
}

```


####### packages/kit/src/exports/vite/types.d.ts #######

```

export interface EnforcedConfig {
	[key: string]: EnforcedConfig | true;
}

```


####### packages/kit/src/exports/vite/utils.js #######

```

import path from 'node:path';
import { loadEnv } from 'vite';
import { posixify } from '../../utils/filesystem.js';
import { negotiate } from '../../utils/http.js';
import { filter_private_env, filter_public_env } from '../../utils/env.js';

/**
 * Transforms kit.alias to a valid vite.resolve.alias array.
 *
 * Related to tsconfig path alias creation.
 *
 * @param {import('types').ValidatedKitConfig} config
 * */
export function get_config_aliases(config) {
	/** @type {import('vite').Alias[]} */
	const alias = [
		// For now, we handle `$lib` specially here rather than make it a default value for
		// `config.kit.alias` since it has special meaning for packaging, etc.
		{ find: '$lib', replacement: config.files.lib }
	];

	for (let [key, value] of Object.entries(config.alias)) {
		value = posixify(value);
		if (value.endsWith('/*')) {
			value = value.slice(0, -2);
		}
		if (key.endsWith('/*')) {
			// Doing just `{ find: key.slice(0, -2) ,..}` would mean `import .. from "key"` would also be matched, which we don't want
			alias.push({
				find: new RegExp(`^${escape_for_regexp(key.slice(0, -2))}\\/(.+)$`),
				replacement: `${path.resolve(value)}/$1`
			});
		} else if (key + '/*' in config.alias) {
			// key and key/* both exist -> the replacement for key needs to happen _only_ on import .. from "key"
			alias.push({
				find: new RegExp(`^${escape_for_regexp(key)}$`),
				replacement: path.resolve(value)
			});
		} else {
			alias.push({ find: key, replacement: path.resolve(value) });
		}
	}

	return alias;
}

/**
 * @param {string} str
 */
function escape_for_regexp(str) {
	return str.replace(/[.*+?^${}()|[\]\\]/g, (match) => '\\' + match);
}

/**
 * Load environment variables from process.env and .env files
 * @param {import('types').ValidatedKitConfig['env']} env_config
 * @param {string} mode
 */
export function get_env(env_config, mode) {
	const { publicPrefix: public_prefix, privatePrefix: private_prefix } = env_config;
	const env = loadEnv(mode, env_config.dir, '');

	return {
		public: filter_public_env(env, { public_prefix, private_prefix }),
		private: filter_private_env(env, { public_prefix, private_prefix })
	};
}

/**
 * @param {import('http').IncomingMessage} req
 * @param {import('http').ServerResponse} res
 * @param {string} base
 */
export function not_found(req, res, base) {
	const type = negotiate(req.headers.accept ?? '*', ['text/plain', 'text/html']);

	// special case — handle `/` request automatically
	if (req.url === '/' && type === 'text/html') {
		res.statusCode = 307;
		res.setHeader('location', base);
		res.end();
		return;
	}

	res.statusCode = 404;

	const prefixed = base + req.url;

	if (type === 'text/html') {
		res.setHeader('Content-Type', 'text/html');
		res.end(
			`The server is configured with a public base URL of ${base} - did you mean to visit <a href="${prefixed}">${prefixed}</a> instead?`
		);
	} else {
		res.end(
			`The server is configured with a public base URL of ${base} - did you mean to visit ${prefixed} instead?`
		);
	}
}

export const strip_virtual_prefix = /** @param {string} id */ (id) => id.replace('\0virtual:', '');

```


####### packages/kit/src/exports/vite/utils.spec.js #######

```

import path from 'node:path';
import { expect, test } from 'vitest';
import { validate_config } from '../../core/config/index.js';
import { posixify } from '../../utils/filesystem.js';
import { get_config_aliases } from './utils.js';

test('transform kit.alias to resolve.alias', () => {
	const config = validate_config({
		kit: {
			alias: {
				simpleKey: 'simple/value',
				key: 'value',
				'key/*': 'value/*',
				$regexChar: 'windows\\path',
				'$regexChar/*': 'windows\\path\\*'
			}
		}
	});

	const aliases = get_config_aliases(config.kit);

	const transformed = aliases.map((entry) => {
		const replacement = posixify(path.relative('.', entry.replacement));

		return {
			find: entry.find.toString(), // else assertion fails
			replacement
		};
	});

	expect(transformed).toEqual([
		{ find: '$lib', replacement: 'src/lib' },
		{ find: 'simpleKey', replacement: 'simple/value' },
		{ find: /^key$/.toString(), replacement: 'value' },
		{ find: /^key\/(.+)$/.toString(), replacement: 'value/$1' },
		{ find: /^\$regexChar$/.toString(), replacement: 'windows/path' },
		{ find: /^\$regexChar\/(.+)$/.toString(), replacement: 'windows/path/$1' }
	]);
});

```


####### packages/kit/src/runtime/app/environment/index.js #######

```

import { BROWSER, DEV } from 'esm-env';
export { building, version } from '__sveltekit/environment';

export const browser = BROWSER;

export const dev = DEV;

```


####### packages/kit/src/runtime/app/environment/types.d.ts #######

```

/**
 * `true` if the app is running in the browser.
 */
export const browser: boolean;

/**
 * Whether the dev server is running. This is not guaranteed to correspond to `NODE_ENV` or `MODE`.
 */
export const dev: boolean;

/**
 * SvelteKit analyses your app during the `build` step by running it. During this process, `building` is `true`. This also applies during prerendering.
 */
export const building: boolean;

/**
 * The value of `config.kit.version.name`.
 */
export const version: string;

```


####### packages/kit/src/runtime/app/forms.js #######

```

import * as devalue from 'devalue';
import { DEV } from 'esm-env';
import { invalidateAll } from './navigation.js';
import { applyAction } from '../client/client.js';

export { applyAction };

/**
 * Use this function to deserialize the response from a form submission.
 * Usage:
 *
 * ```js
 * import { deserialize } from '$app/forms';
 *
 * async function handleSubmit(event) {
 *   const response = await fetch('/form?/action', {
 *     method: 'POST',
 *     body: new FormData(event.target)
 *   });
 *
 *   const result = deserialize(await response.text());
 *   // ...
 * }
 * ```
 * @template {Record<string, unknown> | undefined} Success
 * @template {Record<string, unknown> | undefined} Failure
 * @param {string} result
 * @returns {import('@sveltejs/kit').ActionResult<Success, Failure>}
 */
export function deserialize(result) {
	const parsed = JSON.parse(result);
	if (parsed.data) {
		parsed.data = devalue.parse(parsed.data);
	}
	return parsed;
}

/**
 * Shallow clone an element, so that we can access e.g. `form.action` without worrying
 * that someone has added an `<input name="action">` (https://github.com/sveltejs/kit/issues/7593)
 * @template {HTMLElement} T
 * @param {T} element
 * @returns {T}
 */
function clone(element) {
	return /** @type {T} */ (HTMLElement.prototype.cloneNode.call(element));
}

/**
 * This action enhances a `<form>` element that otherwise would work without JavaScript.
 *
 * The `submit` function is called upon submission with the given FormData and the `action` that should be triggered.
 * If `cancel` is called, the form will not be submitted.
 * You can use the abort `controller` to cancel the submission in case another one starts.
 * If a function is returned, that function is called with the response from the server.
 * If nothing is returned, the fallback will be used.
 *
 * If this function or its return value isn't set, it
 * - falls back to updating the `form` prop with the returned data if the action is one same page as the form
 * - updates `$page.status`
 * - resets the `<form>` element and invalidates all data in case of successful submission with no redirect response
 * - redirects in case of a redirect response
 * - redirects to the nearest error page in case of an unexpected error
 *
 * If you provide a custom function with a callback and want to use the default behavior, invoke `update` in your callback.
 * @template {Record<string, unknown> | undefined} Success
 * @template {Record<string, unknown> | undefined} Failure
 * @param {HTMLFormElement} form_element The form element
 * @param {import('@sveltejs/kit').SubmitFunction<Success, Failure>} submit Submit callback
 */
export function enhance(form_element, submit = () => {}) {
	if (DEV && clone(form_element).method !== 'post') {
		throw new Error('use:enhance can only be used on <form> fields with method="POST"');
	}

	/**
	 * @param {{
	 *   action: URL;
	 *   invalidateAll?: boolean;
	 *   result: import('@sveltejs/kit').ActionResult;
	 *   reset?: boolean
	 * }} opts
	 */
	const fallback_callback = async ({
		action,
		result,
		reset = true,
		invalidateAll: shouldInvalidateAll = true
	}) => {
		if (result.type === 'success') {
			if (reset) {
				// We call reset from the prototype to avoid DOM clobbering
				HTMLFormElement.prototype.reset.call(form_element);
			}
			if (shouldInvalidateAll) {
				await invalidateAll();
			}
		}

		// For success/failure results, only apply action if it belongs to the
		// current page, otherwise `form` will be updated erroneously
		if (
			location.origin + location.pathname === action.origin + action.pathname ||
			result.type === 'redirect' ||
			result.type === 'error'
		) {
			applyAction(result);
		}
	};

	/** @param {SubmitEvent} event */
	async function handle_submit(event) {
		const method = event.submitter?.hasAttribute('formmethod')
			? /** @type {HTMLButtonElement | HTMLInputElement} */ (event.submitter).formMethod
			: clone(form_element).method;
		if (method !== 'post') return;

		event.preventDefault();

		const action = new URL(
			// We can't do submitter.formAction directly because that property is always set
			event.submitter?.hasAttribute('formaction')
				? /** @type {HTMLButtonElement | HTMLInputElement} */ (event.submitter).formAction
				: clone(form_element).action
		);

		const form_data = new FormData(form_element);

		if (DEV && clone(form_element).enctype !== 'multipart/form-data') {
			for (const value of form_data.values()) {
				if (value instanceof File) {
					throw new Error(
						'Your form contains <input type="file"> fields, but is missing the necessary `enctype="multipart/form-data"` attribute. This will lead to inconsistent behavior between enhanced and native forms. For more details, see https://github.com/sveltejs/kit/issues/9819.'
					);
				}
			}
		}

		const submitter_name = event.submitter?.getAttribute('name');
		if (submitter_name) {
			form_data.append(submitter_name, event.submitter?.getAttribute('value') ?? '');
		}

		const controller = new AbortController();

		let cancelled = false;
		const cancel = () => (cancelled = true);

		const callback =
			(await submit({
				action,
				cancel,
				controller,
				formData: form_data,
				formElement: form_element,
				submitter: event.submitter
			})) ?? fallback_callback;
		if (cancelled) return;

		/** @type {import('@sveltejs/kit').ActionResult} */
		let result;

		try {
			const response = await fetch(action, {
				method: 'POST',
				headers: {
					accept: 'application/json',
					'x-sveltekit-action': 'true'
				},
				cache: 'no-store',
				body: form_data,
				signal: controller.signal
			});

			result = deserialize(await response.text());
			if (result.type === 'error') result.status = response.status;
		} catch (error) {
			if (/** @type {any} */ (error)?.name === 'AbortError') return;
			result = { type: 'error', error };
		}

		callback({
			action,
			formData: form_data,
			formElement: form_element,
			update: (opts) =>
				fallback_callback({
					action,
					result,
					reset: opts?.reset,
					invalidateAll: opts?.invalidateAll
				}),
			// @ts-expect-error generic constraints stuff we don't care about
			result
		});
	}

	// @ts-expect-error
	HTMLFormElement.prototype.addEventListener.call(form_element, 'submit', handle_submit);

	return {
		destroy() {
			// @ts-expect-error
			HTMLFormElement.prototype.removeEventListener.call(form_element, 'submit', handle_submit);
		}
	};
}

```


####### packages/kit/src/runtime/app/navigation.js #######

```

export {
	afterNavigate,
	beforeNavigate,
	disableScrollHandling,
	goto,
	invalidate,
	invalidateAll,
	onNavigate,
	preloadCode,
	preloadData,
	pushState,
	replaceState
} from '../client/client.js';

```


####### packages/kit/src/runtime/app/paths/index.js #######

```

export { base, assets } from '__sveltekit/paths';
import { base } from '__sveltekit/paths';
import { resolve_route } from '../../../utils/routing.js';

/** @type {import('./types.d.ts').resolveRoute} */
export function resolveRoute(id, params) {
	return base + resolve_route(id, params);
}

```


####### packages/kit/src/runtime/app/paths/types.d.ts #######

```

/**
 * A string that matches [`config.kit.paths.base`](https://kit.svelte.dev/docs/configuration#paths).
 *
 * Example usage: `<a href="{base}/your-page">Link</a>`
 */
export let base: '' | `/${string}`;

/**
 * An absolute path that matches [`config.kit.paths.assets`](https://kit.svelte.dev/docs/configuration#paths).
 *
 * > If a value for `config.kit.paths.assets` is specified, it will be replaced with `'/_svelte_kit_assets'` during `vite dev` or `vite preview`, since the assets don't yet live at their eventual URL.
 */
export let assets: '' | `https://${string}` | `http://${string}` | '/_svelte_kit_assets';

/**
 * Populate a route ID with params to resolve a pathname.
 * @example
 * ```js
 * resolveRoute(
 *   `/blog/[slug]/[...somethingElse]`,
 *   {
 *     slug: 'hello-world',
 *     somethingElse: 'something/else'
 *   }
 * ); // `/blog/hello-world/something/else`
 * ```
 */
export function resolveRoute(id: string, params: Record<string, string | undefined>): string;

```


####### packages/kit/src/runtime/app/server/index.js #######

```

import { read_implementation, manifest } from '__sveltekit/server';
import { base } from '__sveltekit/paths';
import { DEV } from 'esm-env';
import { b64_decode } from '../../utils.js';

/**
 * Read the contents of an imported asset from the filesystem
 * @example
 * ```js
 * import { read } from '$app/server';
 * import somefile from './somefile.txt';
 *
 * const asset = read(somefile);
 * const text = await asset.text();
 * ```
 * @param {string} asset
 * @returns {Response}
 * @since 2.4.0
 */
export function read(asset) {
	__SVELTEKIT_TRACK__('$app/server:read');

	if (!read_implementation) {
		throw new Error(
			'No `read` implementation was provided. Please ensure that your adapter is up to date and supports this feature'
		);
	}

	// handle inline assets internally
	if (asset.startsWith('data:')) {
		const [prelude, data] = asset.split(';');
		const type = prelude.slice(5) || 'application/octet-stream';

		if (data.startsWith('base64,')) {
			const decoded = b64_decode(data.slice(7));

			return new Response(decoded, {
				headers: {
					'Content-Length': decoded.byteLength.toString(),
					'Content-Type': type
				}
			});
		}

		const decoded = decodeURIComponent(data);

		return new Response(decoded, {
			headers: {
				'Content-Length': decoded.length.toString(),
				'Content-Type': type
			}
		});
	}

	const file = DEV && asset.startsWith('/@fs') ? asset : asset.slice(base.length + 1);

	if (file in manifest._.server_assets) {
		const length = manifest._.server_assets[file];
		const type = manifest.mimeTypes[file.slice(file.lastIndexOf('.'))];

		return new Response(read_implementation(file), {
			headers: {
				'Content-Length': '' + length,
				'Content-Type': type
			}
		});
	}

	throw new Error(`Asset does not exist: ${file}`);
}

```


####### packages/kit/src/runtime/app/stores.js #######

```

import { getContext } from 'svelte';
import { BROWSER } from 'esm-env';
import { stores as browser_stores } from '../client/client.js';

/**
 * A function that returns all of the contextual stores. On the server, this must be called during component initialization.
 * Only use this if you need to defer store subscription until after the component has mounted, for some reason.
 */
export const getStores = () => {
	const stores = BROWSER ? browser_stores : getContext('__svelte__');

	return {
		/** @type {typeof page} */
		page: {
			subscribe: stores.page.subscribe
		},
		/** @type {typeof navigating} */
		navigating: {
			subscribe: stores.navigating.subscribe
		},
		/** @type {typeof updated} */
		updated: stores.updated
	};
};

/**
 * A readable store whose value contains page data.
 *
 * On the server, this store can only be subscribed to during component initialization. In the browser, it can be subscribed to at any time.
 *
 * @type {import('svelte/store').Readable<import('@sveltejs/kit').Page>}
 */
export const page = {
	subscribe(fn) {
		const store = __SVELTEKIT_DEV__ ? get_store('page') : getStores().page;
		return store.subscribe(fn);
	}
};

/**
 * A readable store.
 * When navigating starts, its value is a `Navigation` object with `from`, `to`, `type` and (if `type === 'popstate'`) `delta` properties.
 * When navigating finishes, its value reverts to `null`.
 *
 * On the server, this store can only be subscribed to during component initialization. In the browser, it can be subscribed to at any time.
 * @type {import('svelte/store').Readable<import('@sveltejs/kit').Navigation | null>}
 */
export const navigating = {
	subscribe(fn) {
		const store = __SVELTEKIT_DEV__ ? get_store('navigating') : getStores().navigating;
		return store.subscribe(fn);
	}
};

/**
 * A readable store whose initial value is `false`. If [`version.pollInterval`](https://kit.svelte.dev/docs/configuration#version) is a non-zero value, SvelteKit will poll for new versions of the app and update the store value to `true` when it detects one. `updated.check()` will force an immediate check, regardless of polling.
 *
 * On the server, this store can only be subscribed to during component initialization. In the browser, it can be subscribed to at any time.
 * @type {import('svelte/store').Readable<boolean> & { check(): Promise<boolean> }}
 */
export const updated = {
	subscribe(fn) {
		const store = __SVELTEKIT_DEV__ ? get_store('updated') : getStores().updated;

		if (BROWSER) {
			updated.check = store.check;
		}

		return store.subscribe(fn);
	},
	check: () => {
		throw new Error(
			BROWSER
				? 'Cannot check updated store before subscribing'
				: 'Can only check updated store in browser'
		);
	}
};

/**
 * @template {keyof ReturnType<typeof getStores>} Name
 * @param {Name} name
 * @returns {ReturnType<typeof getStores>[Name]}
 */
function get_store(name) {
	try {
		return getStores()[name];
	} catch (e) {
		throw new Error(
			`Cannot subscribe to '${name}' store on the server outside of a Svelte component, as it is bound to the current request via component context. This prevents state from leaking between users.` +
				'For more information, see https://kit.svelte.dev/docs/state-management#avoid-shared-state-on-the-server'
		);
	}
}

```


####### packages/kit/src/runtime/client/client.js #######

```

import { BROWSER, DEV } from 'esm-env';
import { onMount, tick } from 'svelte';
import {
	add_data_suffix,
	decode_params,
	decode_pathname,
	strip_hash,
	make_trackable,
	normalize_path
} from '../../utils/url.js';
import {
	initial_fetch,
	lock_fetch,
	native_fetch,
	subsequent_fetch,
	unlock_fetch
} from './fetcher.js';
import { parse } from './parse.js';
import * as storage from './session-storage.js';
import {
	find_anchor,
	resolve_url,
	get_link_info,
	get_router_options,
	is_external_url,
	origin,
	scroll_state,
	notifiable_store,
	create_updated_store
} from './utils.js';
import { base } from '__sveltekit/paths';
import * as devalue from 'devalue';
import {
	HISTORY_INDEX,
	NAVIGATION_INDEX,
	PRELOAD_PRIORITIES,
	SCROLL_KEY,
	STATES_KEY,
	SNAPSHOT_KEY,
	PAGE_URL_KEY
} from './constants.js';
import { validate_page_exports } from '../../utils/exports.js';
import { compact } from '../../utils/array.js';
import { HttpError, Redirect, SvelteKitError } from '../control.js';
import { INVALIDATED_PARAM, TRAILING_SLASH_PARAM, validate_depends } from '../shared.js';
import { get_message, get_status } from '../../utils/error.js';
import { writable } from 'svelte/store';

let errored = false;

// We track the scroll position associated with each history entry in sessionStorage,
// rather than on history.state itself, because when navigation is driven by
// popstate it's too late to update the scroll position associated with the
// state we're navigating from
/**
 * history index -> { x, y }
 * @type {Record<number, { x: number; y: number }>}
 */
const scroll_positions = storage.get(SCROLL_KEY) ?? {};

/**
 * navigation index -> any
 * @type {Record<string, any[]>}
 */
const snapshots = storage.get(SNAPSHOT_KEY) ?? {};

if (DEV && BROWSER) {
	let warned = false;

	const current_module_url = import.meta.url.split('?')[0]; // remove query params that vite adds to the URL when it is loaded from node_modules

	const warn = () => {
		if (warned) return;

		// Rather than saving a pointer to the original history methods, which would prevent monkeypatching by other libs,
		// inspect the stack trace to see if we're being called from within SvelteKit.
		let stack = new Error().stack?.split('\n');
		if (!stack) return;
		if (!stack[0].includes('https:') && !stack[0].includes('http:')) stack = stack.slice(1); // Chrome includes the error message in the stack
		stack = stack.slice(2); // remove `warn` and the place where `warn` was called
		// Can be falsy if was called directly from an anonymous function
		if (stack[0]?.includes(current_module_url)) return;

		warned = true;

		console.warn(
			"Avoid using `history.pushState(...)` and `history.replaceState(...)` as these will conflict with SvelteKit's router. Use the `pushState` and `replaceState` imports from `$app/navigation` instead."
		);
	};

	const push_state = history.pushState;
	history.pushState = (...args) => {
		warn();
		return push_state.apply(history, args);
	};

	const replace_state = history.replaceState;
	history.replaceState = (...args) => {
		warn();
		return replace_state.apply(history, args);
	};
}

export const stores = {
	url: /* @__PURE__ */ notifiable_store({}),
	page: /* @__PURE__ */ notifiable_store({}),
	navigating: /* @__PURE__ */ writable(
		/** @type {import('@sveltejs/kit').Navigation | null} */ (null)
	),
	updated: /* @__PURE__ */ create_updated_store()
};

/** @param {number} index */
function update_scroll_positions(index) {
	scroll_positions[index] = scroll_state();
}

/**
 * @param {number} current_history_index
 * @param {number} current_navigation_index
 */
function clear_onward_history(current_history_index, current_navigation_index) {
	// if we navigated back, then pushed a new state, we can
	// release memory by pruning the scroll/snapshot lookup
	let i = current_history_index + 1;
	while (scroll_positions[i]) {
		delete scroll_positions[i];
		i += 1;
	}

	i = current_navigation_index + 1;
	while (snapshots[i]) {
		delete snapshots[i];
		i += 1;
	}
}

/**
 * Loads `href` the old-fashioned way, with a full page reload.
 * Returns a `Promise` that never resolves (to prevent any
 * subsequent work, e.g. history manipulation, from happening)
 * @param {URL} url
 */
function native_navigation(url) {
	location.href = url.href;
	return new Promise(() => {});
}

function noop() {}

/** @type {import('types').CSRRoute[]} */
let routes;
/** @type {import('types').CSRPageNodeLoader} */
let default_layout_loader;
/** @type {import('types').CSRPageNodeLoader} */
let default_error_loader;
/** @type {HTMLElement} */
let container;
/** @type {HTMLElement} */
let target;
/** @type {import('./types.js').SvelteKitApp} */
let app;

/** @type {Array<((url: URL) => boolean)>} */
const invalidated = [];

/**
 * An array of the `+layout.svelte` and `+page.svelte` component instances
 * that currently live on the page — used for capturing and restoring snapshots.
 * It's updated/manipulated through `bind:this` in `Root.svelte`.
 * @type {import('svelte').SvelteComponent[]}
 */
const components = [];

/** @type {{id: string, token: {}, promise: Promise<import('./types.js').NavigationResult>} | null} */
let load_cache = null;

/** @type {Array<(navigation: import('@sveltejs/kit').BeforeNavigate) => void>} */
const before_navigate_callbacks = [];

/** @type {Array<(navigation: import('@sveltejs/kit').OnNavigate) => import('types').MaybePromise<(() => void) | void>>} */
const on_navigate_callbacks = [];

/** @type {Array<(navigation: import('@sveltejs/kit').AfterNavigate) => void>} */
let after_navigate_callbacks = [];

/** @type {import('./types.js').NavigationState} */
let current = {
	branch: [],
	error: null,
	// @ts-ignore - we need the initial value to be null
	url: null
};

/** this being true means we SSR'd */
let hydrated = false;
let started = false;
let autoscroll = true;
let updating = false;
let navigating = false;
let hash_navigating = false;
/** True as soon as there happened one client-side navigation (excluding the SvelteKit-initialized initial one when in SPA mode) */
let has_navigated = false;

let force_invalidation = false;

/** @type {import('svelte').SvelteComponent} */
let root;

/** @type {number} keeping track of the history index in order to prevent popstate navigation events if needed */
let current_history_index;

/** @type {number} */
let current_navigation_index;

/** @type {import('@sveltejs/kit').Page} */
let page;

/** @type {{}} */
let token;

/**
 * A set of tokens which are associated to current preloads.
 * If a preload becomes a real navigation, it's removed from the set.
 * If a preload token is in the set and the preload errors, the error
 * handling logic (for example reloading) is skipped.
 */
const preload_tokens = new Set();

/** @type {Promise<void> | null} */
let pending_invalidate;

/**
 * @param {import('./types.js').SvelteKitApp} _app
 * @param {HTMLElement} _target
 * @param {Parameters<typeof _hydrate>[1]} [hydrate]
 */
export async function start(_app, _target, hydrate) {
	if (DEV && _target === document.body) {
		console.warn(
			'Placing %sveltekit.body% directly inside <body> is not recommended, as your app may break for users who have certain browser extensions installed.\n\nConsider wrapping it in an element:\n\n<div style="display: contents">\n  %sveltekit.body%\n</div>'
		);
	}

	// detect basic auth credentials in the current URL
	// https://github.com/sveltejs/kit/pull/11179
	// if so, refresh the page without credentials
	if (document.URL !== location.href) {
		// eslint-disable-next-line no-self-assign
		location.href = location.href;
	}

	app = _app;
	routes = parse(_app);
	container = __SVELTEKIT_EMBEDDED__ ? _target : document.documentElement;
	target = _target;

	// we import the root layout/error nodes eagerly, so that
	// connectivity errors after initialisation don't nuke the app
	default_layout_loader = _app.nodes[0];
	default_error_loader = _app.nodes[1];
	default_layout_loader();
	default_error_loader();

	current_history_index = history.state?.[HISTORY_INDEX];
	current_navigation_index = history.state?.[NAVIGATION_INDEX];

	if (!current_history_index) {
		// we use Date.now() as an offset so that cross-document navigations
		// within the app don't result in data loss
		current_history_index = current_navigation_index = Date.now();

		// create initial history entry, so we can return here
		history.replaceState(
			{
				...history.state,
				[HISTORY_INDEX]: current_history_index,
				[NAVIGATION_INDEX]: current_navigation_index
			},
			''
		);
	}

	// if we reload the page, or Cmd-Shift-T back to it,
	// recover scroll position
	const scroll = scroll_positions[current_history_index];
	if (scroll) {
		history.scrollRestoration = 'manual';
		scrollTo(scroll.x, scroll.y);
	}

	if (hydrate) {
		await _hydrate(target, hydrate);
	} else {
		goto(location.href, { replaceState: true });
	}

	_start_router();
}

async function _invalidate() {
	// Accept all invalidations as they come, don't swallow any while another invalidation
	// is running because subsequent invalidations may make earlier ones outdated,
	// but batch multiple synchronous invalidations.
	await (pending_invalidate ||= Promise.resolve());
	if (!pending_invalidate) return;
	pending_invalidate = null;

	const intent = get_navigation_intent(current.url, true);

	// Clear preload, it might be affected by the invalidation.
	// Also solves an edge case where a preload is triggered, the navigation for it
	// was then triggered and is still running while the invalidation kicks in,
	// at which point the invalidation should take over and "win".
	load_cache = null;

	const nav_token = (token = {});
	const navigation_result = intent && (await load_route(intent));
	if (!navigation_result || nav_token !== token) return;

	if (navigation_result.type === 'redirect') {
		return _goto(new URL(navigation_result.location, current.url).href, {}, 1, nav_token);
	}

	if (navigation_result.props.page) {
		page = navigation_result.props.page;
	}
	current = navigation_result.state;
	reset_invalidation();
	root.$set(navigation_result.props);
}

function reset_invalidation() {
	invalidated.length = 0;
	force_invalidation = false;
}

/** @param {number} index */
function capture_snapshot(index) {
	if (components.some((c) => c?.snapshot)) {
		snapshots[index] = components.map((c) => c?.snapshot?.capture());
	}
}

/** @param {number} index */
function restore_snapshot(index) {
	snapshots[index]?.forEach((value, i) => {
		components[i]?.snapshot?.restore(value);
	});
}

function persist_state() {
	update_scroll_positions(current_history_index);
	storage.set(SCROLL_KEY, scroll_positions);

	capture_snapshot(current_navigation_index);
	storage.set(SNAPSHOT_KEY, snapshots);
}

/**
 * @param {string | URL} url
 * @param {{ replaceState?: boolean; noScroll?: boolean; keepFocus?: boolean; invalidateAll?: boolean; state?: Record<string, any> }} options
 * @param {number} redirect_count
 * @param {{}} [nav_token]
 */
async function _goto(url, options, redirect_count, nav_token) {
	return navigate({
		type: 'goto',
		url: resolve_url(url),
		keepfocus: options.keepFocus,
		noscroll: options.noScroll,
		replace_state: options.replaceState,
		state: options.state,
		redirect_count,
		nav_token,
		accept: () => {
			if (options.invalidateAll) {
				force_invalidation = true;
			}
		}
	});
}

/** @param {import('./types.js').NavigationIntent} intent */
async function _preload_data(intent) {
	// Reuse the existing pending preload if it's for the same navigation.
	// Prevents an edge case where same preload is triggered multiple times,
	// then a later one is becoming the real navigation and the preload tokens
	// get out of sync.
	if (intent.id !== load_cache?.id) {
		const preload = {};
		preload_tokens.add(preload);
		load_cache = {
			id: intent.id,
			token: preload,
			promise: load_route({ ...intent, preload }).then((result) => {
				preload_tokens.delete(preload);
				if (result.type === 'loaded' && result.state.error) {
					// Don't cache errors, because they might be transient
					load_cache = null;
				}
				return result;
			})
		};
	}

	return load_cache.promise;
}

/** @param {string} pathname */
async function _preload_code(pathname) {
	const route = routes.find((route) => route.exec(get_url_path(pathname)));

	if (route) {
		await Promise.all([...route.layouts, route.leaf].map((load) => load?.[1]()));
	}
}

/**
 * @param {import('./types.js').NavigationFinished} result
 * @param {HTMLElement} target
 * @param {boolean} hydrate
 */
function initialize(result, target, hydrate) {
	if (DEV && result.state.error && document.querySelector('vite-error-overlay')) return;

	current = result.state;

	const style = document.querySelector('style[data-sveltekit]');
	if (style) style.remove();

	page = /** @type {import('@sveltejs/kit').Page} */ (result.props.page);

	root = new app.root({
		target,
		props: { ...result.props, stores, components },
		hydrate
	});

	restore_snapshot(current_navigation_index);

	/** @type {import('@sveltejs/kit').AfterNavigate} */
	const navigation = {
		from: null,
		to: {
			params: current.params,
			route: { id: current.route?.id ?? null },
			url: new URL(location.href)
		},
		willUnload: false,
		type: 'enter',
		complete: Promise.resolve()
	};

	after_navigate_callbacks.forEach((fn) => fn(navigation));

	started = true;
}

/**
 *
 * @param {{
 *   url: URL;
 *   params: Record<string, string>;
 *   branch: Array<import('./types.js').BranchNode | undefined>;
 *   status: number;
 *   error: App.Error | null;
 *   route: import('types').CSRRoute | null;
 *   form?: Record<string, any> | null;
 * }} opts
 */
async function get_navigation_result_from_branch({
	url,
	params,
	branch,
	status,
	error,
	route,
	form
}) {
	/** @type {import('types').TrailingSlash} */
	let slash = 'never';

	// if `paths.base === '/a/b/c`, then the root route is always `/a/b/c/`, regardless of
	// the `trailingSlash` route option, so that relative paths to JS and CSS work
	if (base && (url.pathname === base || url.pathname === base + '/')) {
		slash = 'always';
	} else {
		for (const node of branch) {
			if (node?.slash !== undefined) slash = node.slash;
		}
	}

	url.pathname = normalize_path(url.pathname, slash);

	// eslint-disable-next-line
	url.search = url.search; // turn `/?` into `/`

	/** @type {import('./types.js').NavigationFinished} */
	const result = {
		type: 'loaded',
		state: {
			url,
			params,
			branch,
			error,
			route
		},
		props: {
			// @ts-ignore Somehow it's getting SvelteComponent and SvelteComponentDev mixed up
			constructors: compact(branch).map((branch_node) => branch_node.node.component),
			page
		}
	};

	if (form !== undefined) {
		result.props.form = form;
	}

	let data = {};
	let data_changed = !page;

	let p = 0;

	for (let i = 0; i < Math.max(branch.length, current.branch.length); i += 1) {
		const node = branch[i];
		const prev = current.branch[i];

		if (node?.data !== prev?.data) data_changed = true;
		if (!node) continue;

		data = { ...data, ...node.data };

		// Only set props if the node actually updated. This prevents needless rerenders.
		if (data_changed) {
			result.props[`data_${p}`] = data;
		}

		p += 1;
	}

	const page_changed =
		!current.url ||
		url.href !== current.url.href ||
		current.error !== error ||
		(form !== undefined && form !== page.form) ||
		data_changed;

	if (page_changed) {
		result.props.page = {
			error,
			params,
			route: {
				id: route?.id ?? null
			},
			state: {},
			status,
			url: new URL(url),
			form: form ?? null,
			// The whole page store is updated, but this way the object reference stays the same
			data: data_changed ? data : page.data
		};
	}

	return result;
}

/**
 * Call the load function of the given node, if it exists.
 * If `server_data` is passed, this is treated as the initial run and the page endpoint is not requested.
 *
 * @param {{
 *   loader: import('types').CSRPageNodeLoader;
 * 	 parent: () => Promise<Record<string, any>>;
 *   url: URL;
 *   params: Record<string, string>;
 *   route: { id: string | null };
 * 	 server_data_node: import('./types.js').DataNode | null;
 * }} options
 * @returns {Promise<import('./types.js').BranchNode>}
 */
async function load_node({ loader, parent, url, params, route, server_data_node }) {
	/** @type {Record<string, any> | null} */
	let data = null;

	let is_tracking = true;

	/** @type {import('types').Uses} */
	const uses = {
		dependencies: new Set(),
		params: new Set(),
		parent: false,
		route: false,
		url: false,
		search_params: new Set()
	};

	const node = await loader();

	if (DEV) {
		validate_page_exports(node.universal);
	}

	if (node.universal?.load) {
		/** @param {string[]} deps */
		function depends(...deps) {
			for (const dep of deps) {
				if (DEV) validate_depends(/** @type {string} */ (route.id), dep);

				const { href } = new URL(dep, url);
				uses.dependencies.add(href);
			}
		}

		/** @type {import('@sveltejs/kit').LoadEvent} */
		const load_input = {
			route: new Proxy(route, {
				get: (target, key) => {
					if (is_tracking) {
						uses.route = true;
					}
					return target[/** @type {'id'} */ (key)];
				}
			}),
			params: new Proxy(params, {
				get: (target, key) => {
					if (is_tracking) {
						uses.params.add(/** @type {string} */ (key));
					}
					return target[/** @type {string} */ (key)];
				}
			}),
			data: server_data_node?.data ?? null,
			url: make_trackable(
				url,
				() => {
					if (is_tracking) {
						uses.url = true;
					}
				},
				(param) => {
					if (is_tracking) {
						uses.search_params.add(param);
					}
				}
			),
			async fetch(resource, init) {
				/** @type {URL | string} */
				let requested;

				if (resource instanceof Request) {
					requested = resource.url;

					// we're not allowed to modify the received `Request` object, so in order
					// to fixup relative urls we create a new equivalent `init` object instead
					init = {
						// the request body must be consumed in memory until browsers
						// implement streaming request bodies and/or the body getter
						body:
							resource.method === 'GET' || resource.method === 'HEAD'
								? undefined
								: await resource.blob(),
						cache: resource.cache,
						credentials: resource.credentials,
						headers: resource.headers,
						integrity: resource.integrity,
						keepalive: resource.keepalive,
						method: resource.method,
						mode: resource.mode,
						redirect: resource.redirect,
						referrer: resource.referrer,
						referrerPolicy: resource.referrerPolicy,
						signal: resource.signal,
						...init
					};
				} else {
					requested = resource;
				}

				// we must fixup relative urls so they are resolved from the target page
				const resolved = new URL(requested, url);
				if (is_tracking) {
					depends(resolved.href);
				}

				// match ssr serialized data url, which is important to find cached responses
				if (resolved.origin === url.origin) {
					requested = resolved.href.slice(url.origin.length);
				}

				// prerendered pages may be served from any origin, so `initial_fetch` urls shouldn't be resolved
				return started
					? subsequent_fetch(requested, resolved.href, init)
					: initial_fetch(requested, init);
			},
			setHeaders: () => {}, // noop
			depends,
			parent() {
				if (is_tracking) {
					uses.parent = true;
				}
				return parent();
			},
			untrack(fn) {
				is_tracking = false;
				try {
					return fn();
				} finally {
					is_tracking = true;
				}
			}
		};

		if (DEV) {
			try {
				lock_fetch();
				data = (await node.universal.load.call(null, load_input)) ?? null;
				if (data != null && Object.getPrototypeOf(data) !== Object.prototype) {
					throw new Error(
						`a load function related to route '${route.id}' returned ${
							typeof data !== 'object'
								? `a ${typeof data}`
								: data instanceof Response
									? 'a Response object'
									: Array.isArray(data)
										? 'an array'
										: 'a non-plain object'
						}, but must return a plain object at the top level (i.e. \`return {...}\`)`
					);
				}
			} finally {
				unlock_fetch();
			}
		} else {
			data = (await node.universal.load.call(null, load_input)) ?? null;
		}
	}

	return {
		node,
		loader,
		server: server_data_node,
		universal: node.universal?.load ? { type: 'data', data, uses } : null,
		data: data ?? server_data_node?.data ?? null,
		slash: node.universal?.trailingSlash ?? server_data_node?.slash
	};
}

/**
 * @param {boolean} parent_changed
 * @param {boolean} route_changed
 * @param {boolean} url_changed
 * @param {Set<string>} search_params_changed
 * @param {import('types').Uses | undefined} uses
 * @param {Record<string, string>} params
 */
function has_changed(
	parent_changed,
	route_changed,
	url_changed,
	search_params_changed,
	uses,
	params
) {
	if (force_invalidation) return true;

	if (!uses) return false;

	if (uses.parent && parent_changed) return true;
	if (uses.route && route_changed) return true;
	if (uses.url && url_changed) return true;

	for (const tracked_params of uses.search_params) {
		if (search_params_changed.has(tracked_params)) return true;
	}

	for (const param of uses.params) {
		if (params[param] !== current.params[param]) return true;
	}

	for (const href of uses.dependencies) {
		if (invalidated.some((fn) => fn(new URL(href)))) return true;
	}

	return false;
}

/**
 * @param {import('types').ServerDataNode | import('types').ServerDataSkippedNode | null} node
 * @param {import('./types.js').DataNode | null} [previous]
 * @returns {import('./types.js').DataNode | null}
 */
function create_data_node(node, previous) {
	if (node?.type === 'data') return node;
	if (node?.type === 'skip') return previous ?? null;
	return null;
}

/**
 *
 * @param {URL | null} old_url
 * @param {URL} new_url
 */
function diff_search_params(old_url, new_url) {
	if (!old_url) return new Set(new_url.searchParams.keys());

	const changed = new Set([...old_url.searchParams.keys(), ...new_url.searchParams.keys()]);

	for (const key of changed) {
		const old_values = old_url.searchParams.getAll(key);
		const new_values = new_url.searchParams.getAll(key);

		if (
			old_values.every((value) => new_values.includes(value)) &&
			new_values.every((value) => old_values.includes(value))
		) {
			changed.delete(key);
		}
	}

	return changed;
}

/**
 * @param {Omit<import('./types.js').NavigationFinished['state'], 'branch'> & { error: App.Error }} opts
 * @returns {import('./types.js').NavigationFinished}
 */
function preload_error({ error, url, route, params }) {
	return {
		type: 'loaded',
		state: {
			error,
			url,
			route,
			params,
			branch: []
		},
		props: { page, constructors: [] }
	};
}

/**
 * @param {import('./types.js').NavigationIntent & { preload?: {} }} intent
 * @returns {Promise<import('./types.js').NavigationResult>}
 */
async function load_route({ id, invalidating, url, params, route, preload }) {
	if (load_cache?.id === id) {
		// the preload becomes the real navigation
		preload_tokens.delete(load_cache.token);
		return load_cache.promise;
	}

	const { errors, layouts, leaf } = route;

	const loaders = [...layouts, leaf];

	// preload modules to avoid waterfall, but handle rejections
	// so they don't get reported to Sentry et al (we don't need
	// to act on the failures at this point)
	errors.forEach((loader) => loader?.().catch(() => {}));
	loaders.forEach((loader) => loader?.[1]().catch(() => {}));

	/** @type {import('types').ServerNodesResponse | import('types').ServerRedirectNode | null} */
	let server_data = null;
	const url_changed = current.url ? id !== current.url.pathname + current.url.search : false;
	const route_changed = current.route ? route.id !== current.route.id : false;
	const search_params_changed = diff_search_params(current.url, url);

	let parent_invalid = false;
	const invalid_server_nodes = loaders.map((loader, i) => {
		const previous = current.branch[i];

		const invalid =
			!!loader?.[0] &&
			(previous?.loader !== loader[1] ||
				has_changed(
					parent_invalid,
					route_changed,
					url_changed,
					search_params_changed,
					previous.server?.uses,
					params
				));

		if (invalid) {
			// For the next one
			parent_invalid = true;
		}

		return invalid;
	});

	if (invalid_server_nodes.some(Boolean)) {
		try {
			server_data = await load_data(url, invalid_server_nodes);
		} catch (error) {
			const handled_error = await handle_error(error, { url, params, route: { id } });

			if (preload_tokens.has(preload)) {
				return preload_error({ error: handled_error, url, params, route });
			}

			return load_root_error_page({
				status: get_status(error),
				error: handled_error,
				url,
				route
			});
		}

		if (server_data.type === 'redirect') {
			return server_data;
		}
	}

	const server_data_nodes = server_data?.nodes;

	let parent_changed = false;

	const branch_promises = loaders.map(async (loader, i) => {
		if (!loader) return;

		/** @type {import('./types.js').BranchNode | undefined} */
		const previous = current.branch[i];

		const server_data_node = server_data_nodes?.[i];

		// re-use data from previous load if it's still valid
		const valid =
			(!server_data_node || server_data_node.type === 'skip') &&
			loader[1] === previous?.loader &&
			!has_changed(
				parent_changed,
				route_changed,
				url_changed,
				search_params_changed,
				previous.universal?.uses,
				params
			);
		if (valid) return previous;

		parent_changed = true;

		if (server_data_node?.type === 'error') {
			// rethrow and catch below
			throw server_data_node;
		}

		return load_node({
			loader: loader[1],
			url,
			params,
			route,
			parent: async () => {
				const data = {};
				for (let j = 0; j < i; j += 1) {
					Object.assign(data, (await branch_promises[j])?.data);
				}
				return data;
			},
			server_data_node: create_data_node(
				// server_data_node is undefined if it wasn't reloaded from the server;
				// and if current loader uses server data, we want to reuse previous data.
				server_data_node === undefined && loader[0] ? { type: 'skip' } : server_data_node ?? null,
				loader[0] ? previous?.server : undefined
			)
		});
	});

	// if we don't do this, rejections will be unhandled
	for (const p of branch_promises) p.catch(() => {});

	/** @type {Array<import('./types.js').BranchNode | undefined>} */
	const branch = [];

	for (let i = 0; i < loaders.length; i += 1) {
		if (loaders[i]) {
			try {
				branch.push(await branch_promises[i]);
			} catch (err) {
				if (err instanceof Redirect) {
					return {
						type: 'redirect',
						location: err.location
					};
				}

				if (preload_tokens.has(preload)) {
					return preload_error({
						error: await handle_error(err, { params, url, route: { id: route.id } }),
						url,
						params,
						route
					});
				}

				let status = get_status(err);
				/** @type {App.Error} */
				let error;

				if (server_data_nodes?.includes(/** @type {import('types').ServerErrorNode} */ (err))) {
					// this is the server error rethrown above, reconstruct but don't invoke
					// the client error handler; it should've already been handled on the server
					status = /** @type {import('types').ServerErrorNode} */ (err).status ?? status;
					error = /** @type {import('types').ServerErrorNode} */ (err).error;
				} else if (err instanceof HttpError) {
					error = err.body;
				} else {
					// Referenced node could have been removed due to redeploy, check
					const updated = await stores.updated.check();
					if (updated) {
						return await native_navigation(url);
					}

					error = await handle_error(err, { params, url, route: { id: route.id } });
				}

				const error_load = await load_nearest_error_page(i, branch, errors);
				if (error_load) {
					return await get_navigation_result_from_branch({
						url,
						params,
						branch: branch.slice(0, error_load.idx).concat(error_load.node),
						status,
						error,
						route
					});
				} else {
					return await server_fallback(url, { id: route.id }, error, status);
				}
			}
		} else {
			// push an empty slot so we can rewind past gaps to the
			// layout that corresponds with an +error.svelte page
			branch.push(undefined);
		}
	}

	return await get_navigation_result_from_branch({
		url,
		params,
		branch,
		status: 200,
		error: null,
		route,
		// Reset `form` on navigation, but not invalidation
		form: invalidating ? undefined : null
	});
}

/**
 * @param {number} i Start index to backtrack from
 * @param {Array<import('./types.js').BranchNode | undefined>} branch Branch to backtrack
 * @param {Array<import('types').CSRPageNodeLoader | undefined>} errors All error pages for this branch
 * @returns {Promise<{idx: number; node: import('./types.js').BranchNode} | undefined>}
 */
async function load_nearest_error_page(i, branch, errors) {
	while (i--) {
		if (errors[i]) {
			let j = i;
			while (!branch[j]) j -= 1;
			try {
				return {
					idx: j + 1,
					node: {
						node: await /** @type {import('types').CSRPageNodeLoader } */ (errors[i])(),
						loader: /** @type {import('types').CSRPageNodeLoader } */ (errors[i]),
						data: {},
						server: null,
						universal: null
					}
				};
			} catch (e) {
				continue;
			}
		}
	}
}

/**
 * @param {{
 *   status: number;
 *   error: App.Error;
 *   url: URL;
 *   route: { id: string | null }
 * }} opts
 * @returns {Promise<import('./types.js').NavigationFinished>}
 */
async function load_root_error_page({ status, error, url, route }) {
	/** @type {Record<string, string>} */
	const params = {}; // error page does not have params

	/** @type {import('types').ServerDataNode | null} */
	let server_data_node = null;

	const default_layout_has_server_load = app.server_loads[0] === 0;

	if (default_layout_has_server_load) {
		// TODO post-https://github.com/sveltejs/kit/discussions/6124 we can use
		// existing root layout data
		try {
			const server_data = await load_data(url, [true]);

			if (
				server_data.type !== 'data' ||
				(server_data.nodes[0] && server_data.nodes[0].type !== 'data')
			) {
				throw 0;
			}

			server_data_node = server_data.nodes[0] ?? null;
		} catch {
			// at this point we have no choice but to fall back to the server, if it wouldn't
			// bring us right back here, turning this into an endless loop
			if (url.origin !== origin || url.pathname !== location.pathname || hydrated) {
				await native_navigation(url);
			}
		}
	}

	const root_layout = await load_node({
		loader: default_layout_loader,
		url,
		params,
		route,
		parent: () => Promise.resolve({}),
		server_data_node: create_data_node(server_data_node)
	});

	/** @type {import('./types.js').BranchNode} */
	const root_error = {
		node: await default_error_loader(),
		loader: default_error_loader,
		universal: null,
		server: null,
		data: null
	};

	return await get_navigation_result_from_branch({
		url,
		params,
		branch: [root_layout, root_error],
		status,
		error,
		route: null
	});
}

/**
 * Resolve the full info (which route, params, etc.) for a client-side navigation from the URL,
 * taking the reroute hook into account. If this isn't a client-side-navigation (or the URL is undefined),
 * returns undefined.
 * @param {URL | undefined} url
 * @param {boolean} invalidating
 */
function get_navigation_intent(url, invalidating) {
	if (!url) return undefined;
	if (is_external_url(url, base)) return;

	// reroute could alter the given URL, so we pass a copy
	let rerouted;
	try {
		rerouted = app.hooks.reroute({ url: new URL(url) }) ?? url.pathname;
	} catch (e) {
		if (DEV) {
			// in development, print the error...
			console.error(e);

			// ...and pause execution, since otherwise we will immediately reload the page
			debugger; // eslint-disable-line
		}

		// fall back to native navigation
		return undefined;
	}

	const path = get_url_path(rerouted);

	for (const route of routes) {
		const params = route.exec(path);

		if (params) {
			const id = url.pathname + url.search;
			/** @type {import('./types.js').NavigationIntent} */
			const intent = {
				id,
				invalidating,
				route,
				params: decode_params(params),
				url
			};
			return intent;
		}
	}
}

/** @param {string} pathname */
function get_url_path(pathname) {
	return decode_pathname(pathname.slice(base.length) || '/');
}

/**
 * @param {{
 *   url: URL;
 *   type: import('@sveltejs/kit').Navigation["type"];
 *   intent?: import('./types.js').NavigationIntent;
 *   delta?: number;
 * }} opts
 */
function _before_navigate({ url, type, intent, delta }) {
	let should_block = false;

	const nav = create_navigation(current, intent, url, type);

	if (delta !== undefined) {
		nav.navigation.delta = delta;
	}

	const cancellable = {
		...nav.navigation,
		cancel: () => {
			should_block = true;
			nav.reject(new Error('navigation cancelled'));
		}
	};

	if (!navigating) {
		// Don't run the event during redirects
		before_navigate_callbacks.forEach((fn) => fn(cancellable));
	}

	return should_block ? null : nav;
}

/**
 * @param {{
 *   type: import('@sveltejs/kit').Navigation["type"];
 *   url: URL;
 *   popped?: {
 *     state: Record<string, any>;
 *     scroll: { x: number, y: number };
 *     delta: number;
 *   };
 *   keepfocus?: boolean;
 *   noscroll?: boolean;
 *   replace_state?: boolean;
 *   state?: Record<string, any>;
 *   redirect_count?: number;
 *   nav_token?: {};
 *   accept?: () => void;
 *   block?: () => void;
 * }} opts
 */
async function navigate({
	type,
	url,
	popped,
	keepfocus,
	noscroll,
	replace_state,
	state = {},
	redirect_count = 0,
	nav_token = {},
	accept = noop,
	block = noop
}) {
	const intent = get_navigation_intent(url, false);
	const nav = _before_navigate({ url, type, delta: popped?.delta, intent });

	if (!nav) {
		block();
		return;
	}

	// store this before calling `accept()`, which may change the index
	const previous_history_index = current_history_index;
	const previous_navigation_index = current_navigation_index;

	accept();

	navigating = true;

	if (started) {
		stores.navigating.set(nav.navigation);
	}

	token = nav_token;
	let navigation_result = intent && (await load_route(intent));

	if (!navigation_result) {
		if (is_external_url(url, base)) {
			return await native_navigation(url);
		}
		navigation_result = await server_fallback(
			url,
			{ id: null },
			await handle_error(new SvelteKitError(404, 'Not Found', `Not found: ${url.pathname}`), {
				url,
				params: {},
				route: { id: null }
			}),
			404
		);
	}

	// if this is an internal navigation intent, use the normalized
	// URL for the rest of the function
	url = intent?.url || url;

	// abort if user navigated during update
	if (token !== nav_token) {
		nav.reject(new Error('navigation aborted'));
		return false;
	}

	if (navigation_result.type === 'redirect') {
		// whatwg fetch spec https://fetch.spec.whatwg.org/#http-redirect-fetch says to error after 20 redirects
		if (redirect_count >= 20) {
			navigation_result = await load_root_error_page({
				status: 500,
				error: await handle_error(new Error('Redirect loop'), {
					url,
					params: {},
					route: { id: null }
				}),
				url,
				route: { id: null }
			});
		} else {
			_goto(new URL(navigation_result.location, url).href, {}, redirect_count + 1, nav_token);
			return false;
		}
	} else if (/** @type {number} */ (navigation_result.props.page.status) >= 400) {
		const updated = await stores.updated.check();
		if (updated) {
			await native_navigation(url);
		}
	}

	// reset invalidation only after a finished navigation. If there are redirects or
	// additional invalidations, they should get the same invalidation treatment
	reset_invalidation();

	updating = true;

	update_scroll_positions(previous_history_index);
	capture_snapshot(previous_navigation_index);

	// ensure the url pathname matches the page's trailing slash option
	if (navigation_result.props.page.url.pathname !== url.pathname) {
		url.pathname = navigation_result.props.page.url.pathname;
	}

	state = popped ? popped.state : state;

	if (!popped) {
		// this is a new navigation, rather than a popstate
		const change = replace_state ? 0 : 1;

		const entry = {
			[HISTORY_INDEX]: (current_history_index += change),
			[NAVIGATION_INDEX]: (current_navigation_index += change),
			[STATES_KEY]: state
		};

		const fn = replace_state ? history.replaceState : history.pushState;
		fn.call(history, entry, '', url);

		if (!replace_state) {
			clear_onward_history(current_history_index, current_navigation_index);
		}
	}

	// reset preload synchronously after the history state has been set to avoid race conditions
	load_cache = null;

	navigation_result.props.page.state = state;

	if (started) {
		current = navigation_result.state;

		// reset url before updating page store
		if (navigation_result.props.page) {
			navigation_result.props.page.url = url;
		}

		const after_navigate = (
			await Promise.all(
				on_navigate_callbacks.map((fn) =>
					fn(/** @type {import('@sveltejs/kit').OnNavigate} */ (nav.navigation))
				)
			)
		).filter(/** @returns {value is () => void} */ (value) => typeof value === 'function');

		if (after_navigate.length > 0) {
			function cleanup() {
				after_navigate_callbacks = after_navigate_callbacks.filter(
					// @ts-ignore
					(fn) => !after_navigate.includes(fn)
				);
			}

			after_navigate.push(cleanup);
			after_navigate_callbacks.push(...after_navigate);
		}

		root.$set(navigation_result.props);
		has_navigated = true;
	} else {
		initialize(navigation_result, target, false);
	}

	const { activeElement } = document;

	// need to render the DOM before we can scroll to the rendered elements and do focus management
	await tick();

	// we reset scroll before dealing with focus, to avoid a flash of unscrolled content
	const scroll = popped ? popped.scroll : noscroll ? scroll_state() : null;

	if (autoscroll) {
		const deep_linked = url.hash && document.getElementById(decodeURIComponent(url.hash.slice(1)));
		if (scroll) {
			scrollTo(scroll.x, scroll.y);
		} else if (deep_linked) {
			// Here we use `scrollIntoView` on the element instead of `scrollTo`
			// because it natively supports the `scroll-margin` and `scroll-behavior`
			// CSS properties.
			deep_linked.scrollIntoView();
		} else {
			scrollTo(0, 0);
		}
	}

	const changed_focus =
		// reset focus only if any manual focus management didn't override it
		document.activeElement !== activeElement &&
		// also refocus when activeElement is body already because the
		// focus event might not have been fired on it yet
		document.activeElement !== document.body;

	if (!keepfocus && !changed_focus) {
		reset_focus();
	}

	autoscroll = true;

	if (navigation_result.props.page) {
		page = navigation_result.props.page;
	}

	navigating = false;

	if (type === 'popstate') {
		restore_snapshot(current_navigation_index);
	}

	nav.fulfil(undefined);

	after_navigate_callbacks.forEach((fn) =>
		fn(/** @type {import('@sveltejs/kit').AfterNavigate} */ (nav.navigation))
	);

	stores.navigating.set(null);

	updating = false;
}

/**
 * Does a full page reload if it wouldn't result in an endless loop in the SPA case
 * @param {URL} url
 * @param {{ id: string | null }} route
 * @param {App.Error} error
 * @param {number} status
 * @returns {Promise<import('./types.js').NavigationFinished>}
 */
async function server_fallback(url, route, error, status) {
	if (url.origin === origin && url.pathname === location.pathname && !hydrated) {
		// We would reload the same page we're currently on, which isn't hydrated,
		// which means no SSR, which means we would end up in an endless loop
		return await load_root_error_page({
			status,
			error,
			url,
			route
		});
	}

	if (DEV && status !== 404) {
		console.error(
			'An error occurred while loading the page. This will cause a full page reload. (This message will only appear during development.)'
		);

		debugger; // eslint-disable-line
	}

	return await native_navigation(url);
}

if (import.meta.hot) {
	import.meta.hot.on('vite:beforeUpdate', () => {
		if (current.error) location.reload();
	});
}

function setup_preload() {
	/** @type {NodeJS.Timeout} */
	let mousemove_timeout;

	container.addEventListener('mousemove', (event) => {
		const target = /** @type {Element} */ (event.target);

		clearTimeout(mousemove_timeout);
		mousemove_timeout = setTimeout(() => {
			preload(target, 2);
		}, 20);
	});

	/** @param {Event} event */
	function tap(event) {
		preload(/** @type {Element} */ (event.composedPath()[0]), 1);
	}

	container.addEventListener('mousedown', tap);
	container.addEventListener('touchstart', tap, { passive: true });

	const observer = new IntersectionObserver(
		(entries) => {
			for (const entry of entries) {
				if (entry.isIntersecting) {
					_preload_code(/** @type {HTMLAnchorElement} */ (entry.target).href);
					observer.unobserve(entry.target);
				}
			}
		},
		{ threshold: 0 }
	);

	/**
	 * @param {Element} element
	 * @param {number} priority
	 */
	function preload(element, priority) {
		const a = find_anchor(element, container);
		if (!a) return;

		const { url, external, download } = get_link_info(a, base);
		if (external || download) return;

		const options = get_router_options(a);

		if (!options.reload) {
			if (priority <= options.preload_data) {
				const intent = get_navigation_intent(url, false);
				if (intent) {
					if (DEV) {
						_preload_data(intent).then((result) => {
							if (result.type === 'loaded' && result.state.error) {
								console.warn(
									`Preloading data for ${intent.url.pathname} failed with the following error: ${result.state.error.message}\n` +
										'If this error is transient, you can ignore it. Otherwise, consider disabling preloading for this route. ' +
										'This route was preloaded due to a data-sveltekit-preload-data attribute. ' +
										'See https://kit.svelte.dev/docs/link-options for more info'
								);
							}
						});
					} else {
						_preload_data(intent);
					}
				}
			} else if (priority <= options.preload_code) {
				_preload_code(/** @type {URL} */ (url).pathname);
			}
		}
	}

	function after_navigate() {
		observer.disconnect();

		for (const a of container.querySelectorAll('a')) {
			const { url, external, download } = get_link_info(a, base);
			if (external || download) continue;

			const options = get_router_options(a);
			if (options.reload) continue;

			if (options.preload_code === PRELOAD_PRIORITIES.viewport) {
				observer.observe(a);
			}

			if (options.preload_code === PRELOAD_PRIORITIES.eager) {
				_preload_code(/** @type {URL} */ (url).pathname);
			}
		}
	}

	after_navigate_callbacks.push(after_navigate);
	after_navigate();
}

/**
 * @param {unknown} error
 * @param {import('@sveltejs/kit').NavigationEvent} event
 * @returns {import('types').MaybePromise<App.Error>}
 */
function handle_error(error, event) {
	if (error instanceof HttpError) {
		return error.body;
	}

	if (DEV) {
		errored = true;
		console.warn('The next HMR update will cause the page to reload');
	}

	const status = get_status(error);
	const message = get_message(error);

	return (
		app.hooks.handleError({ error, event, status, message }) ?? /** @type {any} */ ({ message })
	);
}

/**
 * @template {Function} T
 * @param {T[]} callbacks
 * @param {T} callback
 */
function add_navigation_callback(callbacks, callback) {
	onMount(() => {
		callbacks.push(callback);

		return () => {
			const i = callbacks.indexOf(callback);
			callbacks.splice(i, 1);
		};
	});
}

/**
 * A lifecycle function that runs the supplied `callback` when the current component mounts, and also whenever we navigate to a new URL.
 *
 * `afterNavigate` must be called during a component initialization. It remains active as long as the component is mounted.
 * @param {(navigation: import('@sveltejs/kit').AfterNavigate) => void} callback
 * @returns {void}
 */
export function afterNavigate(callback) {
	add_navigation_callback(after_navigate_callbacks, callback);
}

/**
 * A navigation interceptor that triggers before we navigate to a new URL, whether by clicking a link, calling `goto(...)`, or using the browser back/forward controls.
 *
 * Calling `cancel()` will prevent the navigation from completing. If `navigation.type === 'leave'` — meaning the user is navigating away from the app (or closing the tab) — calling `cancel` will trigger the native browser unload confirmation dialog. In this case, the navigation may or may not be cancelled depending on the user's response.
 *
 * When a navigation isn't to a SvelteKit-owned route (and therefore controlled by SvelteKit's client-side router), `navigation.to.route.id` will be `null`.
 *
 * If the navigation will (if not cancelled) cause the document to unload — in other words `'leave'` navigations and `'link'` navigations where `navigation.to.route === null` — `navigation.willUnload` is `true`.
 *
 * `beforeNavigate` must be called during a component initialization. It remains active as long as the component is mounted.
 * @param {(navigation: import('@sveltejs/kit').BeforeNavigate) => void} callback
 * @returns {void}
 */
export function beforeNavigate(callback) {
	add_navigation_callback(before_navigate_callbacks, callback);
}

/**
 * A lifecycle function that runs the supplied `callback` immediately before we navigate to a new URL except during full-page navigations.
 *
 * If you return a `Promise`, SvelteKit will wait for it to resolve before completing the navigation. This allows you to — for example — use `document.startViewTransition`. Avoid promises that are slow to resolve, since navigation will appear stalled to the user.
 *
 * If a function (or a `Promise` that resolves to a function) is returned from the callback, it will be called once the DOM has updated.
 *
 * `onNavigate` must be called during a component initialization. It remains active as long as the component is mounted.
 * @param {(navigation: import('@sveltejs/kit').OnNavigate) => import('types').MaybePromise<(() => void) | void>} callback
 * @returns {void}
 */
export function onNavigate(callback) {
	add_navigation_callback(on_navigate_callbacks, callback);
}

/**
 * If called when the page is being updated following a navigation (in `onMount` or `afterNavigate` or an action, for example), this disables SvelteKit's built-in scroll handling.
 * This is generally discouraged, since it breaks user expectations.
 * @returns {void}
 */
export function disableScrollHandling() {
	if (!BROWSER) {
		throw new Error('Cannot call disableScrollHandling() on the server');
	}

	if (DEV && started && !updating) {
		throw new Error('Can only disable scroll handling during navigation');
	}

	if (updating || !started) {
		autoscroll = false;
	}
}

/**
 * Returns a Promise that resolves when SvelteKit navigates (or fails to navigate, in which case the promise rejects) to the specified `url`.
 * For external URLs, use `window.location = url` instead of calling `goto(url)`.
 *
 * @param {string | URL} url Where to navigate to. Note that if you've set [`config.kit.paths.base`](https://kit.svelte.dev/docs/configuration#paths) and the URL is root-relative, you need to prepend the base path if you want to navigate within the app.
 * @param {Object} [opts] Options related to the navigation
 * @param {boolean} [opts.replaceState] If `true`, will replace the current `history` entry rather than creating a new one with `pushState`
 * @param {boolean} [opts.noScroll] If `true`, the browser will maintain its scroll position rather than scrolling to the top of the page after navigation
 * @param {boolean} [opts.keepFocus] If `true`, the currently focused element will retain focus after navigation. Otherwise, focus will be reset to the body
 * @param {boolean} [opts.invalidateAll] If `true`, all `load` functions of the page will be rerun. See https://kit.svelte.dev/docs/load#rerunning-load-functions for more info on invalidation.
 * @param {App.PageState} [opts.state] An optional object that will be available on the `$page.state` store
 * @returns {Promise<void>}
 */
export function goto(url, opts = {}) {
	if (!BROWSER) {
		throw new Error('Cannot call goto(...) on the server');
	}

	url = resolve_url(url);

	if (url.origin !== origin) {
		return Promise.reject(
			new Error(
				DEV
					? `Cannot use \`goto\` with an external URL. Use \`window.location = "${url}"\` instead`
					: 'goto: invalid URL'
			)
		);
	}

	return _goto(url, opts, 0);
}

/**
 * Causes any `load` functions belonging to the currently active page to re-run if they depend on the `url` in question, via `fetch` or `depends`. Returns a `Promise` that resolves when the page is subsequently updated.
 *
 * If the argument is given as a `string` or `URL`, it must resolve to the same URL that was passed to `fetch` or `depends` (including query parameters).
 * To create a custom identifier, use a string beginning with `[a-z]+:` (e.g. `custom:state`) — this is a valid URL.
 *
 * The `function` argument can be used define a custom predicate. It receives the full `URL` and causes `load` to rerun if `true` is returned.
 * This can be useful if you want to invalidate based on a pattern instead of a exact match.
 *
 * ```ts
 * // Example: Match '/path' regardless of the query parameters
 * import { invalidate } from '$app/navigation';
 *
 * invalidate((url) => url.pathname === '/path');
 * ```
 * @param {string | URL | ((url: URL) => boolean)} resource The invalidated URL
 * @returns {Promise<void>}
 */
export function invalidate(resource) {
	if (!BROWSER) {
		throw new Error('Cannot call invalidate(...) on the server');
	}

	if (typeof resource === 'function') {
		invalidated.push(resource);
	} else {
		const { href } = new URL(resource, location.href);
		invalidated.push((url) => url.href === href);
	}

	return _invalidate();
}

/**
 * Causes all `load` functions belonging to the currently active page to re-run. Returns a `Promise` that resolves when the page is subsequently updated.
 * @returns {Promise<void>}
 */
export function invalidateAll() {
	if (!BROWSER) {
		throw new Error('Cannot call invalidateAll() on the server');
	}

	force_invalidation = true;
	return _invalidate();
}

/**
 * Programmatically preloads the given page, which means
 *  1. ensuring that the code for the page is loaded, and
 *  2. calling the page's load function with the appropriate options.
 *
 * This is the same behaviour that SvelteKit triggers when the user taps or mouses over an `<a>` element with `data-sveltekit-preload-data`.
 * If the next navigation is to `href`, the values returned from load will be used, making navigation instantaneous.
 * Returns a Promise that resolves with the result of running the new route's `load` functions once the preload is complete.
 *
 * @param {string} href Page to preload
 * @returns {Promise<{ type: 'loaded'; status: number; data: Record<string, any> } | { type: 'redirect'; location: string }>}
 */
export async function preloadData(href) {
	if (!BROWSER) {
		throw new Error('Cannot call preloadData(...) on the server');
	}

	const url = resolve_url(href);
	const intent = get_navigation_intent(url, false);

	if (!intent) {
		throw new Error(`Attempted to preload a URL that does not belong to this app: ${url}`);
	}

	const result = await _preload_data(intent);
	if (result.type === 'redirect') {
		return {
			type: result.type,
			location: result.location
		};
	}

	const { status, data } = result.props.page ?? page;
	return { type: result.type, status, data };
}

/**
 * Programmatically imports the code for routes that haven't yet been fetched.
 * Typically, you might call this to speed up subsequent navigation.
 *
 * You can specify routes by any matching pathname such as `/about` (to match `src/routes/about/+page.svelte`) or `/blog/*` (to match `src/routes/blog/[slug]/+page.svelte`).
 *
 * Unlike `preloadData`, this won't call `load` functions.
 * Returns a Promise that resolves when the modules have been imported.
 *
 * @param {string} pathname
 * @returns {Promise<void>}
 */
export function preloadCode(pathname) {
	if (!BROWSER) {
		throw new Error('Cannot call preloadCode(...) on the server');
	}

	if (DEV) {
		if (!pathname.startsWith(base)) {
			throw new Error(
				`pathnames passed to preloadCode must start with \`paths.base\` (i.e. "${base}${pathname}" rather than "${pathname}")`
			);
		}

		if (!routes.find((route) => route.exec(get_url_path(pathname)))) {
			throw new Error(`'${pathname}' did not match any routes`);
		}
	}

	return _preload_code(pathname);
}

/**
 * Programmatically create a new history entry with the given `$page.state`. To use the current URL, you can pass `''` as the first argument. Used for [shallow routing](https://kit.svelte.dev/docs/shallow-routing).
 *
 * @param {string | URL} url
 * @param {App.PageState} state
 * @returns {void}
 */
export function pushState(url, state) {
	if (!BROWSER) {
		throw new Error('Cannot call pushState(...) on the server');
	}

	if (DEV) {
		try {
			// use `devalue.stringify` as a convenient way to ensure we exclude values that can't be properly rehydrated, such as custom class instances
			devalue.stringify(state);
		} catch (error) {
			// @ts-expect-error
			throw new Error(`Could not serialize state${error.path}`);
		}
	}

	update_scroll_positions(current_history_index);

	const opts = {
		[HISTORY_INDEX]: (current_history_index += 1),
		[NAVIGATION_INDEX]: current_navigation_index,
		[PAGE_URL_KEY]: page.url.href,
		[STATES_KEY]: state
	};

	history.pushState(opts, '', resolve_url(url));
	has_navigated = true;

	page = { ...page, state };
	root.$set({ page });

	clear_onward_history(current_history_index, current_navigation_index);
}

/**
 * Programmatically replace the current history entry with the given `$page.state`. To use the current URL, you can pass `''` as the first argument. Used for [shallow routing](https://kit.svelte.dev/docs/shallow-routing).
 *
 * @param {string | URL} url
 * @param {App.PageState} state
 * @returns {void}
 */
export function replaceState(url, state) {
	if (!BROWSER) {
		throw new Error('Cannot call replaceState(...) on the server');
	}

	if (DEV) {
		try {
			// use `devalue.stringify` as a convenient way to ensure we exclude values that can't be properly rehydrated, such as custom class instances
			devalue.stringify(state);
		} catch (error) {
			// @ts-expect-error
			throw new Error(`Could not serialize state${error.path}`);
		}
	}

	const opts = {
		[HISTORY_INDEX]: current_history_index,
		[NAVIGATION_INDEX]: current_navigation_index,
		[PAGE_URL_KEY]: page.url.href,
		[STATES_KEY]: state
	};

	history.replaceState(opts, '', resolve_url(url));

	page = { ...page, state };
	root.$set({ page });
}

/**
 * This action updates the `form` property of the current page with the given data and updates `$page.status`.
 * In case of an error, it redirects to the nearest error page.
 * @template {Record<string, unknown> | undefined} Success
 * @template {Record<string, unknown> | undefined} Failure
 * @param {import('@sveltejs/kit').ActionResult<Success, Failure>} result
 * @returns {Promise<void>}
 */
export async function applyAction(result) {
	if (!BROWSER) {
		throw new Error('Cannot call applyAction(...) on the server');
	}

	if (result.type === 'error') {
		const url = new URL(location.href);

		const { branch, route } = current;
		if (!route) return;

		const error_load = await load_nearest_error_page(current.branch.length, branch, route.errors);
		if (error_load) {
			const navigation_result = await get_navigation_result_from_branch({
				url,
				params: current.params,
				branch: branch.slice(0, error_load.idx).concat(error_load.node),
				status: result.status ?? 500,
				error: result.error,
				route
			});

			current = navigation_result.state;

			root.$set(navigation_result.props);

			tick().then(reset_focus);
		}
	} else if (result.type === 'redirect') {
		_goto(result.location, { invalidateAll: true }, 0);
	} else {
		/** @type {Record<string, any>} */
		root.$set({
			// this brings Svelte's view of the world in line with SvelteKit's
			// after use:enhance reset the form....
			form: null,
			page: { ...page, form: result.data, status: result.status }
		});

		// ...so that setting the `form` prop takes effect and isn't ignored
		await tick();
		root.$set({ form: result.data });

		if (result.type === 'success') {
			reset_focus();
		}
	}
}

function _start_router() {
	history.scrollRestoration = 'manual';

	// Adopted from Nuxt.js
	// Reset scrollRestoration to auto when leaving page, allowing page reload
	// and back-navigation from other pages to use the browser to restore the
	// scrolling position.
	addEventListener('beforeunload', (e) => {
		let should_block = false;

		persist_state();

		if (!navigating) {
			const nav = create_navigation(current, undefined, null, 'leave');

			// If we're navigating, beforeNavigate was already called. If we end up in here during navigation,
			// it's due to an external or full-page-reload link, for which we don't want to call the hook again.
			/** @type {import('@sveltejs/kit').BeforeNavigate} */
			const navigation = {
				...nav.navigation,
				cancel: () => {
					should_block = true;
					nav.reject(new Error('navigation cancelled'));
				}
			};

			before_navigate_callbacks.forEach((fn) => fn(navigation));
		}

		if (should_block) {
			e.preventDefault();
			e.returnValue = '';
		} else {
			history.scrollRestoration = 'auto';
		}
	});

	addEventListener('visibilitychange', () => {
		if (document.visibilityState === 'hidden') {
			persist_state();
		}
	});

	// @ts-expect-error this isn't supported everywhere yet
	if (!navigator.connection?.saveData) {
		setup_preload();
	}

	/** @param {MouseEvent} event */
	container.addEventListener('click', (event) => {
		// Adapted from https://github.com/visionmedia/page.js
		// MIT license https://github.com/visionmedia/page.js#license
		if (event.button || event.which !== 1) return;
		if (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) return;
		if (event.defaultPrevented) return;

		const a = find_anchor(/** @type {Element} */ (event.composedPath()[0]), container);
		if (!a) return;

		const { url, external, target, download } = get_link_info(a, base);
		if (!url) return;

		// bail out before `beforeNavigate` if link opens in a different tab
		if (target === '_parent' || target === '_top') {
			if (window.parent !== window) return;
		} else if (target && target !== '_self') {
			return;
		}

		const options = get_router_options(a);
		const is_svg_a_element = a instanceof SVGAElement;

		// Ignore URL protocols that differ to the current one and are not http(s) (e.g. `mailto:`, `tel:`, `myapp:`, etc.)
		// This may be wrong when the protocol is x: and the link goes to y:.. which should be treated as an external
		// navigation, but it's not clear how to handle that case and it's not likely to come up in practice.
		// MEMO: Without this condition, firefox will open mailer twice.
		// See:
		// - https://github.com/sveltejs/kit/issues/4045
		// - https://github.com/sveltejs/kit/issues/5725
		// - https://github.com/sveltejs/kit/issues/6496
		if (
			!is_svg_a_element &&
			url.protocol !== location.protocol &&
			!(url.protocol === 'https:' || url.protocol === 'http:')
		)
			return;

		if (download) return;

		// Ignore the following but fire beforeNavigate
		if (external || options.reload) {
			if (_before_navigate({ url, type: 'link' })) {
				// set `navigating` to `true` to prevent `beforeNavigate` callbacks
				// being called when the page unloads
				navigating = true;
			} else {
				event.preventDefault();
			}

			return;
		}

		// Check if new url only differs by hash and use the browser default behavior in that case
		// This will ensure the `hashchange` event is fired
		// Removing the hash does a full page navigation in the browser, so make sure a hash is present
		const [nonhash, hash] = url.href.split('#');
		if (hash !== undefined && nonhash === strip_hash(location)) {
			// If we are trying to navigate to the same hash, we should only
			// attempt to scroll to that element and avoid any history changes.
			// Otherwise, this can cause Firefox to incorrectly assign a null
			// history state value without any signal that we can detect.
			const [, current_hash] = current.url.href.split('#');
			if (current_hash === hash) {
				event.preventDefault();

				// We're already on /# and click on a link that goes to /#, or we're on
				// /#top and click on a link that goes to /#top. In those cases just go to
				// the top of the page, and avoid a history change.
				if (hash === '' || (hash === 'top' && a.ownerDocument.getElementById('top') === null)) {
					window.scrollTo({ top: 0 });
				} else {
					a.ownerDocument.getElementById(hash)?.scrollIntoView();
				}

				return;
			}
			// set this flag to distinguish between navigations triggered by
			// clicking a hash link and those triggered by popstate
			hash_navigating = true;

			update_scroll_positions(current_history_index);

			update_url(url);

			if (!options.replace_state) return;

			// hashchange event shouldn't occur if the router is replacing state.
			hash_navigating = false;
		}

		event.preventDefault();

		navigate({
			type: 'link',
			url,
			keepfocus: options.keepfocus,
			noscroll: options.noscroll,
			replace_state: options.replace_state ?? url.href === location.href
		});
	});

	container.addEventListener('submit', (event) => {
		if (event.defaultPrevented) return;

		const form = /** @type {HTMLFormElement} */ (
			HTMLFormElement.prototype.cloneNode.call(event.target)
		);

		const submitter = /** @type {HTMLButtonElement | HTMLInputElement | null} */ (event.submitter);

		const method = submitter?.formMethod || form.method;

		if (method !== 'get') return;

		const url = new URL(
			(submitter?.hasAttribute('formaction') && submitter?.formAction) || form.action
		);

		if (is_external_url(url, base)) return;

		const event_form = /** @type {HTMLFormElement} */ (event.target);

		const options = get_router_options(event_form);
		if (options.reload) return;

		event.preventDefault();
		event.stopPropagation();

		const data = new FormData(event_form);

		const submitter_name = submitter?.getAttribute('name');
		if (submitter_name) {
			data.append(submitter_name, submitter?.getAttribute('value') ?? '');
		}

		// @ts-expect-error `URLSearchParams(fd)` is kosher, but typescript doesn't know that
		url.search = new URLSearchParams(data).toString();

		navigate({
			type: 'form',
			url,
			keepfocus: options.keepfocus,
			noscroll: options.noscroll,
			replace_state: options.replace_state ?? url.href === location.href
		});
	});

	addEventListener('popstate', async (event) => {
		if (event.state?.[HISTORY_INDEX]) {
			const history_index = event.state[HISTORY_INDEX];
			token = {};

			// if a popstate-driven navigation is cancelled, we need to counteract it
			// with history.go, which means we end up back here, hence this check
			if (history_index === current_history_index) return;

			const scroll = scroll_positions[history_index];
			const state = event.state[STATES_KEY] ?? {};
			const url = new URL(event.state[PAGE_URL_KEY] ?? location.href);
			const navigation_index = event.state[NAVIGATION_INDEX];
			const is_hash_change = strip_hash(location) === strip_hash(current.url);
			const shallow =
				navigation_index === current_navigation_index && (has_navigated || is_hash_change);

			if (shallow) {
				// We don't need to navigate, we just need to update scroll and/or state.
				// This happens with hash links and `pushState`/`replaceState`. The
				// exception is if we haven't navigated yet, since we could have
				// got here after a modal navigation then a reload
				update_url(url);

				scroll_positions[current_history_index] = scroll_state();
				if (scroll) scrollTo(scroll.x, scroll.y);

				if (state !== page.state) {
					page = { ...page, state };
					root.$set({ page });
				}

				current_history_index = history_index;
				return;
			}

			const delta = history_index - current_history_index;

			await navigate({
				type: 'popstate',
				url,
				popped: {
					state,
					scroll,
					delta
				},
				accept: () => {
					current_history_index = history_index;
					current_navigation_index = navigation_index;
				},
				block: () => {
					history.go(-delta);
				},
				nav_token: token
			});
		} else {
			// since popstate event is also emitted when an anchor referencing the same
			// document is clicked, we have to check that the router isn't already handling
			// the navigation. otherwise we would be updating the page store twice.
			if (!hash_navigating) {
				const url = new URL(location.href);
				update_url(url);
			}
		}
	});

	addEventListener('hashchange', () => {
		// if the hashchange happened as a result of clicking on a link,
		// we need to update history, otherwise we have to leave it alone
		if (hash_navigating) {
			hash_navigating = false;
			history.replaceState(
				{
					...history.state,
					[HISTORY_INDEX]: ++current_history_index,
					[NAVIGATION_INDEX]: current_navigation_index
				},
				'',
				location.href
			);
		}
	});

	// fix link[rel=icon], because browsers will occasionally try to load relative
	// URLs after a pushState/replaceState, resulting in a 404 — see
	// https://github.com/sveltejs/kit/issues/3748#issuecomment-1125980897
	for (const link of document.querySelectorAll('link')) {
		if (link.rel === 'icon') link.href = link.href; // eslint-disable-line
	}

	addEventListener('pageshow', (event) => {
		// If the user navigates to another site and then uses the back button and
		// bfcache hits, we need to set navigating to null, the site doesn't know
		// the navigation away from it was successful.
		// Info about bfcache here: https://web.dev/bfcache
		if (event.persisted) {
			stores.navigating.set(null);
		}
	});

	/**
	 * @param {URL} url
	 */
	function update_url(url) {
		current.url = url;
		stores.page.set({ ...page, url });
		stores.page.notify();
	}
}

/**
 * @param {HTMLElement} target
 * @param {{
 *   status: number;
 *   error: App.Error | null;
 *   node_ids: number[];
 *   params: Record<string, string>;
 *   route: { id: string | null };
 *   data: Array<import('types').ServerDataNode | null>;
 *   form: Record<string, any> | null;
 * }} opts
 */
async function _hydrate(
	target,
	{ status = 200, error, node_ids, params, route, data: server_data_nodes, form }
) {
	hydrated = true;

	const url = new URL(location.href);

	if (!__SVELTEKIT_EMBEDDED__) {
		// See https://github.com/sveltejs/kit/pull/4935#issuecomment-1328093358 for one motivation
		// of determining the params on the client side.
		({ params = {}, route = { id: null } } = get_navigation_intent(url, false) || {});
	}

	/** @type {import('./types.js').NavigationFinished | undefined} */
	let result;

	try {
		const branch_promises = node_ids.map(async (n, i) => {
			const server_data_node = server_data_nodes[i];
			// Type isn't completely accurate, we still need to deserialize uses
			if (server_data_node?.uses) {
				server_data_node.uses = deserialize_uses(server_data_node.uses);
			}

			return load_node({
				loader: app.nodes[n],
				url,
				params,
				route,
				parent: async () => {
					const data = {};
					for (let j = 0; j < i; j += 1) {
						Object.assign(data, (await branch_promises[j]).data);
					}
					return data;
				},
				server_data_node: create_data_node(server_data_node)
			});
		});

		/** @type {Array<import('./types.js').BranchNode | undefined>} */
		const branch = await Promise.all(branch_promises);

		const parsed_route = routes.find(({ id }) => id === route.id);

		// server-side will have compacted the branch, reinstate empty slots
		// so that error boundaries can be lined up correctly
		if (parsed_route) {
			const layouts = parsed_route.layouts;
			for (let i = 0; i < layouts.length; i++) {
				if (!layouts[i]) {
					branch.splice(i, 0, undefined);
				}
			}
		}

		result = await get_navigation_result_from_branch({
			url,
			params,
			branch,
			status,
			error,
			form,
			route: parsed_route ?? null
		});
	} catch (error) {
		if (error instanceof Redirect) {
			// this is a real edge case — `load` would need to return
			// a redirect but only in the browser
			await native_navigation(new URL(error.location, location.href));
			return;
		}

		result = await load_root_error_page({
			status: get_status(error),
			error: await handle_error(error, { url, params, route }),
			url,
			route
		});
	}

	if (result.props.page) {
		result.props.page.state = {};
	}

	initialize(result, target, true);
}

/**
 * @param {URL} url
 * @param {boolean[]} invalid
 * @returns {Promise<import('types').ServerNodesResponse | import('types').ServerRedirectNode>}
 */
async function load_data(url, invalid) {
	const data_url = new URL(url);
	data_url.pathname = add_data_suffix(url.pathname);
	if (url.pathname.endsWith('/')) {
		data_url.searchParams.append(TRAILING_SLASH_PARAM, '1');
	}
	if (DEV && url.searchParams.has(INVALIDATED_PARAM)) {
		throw new Error(`Cannot used reserved query parameter "${INVALIDATED_PARAM}"`);
	}
	data_url.searchParams.append(INVALIDATED_PARAM, invalid.map((i) => (i ? '1' : '0')).join(''));

	const res = await native_fetch(data_url.href);

	if (!res.ok) {
		// error message is a JSON-stringified string which devalue can't handle at the top level
		// turn it into a HttpError to not call handleError on the client again (was already handled on the server)
		// if `__data.json` doesn't exist or the server has an internal error,
		// avoid parsing the HTML error page as a JSON
		/** @type {string | undefined} */
		let message;
		if (res.headers.get('content-type')?.includes('application/json')) {
			message = await res.json();
		} else if (res.status === 404) {
			message = 'Not Found';
		} else if (res.status === 500) {
			message = 'Internal Error';
		}
		throw new HttpError(res.status, message);
	}

	// TODO: fix eslint error / figure out if it actually applies to our situation
	// eslint-disable-next-line
	return new Promise(async (resolve) => {
		/**
		 * Map of deferred promises that will be resolved by a subsequent chunk of data
		 * @type {Map<string, import('types').Deferred>}
		 */
		const deferreds = new Map();
		const reader = /** @type {ReadableStream<Uint8Array>} */ (res.body).getReader();
		const decoder = new TextDecoder();

		/**
		 * @param {any} data
		 */
		function deserialize(data) {
			return devalue.unflatten(data, {
				Promise: (id) => {
					return new Promise((fulfil, reject) => {
						deferreds.set(id, { fulfil, reject });
					});
				}
			});
		}

		let text = '';

		while (true) {
			// Format follows ndjson (each line is a JSON object) or regular JSON spec
			const { done, value } = await reader.read();
			if (done && !text) break;

			text += !value && text ? '\n' : decoder.decode(value, { stream: true }); // no value -> final chunk -> add a new line to trigger the last parse

			while (true) {
				const split = text.indexOf('\n');
				if (split === -1) {
					break;
				}

				const node = JSON.parse(text.slice(0, split));
				text = text.slice(split + 1);

				if (node.type === 'redirect') {
					return resolve(node);
				}

				if (node.type === 'data') {
					// This is the first (and possibly only, if no pending promises) chunk
					node.nodes?.forEach((/** @type {any} */ node) => {
						if (node?.type === 'data') {
							node.uses = deserialize_uses(node.uses);
							node.data = deserialize(node.data);
						}
					});

					resolve(node);
				} else if (node.type === 'chunk') {
					// This is a subsequent chunk containing deferred data
					const { id, data, error } = node;
					const deferred = /** @type {import('types').Deferred} */ (deferreds.get(id));
					deferreds.delete(id);

					if (error) {
						deferred.reject(deserialize(error));
					} else {
						deferred.fulfil(deserialize(data));
					}
				}
			}
		}
	});

	// TODO edge case handling necessary? stream() read fails?
}

/**
 * @param {any} uses
 * @return {import('types').Uses}
 */
function deserialize_uses(uses) {
	return {
		dependencies: new Set(uses?.dependencies ?? []),
		params: new Set(uses?.params ?? []),
		parent: !!uses?.parent,
		route: !!uses?.route,
		url: !!uses?.url,
		search_params: new Set(uses?.search_params ?? [])
	};
}

function reset_focus() {
	const autofocus = document.querySelector('[autofocus]');
	if (autofocus) {
		// @ts-ignore
		autofocus.focus();
	} else {
		// Reset page selection and focus
		// We try to mimic browsers' behaviour as closely as possible by targeting the
		// first scrollable region, but unfortunately it's not a perfect match — e.g.
		// shift-tabbing won't immediately cycle up from the end of the page on Chromium
		// See https://html.spec.whatwg.org/multipage/interaction.html#get-the-focusable-area
		const root = document.body;
		const tabindex = root.getAttribute('tabindex');

		root.tabIndex = -1;
		// @ts-expect-error
		root.focus({ preventScroll: true, focusVisible: false });

		// restore `tabindex` as to prevent `root` from stealing input from elements
		if (tabindex !== null) {
			root.setAttribute('tabindex', tabindex);
		} else {
			root.removeAttribute('tabindex');
		}

		// capture current selection, so we can compare the state after
		// snapshot restoration and afterNavigate callbacks have run
		const selection = getSelection();

		if (selection && selection.type !== 'None') {
			/** @type {Range[]} */
			const ranges = [];

			for (let i = 0; i < selection.rangeCount; i += 1) {
				ranges.push(selection.getRangeAt(i));
			}

			setTimeout(() => {
				if (selection.rangeCount !== ranges.length) return;

				for (let i = 0; i < selection.rangeCount; i += 1) {
					const a = ranges[i];
					const b = selection.getRangeAt(i);

					// we need to do a deep comparison rather than just `a !== b` because
					// Safari behaves differently to other browsers
					if (
						a.commonAncestorContainer !== b.commonAncestorContainer ||
						a.startContainer !== b.startContainer ||
						a.endContainer !== b.endContainer ||
						a.startOffset !== b.startOffset ||
						a.endOffset !== b.endOffset
					) {
						return;
					}
				}

				// if the selection hasn't changed (as a result of an element being (auto)focused,
				// or a programmatic selection, we reset everything as part of the navigation)
				// fixes https://github.com/sveltejs/kit/issues/8439
				selection.removeAllRanges();
			});
		}
	}
}

/**
 * @param {import('./types.js').NavigationState} current
 * @param {import('./types.js').NavigationIntent | undefined} intent
 * @param {URL | null} url
 * @param {Exclude<import('@sveltejs/kit').NavigationType, 'enter'>} type
 */
function create_navigation(current, intent, url, type) {
	/** @type {(value: any) => void} */
	let fulfil;

	/** @type {(error: any) => void} */
	let reject;

	const complete = new Promise((f, r) => {
		fulfil = f;
		reject = r;
	});

	// Handle any errors off-chain so that it doesn't show up as an unhandled rejection
	complete.catch(() => {});

	/** @type {import('@sveltejs/kit').Navigation} */
	const navigation = {
		from: {
			params: current.params,
			route: { id: current.route?.id ?? null },
			url: current.url
		},
		to: url && {
			params: intent?.params ?? null,
			route: { id: intent?.route?.id ?? null },
			url
		},
		willUnload: !intent,
		type,
		complete
	};

	return {
		navigation,
		// @ts-expect-error
		fulfil,
		// @ts-expect-error
		reject
	};
}

if (DEV) {
	// Nasty hack to silence harmless warnings the user can do nothing about
	const console_warn = console.warn;
	console.warn = function warn(...args) {
		if (
			args.length === 1 &&
			/<(Layout|Page|Error)(_[\w$]+)?> was created (with unknown|without expected) prop '(data|form)'/.test(
				args[0]
			)
		) {
			return;
		}
		console_warn(...args);
	};

	if (import.meta.hot) {
		import.meta.hot.on('vite:beforeUpdate', () => {
			if (errored) {
				location.reload();
			}
		});
	}
}

```


####### packages/kit/src/runtime/client/constants.js #######

```

export const SNAPSHOT_KEY = 'sveltekit:snapshot';
export const SCROLL_KEY = 'sveltekit:scroll';
export const STATES_KEY = 'sveltekit:states';
export const PAGE_URL_KEY = 'sveltekit:pageurl';

export const HISTORY_INDEX = 'sveltekit:history';
export const NAVIGATION_INDEX = 'sveltekit:navigation';

export const PRELOAD_PRIORITIES = /** @type {const} */ ({
	tap: 1,
	hover: 2,
	viewport: 3,
	eager: 4,
	off: -1,
	false: -1
});

```


####### packages/kit/src/runtime/client/entry.js #######

```

// we expose this as a separate entry point (rather than treating client.js as the entry point)
// so that everything other than `start` can be treeshaken
export { start } from './client.js';

```


####### packages/kit/src/runtime/client/fetcher.js #######

```

import { BROWSER, DEV } from 'esm-env';
import { hash } from '../hash.js';
import { b64_decode } from '../utils.js';

let loading = 0;

/** @type {typeof fetch} */
export const native_fetch = BROWSER ? window.fetch : /** @type {any} */ (() => {});

export function lock_fetch() {
	loading += 1;
}

export function unlock_fetch() {
	loading -= 1;
}

if (DEV && BROWSER) {
	let can_inspect_stack_trace = false;

	// detect whether async stack traces work
	const check_stack_trace = async () => {
		const stack = /** @type {string} */ (new Error().stack);
		can_inspect_stack_trace = stack.includes('check_stack_trace');
	};

	check_stack_trace();

	/**
	 * @param {RequestInfo | URL} input
	 * @param {RequestInit & Record<string, any> | undefined} init
	 */
	window.fetch = (input, init) => {
		// Check if fetch was called via load_node. the lock method only checks if it was called at the
		// same time, but not necessarily if it was called from `load`.
		// We use just the filename as the method name sometimes does not appear on the CI.
		const url = input instanceof Request ? input.url : input.toString();
		const stack_array = /** @type {string} */ (new Error().stack).split('\n');
		// We need to do a cutoff because Safari and Firefox maintain the stack
		// across events and for example traces a `fetch` call triggered from a button
		// back to the creation of the event listener and the element creation itself,
		// where at some point client.js will show up, leading to false positives.
		const cutoff = stack_array.findIndex((a) => a.includes('load@') || a.includes('at load'));
		const stack = stack_array.slice(0, cutoff + 2).join('\n');

		const in_load_heuristic = can_inspect_stack_trace
			? stack.includes('src/runtime/client/client.js')
			: loading;

		// This flag is set in initial_fetch and subsequent_fetch
		const used_kit_fetch = init?.__sveltekit_fetch__;

		if (in_load_heuristic && !used_kit_fetch) {
			console.warn(
				`Loading ${url} using \`window.fetch\`. For best results, use the \`fetch\` that is passed to your \`load\` function: https://kit.svelte.dev/docs/load#making-fetch-requests`
			);
		}

		const method = input instanceof Request ? input.method : init?.method || 'GET';

		if (method !== 'GET') {
			cache.delete(build_selector(input));
		}

		return native_fetch(input, init);
	};
} else if (BROWSER) {
	window.fetch = (input, init) => {
		const method = input instanceof Request ? input.method : init?.method || 'GET';

		if (method !== 'GET') {
			cache.delete(build_selector(input));
		}

		return native_fetch(input, init);
	};
}

const cache = new Map();

/**
 * Should be called on the initial run of load functions that hydrate the page.
 * Saves any requests with cache-control max-age to the cache.
 * @param {URL | string} resource
 * @param {RequestInit} [opts]
 */
export function initial_fetch(resource, opts) {
	const selector = build_selector(resource, opts);

	const script = document.querySelector(selector);
	if (script?.textContent) {
		let { body, ...init } = JSON.parse(script.textContent);

		const ttl = script.getAttribute('data-ttl');
		if (ttl) cache.set(selector, { body, init, ttl: 1000 * Number(ttl) });
		const b64 = script.getAttribute('data-b64');
		if (b64 !== null) {
			// Can't use native_fetch('data:...;base64,${body}')
			// csp can block the request
			body = b64_decode(body);
		}

		return Promise.resolve(new Response(body, init));
	}

	return DEV ? dev_fetch(resource, opts) : window.fetch(resource, opts);
}

/**
 * Tries to get the response from the cache, if max-age allows it, else does a fetch.
 * @param {URL | string} resource
 * @param {string} resolved
 * @param {RequestInit} [opts]
 */
export function subsequent_fetch(resource, resolved, opts) {
	if (cache.size > 0) {
		const selector = build_selector(resource, opts);
		const cached = cache.get(selector);
		if (cached) {
			// https://developer.mozilla.org/en-US/docs/Web/API/Request/cache#value
			if (
				performance.now() < cached.ttl &&
				['default', 'force-cache', 'only-if-cached', undefined].includes(opts?.cache)
			) {
				return new Response(cached.body, cached.init);
			}

			cache.delete(selector);
		}
	}

	return DEV ? dev_fetch(resolved, opts) : window.fetch(resolved, opts);
}

/**
 * @param {RequestInfo | URL} resource
 * @param {RequestInit & Record<string, any> | undefined} opts
 */
function dev_fetch(resource, opts) {
	const patched_opts = { ...opts };
	// This assigns the __sveltekit_fetch__ flag and makes it non-enumerable
	Object.defineProperty(patched_opts, '__sveltekit_fetch__', {
		value: true,
		writable: true,
		configurable: true
	});
	return window.fetch(resource, patched_opts);
}

/**
 * Build the cache key for a given request
 * @param {URL | RequestInfo} resource
 * @param {RequestInit} [opts]
 */
function build_selector(resource, opts) {
	const url = JSON.stringify(resource instanceof Request ? resource.url : resource);

	let selector = `script[data-sveltekit-fetched][data-url=${url}]`;

	if (opts?.headers || opts?.body) {
		/** @type {import('types').StrictBody[]} */
		const values = [];

		if (opts.headers) {
			values.push([...new Headers(opts.headers)].join(','));
		}

		if (opts.body && (typeof opts.body === 'string' || ArrayBuffer.isView(opts.body))) {
			values.push(opts.body);
		}

		selector += `[data-hash="${hash(...values)}"]`;
	}

	return selector;
}

```


####### packages/kit/src/runtime/client/parse.js #######

```

import { exec, parse_route_id } from '../../utils/routing.js';

/**
 * @param {import('./types.js').SvelteKitApp} app
 * @returns {import('types').CSRRoute[]}
 */
export function parse({ nodes, server_loads, dictionary, matchers }) {
	const layouts_with_server_load = new Set(server_loads);

	return Object.entries(dictionary).map(([id, [leaf, layouts, errors]]) => {
		const { pattern, params } = parse_route_id(id);

		const route = {
			id,
			/** @param {string} path */
			exec: (path) => {
				const match = pattern.exec(path);
				if (match) return exec(match, params, matchers);
			},
			errors: [1, ...(errors || [])].map((n) => nodes[n]),
			layouts: [0, ...(layouts || [])].map(create_layout_loader),
			leaf: create_leaf_loader(leaf)
		};

		// bit of a hack, but ensures that layout/error node lists are the same
		// length, without which the wrong data will be applied if the route
		// manifest looks like `[[a, b], [c,], d]`
		route.errors.length = route.layouts.length = Math.max(
			route.errors.length,
			route.layouts.length
		);

		return route;
	});

	/**
	 * @param {number} id
	 * @returns {[boolean, import('types').CSRPageNodeLoader]}
	 */
	function create_leaf_loader(id) {
		// whether or not the route uses the server data is
		// encoded using the ones' complement, to save space
		const uses_server_data = id < 0;
		if (uses_server_data) id = ~id;
		return [uses_server_data, nodes[id]];
	}

	/**
	 * @param {number | undefined} id
	 * @returns {[boolean, import('types').CSRPageNodeLoader] | undefined}
	 */
	function create_layout_loader(id) {
		// whether or not the layout uses the server data is
		// encoded in the layouts array, to save space
		return id === undefined ? id : [layouts_with_server_load.has(id), nodes[id]];
	}
}

```


####### packages/kit/src/runtime/client/session-storage.js #######

```

/**
 * Read a value from `sessionStorage`
 * @param {string} key
 * @param {(value: string) => any} parse
 */
export function get(key, parse = JSON.parse) {
	try {
		return parse(sessionStorage[key]);
	} catch {
		// do nothing
	}
}

/**
 * Write a value to `sessionStorage`
 * @param {string} key
 * @param {any} value
 * @param {(value: any) => string} stringify
 */
export function set(key, value, stringify = JSON.stringify) {
	const data = stringify(value);
	try {
		sessionStorage[key] = data;
	} catch {
		// do nothing
	}
}

```


####### packages/kit/src/runtime/client/types.d.ts #######

```

import { SvelteComponent } from 'svelte';
import { ClientHooks, CSRPageNode, CSRPageNodeLoader, CSRRoute, TrailingSlash, Uses } from 'types';
import { Page, ParamMatcher } from '@sveltejs/kit';

export interface SvelteKitApp {
	/**
	 * A list of all the error/layout/page nodes used in the app
	 */
	nodes: CSRPageNodeLoader[];

	/**
	 * A list of all layout node ids that have a server load function.
	 * Pages are not present because it's shorter to encode it on the leaf itself.
	 */
	server_loads: number[];

	/**
	 * A map of `[routeId: string]: [leaf, layouts, errors]` tuples, which
	 * is parsed into an array of routes on startup. The numbers refer to the indices in `nodes`.
	 * If the leaf number is negative, it means it does use a server load function and the complement is the node index.
	 * The route layout and error nodes are not referenced, they are always number 0 and 1 and always apply.
	 */
	dictionary: Record<string, [leaf: number, layouts: number[], errors?: number[]]>;

	matchers: Record<string, ParamMatcher>;

	hooks: ClientHooks;

	root: typeof SvelteComponent;
}

export type NavigationIntent = {
	/** `url.pathname + url.search`  */
	id: string;
	/** Whether we are invalidating or navigating */
	invalidating: boolean;
	/** The route parameters */
	params: Record<string, string>;
	/** The route that matches `path` */
	route: CSRRoute;
	/** The destination URL */
	url: URL;
};

export type NavigationResult = NavigationRedirect | NavigationFinished;

export type NavigationRedirect = {
	type: 'redirect';
	location: string;
};

export type NavigationFinished = {
	type: 'loaded';
	state: NavigationState;
	props: {
		constructors: Array<typeof SvelteComponent>;
		components?: Array<SvelteComponent>;
		page: Page;
		form?: Record<string, any> | null;
		[key: `data_${number}`]: Record<string, any>;
	};
};

export type BranchNode = {
	node: CSRPageNode;
	loader: CSRPageNodeLoader;
	server: DataNode | null;
	universal: DataNode | null;
	data: Record<string, any> | null;
	slash?: TrailingSlash;
};

export interface DataNode {
	type: 'data';
	data: Record<string, any> | null;
	uses: Uses;
	slash?: TrailingSlash;
}

export interface NavigationState {
	branch: Array<BranchNode | undefined>;
	error: App.Error | null;
	params: Record<string, string>;
	route: CSRRoute | null;
	url: URL;
}

```


####### packages/kit/src/runtime/client/utils.js #######

```

import { BROWSER, DEV } from 'esm-env';
import { writable } from 'svelte/store';
import { assets } from '__sveltekit/paths';
import { version } from '__sveltekit/environment';
import { PRELOAD_PRIORITIES } from './constants.js';

/* global __SVELTEKIT_APP_VERSION_FILE__, __SVELTEKIT_APP_VERSION_POLL_INTERVAL__ */

export const origin = BROWSER ? location.origin : '';

/** @param {string | URL} url */
export function resolve_url(url) {
	if (url instanceof URL) return url;

	let baseURI = document.baseURI;

	if (!baseURI) {
		const baseTags = document.getElementsByTagName('base');
		baseURI = baseTags.length ? baseTags[0].href : document.URL;
	}

	return new URL(url, baseURI);
}

export function scroll_state() {
	return {
		x: pageXOffset,
		y: pageYOffset
	};
}

const warned = new WeakSet();

/** @typedef {keyof typeof valid_link_options} LinkOptionName */

const valid_link_options = /** @type {const} */ ({
	'preload-code': ['', 'off', 'false', 'tap', 'hover', 'viewport', 'eager'],
	'preload-data': ['', 'off', 'false', 'tap', 'hover'],
	keepfocus: ['', 'true', 'off', 'false'],
	noscroll: ['', 'true', 'off', 'false'],
	reload: ['', 'true', 'off', 'false'],
	replacestate: ['', 'true', 'off', 'false']
});

/**
 * @template {LinkOptionName} T
 * @typedef {typeof valid_link_options[T][number]} ValidLinkOptions
 */

/**
 * @template {LinkOptionName} T
 * @param {Element} element
 * @param {T} name
 */
function link_option(element, name) {
	const value = /** @type {ValidLinkOptions<T> | null} */ (
		element.getAttribute(`data-sveltekit-${name}`)
	);

	if (DEV) {
		validate_link_option(element, name, value);
	}

	return value;
}

/**
 * @template {LinkOptionName} T
 * @template {ValidLinkOptions<T> | null} U
 * @param {Element} element
 * @param {T} name
 * @param {U} value
 */
function validate_link_option(element, name, value) {
	if (value === null) return;

	// @ts-expect-error - includes is dumb
	if (!warned.has(element) && !valid_link_options[name].includes(value)) {
		console.error(
			`Unexpected value for ${name} — should be one of ${valid_link_options[name]
				.map((option) => JSON.stringify(option))
				.join(', ')}`,
			element
		);

		warned.add(element);
	}
}

const levels = {
	...PRELOAD_PRIORITIES,
	'': PRELOAD_PRIORITIES.hover
};

/**
 * @param {Element} element
 * @returns {Element | null}
 */
function parent_element(element) {
	let parent = element.assignedSlot ?? element.parentNode;

	// @ts-expect-error handle shadow roots
	if (parent?.nodeType === 11) parent = parent.host;

	return /** @type {Element} */ (parent);
}

/**
 * @param {Element} element
 * @param {Element} target
 */
export function find_anchor(element, target) {
	while (element && element !== target) {
		if (element.nodeName.toUpperCase() === 'A' && element.hasAttribute('href')) {
			return /** @type {HTMLAnchorElement | SVGAElement} */ (element);
		}

		element = /** @type {Element} */ (parent_element(element));
	}
}

/**
 * @param {HTMLAnchorElement | SVGAElement} a
 * @param {string} base
 */
export function get_link_info(a, base) {
	/** @type {URL | undefined} */
	let url;

	try {
		url = new URL(a instanceof SVGAElement ? a.href.baseVal : a.href, document.baseURI);
	} catch {}

	const target = a instanceof SVGAElement ? a.target.baseVal : a.target;

	const external =
		!url ||
		!!target ||
		is_external_url(url, base) ||
		(a.getAttribute('rel') || '').split(/\s+/).includes('external');

	const download = url?.origin === origin && a.hasAttribute('download');

	return { url, external, target, download };
}

/**
 * @param {HTMLFormElement | HTMLAnchorElement | SVGAElement} element
 */
export function get_router_options(element) {
	/** @type {ValidLinkOptions<'keepfocus'> | null} */
	let keepfocus = null;

	/** @type {ValidLinkOptions<'noscroll'> | null} */
	let noscroll = null;

	/** @type {ValidLinkOptions<'preload-code'> | null} */
	let preload_code = null;

	/** @type {ValidLinkOptions<'preload-data'> | null} */
	let preload_data = null;

	/** @type {ValidLinkOptions<'reload'> | null} */
	let reload = null;

	/** @type {ValidLinkOptions<'replacestate'> | null} */
	let replace_state = null;

	/** @type {Element} */
	let el = element;

	while (el && el !== document.documentElement) {
		if (preload_code === null) preload_code = link_option(el, 'preload-code');
		if (preload_data === null) preload_data = link_option(el, 'preload-data');
		if (keepfocus === null) keepfocus = link_option(el, 'keepfocus');
		if (noscroll === null) noscroll = link_option(el, 'noscroll');
		if (reload === null) reload = link_option(el, 'reload');
		if (replace_state === null) replace_state = link_option(el, 'replacestate');

		el = /** @type {Element} */ (parent_element(el));
	}

	/** @param {string | null} value */
	function get_option_state(value) {
		switch (value) {
			case '':
			case 'true':
				return true;
			case 'off':
			case 'false':
				return false;
			default:
				return undefined;
		}
	}

	return {
		preload_code: levels[preload_code ?? 'off'],
		preload_data: levels[preload_data ?? 'off'],
		keepfocus: get_option_state(keepfocus),
		noscroll: get_option_state(noscroll),
		reload: get_option_state(reload),
		replace_state: get_option_state(replace_state)
	};
}

/** @param {any} value */
export function notifiable_store(value) {
	const store = writable(value);
	let ready = true;

	function notify() {
		ready = true;
		store.update((val) => val);
	}

	/** @param {any} new_value */
	function set(new_value) {
		ready = false;
		store.set(new_value);
	}

	/** @param {(value: any) => void} run */
	function subscribe(run) {
		/** @type {any} */
		let old_value;
		return store.subscribe((new_value) => {
			if (old_value === undefined || (ready && new_value !== old_value)) {
				run((old_value = new_value));
			}
		});
	}

	return { notify, set, subscribe };
}

export function create_updated_store() {
	const { set, subscribe } = writable(false);

	if (DEV || !BROWSER) {
		return {
			subscribe,
			check: async () => false
		};
	}

	const interval = __SVELTEKIT_APP_VERSION_POLL_INTERVAL__;

	/** @type {NodeJS.Timeout} */
	let timeout;

	/** @type {() => Promise<boolean>} */
	async function check() {
		clearTimeout(timeout);

		if (interval) timeout = setTimeout(check, interval);

		try {
			const res = await fetch(`${assets}/${__SVELTEKIT_APP_VERSION_FILE__}`, {
				headers: {
					pragma: 'no-cache',
					'cache-control': 'no-cache'
				}
			});

			if (!res.ok) {
				return false;
			}

			const data = await res.json();
			const updated = data.version !== version;

			if (updated) {
				set(true);
				clearTimeout(timeout);
			}

			return updated;
		} catch {
			return false;
		}
	}

	if (interval) timeout = setTimeout(check, interval);

	return {
		subscribe,
		check
	};
}

/**
 * @param {URL} url
 * @param {string} base
 */
export function is_external_url(url, base) {
	return url.origin !== origin || !url.pathname.startsWith(base);
}

```


####### packages/kit/src/runtime/components/error.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>{$page.status}</h1>
<p>{$page.error?.message}</p>

```


####### packages/kit/src/runtime/components/layout.svelte #######

```

<slot />

```


####### packages/kit/src/runtime/control.js #######

```

export class HttpError {
	/**
	 * @param {number} status
	 * @param {{message: string} extends App.Error ? (App.Error | string | undefined) : App.Error} body
	 */
	constructor(status, body) {
		this.status = status;
		if (typeof body === 'string') {
			this.body = { message: body };
		} else if (body) {
			this.body = body;
		} else {
			this.body = { message: `Error: ${status}` };
		}
	}

	toString() {
		return JSON.stringify(this.body);
	}
}

export class Redirect {
	/**
	 * @param {300 | 301 | 302 | 303 | 304 | 305 | 306 | 307 | 308} status
	 * @param {string} location
	 */
	constructor(status, location) {
		this.status = status;
		this.location = location;
	}
}

/**
 * An error that was thrown from within the SvelteKit runtime that is not fatal and doesn't result in a 500, such as a 404.
 * `SvelteKitError` goes through `handleError`.
 * @extends Error
 */
export class SvelteKitError extends Error {
	/**
	 * @param {number} status
	 * @param {string} text
	 * @param {string} message
	 */
	constructor(status, text, message) {
		super(message);
		this.status = status;
		this.text = text;
	}
}

/**
 * @template {Record<string, unknown> | undefined} [T=undefined]
 */
export class ActionFailure {
	/**
	 * @param {number} status
	 * @param {T} data
	 */
	constructor(status, data) {
		this.status = status;
		this.data = data;
	}
}

/**
 * This is a grotesque hack that, in dev, allows us to replace the implementations
 * of these classes that you'd get by importing them from `@sveltejs/kit` with the
 * ones that are imported via Vite and loaded internally, so that instanceof
 * checks work even though SvelteKit imports this module via Vite and consumers
 * import it via Node
 * @param {{
 *   ActionFailure: typeof ActionFailure;
 *   HttpError: typeof HttpError;
 *   Redirect: typeof Redirect;
 *   SvelteKitError: typeof SvelteKitError;
 * }} implementations
 */
export function replace_implementations(implementations) {
	// @ts-expect-error
	ActionFailure = implementations.ActionFailure; // eslint-disable-line no-class-assign
	// @ts-expect-error
	HttpError = implementations.HttpError; // eslint-disable-line no-class-assign
	// @ts-expect-error
	Redirect = implementations.Redirect; // eslint-disable-line no-class-assign
	// @ts-expect-error
	SvelteKitError = implementations.SvelteKitError; // eslint-disable-line no-class-assign
}

```


####### packages/kit/src/runtime/env/dynamic/private.js #######

```

export { private_env as env } from '../../shared-server.js';

```


####### packages/kit/src/runtime/env/dynamic/public.js #######

```

export { public_env as env } from '../../shared-server.js';

```


####### packages/kit/src/runtime/hash.js #######

```

/**
 * Hash using djb2
 * @param {import('types').StrictBody[]} values
 */
export function hash(...values) {
	let hash = 5381;

	for (const value of values) {
		if (typeof value === 'string') {
			let i = value.length;
			while (i) hash = (hash * 33) ^ value.charCodeAt(--i);
		} else if (ArrayBuffer.isView(value)) {
			const buffer = new Uint8Array(value.buffer, value.byteOffset, value.byteLength);
			let i = buffer.length;
			while (i) hash = (hash * 33) ^ buffer[--i];
		} else {
			throw new TypeError('value must be a string or TypedArray');
		}
	}

	return (hash >>> 0).toString(36);
}

```


####### packages/kit/src/runtime/server/ambient.d.ts #######

```

declare module '__SERVER__/internal.js' {
	export const options: import('types').SSROptions;
	export const get_hooks: () => Promise<Partial<import('types').ServerHooks>>;
}

```


####### packages/kit/src/runtime/server/cookie.js #######

```

import { parse, serialize } from 'cookie';
import { add_data_suffix, normalize_path, resolve } from '../../utils/url.js';

/**
 * Tracks all cookies set during dev mode so we can emit warnings
 * when we detect that there's likely cookie misusage due to wrong paths
 *
 * @type {Record<string, Set<string>>} */
const cookie_paths = {};

/**
 * Cookies that are larger than this size (including the name and other
 * attributes) are discarded by browsers
 */
const MAX_COOKIE_SIZE = 4129;

// TODO 3.0 remove this check
/** @param {import('./page/types.js').Cookie['options']} options */
function validate_options(options) {
	if (options?.path === undefined) {
		throw new Error('You must specify a `path` when setting, deleting or serializing cookies');
	}
}

/**
 * @param {Request} request
 * @param {URL} url
 * @param {import('types').TrailingSlash} trailing_slash
 */
export function get_cookies(request, url, trailing_slash) {
	const header = request.headers.get('cookie') ?? '';
	const initial_cookies = parse(header, { decode: (value) => value });

	const normalized_url = normalize_path(url.pathname, trailing_slash);

	/** @type {Record<string, import('./page/types.js').Cookie>} */
	const new_cookies = {};

	/** @type {import('cookie').CookieSerializeOptions} */
	const defaults = {
		httpOnly: true,
		sameSite: 'lax',
		secure: url.hostname === 'localhost' && url.protocol === 'http:' ? false : true
	};

	/** @type {import('@sveltejs/kit').Cookies} */
	const cookies = {
		// The JSDoc param annotations appearing below for get, set and delete
		// are necessary to expose the `cookie` library types to
		// typescript users. `@type {import('@sveltejs/kit').Cookies}` above is not
		// sufficient to do so.

		/**
		 * @param {string} name
		 * @param {import('cookie').CookieParseOptions} opts
		 */
		get(name, opts) {
			const c = new_cookies[name];
			if (
				c &&
				domain_matches(url.hostname, c.options.domain) &&
				path_matches(url.pathname, c.options.path)
			) {
				return c.value;
			}

			const decoder = opts?.decode || decodeURIComponent;
			const req_cookies = parse(header, { decode: decoder });
			const cookie = req_cookies[name]; // the decoded string or undefined

			// in development, if the cookie was set during this session with `cookies.set`,
			// but at a different path, warn the user. (ignore cookies from request headers,
			// since we don't know which path they were set at)
			if (__SVELTEKIT_DEV__ && !cookie) {
				const paths = Array.from(cookie_paths[name] ?? []).filter((path) => {
					// we only care about paths that are _more_ specific than the current path
					return path_matches(path, url.pathname) && path !== url.pathname;
				});

				if (paths.length > 0) {
					console.warn(
						// prettier-ignore
						`'${name}' cookie does not exist for ${url.pathname}, but was previously set at ${conjoin([...paths])}. Did you mean to set its 'path' to '/' instead?`
					);
				}
			}

			return cookie;
		},

		/**
		 * @param {import('cookie').CookieParseOptions} opts
		 */
		getAll(opts) {
			const decoder = opts?.decode || decodeURIComponent;
			const cookies = parse(header, { decode: decoder });

			for (const c of Object.values(new_cookies)) {
				if (
					domain_matches(url.hostname, c.options.domain) &&
					path_matches(url.pathname, c.options.path)
				) {
					cookies[c.name] = c.value;
				}
			}

			return Object.entries(cookies).map(([name, value]) => ({ name, value }));
		},

		/**
		 * @param {string} name
		 * @param {string} value
		 * @param {import('./page/types.js').Cookie['options']} options
		 */
		set(name, value, options) {
			validate_options(options);
			set_internal(name, value, { ...defaults, ...options });
		},

		/**
		 * @param {string} name
		 *  @param {import('./page/types.js').Cookie['options']} options
		 */
		delete(name, options) {
			validate_options(options);
			cookies.set(name, '', { ...options, maxAge: 0 });
		},

		/**
		 * @param {string} name
		 * @param {string} value
		 *  @param {import('./page/types.js').Cookie['options']} options
		 */
		serialize(name, value, options) {
			validate_options(options);

			let path = options.path;

			if (!options.domain || options.domain === url.hostname) {
				path = resolve(normalized_url, path);
			}

			return serialize(name, value, { ...defaults, ...options, path });
		}
	};

	/**
	 * @param {URL} destination
	 * @param {string | null} header
	 */
	function get_cookie_header(destination, header) {
		/** @type {Record<string, string>} */
		const combined_cookies = {
			// cookies sent by the user agent have lowest precedence
			...initial_cookies
		};

		// cookies previous set during this event with cookies.set have higher precedence
		for (const key in new_cookies) {
			const cookie = new_cookies[key];
			if (!domain_matches(destination.hostname, cookie.options.domain)) continue;
			if (!path_matches(destination.pathname, cookie.options.path)) continue;

			const encoder = cookie.options.encode || encodeURIComponent;
			combined_cookies[cookie.name] = encoder(cookie.value);
		}

		// explicit header has highest precedence
		if (header) {
			const parsed = parse(header, { decode: (value) => value });
			for (const name in parsed) {
				combined_cookies[name] = parsed[name];
			}
		}

		return Object.entries(combined_cookies)
			.map(([name, value]) => `${name}=${value}`)
			.join('; ');
	}

	/**
	 * @param {string} name
	 * @param {string} value
	 * @param {import('./page/types.js').Cookie['options']} options
	 */
	function set_internal(name, value, options) {
		let path = options.path;

		if (!options.domain || options.domain === url.hostname) {
			path = resolve(normalized_url, path);
		}

		new_cookies[name] = { name, value, options: { ...options, path } };

		if (__SVELTEKIT_DEV__) {
			const serialized = serialize(name, value, new_cookies[name].options);
			if (new TextEncoder().encode(serialized).byteLength > MAX_COOKIE_SIZE) {
				throw new Error(`Cookie "${name}" is too large, and will be discarded by the browser`);
			}

			cookie_paths[name] ??= new Set();

			if (!value) {
				cookie_paths[name].delete(path);
			} else {
				cookie_paths[name].add(path);
			}
		}
	}

	return { cookies, new_cookies, get_cookie_header, set_internal };
}

/**
 * @param {string} hostname
 * @param {string} [constraint]
 */
export function domain_matches(hostname, constraint) {
	if (!constraint) return true;

	const normalized = constraint[0] === '.' ? constraint.slice(1) : constraint;

	if (hostname === normalized) return true;
	return hostname.endsWith('.' + normalized);
}

/**
 * @param {string} path
 * @param {string} [constraint]
 */
export function path_matches(path, constraint) {
	if (!constraint) return true;

	const normalized = constraint.endsWith('/') ? constraint.slice(0, -1) : constraint;

	if (path === normalized) return true;
	return path.startsWith(normalized + '/');
}

/**
 * @param {Headers} headers
 * @param {import('./page/types.js').Cookie[]} cookies
 */
export function add_cookies_to_headers(headers, cookies) {
	for (const new_cookie of cookies) {
		const { name, value, options } = new_cookie;
		headers.append('set-cookie', serialize(name, value, options));

		// special case — for routes ending with .html, the route data lives in a sibling
		// `.html__data.json` file rather than a child `/__data.json` file, which means
		// we need to duplicate the cookie
		if (options.path.endsWith('.html')) {
			const path = add_data_suffix(options.path);
			headers.append('set-cookie', serialize(name, value, { ...options, path }));
		}
	}
}

/**
 * @param {string[]} array
 */
function conjoin(array) {
	if (array.length <= 2) return array.join(' and ');
	return `${array.slice(0, -1).join(', ')} and ${array.at(-1)}`;
}

```


####### packages/kit/src/runtime/server/cookie.spec.js #######

```

import { assert, expect, test } from 'vitest';
import { domain_matches, path_matches, get_cookies } from './cookie.js';
import { installPolyfills } from '../../exports/node/polyfills.js';

installPolyfills();

// @ts-expect-error
globalThis.__SVELTEKIT_DEV__ = false;

const domains = {
	positive: [
		['localhost'],
		['example.com', 'example.com'],
		['sub.example.com', 'example.com'],
		['example.com', '.example.com'],
		['sub.example.com', '.example.com']
	]
};

const paths = {
	positive: [['/'], ['/foo', '/'], ['/foo', '/foo'], ['/foo/', '/foo'], ['/foo', '/foo/']],

	negative: [
		['/', '/foo'],
		['/food', '/foo']
	]
};

domains.positive.forEach(([hostname, constraint]) => {
	test(`${hostname} / ${constraint}`, () => {
		assert.ok(domain_matches(hostname, constraint));
	});
});

paths.positive.forEach(([path, constraint]) => {
	test(`${path} / ${constraint}`, () => {
		assert.ok(path_matches(path, constraint));
	});
});

paths.negative.forEach(([path, constraint]) => {
	test(`! ${path} / ${constraint}`, () => {
		assert.isFalse(path_matches(path, constraint));
	});
});

/** @param {{ href?: string, headers?: Record<string, string> }} href */
const cookies_setup = ({ href, headers } = {}) => {
	const url = new URL(href || 'https://example.com');
	const request = new Request(url, {
		headers: new Headers({
			cookie: 'a=b;',
			...headers
		})
	});
	return get_cookies(request, url, 'ignore');
};

test('a cookie should not be present after it is deleted', () => {
	const { cookies } = cookies_setup();
	cookies.set('a', 'b', { path: '/' });
	expect(cookies.get('a')).toEqual('b');
	cookies.delete('a', { path: '/' });
	assert.isNotOk(cookies.get('a'));
});

test('default values when set is called', () => {
	const { cookies, new_cookies } = cookies_setup();
	cookies.set('a', 'b', { path: '/' });
	const opts = new_cookies['a']?.options;
	assert.equal(opts?.secure, true);
	assert.equal(opts?.httpOnly, true);
	assert.equal(opts?.path, '/');
	assert.equal(opts?.sameSite, 'lax');
});

test('default values when set is called on sub path', () => {
	const { cookies, new_cookies } = cookies_setup({ href: 'https://example.com/foo/bar' });
	cookies.set('a', 'b', { path: '' });
	const opts = new_cookies['a']?.options;
	assert.equal(opts?.secure, true);
	assert.equal(opts?.httpOnly, true);
	assert.equal(opts?.path, '/foo/bar');
	assert.equal(opts?.sameSite, 'lax');
});

test('default values when on localhost', () => {
	const { cookies, new_cookies } = cookies_setup({ href: 'http://localhost:1234' });
	cookies.set('a', 'b', { path: '/' });
	const opts = new_cookies['a']?.options;
	assert.equal(opts?.secure, false);
});

test('overridden defaults when set is called', () => {
	const { cookies, new_cookies } = cookies_setup();
	cookies.set('a', 'b', { secure: false, httpOnly: false, sameSite: 'strict', path: '/a/b/c' });
	const opts = new_cookies['a']?.options;
	assert.equal(opts?.secure, false);
	assert.equal(opts?.httpOnly, false);
	assert.equal(opts?.path, '/a/b/c');
	assert.equal(opts?.sameSite, 'strict');
});

test('default values when delete is called', () => {
	const { cookies, new_cookies } = cookies_setup();
	cookies.delete('a', { path: '/' });
	const opts = new_cookies['a']?.options;
	assert.equal(opts?.secure, true);
	assert.equal(opts?.httpOnly, true);
	assert.equal(opts?.path, '/');
	assert.equal(opts?.sameSite, 'lax');
	assert.equal(opts?.maxAge, 0);
});

test('overridden defaults when delete is called', () => {
	const { cookies, new_cookies } = cookies_setup();
	cookies.delete('a', { secure: false, httpOnly: false, sameSite: 'strict', path: '/a/b/c' });
	const opts = new_cookies['a']?.options;
	assert.equal(opts?.secure, false);
	assert.equal(opts?.httpOnly, false);
	assert.equal(opts?.path, '/a/b/c');
	assert.equal(opts?.sameSite, 'strict');
	assert.equal(opts?.maxAge, 0);
});

test('cannot override maxAge on delete', () => {
	const { cookies, new_cookies } = cookies_setup();
	cookies.delete('a', { path: '/', maxAge: 1234 });
	const opts = new_cookies['a']?.options;
	assert.equal(opts?.maxAge, 0);
});

test('last cookie set with the same name wins', () => {
	const { cookies, new_cookies } = cookies_setup();
	cookies.set('a', 'foo', { path: '/' });
	cookies.set('a', 'bar', { path: '/' });
	const entry = new_cookies['a'];
	assert.equal(entry?.value, 'bar');
});

test('cookie names are case sensitive', () => {
	const { cookies, new_cookies } = cookies_setup();
	// not that one should do this, but we follow the spec...
	cookies.set('a', 'foo', { path: '/' });
	cookies.set('A', 'bar', { path: '/' });
	const entrya = new_cookies['a'];
	const entryA = new_cookies['A'];
	assert.equal(entrya?.value, 'foo');
	assert.equal(entryA?.value, 'bar');
});

test('serialized cookie header should be url-encoded', () => {
	const href = 'https://example.com';
	const { cookies, get_cookie_header } = cookies_setup({
		href,
		headers: {
			cookie: 'a=f%C3%BC; b=foo+bar' // a=fü
		}
	});
	cookies.set('c', 'fö', { path: '/' }); // should use default encoding
	cookies.set('d', 'fö', { path: '/', encode: () => 'öf' }); // should respect `encode`
	const header = get_cookie_header(new URL(href), 'e=f%C3%A4; f=foo+bar');
	assert.equal(header, 'a=f%C3%BC; b=foo+bar; c=f%C3%B6; d=öf; e=f%C3%A4; f=foo+bar');
});

test('warns if cookie exceeds 4,129 bytes', () => {
	// @ts-expect-error
	globalThis.__SVELTEKIT_DEV__ = true;

	try {
		const { cookies } = cookies_setup();
		cookies.set('a', 'a'.repeat(4097), { path: '/' });
	} catch (e) {
		const error = /** @type {Error} */ (e);

		assert.equal(error.message, 'Cookie "a" is too large, and will be discarded by the browser');
	} finally {
		// @ts-expect-error
		globalThis.__SVELTEKIT_DEV__ = false;
	}
});

test('get all cookies from header and set calls', () => {
	const { cookies } = cookies_setup();
	expect(cookies.getAll()).toEqual([{ name: 'a', value: 'b' }]);

	cookies.set('a', 'foo', { path: '/' });
	cookies.set('a', 'bar', { path: '/' });
	cookies.set('b', 'baz', { path: '/' });

	expect(cookies.getAll()).toEqual([
		{ name: 'a', value: 'bar' },
		{ name: 'b', value: 'baz' }
	]);
});

test("set_internal isn't affected by defaults", () => {
	const { cookies, new_cookies, set_internal } = cookies_setup({
		href: 'https://example.com/a/b/c'
	});

	const options = {
		secure: false,
		httpOnly: false,
		sameSite: /** @type {const} */ ('none'),
		path: '/a/b/c'
	};

	set_internal('test', 'foo', options);

	expect(cookies.get('test')).toEqual('foo');
	expect(new_cookies['test']?.options).toEqual(options);
});

```


####### packages/kit/src/runtime/server/data/index.js #######

```

import { HttpError, SvelteKitError, Redirect } from '../../control.js';
import { normalize_error } from '../../../utils/error.js';
import { once } from '../../../utils/functions.js';
import { load_server_data } from '../page/load_data.js';
import { clarify_devalue_error, handle_error_and_jsonify, stringify_uses } from '../utils.js';
import { normalize_path } from '../../../utils/url.js';
import { text } from '../../../exports/index.js';
import * as devalue from 'devalue';
import { create_async_iterator } from '../../../utils/streaming.js';

const encoder = new TextEncoder();

/**
 * @param {import('@sveltejs/kit').RequestEvent} event
 * @param {import('types').SSRRoute} route
 * @param {import('types').SSROptions} options
 * @param {import('@sveltejs/kit').SSRManifest} manifest
 * @param {import('types').SSRState} state
 * @param {boolean[] | undefined} invalidated_data_nodes
 * @param {import('types').TrailingSlash} trailing_slash
 * @returns {Promise<Response>}
 */
export async function render_data(
	event,
	route,
	options,
	manifest,
	state,
	invalidated_data_nodes,
	trailing_slash
) {
	if (!route.page) {
		// requesting /__data.json should fail for a +server.js
		return new Response(undefined, {
			status: 404
		});
	}

	try {
		const node_ids = [...route.page.layouts, route.page.leaf];
		const invalidated = invalidated_data_nodes ?? node_ids.map(() => true);

		let aborted = false;

		const url = new URL(event.url);
		url.pathname = normalize_path(url.pathname, trailing_slash);

		const new_event = { ...event, url };

		const functions = node_ids.map((n, i) => {
			return once(async () => {
				try {
					if (aborted) {
						return /** @type {import('types').ServerDataSkippedNode} */ ({
							type: 'skip'
						});
					}

					// == because it could be undefined (in dev) or null (in build, because of JSON.stringify)
					const node = n == undefined ? n : await manifest._.nodes[n]();
					// load this. for the child, return as is. for the final result, stream things
					return load_server_data({
						event: new_event,
						state,
						node,
						parent: async () => {
							/** @type {Record<string, any>} */
							const data = {};
							for (let j = 0; j < i; j += 1) {
								const parent = /** @type {import('types').ServerDataNode | null} */ (
									await functions[j]()
								);

								if (parent) {
									Object.assign(data, parent.data);
								}
							}
							return data;
						}
					});
				} catch (e) {
					aborted = true;
					throw e;
				}
			});
		});

		const promises = functions.map(async (fn, i) => {
			if (!invalidated[i]) {
				return /** @type {import('types').ServerDataSkippedNode} */ ({
					type: 'skip'
				});
			}

			return fn();
		});

		let length = promises.length;
		const nodes = await Promise.all(
			promises.map((p, i) =>
				p.catch(async (error) => {
					if (error instanceof Redirect) {
						throw error;
					}

					// Math.min because array isn't guaranteed to resolve in order
					length = Math.min(length, i + 1);

					return /** @type {import('types').ServerErrorNode} */ ({
						type: 'error',
						error: await handle_error_and_jsonify(event, options, error),
						status:
							error instanceof HttpError || error instanceof SvelteKitError
								? error.status
								: undefined
					});
				})
			)
		);

		const { data, chunks } = get_data_json(event, options, nodes);

		if (!chunks) {
			// use a normal JSON response where possible, so we get `content-length`
			// and can use browser JSON devtools for easier inspecting
			return json_response(data);
		}

		return new Response(
			new ReadableStream({
				async start(controller) {
					controller.enqueue(encoder.encode(data));
					for await (const chunk of chunks) {
						controller.enqueue(encoder.encode(chunk));
					}
					controller.close();
				},

				type: 'bytes'
			}),
			{
				headers: {
					// we use a proprietary content type to prevent buffering.
					// the `text` prefix makes it inspectable
					'content-type': 'text/sveltekit-data',
					'cache-control': 'private, no-store'
				}
			}
		);
	} catch (e) {
		const error = normalize_error(e);

		if (error instanceof Redirect) {
			return redirect_json_response(error);
		} else {
			return json_response(await handle_error_and_jsonify(event, options, error), 500);
		}
	}
}

/**
 * @param {Record<string, any> | string} json
 * @param {number} [status]
 */
function json_response(json, status = 200) {
	return text(typeof json === 'string' ? json : JSON.stringify(json), {
		status,
		headers: {
			'content-type': 'application/json',
			'cache-control': 'private, no-store'
		}
	});
}

/**
 * @param {Redirect} redirect
 */
export function redirect_json_response(redirect) {
	return json_response({
		type: 'redirect',
		location: redirect.location
	});
}

/**
 * If the serialized data contains promises, `chunks` will be an
 * async iterable containing their resolutions
 * @param {import('@sveltejs/kit').RequestEvent} event
 * @param {import('types').SSROptions} options
 * @param {Array<import('types').ServerDataSkippedNode | import('types').ServerDataNode | import('types').ServerErrorNode | null | undefined>} nodes
 *  @returns {{ data: string, chunks: AsyncIterable<string> | null }}
 */
export function get_data_json(event, options, nodes) {
	let promise_id = 1;
	let count = 0;

	const { iterator, push, done } = create_async_iterator();

	const reducers = {
		/** @param {any} thing */
		Promise: (thing) => {
			if (typeof thing?.then === 'function') {
				const id = promise_id++;
				count += 1;

				/** @type {'data' | 'error'} */
				let key = 'data';

				thing
					.catch(
						/** @param {any} e */ async (e) => {
							key = 'error';
							return handle_error_and_jsonify(event, options, /** @type {any} */ (e));
						}
					)
					.then(
						/** @param {any} value */
						async (value) => {
							let str;
							try {
								str = devalue.stringify(value, reducers);
							} catch (e) {
								const error = await handle_error_and_jsonify(
									event,
									options,
									new Error(`Failed to serialize promise while rendering ${event.route.id}`)
								);

								key = 'error';
								str = devalue.stringify(error, reducers);
							}

							count -= 1;

							push(`{"type":"chunk","id":${id},"${key}":${str}}\n`);
							if (count === 0) done();
						}
					);

				return id;
			}
		}
	};

	try {
		const strings = nodes.map((node) => {
			if (!node) return 'null';

			if (node.type === 'error' || node.type === 'skip') {
				return JSON.stringify(node);
			}

			return `{"type":"data","data":${devalue.stringify(node.data, reducers)},${stringify_uses(
				node
			)}${node.slash ? `,"slash":${JSON.stringify(node.slash)}` : ''}}`;
		});

		return {
			data: `{"type":"data","nodes":[${strings.join(',')}]}\n`,
			chunks: count > 0 ? iterator : null
		};
	} catch (e) {
		throw new Error(clarify_devalue_error(event, /** @type {any} */ (e)));
	}
}

```


####### packages/kit/src/runtime/server/endpoint.js #######

```

import { ENDPOINT_METHODS, PAGE_METHODS } from '../../constants.js';
import { negotiate } from '../../utils/http.js';
import { Redirect } from '../control.js';
import { method_not_allowed } from './utils.js';

/**
 * @param {import('@sveltejs/kit').RequestEvent} event
 * @param {import('types').SSREndpoint} mod
 * @param {import('types').SSRState} state
 * @returns {Promise<Response>}
 */
export async function render_endpoint(event, mod, state) {
	const method = /** @type {import('types').HttpMethod} */ (event.request.method);

	let handler = mod[method] || mod.fallback;

	if (method === 'HEAD' && mod.GET && !mod.HEAD) {
		handler = mod.GET;
	}

	if (!handler) {
		return method_not_allowed(mod, method);
	}

	const prerender = mod.prerender ?? state.prerender_default;

	if (prerender && (mod.POST || mod.PATCH || mod.PUT || mod.DELETE)) {
		throw new Error('Cannot prerender endpoints that have mutative methods');
	}

	if (state.prerendering && !prerender) {
		if (state.depth > 0) {
			// if request came from a prerendered page, bail
			throw new Error(`${event.route.id} is not prerenderable`);
		} else {
			// if request came direct from the crawler, signal that
			// this route cannot be prerendered, but don't bail
			return new Response(undefined, { status: 204 });
		}
	}

	try {
		let response = await handler(
			/** @type {import('@sveltejs/kit').RequestEvent<Record<string, any>>} */ (event)
		);

		if (!(response instanceof Response)) {
			throw new Error(
				`Invalid response from route ${event.url.pathname}: handler should return a Response object`
			);
		}

		if (state.prerendering) {
			// the returned Response might have immutable Headers
			// so we should clone them before trying to mutate them
			response = new Response(response.body, {
				status: response.status,
				statusText: response.statusText,
				headers: new Headers(response.headers)
			});
			response.headers.set('x-sveltekit-prerender', String(prerender));
		}

		return response;
	} catch (e) {
		if (e instanceof Redirect) {
			return new Response(undefined, {
				status: e.status,
				headers: { location: e.location }
			});
		}

		throw e;
	}
}

/**
 * @param {import('@sveltejs/kit').RequestEvent} event
 */
export function is_endpoint_request(event) {
	const { method, headers } = event.request;

	// These methods exist exclusively for endpoints
	if (ENDPOINT_METHODS.includes(method) && !PAGE_METHODS.includes(method)) {
		return true;
	}

	// use:enhance uses a custom header to disambiguate
	if (method === 'POST' && headers.get('x-sveltekit-action') === 'true') return false;

	// GET/POST requests may be for endpoints or pages. We prefer endpoints if this isn't a text/html request
	const accept = event.request.headers.get('accept') ?? '*/*';
	return negotiate(accept, ['*', 'text/html']) !== 'text/html';
}

```


####### packages/kit/src/runtime/server/env_module.js #######

```

import { public_env } from '../shared-server.js';

/** @type {string} */
let body;

/** @type {string} */
let etag;

/** @type {Headers} */
let headers;

/**
 * @param {Request} request
 * @returns {Response}
 */
export function get_public_env(request) {
	body ??= `export const env=${JSON.stringify(public_env)}`;
	etag ??= `W/${Date.now()}`;
	headers ??= new Headers({
		'content-type': 'application/javascript; charset=utf-8',
		etag
	});

	if (request.headers.get('if-none-match') === etag) {
		return new Response(undefined, { status: 304, headers });
	}

	return new Response(body, { headers });
}

```


####### packages/kit/src/runtime/server/fetch.js #######

```

import * as set_cookie_parser from 'set-cookie-parser';
import { respond } from './respond.js';
import * as paths from '__sveltekit/paths';

/**
 * @param {{
 *   event: import('@sveltejs/kit').RequestEvent;
 *   options: import('types').SSROptions;
 *   manifest: import('@sveltejs/kit').SSRManifest;
 *   state: import('types').SSRState;
 *   get_cookie_header: (url: URL, header: string | null) => string;
 *   set_internal: (name: string, value: string, opts: import('./page/types.js').Cookie['options']) => void;
 * }} opts
 * @returns {typeof fetch}
 */
export function create_fetch({ event, options, manifest, state, get_cookie_header, set_internal }) {
	/**
	 * @type {typeof fetch}
	 */
	const server_fetch = async (info, init) => {
		const original_request = normalize_fetch_input(info, init, event.url);

		// some runtimes (e.g. Cloudflare) error if you access `request.mode`,
		// annoyingly, so we need to read the value from the `init` object instead
		let mode = (info instanceof Request ? info.mode : init?.mode) ?? 'cors';
		let credentials =
			(info instanceof Request ? info.credentials : init?.credentials) ?? 'same-origin';

		return options.hooks.handleFetch({
			event,
			request: original_request,
			fetch: async (info, init) => {
				const request = normalize_fetch_input(info, init, event.url);

				const url = new URL(request.url);

				if (!request.headers.has('origin')) {
					request.headers.set('origin', event.url.origin);
				}

				if (info !== original_request) {
					mode = (info instanceof Request ? info.mode : init?.mode) ?? 'cors';
					credentials =
						(info instanceof Request ? info.credentials : init?.credentials) ?? 'same-origin';
				}

				// Remove Origin, according to https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin#description
				if (
					(request.method === 'GET' || request.method === 'HEAD') &&
					((mode === 'no-cors' && url.origin !== event.url.origin) ||
						url.origin === event.url.origin)
				) {
					request.headers.delete('origin');
				}

				if (url.origin !== event.url.origin) {
					// Allow cookie passthrough for "credentials: same-origin" and "credentials: include"
					// if SvelteKit is serving my.domain.com:
					// -        domain.com WILL NOT receive cookies
					// -     my.domain.com WILL receive cookies
					// -    api.domain.dom WILL NOT receive cookies
					// - sub.my.domain.com WILL receive cookies
					// ports do not affect the resolution
					// leading dot prevents mydomain.com matching domain.com
					// Do not forward other cookies for "credentials: include" because we don't know
					// which cookie belongs to which domain (browser does not pass this info)
					if (`.${url.hostname}`.endsWith(`.${event.url.hostname}`) && credentials !== 'omit') {
						const cookie = get_cookie_header(url, request.headers.get('cookie'));
						if (cookie) request.headers.set('cookie', cookie);
					}

					return fetch(request);
				}

				// handle fetch requests for static assets. e.g. prebaked data, etc.
				// we need to support everything the browser's fetch supports
				const prefix = paths.assets || paths.base;
				const decoded = decodeURIComponent(url.pathname);
				const filename = (
					decoded.startsWith(prefix) ? decoded.slice(prefix.length) : decoded
				).slice(1);
				const filename_html = `${filename}/index.html`; // path may also match path/index.html

				const is_asset = manifest.assets.has(filename);
				const is_asset_html = manifest.assets.has(filename_html);

				if (is_asset || is_asset_html) {
					const file = is_asset ? filename : filename_html;

					if (state.read) {
						const type = is_asset
							? manifest.mimeTypes[filename.slice(filename.lastIndexOf('.'))]
							: 'text/html';

						return new Response(state.read(file), {
							headers: type ? { 'content-type': type } : {}
						});
					}

					return await fetch(request);
				}

				if (credentials !== 'omit') {
					const cookie = get_cookie_header(url, request.headers.get('cookie'));
					if (cookie) {
						request.headers.set('cookie', cookie);
					}

					const authorization = event.request.headers.get('authorization');
					if (authorization && !request.headers.has('authorization')) {
						request.headers.set('authorization', authorization);
					}
				}

				if (!request.headers.has('accept')) {
					request.headers.set('accept', '*/*');
				}

				if (!request.headers.has('accept-language')) {
					request.headers.set(
						'accept-language',
						/** @type {string} */ (event.request.headers.get('accept-language'))
					);
				}

				/** @type {Response} */
				const response = await respond(request, options, manifest, {
					...state,
					depth: state.depth + 1
				});

				const set_cookie = response.headers.get('set-cookie');
				if (set_cookie) {
					for (const str of set_cookie_parser.splitCookiesString(set_cookie)) {
						const { name, value, ...options } = set_cookie_parser.parseString(str, {
							decodeValues: false
						});

						const path = options.path ?? (url.pathname.split('/').slice(0, -1).join('/') || '/');

						// options.sameSite is string, something more specific is required - type cast is safe
						set_internal(name, value, {
							path,
							encode: (value) => value,
							.../** @type {import('cookie').CookieSerializeOptions} */ (options)
						});
					}
				}

				return response;
			}
		});
	};

	// Don't make this function `async`! Otherwise, the user has to `catch` promises they use for streaming responses or else
	// it will be an unhandled rejection. Instead, we add a `.catch(() => {})` ourselves below to this from happening.
	return (input, init) => {
		// See docs in fetch.js for why we need to do this
		const response = server_fetch(input, init);
		response.catch(() => {});
		return response;
	};
}

/**
 * @param {RequestInfo | URL} info
 * @param {RequestInit | undefined} init
 * @param {URL} url
 */
function normalize_fetch_input(info, init, url) {
	if (info instanceof Request) {
		return info;
	}

	return new Request(typeof info === 'string' ? new URL(info, url) : info, init);
}

```


####### packages/kit/src/runtime/server/index.js #######

```

import { respond } from './respond.js';
import { set_private_env, set_public_env, set_safe_public_env } from '../shared-server.js';
import { options, get_hooks } from '__SERVER__/internal.js';
import { DEV } from 'esm-env';
import { filter_private_env, filter_public_env } from '../../utils/env.js';
import { prerendering } from '__sveltekit/environment';
import { set_read_implementation, set_manifest } from '__sveltekit/server';

/** @type {ProxyHandler<{ type: 'public' | 'private' }>} */
const prerender_env_handler = {
	get({ type }, prop) {
		throw new Error(
			`Cannot read values from $env/dynamic/${type} while prerendering (attempted to read env.${prop.toString()}). Use $env/static/${type} instead`
		);
	}
};

export class Server {
	/** @type {import('types').SSROptions} */
	#options;

	/** @type {import('@sveltejs/kit').SSRManifest} */
	#manifest;

	/** @param {import('@sveltejs/kit').SSRManifest} manifest */
	constructor(manifest) {
		/** @type {import('types').SSROptions} */
		this.#options = options;
		this.#manifest = manifest;

		set_manifest(manifest);
	}

	/**
	 * @param {{
	 *   env: Record<string, string>;
	 *   read?: (file: string) => ReadableStream;
	 * }} opts
	 */
	async init({ env, read }) {
		// Take care: Some adapters may have to call `Server.init` per-request to set env vars,
		// so anything that shouldn't be rerun should be wrapped in an `if` block to make sure it hasn't
		// been done already.

		// set env, in case it's used in initialisation
		const prefixes = {
			public_prefix: this.#options.env_public_prefix,
			private_prefix: this.#options.env_private_prefix
		};

		const private_env = filter_private_env(env, prefixes);
		const public_env = filter_public_env(env, prefixes);

		set_private_env(
			prerendering ? new Proxy({ type: 'private' }, prerender_env_handler) : private_env
		);
		set_public_env(
			prerendering ? new Proxy({ type: 'public' }, prerender_env_handler) : public_env
		);
		set_safe_public_env(public_env);

		if (read) {
			set_read_implementation(read);
		}

		if (!this.#options.hooks) {
			try {
				const module = await get_hooks();

				this.#options.hooks = {
					handle: module.handle || (({ event, resolve }) => resolve(event)),
					handleError: module.handleError || (({ error }) => console.error(error)),
					handleFetch: module.handleFetch || (({ request, fetch }) => fetch(request)),
					reroute: module.reroute || (() => {})
				};
			} catch (error) {
				if (DEV) {
					this.#options.hooks = {
						handle: () => {
							throw error;
						},
						handleError: ({ error }) => console.error(error),
						handleFetch: ({ request, fetch }) => fetch(request),
						reroute: () => {}
					};
				} else {
					throw error;
				}
			}
		}
	}

	/**
	 * @param {Request} request
	 * @param {import('types').RequestOptions} options
	 */
	async respond(request, options) {
		return respond(request, this.#options, this.#manifest, {
			...options,
			error: false,
			depth: 0
		});
	}
}

```


####### packages/kit/src/runtime/server/page/actions.js #######

```

import * as devalue from 'devalue';
import { json } from '../../../exports/index.js';
import { get_status, normalize_error } from '../../../utils/error.js';
import { is_form_content_type, negotiate } from '../../../utils/http.js';
import { HttpError, Redirect, ActionFailure, SvelteKitError } from '../../control.js';
import { handle_error_and_jsonify } from '../utils.js';

/** @param {import('@sveltejs/kit').RequestEvent} event */
export function is_action_json_request(event) {
	const accept = negotiate(event.request.headers.get('accept') ?? '*/*', [
		'application/json',
		'text/html'
	]);

	return accept === 'application/json' && event.request.method === 'POST';
}

/**
 * @param {import('@sveltejs/kit').RequestEvent} event
 * @param {import('types').SSROptions} options
 * @param {import('types').SSRNode['server'] | undefined} server
 */
export async function handle_action_json_request(event, options, server) {
	const actions = server?.actions;

	if (!actions) {
		const no_actions_error = new SvelteKitError(
			405,
			'Method Not Allowed',
			'POST method not allowed. No actions exist for this page'
		);
		return action_json(
			{
				type: 'error',
				error: await handle_error_and_jsonify(event, options, no_actions_error)
			},
			{
				status: no_actions_error.status,
				headers: {
					// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/405
					// "The server must generate an Allow header field in a 405 status code response"
					allow: 'GET'
				}
			}
		);
	}

	check_named_default_separate(actions);

	try {
		const data = await call_action(event, actions);

		if (__SVELTEKIT_DEV__) {
			validate_action_return(data);
		}

		if (data instanceof ActionFailure) {
			return action_json({
				type: 'failure',
				status: data.status,
				// @ts-expect-error we assign a string to what is supposed to be an object. That's ok
				// because we don't use the object outside, and this way we have better code navigation
				// through knowing where the related interface is used.
				data: stringify_action_response(data.data, /** @type {string} */ (event.route.id))
			});
		} else {
			return action_json({
				type: 'success',
				status: data ? 200 : 204,
				// @ts-expect-error see comment above
				data: stringify_action_response(data, /** @type {string} */ (event.route.id))
			});
		}
	} catch (e) {
		const err = normalize_error(e);

		if (err instanceof Redirect) {
			return action_json_redirect(err);
		}

		return action_json(
			{
				type: 'error',
				error: await handle_error_and_jsonify(event, options, check_incorrect_fail_use(err))
			},
			{
				status: get_status(err)
			}
		);
	}
}

/**
 * @param {HttpError | Error} error
 */
function check_incorrect_fail_use(error) {
	return error instanceof ActionFailure
		? new Error('Cannot "throw fail()". Use "return fail()"')
		: error;
}

/**
 * @param {import('@sveltejs/kit').Redirect} redirect
 */
export function action_json_redirect(redirect) {
	return action_json({
		type: 'redirect',
		status: redirect.status,
		location: redirect.location
	});
}

/**
 * @param {import('@sveltejs/kit').ActionResult} data
 * @param {ResponseInit} [init]
 */
function action_json(data, init) {
	return json(data, init);
}

/**
 * @param {import('@sveltejs/kit').RequestEvent} event
 */
export function is_action_request(event) {
	return event.request.method === 'POST';
}

/**
 * @param {import('@sveltejs/kit').RequestEvent} event
 * @param {import('types').SSRNode['server'] | undefined} server
 * @returns {Promise<import('@sveltejs/kit').ActionResult>}
 */
export async function handle_action_request(event, server) {
	const actions = server?.actions;

	if (!actions) {
		// TODO should this be a different error altogether?
		event.setHeaders({
			// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/405
			// "The server must generate an Allow header field in a 405 status code response"
			allow: 'GET'
		});
		return {
			type: 'error',
			error: new SvelteKitError(
				405,
				'Method Not Allowed',
				'POST method not allowed. No actions exist for this page'
			)
		};
	}

	check_named_default_separate(actions);

	try {
		const data = await call_action(event, actions);

		if (__SVELTEKIT_DEV__) {
			validate_action_return(data);
		}

		if (data instanceof ActionFailure) {
			return {
				type: 'failure',
				status: data.status,
				data: data.data
			};
		} else {
			return {
				type: 'success',
				status: 200,
				// @ts-expect-error this will be removed upon serialization, so `undefined` is the same as omission
				data
			};
		}
	} catch (e) {
		const err = normalize_error(e);

		if (err instanceof Redirect) {
			return {
				type: 'redirect',
				status: err.status,
				location: err.location
			};
		}

		return {
			type: 'error',
			error: check_incorrect_fail_use(err)
		};
	}
}

/**
 * @param {import('@sveltejs/kit').Actions} actions
 */
function check_named_default_separate(actions) {
	if (actions.default && Object.keys(actions).length > 1) {
		throw new Error(
			'When using named actions, the default action cannot be used. See the docs for more info: https://kit.svelte.dev/docs/form-actions#named-actions'
		);
	}
}

/**
 * @param {import('@sveltejs/kit').RequestEvent} event
 * @param {NonNullable<import('types').SSRNode['server']['actions']>} actions
 * @throws {Redirect | HttpError | SvelteKitError | Error}
 */
async function call_action(event, actions) {
	const url = new URL(event.request.url);

	let name = 'default';
	for (const param of url.searchParams) {
		if (param[0].startsWith('/')) {
			name = param[0].slice(1);
			if (name === 'default') {
				throw new Error('Cannot use reserved action name "default"');
			}
			break;
		}
	}

	const action = actions[name];
	if (!action) {
		throw new SvelteKitError(404, 'Not Found', `No action with name '${name}' found`);
	}

	if (!is_form_content_type(event.request)) {
		throw new SvelteKitError(
			415,
			'Unsupported Media Type',
			`Form actions expect form-encoded data — received ${event.request.headers.get(
				'content-type'
			)}`
		);
	}

	return action(event);
}

/** @param {any} data */
function validate_action_return(data) {
	if (data instanceof Redirect) {
		throw new Error('Cannot `return redirect(...)` — use `redirect(...)` instead');
	}

	if (data instanceof HttpError) {
		throw new Error('Cannot `return error(...)` — use `error(...)` or `return fail(...)` instead');
	}
}

/**
 * Try to `devalue.uneval` the data object, and if it fails, return a proper Error with context
 * @param {any} data
 * @param {string} route_id
 */
export function uneval_action_response(data, route_id) {
	return try_deserialize(data, devalue.uneval, route_id);
}

/**
 * Try to `devalue.stringify` the data object, and if it fails, return a proper Error with context
 * @param {any} data
 * @param {string} route_id
 */
function stringify_action_response(data, route_id) {
	return try_deserialize(data, devalue.stringify, route_id);
}

/**
 * @param {any} data
 * @param {(data: any) => string} fn
 * @param {string} route_id
 */
function try_deserialize(data, fn, route_id) {
	try {
		return fn(data);
	} catch (e) {
		// If we're here, the data could not be serialized with devalue
		const error = /** @type {any} */ (e);

		if ('path' in error) {
			let message = `Data returned from action inside ${route_id} is not serializable: ${error.message}`;
			if (error.path !== '') message += ` (data.${error.path})`;
			throw new Error(message);
		}

		throw error;
	}
}

```


####### packages/kit/src/runtime/server/page/crypto.js #######

```

const encoder = new TextEncoder();

/**
 * SHA-256 hashing function adapted from https://bitwiseshiftleft.github.io/sjcl
 * modified and redistributed under BSD license
 * @param {string} data
 */
export function sha256(data) {
	if (!key[0]) precompute();

	const out = init.slice(0);
	const array = encode(data);

	for (let i = 0; i < array.length; i += 16) {
		const w = array.subarray(i, i + 16);

		let tmp;
		let a;
		let b;

		let out0 = out[0];
		let out1 = out[1];
		let out2 = out[2];
		let out3 = out[3];
		let out4 = out[4];
		let out5 = out[5];
		let out6 = out[6];
		let out7 = out[7];

		/* Rationale for placement of |0 :
		 * If a value can overflow is original 32 bits by a factor of more than a few
		 * million (2^23 ish), there is a possibility that it might overflow the
		 * 53-bit mantissa and lose precision.
		 *
		 * To avoid this, we clamp back to 32 bits by |'ing with 0 on any value that
		 * propagates around the loop, and on the hash state out[]. I don't believe
		 * that the clamps on out4 and on out0 are strictly necessary, but it's close
		 * (for out4 anyway), and better safe than sorry.
		 *
		 * The clamps on out[] are necessary for the output to be correct even in the
		 * common case and for short inputs.
		 */

		for (let i = 0; i < 64; i++) {
			// load up the input word for this round

			if (i < 16) {
				tmp = w[i];
			} else {
				a = w[(i + 1) & 15];

				b = w[(i + 14) & 15];

				tmp = w[i & 15] =
					(((a >>> 7) ^ (a >>> 18) ^ (a >>> 3) ^ (a << 25) ^ (a << 14)) +
						((b >>> 17) ^ (b >>> 19) ^ (b >>> 10) ^ (b << 15) ^ (b << 13)) +
						w[i & 15] +
						w[(i + 9) & 15]) |
					0;
			}

			tmp =
				tmp +
				out7 +
				((out4 >>> 6) ^ (out4 >>> 11) ^ (out4 >>> 25) ^ (out4 << 26) ^ (out4 << 21) ^ (out4 << 7)) +
				(out6 ^ (out4 & (out5 ^ out6))) +
				key[i]; // | 0;

			// shift register
			out7 = out6;
			out6 = out5;
			out5 = out4;

			out4 = (out3 + tmp) | 0;

			out3 = out2;
			out2 = out1;
			out1 = out0;

			out0 =
				(tmp +
					((out1 & out2) ^ (out3 & (out1 ^ out2))) +
					((out1 >>> 2) ^
						(out1 >>> 13) ^
						(out1 >>> 22) ^
						(out1 << 30) ^
						(out1 << 19) ^
						(out1 << 10))) |
				0;
		}

		out[0] = (out[0] + out0) | 0;
		out[1] = (out[1] + out1) | 0;
		out[2] = (out[2] + out2) | 0;
		out[3] = (out[3] + out3) | 0;
		out[4] = (out[4] + out4) | 0;
		out[5] = (out[5] + out5) | 0;
		out[6] = (out[6] + out6) | 0;
		out[7] = (out[7] + out7) | 0;
	}

	const bytes = new Uint8Array(out.buffer);
	reverse_endianness(bytes);

	return base64(bytes);
}

/** The SHA-256 initialization vector */
const init = new Uint32Array(8);

/** The SHA-256 hash key */
const key = new Uint32Array(64);

/** Function to precompute init and key. */
function precompute() {
	/** @param {number} x */
	function frac(x) {
		return (x - Math.floor(x)) * 0x100000000;
	}

	let prime = 2;

	for (let i = 0; i < 64; prime++) {
		let is_prime = true;

		for (let factor = 2; factor * factor <= prime; factor++) {
			if (prime % factor === 0) {
				is_prime = false;

				break;
			}
		}

		if (is_prime) {
			if (i < 8) {
				init[i] = frac(prime ** (1 / 2));
			}

			key[i] = frac(prime ** (1 / 3));

			i++;
		}
	}
}

/** @param {Uint8Array} bytes */
function reverse_endianness(bytes) {
	for (let i = 0; i < bytes.length; i += 4) {
		const a = bytes[i + 0];
		const b = bytes[i + 1];
		const c = bytes[i + 2];
		const d = bytes[i + 3];

		bytes[i + 0] = d;
		bytes[i + 1] = c;
		bytes[i + 2] = b;
		bytes[i + 3] = a;
	}
}

/** @param {string} str */
function encode(str) {
	const encoded = encoder.encode(str);
	const length = encoded.length * 8;

	// result should be a multiple of 512 bits in length,
	// with room for a 1 (after the data) and two 32-bit
	// words containing the original input bit length
	const size = 512 * Math.ceil((length + 65) / 512);
	const bytes = new Uint8Array(size / 8);
	bytes.set(encoded);

	// append a 1
	bytes[encoded.length] = 0b10000000;

	reverse_endianness(bytes);

	// add the input bit length
	const words = new Uint32Array(bytes.buffer);
	words[words.length - 2] = Math.floor(length / 0x100000000); // this will always be zero for us
	words[words.length - 1] = length;

	return words;
}

/*
	Based on https://gist.github.com/enepomnyaschih/72c423f727d395eeaa09697058238727

	MIT License
	Copyright (c) 2020 Egor Nepomnyaschih
	Permission is hereby granted, free of charge, to any person obtaining a copy
	of this software and associated documentation files (the "Software"), to deal
	in the Software without restriction, including without limitation the rights
	to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	copies of the Software, and to permit persons to whom the Software is
	furnished to do so, subject to the following conditions:
	The above copyright notice and this permission notice shall be included in all
	copies or substantial portions of the Software.
	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
	SOFTWARE.
*/
const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'.split('');

/** @param {Uint8Array} bytes */
export function base64(bytes) {
	const l = bytes.length;

	let result = '';
	let i;

	for (i = 2; i < l; i += 3) {
		result += chars[bytes[i - 2] >> 2];
		result += chars[((bytes[i - 2] & 0x03) << 4) | (bytes[i - 1] >> 4)];
		result += chars[((bytes[i - 1] & 0x0f) << 2) | (bytes[i] >> 6)];
		result += chars[bytes[i] & 0x3f];
	}

	if (i === l + 1) {
		// 1 octet yet to write
		result += chars[bytes[i - 2] >> 2];
		result += chars[(bytes[i - 2] & 0x03) << 4];
		result += '==';
	}

	if (i === l) {
		// 2 octets yet to write
		result += chars[bytes[i - 2] >> 2];
		result += chars[((bytes[i - 2] & 0x03) << 4) | (bytes[i - 1] >> 4)];
		result += chars[(bytes[i - 1] & 0x0f) << 2];
		result += '=';
	}

	return result;
}

```


####### packages/kit/src/runtime/server/page/crypto.spec.js #######

```

import { webcrypto } from 'node:crypto';
import { assert, test } from 'vitest';
import { sha256 } from './crypto.js';

const inputs = [
	'hello world',
	'',
	'abcd',
	'the quick brown fox jumps over the lazy dog',
	'工欲善其事，必先利其器'
].slice(0);

inputs.forEach((input) => {
	test(input, async () => {
		const expected_bytes = await webcrypto.subtle.digest(
			'SHA-256',
			new TextEncoder().encode(input)
		);
		const expected = Buffer.from(expected_bytes).toString('base64');

		const actual = sha256(input);
		assert.equal(actual, expected);
	});
});

```


####### packages/kit/src/runtime/server/page/csp.js #######

```

import { escape_html_attr } from '../../../utils/escape.js';
import { base64, sha256 } from './crypto.js';

const array = new Uint8Array(16);

function generate_nonce() {
	crypto.getRandomValues(array);
	return base64(array);
}

const quoted = new Set([
	'self',
	'unsafe-eval',
	'unsafe-hashes',
	'unsafe-inline',
	'none',
	'strict-dynamic',
	'report-sample',
	'wasm-unsafe-eval',
	'script'
]);

const crypto_pattern = /^(nonce|sha\d\d\d)-/;

// CSP and CSP Report Only are extremely similar with a few caveats
// the easiest/DRYest way to express this is with some private encapsulation
class BaseProvider {
	/** @type {boolean} */
	#use_hashes;

	/** @type {boolean} */
	#script_needs_csp;

	/** @type {boolean} */
	#style_needs_csp;

	/** @type {import('types').CspDirectives} */
	#directives;

	/** @type {import('types').Csp.Source[]} */
	#script_src;

	/** @type {import('types').Csp.Source[]} */
	#script_src_elem;

	/** @type {import('types').Csp.Source[]} */
	#style_src;

	/** @type {import('types').Csp.Source[]} */
	#style_src_attr;

	/** @type {import('types').Csp.Source[]} */
	#style_src_elem;

	/** @type {string} */
	#nonce;

	/**
	 * @param {boolean} use_hashes
	 * @param {import('types').CspDirectives} directives
	 * @param {string} nonce
	 */
	constructor(use_hashes, directives, nonce) {
		this.#use_hashes = use_hashes;
		this.#directives = __SVELTEKIT_DEV__ ? { ...directives } : directives; // clone in dev so we can safely mutate

		const d = this.#directives;

		this.#script_src = [];
		this.#script_src_elem = [];
		this.#style_src = [];
		this.#style_src_attr = [];
		this.#style_src_elem = [];

		const effective_script_src = d['script-src'] || d['default-src'];
		const script_src_elem = d['script-src-elem'];
		const effective_style_src = d['style-src'] || d['default-src'];
		const style_src_attr = d['style-src-attr'];
		const style_src_elem = d['style-src-elem'];

		if (__SVELTEKIT_DEV__) {
			// remove strict-dynamic in dev...
			// TODO reinstate this if we can figure out how to make strict-dynamic work
			// if (d['default-src']) {
			// 	d['default-src'] = d['default-src'].filter((name) => name !== 'strict-dynamic');
			// 	if (d['default-src'].length === 0) delete d['default-src'];
			// }

			// if (d['script-src']) {
			// 	d['script-src'] = d['script-src'].filter((name) => name !== 'strict-dynamic');
			// 	if (d['script-src'].length === 0) delete d['script-src'];
			// }

			// ...and add unsafe-inline so we can inject <style> elements
			// Note that 'unsafe-inline' is ignored if either a hash or nonce value is present in the source list, so we remove those during dev when injecting unsafe-inline
			if (effective_style_src && !effective_style_src.includes('unsafe-inline')) {
				d['style-src'] = [
					...effective_style_src.filter(
						(value) => !(value.startsWith('sha256-') || value.startsWith('nonce-'))
					),
					'unsafe-inline'
				];
			}

			if (style_src_attr && !style_src_attr.includes('unsafe-inline')) {
				d['style-src-attr'] = [
					...style_src_attr.filter(
						(value) => !(value.startsWith('sha256-') || value.startsWith('nonce-'))
					),
					'unsafe-inline'
				];
			}

			if (style_src_elem && !style_src_elem.includes('unsafe-inline')) {
				d['style-src-elem'] = [
					...style_src_elem.filter(
						(value) => !(value.startsWith('sha256-') || value.startsWith('nonce-'))
					),
					'unsafe-inline'
				];
			}
		}

		this.#script_needs_csp =
			(!!effective_script_src &&
				effective_script_src.filter((value) => value !== 'unsafe-inline').length > 0) ||
			(!!script_src_elem &&
				script_src_elem.filter((value) => value !== 'unsafe-inline').length > 0);

		this.#style_needs_csp =
			!__SVELTEKIT_DEV__ &&
			((!!effective_style_src &&
				effective_style_src.filter((value) => value !== 'unsafe-inline').length > 0) ||
				(!!style_src_attr &&
					style_src_attr.filter((value) => value !== 'unsafe-inline').length > 0) ||
				(!!style_src_elem &&
					style_src_elem.filter((value) => value !== 'unsafe-inline').length > 0));

		this.script_needs_nonce = this.#script_needs_csp && !this.#use_hashes;
		this.style_needs_nonce = this.#style_needs_csp && !this.#use_hashes;
		this.#nonce = nonce;
	}

	/** @param {string} content */
	add_script(content) {
		if (this.#script_needs_csp) {
			const d = this.#directives;

			if (this.#use_hashes) {
				const hash = sha256(content);

				this.#script_src.push(`sha256-${hash}`);

				if (d['script-src-elem']?.length) {
					this.#script_src_elem.push(`sha256-${hash}`);
				}
			} else {
				if (this.#script_src.length === 0) {
					this.#script_src.push(`nonce-${this.#nonce}`);
				}
				if (d['script-src-elem']?.length) {
					this.#script_src_elem.push(`nonce-${this.#nonce}`);
				}
			}
		}
	}

	/** @param {string} content */
	add_style(content) {
		if (this.#style_needs_csp) {
			// this is the hash for "/* empty */"
			// adding it so that svelte does not break csp
			// see https://github.com/sveltejs/svelte/pull/7800
			const empty_comment_hash = '9OlNO0DNEeaVzHL4RZwCLsBHA8WBQ8toBp/4F5XV2nc=';

			const d = this.#directives;

			if (this.#use_hashes) {
				const hash = sha256(content);

				this.#style_src.push(`sha256-${hash}`);

				if (d['style-src-attr']?.length) {
					this.#style_src_attr.push(`sha256-${hash}`);
				}
				if (d['style-src-elem']?.length) {
					if (
						hash !== empty_comment_hash &&
						!d['style-src-elem'].includes(`sha256-${empty_comment_hash}`)
					) {
						this.#style_src_elem.push(`sha256-${empty_comment_hash}`);
					}

					this.#style_src_elem.push(`sha256-${hash}`);
				}
			} else {
				if (this.#style_src.length === 0 && !d['style-src']?.includes('unsafe-inline')) {
					this.#style_src.push(`nonce-${this.#nonce}`);
				}
				if (d['style-src-attr']?.length) {
					this.#style_src_attr.push(`nonce-${this.#nonce}`);
				}
				if (d['style-src-elem']?.length) {
					if (!d['style-src-elem'].includes(`sha256-${empty_comment_hash}`)) {
						this.#style_src_elem.push(`sha256-${empty_comment_hash}`);
					}

					this.#style_src_elem.push(`nonce-${this.#nonce}`);
				}
			}
		}
	}

	/**
	 * @param {boolean} [is_meta]
	 */
	get_header(is_meta = false) {
		const header = [];

		// due to browser inconsistencies, we can't append sources to default-src
		// (specifically, Firefox appears to not ignore nonce-{nonce} directives
		// on default-src), so we ensure that script-src and style-src exist

		const directives = { ...this.#directives };

		if (this.#style_src.length > 0) {
			directives['style-src'] = [
				...(directives['style-src'] || directives['default-src'] || []),
				...this.#style_src
			];
		}

		if (this.#style_src_attr.length > 0) {
			directives['style-src-attr'] = [
				...(directives['style-src-attr'] || []),
				...this.#style_src_attr
			];
		}

		if (this.#style_src_elem.length > 0) {
			directives['style-src-elem'] = [
				...(directives['style-src-elem'] || []),
				...this.#style_src_elem
			];
		}

		if (this.#script_src.length > 0) {
			directives['script-src'] = [
				...(directives['script-src'] || directives['default-src'] || []),
				...this.#script_src
			];
		}

		if (this.#script_src_elem.length > 0) {
			directives['script-src-elem'] = [
				...(directives['script-src-elem'] || []),
				...this.#script_src_elem
			];
		}

		for (const key in directives) {
			if (is_meta && (key === 'frame-ancestors' || key === 'report-uri' || key === 'sandbox')) {
				// these values cannot be used with a <meta> tag
				// TODO warn?
				continue;
			}

			// @ts-expect-error gimme a break typescript, `key` is obviously a member of internal_directives
			const value = /** @type {string[] | true} */ (directives[key]);

			if (!value) continue;

			const directive = [key];
			if (Array.isArray(value)) {
				value.forEach((value) => {
					if (quoted.has(value) || crypto_pattern.test(value)) {
						directive.push(`'${value}'`);
					} else {
						directive.push(value);
					}
				});
			}

			header.push(directive.join(' '));
		}

		return header.join('; ');
	}
}

class CspProvider extends BaseProvider {
	get_meta() {
		const content = this.get_header(true);

		if (!content) {
			return;
		}

		return `<meta http-equiv="content-security-policy" content=${escape_html_attr(content)}>`;
	}
}

class CspReportOnlyProvider extends BaseProvider {
	/**
	 * @param {boolean} use_hashes
	 * @param {import('types').CspDirectives} directives
	 * @param {string} nonce
	 */
	constructor(use_hashes, directives, nonce) {
		super(use_hashes, directives, nonce);

		if (Object.values(directives).filter((v) => !!v).length > 0) {
			// If we're generating content-security-policy-report-only,
			// if there are any directives, we need a report-uri or report-to (or both)
			// else it's just an expensive noop.
			const has_report_to = directives['report-to']?.length ?? 0 > 0;
			const has_report_uri = directives['report-uri']?.length ?? 0 > 0;
			if (!has_report_to && !has_report_uri) {
				throw Error(
					'`content-security-policy-report-only` must be specified with either the `report-to` or `report-uri` directives, or both'
				);
			}
		}
	}
}

export class Csp {
	/** @readonly */
	nonce = generate_nonce();

	/** @type {CspProvider} */
	csp_provider;

	/** @type {CspReportOnlyProvider} */
	report_only_provider;

	/**
	 * @param {import('./types.js').CspConfig} config
	 * @param {import('./types.js').CspOpts} opts
	 */
	constructor({ mode, directives, reportOnly }, { prerender }) {
		const use_hashes = mode === 'hash' || (mode === 'auto' && prerender);
		this.csp_provider = new CspProvider(use_hashes, directives, this.nonce);
		this.report_only_provider = new CspReportOnlyProvider(use_hashes, reportOnly, this.nonce);
	}

	get script_needs_nonce() {
		return this.csp_provider.script_needs_nonce || this.report_only_provider.script_needs_nonce;
	}

	get style_needs_nonce() {
		return this.csp_provider.style_needs_nonce || this.report_only_provider.style_needs_nonce;
	}

	/** @param {string} content */
	add_script(content) {
		this.csp_provider.add_script(content);
		this.report_only_provider.add_script(content);
	}

	/** @param {string} content */
	add_style(content) {
		this.csp_provider.add_style(content);
		this.report_only_provider.add_style(content);
	}
}

```


####### packages/kit/src/runtime/server/page/csp.spec.js #######

```

import { webcrypto } from 'node:crypto';
import { assert, beforeAll, test } from 'vitest';
import { Csp } from './csp.js';

// TODO: remove after bumping peer dependency to require Node 20
if (!globalThis.crypto) {
	// @ts-expect-error
	globalThis.crypto = webcrypto;
}

beforeAll(() => {
	// @ts-expect-error
	globalThis.__SVELTEKIT_DEV__ = false;
});

test('generates blank CSP header', () => {
	const csp = new Csp(
		{
			mode: 'hash',
			directives: {},
			reportOnly: {}
		},
		{
			prerender: false
		}
	);

	assert.equal(csp.csp_provider.get_header(), '');
	assert.equal(csp.report_only_provider.get_header(), '');
});

test('generates CSP header with directive', () => {
	const csp = new Csp(
		{
			mode: 'hash',
			directives: {
				'default-src': ['self']
			},
			reportOnly: {
				'default-src': ['self'],
				'report-uri': ['/']
			}
		},
		{
			prerender: false
		}
	);

	assert.equal(csp.csp_provider.get_header(), "default-src 'self'");
	assert.equal(csp.report_only_provider.get_header(), "default-src 'self'; report-uri /");
});

test('generates CSP header with nonce', () => {
	const csp = new Csp(
		{
			mode: 'nonce',
			directives: {
				'default-src': ['self']
			},
			reportOnly: {
				'default-src': ['self'],
				'report-uri': ['/']
			}
		},
		{
			prerender: false
		}
	);

	csp.add_script('');

	assert.ok(
		csp.csp_provider.get_header().startsWith("default-src 'self'; script-src 'self' 'nonce-")
	);
	assert.ok(
		csp.report_only_provider
			.get_header()
			.startsWith("default-src 'self'; report-uri /; script-src 'self' 'nonce-")
	);
});

test('skips nonce with unsafe-inline', () => {
	const csp = new Csp(
		{
			mode: 'nonce',
			directives: {
				'default-src': ['unsafe-inline']
			},
			reportOnly: {
				'default-src': ['unsafe-inline'],
				'report-uri': ['/']
			}
		},
		{
			prerender: false
		}
	);

	csp.add_script('');

	assert.equal(csp.csp_provider.get_header(), "default-src 'unsafe-inline'");
	assert.equal(csp.report_only_provider.get_header(), "default-src 'unsafe-inline'; report-uri /");
});

test('skips nonce in style-src when using unsafe-inline', () => {
	const csp = new Csp(
		{
			mode: 'nonce',
			directives: {
				'style-src': ['self', 'unsafe-inline']
			},
			reportOnly: {
				'style-src': ['self', 'unsafe-inline'],
				'report-uri': ['/']
			}
		},
		{
			prerender: false
		}
	);

	csp.add_style('');

	assert.equal(csp.csp_provider.get_header(), "style-src 'self' 'unsafe-inline'");
	assert.equal(
		csp.report_only_provider.get_header(),
		"style-src 'self' 'unsafe-inline'; report-uri /"
	);
});

test('skips hash with unsafe-inline', () => {
	const csp = new Csp(
		{
			mode: 'hash',
			directives: {
				'default-src': ['unsafe-inline']
			},
			reportOnly: {
				'default-src': ['unsafe-inline'],
				'report-uri': ['/']
			}
		},
		{
			prerender: false
		}
	);

	csp.add_script('');

	assert.equal(csp.csp_provider.get_header(), "default-src 'unsafe-inline'");
	assert.equal(csp.report_only_provider.get_header(), "default-src 'unsafe-inline'; report-uri /");
});

test('skips frame-ancestors, report-uri, sandbox from meta tags', () => {
	const csp = new Csp(
		{
			mode: 'hash',
			directives: {
				'default-src': ['self'],
				'frame-ancestors': ['self'],
				'report-uri': ['/csp-violation-report-endpoint/'],
				sandbox: ['allow-modals']
			},
			reportOnly: {}
		},
		{
			prerender: false
		}
	);

	assert.equal(
		csp.csp_provider.get_header(),
		"default-src 'self'; frame-ancestors 'self'; report-uri /csp-violation-report-endpoint/; sandbox allow-modals"
	);

	assert.equal(
		csp.csp_provider.get_meta(),
		'<meta http-equiv="content-security-policy" content="default-src \'self\'">'
	);
});

test('adds nonce to script-src-elem, style-src-attr and style-src-elem if necessary', () => {
	const csp = new Csp(
		{
			mode: 'auto',
			directives: {
				'script-src-elem': ['self'],
				'style-src-attr': ['self'],
				'style-src-elem': ['self']
			},
			reportOnly: {}
		},
		{
			prerender: false
		}
	);

	csp.add_script('');
	csp.add_style('');

	const csp_header = csp.csp_provider.get_header();
	assert.ok(csp_header.includes("script-src-elem 'self' 'nonce-"));
	assert.ok(csp_header.includes("style-src-attr 'self' 'nonce-"));
	assert.ok(
		csp_header.includes(
			"style-src-elem 'self' 'sha256-9OlNO0DNEeaVzHL4RZwCLsBHA8WBQ8toBp/4F5XV2nc=' 'nonce-"
		)
	);
});

test('adds hash to script-src-elem, style-src-attr and style-src-elem if necessary during prerendering', () => {
	const csp = new Csp(
		{
			mode: 'auto',
			directives: {
				'script-src-elem': ['self'],
				'style-src-attr': ['self'],
				'style-src-elem': ['self']
			},
			reportOnly: {}
		},
		{
			prerender: true
		}
	);

	csp.add_script('');
	csp.add_style('');

	const csp_header = csp.csp_provider.get_header();
	assert.ok(
		csp_header.includes(
			"script-src-elem 'self' 'sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU='"
		)
	);
	assert.ok(
		csp_header.includes(
			"style-src-attr 'self' 'sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU='"
		)
	);
	assert.ok(
		csp_header.includes(
			"style-src-elem 'self' 'sha256-9OlNO0DNEeaVzHL4RZwCLsBHA8WBQ8toBp/4F5XV2nc=' 'sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU='"
		)
	);
});

test('adds unsafe-inline styles in dev', () => {
	// @ts-expect-error
	globalThis.__SVELTEKIT_DEV__ = true;

	const csp = new Csp(
		{
			mode: 'hash',
			directives: {
				'default-src': ['self'],
				'style-src-attr': ['self', 'sha256-9OlNO0DNEeaVzHL4RZwCLsBHA8WBQ8toBp/4F5XV2nc='],
				'style-src-elem': ['self', 'sha256-9OlNO0DNEeaVzHL4RZwCLsBHA8WBQ8toBp/4F5XV2nc=']
			},
			reportOnly: {
				'default-src': ['self'],
				'style-src-attr': ['self'],
				'style-src-elem': ['self'],
				'report-uri': ['/']
			}
		},
		{
			prerender: false
		}
	);

	csp.add_style('');

	assert.equal(
		csp.csp_provider.get_header(),
		"default-src 'self'; style-src-attr 'self' 'unsafe-inline'; style-src-elem 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'"
	);

	assert.equal(
		csp.report_only_provider.get_header(),
		"default-src 'self'; style-src-attr 'self' 'unsafe-inline'; style-src-elem 'self' 'unsafe-inline'; report-uri /; style-src 'self' 'unsafe-inline'"
	);
});

test.skip('removes strict-dynamic in dev', () => {
	['default-src', 'script-src'].forEach((name) => {
		// @ts-expect-error
		globalThis.__SVELTEKIT_DEV__ = true;

		const csp = new Csp(
			{
				mode: 'hash',
				directives: {
					[name]: ['strict-dynamic']
				},
				reportOnly: {
					[name]: ['strict-dynamic'],
					'report-uri': ['/']
				}
			},
			{
				prerender: false
			}
		);

		csp.add_script('');

		assert.equal(csp.csp_provider.get_header(), '');
		assert.equal(csp.report_only_provider.get_header(), '');
	});
});

test('uses hashes when prerendering', () => {
	const csp = new Csp(
		{
			mode: 'auto',
			directives: {
				'script-src': ['self']
			},
			reportOnly: {
				'script-src': ['self'],
				'report-uri': ['/']
			}
		},
		{
			prerender: true
		}
	);

	csp.add_script('');

	assert.equal(
		csp.csp_provider.get_header(),
		"script-src 'self' 'sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU='"
	);

	assert.equal(
		csp.report_only_provider.get_header(),
		"script-src 'self' 'sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU='; report-uri /"
	);
});

test('always creates a nonce when template needs it', () => {
	const csp = new Csp(
		{
			mode: 'hash',
			directives: {},
			reportOnly: {}
		},
		{
			prerender: false
		}
	);

	assert.ok(csp.nonce);
});

test('throws when reportOnly contains directives but no report-uri or report-to', () => {
	assert.throws(() => {
		new Csp(
			{
				mode: 'hash',
				directives: {},
				reportOnly: {
					'script-src': ['self']
				}
			},
			{
				prerender: false
			}
		);
	}, '`content-security-policy-report-only` must be specified with either the `report-to` or `report-uri` directives, or both');
});

```


####### packages/kit/src/runtime/server/page/index.js #######

```

import { text } from '../../../exports/index.js';
import { compact } from '../../../utils/array.js';
import { get_status, normalize_error } from '../../../utils/error.js';
import { add_data_suffix } from '../../../utils/url.js';
import { Redirect } from '../../control.js';
import { redirect_response, static_error_page, handle_error_and_jsonify } from '../utils.js';
import {
	handle_action_json_request,
	handle_action_request,
	is_action_json_request,
	is_action_request
} from './actions.js';
import { load_data, load_server_data } from './load_data.js';
import { render_response } from './render.js';
import { respond_with_error } from './respond_with_error.js';
import { get_option } from '../../../utils/options.js';
import { get_data_json } from '../data/index.js';
import { load_page_nodes } from './load_page_nodes.js';

/**
 * The maximum request depth permitted before assuming we're stuck in an infinite loop
 */
const MAX_DEPTH = 10;

/**
 * @param {import('@sveltejs/kit').RequestEvent} event
 * @param {import('types').PageNodeIndexes} page
 * @param {import('types').SSROptions} options
 * @param {import('@sveltejs/kit').SSRManifest} manifest
 * @param {import('types').SSRState} state
 * @param {import('types').RequiredResolveOptions} resolve_opts
 * @returns {Promise<Response>}
 */
export async function render_page(event, page, options, manifest, state, resolve_opts) {
	if (state.depth > MAX_DEPTH) {
		// infinite request cycle detected
		return text(`Not found: ${event.url.pathname}`, {
			status: 404 // TODO in some cases this should be 500. not sure how to differentiate
		});
	}

	if (is_action_json_request(event)) {
		const node = await manifest._.nodes[page.leaf]();
		return handle_action_json_request(event, options, node?.server);
	}

	try {
		const nodes = await load_page_nodes(page, manifest);

		const leaf_node = /** @type {import('types').SSRNode} */ (nodes.at(-1));

		let status = 200;

		/** @type {import('@sveltejs/kit').ActionResult | undefined} */
		let action_result = undefined;

		if (is_action_request(event)) {
			// for action requests, first call handler in +page.server.js
			// (this also determines status code)
			action_result = await handle_action_request(event, leaf_node.server);
			if (action_result?.type === 'redirect') {
				return redirect_response(action_result.status, action_result.location);
			}
			if (action_result?.type === 'error') {
				status = get_status(action_result.error);
			}
			if (action_result?.type === 'failure') {
				status = action_result.status;
			}
		}

		const should_prerender_data = nodes.some((node) => node?.server?.load);
		const data_pathname = add_data_suffix(event.url.pathname);

		// it's crucial that we do this before returning the non-SSR response, otherwise
		// SvelteKit will erroneously believe that the path has been prerendered,
		// causing functions to be omitted from the manifest generated later
		const should_prerender = get_option(nodes, 'prerender') ?? false;
		if (should_prerender) {
			const mod = leaf_node.server;
			if (mod?.actions) {
				throw new Error('Cannot prerender pages with actions');
			}
		} else if (state.prerendering) {
			// if the page isn't marked as prerenderable, then bail out at this point
			return new Response(undefined, {
				status: 204
			});
		}

		// if we fetch any endpoints while loading data for this page, they should
		// inherit the prerender option of the page
		state.prerender_default = should_prerender;

		/** @type {import('./types.js').Fetched[]} */
		const fetched = [];

		// renders an empty 'shell' page if SSR is turned off and if there is
		// no server data to prerender. As a result, the load functions and rendering
		// only occur client-side.
		if (get_option(nodes, 'ssr') === false && !(state.prerendering && should_prerender_data)) {
			return await render_response({
				branch: [],
				fetched,
				page_config: {
					ssr: false,
					csr: get_option(nodes, 'csr') ?? true
				},
				status,
				error: null,
				event,
				options,
				manifest,
				state,
				resolve_opts
			});
		}

		/** @type {Array<import('./types.js').Loaded | null>} */
		const branch = [];

		/** @type {Error | null} */
		let load_error = null;

		/** @type {Array<Promise<import('types').ServerDataNode | null>>} */
		const server_promises = nodes.map((node, i) => {
			if (load_error) {
				// if an error happens immediately, don't bother with the rest of the nodes
				throw load_error;
			}

			return Promise.resolve().then(async () => {
				try {
					if (node === leaf_node && action_result?.type === 'error') {
						// we wait until here to throw the error so that we can use
						// any nested +error.svelte components that were defined
						throw action_result.error;
					}

					return await load_server_data({
						event,
						state,
						node,
						parent: async () => {
							/** @type {Record<string, any>} */
							const data = {};
							for (let j = 0; j < i; j += 1) {
								const parent = await server_promises[j];
								if (parent) Object.assign(data, await parent.data);
							}
							return data;
						}
					});
				} catch (e) {
					load_error = /** @type {Error} */ (e);
					throw load_error;
				}
			});
		});

		const csr = get_option(nodes, 'csr') ?? true;

		/** @type {Array<Promise<Record<string, any> | null>>} */
		const load_promises = nodes.map((node, i) => {
			if (load_error) throw load_error;
			return Promise.resolve().then(async () => {
				try {
					return await load_data({
						event,
						fetched,
						node,
						parent: async () => {
							const data = {};
							for (let j = 0; j < i; j += 1) {
								Object.assign(data, await load_promises[j]);
							}
							return data;
						},
						resolve_opts,
						server_data_promise: server_promises[i],
						state,
						csr
					});
				} catch (e) {
					load_error = /** @type {Error} */ (e);
					throw load_error;
				}
			});
		});

		// if we don't do this, rejections will be unhandled
		for (const p of server_promises) p.catch(() => {});
		for (const p of load_promises) p.catch(() => {});

		for (let i = 0; i < nodes.length; i += 1) {
			const node = nodes[i];

			if (node) {
				try {
					const server_data = await server_promises[i];
					const data = await load_promises[i];

					branch.push({ node, server_data, data });
				} catch (e) {
					const err = normalize_error(e);

					if (err instanceof Redirect) {
						if (state.prerendering && should_prerender_data) {
							const body = JSON.stringify({
								type: 'redirect',
								location: err.location
							});

							state.prerendering.dependencies.set(data_pathname, {
								response: text(body),
								body
							});
						}

						return redirect_response(err.status, err.location);
					}

					const status = get_status(err);
					const error = await handle_error_and_jsonify(event, options, err);

					while (i--) {
						if (page.errors[i]) {
							const index = /** @type {number} */ (page.errors[i]);
							const node = await manifest._.nodes[index]();

							let j = i;
							while (!branch[j]) j -= 1;

							return await render_response({
								event,
								options,
								manifest,
								state,
								resolve_opts,
								page_config: { ssr: true, csr: true },
								status,
								error,
								branch: compact(branch.slice(0, j + 1)).concat({
									node,
									data: null,
									server_data: null
								}),
								fetched
							});
						}
					}

					// if we're still here, it means the error happened in the root layout,
					// which means we have to fall back to error.html
					return static_error_page(options, status, error.message);
				}
			} else {
				// push an empty slot so we can rewind past gaps to the
				// layout that corresponds with an +error.svelte page
				branch.push(null);
			}
		}

		if (state.prerendering && should_prerender_data) {
			// ndjson format
			let { data, chunks } = get_data_json(
				event,
				options,
				branch.map((node) => node?.server_data)
			);

			if (chunks) {
				for await (const chunk of chunks) {
					data += chunk;
				}
			}

			state.prerendering.dependencies.set(data_pathname, {
				response: text(data),
				body: data
			});
		}

		const ssr = get_option(nodes, 'ssr') ?? true;

		return await render_response({
			event,
			options,
			manifest,
			state,
			resolve_opts,
			page_config: {
				csr: get_option(nodes, 'csr') ?? true,
				ssr
			},
			status,
			error: null,
			branch: ssr === false ? [] : compact(branch),
			action_result,
			fetched
		});
	} catch (e) {
		// if we end up here, it means the data loaded successfully
		// but the page failed to render, or that a prerendering error occurred
		return await respond_with_error({
			event,
			options,
			manifest,
			state,
			status: 500,
			error: e,
			resolve_opts
		});
	}
}

```


####### packages/kit/src/runtime/server/page/load_data.js #######

```

import { DEV } from 'esm-env';
import { disable_search, make_trackable } from '../../../utils/url.js';
import { validate_depends } from '../../shared.js';
import { b64_encode } from '../../utils.js';

/**
 * Calls the user's server `load` function.
 * @param {{
 *   event: import('@sveltejs/kit').RequestEvent;
 *   state: import('types').SSRState;
 *   node: import('types').SSRNode | undefined;
 *   parent: () => Promise<Record<string, any>>;
 * }} opts
 * @returns {Promise<import('types').ServerDataNode | null>}
 */
export async function load_server_data({ event, state, node, parent }) {
	if (!node?.server) return null;

	let done = false;
	let is_tracking = true;

	const uses = {
		dependencies: new Set(),
		params: new Set(),
		parent: false,
		route: false,
		url: false,
		search_params: new Set()
	};

	const url = make_trackable(
		event.url,
		() => {
			if (DEV && done && !uses.url) {
				console.warn(
					`${node.server_id}: Accessing URL properties in a promise handler after \`load(...)\` has returned will not cause the function to re-run when the URL changes`
				);
			}

			if (is_tracking) {
				uses.url = true;
			}
		},
		(param) => {
			if (DEV && done && !uses.search_params.has(param)) {
				console.warn(
					`${node.server_id}: Accessing URL properties in a promise handler after \`load(...)\` has returned will not cause the function to re-run when the URL changes`
				);
			}

			if (is_tracking) {
				uses.search_params.add(param);
			}
		}
	);

	if (state.prerendering) {
		disable_search(url);
	}

	const result = await node.server.load?.call(null, {
		...event,
		fetch: (info, init) => {
			const url = new URL(info instanceof Request ? info.url : info, event.url);

			if (DEV && done && !uses.dependencies.has(url.href)) {
				console.warn(
					`${node.server_id}: Calling \`event.fetch(...)\` in a promise handler after \`load(...)\` has returned will not cause the function to re-run when the dependency is invalidated`
				);
			}

			// Note: server fetches are not added to uses.depends due to security concerns
			return event.fetch(info, init);
		},
		/** @param {string[]} deps */
		depends: (...deps) => {
			for (const dep of deps) {
				const { href } = new URL(dep, event.url);

				if (DEV) {
					validate_depends(node.server_id, dep);

					if (done && !uses.dependencies.has(href)) {
						console.warn(
							`${node.server_id}: Calling \`depends(...)\` in a promise handler after \`load(...)\` has returned will not cause the function to re-run when the dependency is invalidated`
						);
					}
				}

				uses.dependencies.add(href);
			}
		},
		params: new Proxy(event.params, {
			get: (target, key) => {
				if (DEV && done && typeof key === 'string' && !uses.params.has(key)) {
					console.warn(
						`${node.server_id}: Accessing \`params.${String(
							key
						)}\` in a promise handler after \`load(...)\` has returned will not cause the function to re-run when the param changes`
					);
				}

				if (is_tracking) {
					uses.params.add(key);
				}
				return target[/** @type {string} */ (key)];
			}
		}),
		parent: async () => {
			if (DEV && done && !uses.parent) {
				console.warn(
					`${node.server_id}: Calling \`parent(...)\` in a promise handler after \`load(...)\` has returned will not cause the function to re-run when parent data changes`
				);
			}

			if (is_tracking) {
				uses.parent = true;
			}
			return parent();
		},
		route: new Proxy(event.route, {
			get: (target, key) => {
				if (DEV && done && typeof key === 'string' && !uses.route) {
					console.warn(
						`${node.server_id}: Accessing \`route.${String(
							key
						)}\` in a promise handler after \`load(...)\` has returned will not cause the function to re-run when the route changes`
					);
				}

				if (is_tracking) {
					uses.route = true;
				}
				return target[/** @type {'id'} */ (key)];
			}
		}),
		url,
		untrack(fn) {
			is_tracking = false;
			try {
				return fn();
			} finally {
				is_tracking = true;
			}
		}
	});

	if (__SVELTEKIT_DEV__) {
		validate_load_response(result, node.server_id);
	}

	done = true;

	return {
		type: 'data',
		data: result ?? null,
		uses,
		slash: node.server.trailingSlash
	};
}

/**
 * Calls the user's `load` function.
 * @param {{
 *   event: import('@sveltejs/kit').RequestEvent;
 *   fetched: import('./types.js').Fetched[];
 *   node: import('types').SSRNode | undefined;
 *   parent: () => Promise<Record<string, any>>;
 *   resolve_opts: import('types').RequiredResolveOptions;
 *   server_data_promise: Promise<import('types').ServerDataNode | null>;
 *   state: import('types').SSRState;
 *   csr: boolean;
 * }} opts
 * @returns {Promise<Record<string, any | Promise<any>> | null>}
 */
export async function load_data({
	event,
	fetched,
	node,
	parent,
	server_data_promise,
	state,
	resolve_opts,
	csr
}) {
	const server_data_node = await server_data_promise;

	if (!node?.universal?.load) {
		return server_data_node?.data ?? null;
	}

	const result = await node.universal.load.call(null, {
		url: event.url,
		params: event.params,
		data: server_data_node?.data ?? null,
		route: event.route,
		fetch: create_universal_fetch(event, state, fetched, csr, resolve_opts),
		setHeaders: event.setHeaders,
		depends: () => {},
		parent,
		untrack: (fn) => fn()
	});

	if (__SVELTEKIT_DEV__) {
		validate_load_response(result, node.universal_id);
	}

	return result ?? null;
}

/**
 * @param {Pick<import('@sveltejs/kit').RequestEvent, 'fetch' | 'url' | 'request' | 'route'>} event
 * @param {import('types').SSRState} state
 * @param {import('./types.js').Fetched[]} fetched
 * @param {boolean} csr
 * @param {Pick<Required<import('@sveltejs/kit').ResolveOptions>, 'filterSerializedResponseHeaders'>} resolve_opts
 * @returns {typeof fetch}
 */
export function create_universal_fetch(event, state, fetched, csr, resolve_opts) {
	/**
	 * @param {URL | RequestInfo} input
	 * @param {RequestInit} [init]
	 */
	const universal_fetch = async (input, init) => {
		const cloned_body = input instanceof Request && input.body ? input.clone().body : null;

		const cloned_headers =
			input instanceof Request && [...input.headers].length
				? new Headers(input.headers)
				: init?.headers;

		let response = await event.fetch(input, init);

		const url = new URL(input instanceof Request ? input.url : input, event.url);
		const same_origin = url.origin === event.url.origin;

		/** @type {import('types').PrerenderDependency} */
		let dependency;

		if (same_origin) {
			if (state.prerendering) {
				dependency = { response, body: null };
				state.prerendering.dependencies.set(url.pathname, dependency);
			}
		} else {
			// simulate CORS errors and "no access to body in no-cors mode" server-side for consistency with client-side behaviour
			const mode = input instanceof Request ? input.mode : init?.mode ?? 'cors';
			if (mode === 'no-cors') {
				response = new Response('', {
					status: response.status,
					statusText: response.statusText,
					headers: response.headers
				});
			} else {
				const acao = response.headers.get('access-control-allow-origin');
				if (!acao || (acao !== event.url.origin && acao !== '*')) {
					throw new Error(
						`CORS error: ${
							acao ? 'Incorrect' : 'No'
						} 'Access-Control-Allow-Origin' header is present on the requested resource`
					);
				}
			}
		}

		const proxy = new Proxy(response, {
			get(response, key, _receiver) {
				/**
				 * @param {string} body
				 * @param {boolean} is_b64
				 */
				async function push_fetched(body, is_b64) {
					const status_number = Number(response.status);
					if (isNaN(status_number)) {
						throw new Error(
							`response.status is not a number. value: "${
								response.status
							}" type: ${typeof response.status}`
						);
					}

					fetched.push({
						url: same_origin ? url.href.slice(event.url.origin.length) : url.href,
						method: event.request.method,
						request_body: /** @type {string | ArrayBufferView | undefined} */ (
							input instanceof Request && cloned_body
								? await stream_to_string(cloned_body)
								: init?.body
						),
						request_headers: cloned_headers,
						response_body: body,
						response,
						is_b64
					});
				}

				if (key === 'arrayBuffer') {
					return async () => {
						const buffer = await response.arrayBuffer();

						if (dependency) {
							dependency.body = new Uint8Array(buffer);
						}

						if (buffer instanceof ArrayBuffer) {
							await push_fetched(b64_encode(buffer), true);
						}

						return buffer;
					};
				}

				async function text() {
					const body = await response.text();

					if (!body || typeof body === 'string') {
						await push_fetched(body, false);
					}

					if (dependency) {
						dependency.body = body;
					}

					return body;
				}

				if (key === 'text') {
					return text;
				}

				if (key === 'json') {
					return async () => {
						return JSON.parse(await text());
					};
				}

				return Reflect.get(response, key, response);
			}
		});

		if (csr) {
			// ensure that excluded headers can't be read
			const get = response.headers.get;
			response.headers.get = (key) => {
				const lower = key.toLowerCase();
				const value = get.call(response.headers, lower);
				if (value && !lower.startsWith('x-sveltekit-')) {
					const included = resolve_opts.filterSerializedResponseHeaders(lower, value);
					if (!included) {
						throw new Error(
							`Failed to get response header "${lower}" — it must be included by the \`filterSerializedResponseHeaders\` option: https://kit.svelte.dev/docs/hooks#server-hooks-handle (at ${event.route.id})`
						);
					}
				}

				return value;
			};
		}

		return proxy;
	};

	// Don't make this function `async`! Otherwise, the user has to `catch` promises they use for streaming responses or else
	// it will be an unhandled rejection. Instead, we add a `.catch(() => {})` ourselves below to this from happening.
	return (input, init) => {
		// See docs in fetch.js for why we need to do this
		const response = universal_fetch(input, init);
		response.catch(() => {});
		return response;
	};
}

/**
 * @param {ReadableStream<Uint8Array>} stream
 */
async function stream_to_string(stream) {
	let result = '';
	const reader = stream.getReader();
	const decoder = new TextDecoder();
	while (true) {
		const { done, value } = await reader.read();
		if (done) {
			break;
		}
		result += decoder.decode(value);
	}
	return result;
}

/**
 * @param {any} data
 * @param {string} [id]
 */
function validate_load_response(data, id) {
	if (data != null && Object.getPrototypeOf(data) !== Object.prototype) {
		throw new Error(
			`a load function in ${id} returned ${
				typeof data !== 'object'
					? `a ${typeof data}`
					: data instanceof Response
						? 'a Response object'
						: Array.isArray(data)
							? 'an array'
							: 'a non-plain object'
			}, but must return a plain object at the top level (i.e. \`return {...}\`)`
		);
	}
}

```


####### packages/kit/src/runtime/server/page/load_data.spec.js #######

```

import { assert, expect, test } from 'vitest';
import { create_universal_fetch } from './load_data.js';

/**
 * @param {Partial<Pick<import('@sveltejs/kit').RequestEvent, 'fetch' | 'url' | 'request' | 'route'>>} event
 */
function create_fetch(event) {
	event.fetch = event.fetch || (async () => new Response('foo'));
	event.request = event.request || new Request('doesnt:matter');
	event.route = event.route || { id: 'foo' };
	event.url = event.url || new URL('https://domain-a.com');
	return create_universal_fetch(
		/** @type {Pick<import('@sveltejs/kit').RequestEvent, 'fetch' | 'url' | 'request' | 'route'>} */ (
			event
		),
		{ getClientAddress: () => '', error: false, depth: 0 },
		[],
		true,
		{
			filterSerializedResponseHeaders: () => false
		}
	);
}

test('sets body to empty when mode is no-cors', async () => {
	const fetch = create_fetch({});
	const response = await fetch('https://domain-b.com', { mode: 'no-cors' });
	const text = await response.text();
	assert.equal(text, '');
});

test('keeps body when mode isnt no-cors on same domain', async () => {
	const fetch = create_fetch({});
	const response = await fetch('https://domain-a.com');
	const text = await response.text();
	assert.equal(text, 'foo');
});

test('succeeds when acao header present on cors', async () => {
	const fetch = create_fetch({
		fetch: async () => new Response('foo', { headers: { 'access-control-allow-origin': '*' } })
	});
	const response = await fetch('https://domain-a.com');
	const text = await response.text();
	assert.equal(text, 'foo');
});

test('errors when no acao header present on cors', async () => {
	const fetch = create_fetch({});

	expect(async () => {
		const response = await fetch('https://domain-b.com');
		await response.text();
	}).rejects.toThrowError(
		"CORS error: No 'Access-Control-Allow-Origin' header is present on the requested resource"
	);
});

test('errors when trying to access non-serialized request headers on the server', async () => {
	const fetch = create_fetch({});
	const response = await fetch('https://domain-a.com');
	assert.throws(
		() => response.headers.get('content-type'),
		/Failed to get response header "content-type" — it must be included by the `filterSerializedResponseHeaders` option/
	);
});

```


####### packages/kit/src/runtime/server/page/load_page_nodes.js #######

```

/**
 * @param {import('types').PageNodeIndexes} page
 * @param {import('@sveltejs/kit').SSRManifest} manifest
 */
export function load_page_nodes(page, manifest) {
	return Promise.all([
		// we use == here rather than === because [undefined] serializes as "[null]"
		...page.layouts.map((n) => (n == undefined ? n : manifest._.nodes[n]())),
		manifest._.nodes[page.leaf]()
	]);
}

```


####### packages/kit/src/runtime/server/page/render.js #######

```

import * as devalue from 'devalue';
import { readable, writable } from 'svelte/store';
import { DEV } from 'esm-env';
import * as paths from '__sveltekit/paths';
import { hash } from '../../hash.js';
import { serialize_data } from './serialize_data.js';
import { s } from '../../../utils/misc.js';
import { Csp } from './csp.js';
import { uneval_action_response } from './actions.js';
import { clarify_devalue_error, stringify_uses, handle_error_and_jsonify } from '../utils.js';
import { public_env, safe_public_env } from '../../shared-server.js';
import { text } from '../../../exports/index.js';
import { create_async_iterator } from '../../../utils/streaming.js';
import { SVELTE_KIT_ASSETS } from '../../../constants.js';
import { SCHEME } from '../../../utils/url.js';

// TODO rename this function/module

const updated = {
	...readable(false),
	check: () => false
};

const encoder = new TextEncoder();

/**
 * Creates the HTML response.
 * @param {{
 *   branch: Array<import('./types.js').Loaded>;
 *   fetched: Array<import('./types.js').Fetched>;
 *   options: import('types').SSROptions;
 *   manifest: import('@sveltejs/kit').SSRManifest;
 *   state: import('types').SSRState;
 *   page_config: { ssr: boolean; csr: boolean };
 *   status: number;
 *   error: App.Error | null;
 *   event: import('@sveltejs/kit').RequestEvent;
 *   resolve_opts: import('types').RequiredResolveOptions;
 *   action_result?: import('@sveltejs/kit').ActionResult;
 * }} opts
 */
export async function render_response({
	branch,
	fetched,
	options,
	manifest,
	state,
	page_config,
	status,
	error = null,
	event,
	resolve_opts,
	action_result
}) {
	if (state.prerendering) {
		if (options.csp.mode === 'nonce') {
			throw new Error('Cannot use prerendering if config.kit.csp.mode === "nonce"');
		}

		if (options.app_template_contains_nonce) {
			throw new Error('Cannot use prerendering if page template contains %sveltekit.nonce%');
		}
	}

	const { client } = manifest._;

	const modulepreloads = new Set(client.imports);
	const stylesheets = new Set(client.stylesheets);
	const fonts = new Set(client.fonts);

	/** @type {Set<string>} */
	const link_header_preloads = new Set();

	/** @type {Map<string, string>} */
	// TODO if we add a client entry point one day, we will need to include inline_styles with the entry, otherwise stylesheets will be linked even if they are below inlineStyleThreshold
	const inline_styles = new Map();

	let rendered;

	const form_value =
		action_result?.type === 'success' || action_result?.type === 'failure'
			? action_result.data ?? null
			: null;

	/** @type {string} */
	let base = paths.base;

	/** @type {string} */
	let assets = paths.assets;

	/**
	 * An expression that will evaluate in the client to determine the resolved base path.
	 * We use a relative path when possible to support IPFS, the internet archive, etc.
	 */
	let base_expression = s(paths.base);

	// if appropriate, use relative paths for greater portability
	if (paths.relative && !state.prerendering?.fallback) {
		const segments = event.url.pathname.slice(paths.base.length).split('/').slice(2);

		base = segments.map(() => '..').join('/') || '.';

		// resolve e.g. '../..' against current location, then remove trailing slash
		base_expression = `new URL(${s(base)}, location).pathname.slice(0, -1)`;

		if (!paths.assets || (paths.assets[0] === '/' && paths.assets !== SVELTE_KIT_ASSETS)) {
			assets = base;
		}
	}

	if (page_config.ssr) {
		if (__SVELTEKIT_DEV__ && !branch.at(-1)?.node.component) {
			// Can only be the leaf, layouts have a fallback component generated
			throw new Error(`Missing +page.svelte component for route ${event.route.id}`);
		}

		/** @type {Record<string, any>} */
		const props = {
			stores: {
				page: writable(null),
				navigating: writable(null),
				updated
			},
			constructors: await Promise.all(branch.map(({ node }) => node.component())),
			form: form_value
		};

		let data = {};

		// props_n (instead of props[n]) makes it easy to avoid
		// unnecessary updates for layout components
		for (let i = 0; i < branch.length; i += 1) {
			data = { ...data, ...branch[i].data };
			props[`data_${i}`] = data;
		}

		props.page = {
			error,
			params: /** @type {Record<string, any>} */ (event.params),
			route: event.route,
			status,
			url: event.url,
			data,
			form: form_value,
			state: {}
		};

		// use relative paths during rendering, so that the resulting HTML is as
		// portable as possible, but reset afterwards
		if (paths.relative) paths.override({ base, assets });

		if (__SVELTEKIT_DEV__) {
			const fetch = globalThis.fetch;
			let warned = false;
			globalThis.fetch = (info, init) => {
				if (typeof info === 'string' && !SCHEME.test(info)) {
					throw new Error(
						`Cannot call \`fetch\` eagerly during server side rendering with relative URL (${info}) — put your \`fetch\` calls inside \`onMount\` or a \`load\` function instead`
					);
				} else if (!warned) {
					console.warn(
						'Avoid calling `fetch` eagerly during server side rendering — put your `fetch` calls inside `onMount` or a `load` function instead'
					);
					warned = true;
				}

				return fetch(info, init);
			};

			try {
				rendered = options.root.render(props);
			} finally {
				globalThis.fetch = fetch;
				paths.reset();
			}
		} else {
			try {
				rendered = options.root.render(props);
			} finally {
				paths.reset();
			}
		}

		for (const { node } of branch) {
			for (const url of node.imports) modulepreloads.add(url);
			for (const url of node.stylesheets) stylesheets.add(url);
			for (const url of node.fonts) fonts.add(url);

			if (node.inline_styles) {
				Object.entries(await node.inline_styles()).forEach(([k, v]) => inline_styles.set(k, v));
			}
		}
	} else {
		rendered = { head: '', html: '', css: { code: '', map: null } };
	}

	let head = '';
	let body = rendered.html;

	const csp = new Csp(options.csp, {
		prerender: !!state.prerendering
	});

	/** @param {string} path */
	const prefixed = (path) => {
		if (path.startsWith('/')) {
			// Vite makes the start script available through the base path and without it.
			// We load it via the base path in order to support remote IDE environments which proxy
			// all URLs under the base path during development.
			return paths.base + path;
		}
		return `${assets}/${path}`;
	};

	if (inline_styles.size > 0) {
		const content = Array.from(inline_styles.values()).join('\n');

		const attributes = __SVELTEKIT_DEV__ ? [' data-sveltekit'] : [];
		if (csp.style_needs_nonce) attributes.push(` nonce="${csp.nonce}"`);

		csp.add_style(content);

		head += `\n\t<style${attributes.join('')}>${content}</style>`;
	}

	for (const dep of stylesheets) {
		const path = prefixed(dep);

		const attributes = ['rel="stylesheet"'];

		if (inline_styles.has(dep)) {
			// don't load stylesheets that are already inlined
			// include them in disabled state so that Vite can detect them and doesn't try to add them
			attributes.push('disabled', 'media="(max-width: 0)"');
		} else {
			if (resolve_opts.preload({ type: 'css', path })) {
				const preload_atts = ['rel="preload"', 'as="style"'];
				link_header_preloads.add(`<${encodeURI(path)}>; ${preload_atts.join(';')}; nopush`);
			}
		}

		head += `\n\t\t<link href="${path}" ${attributes.join(' ')}>`;
	}

	for (const dep of fonts) {
		const path = prefixed(dep);

		if (resolve_opts.preload({ type: 'font', path })) {
			const ext = dep.slice(dep.lastIndexOf('.') + 1);
			const attributes = [
				'rel="preload"',
				'as="font"',
				`type="font/${ext}"`,
				`href="${path}"`,
				'crossorigin'
			];

			head += `\n\t\t<link ${attributes.join(' ')}>`;
		}
	}

	const global = __SVELTEKIT_DEV__ ? '__sveltekit_dev' : `__sveltekit_${options.version_hash}`;

	const { data, chunks } = get_data(
		event,
		options,
		branch.map((b) => b.server_data),
		global
	);

	if (page_config.ssr && page_config.csr) {
		body += `\n\t\t\t${fetched
			.map((item) =>
				serialize_data(item, resolve_opts.filterSerializedResponseHeaders, !!state.prerendering)
			)
			.join('\n\t\t\t')}`;
	}

	if (page_config.csr) {
		if (client.uses_env_dynamic_public && state.prerendering) {
			modulepreloads.add(`${options.app_dir}/env.js`);
		}

		const included_modulepreloads = Array.from(modulepreloads, (dep) => prefixed(dep)).filter(
			(path) => resolve_opts.preload({ type: 'js', path })
		);

		for (const path of included_modulepreloads) {
			// see the kit.output.preloadStrategy option for details on why we have multiple options here
			link_header_preloads.add(`<${encodeURI(path)}>; rel="modulepreload"; nopush`);
			if (options.preload_strategy !== 'modulepreload') {
				head += `\n\t\t<link rel="preload" as="script" crossorigin="anonymous" href="${path}">`;
			} else if (state.prerendering) {
				head += `\n\t\t<link rel="modulepreload" href="${path}">`;
			}
		}

		const blocks = [];

		// when serving a prerendered page in an app that uses $env/dynamic/public, we must
		// import the env.js module so that it evaluates before any user code can evaluate.
		// TODO revert to using top-level await once https://bugs.webkit.org/show_bug.cgi?id=242740 is fixed
		// https://github.com/sveltejs/kit/pull/11601
		const load_env_eagerly = client.uses_env_dynamic_public && state.prerendering;

		const properties = [`base: ${base_expression}`];

		if (paths.assets) {
			properties.push(`assets: ${s(paths.assets)}`);
		}

		if (client.uses_env_dynamic_public) {
			properties.push(`env: ${load_env_eagerly ? 'null' : s(public_env)}`);
		}

		if (chunks) {
			blocks.push('const deferred = new Map();');

			properties.push(`defer: (id) => new Promise((fulfil, reject) => {
							deferred.set(id, { fulfil, reject });
						})`);

			properties.push(`resolve: ({ id, data, error }) => {
							const { fulfil, reject } = deferred.get(id);
							deferred.delete(id);

							if (error) reject(error);
							else fulfil(data);
						}`);
		}

		// create this before declaring `data`, which may contain references to `${global}`
		blocks.push(`${global} = {
						${properties.join(',\n\t\t\t\t\t\t')}
					};`);

		const args = ['app', 'element'];

		blocks.push('const element = document.currentScript.parentElement;');

		if (page_config.ssr) {
			const serialized = { form: 'null', error: 'null' };

			blocks.push(`const data = ${data};`);

			if (form_value) {
				serialized.form = uneval_action_response(
					form_value,
					/** @type {string} */ (event.route.id)
				);
			}

			if (error) {
				serialized.error = devalue.uneval(error);
			}

			const hydrate = [
				`node_ids: [${branch.map(({ node }) => node.index).join(', ')}]`,
				'data',
				`form: ${serialized.form}`,
				`error: ${serialized.error}`
			];

			if (status !== 200) {
				hydrate.push(`status: ${status}`);
			}

			if (options.embedded) {
				hydrate.push(`params: ${devalue.uneval(event.params)}`, `route: ${s(event.route)}`);
			}

			const indent = '\t'.repeat(load_env_eagerly ? 7 : 6);
			args.push(`{\n${indent}\t${hydrate.join(`,\n${indent}\t`)}\n${indent}}`);
		}

		if (load_env_eagerly) {
			blocks.push(`import(${s(`${base}/${options.app_dir}/env.js`)}).then(({ env }) => {
						${global}.env = env;

						Promise.all([
							import(${s(prefixed(client.start))}),
							import(${s(prefixed(client.app))})
						]).then(([kit, app]) => {
							kit.start(${args.join(', ')});
						});
					});`);
		} else {
			blocks.push(`Promise.all([
						import(${s(prefixed(client.start))}),
						import(${s(prefixed(client.app))})
					]).then(([kit, app]) => {
						kit.start(${args.join(', ')});
					});`);
		}

		if (options.service_worker) {
			const opts = __SVELTEKIT_DEV__ ? ", { type: 'module' }" : '';

			// we use an anonymous function instead of an arrow function to support
			// older browsers (https://github.com/sveltejs/kit/pull/5417)
			blocks.push(`if ('serviceWorker' in navigator) {
						addEventListener('load', function () {
							navigator.serviceWorker.register('${prefixed('service-worker.js')}'${opts});
						});
					}`);
		}

		const init_app = `
				{
					${blocks.join('\n\n\t\t\t\t\t')}
				}
			`;
		csp.add_script(init_app);

		body += `\n\t\t\t<script${
			csp.script_needs_nonce ? ` nonce="${csp.nonce}"` : ''
		}>${init_app}</script>\n\t\t`;
	}

	const headers = new Headers({
		'x-sveltekit-page': 'true',
		'content-type': 'text/html'
	});

	if (state.prerendering) {
		// TODO read headers set with setHeaders and convert into http-equiv where possible
		const http_equiv = [];

		const csp_headers = csp.csp_provider.get_meta();
		if (csp_headers) {
			http_equiv.push(csp_headers);
		}

		if (state.prerendering.cache) {
			http_equiv.push(`<meta http-equiv="cache-control" content="${state.prerendering.cache}">`);
		}

		if (http_equiv.length > 0) {
			head = http_equiv.join('\n') + head;
		}
	} else {
		const csp_header = csp.csp_provider.get_header();
		if (csp_header) {
			headers.set('content-security-policy', csp_header);
		}
		const report_only_header = csp.report_only_provider.get_header();
		if (report_only_header) {
			headers.set('content-security-policy-report-only', report_only_header);
		}

		if (link_header_preloads.size) {
			headers.set('link', Array.from(link_header_preloads).join(', '));
		}
	}

	// add the content after the script/css links so the link elements are parsed first
	head += rendered.head;

	const html = options.templates.app({
		head,
		body,
		assets,
		nonce: /** @type {string} */ (csp.nonce),
		env: safe_public_env
	});

	// TODO flush chunks as early as we can
	const transformed =
		(await resolve_opts.transformPageChunk({
			html,
			done: true
		})) || '';

	if (!chunks) {
		headers.set('etag', `"${hash(transformed)}"`);
	}

	if (DEV) {
		if (page_config.csr) {
			if (transformed.split('<!--').length < html.split('<!--').length) {
				// the \u001B stuff is ANSI codes, so that we don't need to add a library to the runtime
				// https://svelte.dev/repl/1b3f49696f0c44c881c34587f2537aa2
				console.warn(
					"\u001B[1m\u001B[31mRemoving comments in transformPageChunk can break Svelte's hydration\u001B[39m\u001B[22m"
				);
			}
		} else {
			if (chunks) {
				console.warn(
					'\u001B[1m\u001B[31mReturning promises from server `load` functions will only work if `csr === true`\u001B[39m\u001B[22m'
				);
			}
		}
	}

	return !chunks
		? text(transformed, {
				status,
				headers
			})
		: new Response(
				new ReadableStream({
					async start(controller) {
						controller.enqueue(encoder.encode(transformed + '\n'));
						for await (const chunk of chunks) {
							controller.enqueue(encoder.encode(chunk));
						}
						controller.close();
					},

					type: 'bytes'
				}),
				{
					headers: {
						'content-type': 'text/html'
					}
				}
			);
}

/**
 * If the serialized data contains promises, `chunks` will be an
 * async iterable containing their resolutions
 * @param {import('@sveltejs/kit').RequestEvent} event
 * @param {import('types').SSROptions} options
 * @param {Array<import('types').ServerDataNode | null>} nodes
 * @param {string} global
 * @returns {{ data: string, chunks: AsyncIterable<string> | null }}
 */
function get_data(event, options, nodes, global) {
	let promise_id = 1;
	let count = 0;

	const { iterator, push, done } = create_async_iterator();

	/** @param {any} thing */
	function replacer(thing) {
		if (typeof thing?.then === 'function') {
			const id = promise_id++;
			count += 1;

			thing
				.then(/** @param {any} data */ (data) => ({ data }))
				.catch(
					/** @param {any} error */ async (error) => ({
						error: await handle_error_and_jsonify(event, options, error)
					})
				)
				.then(
					/**
					 * @param {{data: any; error: any}} result
					 */
					async ({ data, error }) => {
						count -= 1;

						let str;
						try {
							str = devalue.uneval({ id, data, error }, replacer);
						} catch (e) {
							error = await handle_error_and_jsonify(
								event,
								options,
								new Error(`Failed to serialize promise while rendering ${event.route.id}`)
							);
							data = undefined;
							str = devalue.uneval({ id, data, error }, replacer);
						}

						push(`<script>${global}.resolve(${str})</script>\n`);
						if (count === 0) done();
					}
				);

			return `${global}.defer(${id})`;
		}
	}

	try {
		const strings = nodes.map((node) => {
			if (!node) return 'null';

			return `{"type":"data","data":${devalue.uneval(node.data, replacer)},${stringify_uses(node)}${
				node.slash ? `,"slash":${JSON.stringify(node.slash)}` : ''
			}}`;
		});

		return {
			data: `[${strings.join(',')}]`,
			chunks: count > 0 ? iterator : null
		};
	} catch (e) {
		throw new Error(clarify_devalue_error(event, /** @type {any} */ (e)));
	}
}

```


####### packages/kit/src/runtime/server/page/respond_with_error.js #######

```

import { render_response } from './render.js';
import { load_data, load_server_data } from './load_data.js';
import { handle_error_and_jsonify, static_error_page, redirect_response } from '../utils.js';
import { get_option } from '../../../utils/options.js';
import { Redirect } from '../../control.js';
import { get_status } from '../../../utils/error.js';

/**
 * @typedef {import('./types.js').Loaded} Loaded
 */

/**
 * @param {{
 *   event: import('@sveltejs/kit').RequestEvent;
 *   options: import('types').SSROptions;
 *   manifest: import('@sveltejs/kit').SSRManifest;
 *   state: import('types').SSRState;
 *   status: number;
 *   error: unknown;
 *   resolve_opts: import('types').RequiredResolveOptions;
 * }} opts
 */
export async function respond_with_error({
	event,
	options,
	manifest,
	state,
	status,
	error,
	resolve_opts
}) {
	// reroute to the fallback page to prevent an infinite chain of requests.
	if (event.request.headers.get('x-sveltekit-error')) {
		return static_error_page(options, status, /** @type {Error} */ (error).message);
	}

	/** @type {import('./types.js').Fetched[]} */
	const fetched = [];

	try {
		const branch = [];
		const default_layout = await manifest._.nodes[0](); // 0 is always the root layout
		const ssr = get_option([default_layout], 'ssr') ?? true;
		const csr = get_option([default_layout], 'csr') ?? true;

		if (ssr) {
			state.error = true;

			const server_data_promise = load_server_data({
				event,
				state,
				node: default_layout,
				parent: async () => ({})
			});

			const server_data = await server_data_promise;

			const data = await load_data({
				event,
				fetched,
				node: default_layout,
				parent: async () => ({}),
				resolve_opts,
				server_data_promise,
				state,
				csr
			});

			branch.push(
				{
					node: default_layout,
					server_data,
					data
				},
				{
					node: await manifest._.nodes[1](), // 1 is always the root error
					data: null,
					server_data: null
				}
			);
		}

		return await render_response({
			options,
			manifest,
			state,
			page_config: {
				ssr,
				csr
			},
			status,
			error: await handle_error_and_jsonify(event, options, error),
			branch,
			fetched,
			event,
			resolve_opts
		});
	} catch (e) {
		// Edge case: If route is a 404 and the user redirects to somewhere from the root layout,
		// we end up here.
		if (e instanceof Redirect) {
			return redirect_response(e.status, e.location);
		}

		return static_error_page(
			options,
			get_status(e),
			(await handle_error_and_jsonify(event, options, e)).message
		);
	}
}

```


####### packages/kit/src/runtime/server/page/serialize_data.js #######

```

import { escape_html_attr } from '../../../utils/escape.js';
import { hash } from '../../hash.js';

/**
 * Inside a script element, only `</script` and `<!--` hold special meaning to the HTML parser.
 *
 * The first closes the script element, so everything after is treated as raw HTML.
 * The second disables further parsing until `-->`, so the script element might be unexpectedly
 * kept open until until an unrelated HTML comment in the page.
 *
 * U+2028 LINE SEPARATOR and U+2029 PARAGRAPH SEPARATOR are escaped for the sake of pre-2018
 * browsers.
 *
 * @see tests for unsafe parsing examples.
 * @see https://html.spec.whatwg.org/multipage/scripting.html#restrictions-for-contents-of-script-elements
 * @see https://html.spec.whatwg.org/multipage/syntax.html#cdata-rcdata-restrictions
 * @see https://html.spec.whatwg.org/multipage/parsing.html#script-data-state
 * @see https://html.spec.whatwg.org/multipage/parsing.html#script-data-double-escaped-state
 * @see https://github.com/tc39/proposal-json-superset
 * @type {Record<string, string>}
 */
const replacements = {
	'<': '\\u003C',
	'\u2028': '\\u2028',
	'\u2029': '\\u2029'
};

const pattern = new RegExp(`[${Object.keys(replacements).join('')}]`, 'g');

/**
 * Generates a raw HTML string containing a safe script element carrying data and associated attributes.
 *
 * It escapes all the special characters needed to guarantee the element is unbroken, but care must
 * be taken to ensure it is inserted in the document at an acceptable position for a script element,
 * and that the resulting string isn't further modified.
 *
 * @param {import('./types.js').Fetched} fetched
 * @param {(name: string, value: string) => boolean} filter
 * @param {boolean} [prerendering]
 * @returns {string} The raw HTML of a script element carrying the JSON payload.
 * @example const html = serialize_data('/data.json', null, { foo: 'bar' });
 */
export function serialize_data(fetched, filter, prerendering = false) {
	/** @type {Record<string, string>} */
	const headers = {};

	let cache_control = null;
	let age = null;
	let varyAny = false;

	for (const [key, value] of fetched.response.headers) {
		if (filter(key, value)) {
			headers[key] = value;
		}

		if (key === 'cache-control') cache_control = value;
		else if (key === 'age') age = value;
		else if (key === 'vary' && value.trim() === '*') varyAny = true;
	}

	const payload = {
		status: fetched.response.status,
		statusText: fetched.response.statusText,
		headers,
		body: fetched.response_body
	};

	const safe_payload = JSON.stringify(payload).replace(pattern, (match) => replacements[match]);

	const attrs = [
		'type="application/json"',
		'data-sveltekit-fetched',
		`data-url=${escape_html_attr(fetched.url)}`
	];

	if (fetched.is_b64) {
		attrs.push('data-b64');
	}

	if (fetched.request_headers || fetched.request_body) {
		/** @type {import('types').StrictBody[]} */
		const values = [];

		if (fetched.request_headers) {
			values.push([...new Headers(fetched.request_headers)].join(','));
		}

		if (fetched.request_body) {
			values.push(fetched.request_body);
		}

		attrs.push(`data-hash="${hash(...values)}"`);
	}

	// Compute the time the response should be cached, taking into account max-age and age.
	// Do not cache at all if a `Vary: *` header is present, as this indicates that the
	// cache is likely to get busted.
	if (!prerendering && fetched.method === 'GET' && cache_control && !varyAny) {
		const match = /s-maxage=(\d+)/g.exec(cache_control) ?? /max-age=(\d+)/g.exec(cache_control);
		if (match) {
			const ttl = +match[1] - +(age ?? '0');
			attrs.push(`data-ttl="${ttl}"`);
		}
	}

	return `<script ${attrs.join(' ')}>${safe_payload}</script>`;
}

```


####### packages/kit/src/runtime/server/page/serialize_data.spec.js #######

```

import { assert, test } from 'vitest';
import { serialize_data } from './serialize_data.js';

test('escapes slashes', () => {
	const response_body = '</script><script>alert("xss")';

	assert.equal(
		serialize_data(
			{
				url: 'foo',
				method: 'GET',
				request_body: null,
				response_body,
				response: new Response(response_body)
			},
			() => false
		),
		'<script type="application/json" data-sveltekit-fetched data-url="foo">' +
			'{"status":200,"statusText":"","headers":{},"body":"\\u003C/script>\\u003Cscript>alert(\\"xss\\")"}' +
			'</script>'
	);
});

test('escapes exclamation marks', () => {
	const response_body = '<!--</script>...-->alert("xss")';

	assert.equal(
		serialize_data(
			{
				url: 'foo',
				method: 'GET',
				request_body: null,
				response_body,
				response: new Response(response_body)
			},
			() => false
		),
		'<script type="application/json" data-sveltekit-fetched data-url="foo">' +
			'{"status":200,"statusText":"","headers":{},"body":"\\u003C!--\\u003C/script>...-->alert(\\"xss\\")"}' +
			'</script>'
	);
});

test('escapes the attribute values', () => {
	const raw = 'an "attr" & a \ud800';
	const escaped = 'an &quot;attr&quot; &amp; a &#55296;';
	const response_body = '';
	assert.equal(
		serialize_data(
			{
				url: raw,
				method: 'GET',
				request_body: null,
				response_body,
				response: new Response(response_body)
			},
			() => false
		),
		`<script type="application/json" data-sveltekit-fetched data-url="${escaped}">{"status":200,"statusText":"","headers":{},"body":""}</script>`
	);
});

test('computes ttl using cache-control and age headers', () => {
	const raw = 'an "attr" & a \ud800';
	const escaped = 'an &quot;attr&quot; &amp; a &#55296;';
	const response_body = '';
	assert.equal(
		serialize_data(
			{
				url: raw,
				method: 'GET',
				request_body: null,
				response_body,
				response: new Response(response_body, {
					headers: { 'cache-control': 'max-age=10', age: '1' }
				})
			},
			() => false
		),
		`<script type="application/json" data-sveltekit-fetched data-url="${escaped}" data-ttl="9">{"status":200,"statusText":"","headers":{},"body":""}</script>`
	);
});

test('doesnt compute ttl when vary * header is present', () => {
	const raw = 'an "attr" & a \ud800';
	const escaped = 'an &quot;attr&quot; &amp; a &#55296;';
	const response_body = '';
	assert.equal(
		serialize_data(
			{
				url: raw,
				method: 'GET',
				request_body: null,
				response_body,
				response: new Response(response_body, {
					headers: { 'cache-control': 'max-age=10', vary: '*' }
				})
			},
			() => false
		),
		`<script type="application/json" data-sveltekit-fetched data-url="${escaped}">{"status":200,"statusText":"","headers":{},"body":""}</script>`
	);
});

```


####### packages/kit/src/runtime/server/page/types.d.ts #######

```

import { CookieSerializeOptions } from 'cookie';
import { SSRNode, CspDirectives, ServerDataNode } from 'types';

export interface Fetched {
	url: string;
	method: string;
	request_body?: string | ArrayBufferView | null;
	request_headers?: HeadersInit | undefined;
	response_body: string;
	response: Response;
	is_b64?: boolean;
}

export type Loaded = {
	node: SSRNode;
	data: Record<string, any> | null;
	server_data: ServerDataNode | null;
};

type CspMode = 'hash' | 'nonce' | 'auto';

export interface CspConfig {
	mode: CspMode;
	directives: CspDirectives;
	reportOnly: CspDirectives;
}

export interface CspOpts {
	prerender: boolean;
}

export interface Cookie {
	name: string;
	value: string;
	options: CookieSerializeOptions & { path: string };
}

```


####### packages/kit/src/runtime/server/respond.js #######

```

import { DEV } from 'esm-env';
import { base } from '__sveltekit/paths';
import { is_endpoint_request, render_endpoint } from './endpoint.js';
import { render_page } from './page/index.js';
import { render_response } from './page/render.js';
import { respond_with_error } from './page/respond_with_error.js';
import { is_form_content_type } from '../../utils/http.js';
import { handle_fatal_error, method_not_allowed, redirect_response } from './utils.js';
import {
	decode_pathname,
	decode_params,
	disable_search,
	has_data_suffix,
	normalize_path,
	strip_data_suffix
} from '../../utils/url.js';
import { exec } from '../../utils/routing.js';
import { redirect_json_response, render_data } from './data/index.js';
import { add_cookies_to_headers, get_cookies } from './cookie.js';
import { create_fetch } from './fetch.js';
import { HttpError, Redirect, SvelteKitError } from '../control.js';
import {
	validate_layout_exports,
	validate_layout_server_exports,
	validate_page_exports,
	validate_page_server_exports,
	validate_server_exports
} from '../../utils/exports.js';
import { get_option } from '../../utils/options.js';
import { json, text } from '../../exports/index.js';
import { action_json_redirect, is_action_json_request } from './page/actions.js';
import { INVALIDATED_PARAM, TRAILING_SLASH_PARAM } from '../shared.js';
import { get_public_env } from './env_module.js';
import { load_page_nodes } from './page/load_page_nodes.js';
import { get_page_config } from '../../utils/route_config.js';

/* global __SVELTEKIT_ADAPTER_NAME__ */

/** @type {import('types').RequiredResolveOptions['transformPageChunk']} */
const default_transform = ({ html }) => html;

/** @type {import('types').RequiredResolveOptions['filterSerializedResponseHeaders']} */
const default_filter = () => false;

/** @type {import('types').RequiredResolveOptions['preload']} */
const default_preload = ({ type }) => type === 'js' || type === 'css';

const page_methods = new Set(['GET', 'HEAD', 'POST']);

const allowed_page_methods = new Set(['GET', 'HEAD', 'OPTIONS']);

/**
 * @param {Request} request
 * @param {import('types').SSROptions} options
 * @param {import('@sveltejs/kit').SSRManifest} manifest
 * @param {import('types').SSRState} state
 * @returns {Promise<Response>}
 */
export async function respond(request, options, manifest, state) {
	/** URL but stripped from the potential `/__data.json` suffix and its search param  */
	const url = new URL(request.url);

	if (options.csrf_check_origin) {
		const forbidden =
			is_form_content_type(request) &&
			(request.method === 'POST' ||
				request.method === 'PUT' ||
				request.method === 'PATCH' ||
				request.method === 'DELETE') &&
			request.headers.get('origin') !== url.origin;

		if (forbidden) {
			const csrf_error = new HttpError(
				403,
				`Cross-site ${request.method} form submissions are forbidden`
			);
			if (request.headers.get('accept') === 'application/json') {
				return json(csrf_error.body, { status: csrf_error.status });
			}
			return text(csrf_error.body.message, { status: csrf_error.status });
		}
	}

	// reroute could alter the given URL, so we pass a copy
	let rerouted_path;
	try {
		rerouted_path = options.hooks.reroute({ url: new URL(url) }) ?? url.pathname;
	} catch (e) {
		return text('Internal Server Error', {
			status: 500
		});
	}

	let decoded;
	try {
		decoded = decode_pathname(rerouted_path);
	} catch {
		return text('Malformed URI', { status: 400 });
	}

	/** @type {import('types').SSRRoute | null} */
	let route = null;

	/** @type {Record<string, string>} */
	let params = {};

	if (base && !state.prerendering?.fallback) {
		if (!decoded.startsWith(base)) {
			return text('Not found', { status: 404 });
		}
		decoded = decoded.slice(base.length) || '/';
	}

	if (decoded === `/${options.app_dir}/env.js`) {
		return get_public_env(request);
	}

	if (decoded.startsWith(`/${options.app_dir}`)) {
		return text('Not found', { status: 404 });
	}

	const is_data_request = has_data_suffix(decoded);
	/** @type {boolean[] | undefined} */
	let invalidated_data_nodes;
	if (is_data_request) {
		decoded = strip_data_suffix(decoded) || '/';
		url.pathname =
			strip_data_suffix(url.pathname) +
				(url.searchParams.get(TRAILING_SLASH_PARAM) === '1' ? '/' : '') || '/';
		url.searchParams.delete(TRAILING_SLASH_PARAM);
		invalidated_data_nodes = url.searchParams
			.get(INVALIDATED_PARAM)
			?.split('')
			.map((node) => node === '1');
		url.searchParams.delete(INVALIDATED_PARAM);
	}

	if (!state.prerendering?.fallback) {
		// TODO this could theoretically break — should probably be inside a try-catch
		const matchers = await manifest._.matchers();

		for (const candidate of manifest._.routes) {
			const match = candidate.pattern.exec(decoded);
			if (!match) continue;

			const matched = exec(match, candidate.params, matchers);
			if (matched) {
				route = candidate;
				params = decode_params(matched);
				break;
			}
		}
	}

	/** @type {import('types').TrailingSlash | void} */
	let trailing_slash = undefined;

	/** @type {Record<string, string>} */
	const headers = {};

	/** @type {Record<string, import('./page/types.js').Cookie>} */
	let cookies_to_add = {};

	/** @type {import('@sveltejs/kit').RequestEvent} */
	const event = {
		// @ts-expect-error `cookies` and `fetch` need to be created after the `event` itself
		cookies: null,
		// @ts-expect-error
		fetch: null,
		getClientAddress:
			state.getClientAddress ||
			(() => {
				throw new Error(
					`${__SVELTEKIT_ADAPTER_NAME__} does not specify getClientAddress. Please raise an issue`
				);
			}),
		locals: {},
		params,
		platform: state.platform,
		request,
		route: { id: route?.id ?? null },
		setHeaders: (new_headers) => {
			for (const key in new_headers) {
				const lower = key.toLowerCase();
				const value = new_headers[key];

				if (lower === 'set-cookie') {
					throw new Error(
						'Use `event.cookies.set(name, value, options)` instead of `event.setHeaders` to set cookies'
					);
				} else if (lower in headers) {
					throw new Error(`"${key}" header is already set`);
				} else {
					headers[lower] = value;

					if (state.prerendering && lower === 'cache-control') {
						state.prerendering.cache = /** @type {string} */ (value);
					}
				}
			}
		},
		url,
		isDataRequest: is_data_request,
		isSubRequest: state.depth > 0
	};

	/** @type {import('types').RequiredResolveOptions} */
	let resolve_opts = {
		transformPageChunk: default_transform,
		filterSerializedResponseHeaders: default_filter,
		preload: default_preload
	};

	try {
		// determine whether we need to redirect to add/remove a trailing slash
		if (route) {
			// if `paths.base === '/a/b/c`, then the root route is `/a/b/c/`,
			// regardless of the `trailingSlash` route option
			if (url.pathname === base || url.pathname === base + '/') {
				trailing_slash = 'always';
			} else if (route.page) {
				const nodes = await load_page_nodes(route.page, manifest);

				if (DEV) {
					const layouts = nodes.slice(0, -1);
					const page = nodes.at(-1);

					for (const layout of layouts) {
						if (layout) {
							validate_layout_server_exports(
								layout.server,
								/** @type {string} */ (layout.server_id)
							);
							validate_layout_exports(
								layout.universal,
								/** @type {string} */ (layout.universal_id)
							);
						}
					}

					if (page) {
						validate_page_server_exports(page.server, /** @type {string} */ (page.server_id));
						validate_page_exports(page.universal, /** @type {string} */ (page.universal_id));
					}
				}

				trailing_slash = get_option(nodes, 'trailingSlash');
			} else if (route.endpoint) {
				const node = await route.endpoint();
				trailing_slash = node.trailingSlash;

				if (DEV) {
					validate_server_exports(node, /** @type {string} */ (route.endpoint_id));
				}
			}

			if (!is_data_request) {
				const normalized = normalize_path(url.pathname, trailing_slash ?? 'never');

				if (normalized !== url.pathname && !state.prerendering?.fallback) {
					return new Response(undefined, {
						status: 308,
						headers: {
							'x-sveltekit-normalize': '1',
							location:
								// ensure paths starting with '//' are not treated as protocol-relative
								(normalized.startsWith('//') ? url.origin + normalized : normalized) +
								(url.search === '?' ? '' : url.search)
						}
					});
				}
			}

			if (state.before_handle || state.emulator?.platform) {
				let config = {};

				/** @type {import('types').PrerenderOption} */
				let prerender = false;

				if (route.endpoint) {
					const node = await route.endpoint();
					config = node.config ?? config;
					prerender = node.prerender ?? prerender;
				} else if (route.page) {
					const nodes = await load_page_nodes(route.page, manifest);
					config = get_page_config(nodes) ?? config;
					prerender = get_option(nodes, 'prerender') ?? false;
				}

				if (state.before_handle) {
					state.before_handle(event, config, prerender);
				}

				if (state.emulator?.platform) {
					event.platform = await state.emulator.platform({ config, prerender });
				}
			}
		}

		const { cookies, new_cookies, get_cookie_header, set_internal } = get_cookies(
			request,
			url,
			trailing_slash ?? 'never'
		);

		cookies_to_add = new_cookies;
		event.cookies = cookies;
		event.fetch = create_fetch({
			event,
			options,
			manifest,
			state,
			get_cookie_header,
			set_internal
		});

		if (state.prerendering && !state.prerendering.fallback) disable_search(url);

		const response = await options.hooks.handle({
			event,
			resolve: (event, opts) =>
				resolve(event, opts).then((response) => {
					// add headers/cookies here, rather than inside `resolve`, so that we
					// can do it once for all responses instead of once per `return`
					for (const key in headers) {
						const value = headers[key];
						response.headers.set(key, /** @type {string} */ (value));
					}

					add_cookies_to_headers(response.headers, Object.values(cookies_to_add));

					if (state.prerendering && event.route.id !== null) {
						response.headers.set('x-sveltekit-routeid', encodeURI(event.route.id));
					}

					return response;
				})
		});

		// respond with 304 if etag matches
		if (response.status === 200 && response.headers.has('etag')) {
			let if_none_match_value = request.headers.get('if-none-match');

			// ignore W/ prefix https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-None-Match#directives
			if (if_none_match_value?.startsWith('W/"')) {
				if_none_match_value = if_none_match_value.substring(2);
			}

			const etag = /** @type {string} */ (response.headers.get('etag'));

			if (if_none_match_value === etag) {
				const headers = new Headers({ etag });

				// https://datatracker.ietf.org/doc/html/rfc7232#section-4.1 + set-cookie
				for (const key of [
					'cache-control',
					'content-location',
					'date',
					'expires',
					'vary',
					'set-cookie'
				]) {
					const value = response.headers.get(key);
					if (value) headers.set(key, value);
				}

				return new Response(undefined, {
					status: 304,
					headers
				});
			}
		}

		// Edge case: If user does `return Response(30x)` in handle hook while processing a data request,
		// we need to transform the redirect response to a corresponding JSON response.
		if (is_data_request && response.status >= 300 && response.status <= 308) {
			const location = response.headers.get('location');
			if (location) {
				return redirect_json_response(new Redirect(/** @type {any} */ (response.status), location));
			}
		}

		return response;
	} catch (e) {
		if (e instanceof Redirect) {
			const response = is_data_request
				? redirect_json_response(e)
				: route?.page && is_action_json_request(event)
					? action_json_redirect(e)
					: redirect_response(e.status, e.location);
			add_cookies_to_headers(response.headers, Object.values(cookies_to_add));
			return response;
		}
		return await handle_fatal_error(event, options, e);
	}

	/**
	 * @param {import('@sveltejs/kit').RequestEvent} event
	 * @param {import('@sveltejs/kit').ResolveOptions} [opts]
	 */
	async function resolve(event, opts) {
		try {
			if (opts) {
				resolve_opts = {
					transformPageChunk: opts.transformPageChunk || default_transform,
					filterSerializedResponseHeaders: opts.filterSerializedResponseHeaders || default_filter,
					preload: opts.preload || default_preload
				};
			}

			if (state.prerendering?.fallback) {
				return await render_response({
					event,
					options,
					manifest,
					state,
					page_config: { ssr: false, csr: true },
					status: 200,
					error: null,
					branch: [],
					fetched: [],
					resolve_opts
				});
			}

			if (route) {
				const method = /** @type {import('types').HttpMethod} */ (event.request.method);

				/** @type {Response} */
				let response;

				if (is_data_request) {
					response = await render_data(
						event,
						route,
						options,
						manifest,
						state,
						invalidated_data_nodes,
						trailing_slash ?? 'never'
					);
				} else if (route.endpoint && (!route.page || is_endpoint_request(event))) {
					response = await render_endpoint(event, await route.endpoint(), state);
				} else if (route.page) {
					if (page_methods.has(method)) {
						response = await render_page(event, route.page, options, manifest, state, resolve_opts);
					} else {
						const allowed_methods = new Set(allowed_page_methods);
						const node = await manifest._.nodes[route.page.leaf]();
						if (node?.server?.actions) {
							allowed_methods.add('POST');
						}

						if (method === 'OPTIONS') {
							// This will deny CORS preflight requests implicitly because we don't
							// add the required CORS headers to the response.
							response = new Response(null, {
								status: 204,
								headers: {
									allow: Array.from(allowed_methods.values()).join(', ')
								}
							});
						} else {
							const mod = [...allowed_methods].reduce((acc, curr) => {
								acc[curr] = true;
								return acc;
							}, /** @type {Record<string, any>} */ ({}));
							response = method_not_allowed(mod, method);
						}
					}
				} else {
					// a route will always have a page or an endpoint, but TypeScript
					// doesn't know that
					throw new Error('This should never happen');
				}

				// If the route contains a page and an endpoint, we need to add a
				// `Vary: Accept` header to the response because of browser caching
				if (request.method === 'GET' && route.page && route.endpoint) {
					const vary = response.headers
						.get('vary')
						?.split(',')
						?.map((v) => v.trim().toLowerCase());
					if (!(vary?.includes('accept') || vary?.includes('*'))) {
						// the returned response might have immutable headers,
						// so we have to clone them before trying to mutate them
						response = new Response(response.body, {
							status: response.status,
							statusText: response.statusText,
							headers: new Headers(response.headers)
						});
						response.headers.append('Vary', 'Accept');
					}
				}

				return response;
			}

			if (state.error && event.isSubRequest) {
				return await fetch(request, {
					headers: {
						'x-sveltekit-error': 'true'
					}
				});
			}

			if (state.error) {
				return text('Internal Server Error', {
					status: 500
				});
			}

			// if this request came direct from the user, rather than
			// via our own `fetch`, render a 404 page
			if (state.depth === 0) {
				return await respond_with_error({
					event,
					options,
					manifest,
					state,
					status: 404,
					error: new SvelteKitError(404, 'Not Found', `Not found: ${event.url.pathname}`),
					resolve_opts
				});
			}

			if (state.prerendering) {
				return text('not found', { status: 404 });
			}

			// we can't load the endpoint from our own manifest,
			// so we need to make an actual HTTP request
			return await fetch(request);
		} catch (e) {
			// TODO if `e` is instead named `error`, some fucked up Vite transformation happens
			// and I don't even know how to describe it. need to investigate at some point

			// HttpError from endpoint can end up here - TODO should it be handled there instead?
			return await handle_fatal_error(event, options, e);
		} finally {
			event.cookies.set = () => {
				throw new Error('Cannot use `cookies.set(...)` after the response has been generated');
			};

			event.setHeaders = () => {
				throw new Error('Cannot use `setHeaders(...)` after the response has been generated');
			};
		}
	}
}

```


####### packages/kit/src/runtime/server/utils.js #######

```

import { DEV } from 'esm-env';
import { json, text } from '../../exports/index.js';
import { coalesce_to_error, get_message, get_status } from '../../utils/error.js';
import { negotiate } from '../../utils/http.js';
import { HttpError } from '../control.js';
import { fix_stack_trace } from '../shared-server.js';
import { ENDPOINT_METHODS } from '../../constants.js';

/** @param {any} body */
export function is_pojo(body) {
	if (typeof body !== 'object') return false;

	if (body) {
		if (body instanceof Uint8Array) return false;
		if (body instanceof ReadableStream) return false;
	}

	return true;
}

/**
 * @param {Partial<Record<import('types').HttpMethod, any>>} mod
 * @param {import('types').HttpMethod} method
 */
export function method_not_allowed(mod, method) {
	return text(`${method} method not allowed`, {
		status: 405,
		headers: {
			// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/405
			// "The server must generate an Allow header field in a 405 status code response"
			allow: allowed_methods(mod).join(', ')
		}
	});
}

/** @param {Partial<Record<import('types').HttpMethod, any>>} mod */
export function allowed_methods(mod) {
	const allowed = ENDPOINT_METHODS.filter((method) => method in mod);

	if ('GET' in mod || 'HEAD' in mod) allowed.push('HEAD');

	return allowed;
}

/**
 * Return as a response that renders the error.html
 *
 * @param {import('types').SSROptions} options
 * @param {number} status
 * @param {string} message
 */
export function static_error_page(options, status, message) {
	let page = options.templates.error({ status, message });

	if (DEV) {
		// inject Vite HMR client, for easier debugging
		page = page.replace('</head>', '<script type="module" src="/@vite/client"></script></head>');
	}

	return text(page, {
		headers: { 'content-type': 'text/html; charset=utf-8' },
		status
	});
}

/**
 * @param {import('@sveltejs/kit').RequestEvent} event
 * @param {import('types').SSROptions} options
 * @param {unknown} error
 */
export async function handle_fatal_error(event, options, error) {
	error = error instanceof HttpError ? error : coalesce_to_error(error);
	const status = get_status(error);
	const body = await handle_error_and_jsonify(event, options, error);

	// ideally we'd use sec-fetch-dest instead, but Safari — quelle surprise — doesn't support it
	const type = negotiate(event.request.headers.get('accept') || 'text/html', [
		'application/json',
		'text/html'
	]);

	if (event.isDataRequest || type === 'application/json') {
		return json(body, {
			status
		});
	}

	return static_error_page(options, status, body.message);
}

/**
 * @param {import('@sveltejs/kit').RequestEvent} event
 * @param {import('types').SSROptions} options
 * @param {any} error
 * @returns {Promise<App.Error>}
 */
export async function handle_error_and_jsonify(event, options, error) {
	if (error instanceof HttpError) {
		return error.body;
	}

	if (__SVELTEKIT_DEV__ && typeof error == 'object') {
		fix_stack_trace(error);
	}

	const status = get_status(error);
	const message = get_message(error);

	return (await options.hooks.handleError({ error, event, status, message })) ?? { message };
}

/**
 * @param {number} status
 * @param {string} location
 */
export function redirect_response(status, location) {
	const response = new Response(undefined, {
		status,
		headers: { location }
	});
	return response;
}

/**
 * @param {import('@sveltejs/kit').RequestEvent} event
 * @param {Error & { path: string }} error
 */
export function clarify_devalue_error(event, error) {
	if (error.path) {
		return `Data returned from \`load\` while rendering ${event.route.id} is not serializable: ${error.message} (data${error.path})`;
	}

	if (error.path === '') {
		return `Data returned from \`load\` while rendering ${event.route.id} is not a plain object`;
	}

	// belt and braces — this should never happen
	return error.message;
}

/**
 * @param {import('types').ServerDataNode} node
 */
export function stringify_uses(node) {
	const uses = [];

	if (node.uses && node.uses.dependencies.size > 0) {
		uses.push(`"dependencies":${JSON.stringify(Array.from(node.uses.dependencies))}`);
	}

	if (node.uses && node.uses.search_params.size > 0) {
		uses.push(`"search_params":${JSON.stringify(Array.from(node.uses.search_params))}`);
	}

	if (node.uses && node.uses.params.size > 0) {
		uses.push(`"params":${JSON.stringify(Array.from(node.uses.params))}`);
	}

	if (node.uses?.parent) uses.push('"parent":1');
	if (node.uses?.route) uses.push('"route":1');
	if (node.uses?.url) uses.push('"url":1');

	return `"uses":{${uses.join(',')}}`;
}

/**
 * @param {string} message
 * @param {number} offset
 */
export function warn_with_callsite(message, offset = 0) {
	if (DEV) {
		const stack = fix_stack_trace(new Error()).split('\n');
		const line = stack.at(3 + offset);
		message += `\n${line}`;
	}

	console.warn(message);
}

```


####### packages/kit/src/runtime/shared.js #######

```

/**
 * @param {string} route_id
 * @param {string} dep
 */
export function validate_depends(route_id, dep) {
	const match = /^(moz-icon|view-source|jar):/.exec(dep);
	if (match) {
		console.warn(
			`${route_id}: Calling \`depends('${dep}')\` will throw an error in Firefox because \`${match[1]}\` is a special URI scheme`
		);
	}
}

export const INVALIDATED_PARAM = 'x-sveltekit-invalidated';

export const TRAILING_SLASH_PARAM = 'x-sveltekit-trailing-slash';

```


####### packages/kit/src/runtime/shared-server.js #######

```

/**
 * `$env/dynamic/private`
 * @type {Record<string, string>}
 */
export let private_env = {};

/**
 * `$env/dynamic/public`. When prerendering, this will be a proxy that forbids reads
 * @type {Record<string, string>}
 */
export let public_env = {};

/**
 * The same as `public_env`, but without the proxy. Use for `%sveltekit.env.PUBLIC_FOO%`
 * @type {Record<string, string>}
 */
export let safe_public_env = {};

/** @param {any} error */
export let fix_stack_trace = (error) => error?.stack;

/** @type {(environment: Record<string, string>) => void} */
export function set_private_env(environment) {
	private_env = environment;
}

/** @type {(environment: Record<string, string>) => void} */
export function set_public_env(environment) {
	public_env = environment;
}

/** @type {(environment: Record<string, string>) => void} */
export function set_safe_public_env(environment) {
	safe_public_env = environment;
}

/** @param {(error: Error) => string} value */
export function set_fix_stack_trace(value) {
	fix_stack_trace = value;
}

```


####### packages/kit/src/runtime/utils.js #######

```

/**
 * @param {string} text
 * @returns {ArrayBufferLike}
 */
export function b64_decode(text) {
	const d = atob(text);

	const u8 = new Uint8Array(d.length);

	for (let i = 0; i < d.length; i++) {
		u8[i] = d.charCodeAt(i);
	}

	return u8.buffer;
}

/**
 * @param {ArrayBuffer} buffer
 * @returns {string}
 */
export function b64_encode(buffer) {
	if (globalThis.Buffer) {
		return Buffer.from(buffer).toString('base64');
	}

	const little_endian = new Uint8Array(new Uint16Array([1]).buffer)[0] > 0;

	// The Uint16Array(Uint8Array(...)) ensures the code points are padded with 0's
	return btoa(
		new TextDecoder(little_endian ? 'utf-16le' : 'utf-16be').decode(
			new Uint16Array(new Uint8Array(buffer))
		)
	);
}

```


####### packages/kit/src/types/ambient.d.ts #######

```

/**
 * It's possible to tell SvelteKit how to type objects inside your app by declaring the `App` namespace. By default, a new project will have a file called `src/app.d.ts` containing the following:
 *
 * ```ts
 * declare global {
 * 	namespace App {
 * 		// interface Error {}
 * 		// interface Locals {}
 * 		// interface PageData {}
 * 		// interface PageState {}
 * 		// interface Platform {}
 * 	}
 * }
 *
 * export {};
 * ```
 *
 * The `export {}` line exists because without it, the file would be treated as an _ambient module_ which prevents you from adding `import` declarations.
 * If you need to add ambient `declare module` declarations, do so in a separate file like `src/ambient.d.ts`.
 *
 * By populating these interfaces, you will gain type safety when using `event.locals`, `event.platform`, and `data` from `load` functions.
 */
declare namespace App {
	/**
	 * Defines the common shape of expected and unexpected errors. Expected errors are thrown using the `error` function. Unexpected errors are handled by the `handleError` hooks which should return this shape.
	 */
	export interface Error {
		message: string;
	}

	/**
	 * The interface that defines `event.locals`, which can be accessed in [hooks](https://kit.svelte.dev/docs/hooks) (`handle`, and `handleError`), server-only `load` functions, and `+server.js` files.
	 */
	export interface Locals {}

	/**
	 * Defines the common shape of the [$page.data store](https://kit.svelte.dev/docs/modules#$app-stores-page) - that is, the data that is shared between all pages.
	 * The `Load` and `ServerLoad` functions in `./$types` will be narrowed accordingly.
	 * Use optional properties for data that is only present on specific pages. Do not add an index signature (`[key: string]: any`).
	 */
	export interface PageData {}

	/**
	 * The shape of the `$page.state` object, which can be manipulated using the [`pushState`](https://kit.svelte.dev/docs/modules#$app-navigation-pushstate) and [`replaceState`](https://kit.svelte.dev/docs/modules#$app-navigation-replacestate) functions from `$app/navigation`.
	 */
	export interface PageState {}

	/**
	 * If your adapter provides [platform-specific context](https://kit.svelte.dev/docs/adapters#platform-specific-context) via `event.platform`, you can specify it here.
	 */
	export interface Platform {}
}

/**
 * This module is only available to [service workers](https://kit.svelte.dev/docs/service-workers).
 */
declare module '$service-worker' {
	/**
	 * The `base` path of the deployment. Typically this is equivalent to `config.kit.paths.base`, but it is calculated from `location.pathname` meaning that it will continue to work correctly if the site is deployed to a subdirectory.
	 * Note that there is a `base` but no `assets`, since service workers cannot be used if `config.kit.paths.assets` is specified.
	 */
	export const base: string;
	/**
	 * An array of URL strings representing the files generated by Vite, suitable for caching with `cache.addAll(build)`.
	 * During development, this is an empty array.
	 */
	export const build: string[];
	/**
	 * An array of URL strings representing the files in your static directory, or whatever directory is specified by `config.kit.files.assets`. You can customize which files are included from `static` directory using [`config.kit.serviceWorker.files`](https://kit.svelte.dev/docs/configuration)
	 */
	export const files: string[];
	/**
	 * An array of pathnames corresponding to prerendered pages and endpoints.
	 * During development, this is an empty array.
	 */
	export const prerendered: string[];
	/**
	 * See [`config.kit.version`](https://kit.svelte.dev/docs/configuration#version). It's useful for generating unique cache names inside your service worker, so that a later deployment of your app can invalidate old caches.
	 */
	export const version: string;
}

```


####### packages/kit/src/types/ambient-private.d.ts #######

```

/** Internal version of $app/environment */
declare module '__sveltekit/environment' {
	export const building: boolean;
	export const prerendering: boolean;
	export const version: string;
	export function set_building(): void;
	export function set_prerendering(): void;
}

/** Internal version of $app/paths */
declare module '__sveltekit/paths' {
	export let base: '' | `/${string}`;
	export let assets: '' | `https://${string}` | `http://${string}` | '/_svelte_kit_assets';
	export let relative: boolean;
	export function reset(): void;
	export function override(paths: { base: string; assets: string }): void;
	export function set_assets(path: string): void;
}

/** Internal version of $app/server */
declare module '__sveltekit/server' {
	import { SSRManifest } from '@sveltejs/kit';

	export let manifest: SSRManifest;
	export function read_implementation(path: string): ReadableStream;
	export function set_manifest(manifest: SSRManifest): void;
	export function set_read_implementation(fn: (path: string) => ReadableStream): void;
}

```


####### packages/kit/src/types/global-private.d.ts #######

```

declare global {
	const __SVELTEKIT_ADAPTER_NAME__: string;
	const __SVELTEKIT_APP_VERSION_FILE__: string;
	const __SVELTEKIT_APP_VERSION_POLL_INTERVAL__: number;
	const __SVELTEKIT_DEV__: boolean;
	const __SVELTEKIT_EMBEDDED__: boolean;
	/**
	 * This makes the use of specific features visible at both dev and build time, in such a
	 * way that we can error when they are not supported by the target platform.
	 *
	 * During dev, `globalThis.__SVELTEKIT_TRACK__` is a function that grabs the current `event`
	 * and route `config` (from an AsyncLocalStorage instance) and calls the relevant `supports`
	 * function on the adapter (e.g. `adapter.supports.read(...)`).
	 *
	 * At build time, if the function containing the `__SVELTEKIT_TRACK__` call is untreeshaken,
	 * we locate it in the `renderChunk` build hook and a) make a note of the chunk that contains
	 * it and b) replace it with a comment. Later, we can use this information to establish
	 * which routes use which feature, and use the same `adapter.supports.read(...)` function
	 * to throw an error if the feature would fail in production.
	 */
	var __SVELTEKIT_TRACK__: (label: string) => void;
	var Bun: object;
	var Deno: object;
}

export {};

```


####### packages/kit/src/types/internal.d.ts #######

```

import { SvelteComponent } from 'svelte';
import {
	Config,
	ServerLoad,
	Handle,
	HandleServerError,
	KitConfig,
	Load,
	RequestHandler,
	ResolveOptions,
	Server,
	ServerInitOptions,
	HandleFetch,
	Actions,
	HandleClientError,
	Reroute,
	RequestEvent,
	SSRManifest,
	Emulator,
	Adapter
} from '@sveltejs/kit';
import {
	HttpMethod,
	MaybePromise,
	PrerenderOption,
	RequestOptions,
	TrailingSlash
} from './private.js';

export interface ServerModule {
	Server: typeof InternalServer;
}

export interface ServerInternalModule {
	set_assets(path: string): void;
	set_building(): void;
	set_manifest(manifest: SSRManifest): void;
	set_prerendering(): void;
	set_private_env(environment: Record<string, string>): void;
	set_public_env(environment: Record<string, string>): void;
	set_read_implementation(implementation: (path: string) => ReadableStream): void;
	set_safe_public_env(environment: Record<string, string>): void;
	set_version(version: string): void;
	set_fix_stack_trace(fix_stack_trace: (error: unknown) => string): void;
}

export interface Asset {
	file: string;
	size: number;
	type: string | null;
}

export interface AssetDependencies {
	assets: string[];
	file: string;
	imports: string[];
	stylesheets: string[];
	fonts: string[];
}

export interface BuildData {
	app_dir: string;
	app_path: string;
	manifest_data: ManifestData;
	out_dir: string;
	service_worker: string | null;
	client: {
		start: string;
		app: string;
		imports: string[];
		stylesheets: string[];
		fonts: string[];
		uses_env_dynamic_public: boolean;
	} | null;
	server_manifest: import('vite').Manifest;
}

export interface CSRPageNode {
	component: typeof SvelteComponent;
	universal: {
		load?: Load;
		trailingSlash?: TrailingSlash;
	};
}

export type CSRPageNodeLoader = () => Promise<CSRPageNode>;

/**
 * Definition of a client side route.
 * The boolean in the tuples indicates whether the route has a server load.
 */
export type CSRRoute = {
	id: string;
	exec(path: string): undefined | Record<string, string>;
	errors: Array<CSRPageNodeLoader | undefined>;
	layouts: Array<[has_server_load: boolean, node_loader: CSRPageNodeLoader] | undefined>;
	leaf: [has_server_load: boolean, node_loader: CSRPageNodeLoader];
};

export interface Deferred {
	fulfil: (value: any) => void;
	reject: (error: Error) => void;
}

export type GetParams = (match: RegExpExecArray) => Record<string, string>;

export interface ServerHooks {
	handleFetch: HandleFetch;
	handle: Handle;
	handleError: HandleServerError;
	reroute: Reroute;
}

export interface ClientHooks {
	handleError: HandleClientError;
	reroute: Reroute;
}

export interface Env {
	private: Record<string, string>;
	public: Record<string, string>;
}

export class InternalServer extends Server {
	init(options: ServerInitOptions): Promise<void>;
	respond(
		request: Request,
		options: RequestOptions & {
			prerendering?: PrerenderOptions;
			read: (file: string) => Buffer;
			/** A hook called before `handle` during dev, so that `AsyncLocalStorage` can be populated */
			before_handle?: (event: RequestEvent, config: any, prerender: PrerenderOption) => void;
			emulator?: Emulator;
		}
	): Promise<Response>;
}

export interface ManifestData {
	assets: Asset[];
	hooks: {
		client: string | null;
		server: string | null;
		universal: string | null;
	};
	nodes: PageNode[];
	routes: RouteData[];
	matchers: Record<string, string>;
}

export interface PageNode {
	depth: number;
	component?: string; // TODO supply default component if it's missing (bit of an edge case)
	universal?: string;
	server?: string;
	parent_id?: string;
	parent?: PageNode;
	/**
	 * Filled with the pages that reference this layout (if this is a layout)
	 */
	child_pages?: PageNode[];
}

export interface PrerenderDependency {
	response: Response;
	body: null | string | Uint8Array;
}

export interface PrerenderOptions {
	cache?: string; // including this here is a bit of a hack, but it makes it easy to add <meta http-equiv>
	fallback?: boolean;
	dependencies: Map<string, PrerenderDependency>;
}

export type RecursiveRequired<T> = {
	// Recursive implementation of TypeScript's Required utility type.
	// Will recursively continue until it reaches a primitive or Function
	[K in keyof T]-?: Extract<T[K], Function> extends never // If it does not have a Function type
		? RecursiveRequired<T[K]> // recursively continue through.
		: T[K]; // Use the exact type for everything else
};

export type RequiredResolveOptions = Required<ResolveOptions>;

export interface RouteParam {
	name: string;
	matcher: string;
	optional: boolean;
	rest: boolean;
	chained: boolean;
}

/**
 * Represents a route segment in the app. It can either be an intermediate node
 * with only layout/error pages, or a leaf, at which point either `page` and `leaf`
 * or `endpoint` is set.
 */
export interface RouteData {
	id: string;
	parent: RouteData | null;

	segment: string;
	pattern: RegExp;
	params: RouteParam[];

	layout: PageNode | null;
	error: PageNode | null;
	leaf: PageNode | null;

	page: {
		layouts: Array<number | undefined>;
		errors: Array<number | undefined>;
		leaf: number;
	} | null;

	endpoint: {
		file: string;
	} | null;
}

export type ServerRedirectNode = {
	type: 'redirect';
	location: string;
};

export type ServerNodesResponse = {
	type: 'data';
	/**
	 * If `null`, then there was no load function <- TODO is this outdated now with the recent changes?
	 */
	nodes: Array<ServerDataNode | ServerDataSkippedNode | ServerErrorNode | null>;
};

export type ServerDataResponse = ServerRedirectNode | ServerNodesResponse;

/**
 * Signals a successful response of the server `load` function.
 * The `uses` property tells the client when it's possible to reuse this data
 * in a subsequent request.
 */
export interface ServerDataNode {
	type: 'data';
	/**
	 * The serialized version of this contains a serialized representation of any deferred promises,
	 * which will be resolved later through chunk nodes.
	 */
	data: Record<string, any> | null;
	uses: Uses;
	slash?: TrailingSlash;
}

/**
 * Resolved data/error of a deferred promise.
 */
export interface ServerDataChunkNode {
	type: 'chunk';
	id: number;
	data?: Record<string, any>;
	error?: any;
}

/**
 * Signals that the server `load` function was not run, and the
 * client should use what it has in memory
 */
export interface ServerDataSkippedNode {
	type: 'skip';
}

/**
 * Signals that the server `load` function failed
 */
export interface ServerErrorNode {
	type: 'error';
	error: App.Error;
	/**
	 * Only set for HttpErrors
	 */
	status?: number;
}

export interface ServerMetadataRoute {
	config: any;
	api: {
		methods: Array<HttpMethod | '*'>;
	};
	page: {
		methods: Array<'GET' | 'POST'>;
	};
	methods: Array<HttpMethod | '*'>;
	prerender: PrerenderOption | undefined;
	entries: string[] | undefined;
}

export interface ServerMetadata {
	nodes: Array<{ has_server_load: boolean }>;
	routes: Map<string, ServerMetadataRoute>;
}

export interface SSRComponent {
	default: {
		render(props: Record<string, any>): {
			html: string;
			head: string;
			css: {
				code: string;
				map: any; // TODO
			};
		};
	};
}

export type SSRComponentLoader = () => Promise<SSRComponent>;

export interface SSRNode {
	component: SSRComponentLoader;
	/** index into the `components` array in client/manifest.js */
	index: number;
	/** external JS files */
	imports: string[];
	/** external CSS files */
	stylesheets: string[];
	/** external font files */
	fonts: string[];
	/** inlined styles */
	inline_styles?(): MaybePromise<Record<string, string>>;

	universal: {
		load?: Load;
		prerender?: PrerenderOption;
		ssr?: boolean;
		csr?: boolean;
		trailingSlash?: TrailingSlash;
		config?: any;
		entries?: PrerenderEntryGenerator;
	};

	server: {
		load?: ServerLoad;
		prerender?: PrerenderOption;
		ssr?: boolean;
		csr?: boolean;
		trailingSlash?: TrailingSlash;
		actions?: Actions;
		config?: any;
		entries?: PrerenderEntryGenerator;
	};

	universal_id: string;
	server_id: string;
}

export type SSRNodeLoader = () => Promise<SSRNode>;

export interface SSROptions {
	app_dir: string;
	app_template_contains_nonce: boolean;
	csp: ValidatedConfig['kit']['csp'];
	csrf_check_origin: boolean;
	embedded: boolean;
	env_public_prefix: string;
	env_private_prefix: string;
	hooks: ServerHooks;
	preload_strategy: ValidatedConfig['kit']['output']['preloadStrategy'];
	root: SSRComponent['default'];
	service_worker: boolean;
	templates: {
		app(values: {
			head: string;
			body: string;
			assets: string;
			nonce: string;
			env: Record<string, string>;
		}): string;
		error(values: { message: string; status: number }): string;
	};
	version_hash: string;
}

export interface PageNodeIndexes {
	errors: Array<number | undefined>;
	layouts: Array<number | undefined>;
	leaf: number;
}

export type PrerenderEntryGenerator = () => MaybePromise<Array<Record<string, string>>>;

export type SSREndpoint = Partial<Record<HttpMethod, RequestHandler>> & {
	prerender?: PrerenderOption;
	trailingSlash?: TrailingSlash;
	config?: any;
	entries?: PrerenderEntryGenerator;
	fallback?: RequestHandler;
};

export interface SSRRoute {
	id: string;
	pattern: RegExp;
	params: RouteParam[];
	page: PageNodeIndexes | null;
	endpoint: (() => Promise<SSREndpoint>) | null;
	endpoint_id?: string;
}

export interface SSRState {
	fallback?: string;
	getClientAddress(): string;
	/**
	 * True if we're currently attempting to render an error page
	 */
	error: boolean;
	/**
	 * Allows us to prevent `event.fetch` from making infinitely looping internal requests
	 */
	depth: number;
	platform?: any;
	prerendering?: PrerenderOptions;
	/**
	 * When fetching data from a +server.js endpoint in `load`, the page's
	 * prerender option is inherited by the endpoint, unless overridden
	 */
	prerender_default?: PrerenderOption;
	read?: (file: string) => Buffer;
	before_handle?: (event: RequestEvent, config: any, prerender: PrerenderOption) => void;
	emulator?: Emulator;
}

export type StrictBody = string | ArrayBufferView;

export interface Uses {
	dependencies: Set<string>;
	params: Set<string>;
	parent: boolean;
	route: boolean;
	url: boolean;
	search_params: Set<string>;
}

export type ValidatedConfig = Config & {
	kit: ValidatedKitConfig;
	extensions: string[];
};

export type ValidatedKitConfig = Omit<RecursiveRequired<KitConfig>, 'adapter'> & {
	adapter?: Adapter;
};

export * from '../exports/index.js';
export * from './private.js';

```


####### packages/kit/src/types/private.d.ts #######

```

// This module contains types that are visible in the documentation,
// but which cannot be imported from `@sveltejs/kit`. Care should
// be taken to avoid breaking changes when editing this file

import { RouteDefinition } from '@sveltejs/kit';

export interface AdapterEntry {
	/**
	 * A string that uniquely identifies an HTTP service (e.g. serverless function) and is used for deduplication.
	 * For example, `/foo/a-[b]` and `/foo/[c]` are different routes, but would both
	 * be represented in a Netlify _redirects file as `/foo/:param`, so they share an ID
	 */
	id: string;

	/**
	 * A function that compares the candidate route with the current route to determine
	 * if it should be grouped with the current route.
	 *
	 * Use cases:
	 * - Fallback pages: `/foo/[c]` is a fallback for `/foo/a-[b]`, and `/[...catchall]` is a fallback for all routes
	 * - Grouping routes that share a common `config`: `/foo` should be deployed to the edge, `/bar` and `/baz` should be deployed to a serverless function
	 */
	filter(route: RouteDefinition): boolean;

	/**
	 * A function that is invoked once the entry has been created. This is where you
	 * should write the function to the filesystem and generate redirect manifests.
	 */
	complete(entry: { generateManifest(opts: { relativePath: string }): string }): MaybePromise<void>;
}

// Based on https://github.com/josh-hemphill/csp-typed-directives/blob/latest/src/csp.types.ts
//
// MIT License
//
// Copyright (c) 2021-present, Joshua Hemphill
// Copyright (c) 2021, Tecnico Corporation
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.

export namespace Csp {
	type ActionSource = 'strict-dynamic' | 'report-sample';
	type BaseSource =
		| 'self'
		| 'unsafe-eval'
		| 'unsafe-hashes'
		| 'unsafe-inline'
		| 'wasm-unsafe-eval'
		| 'none';
	type CryptoSource = `${'nonce' | 'sha256' | 'sha384' | 'sha512'}-${string}`;
	type FrameSource = HostSource | SchemeSource | 'self' | 'none';
	type HostNameScheme = `${string}.${string}` | 'localhost';
	type HostSource = `${HostProtocolSchemes}${HostNameScheme}${PortScheme}`;
	type HostProtocolSchemes = `${string}://` | '';
	type HttpDelineator = '/' | '?' | '#' | '\\';
	type PortScheme = `:${number}` | '' | ':*';
	type SchemeSource = 'http:' | 'https:' | 'data:' | 'mediastream:' | 'blob:' | 'filesystem:';
	type Source = HostSource | SchemeSource | CryptoSource | BaseSource;
	type Sources = Source[];
}

export interface CspDirectives {
	'child-src'?: Csp.Sources;
	'default-src'?: Array<Csp.Source | Csp.ActionSource>;
	'frame-src'?: Csp.Sources;
	'worker-src'?: Csp.Sources;
	'connect-src'?: Csp.Sources;
	'font-src'?: Csp.Sources;
	'img-src'?: Csp.Sources;
	'manifest-src'?: Csp.Sources;
	'media-src'?: Csp.Sources;
	'object-src'?: Csp.Sources;
	'prefetch-src'?: Csp.Sources;
	'script-src'?: Array<Csp.Source | Csp.ActionSource>;
	'script-src-elem'?: Csp.Sources;
	'script-src-attr'?: Csp.Sources;
	'style-src'?: Array<Csp.Source | Csp.ActionSource>;
	'style-src-elem'?: Csp.Sources;
	'style-src-attr'?: Csp.Sources;
	'base-uri'?: Array<Csp.Source | Csp.ActionSource>;
	sandbox?: Array<
		| 'allow-downloads-without-user-activation'
		| 'allow-forms'
		| 'allow-modals'
		| 'allow-orientation-lock'
		| 'allow-pointer-lock'
		| 'allow-popups'
		| 'allow-popups-to-escape-sandbox'
		| 'allow-presentation'
		| 'allow-same-origin'
		| 'allow-scripts'
		| 'allow-storage-access-by-user-activation'
		| 'allow-top-navigation'
		| 'allow-top-navigation-by-user-activation'
	>;
	'form-action'?: Array<Csp.Source | Csp.ActionSource>;
	'frame-ancestors'?: Array<Csp.HostSource | Csp.SchemeSource | Csp.FrameSource>;
	'navigate-to'?: Array<Csp.Source | Csp.ActionSource>;
	'report-uri'?: string[];
	'report-to'?: string[];

	'require-trusted-types-for'?: Array<'script'>;
	'trusted-types'?: Array<'none' | 'allow-duplicates' | '*' | string>;
	'upgrade-insecure-requests'?: boolean;

	/** @deprecated */
	'require-sri-for'?: Array<'script' | 'style' | 'script style'>;

	/** @deprecated */
	'block-all-mixed-content'?: boolean;

	/** @deprecated */
	'plugin-types'?: Array<`${string}/${string}` | 'none'>;

	/** @deprecated */
	referrer?: Array<
		| 'no-referrer'
		| 'no-referrer-when-downgrade'
		| 'origin'
		| 'origin-when-cross-origin'
		| 'same-origin'
		| 'strict-origin'
		| 'strict-origin-when-cross-origin'
		| 'unsafe-url'
		| 'none'
	>;
}

export type HttpMethod = 'GET' | 'HEAD' | 'POST' | 'PUT' | 'DELETE' | 'PATCH' | 'OPTIONS';

export interface Logger {
	(msg: string): void;
	success(msg: string): void;
	error(msg: string): void;
	warn(msg: string): void;
	minor(msg: string): void;
	info(msg: string): void;
}

export type MaybePromise<T> = T | Promise<T>;

export interface Prerendered {
	/**
	 * A map of `path` to `{ file }` objects, where a path like `/foo` corresponds to `foo.html` and a path like `/bar/` corresponds to `bar/index.html`.
	 */
	pages: Map<
		string,
		{
			/** The location of the .html file relative to the output directory */
			file: string;
		}
	>;
	/**
	 * A map of `path` to `{ type }` objects.
	 */
	assets: Map<
		string,
		{
			/** The MIME type of the asset */
			type: string;
		}
	>;
	/**
	 * A map of redirects encountered during prerendering.
	 */
	redirects: Map<
		string,
		{
			status: number;
			location: string;
		}
	>;
	/** An array of prerendered paths (without trailing slashes, regardless of the trailingSlash config) */
	paths: string[];
}

export interface PrerenderHttpErrorHandler {
	(details: {
		status: number;
		path: string;
		referrer: string | null;
		referenceType: 'linked' | 'fetched';
		message: string;
	}): void;
}

export interface PrerenderMissingIdHandler {
	(details: { path: string; id: string; referrers: string[]; message: string }): void;
}

export interface PrerenderEntryGeneratorMismatchHandler {
	(details: { generatedFromId: string; entry: string; matchedId: string; message: string }): void;
}

export type PrerenderHttpErrorHandlerValue = 'fail' | 'warn' | 'ignore' | PrerenderHttpErrorHandler;
export type PrerenderMissingIdHandlerValue = 'fail' | 'warn' | 'ignore' | PrerenderMissingIdHandler;
export type PrerenderEntryGeneratorMismatchHandlerValue =
	| 'fail'
	| 'warn'
	| 'ignore'
	| PrerenderEntryGeneratorMismatchHandler;

export type PrerenderOption = boolean | 'auto';

export type PrerenderMap = Map<string, PrerenderOption>;

export interface RequestOptions {
	getClientAddress(): string;
	platform?: App.Platform;
}

export interface RouteSegment {
	content: string;
	dynamic: boolean;
	rest: boolean;
}

export type TrailingSlash = 'never' | 'always' | 'ignore';

```


####### packages/kit/src/types/synthetic/$env+dynamic+private.md #######

This module provides access to runtime environment variables, as defined by the platform you're running on. For example if you're using [`adapter-node`](https://github.com/sveltejs/kit/tree/main/packages/adapter-node) (or running [`vite preview`](https://kit.svelte.dev/docs/cli)), this is equivalent to `process.env`. This module only includes variables that _do not_ begin with [`config.kit.env.publicPrefix`](https://kit.svelte.dev/docs/configuration#env) _and do_ start with [`config.kit.env.privatePrefix`](https://kit.svelte.dev/docs/configuration#env) (if configured).

This module cannot be imported into client-side code.

Dynamic environment variables cannot be used during prerendering.

```ts
import { env } from '$env/dynamic/private';
console.log(env.DEPLOYMENT_SPECIFIC_VARIABLE);
```

> In `dev`, `$env/dynamic` always includes environment variables from `.env`. In `prod`, this behavior will depend on your adapter.

####### packages/kit/src/types/synthetic/$env+dynamic+public.md #######

Similar to [`$env/dynamic/private`](https://kit.svelte.dev/docs/modules#$env-dynamic-private), but only includes variables that begin with [`config.kit.env.publicPrefix`](https://kit.svelte.dev/docs/configuration#env) (which defaults to `PUBLIC_`), and can therefore safely be exposed to client-side code.

Note that public dynamic environment variables must all be sent from the server to the client, causing larger network requests — when possible, use `$env/static/public` instead.

Dynamic environment variables cannot be used during prerendering.

```ts
import { env } from '$env/dynamic/public';
console.log(env.PUBLIC_DEPLOYMENT_SPECIFIC_VARIABLE);
```

####### packages/kit/src/types/synthetic/$env+static+private.md #######

Environment variables [loaded by Vite](https://vitejs.dev/guide/env-and-mode.html#env-files) from `.env` files and `process.env`. Like [`$env/dynamic/private`](https://kit.svelte.dev/docs/modules#$env-dynamic-private), this module cannot be imported into client-side code. This module only includes variables that _do not_ begin with [`config.kit.env.publicPrefix`](https://kit.svelte.dev/docs/configuration#env) _and do_ start with [`config.kit.env.privatePrefix`](https://kit.svelte.dev/docs/configuration#env) (if configured).

_Unlike_ [`$env/dynamic/private`](https://kit.svelte.dev/docs/modules#$env-dynamic-private), the values exported from this module are statically injected into your bundle at build time, enabling optimisations like dead code elimination.

```ts
import { API_KEY } from '$env/static/private';
```

Note that all environment variables referenced in your code should be declared (for example in an `.env` file), even if they don't have a value until the app is deployed:

```
MY_FEATURE_FLAG=""
```

You can override `.env` values from the command line like so:

```bash
MY_FEATURE_FLAG="enabled" npm run dev
```

####### packages/kit/src/types/synthetic/$env+static+public.md #######

Similar to [`$env/static/private`](https://kit.svelte.dev/docs/modules#$env-static-private), except that it only includes environment variables that begin with [`config.kit.env.publicPrefix`](https://kit.svelte.dev/docs/configuration#env) (which defaults to `PUBLIC_`), and can therefore safely be exposed to client-side code.

Values are replaced statically at build time.

```ts
import { PUBLIC_BASE_URL } from '$env/static/public';
```

####### packages/kit/src/types/synthetic/$lib.md #######

This is a simple alias to `src/lib`, or whatever directory is specified as [`config.kit.files.lib`](https://kit.svelte.dev/docs/configuration#files). It allows you to access common components and utility modules without `../../../../` nonsense.

### `$lib/server`

A subdirectory of `$lib`. SvelteKit will prevent you from importing any modules in `$lib/server` into client-side code. See [server-only modules](/docs/server-only-modules).

####### packages/kit/src/utils/array.js #######

```

/**
 * Removes nullish values from an array.
 *
 * @template T
 * @param {Array<T>} arr
 */
export function compact(arr) {
	return arr.filter(/** @returns {val is NonNullable<T>} */ (val) => val != null);
}

```


####### packages/kit/src/utils/env.js #######

```

/**
 * @param {Record<string, string>} env
 * @param {{
 * 		public_prefix: string;
 * 		private_prefix: string;
 * }} prefixes
 * @returns {Record<string, string>}
 */
export function filter_private_env(env, { public_prefix, private_prefix }) {
	return Object.fromEntries(
		Object.entries(env).filter(
			([k]) =>
				k.startsWith(private_prefix) && (public_prefix === '' || !k.startsWith(public_prefix))
		)
	);
}

/**
 * @param {Record<string, string>} env
 * @param {{
 * 		public_prefix: string;
 *    private_prefix: string;
 * }} prefixes
 * @returns {Record<string, string>}
 */
export function filter_public_env(env, { public_prefix, private_prefix }) {
	return Object.fromEntries(
		Object.entries(env).filter(
			([k]) =>
				k.startsWith(public_prefix) && (private_prefix === '' || !k.startsWith(private_prefix))
		)
	);
}

```


####### packages/kit/src/utils/error.js #######

```

import { HttpError, SvelteKitError } from '../runtime/control.js';

/**
 * @param {unknown} err
 * @return {Error}
 */
export function coalesce_to_error(err) {
	return err instanceof Error ||
		(err && /** @type {any} */ (err).name && /** @type {any} */ (err).message)
		? /** @type {Error} */ (err)
		: new Error(JSON.stringify(err));
}

/**
 * This is an identity function that exists to make TypeScript less
 * paranoid about people throwing things that aren't errors, which
 * frankly is not something we should care about
 * @param {unknown} error
 */
export function normalize_error(error) {
	return /** @type {import('../runtime/control.js').Redirect | HttpError | SvelteKitError | Error} */ (
		error
	);
}

/**
 * @param {unknown} error
 */
export function get_status(error) {
	return error instanceof HttpError || error instanceof SvelteKitError ? error.status : 500;
}

/**
 * @param {unknown} error
 */
export function get_message(error) {
	return error instanceof SvelteKitError ? error.text : 'Internal Error';
}

```


####### packages/kit/src/utils/escape.js #######

```

/**
 * When inside a double-quoted attribute value, only `&` and `"` hold special meaning.
 * @see https://html.spec.whatwg.org/multipage/parsing.html#attribute-value-(double-quoted)-state
 * @type {Record<string, string>}
 */
const escape_html_attr_dict = {
	'&': '&amp;',
	'"': '&quot;'
};

const escape_html_attr_regex = new RegExp(
	// special characters
	`[${Object.keys(escape_html_attr_dict).join('')}]|` +
		// high surrogate without paired low surrogate
		'[\\ud800-\\udbff](?![\\udc00-\\udfff])|' +
		// a valid surrogate pair, the only match with 2 code units
		// we match it so that we can match unpaired low surrogates in the same pass
		// TODO: use lookbehind assertions once they are widely supported: (?<![\ud800-udbff])[\udc00-\udfff]
		'[\\ud800-\\udbff][\\udc00-\\udfff]|' +
		// unpaired low surrogate (see previous match)
		'[\\udc00-\\udfff]',
	'g'
);

/**
 * Formats a string to be used as an attribute's value in raw HTML.
 *
 * It escapes unpaired surrogates (which are allowed in js strings but invalid in HTML), escapes
 * characters that are special in attributes, and surrounds the whole string in double-quotes.
 *
 * @param {string} str
 * @returns {string} Escaped string surrounded by double-quotes.
 * @example const html = `<tag data-value=${escape_html_attr('value')}>...</tag>`;
 */
export function escape_html_attr(str) {
	const escaped_str = str.replace(escape_html_attr_regex, (match) => {
		if (match.length === 2) {
			// valid surrogate pair
			return match;
		}

		return escape_html_attr_dict[match] ?? `&#${match.charCodeAt(0)};`;
	});

	return `"${escaped_str}"`;
}

```


####### packages/kit/src/utils/escape.spec.js #######

```

import { assert, test } from 'vitest';
import { escape_html_attr } from './escape.js';

test('escape_html_attr escapes special attribute characters', () => {
	assert.equal(
		escape_html_attr('some "values" are &special here, <others> aren\'t.'),
		'"some &quot;values&quot; are &amp;special here, <others> aren\'t."'
	);
});

test('escape_html_attr escapes invalid surrogates', () => {
	assert.equal(escape_html_attr('\ud800\udc00'), '"\ud800\udc00"');
	assert.equal(escape_html_attr('\ud800'), '"&#55296;"');
	assert.equal(escape_html_attr('\udc00'), '"&#56320;"');
	assert.equal(escape_html_attr('\udc00\ud800'), '"&#56320;&#55296;"');
	assert.equal(escape_html_attr('\ud800\ud800\udc00'), '"&#55296;\ud800\udc00"');
	assert.equal(escape_html_attr('\ud800\udc00\udc00'), '"\ud800\udc00&#56320;"');
	assert.equal(escape_html_attr('\ud800\ud800\udc00\udc00'), '"&#55296;\ud800\udc00&#56320;"');
});

```


####### packages/kit/src/utils/exports.js #######

```

/**
 * @param {Set<string>} expected
 */
function validator(expected) {
	/**
	 * @param {any} module
	 * @param {string} [file]
	 */
	function validate(module, file) {
		if (!module) return;

		for (const key in module) {
			if (key[0] === '_' || expected.has(key)) continue; // key is valid in this module

			const values = [...expected.values()];

			const hint =
				hint_for_supported_files(key, file?.slice(file.lastIndexOf('.'))) ??
				`valid exports are ${values.join(', ')}, or anything with a '_' prefix`;

			throw new Error(`Invalid export '${key}'${file ? ` in ${file}` : ''} (${hint})`);
		}
	}

	return validate;
}

/**
 * @param {string} key
 * @param {string} ext
 * @returns {string | void}
 */
function hint_for_supported_files(key, ext = '.js') {
	const supported_files = [];

	if (valid_layout_exports.has(key)) {
		supported_files.push(`+layout${ext}`);
	}

	if (valid_page_exports.has(key)) {
		supported_files.push(`+page${ext}`);
	}

	if (valid_layout_server_exports.has(key)) {
		supported_files.push(`+layout.server${ext}`);
	}

	if (valid_page_server_exports.has(key)) {
		supported_files.push(`+page.server${ext}`);
	}

	if (valid_server_exports.has(key)) {
		supported_files.push(`+server${ext}`);
	}

	if (supported_files.length > 0) {
		return `'${key}' is a valid export in ${supported_files.slice(0, -1).join(', ')}${
			supported_files.length > 1 ? ' or ' : ''
		}${supported_files.at(-1)}`;
	}
}

const valid_layout_exports = new Set([
	'load',
	'prerender',
	'csr',
	'ssr',
	'trailingSlash',
	'config'
]);
const valid_page_exports = new Set([...valid_layout_exports, 'entries']);
const valid_layout_server_exports = new Set([...valid_layout_exports]);
const valid_page_server_exports = new Set([...valid_layout_server_exports, 'actions', 'entries']);
const valid_server_exports = new Set([
	'GET',
	'POST',
	'PATCH',
	'PUT',
	'DELETE',
	'OPTIONS',
	'HEAD',
	'fallback',
	'prerender',
	'trailingSlash',
	'config',
	'entries'
]);

export const validate_layout_exports = validator(valid_layout_exports);
export const validate_page_exports = validator(valid_page_exports);
export const validate_layout_server_exports = validator(valid_layout_server_exports);
export const validate_page_server_exports = validator(valid_page_server_exports);
export const validate_server_exports = validator(valid_server_exports);

```


####### packages/kit/src/utils/exports.spec.js #######

```

import { assert, test } from 'vitest';
import {
	validate_layout_exports,
	validate_layout_server_exports,
	validate_page_exports,
	validate_page_server_exports,
	validate_server_exports
} from './exports.js';

/**
 * @param {() => void} fn
 * @param {string} message
 */
function check_error(fn, message) {
	let error;

	try {
		fn();
	} catch (e) {
		error = /** @type {Error} */ (e);
	}

	assert.equal(error?.message, message);
}

test('validates +layout.js', () => {
	validate_layout_exports({
		load: () => {},
		prerender: false,
		csr: false,
		ssr: false,
		trailingSlash: false,
		config: {}
	});

	validate_layout_exports({
		_unknown: () => {}
	});

	check_error(() => {
		validate_layout_exports({
			answer: 42
		});
	}, "Invalid export 'answer' (valid exports are load, prerender, csr, ssr, trailingSlash, config, or anything with a '_' prefix)");

	check_error(() => {
		validate_layout_exports(
			{
				actions: {}
			},
			'src/routes/foo/+page.ts'
		);
	}, "Invalid export 'actions' in src/routes/foo/+page.ts ('actions' is a valid export in +page.server.ts)");

	check_error(() => {
		validate_layout_exports({
			GET: {}
		});
	}, "Invalid export 'GET' ('GET' is a valid export in +server.js)");
});

test('validates +page.js', () => {
	validate_page_exports({
		load: () => {},
		prerender: false,
		csr: false,
		ssr: false,
		trailingSlash: false,
		config: {},
		entries: () => {}
	});

	validate_page_exports({
		_unknown: () => {}
	});

	check_error(() => {
		validate_page_exports({
			answer: 42
		});
	}, "Invalid export 'answer' (valid exports are load, prerender, csr, ssr, trailingSlash, config, entries, or anything with a '_' prefix)");

	check_error(() => {
		validate_page_exports(
			{
				actions: {}
			},
			'src/routes/foo/+page.ts'
		);
	}, "Invalid export 'actions' in src/routes/foo/+page.ts ('actions' is a valid export in +page.server.ts)");

	check_error(() => {
		validate_page_exports({
			GET: {}
		});
	}, "Invalid export 'GET' ('GET' is a valid export in +server.js)");
});

test('validates +layout.server.js', () => {
	validate_layout_server_exports({
		load: () => {},
		prerender: false,
		csr: false,
		ssr: false,
		trailingSlash: false,
		config: {}
	});

	validate_layout_server_exports({
		_unknown: () => {}
	});

	check_error(() => {
		validate_layout_server_exports({
			answer: 42
		});
	}, "Invalid export 'answer' (valid exports are load, prerender, csr, ssr, trailingSlash, config, or anything with a '_' prefix)");

	check_error(() => {
		validate_layout_exports(
			{
				actions: {}
			},
			'src/routes/foo/+page.ts'
		);
	}, "Invalid export 'actions' in src/routes/foo/+page.ts ('actions' is a valid export in +page.server.ts)");

	check_error(() => {
		validate_layout_server_exports({
			POST: {}
		});
	}, "Invalid export 'POST' ('POST' is a valid export in +server.js)");
});

test('validates +page.server.js', () => {
	validate_page_server_exports({
		load: () => {},
		prerender: false,
		csr: false,
		ssr: false,
		trailingSlash: false,
		config: {},
		actions: {},
		entries: () => {}
	});

	validate_page_server_exports({
		_unknown: () => {}
	});

	check_error(() => {
		validate_page_server_exports({
			answer: 42
		});
	}, "Invalid export 'answer' (valid exports are load, prerender, csr, ssr, trailingSlash, config, actions, entries, or anything with a '_' prefix)");

	check_error(() => {
		validate_page_server_exports({
			POST: {}
		});
	}, "Invalid export 'POST' ('POST' is a valid export in +server.js)");
});

test('validates +server.js', () => {
	validate_server_exports({
		GET: () => {}
	});

	validate_server_exports({
		_unknown: () => {}
	});

	check_error(() => {
		validate_server_exports({
			answer: 42
		});
	}, "Invalid export 'answer' (valid exports are GET, POST, PATCH, PUT, DELETE, OPTIONS, HEAD, fallback, prerender, trailingSlash, config, entries, or anything with a '_' prefix)");

	check_error(() => {
		validate_server_exports({
			csr: false
		});
	}, "Invalid export 'csr' ('csr' is a valid export in +layout.js, +page.js, +layout.server.js or +page.server.js)");
});

```


####### packages/kit/src/utils/features.js #######

```

/**
 * @param {string} route_id
 * @param {any} config
 * @param {string} feature
 * @param {import('@sveltejs/kit').Adapter | undefined} adapter
 */
export function check_feature(route_id, config, feature, adapter) {
	if (!adapter) return;

	switch (feature) {
		case '$app/server:read': {
			const supported = adapter.supports?.read?.({
				route: { id: route_id },
				config
			});

			if (!supported) {
				throw new Error(
					`Cannot use \`read\` from \`$app/server\` in ${route_id} when using ${adapter.name}. Please ensure that your adapter is up to date and supports this feature.`
				);
			}
		}
	}
}

```


####### packages/kit/src/utils/filesystem.js #######

```

import fs from 'node:fs';
import path from 'node:path';

/** @param {string} dir */
export function mkdirp(dir) {
	try {
		fs.mkdirSync(dir, { recursive: true });
	} catch (/** @type {any} */ e) {
		if (e.code === 'EEXIST') {
			if (!fs.statSync(dir).isDirectory()) {
				throw new Error(`Cannot create directory ${dir}, a file already exists at this position`);
			}
			return;
		}
		throw e;
	}
}

/** @param {string} path */
export function rimraf(path) {
	fs.rmSync(path, { force: true, recursive: true });
}

/**
 * @param {string} source
 * @param {string} target
 * @param {{
 *   filter?: (basename: string) => boolean;
 *   replace?: Record<string, string>;
 * }} opts
 */
export function copy(source, target, opts = {}) {
	if (!fs.existsSync(source)) return [];

	/** @type {string[]} */
	const files = [];

	const prefix = posixify(target) + '/';

	const regex = opts.replace
		? new RegExp(`\\b(${Object.keys(opts.replace).join('|')})\\b`, 'g')
		: null;

	/**
	 * @param {string} from
	 * @param {string} to
	 */
	function go(from, to) {
		if (opts.filter && !opts.filter(path.basename(from))) return;

		const stats = fs.statSync(from);

		if (stats.isDirectory()) {
			fs.readdirSync(from).forEach((file) => {
				go(path.join(from, file), path.join(to, file));
			});
		} else {
			mkdirp(path.dirname(to));

			if (opts.replace) {
				const data = fs.readFileSync(from, 'utf-8');
				fs.writeFileSync(
					to,
					data.replace(
						/** @type {RegExp} */ (regex),
						(_match, key) => /** @type {Record<string, string>} */ (opts.replace)[key]
					)
				);
			} else {
				fs.copyFileSync(from, to);
			}

			files.push(to === target ? posixify(path.basename(to)) : posixify(to).replace(prefix, ''));
		}
	}

	go(source, target);

	return files;
}

/**
 * Get a list of all files in a directory
 * @param {string} cwd - the directory to walk
 * @param {boolean} [dirs] - whether to include directories in the result
 * @returns {string[]} a list of all found files (and possibly directories) relative to `cwd`
 */
export function walk(cwd, dirs = false) {
	/** @type {string[]} */
	const all_files = [];

	/** @param {string} dir */
	function walk_dir(dir) {
		const files = fs.readdirSync(path.join(cwd, dir));

		for (const file of files) {
			const joined = path.join(dir, file);
			const stats = fs.statSync(path.join(cwd, joined));
			if (stats.isDirectory()) {
				if (dirs) all_files.push(joined);
				walk_dir(joined);
			} else {
				all_files.push(joined);
			}
		}
	}

	return walk_dir(''), all_files;
}

/** @param {string} str */
export function posixify(str) {
	return str.replace(/\\/g, '/');
}

/**
 * Like `path.join`, but posixified and with a leading `./` if necessary
 * @param {string[]} str
 */
export function join_relative(...str) {
	let result = posixify(path.join(...str));
	if (!result.startsWith('.')) {
		result = `./${result}`;
	}
	return result;
}

/**
 * Like `path.relative`, but always posixified and with a leading `./` if necessary.
 * Useful for JS imports so the path can safely reside inside of `node_modules`.
 * Otherwise paths could be falsely interpreted as package paths.
 * @param {string} from
 * @param {string} to
 */
export function relative_path(from, to) {
	return join_relative(path.relative(from, to));
}

/**
 * Prepend given path with `/@fs` prefix
 * @param {string} str
 */
export function to_fs(str) {
	str = posixify(str);
	return `/@fs${
		// Windows/Linux separation - Windows starts with a drive letter, we need a / in front there
		str.startsWith('/') ? '' : '/'
	}${str}`;
}

/**
 * Removes `/@fs` prefix from given path and posixifies it
 * @param {string} str
 */
export function from_fs(str) {
	str = posixify(str);
	if (!str.startsWith('/@fs')) return str;

	str = str.slice(4);
	// Windows/Linux separation - Windows starts with a drive letter, we need to strip the additional / here
	return str[2] === ':' && /[A-Z]/.test(str[1]) ? str.slice(1) : str;
}

/**
 * Given an entry point like [cwd]/src/hooks, returns a filename like [cwd]/src/hooks.js or [cwd]/src/hooks/index.js
 * @param {string} entry
 * @returns {string|null}
 */
export function resolve_entry(entry) {
	if (fs.existsSync(entry)) {
		const stats = fs.statSync(entry);
		if (stats.isDirectory()) {
			return resolve_entry(path.join(entry, 'index'));
		}

		return entry;
	} else {
		const dir = path.dirname(entry);

		if (fs.existsSync(dir)) {
			const base = path.basename(entry);
			const files = fs.readdirSync(dir);

			const found = files.find((file) => file.replace(/\.[^.]+$/, '') === base);

			if (found) return path.join(dir, found);
		}
	}

	return null;
}

/** @param {string} file */
export function read(file) {
	return fs.readFileSync(file, 'utf-8');
}

```


####### packages/kit/src/utils/filesystem.spec.js #######

```

import { mkdtempSync, writeFileSync, readdirSync, mkdirSync, readFileSync } from 'node:fs';
import { tmpdir } from 'node:os';
import { dirname, join } from 'node:path';
import { assert, expect, beforeEach, test } from 'vitest';
import { copy, mkdirp } from './filesystem.js';

/** @type {string} */
let source_dir;
/** @type {string} */
let dest_dir;

beforeEach(() => {
	const temp_dir = mkdtempSync(join(tmpdir(), 'kit-core-filesystem-'));
	source_dir = join(temp_dir, 'source');
	dest_dir = join(temp_dir, 'dest');
	mkdirSync(source_dir);
	mkdirSync(dest_dir);
});

/**
 * @param {string} file
 * @param {string} contents
 */
const write = (file, contents) => {
	const filepath = join(source_dir, file);
	mkdirp(dirname(filepath));
	writeFileSync(filepath, contents);
};

test('without filter', () => {
	write('file-one.js', '');
	write('file-two.css', '');
	write('file-three', '');

	copy(source_dir, dest_dir);

	const copied = readdirSync(dest_dir);

	expect(copied.sort()).toEqual(['file-one.js', 'file-two.css', 'file-three'].sort());
});

test('filters out subdirectory contents', () => {
	write('file-one.js', '');
	write('file-two.css', '');
	write('no-copy/do-not-copy.js', '');

	copy(source_dir, dest_dir, {
		filter: (f) => f !== 'no-copy'
	});

	const copied = readdirSync(dest_dir);

	expect(copied.sort()).toEqual(['file-one.js', 'file-two.css'].sort());
});

test('copies recursively', () => {
	write('file-one.js', '');
	write('file-two.css', '');
	write('deep/a.js', '');
	write('deep/b.js', '');

	copy(source_dir, dest_dir);

	const root = readdirSync(dest_dir);

	expect(root.sort()).toEqual(['file-one.js', 'file-two.css', 'deep'].sort());

	const subdir = readdirSync(join(dest_dir, 'deep'));

	expect(subdir.sort()).toEqual(['a.js', 'b.js'].sort());
});

test('returns a list of copied files', () => {
	write('file-one.js', '');
	write('file-two.css', '');
	write('deep/a.js', '');
	write('deep/b.js', '');

	let file_list = copy(source_dir, dest_dir);
	expect(file_list.sort()).toEqual(
		['file-one.js', 'file-two.css', 'deep/a.js', 'deep/b.js'].sort()
	);

	file_list = copy(`${source_dir}/file-one.js`, `${dest_dir}/file-one-renamed.js`);
	expect(file_list).toEqual(['file-one-renamed.js']);
});

test('replaces strings', () => {
	write('foo.md', 'the quick brown JUMPER jumps over the lazy JUMPEE');
	copy(source_dir, dest_dir, {
		replace: {
			JUMPER: 'fox',
			JUMPEE: 'dog'
		}
	});

	assert.equal(
		readFileSync(join(dest_dir, 'foo.md'), 'utf8'),
		'the quick brown fox jumps over the lazy dog'
	);
});

```


####### packages/kit/src/utils/fork.js #######

```

import { fileURLToPath } from 'node:url';
import { Worker, parentPort } from 'node:worker_threads';

/**
 * Runs a task in a subprocess so any dangling stuff gets killed upon completion.
 * The subprocess needs to be the file `forked` is called in, and `forked` needs to be called eagerly at the top level.
 * @template T
 * @template U
 * @param {string} module `import.meta.url` of the file
 * @param {(opts: T) => U} callback The function that is invoked in the subprocess
 * @returns {(opts: T) => Promise<U>} A function that when called starts the subprocess
 */
export function forked(module, callback) {
	if (process.env.SVELTEKIT_FORK && parentPort) {
		parentPort.on(
			'message',
			/** @param {any} data */ async (data) => {
				if (data?.type === 'args' && data.module === module) {
					parentPort?.postMessage({
						type: 'result',
						module,
						payload: await callback(data.payload)
					});
				}
			}
		);

		parentPort.postMessage({ type: 'ready', module });
	}

	/**
	 * @param {T} opts
	 * @returns {Promise<U>}
	 */
	return function (opts) {
		return new Promise((fulfil, reject) => {
			const worker = new Worker(fileURLToPath(module), {
				env: {
					...process.env,
					SVELTEKIT_FORK: 'true'
				}
			});

			worker.on(
				'message',
				/** @param {any} data */ (data) => {
					if (data?.type === 'ready' && data.module === module) {
						worker.postMessage({
							type: 'args',
							module,
							payload: opts
						});
					}

					if (data?.type === 'result' && data.module === module) {
						worker.unref();
						fulfil(data.payload);
					}
				}
			);

			worker.on('exit', (code) => {
				if (code) {
					reject(new Error(`Failed with code ${code}`));
				}
			});
		});
	};
}

```


####### packages/kit/src/utils/functions.js #######

```

/**
 * @template T
 * @param {() => T} fn
 */
export function once(fn) {
	let done = false;

	/** @type T */
	let result;

	return () => {
		if (done) return result;
		done = true;
		return (result = fn());
	};
}

```


####### packages/kit/src/utils/http.js #######

```

/**
 * Given an Accept header and a list of possible content types, pick
 * the most suitable one to respond with
 * @param {string} accept
 * @param {string[]} types
 */
export function negotiate(accept, types) {
	/** @type {Array<{ type: string, subtype: string, q: number, i: number }>} */
	const parts = [];

	accept.split(',').forEach((str, i) => {
		const match = /([^/]+)\/([^;]+)(?:;q=([0-9.]+))?/.exec(str);

		// no match equals invalid header — ignore
		if (match) {
			const [, type, subtype, q = '1'] = match;
			parts.push({ type, subtype, q: +q, i });
		}
	});

	parts.sort((a, b) => {
		if (a.q !== b.q) {
			return b.q - a.q;
		}

		if ((a.subtype === '*') !== (b.subtype === '*')) {
			return a.subtype === '*' ? 1 : -1;
		}

		if ((a.type === '*') !== (b.type === '*')) {
			return a.type === '*' ? 1 : -1;
		}

		return a.i - b.i;
	});

	let accepted;
	let min_priority = Infinity;

	for (const mimetype of types) {
		const [type, subtype] = mimetype.split('/');
		const priority = parts.findIndex(
			(part) =>
				(part.type === type || part.type === '*') &&
				(part.subtype === subtype || part.subtype === '*')
		);

		if (priority !== -1 && priority < min_priority) {
			accepted = mimetype;
			min_priority = priority;
		}
	}

	return accepted;
}

/**
 * Returns `true` if the request contains a `content-type` header with the given type
 * @param {Request} request
 * @param  {...string} types
 */
function is_content_type(request, ...types) {
	const type = request.headers.get('content-type')?.split(';', 1)[0].trim() ?? '';
	return types.includes(type.toLowerCase());
}

/**
 * @param {Request} request
 */
export function is_form_content_type(request) {
	// These content types must be protected against CSRF
	// https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/enctype
	return is_content_type(
		request,
		'application/x-www-form-urlencoded',
		'multipart/form-data',
		'text/plain'
	);
}

```


####### packages/kit/src/utils/http.spec.js #######

```

import { assert, test } from 'vitest';
import { negotiate } from './http.js';

test('handle valid accept header value', () => {
	const accept = 'text/html';
	assert.equal(negotiate(accept, ['text/html']), 'text/html');
});

test('handle invalid accept header value', () => {
	const accept = 'text/html,*';
	assert.equal(negotiate(accept, ['text/html']), 'text/html');
});

```


####### packages/kit/src/utils/misc.js #######

```

export const s = JSON.stringify;

```


####### packages/kit/src/utils/options.js #######

```

/**
 * @template {'prerender' | 'ssr' | 'csr' | 'trailingSlash' | 'entries'} Option
 * @template {(import('types').SSRNode['universal'] | import('types').SSRNode['server'])[Option]} Value
 *
 * @param {Array<import('types').SSRNode | undefined>} nodes
 * @param {Option} option
 *
 * @returns {Value | undefined}
 */
export function get_option(nodes, option) {
	return nodes.reduce((value, node) => {
		return /** @type {Value} TypeScript's too dumb to understand this */ (
			node?.universal?.[option] ?? node?.server?.[option] ?? value
		);
	}, /** @type {Value | undefined} */ (undefined));
}

```


####### packages/kit/src/utils/route_config.js #######

```

/**
 * Do a shallow merge (first level) of the config object
 * @param {Array<import('types').SSRNode | undefined>} nodes
 */
export function get_page_config(nodes) {
	/** @type {any} */
	let current = {};

	for (const node of nodes) {
		if (!node?.universal?.config && !node?.server?.config) continue;

		current = {
			...current,
			...node?.universal?.config,
			...node?.server?.config
		};
	}

	// TODO 3.0 always return `current`? then we can get rid of `?? {}` in other places
	return Object.keys(current).length ? current : undefined;
}

```


####### packages/kit/src/utils/routing.js #######

```

import { BROWSER } from 'esm-env';

const param_pattern = /^(\[)?(\.\.\.)?(\w+)(?:=(\w+))?(\])?$/;

/**
 * Creates the regex pattern, extracts parameter names, and generates types for a route
 * @param {string} id
 */
export function parse_route_id(id) {
	/** @type {import('types').RouteParam[]} */
	const params = [];

	const pattern =
		id === '/'
			? /^\/$/
			: new RegExp(
					`^${get_route_segments(id)
						.map((segment) => {
							// special case — /[...rest]/ could contain zero segments
							const rest_match = /^\[\.\.\.(\w+)(?:=(\w+))?\]$/.exec(segment);
							if (rest_match) {
								params.push({
									name: rest_match[1],
									matcher: rest_match[2],
									optional: false,
									rest: true,
									chained: true
								});
								return '(?:/(.*))?';
							}
							// special case — /[[optional]]/ could contain zero segments
							const optional_match = /^\[\[(\w+)(?:=(\w+))?\]\]$/.exec(segment);
							if (optional_match) {
								params.push({
									name: optional_match[1],
									matcher: optional_match[2],
									optional: true,
									rest: false,
									chained: true
								});
								return '(?:/([^/]+))?';
							}

							if (!segment) {
								return;
							}

							const parts = segment.split(/\[(.+?)\](?!\])/);
							const result = parts
								.map((content, i) => {
									if (i % 2) {
										if (content.startsWith('x+')) {
											return escape(String.fromCharCode(parseInt(content.slice(2), 16)));
										}

										if (content.startsWith('u+')) {
											return escape(
												String.fromCharCode(
													...content
														.slice(2)
														.split('-')
														.map((code) => parseInt(code, 16))
												)
											);
										}

										// We know the match cannot be null in the browser because manifest generation
										// would have invoked this during build and failed if we hit an invalid
										// param/matcher name with non-alphanumeric character.
										const match = /** @type {RegExpExecArray} */ (param_pattern.exec(content));
										if (!BROWSER && !match) {
											throw new Error(
												`Invalid param: ${content}. Params and matcher names can only have underscores and alphanumeric characters.`
											);
										}

										const [, is_optional, is_rest, name, matcher] = match;
										// It's assumed that the following invalid route id cases are already checked
										// - unbalanced brackets
										// - optional param following rest param

										params.push({
											name,
											matcher,
											optional: !!is_optional,
											rest: !!is_rest,
											chained: is_rest ? i === 1 && parts[0] === '' : false
										});
										return is_rest ? '(.*?)' : is_optional ? '([^/]*)?' : '([^/]+?)';
									}

									return escape(content);
								})
								.join('');

							return '/' + result;
						})
						.join('')}/?$`
				);

	return { pattern, params };
}

const optional_param_regex = /\/\[\[\w+?(?:=\w+)?\]\]/;

/**
 * Removes optional params from a route ID.
 * @param {string} id
 * @returns The route id with optional params removed
 */
export function remove_optional_params(id) {
	return id.replace(optional_param_regex, '');
}

/**
 * Returns `false` for `(group)` segments
 * @param {string} segment
 */
function affects_path(segment) {
	return !/^\([^)]+\)$/.test(segment);
}

/**
 * Splits a route id into its segments, removing segments that
 * don't affect the path (i.e. groups). The root route is represented by `/`
 * and will be returned as `['']`.
 * @param {string} route
 * @returns string[]
 */
export function get_route_segments(route) {
	return route.slice(1).split('/').filter(affects_path);
}

/**
 * @param {RegExpMatchArray} match
 * @param {import('types').RouteParam[]} params
 * @param {Record<string, import('@sveltejs/kit').ParamMatcher>} matchers
 */
export function exec(match, params, matchers) {
	/** @type {Record<string, string>} */
	const result = {};

	const values = match.slice(1);
	const values_needing_match = values.filter((value) => value !== undefined);

	let buffered = 0;

	for (let i = 0; i < params.length; i += 1) {
		const param = params[i];
		let value = values[i - buffered];

		// in the `[[a=b]]/.../[...rest]` case, if one or more optional parameters
		// weren't matched, roll the skipped values into the rest
		if (param.chained && param.rest && buffered) {
			value = values
				.slice(i - buffered, i + 1)
				.filter((s) => s)
				.join('/');

			buffered = 0;
		}

		// if `value` is undefined, it means this is an optional or rest parameter
		if (value === undefined) {
			if (param.rest) result[param.name] = '';
			continue;
		}

		if (!param.matcher || matchers[param.matcher](value)) {
			result[param.name] = value;

			// Now that the params match, reset the buffer if the next param isn't the [...rest]
			// and the next value is defined, otherwise the buffer will cause us to skip values
			const next_param = params[i + 1];
			const next_value = values[i + 1];
			if (next_param && !next_param.rest && next_param.optional && next_value && param.chained) {
				buffered = 0;
			}

			// There are no more params and no more values, but all non-empty values have been matched
			if (
				!next_param &&
				!next_value &&
				Object.keys(result).length === values_needing_match.length
			) {
				buffered = 0;
			}
			continue;
		}

		// in the `/[[a=b]]/...` case, if the value didn't satisfy the matcher,
		// keep track of the number of skipped optional parameters and continue
		if (param.optional && param.chained) {
			buffered++;
			continue;
		}

		// otherwise, if the matcher returns `false`, the route did not match
		return;
	}

	if (buffered) return;
	return result;
}

/** @param {string} str */
function escape(str) {
	return (
		str
			.normalize()
			// escape [ and ] before escaping other characters, since they are used in the replacements
			.replace(/[[\]]/g, '\\$&')
			// replace %, /, ? and # with their encoded versions because decode_pathname leaves them untouched
			.replace(/%/g, '%25')
			.replace(/\//g, '%2[Ff]')
			.replace(/\?/g, '%3[Ff]')
			.replace(/#/g, '%23')
			// escape characters that have special meaning in regex
			.replace(/[.*+?^${}()|\\]/g, '\\$&')
	);
}

const basic_param_pattern = /\[(\[)?(\.\.\.)?(\w+?)(?:=(\w+))?\]\]?/g;

/**
 * Populate a route ID with params to resolve a pathname.
 * @example
 * ```js
 * resolveRoute(
 *   `/blog/[slug]/[...somethingElse]`,
 *   {
 *     slug: 'hello-world',
 *     somethingElse: 'something/else'
 *   }
 * ); // `/blog/hello-world/something/else`
 * ```
 * @param {string} id
 * @param {Record<string, string | undefined>} params
 * @returns {string}
 */
export function resolve_route(id, params) {
	const segments = get_route_segments(id);
	return (
		'/' +
		segments
			.map((segment) =>
				segment.replace(basic_param_pattern, (_, optional, rest, name) => {
					const param_value = params[name];

					// This is nested so TS correctly narrows the type
					if (!param_value) {
						if (optional) return '';
						if (rest && param_value !== undefined) return '';
						throw new Error(`Missing parameter '${name}' in route ${id}`);
					}

					if (param_value.startsWith('/') || param_value.endsWith('/'))
						throw new Error(
							`Parameter '${name}' in route ${id} cannot start or end with a slash -- this would cause an invalid route like foo//bar`
						);
					return param_value;
				})
			)
			.filter(Boolean)
			.join('/')
	);
}

```


####### packages/kit/src/utils/routing.spec.js #######

```

import { assert, expect, test, describe } from 'vitest';
import { exec, parse_route_id, resolve_route } from './routing.js';

describe('parse_route_id', () => {
	const tests = {
		'/': {
			pattern: /^\/$/,
			params: []
		},
		'/blog': {
			pattern: /^\/blog\/?$/,
			params: []
		},
		'/blog.json': {
			pattern: /^\/blog\.json\/?$/,
			params: []
		},
		'/blog/[slug]': {
			pattern: /^\/blog\/([^/]+?)\/?$/,
			params: [{ name: 'slug', matcher: undefined, optional: false, rest: false, chained: false }]
		},
		'/blog/[slug].json': {
			pattern: /^\/blog\/([^/]+?)\.json\/?$/,
			params: [{ name: 'slug', matcher: undefined, optional: false, rest: false, chained: false }]
		},
		'/blog/[[slug]]': {
			pattern: /^\/blog(?:\/([^/]+))?\/?$/,
			params: [{ name: 'slug', matcher: undefined, optional: true, rest: false, chained: true }]
		},
		'/blog/[[slug=type]]/sub': {
			pattern: /^\/blog(?:\/([^/]+))?\/sub\/?$/,
			params: [{ name: 'slug', matcher: 'type', optional: true, rest: false, chained: true }]
		},
		'/blog/[[slug]].json': {
			pattern: /^\/blog\/([^/]*)?\.json\/?$/,
			params: [{ name: 'slug', matcher: undefined, optional: true, rest: false, chained: false }]
		},
		'/[...catchall]': {
			pattern: /^(?:\/(.*))?\/?$/,
			params: [{ name: 'catchall', matcher: undefined, optional: false, rest: true, chained: true }]
		},
		'/foo/[...catchall]/bar': {
			pattern: /^\/foo(?:\/(.*))?\/bar\/?$/,
			params: [{ name: 'catchall', matcher: undefined, optional: false, rest: true, chained: true }]
		},
		'/matched/[id=uuid]': {
			pattern: /^\/matched\/([^/]+?)\/?$/,
			params: [{ name: 'id', matcher: 'uuid', optional: false, rest: false, chained: false }]
		},
		'/@-symbol/[id]': {
			pattern: /^\/@-symbol\/([^/]+?)\/?$/,
			params: [{ name: 'id', matcher: undefined, optional: false, rest: false, chained: false }]
		}
	};

	for (const [key, expected] of Object.entries(tests)) {
		test(key, () => {
			const actual = parse_route_id(key);

			expect(actual.pattern.toString()).toEqual(expected.pattern.toString());
			expect(actual.params).toEqual(expected.params);
		});
	}
});

describe('exec', () => {
	const tests = [
		{
			route: '/blog/[[slug]]/sub[[param]]',
			path: '/blog/sub',
			expected: {}
		},
		{
			route: '/blog/[[slug]]/sub[[param]]',
			path: '/blog/slug/sub',
			expected: { slug: 'slug' }
		},
		{
			route: '/blog/[[slug]]/sub[[param]]',
			path: '/blog/slug/subparam',
			expected: { slug: 'slug', param: 'param' }
		},
		{
			route: '/blog/[[slug]]/sub[[param]]',
			path: '/blog/subparam',
			expected: { param: 'param' }
		},
		{
			route: '/[[slug]]/[...rest]',
			path: '/slug/rest/sub',
			expected: { slug: 'slug', rest: 'rest/sub' }
		},
		{
			route: '/[[slug]]/[...rest]',
			path: '/slug/rest',
			expected: { slug: 'slug', rest: 'rest' }
		},
		{
			route: '/[[slug]]/[...rest]',
			path: '/slug',
			expected: { slug: 'slug', rest: '' }
		},
		{
			route: '/[[slug]]/[...rest]',
			path: '/',
			expected: { rest: '' }
		},
		{
			route: '/[...rest]/path',
			path: '/rest/path',
			expected: { rest: 'rest' }
		},
		{
			route: '/[[slug1]]/[[slug2]]',
			path: '/slug1/slug2',
			expected: { slug1: 'slug1', slug2: 'slug2' }
		},
		{
			route: '/[[slug1]]/[[slug2]]',
			path: '/slug1',
			expected: { slug1: 'slug1' }
		},
		{
			route: '/[[slug1=matches]]',
			path: '/',
			expected: {}
		},
		{
			route: '/[[slug1=doesntmatch]]',
			path: '/',
			expected: {}
		},
		{
			route: '/[[slug1=matches]]/[[slug2=doesntmatch]]',
			path: '/foo',
			expected: { slug1: 'foo' }
		},
		{
			route: '/[[slug1=doesntmatch]]/[[slug2=doesntmatch]]',
			path: '/foo',
			expected: undefined
		},
		{
			route: '/[...slug1=matches]',
			path: '/',
			expected: { slug1: '' }
		},
		{
			route: '/[...slug1=doesntmatch]',
			path: '/',
			expected: undefined
		},
		{
			route: '/[[slug=doesntmatch]]/[...rest]',
			path: '/foo',
			expected: { rest: 'foo' }
		},
		{
			route: '/[[slug1=doesntmatch]]/[slug2]/[...rest]',
			path: '/foo/bar/baz',
			expected: { slug2: 'foo', rest: 'bar/baz' }
		},
		{
			route: '/[[slug1=doesntmatch]]/[slug2]/[...rest]/baz',
			path: '/foo/bar/baz',
			expected: { slug2: 'foo', rest: 'bar' }
		},
		{
			route: '/[[a=doesntmatch]]/[[b=doesntmatch]]/[[c=doesntmatch]]/[...d]',
			path: '/a/b/c/d',
			expected: { d: 'a/b/c/d' }
		},
		{
			route: '/[[a=doesntmatch]]/[b]/[...c]/[d]/e',
			path: '/foo/bar/baz/qux/e',
			expected: { b: 'foo', c: 'bar/baz', d: 'qux' }
		},
		{
			route: '/[[slug1=doesntmatch]]/[[slug2=doesntmatch]]/[...rest]',
			path: '/foo/bar/baz',
			expected: { rest: 'foo/bar/baz' }
		},
		{
			route: '/[[slug1=doesntmatch]]/[[slug2=matches]]/[[slug3=doesntmatch]]/[...rest].json',
			path: '/foo/bar/baz.json',
			expected: { slug2: 'foo', rest: 'bar/baz' }
		},
		{
			route: '/[[a=doesntmatch]]/[[b=matches]]/c',
			path: '/a/b/c',
			expected: undefined
		},
		{
			route: '/[[slug1=matches]]/[[slug2=matches]]/constant/[[slug3=matches]]',
			path: '/a/b/constant/c',
			expected: { slug1: 'a', slug2: 'b', slug3: 'c' }
		},
		{
			route: '/[[slug1=doesntmatch]]/[[slug2=matches]]/constant/[[slug3=matches]]',
			path: '/b/constant/c',
			expected: { slug2: 'b', slug3: 'c' }
		},
		{
			route: '/[[slug1=doesntmatch]]/[[slug2=matches]]/[[slug3=matches]]',
			path: '/b/c',
			expected: { slug2: 'b', slug3: 'c' }
		},
		{
			route: '/[slug1]/[[lang=doesntmatch]]/[[page=matches]]',
			path: '/a/2',
			expected: { slug1: 'a', lang: undefined, page: '2' }
		},
		{
			route: '/[[slug1=doesntmatch]]/[slug2=matches]/[slug3]',
			path: '/a/b/c',
			expected: undefined
		},
		{
			route: '/[[lang=doesntmatch]]/[asset=matches]/[[categoryType]]/[...categories]',
			path: '/music',
			expected: { asset: 'music', categories: '' }
		},
		{
			route: '/[[lang=doesntmatch]]/[asset=matches]/[[categoryType]]/[...categories]',
			path: '/music/genre',
			expected: { asset: 'music', categoryType: 'genre', categories: '' }
		},
		{
			route: '/[[lang=doesntmatch]]/[asset=matches]/[[categoryType]]/[...categories]',
			path: '/music/genre/rock',
			expected: { asset: 'music', categoryType: 'genre', categories: 'rock' }
		},
		{
			route: '/[[lang=doesntmatch]]/[asset=matches]/[[categoryType]]/[...categories]',
			path: '/sfx/category/car/crash',
			expected: { asset: 'sfx', categoryType: 'category', categories: 'car/crash' }
		},
		{
			route: '/[[lang=matches]]/[asset=matches]/[[categoryType]]/[...categories]',
			path: '/es/sfx/category/car/crash',
			expected: { lang: 'es', asset: 'sfx', categoryType: 'category', categories: 'car/crash' }
		},
		{
			route: '/[[slug1=doesntmatch]]/[...slug2=doesntmatch]',
			path: '/a/b/c',
			expected: undefined
		}
	];

	for (const { path, route, expected } of tests) {
		test(`exec extracts params correctly for ${path} from ${route}`, () => {
			const { pattern, params } = parse_route_id(route);
			const match = pattern.exec(path);
			if (!match) throw new Error(`Failed to match ${path}`);
			const actual = exec(match, params, {
				matches: () => true,
				doesntmatch: () => false
			});
			expect(actual).toEqual(expected);
		});
	}
});

describe('resolve_route', () => {
	const from_params_tests = [
		{
			route: '/blog/[one]/[two]',
			params: { one: 'one', two: 'two' },
			expected: '/blog/one/two'
		},
		{
			route: '/blog/[one=matcher]/[...two]',
			params: { one: 'one', two: 'two/three' },
			expected: '/blog/one/two/three'
		},
		{
			route: '/blog/[one=matcher]/[[two]]',
			params: { one: 'one' },
			expected: '/blog/one'
		},
		{
			route: '/blog/[one]/[two]-and-[three]',
			params: { one: 'one', two: '2', three: '3' },
			expected: '/blog/one/2-and-3'
		},
		{
			route: '/blog/[...one]',
			params: { one: '' },
			expected: '/blog'
		},
		{
			route: '/blog/[one]/[...two]-not-three',
			params: { one: 'one', two: 'two/2' },
			expected: '/blog/one/two/2-not-three'
		}
	];

	for (const { route, params, expected } of from_params_tests) {
		test(`resolvePath generates correct path for ${route}`, () => {
			const result = resolve_route(route, params);
			assert.equal(result, expected);
		});
	}

	test('resolvePath errors on missing params for required param', () => {
		expect(() => resolve_route('/blog/[one]/[two]', { one: 'one' })).toThrow(
			"Missing parameter 'two' in route /blog/[one]/[two]"
		);
	});

	test('resolvePath errors on params values starting or ending with slashes', () => {
		assert.throws(
			() => resolve_route('/blog/[one]/[two]', { one: 'one', two: '/two' }),
			"Parameter 'two' in route /blog/[one]/[two] cannot start or end with a slash -- this would cause an invalid route like foo//bar"
		);
		assert.throws(
			() => resolve_route('/blog/[one]/[two]', { one: 'one', two: 'two/' }),
			"Parameter 'two' in route /blog/[one]/[two] cannot start or end with a slash -- this would cause an invalid route like foo//bar"
		);
	});
});

```


####### packages/kit/src/utils/streaming.js #######

```

/**
 * @returns {import('types').Deferred & { promise: Promise<any> }}}
 */
function defer() {
	let fulfil;
	let reject;

	const promise = new Promise((f, r) => {
		fulfil = f;
		reject = r;
	});

	// @ts-expect-error
	return { promise, fulfil, reject };
}

/**
 * Create an async iterator and a function to push values into it
 * @returns {{
 *   iterator: AsyncIterable<any>;
 *   push: (value: any) => void;
 *   done: () => void;
 * }}
 */
export function create_async_iterator() {
	const deferred = [defer()];

	return {
		iterator: {
			[Symbol.asyncIterator]() {
				return {
					next: async () => {
						const next = await deferred[0].promise;
						if (!next.done) deferred.shift();
						return next;
					}
				};
			}
		},
		push: (value) => {
			deferred[deferred.length - 1].fulfil({
				value,
				done: false
			});
			deferred.push(defer());
		},
		done: () => {
			deferred[deferred.length - 1].fulfil({ done: true });
		}
	};
}

```


####### packages/kit/src/utils/streaming.spec.js #######

```

import { expect, test } from 'vitest';
import { create_async_iterator } from './streaming.js';

test('works with fast consecutive promise resolutions', async () => {
	const iterator = create_async_iterator();

	Promise.resolve(1).then((n) => iterator.push(n));
	Promise.resolve(2).then((n) => iterator.push(n));
	Promise.resolve().then(() => iterator.done());

	const actual = [];
	for await (const value of iterator.iterator) {
		actual.push(value);
	}

	expect(actual).toEqual([1, 2]);
});

```


####### packages/kit/src/utils/url.js #######

```

import { BROWSER, DEV } from 'esm-env';

/**
 * Matches a URI scheme. See https://www.rfc-editor.org/rfc/rfc3986#section-3.1
 * @type {RegExp}
 */
export const SCHEME = /^[a-z][a-z\d+\-.]+:/i;

const internal = new URL('sveltekit-internal://');

/**
 * @param {string} base
 * @param {string} path
 */
export function resolve(base, path) {
	// special case
	if (path[0] === '/' && path[1] === '/') return path;

	let url = new URL(base, internal);
	url = new URL(path, url);

	return url.protocol === internal.protocol ? url.pathname + url.search + url.hash : url.href;
}

/** @param {string} path */
export function is_root_relative(path) {
	return path[0] === '/' && path[1] !== '/';
}

/**
 * @param {string} path
 * @param {import('types').TrailingSlash} trailing_slash
 */
export function normalize_path(path, trailing_slash) {
	if (path === '/' || trailing_slash === 'ignore') return path;

	if (trailing_slash === 'never') {
		return path.endsWith('/') ? path.slice(0, -1) : path;
	} else if (trailing_slash === 'always' && !path.endsWith('/')) {
		return path + '/';
	}

	return path;
}

/**
 * Decode pathname excluding %25 to prevent further double decoding of params
 * @param {string} pathname
 */
export function decode_pathname(pathname) {
	return pathname.split('%25').map(decodeURI).join('%25');
}

/** @param {Record<string, string>} params */
export function decode_params(params) {
	for (const key in params) {
		// input has already been decoded by decodeURI
		// now handle the rest
		params[key] = decodeURIComponent(params[key]);
	}

	return params;
}

/**
 * The error when a URL is malformed is not very helpful, so we augment it with the URI
 * @param {string} uri
 */
export function decode_uri(uri) {
	try {
		return decodeURI(uri);
	} catch (e) {
		if (e instanceof Error) {
			e.message = `Failed to decode URI: ${uri}\n` + e.message;
		}
		throw e;
	}
}

/**
 * Returns everything up to the first `#` in a URL
 * @param {{href: string}} url_like
 */
export function strip_hash({ href }) {
	return href.split('#')[0];
}

/**
 * URL properties that could change during the lifetime of the page,
 * which excludes things like `origin`
 */
const tracked_url_properties = /** @type {const} */ ([
	'href',
	'pathname',
	'search',
	'toString',
	'toJSON'
]);

/**
 * @param {URL} url
 * @param {() => void} callback
 * @param {(search_param: string) => void} search_params_callback
 */
export function make_trackable(url, callback, search_params_callback) {
	const tracked = new URL(url);

	Object.defineProperty(tracked, 'searchParams', {
		value: new Proxy(tracked.searchParams, {
			get(obj, key) {
				if (key === 'get' || key === 'getAll' || key === 'has') {
					return (/**@type {string}*/ param) => {
						search_params_callback(param);
						return obj[key](param);
					};
				}

				// if they try to access something different from what is in `tracked_search_params_properties`
				// we track the whole url (entries, values, keys etc)
				callback();

				const value = Reflect.get(obj, key);
				return typeof value === 'function' ? value.bind(obj) : value;
			}
		}),
		enumerable: true,
		configurable: true
	});

	for (const property of tracked_url_properties) {
		Object.defineProperty(tracked, property, {
			get() {
				callback();
				return url[property];
			},

			enumerable: true,
			configurable: true
		});
	}

	if (!BROWSER) {
		// @ts-ignore
		tracked[Symbol.for('nodejs.util.inspect.custom')] = (depth, opts, inspect) => {
			return inspect(url, opts);
		};
	}

	if (DEV || !BROWSER) {
		disable_hash(tracked);
	}

	return tracked;
}

/**
 * Disallow access to `url.hash` on the server and in `load`
 * @param {URL} url
 */
function disable_hash(url) {
	allow_nodejs_console_log(url);

	Object.defineProperty(url, 'hash', {
		get() {
			throw new Error(
				'Cannot access event.url.hash. Consider using `$page.url.hash` inside a component instead'
			);
		}
	});
}

/**
 * Disallow access to `url.search` and `url.searchParams` during prerendering
 * @param {URL} url
 */
export function disable_search(url) {
	allow_nodejs_console_log(url);

	for (const property of ['search', 'searchParams']) {
		Object.defineProperty(url, property, {
			get() {
				throw new Error(`Cannot access url.${property} on a page with prerendering enabled`);
			}
		});
	}
}

/**
 * Allow URL to be console logged, bypassing disabled properties.
 * @param {URL} url
 */
function allow_nodejs_console_log(url) {
	if (!BROWSER) {
		// @ts-ignore
		url[Symbol.for('nodejs.util.inspect.custom')] = (depth, opts, inspect) => {
			return inspect(new URL(url), opts);
		};
	}
}

const DATA_SUFFIX = '/__data.json';
const HTML_DATA_SUFFIX = '.html__data.json';

/** @param {string} pathname */
export function has_data_suffix(pathname) {
	return pathname.endsWith(DATA_SUFFIX) || pathname.endsWith(HTML_DATA_SUFFIX);
}

/** @param {string} pathname */
export function add_data_suffix(pathname) {
	if (pathname.endsWith('.html')) return pathname.replace(/\.html$/, HTML_DATA_SUFFIX);
	return pathname.replace(/\/$/, '') + DATA_SUFFIX;
}

/** @param {string} pathname */
export function strip_data_suffix(pathname) {
	if (pathname.endsWith(HTML_DATA_SUFFIX)) {
		return pathname.slice(0, -HTML_DATA_SUFFIX.length) + '.html';
	}

	return pathname.slice(0, -DATA_SUFFIX.length);
}

```


####### packages/kit/src/utils/url.spec.js #######

```

import { assert, describe } from 'vitest';
import { resolve, normalize_path, make_trackable, disable_search } from './url.js';

describe('resolve', (test) => {
	test('resolves a root-relative path', () => {
		assert.equal(resolve('/a/b/c', '/x/y/z'), '/x/y/z');
	});

	test('resolves a relative path without a leading .', () => {
		assert.equal(resolve('/a/b/c', 'd'), '/a/b/d');
	});

	test('resolves a relative path with trailing /', () => {
		assert.equal(resolve('/a/b/c', 'd/'), '/a/b/d/');
	});

	test('resolves a relative path with leading .', () => {
		assert.equal(resolve('/a/b/c', './d'), '/a/b/d');
	});

	test('resolves a relative path with . in the middle', () => {
		assert.equal(resolve('/a/b/c', 'd/./e/./f'), '/a/b/d/e/f');
	});

	test('resolves a relative path with leading ..', () => {
		assert.equal(resolve('/a/b/c', '../d'), '/a/d');
	});

	test('resolves a relative path with .. in the middle', () => {
		assert.equal(resolve('/a/b/c', 'd/./e/../f'), '/a/b/d/f');
	});

	test('resolves a relative path with extraneous leading ..', () => {
		assert.equal(resolve('/a/b/c', '../../../../../d'), '/d');
	});

	test('resolves a root-relative path with .', () => {
		assert.equal(resolve('/a/b/c', '/x/./y/../z'), '/x/z');
	});

	test('resolves a protocol-relative path', () => {
		assert.equal(resolve('/a/b/c', '//example.com/foo'), '//example.com/foo');
	});

	test('resolves an absolute path', () => {
		assert.equal(resolve('/a/b/c', 'https://example.com/foo'), 'https://example.com/foo');
	});

	test('handles schemes like tel: and mailto:', () => {
		assert.equal(resolve('/a/b/c', 'mailto:hello@svelte.dev'), 'mailto:hello@svelte.dev');
	});

	test('resolves a fragment link', () => {
		assert.equal(resolve('/a/b/c', '#foo'), '/a/b/c#foo');
	});

	test('resolves data: urls', () => {
		assert.equal(resolve('/a/b/c', 'data:text/plain,hello'), 'data:text/plain,hello');
	});

	test('resolves empty string', () => {
		assert.equal(resolve('/a/b/c', ''), '/a/b/c');
	});

	test('resolves .', () => {
		assert.equal(resolve('/a/b/c', '.'), '/a/b/');
	});
});

describe('normalize_path', (test) => {
	test('normalizes paths', () => {
		/** @type {Record<string, { ignore: string, always: string, never: string }>} */
		const paths = {
			'/': {
				ignore: '/',
				always: '/',
				never: '/'
			},
			'/foo': {
				ignore: '/foo',
				always: '/foo/',
				never: '/foo'
			},
			'/foo/': {
				ignore: '/foo/',
				always: '/foo/',
				never: '/foo'
			}
		};

		for (const path in paths) {
			const { ignore, always, never } = paths[path];

			assert.equal(normalize_path(path, 'ignore'), ignore);
			assert.equal(normalize_path(path, 'always'), always);
			assert.equal(normalize_path(path, 'never'), never);
		}
	});
});

describe('make_trackable', (test) => {
	test('makes URL properties trackable', () => {
		let tracked = false;
		const url = make_trackable(
			new URL('https://kit.svelte.dev/docs'),
			() => {
				tracked = true;
			},
			() => {}
		);

		url.origin;
		assert.ok(!tracked);

		url.pathname;
		assert.ok(tracked);
	});

	test('throws an error when its hash property is accessed', () => {
		const url = make_trackable(
			new URL('https://kit.svelte.dev/docs'),
			() => {},
			() => {}
		);

		assert.throws(
			() => url.hash,
			/Cannot access event.url.hash. Consider using `\$page.url.hash` inside a component instead/
		);
	});

	test('track each search param separately if accessed directly', () => {
		let tracked = false;
		const tracked_search_params = new Set();
		const url = make_trackable(
			new URL('https://kit.svelte.dev/docs'),
			() => {
				tracked = true;
			},
			(search_param) => {
				tracked_search_params.add(search_param);
			}
		);

		url.searchParams.get('test');
		assert.ok(!tracked);
		assert.ok(tracked_search_params.has('test'));

		url.searchParams.getAll('test-getall');
		assert.ok(!tracked);
		assert.ok(tracked_search_params.has('test-getall'));

		url.searchParams.has('test-has');
		assert.ok(!tracked);
		assert.ok(tracked_search_params.has('test-has'));

		url.searchParams.entries();
		assert.ok(tracked);
	});
});

describe('disable_search', (test) => {
	test('throws an error when its search property is accessed', () => {
		const url = new URL('https://kit.svelte.dev/docs');
		disable_search(url);

		/** @type {Array<keyof URL>} */
		const props = ['search', 'searchParams'];
		props.forEach((prop) => {
			assert.throws(
				() => url[prop],
				`Cannot access url.${prop} on a page with prerendering enabled`
			);
		});
	});
});

```


####### packages/kit/src/version.js #######

```

// generated during release, do not modify

/** @type {string} */
export const VERSION = '2.5.7';

```


####### packages/kit/src/version.spec.js #######

```

import { fileURLToPath } from 'node:url';
import { readFileSync } from 'node:fs';
import { assert, describe, it } from 'vitest';

// runs the version generation as a side-effect of importing
import '../scripts/generate-version.js';

describe('@sveltejs/kit VERSION', async () => {
	it('should be the exact version from package.json');
	const { VERSION } = await import('./version.js');
	const pkg = JSON.parse(
		readFileSync(fileURLToPath(new URL('../package.json', import.meta.url)), 'utf-8')
	);
	assert.equal(
		VERSION,
		pkg.version,
		'VERSION export in src/version.js does not equal version in package.json'
	);
});

```


####### packages/kit/svelte-kit.js #######

```

#!/usr/bin/env node
import './src/cli.js';

```


####### packages/kit/test/ambient.d.ts #######

```

declare global {
	interface Window {
		navigated: Promise<void>;
		started: boolean;
	}

	const goto: (
		href: string,
		opts?: {
			replaceState?: boolean;
			noScroll?: boolean;
		}
	) => Promise<void>;

	const invalidate: (url: string) => Promise<void>;
	const preloadData: (url: string) => Promise<void>;
	const beforeNavigate: (fn: (url: URL) => void | boolean) => void;
	const afterNavigate: (fn: () => void) => void;
	const preloadCode: (...urls: string[]) => Promise<void>;
}

export {};

```


####### packages/kit/test/apps/amp/package.json #######

```

{
	"name": "test-amp",
	"private": true,
	"version": "0.0.1",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"test": "pnpm test:dev && pnpm test:build",
		"test:dev": "cross-env DEV=true playwright test",
		"test:build": "playwright test"
	},
	"devDependencies": {
		"@sveltejs/amp": "workspace:^",
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"cross-env": "^7.0.3",
		"dropcss": "^1.0.16",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/apps/amp/playwright.config.js #######

```

import { config } from '../../utils.js';

config.webServer && (config.webServer.timeout = 45000); // AMP validator needs a long time to get moving

// remove any projects with javaScriptEnabled
const projects = config.projects || [];
for (let i = projects.length - 1; i >= 0; i--) {
	if (projects[i]?.use?.javaScriptEnabled) {
		projects.splice(i, 1);
	}
}

export default config;

```


####### packages/kit/test/apps/amp/src/app.d.ts #######

```

/// <reference types="@sveltejs/kit" />

declare module 'dropcss' {
	interface Options {
		html: string;
		css: string;

		shouldDrop?: (selector: string) => boolean;
		didRetain?: (selector: string) => void;

		keepText?: boolean;
	}

	export default function dropcss(options: Options): { css: string };
}

```


####### packages/kit/test/apps/amp/src/app.html #######

```

<!doctype html>
<html lang="en" amp>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="canonical" href="https://example.com" />
		%sveltekit.head%
	</head>
	<body>
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/apps/amp/src/hooks.server.js #######

```

import * as amp from '@sveltejs/amp';
import dropcss from 'dropcss';

/** @type {import('@sveltejs/kit').Handle} */
export async function handle({ event, resolve }) {
	let buffer = '';

	return await resolve(event, {
		transformPageChunk: ({ html, done }) => {
			buffer += html;

			if (done) {
				let css = '';
				const markup = amp
					.transform(buffer)
					.replace('⚡', 'amp')
					.replace(/<style amp-custom([^>]*?)>([^]+?)<\/style>/, (match, attributes, contents) => {
						css = contents;
						return `<style amp-custom${attributes}></style>`;
					});

				css = dropcss({ css, html: markup }).css;
				return markup.replace('</style>', `${css}</style>`);
			}
		}
	});
}

```


####### packages/kit/test/apps/amp/src/routes/http-equiv/cache-control/+page.js #######

```

export const prerender = true;

/** @type {import('./$types').PageLoad} */
export function load({ setHeaders }) {
	setHeaders({
		'cache-control': 'public, max-age=300'
	});
}

```


####### packages/kit/test/apps/amp/src/routes/http-equiv/cache-control/+page.svelte #######

```

<h1>the cache-control headers should be removed from this page</h1>

```


####### packages/kit/test/apps/amp/src/routes/invalid/has-stylesheet/+page.svelte #######

```

<svelte:head>
	<link rel="stylesheet" href="https://example.com/whatever" />
</svelte:head>

```


####### packages/kit/test/apps/amp/src/routes/invalid/+page.svelte #######

```

<!-- svelte-ignore a11y-invalid-attribute -->
<a href="javascript:void(0);">invalid</a>

```


####### packages/kit/test/apps/amp/src/routes/+layout.js #######

```

export const csr = false;

```


####### packages/kit/test/apps/amp/src/routes/+layout.svelte #######

```

<slot />
<footer>footer</footer>

<style>
	footer {
		color: purple;
	}
</style>

```


####### packages/kit/test/apps/amp/src/routes/origin.json/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').RequestHandler} */
export function GET({ url }) {
	return json({ origin: url.origin });
}

```


####### packages/kit/test/apps/amp/src/routes/origin/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ url, fetch }) {
	const res = await fetch('/origin.json');
	const data = await res.json();

	return {
		origin: url.origin,
		data
	};
}

```


####### packages/kit/test/apps/amp/src/routes/origin/+page.svelte #######

```

<script>
	import { page } from '$app/stores';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<p data-source="load">{data.origin}</p>
<p data-source="store">{$page.url.origin}</p>
<p data-source="endpoint">{data.data.origin}</p>

```


####### packages/kit/test/apps/amp/src/routes/styles/imported.css #######

```

.shouty {
	text-transform: uppercase;
}

```


####### packages/kit/test/apps/amp/src/routes/styles/+page.svelte #######

```

<script>
	import Unused from './Unused.svelte';
	import './imported.css';
</script>

{#if Math.random() <= 1}
	<p class="shouty">this text is rendered</p>
{:else}
	<Unused />
{/if}

<style>
	p {
		color: #ff3e00;
	}
</style>

```


####### packages/kit/test/apps/amp/src/routes/styles/Unused.svelte #######

```

<p class="shouty">this component will never be rendered</p>

<style>
	p {
		color: #40b3ff;
	}
</style>

```


####### packages/kit/test/apps/amp/src/routes/valid.json/+server.js #######

```

import { json } from '@sveltejs/kit';

export function GET() {
	return json({ answer: 42 });
}

```


####### packages/kit/test/apps/amp/src/routes/valid/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const res = await fetch('/valid.json');
	const { answer } = await res.json();
	return { answer };
}

```


####### packages/kit/test/apps/amp/src/routes/valid/+page.svelte #######

```

<script>
	import { browser, dev } from '$app/environment';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>Hello from the {browser ? 'client' : 'server'} in {dev ? 'dev' : 'prod'} mode!</h1>
<h2>The answer is {data.answer}</h2>
<p>This text is red</p>

<style>
	p {
		color: red;
	}
</style>

```


####### packages/kit/test/apps/amp/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		inlineStyleThreshold: Infinity
	}
};

export default config;

```


####### packages/kit/test/apps/amp/test/test.js #######

```

import { expect } from '@playwright/test';
import { test } from '../../../utils.js';

test.describe.configure({ mode: 'parallel' });

test('renders an AMP page', async ({ page, baseURL }) => {
	await page.goto(`${baseURL}/valid`);

	await expect(page.locator('h1')).toHaveText(
		`Hello from the server in ${process.env.DEV ? 'dev' : 'prod'} mode!`
	);

	await expect(page.locator('h2')).toHaveText('The answer is 42');

	// should not include serialized data
	expect(await page.$('script[sveltekit\\:data-type="data"]')).toBeNull();
});

test('styles are applied', async ({ page, baseURL, get_computed_style }) => {
	await page.goto(`${baseURL}/valid`);

	expect(await get_computed_style('p', 'color')).toEqual('rgb(255, 0, 0)');
	expect(await get_computed_style('footer', 'color')).toEqual('rgb(128, 0, 128)');
});

test('sets origin', async ({ baseURL, page }) => {
	const { origin } = new URL(/** @type {string} */ (baseURL));

	await page.goto(`${baseURL}/origin`);

	await expect(page.locator('[data-source="load"]')).toHaveText(origin);
	await expect(page.locator('[data-source="store"]')).toHaveText(origin);
	await expect(page.locator('[data-source="endpoint"]')).toHaveText(origin);
});

test('only includes CSS for rendered components', async ({ page, baseURL }) => {
	await page.goto(`${baseURL}/styles`);

	const style = await page.innerHTML('style[amp-custom]');

	expect(style).toContain('#ff3e00'); // rendered styles
	expect(style).toContain('uppercase'); // imported styles
	expect(style).not.toContain('#40b3ff'); // unrendered styles
});

test('http-equiv tags are removed', async ({ page }) => {
	await page.goto('/http-equiv/cache-control');

	expect(await page.textContent('h1')).toBe(
		'the cache-control headers should be removed from this page'
	);
	expect(await page.innerHTML('head')).not.toContain('http-equiv="cache-control"');
});

// validation tests are skipped because amphtml-validator doesn't
// play nicely with CI, and is also abominably slow, because
// everything AMP-related is awful
test.skip('prints validation errors', async ({ page, baseURL }) => {
	await page.goto(`${baseURL}/invalid`);

	const body = await page.innerHTML('body');

	expect(body).toContain("Invalid URL protocol 'javascript:' for attribute 'href' in tag 'a'");
});

test.skip('throws error on encountering stylesheet links', async ({ page }) => {
	await page.goto('/invalid/has-stylesheet');

	expect(await page.textContent('body')).toContain(
		'An AMP document cannot contain <link rel="stylesheet"> — ensure that inlineStyleThreshold is set to Infinity, and remove links from your page template and <svelte:head> elements'
	);
});

```


####### packages/kit/test/apps/amp/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true
	},
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/kit/test/apps/amp/vite.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},
	clearScreen: false,
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/apps/basics/package.json #######

```

{
	"name": "test-basics",
	"private": true,
	"version": "0.0.2-next.0",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"test": "node test/setup.js && pnpm test:dev && pnpm test:build",
		"test:dev": "node -e \"fs.rmSync('test/errors.json', { force: true })\" && cross-env DEV=true playwright test",
		"test:build": "node -e \"fs.rmSync('test/errors.json', { force: true })\" && cross-env PUBLIC_PRERENDERING=false playwright test",
		"test:cross-platform:dev": "node test/setup.js && node -e \"fs.rmSync('test/errors.json', { force: true })\" && cross-env DEV=true playwright test test/cross-platform/",
		"test:cross-platform:build": "node test/setup.js && node -e \"fs.rmSync('test/errors.json', { force: true })\" && playwright test test/cross-platform/"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"cross-env": "^7.0.3",
		"marked": "^12.0.0",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/apps/basics/playwright.config.js #######

```

import { config } from '../../utils.js';

export default {
	...config,
	webServer: {
		command: process.env.DEV
			? 'cross-env PUBLIC_PRERENDERING=false pnpm dev'
			: 'cross-env PUBLIC_PRERENDERING=true pnpm build && pnpm preview',
		port: process.env.DEV ? 5173 : 4173
	}
};

```


####### packages/kit/test/apps/basics/src/app.d.ts #######

```

declare global {
	namespace App {
		interface Locals {
			answer: number;
			name?: string;
			key: string;
			params: Record<string, string>;
			url?: URL;
		}

		interface PageState {
			active: boolean;
		}

		interface Platform {}
	}
}

export {};

```


####### packages/kit/test/apps/basics/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/png" href="%sveltekit.assets%/favicon.png" />
		<meta name="transform-page" content="__REPLACEME__" />
		%sveltekit.head%
	</head>
	<body class="%sveltekit.env.PUBLIC_THEME%">
		<div>%sveltekit.body%</div>
		<a href="/routing/link-outside-app-target/target">outside app target</a>
	</body>
</html>

```


####### packages/kit/test/apps/basics/src/error.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Error</title>
	</head>
	<body>
		<h1>Error - %sveltekit.status%</h1>
		<p>This is the static error page with the following message: %sveltekit.error.message%</p>
	</body>
</html>

```


####### packages/kit/test/apps/basics/src/global.d.ts #######

```

declare global {
	interface Window {
		invalidated: boolean;
		oops: string;
		pageContext: any;
		mounted: number;
		fulfil_navigation: (value: any) => void;
		promise: Promise<any>;
		PUBLIC_DYNAMIC: string;
	}
}

export {};

```


####### packages/kit/test/apps/basics/src/hooks.client.js #######

```

import { env } from '$env/dynamic/public';

window.PUBLIC_DYNAMIC = env.PUBLIC_DYNAMIC;

/** @type{import("@sveltejs/kit").HandleClientError} */
export function handleError({ error, event, status, message }) {
	return event.url.pathname.endsWith('404-fallback')
		? undefined
		: { message: `${/** @type {Error} */ (error).message} (${status} ${message})` };
}

```


####### packages/kit/test/apps/basics/src/hooks.js #######

```

import { browser } from '$app/environment';

const mapping = {
	'/reroute/basic/a': '/reroute/basic/b',
	'/reroute/client-only-redirect/a': '/reroute/client-only-redirect/b',
	'/reroute/preload-data/a': '/reroute/preload-data/b'
};

/** @type {import("@sveltejs/kit").Reroute} */
export const reroute = ({ url }) => {
	//Try to rewrite the external url used in /reroute/external to the homepage - This should not work
	if (browser && url.href.startsWith('https://expired.badssl.com')) {
		return '/';
	}

	if (url.pathname === '/reroute/error-handling/client-error') {
		if (browser) {
			throw new Error('Client Error');
		} else {
			return '/reroute/error-handling/client-error-rewritten';
		}
	}

	if (url.pathname === '/reroute/error-handling/server-error') {
		throw new Error('Server Error - Should trigger 500 response');
	}

	if (url.pathname in mapping) {
		return mapping[url.pathname];
	}
};

```


####### packages/kit/test/apps/basics/src/hooks.server.js #######

```

import fs from 'node:fs';
import { sequence } from '@sveltejs/kit/hooks';
import { error, isHttpError, redirect } from '@sveltejs/kit';
import { COOKIE_NAME } from './routes/cookies/shared';

/**
 * Transform an error into a POJO, by copying its `name`, `message`
 * and (in dev) `stack`, plus any custom properties, plus recursively
 * serialized `cause` properties.
 *
 * @param {Error} error
 */
export function error_to_pojo(error) {
	if (isHttpError(error)) {
		return {
			status: error.status,
			...error.body
		};
	}

	const { name, message, stack, ...custom } = error;
	return { name, message, stack, ...custom };
}

/** @type {import('@sveltejs/kit').HandleServerError} */
export const handleError = ({ event, error: e, status, message }) => {
	const error = /** @type {Error} */ (e);
	// TODO we do this because there's no other way (that i'm aware of)
	// to communicate errors back to the test suite. even if we could
	// capture stderr, attributing an error to a specific request
	// is trickier when things run concurrently
	const errors = fs.existsSync('test/errors.json')
		? JSON.parse(fs.readFileSync('test/errors.json', 'utf8'))
		: {};
	errors[event.url.pathname] = error_to_pojo(error);
	fs.writeFileSync('test/errors.json', JSON.stringify(errors));

	return event.url.pathname.endsWith('404-fallback')
		? undefined
		: { message: `${error.message} (${status} ${message})` };
};

export const handle = sequence(
	({ event, resolve }) => {
		event.locals.key = event.route.id;
		event.locals.params = event.params;
		event.locals.answer = 42;
		return resolve(event);
	},
	({ event, resolve }) => {
		if (
			event.request.url.includes('__data.json') &&
			(event.url.pathname.endsWith('__data.json') || !event.isDataRequest)
		) {
			throw new Error(
				'__data.json requests should have the suffix stripped from the URL and isDataRequest set to true'
			);
		}
		return resolve(event);
	},
	({ event, resolve }) => {
		if (
			event.request.headers.has('host') &&
			!event.request.headers.has('user-agent') !== event.isSubRequest
		) {
			throw new Error('SSR API sub-requests should have isSubRequest set to true');
		}
		return resolve(event);
	},
	({ event, resolve }) => {
		if (event.url.pathname.includes('fetch-credentialed')) {
			// Only get the cookie at the test where we know it's set to avoid polluting our logs with (correct) warnings
			event.locals.name = /** @type {string} */ (event.cookies.get('name'));
		}
		return resolve(event);
	},
	async ({ event, resolve }) => {
		if (event.url.pathname === '/cookies/serialize') {
			event.cookies.set('before', 'before', { path: '' });
			const response = await resolve(event);
			response.headers.append(
				'set-cookie',
				event.cookies.serialize('after', 'after', { path: '' })
			);
			return response;
		}
		return resolve(event);
	},
	async ({ event, resolve }) => {
		if (event.url.pathname === '/errors/error-in-handle') {
			throw new Error('Error in handle');
		} else if (event.url.pathname === '/errors/expected-error-in-handle') {
			error(500, 'Expected error in handle');
		}

		const response = await resolve(event, {
			transformPageChunk: event.url.pathname.startsWith('/transform-page-chunk')
				? ({ html }) => html.replace('__REPLACEME__', 'Worked!')
				: undefined
		});

		try {
			// in some tests we fetch stuff with undici, and the headers are immutable.
			// we can safely ignore it in those cases
			response.headers.append('set-cookie', 'name=SvelteKit; path=/; HttpOnly');
		} catch {}

		return response;
	},
	async ({ event, resolve }) => {
		if (event.url.pathname.includes('/redirect/in-handle')) {
			if (event.url.search === '?throw') {
				redirect(307, event.url.origin + '/redirect/c');
			} else if (event.url.search.includes('cookies')) {
				event.cookies.delete(COOKIE_NAME, { path: '/cookies' });
				redirect(307, event.url.origin + '/cookies');
			} else {
				return new Response(undefined, { status: 307, headers: { location: '/redirect/c' } });
			}
		}

		return resolve(event);
	},
	async ({ event, resolve }) => {
		if (event.url.pathname === '/prerendering/prerendered-endpoint/from-handle-hook') {
			return event.fetch('/prerendering/prerendered-endpoint/api');
		}

		return resolve(event);
	},
	async ({ event, resolve }) => {
		if (event.url.pathname === '/actions/redirect-in-handle' && event.request.method === 'POST') {
			redirect(303, '/actions/enhance');
		}

		return resolve(event);
	},
	async ({ event, resolve }) => {
		if (['/non-existent-route', '/non-existent-route-loop'].includes(event.url.pathname)) {
			event.locals.url = new URL(event.request.url);
		}
		return resolve(event);
	}
);

/** @type {import('@sveltejs/kit').HandleFetch} */
export async function handleFetch({ request, fetch }) {
	if (request.url.endsWith('/server-fetch-request.json')) {
		request = new Request(
			request.url.replace('/server-fetch-request.json', '/server-fetch-request-modified.json'),
			request
		);
	}

	return fetch(request);
}

```


####### packages/kit/test/apps/basics/src/params/lowercase.js #######

```

export function match(param) {
	return /^[a-z]+$/.test(param);
}

```


####### packages/kit/test/apps/basics/src/params/numeric.js #######

```

export function match(param) {
	return !isNaN(parseInt(param));
}

```


####### packages/kit/test/apps/basics/src/params/uppercase.js #######

```

export function match(param) {
	return /^[A-Z]+$/.test(param);
}

```


####### packages/kit/test/apps/basics/src/routes/accessibility/a/+page.svelte #######

```

<svelte:head>
	<title>a</title>
</svelte:head>

<h1>a</h1>

```


####### packages/kit/test/apps/basics/src/routes/accessibility/autofocus/a/+page.svelte #######

```

<svelte:head>
	<title>a</title>
</svelte:head>

<h1>a</h1>

```


####### packages/kit/test/apps/basics/src/routes/accessibility/autofocus/b/+page.server.js #######

```

export const actions = {
	default() {}
};

```


####### packages/kit/test/apps/basics/src/routes/accessibility/autofocus/b/+page.svelte #######

```

<script>
	import { enhance } from '$app/forms';
</script>

<svelte:head>
	<title>b</title>
</svelte:head>

<h1>b</h1>

<form method="POST" use:enhance>
	<button id="submit">submit</button>
</form>

```


####### packages/kit/test/apps/basics/src/routes/accessibility/autofocus/+layout.svelte #######

```

<slot />

<!-- svelte-ignore a11y-autofocus -->
<input autofocus />

<a href="/">Home</a>

```


####### packages/kit/test/apps/basics/src/routes/accessibility/b/+page.svelte #######

```

<svelte:head>
	<title>b</title>
</svelte:head>

<h1>b</h1>

```


####### packages/kit/test/apps/basics/src/routes/accessibility/c/+page.server.js #######

```

export const actions = {
	default() {}
};

```


####### packages/kit/test/apps/basics/src/routes/accessibility/c/+page.svelte #######

```

<script>
	import { enhance } from '$app/forms';
</script>

<svelte:head>
	<title>c</title>
</svelte:head>

<h1>c</h1>

<form method="POST" use:enhance>
	<button id="submit">submit</button>
</form>

```


####### packages/kit/test/apps/basics/src/routes/accessibility/+layout.svelte #######

```

<button>focus me</button>

<nav>
	<a href="/accessibility/a">a</a>
	<a href="/accessibility/b">b</a>
	<a href="/accessibility/autofocus/a">autofocus/a</a>
	<a href="/accessibility/autofocus/b">autofocus/b</a>
</nav>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/actions/enhance/+page.server.js #######

```

import { error } from '@sveltejs/kit';

/** @type {import('./$types').PageServerLoad} */
export function load({ cookies }) {
	const enhance_counter = +(cookies.get('enhance-counter') ?? 0);

	return {
		initial: 'initial',
		enhance_counter
	};
}

/** @type {import('./$types').Actions} */
export const actions = {
	login: async ({ request }) => {
		const fields = await request.formData();
		return {
			result: fields.get('username')
		};
	},
	register: async ({ request }) => {
		const fields = await request.formData();
		return {
			result: 'register: ' + fields.get('username')
		};
	},
	slow: async () => {
		await new Promise((resolve) => setTimeout(resolve, 500));
	},
	submitter: async ({ request }) => {
		const fields = await request.formData();
		return {
			result: 'submitter: ' + fields.get('submitter')
		};
	},
	error: () => {
		error(400, 'error');
	},
	echo: async ({ request }) => {
		const data = await request.formData();

		return {
			message: data.get('message')
		};
	},
	counter: async ({ cookies }) => {
		let count = +(cookies.get('enhance-counter') ?? 0);

		count += 1;

		cookies.set('enhance-counter', count + '', {
			path: '/actions/enhance'
		});

		return {};
	}
};

```


####### packages/kit/test/apps/basics/src/routes/actions/enhance/+page.svelte #######

```

<script>
	import { enhance } from '$app/forms';
	import { page } from '$app/stores';

	/** @type {import('./$types').ActionData} */
	export let form;

	/** @type {import('./$types').PageData} */
	export let data;

	/** @type {AbortController | undefined} */
	let previous;
	let count = 0;
</script>

<pre class="data1">prop: {data.enhance_counter}, store: {$page.data.enhance_counter}</pre>

<pre class="formdata1">{JSON.stringify(form)}</pre>
<pre class="formdata2">{JSON.stringify($page.form)}</pre>

<form method="post" action="?/login" use:enhance>
	<input type="hidden" name="action" value="DOM clobbering" />
	<input type="hidden" name="reset" value="DOM clobbering" />
	<input name="username" type="text" />
	<button class="form1">Submit</button>
	<button class="form1-register" formAction="?/register">Submit</button>
	<button class="form1-submitter" formAction="?/submitter" name="submitter" value="foo">
		Submit
	</button>
	<button class="form1-error" formAction="?/error">Submit</button>
</form>

<span class="count">{count}</span>
<form
	method="post"
	action="?/slow"
	use:enhance={({ controller }) => {
		previous?.abort();
		previous = controller;
		return () => count++;
	}}
>
	<button class="form2">Submit</button>
</form>

<form method="post" action="?/echo" use:enhance>
	<input name="message" type="text" value={form?.message ?? ''} />
	<button class="form3">Submit</button>
</form>

<form action="?/counter" method="post" use:enhance>
	<button class="form4">Submit</button>
</form>

<dialog id="dialog" open>
	<form action="?/echo" method="post" use:enhance>
		<button formmethod="dialog">Cancel</button>
	</form>
</dialog>

```


####### packages/kit/test/apps/basics/src/routes/actions/file-without-enctype/+page.server.js #######

```

export const actions = {
	default: async ({ request }) => {
		const data = await request.formData();
		console.log(data.get('file'));
	}
};

```


####### packages/kit/test/apps/basics/src/routes/actions/file-without-enctype/+page.svelte #######

```

<script>
	import { enhance } from '$app/forms';
</script>

<form method="POST" use:enhance>
	<input name="file" type="file" />
	<button type="submit">upload</button>
</form>

```


####### packages/kit/test/apps/basics/src/routes/actions/form-errors/adjacent-error-boundary/+error.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<pre style:color="red">{$page.error?.message}</pre>

```


####### packages/kit/test/apps/basics/src/routes/actions/form-errors/adjacent-error-boundary/+page.server.js #######

```

import { error } from '@sveltejs/kit';

export const actions = {
	default: async () => {
		error(502, 'something went wrong');
	}
};

```


####### packages/kit/test/apps/basics/src/routes/actions/form-errors/adjacent-error-boundary/+page.svelte #######

```

<script>
	import { enhance } from '$app/forms';
</script>

<form method="POST" use:enhance>
	<button type="submit">submit</button>
</form>

```


####### packages/kit/test/apps/basics/src/routes/actions/form-errors/+page.server.js #######

```

import { fail } from '@sveltejs/kit';

/** @type {import('./$types').Actions} */
export const actions = {
	default: async () => {
		return fail(400, { errors: { message: 'an error occurred' } });
	}
};

```


####### packages/kit/test/apps/basics/src/routes/actions/form-errors/+page.svelte #######

```

<script>
	import { browser } from '$app/environment';

	/** @type {import('./$types').ActionData} */
	export let form;

	const hydrated_error_message = browser ? 'hydrated: ' + form?.errors?.message : '';
</script>

<form method="post">
	<button type="submit">Submit</button>
</form>

<p class="server-prop">{form?.errors?.message}</p>

<!-- needs to be like this else the selector is found too soon (before hydration) -->
{#if hydrated_error_message}
	<p class="client-prop">{hydrated_error_message}</p>
{/if}

```


####### packages/kit/test/apps/basics/src/routes/actions/form-errors-persist-fields/+page.server.js #######

```

import { fail } from '@sveltejs/kit';

/**
 * @type {import('./$types').Actions}
 */
export const actions = {
	default: async ({ request }) => {
		const fields = await request.formData();
		fields.delete('password');
		return fail(400, {
			values: Object.fromEntries(fields),
			errors: {
				message: 'invalid credentials'
			}
		});
	}
};

```


####### packages/kit/test/apps/basics/src/routes/actions/form-errors-persist-fields/+page.svelte #######

```

<script>
	import { deserialize } from '$app/forms';
	import { browser } from '$app/environment';

	/** @type {import('./$types').ActionData} */
	export let form;

	$: hydrated_form_values = browser ? form?.values : '';

	async function submit() {
		const res = await fetch(this.action, {
			method: 'POST',
			body: new FormData(this),
			headers: {
				accept: 'application/json'
			}
		});
		// @ts-expect-error don't bother with type narrowing work here
		const { data } = deserialize(await res.text());
		form = data;
	}
</script>

<form method="post" on:submit|preventDefault={submit}>
	<input type="text" name="username" value={form?.values?.username ?? ''} />
	<input type="password" name="password" />
	<button type="submit">Submit</button>
</form>

<!-- needs to be like this else the selector is found too soon (before hydration) -->
{#if hydrated_form_values}
	<pre class="client">{JSON.stringify(hydrated_form_values)}</pre>
{/if}

```


####### packages/kit/test/apps/basics/src/routes/actions/invalidate-all/+layout.js #######

```

export function load() {
	return {
		changes_every_load: new Date()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/actions/invalidate-all/+page.server.js #######

```

export function load({ url }) {
	const invalidate_all = url.searchParams.get('invalidate_all') === 'true';
	return {
		invalidate_all
	};
}

export const actions = {
	default: () => {}
};

```


####### packages/kit/test/apps/basics/src/routes/actions/invalidate-all/+page.svelte #######

```

<script>
	import { enhance } from '$app/forms';

	export let data;

	/**
	 * @param {HTMLFormElement} node
	 */
	function enhanceWrapper(node) {
		return enhance(
			node,
			() =>
				({ update }) =>
					update({ invalidateAll: data.invalidate_all })
		);
	}
</script>

<form method="POST" use:enhanceWrapper>
	<pre>{data.changes_every_load.toISOString()}</pre>
	<button type="submit">invalidate</button>
</form>

```


####### packages/kit/test/apps/basics/src/routes/actions/redirect-in-handle/+page.server.js #######

```

/** @type {import('./$types').Actions} */
export const actions = {
	default: async () => {
		throw new Error('should never get here');
	}
};

```


####### packages/kit/test/apps/basics/src/routes/actions/redirect-in-handle/+page.svelte #######

```

<script>
	import { enhance } from '$app/forms';
</script>

<form method="post" use:enhance>
	<button>Submit</button>
</form>

```


####### packages/kit/test/apps/basics/src/routes/actions/redirect/+page.server.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('./$types').PageServerLoad} */
export function load() {
	return {
		initial: 'initial'
	};
}

/** @type {import('./$types').Actions} */
export const actions = {
	default: async () => {
		redirect(303, '/actions/enhance');
	}
};

```


####### packages/kit/test/apps/basics/src/routes/actions/redirect/+page.svelte #######

```

<script>
	import { enhance } from '$app/forms';
</script>

<form method="post" use:enhance>
	<button>Submit</button>
</form>

```


####### packages/kit/test/apps/basics/src/routes/actions/success-data/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load() {
	return {
		initial: 'initial'
	};
}

/** @type {import('./$types').Actions} */
export const actions = {
	default: async ({ request }) => {
		const fields = await request.formData();
		return {
			result: fields.get('username')
		};
	}
};

```


####### packages/kit/test/apps/basics/src/routes/actions/success-data/+page.svelte #######

```

<script>
	import { deserialize } from '$app/forms';

	/** @type {import('./$types').ActionData} */
	export let form;

	async function submit({ submitter }) {
		const res = await fetch(this.action, {
			method: 'POST',
			body:
				submitter.getAttribute('formenctype') === 'multipart/form-data'
					? new FormData(this)
					: new URLSearchParams({ username: this['username'].value }),
			headers: {
				accept: 'application/json'
			}
		});
		// @ts-expect-error don't bother with type narrowing work here
		const { data } = deserialize(await res.text());
		form = data;
	}
</script>

<pre>{JSON.stringify(form)}</pre>

<form method="post" on:submit|preventDefault={submit}>
	<input name="username" type="text" />
	<button formenctype="multipart/form-data">Submit</button>
	<button formenctype="application/x-www-form-urlencoded">Submit</button>
</form>

```


####### packages/kit/test/apps/basics/src/routes/actions/update-form/+page.svelte #######

```

<script>
	import { applyAction } from '$app/forms';
	import { invalidateAll } from '$app/navigation';

	export let form;
	let count = 0;

	/** @param {'success' | 'failure'} type */
	function update(type) {
		applyAction({ type, status: 200, data: { count: count++ } });
	}
	function redirect() {
		applyAction({ type: 'redirect', status: 303, location: '/' });
	}
	function error() {
		applyAction({ type: 'error', error: { message: 'Unexpected Form Error' } });
	}
</script>

<pre>{JSON.stringify(form)}</pre>
<button class="increment-success" on:click={() => update('success')}>Increment (success)</button>
<button class="increment-invalid" on:click={() => update('failure')}>Increment (invalid)</button>
<button class="invalidateAll" on:click={invalidateAll}>Invalidate</button>
<button class="redirect" on:click={redirect}>Redirect</button>
<button class="error" on:click={error}>Error</button>
<a href="/actions/enhance">To enhance</a>

```


####### packages/kit/test/apps/basics/src/routes/adapter/dynamic/+page.server.js #######

```

export const prerender = false;

export const config = {
	message: 'hello from dynamic page'
};

export function load({ platform }) {
	return {
		platform
	};
}

```


####### packages/kit/test/apps/basics/src/routes/adapter/dynamic/+page.svelte #######

```

<script>
	export let data;
</script>

<pre>{JSON.stringify(data.platform)}</pre>

```


####### packages/kit/test/apps/basics/src/routes/adapter/prerendered/+page.server.js #######

```

export const prerender = true;

export const config = {
	message: 'hello from prerendered page'
};

export function load({ platform }) {
	return {
		platform
	};
}

```


####### packages/kit/test/apps/basics/src/routes/adapter/prerendered/+page.svelte #######

```

<script>
	export let data;
</script>

<pre>{JSON.stringify(data.platform)}</pre>

```


####### packages/kit/test/apps/basics/src/routes/anchor/anchor/+page.svelte #######

```

<div style="height: 180vh; background-color: hotpink;">They (don't) see me...</div>
<div style="height: 180vh; background-color: peru;">
	<p id="go-to-element">The browser scrolls to me</p>
</div>
<div style="height: 180vh; background-color: tomato;">
	<p id="go-to-encöded">The browser scrolls to me</p>
</div>
<div style="height: 180vh; background-color: honeydew;">
	<p id="go-to-.=" class="special-char-id">The browser scrolls to me</p>
</div>

```


####### packages/kit/test/apps/basics/src/routes/anchor/+page.svelte #######

```

<h1>Welcome to a test project</h1>
<a id="scroll-anchor" href="#last-anchor-2">Bottom of this page</a>
<a id="non-ascii-anchor" href="/anchor/anchor#go-to-encöded">Anchor demo (non-ASCII)</a>
<a id="special-char-anchor" href="/anchor/anchor#go-to-.=">Anchor demo (special characters)</a>
<a id="first-anchor" href="/anchor/anchor#go-to-element">Anchor demo (first)</a>
<div>Spacing</div>
<a id="second-anchor" href="/anchor/anchor#go-to-element">Anchor demo (second)</a>
<div>Spacing</div>
<a id="third-anchor" href="/anchor/anchor">Anchor demo (third)</a>
<div>Spacing</div>
<a id="last-anchor" href="/anchor/anchor#go-to-element">Anchor demo (last)</a>
<a id="last-anchor-2" href="/anchor/anchor">Anchor demo (last 2)</a>
<a id="routing-page" href="/routing/hashes/target">Different page</a>

<style>
	:global(body) {
		background-color: tan;
		display: flex;
		flex-direction: column;
	}

	a {
		display: block;
		margin: 20px;
	}

	div {
		background-color: hotpink;
		height: 180vh;
	}
</style>

```


####### packages/kit/test/apps/basics/src/routes/anchor-with-manual-scroll/anchor-afternavigate/+page.svelte #######

```

<script>
	import { afterNavigate, disableScrollHandling } from '$app/navigation';

	afterNavigate(() => {
		disableScrollHandling();
		document.getElementById('abcde')?.scrollIntoView();
	});
</script>

<div style="height: 180vh; background-color: hotpink;">They (don't) see me...</div>
<div style="height: 180vh; background-color: peru;">
	<p id="go-to-element">The browser scrolls to me</p>
</div>
<p id="abcde" style="height: 180vh; background-color: hotpink;">I take precedence</p>
<div></div>

<a href="/anchor-with-manual-scroll/anchor-afternavigate?x=y#go-to-element">reload me</a>

```


####### packages/kit/test/apps/basics/src/routes/anchor-with-manual-scroll/anchor-onmount/+page.svelte #######

```

<script>
	import { onMount } from 'svelte';
	import { disableScrollHandling } from '$app/navigation';

	onMount(() => {
		disableScrollHandling();
		document.getElementById('abcde')?.scrollIntoView();
	});
</script>

<div style="height: 180vh; background-color: hotpink;">They (don't) see me...</div>
<div style="height: 180vh; background-color: peru;">
	<p id="go-to-element">The browser scrolls to me</p>
</div>
<p id="abcde" style="height: 180vh; background-color: hotpink;">I take precedence</p>
<div></div>

```


####### packages/kit/test/apps/basics/src/routes/anchor-with-manual-scroll/+page.svelte #######

```

<h1>Welcome to a test project</h1>
<a href="/anchor-with-manual-scroll/anchor-onmount#go-to-element">Anchor demo</a>

<style>
	:global(body) {
		background-color: tan;
		display: flex;
		flex-direction: column;
	}

	a {
		display: block;
		margin: 20px;
	}
</style>

```


####### packages/kit/test/apps/basics/src/routes/answer.json/+server.js #######

```

import { json } from '@sveltejs/kit';

export function GET() {
	return json({ answer: 42 });
}

```


####### packages/kit/test/apps/basics/src/routes/app-environment/+page.svelte #######

```

<script>
	import { version } from '$app/environment';
</script>

<h1>{version}</h1>

```


####### packages/kit/test/apps/basics/src/routes/asset-import/+page.svelte #######

```

<script>
	import small from './small.png';
	import large from './large.jpg';
</script>

<img alt="svelte" src={small} />
<img alt="potatoes" src={large} />

```


####### packages/kit/test/apps/basics/src/routes/caching/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ setHeaders }) {
	setHeaders({
		'cache-control': 'public, max-age=30'
	});
}

```


####### packages/kit/test/apps/basics/src/routes/caching/+page.svelte #######

```

<h1>this page will be cached for 30 seconds</h1>

```


####### packages/kit/test/apps/basics/src/routes/caching/server-data/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export async function load({ setHeaders }) {
	setHeaders({
		'cache-control': 'public, max-age=30'
	});
}

```


####### packages/kit/test/apps/basics/src/routes/caching/server-data/+page.svelte #######

```

<h1>this page's __data.json will be cached for 30 seconds</h1>

```


####### packages/kit/test/apps/basics/src/routes/content-length-header/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/content-type-header/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/cookies/collect-without-re-escaping/+page.js #######

```

import { browser } from '$app/environment';

/** @type {import('@sveltejs/kit').Load}*/
export async function load({ fetch }) {
	if (!browser) {
		// We don't want the client-side collected cookie to clobber the
		// server-side collected cookie that we're actually testing.
		await fetch('/cookies/collect-without-re-escaping/set-cookie');
	}
}

```


####### packages/kit/test/apps/basics/src/routes/cookies/collect-without-re-escaping/+page.svelte #######

```

<script>
	import { browser } from '$app/environment';
</script>

<p>{browser && document.cookie}</p>

```


####### packages/kit/test/apps/basics/src/routes/cookies/collect-without-re-escaping/set-cookie/+server.js #######

```

/** @type {import('@sveltejs/kit').RequestHandler} */
export async function GET() {
	return new Response(null, { headers: { 'set-cookie': 'cookie-special-characters="foo"' } });
}

```


####### packages/kit/test/apps/basics/src/routes/cookies/delete/+server.js #######

```

import { redirect } from '@sveltejs/kit';
import { COOKIE_NAME } from '../shared';

/** @type {import('@sveltejs/kit').RequestHandler} */
export const GET = (event) => {
	event.cookies.delete(COOKIE_NAME, { path: '/cookies' });
	redirect(303, '/cookies');
};

```


####### packages/kit/test/apps/basics/src/routes/cookies/encoding/not-decoded-twice/+server.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').RequestHandler} */
export const GET = (event) => {
	const sneaky = 'teapot%2C%20jane%20austen';
	event.cookies.set('encoding', sneaky, { path: '/cookies/encoding' });
	redirect(303, '/cookies/encoding');
};

```


####### packages/kit/test/apps/basics/src/routes/cookies/encoding/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load(event) {
	return {
		encoding: event.cookies.get('encoding')
	};
}

```


####### packages/kit/test/apps/basics/src/routes/cookies/encoding/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

Cookie: <span id="cookie-value">
	{data.encoding}
</span>

```


####### packages/kit/test/apps/basics/src/routes/cookies/encoding/set/+server.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').RequestHandler} */
export const GET = (event) => {
	const needsEncoding = 'teapot, jane austen';
	event.cookies.set('encoding', needsEncoding, { path: '/cookies/encoding' });
	redirect(303, '/cookies/encoding');
};

```


####### packages/kit/test/apps/basics/src/routes/cookies/enhanced/basic/+page.server.ts #######

```

export const load: import('./$types').PageServerLoad = (event) => {
	const cookie = event.cookies.get('a');
	return { cookie };
};

export const actions: import('./$types').Actions = {
	setTeapot: (event) => {
		event.cookies.set('a', 'teapot', { path: '' });
		return { lastSet: new Date().valueOf() };
	},
	setJaneAusten: (event) => {
		event.cookies.set('a', 'Jane Austen', { path: '' });
		return { lastSet: new Date().valueOf() };
	},
	delete: (event) => {
		event.cookies.delete('a', { path: '' });
		return { lastSet: new Date().valueOf() };
	}
};

```


####### packages/kit/test/apps/basics/src/routes/cookies/enhanced/basic/+page.svelte #######

```

<script>
	import { enhance } from '$app/forms';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

Cookie: <span id="cookie-value">
	{data.cookie}
</span>

<form method="post" action="?/setTeapot" use:enhance>
	<button id="teapot">Set cookie to "teapot"</button>
</form>

<form method="post" action="?/setJaneAusten" use:enhance>
	<button id="janeAusten">Set cookie to "Jane Austen"</button>
</form>

<form method="post" action="?/delete" use:enhance>
	<button id="delete">Delete cookie</button>
</form>

```


####### packages/kit/test/apps/basics/src/routes/cookies/forwarded-in-etag/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load({ cookies }) {
	cookies.set('foo', 'bar', { path: '', httpOnly: false });
}

```


####### packages/kit/test/apps/basics/src/routes/cookies/forwarded-in-etag/+page.svelte #######

```

<script>
	import { onMount } from 'svelte';

	let cookies;

	onMount(() => {
		cookies = document.cookie;
	});
</script>

<button
	on:click={() => {
		document.cookie = 'foo=bar;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
		location.reload();
	}}
>
	Delete cookies and reload the page
</button>

<p>{cookies}</p>

```


####### packages/kit/test/apps/basics/src/routes/cookies/nested/a/+page.server.js #######

```

import { COOKIE_NAME } from '../../shared';

/** @type {import('./$types').PageServerLoad} */
export function load(event) {
	event.cookies.set(COOKIE_NAME, 'teapot', {
		path: ''
	});

	return {
		cookie: event.cookies.get(COOKIE_NAME)
	};
}

```


####### packages/kit/test/apps/basics/src/routes/cookies/nested/a/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

Cookie: <span id="cookie-value">{data.cookie}</span>

```


####### packages/kit/test/apps/basics/src/routes/cookies/nested/b/+page.server.js #######

```

import { COOKIE_NAME } from '../../shared';

/** @type {import('./$types').PageServerLoad} */
export function load(event) {
	return {
		cookie: event.cookies.get(COOKIE_NAME)
	};
}

```


####### packages/kit/test/apps/basics/src/routes/cookies/nested/b/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

Cookie: <span id="cookie-value">{data.cookie}</span>

```


####### packages/kit/test/apps/basics/src/routes/cookies/+page.server.js #######

```

import { COOKIE_NAME } from './shared';

/** @type {import('./$types').PageServerLoad} */
export function load(event) {
	return {
		cookie: event.cookies.get(COOKIE_NAME)
	};
}

```


####### packages/kit/test/apps/basics/src/routes/cookies/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

Cookie: <span id="cookie-value">{data.cookie}</span>

```


####### packages/kit/test/apps/basics/src/routes/cookies/serialize/+server.js #######

```

/** @type {import('@sveltejs/kit').RequestHandler} */
export const GET = ({ cookies }) => {
	const response = new Response('success', {
		status: 200
	});
	response.headers.append('set-cookie', cookies.serialize('endpoint', 'endpoint', { path: '' }));
	return response;
};

```


####### packages/kit/test/apps/basics/src/routes/cookies/set-in-layout/+layout.server.js #######

```

/** @type {import('./$types').LayoutServerLoad} */
export function load(event) {
	event.cookies.set('a', 'i was set in the layout load', { path: '' });
}

```


####### packages/kit/test/apps/basics/src/routes/cookies/set-in-layout/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/apps/basics/src/routes/cookies/set-in-layout/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load(event) {
	return {
		a: event.cookies.get('a')
	};
}

```


####### packages/kit/test/apps/basics/src/routes/cookies/set-in-layout/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

Cookie: <span id="cookie-value">{data.a}</span>

```


####### packages/kit/test/apps/basics/src/routes/cookies/set-more-than-one/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load(event) {
	event.cookies.set('a', 'teapot', { path: '' });
	event.cookies.set('b', 'jane austen', { path: '' });

	return {
		a: event.cookies.get('a'),
		b: event.cookies.get('b')
	};
}

```


####### packages/kit/test/apps/basics/src/routes/cookies/set-more-than-one/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

Cookie: <span id="cookie-value">{data.a} {data.b}</span>

```


####### packages/kit/test/apps/basics/src/routes/cookies/set/+server.js #######

```

import { redirect } from '@sveltejs/kit';
import { COOKIE_NAME } from '../shared';

/** @type {import('@sveltejs/kit').RequestHandler} */
export const GET = (event) => {
	event.cookies.set(COOKIE_NAME, 'teapot', { path: '/cookies' });
	redirect(303, '/cookies');
};

```


####### packages/kit/test/apps/basics/src/routes/cookies/shared.js #######

```

export const COOKIE_NAME = 'cookiesAPITest';

```


####### packages/kit/test/apps/basics/src/routes/csrf/+server.js #######

```

/** @type {import('./$types').RequestHandler} */
export function POST() {
	return new Response(undefined, { status: 201 });
}

```


####### packages/kit/test/apps/basics/src/routes/css/_base.css #######

```

.overridden {
	color: red;
}

```


####### packages/kit/test/apps/basics/src/routes/css/encöded/+page.svelte #######

```

<h1>this should be purple</h1>

<style>
	h1 {
		color: purple;
	}
</style>

```


####### packages/kit/test/apps/basics/src/routes/css/_manual.css #######

```

.not {
	color: blue;
}

```


####### packages/kit/test/apps/basics/src/routes/css/other/+page.svelte #######

```

<h1>other</h1>

```


####### packages/kit/test/apps/basics/src/routes/css/+page.svelte #######

```

<script>
	import './_styles.css';
	import './_manual.css?url';
	import './_manual.css?raw';
	import './_manual.css?inline';
</script>

<div class="styled">this text is red</div>

<div class="also-styled">this text is blue</div>

<div class="overridden">this text is green</div>

<div class="not">this text is black</div>

<a href="/css/other">other</a>

<style>
	.also-styled {
		color: blue;
	}
</style>

```


####### packages/kit/test/apps/basics/src/routes/css/_styles.css #######

```

@import '_base.css';

.styled {
	color: red;
}

.overridden {
	color: green;
}

```


####### packages/kit/test/apps/basics/src/routes/cyclical-dynamic-import/_is_even.js #######

```

export async function is_even(num) {
	const { is_odd } = await import('./_is_odd.js');
	if (num === 0) return true;
	return is_odd(num - 1);
}

```


####### packages/kit/test/apps/basics/src/routes/cyclical-dynamic-import/_is_odd.js #######

```

export async function is_odd(num) {
	const { is_even } = await import('./_is_even.js');
	if (num === 1) return true;
	return is_even(num - 1);
}

```


####### packages/kit/test/apps/basics/src/routes/cyclical-dynamic-import/+page.svelte #######

```

<script>
	import { onMount } from 'svelte';

	onMount(async () => {
		const { is_even } = await import('./_is_even.js');
		console.log(is_even(5));
	});
</script>

```


####### packages/kit/test/apps/basics/src/routes/data-sveltekit/noscroll/+page.svelte #######

```

<div style="height: 2000px; background: palegoldenrod"></div>

<a id="one" href="/data-sveltekit/noscroll/target" data-sveltekit-noscroll>one</a>

<div data-sveltekit-noscroll>
	<a id="two" href="/data-sveltekit/noscroll/target">two</a>
	<a id="three" href="/data-sveltekit/noscroll/target" data-sveltekit-noscroll="off">three</a>
</div>

```


####### packages/kit/test/apps/basics/src/routes/data-sveltekit/noscroll/target/+page.svelte #######

```

<div style="height: 2000px; background: palegoldenrod"></div>

<h1>target</h1>

```


####### packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/offline/+layout.server.js #######

```

export function load({ url }) {
	return {
		url: url.toString()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/offline/+page.svelte #######

```

<a id="one" href="/data-sveltekit/preload-data/offline/target" data-sveltekit-preload-data>target</a
>

<a
	id="slow-navigation"
	href="/data-sveltekit/preload-data/offline/slow-navigation"
	data-sveltekit-preload-data>slow-navigation</a
>

```


####### packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/offline/slow-navigation/+page.server.js #######

```

export async function load() {
	return new Promise((resolve) => {
		setTimeout(resolve, 1000);
	});
}

```


####### packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/offline/slow-navigation/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/offline/target/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/+page.svelte #######

```

<a id="one" href="/data-sveltekit/preload-data/target" data-sveltekit-preload-data>one</a>

<div data-sveltekit-preload-data>
	<a id="two" href="/data-sveltekit/preload-data/target">two</a>
	<a id="three" href="/data-sveltekit/preload-data/target" data-sveltekit-preload-data="off"
		>three</a
	>
</div>

```


####### packages/kit/test/apps/basics/src/routes/data-sveltekit/preload-data/target/+page.svelte #######

```

<h1>this string should only appear in this preloaded file</h1>

```


####### packages/kit/test/apps/basics/src/routes/data-sveltekit/reload/+page.svelte #######

```

<a id="one" href="/data-sveltekit/reload/target" data-sveltekit-reload>one</a>

<div data-sveltekit-reload>
	<a id="two" href="/data-sveltekit/reload/target">two</a>
	<a id="three" href="/data-sveltekit/reload/target" data-sveltekit-reload="off">three</a>
</div>

```


####### packages/kit/test/apps/basics/src/routes/data-sveltekit/reload/target/+page.svelte #######

```

<h1>target</h1>

```


####### packages/kit/test/apps/basics/src/routes/data-sveltekit/replacestate/+page.svelte #######

```

<a id="one" href="/data-sveltekit/replacestate/target" data-sveltekit-replacestate>one</a>

<div data-sveltekit-replacestate>
	<a id="two" href="/data-sveltekit/replacestate/target">two</a>
	<a id="three" href="/data-sveltekit/replacestate/target" data-sveltekit-replacestate="off">
		three
	</a>
</div>

```


####### packages/kit/test/apps/basics/src/routes/data-sveltekit/replacestate/target/+page.svelte #######

```

<h1>target</h1>

```


####### packages/kit/test/apps/basics/src/routes/delete-route/[id].json/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function DELETE(event) {
	return json({
		id: event.params.id
	});
}

```


####### packages/kit/test/apps/basics/src/routes/delete-route/+page.svelte #######

```

<script>
	/** @type {string} */
	let status;

	function del() {
		fetch('delete-route/42.json', { method: 'DELETE' })
			.then((r) => r.json())
			.then(
				({ id }) => (status = `deleted ${id}`),
				(e) => (status = e.toString())
			);
	}
</script>

<button class="del" on:click={del}>delete</button>

{#if status}
	<h1>{status}</h1>
{/if}

```


####### packages/kit/test/apps/basics/src/routes/encoded/endpoint/+server.js #######

```

import { json } from '@sveltejs/kit';

export async function GET() {
	return json({
		fruit: '🍎🍇🍌'
	});
}

```


####### packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/+layout.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>{decodeURIComponent($page.url.pathname.split('/').pop())}</h1>
<slot />

<a href="/encoded/escape-sequences/:-)">:-)</a>
<a href="/encoded/escape-sequences/%23">#</a>
<a href="/encoded/escape-sequences/%2F">/</a>
<a href="/encoded/escape-sequences/%3f">?</a>
<a href="/encoded/escape-sequences/苗">苗</a>
<a href="/encoded/escape-sequences/<">&lt;</a>
<a href="/encoded/escape-sequences/1<2">1&lt;2</a>
<a href="/encoded/escape-sequences/🤪">🤪</a>
<a href="/encoded/escape-sequences/%25">%</a>

```


####### packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[u+82d7]/+page.svelte #######

```

苗

```


####### packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[u+d83e][u+dd2a]/+page.svelte #######

```

🤪

```


####### packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x+23]/+page.svelte #######

```

#

```


####### packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x+25]/+page.svelte #######

```

%

```


####### packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x+2f]/+page.svelte #######

```

/

```


####### packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x+3a]-[x+29]/+page.svelte #######

```

:-)

```


####### packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x+3c]/+page.svelte #######

```

&lt;

```


####### packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x+3f]/+page.svelte #######

```

?

```


####### packages/kit/test/apps/basics/src/routes/encoded/escape-sequences/[x][x+3c][y]/+page.svelte #######

```

1&lt;2

```


####### packages/kit/test/apps/basics/src/routes/encoded/+page.svelte #######

```

<a href="/encoded/苗条">苗条</a>
<a href="/encoded/土豆">土豆</a>
<a href="/encoded/反应">反应</a>
<a href="/encoded/redirect">Redirect</a>
<a href="/encoded/@svelte">@svelte</a>
<a href="/encoded/test%2520me">test%20me</a>
<a href="/encoded/test%252fme">test%2fme</a>
<a href="/encoded/AC%2fDC">AC/DC</a>
<a href="/encoded/%5b">[</a>

```


####### packages/kit/test/apps/basics/src/routes/encoded/redirected/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export function load({ url }) {
	return {
		// nb: .get() on URLSearchParams does a decoding pass, so we should see the raw values.
		embedded: url.searchParams.get('embedded')
	};
}

```


####### packages/kit/test/apps/basics/src/routes/encoded/redirected/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<pre>{data.embedded}</pre>

```


####### packages/kit/test/apps/basics/src/routes/encoded/redirect/+page.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').Load} */
export function load() {
	redirect(307, 'redirected?embedded=' + encodeURIComponent('/苗条?foo=bar&fizz=buzz'));
}

```


####### packages/kit/test/apps/basics/src/routes/encoded/redirect/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/encoded/[slug]/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export function load({ url, params }) {
	return {
		path: url.pathname,
		slug: params.slug
	};
}

```


####### packages/kit/test/apps/basics/src/routes/encoded/[slug]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>dynamic</h1>
<h2>{data.path}: {data.slug}</h2>
<h3>{$page.url.pathname}: {$page.params.slug}</h3>

```


####### packages/kit/test/apps/basics/src/routes/encoded/@[username]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>@{$page.params.username}</h1>

```


####### packages/kit/test/apps/basics/src/routes/encoded/反应/+page.js #######

```

import { redirect } from '@sveltejs/kit';

export function load() {
	redirect(307, encodeURI('苗条'));
}

```


####### packages/kit/test/apps/basics/src/routes/encoded/反应/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/encoded/苗条/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export function load({ url }) {
	return {
		path: url.pathname
	};
}

```


####### packages/kit/test/apps/basics/src/routes/encoded/苗条/+page.svelte #######

```

<script>
	import { page } from '$app/stores';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>static</h1>
<h2>{data.path}</h2>
<h3>{$page.url.pathname}</h3>

```


####### packages/kit/test/apps/basics/src/routes/endpoint-input/sha256/+server.js #######

```

import { createHash } from 'node:crypto';

/** @type {import('@sveltejs/kit').RequestHandler} */
export async function PUT({ request }) {
	const hash = createHash('sha256');
	const reader = request.body.getReader();

	for (;;) {
		const { done, value } = await reader.read();
		if (done) break;
		hash.update(value);
		await new Promise((r) => setTimeout(r, 10));
	}

	return new Response(hash.digest('base64url'));
}

```


####### packages/kit/test/apps/basics/src/routes/endpoint-output/body/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').RequestHandler} */
export function GET() {
	return json({});
}

```


####### packages/kit/test/apps/basics/src/routes/endpoint-output/fallback/+server.js #######

```

export function GET() {
	return new Response('ok');
}

export function fallback() {
	return new Response('catch-all');
}

```


####### packages/kit/test/apps/basics/src/routes/endpoint-output/head-handler/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/endpoint-output/head-handler/+server.js #######

```

/** @type {import('@sveltejs/kit').RequestHandler} */
export function HEAD() {
	return new Response('', {
		headers: {
			'x-sveltekit-head-endpoint': 'true'
		}
	});
}

```


####### packages/kit/test/apps/basics/src/routes/endpoint-output/head-write-error/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').RequestHandler} */
export function GET({ setHeaders }) {
	setHeaders({
		'x-test': '\u001f'
	});

	return json({});
}

```


####### packages/kit/test/apps/basics/src/routes/endpoint-output/+server.js #######

```

/** @type {import('@sveltejs/kit').RequestHandler} */
export function OPTIONS() {
	return new Response('ok');
}

```


####### packages/kit/test/apps/basics/src/routes/endpoint-output/stream/+server.js #######

```

import { createHash, randomBytes } from 'node:crypto';

/** @type {import('@sveltejs/kit').RequestHandler} */
export function GET() {
	const data = randomBytes(1024 * 256);
	const digest = createHash('sha256').update(data).digest('base64url');

	let length = 0;

	return new Response(
		new ReadableStream(
			{
				pull(controller) {
					const offset = data.byteOffset + length;
					const chunk =
						data.byteLength - length > controller.desiredSize
							? new Uint8Array(data.buffer, offset, controller.desiredSize)
							: new Uint8Array(data.buffer, offset);

					controller.enqueue(chunk);

					length += chunk.byteLength;

					if (length >= data.byteLength) {
						controller.close();
					}
				}
			},
			{ highWaterMark: 1024 * 16 }
		),
		{
			headers: {
				'content-type': 'application/octet-stream',
				digest: `sha-256=${digest}`
			}
		}
	);
}

```


####### packages/kit/test/apps/basics/src/routes/endpoint-output/stream-throw-error/+server.js #######

```

/** @type {import('@sveltejs/kit').RequestHandler} */
export function GET() {
	return new Response(
		new ReadableStream({
			pull() {
				throw Error('simulate error');
			}
		}),
		{
			headers: {
				'content-type': 'application/octet-stream'
			}
		}
	);
}

```


####### packages/kit/test/apps/basics/src/routes/endpoint-output/stream-typeerror/+server.js #######

```

let errorName = 'null';

/** @type {import('@sveltejs/kit').RequestHandler} */
export function GET({ url }) {
	if (url.searchParams.has('what')) {
		const body = errorName;
		errorName = 'null';
		return new Response(body);
	}

	return new Response(
		new ReadableStream({
			pull(controller) {
				controller.enqueue(42);
			},

			cancel(reason) {
				errorName = reason?.name;
			}
		}),
		{
			headers: {
				'content-type': 'application/octet-stream'
			}
		}
	);
}

```


####### packages/kit/test/apps/basics/src/routes/env/includes/+page.server.js #######

```

import { PRIVATE_STATIC } from '$env/static/private';
import { env } from '$env/dynamic/private';

export function load() {
	return {
		PRIVATE_STATIC,
		PRIVATE_DYNAMIC: env.PRIVATE_DYNAMIC
	};
}

```


####### packages/kit/test/apps/basics/src/routes/env/includes/+page.svelte #######

```

<script>
	import { PUBLIC_STATIC } from '$env/static/public';
	import { env } from '$env/dynamic/public';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<p id="static-private">PRIVATE_STATIC: {data.PRIVATE_STATIC}</p>
<p id="dynamic-private">PRIVATE_DYNAMIC: {data.PRIVATE_DYNAMIC}</p>

<p id="static-public">PUBLIC_STATIC: {PUBLIC_STATIC}</p>
<p id="dynamic-public">PUBLIC_DYNAMIC: {env.PUBLIC_DYNAMIC}</p>

```


####### packages/kit/test/apps/basics/src/routes/env/+page.svelte #######

```

<a href="/env/includes">Includes</a>

```


####### packages/kit/test/apps/basics/src/routes/errors/clientside/+page.svelte #######

```

<script>
	import { browser } from '$app/environment';

	if (browser) {
		throw new Error('Crashing now');
	}
</script>

```


####### packages/kit/test/apps/basics/src/routes/errors/endpoint.json/+server.js #######

```

export function GET() {
	throw new Error('nope');
}

```


####### packages/kit/test/apps/basics/src/routes/errors/endpoint/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const res = await fetch('/errors/endpoint.json');
	if (res.ok) {
		return await res.json();
	} else {
		throw new Error(String(res.status));
	}
}

```


####### packages/kit/test/apps/basics/src/routes/errors/endpoint/+page.svelte #######

```

<h1>this text should not appear</h1>

```


####### packages/kit/test/apps/basics/src/routes/errors/endpoint-shadow-not-ok/+page.server.js #######

```

import { error } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').RequestHandler} */
export function load() {
	error(555, undefined);
}

```


####### packages/kit/test/apps/basics/src/routes/errors/endpoint-shadow-not-ok/+page.svelte #######

```

<h1>this text should not appear</h1>

```


####### packages/kit/test/apps/basics/src/routes/errors/endpoint-shadow/+page.server.js #######

```

/** @type {import('@sveltejs/kit').RequestHandler} */
export function load() {
	throw new Error('nope');
}

```


####### packages/kit/test/apps/basics/src/routes/errors/endpoint-shadow/+page.svelte #######

```

<h1>this text should not appear</h1>

```


####### packages/kit/test/apps/basics/src/routes/errors/endpoint-throw-error/+server.js #######

```

import { error } from '@sveltejs/kit';

export function GET() {
	error(401, 'You shall not pass');
}

```


####### packages/kit/test/apps/basics/src/routes/errors/endpoint-throw-redirect/+server.js #######

```

import { redirect } from '@sveltejs/kit';

export function GET() {
	redirect(302, '/');
}

```


####### packages/kit/test/apps/basics/src/routes/errors/error-html/make-root-fail/+server.js #######

```

/**
 * @type {import('./$types').RequestHandler} param0
 */
export function GET({ cookies, url }) {
	cookies.set('fail-type', url.searchParams.get('type'), { path: '/' });
	return new Response();
}

```


####### packages/kit/test/apps/basics/src/routes/errors/error-html/+page.svelte #######

```

<script>
	/** @param {string} type */
	async function fail(type) {
		await fetch(`/errors/error-html/make-root-fail?type=${type}`);
		if (type === 'redirect') {
			location.assign(location.href + '/404');
		} else {
			location.reload();
		}
	}
</script>

<button on:click={() => fail('unexpected')}>Unexpected</button>
<button on:click={() => fail('expected')}>Expected</button>
<button on:click={() => fail('redirect')}>Redirect</button>

```


####### packages/kit/test/apps/basics/src/routes/errors/error-in-handle/+page.svelte #######

```

<!-- this will never be rendered, because hooks.js will throw an error for this path -->

```


####### packages/kit/test/apps/basics/src/routes/errors/error-in-layout/+page.svelte #######

```

<h1>hello</h1>

```


####### packages/kit/test/apps/basics/src/routes/errors/init-error-endpoint/+server.js #######

```

import { building } from '$app/environment';
import { json } from '@sveltejs/kit';

if (!building) {
	// @ts-expect-error
	thisvariableisnotdefined;
}

export function GET() {
	return json({
		answer: 42
	});
}

```


####### packages/kit/test/apps/basics/src/routes/errors/invalid-load-response/+page.js #######

```

export function load() {
	return ['nope'];
}

```


####### packages/kit/test/apps/basics/src/routes/errors/invalid-load-response/+page.svelte #######

```

<!-- this will never be rendered, load function returns something invalid -->

```


####### packages/kit/test/apps/basics/src/routes/errors/invalid-route-response/+server.js #######

```

export function GET() {
	return 'this ought to be an object';
}

```


####### packages/kit/test/apps/basics/src/routes/errors/invalid-server-load-response/+page.server.js #######

```

export function load() {
	return ['nope'];
}

```


####### packages/kit/test/apps/basics/src/routes/errors/invalid-server-load-response/+page.svelte #######

```

<!-- this will never be rendered, load function returns something invalid -->

```


####### packages/kit/test/apps/basics/src/routes/errors/+layout.js #######

```

import { error } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch, url }) {
	if (url.pathname.startsWith('/errors/error-in-layout')) {
		const res = await fetch('/errors/error-in-layout/non-existent');
		error(/** @type {404} */ (res.status));
	}
}

```


####### packages/kit/test/apps/basics/src/routes/errors/+layout.svelte #######

```

<slot />;

```


####### packages/kit/test/apps/basics/src/routes/errors/load-client/+page.js #######

```

import { browser } from '$app/environment';

/** @type {import('@sveltejs/kit').Load} */
export async function load() {
	if (browser) {
		throw new Error('Crashing now');
	}

	return {};
}

```


####### packages/kit/test/apps/basics/src/routes/errors/load-client/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/errors/load-error-client/+page.js #######

```

import { error } from '@sveltejs/kit';

/** @type {import('./$types').PageLoad} */
export async function load() {
	if (typeof window !== 'undefined') {
		error(555, 'Not found');
	}

	return {};
}

```


####### packages/kit/test/apps/basics/src/routes/errors/load-error-client/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/errors/load-error-server/+page.js #######

```

import { error } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').Load} */
export async function load() {
	error(555, 'Not found');
}

```


####### packages/kit/test/apps/basics/src/routes/errors/load-error-server/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/errors/load-error-string-server/+page.js #######

```

import { error } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').Load} */
export async function load() {
	error(555, 'Not found');
}

```


####### packages/kit/test/apps/basics/src/routes/errors/load-error-string-server/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/errors/load-server/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load() {
	throw new Error('Crashing now');
}

```


####### packages/kit/test/apps/basics/src/routes/errors/load-server/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/errors/load-status-without-error-client/+page.js #######

```

import { error } from '@sveltejs/kit';

export async function load() {
	if (typeof window !== 'undefined') {
		error(401, undefined);
	}
	return {};
}

```


####### packages/kit/test/apps/basics/src/routes/errors/load-status-without-error-client/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/errors/missing-actions/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/errors/module-scope-client/+page.svelte #######

```

<script context="module">
	import { browser } from '$app/environment';

	if (browser) {
		throw new Error('Crashing now');
	}
</script>

```


####### packages/kit/test/apps/basics/src/routes/errors/module-scope-server/+page.svelte #######

```

<script context="module">
	import { dev } from '$app/environment';

	if (dev) {
		// can't throw in prod, the app won't start at all
		throw new Error('Crashing now');
	}
</script>

```


####### packages/kit/test/apps/basics/src/routes/errors/nested-error-page/+error.svelte #######

```

<script>
	import { page } from '$app/stores';

	let answer = 42; // TODO migration leftover, was returned from load previously
</script>

<h1>Nested error page</h1>
<p id="nested-error-status">status: {$page.status}</p>
<p id="nested-error-message">error.message: {$page.error && $page.error.message}</p>
<p id="nested-error-loaded">answer: {answer}</p>

<style>
	h1 {
		color: blue;
	}
</style>

```


####### packages/kit/test/apps/basics/src/routes/errors/nested-error-page/nope/+page.js #######

```

export async function load() {
	throw new Error('nope');
}

```


####### packages/kit/test/apps/basics/src/routes/errors/nested-error-page/nope/+page.svelte #######

```

<h1>should not see this</h1>

```


####### packages/kit/test/apps/basics/src/routes/errors/nested-error-page/+page.svelte #######

```

<a href="/errors/nested-error-page/nope">nope</a>

```


####### packages/kit/test/apps/basics/src/routes/errors/page-endpoint/+error.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<pre>{JSON.stringify(
		{
			status: $page.status,
			...$page.error
		},
		null,
		'  '
	)}</pre>

```


####### packages/kit/test/apps/basics/src/routes/errors/page-endpoint/get-explicit/+page.server.js #######

```

import { error } from '@sveltejs/kit';

export const load = () => {
	error(400, 'oops');
};

```


####### packages/kit/test/apps/basics/src/routes/errors/page-endpoint/get-explicit/+page.svelte #######

```

<h1>if you see this something went wrong</h1>

```


####### packages/kit/test/apps/basics/src/routes/errors/page-endpoint/get-implicit/+page.server.js #######

```

import { FancyError } from '../_shared.js';

export const load = () => {
	throw new FancyError('oops');
};

```


####### packages/kit/test/apps/basics/src/routes/errors/page-endpoint/get-implicit/+page.svelte #######

```

<h1>if you see this something went wrong</h1>

```


####### packages/kit/test/apps/basics/src/routes/errors/page-endpoint/+page.svelte #######

```

<a id="get-implicit" href="/errors/page-endpoint/get-implicit">GET (implicit)</a>
<a id="get-explicit" href="/errors/page-endpoint/get-explicit">GET (explicit)</a>

<form action="/errors/page-endpoint/post-implicit" method="post">
	<button type="submit" id="post-implicit">POST (implicit)</button>
</form>

<form action="/errors/page-endpoint/post-explicit" method="post">
	<button type="submit" id="post-explicit">POST (explicit)</button>
</form>

```


####### packages/kit/test/apps/basics/src/routes/errors/page-endpoint/post-explicit/+page.server.js #######

```

import { error } from '@sveltejs/kit';

/** @type {import('./$types').Actions} */
export const actions = {
	default: () => {
		error(400, 'oops');
	}
};

```


####### packages/kit/test/apps/basics/src/routes/errors/page-endpoint/post-explicit/+page.svelte #######

```

<h1>if you see this something went wrong</h1>

```


####### packages/kit/test/apps/basics/src/routes/errors/page-endpoint/post-implicit/+page.server.js #######

```

import { FancyError } from '../_shared.js';

/** @type {import('./$types').Actions} */
export const actions = {
	default: () => {
		throw new FancyError('oops');
	}
};

```


####### packages/kit/test/apps/basics/src/routes/errors/page-endpoint/post-implicit/+page.svelte #######

```

<h1>if you see this something went wrong</h1>

```


####### packages/kit/test/apps/basics/src/routes/errors/page-endpoint/_shared.js #######

```

export class FancyError extends Error {
	name = 'FancyError';
	fancy = true;

	constructor(message, options) {
		super(message, options);
	}
}

```


####### packages/kit/test/apps/basics/src/routes/errors/serverside/+page.svelte #######

```

<script>
	import { dev } from '$app/environment';

	if (dev) {
		// can't throw in prod, the app won't start at all
		throw new Error('Crashing now');
	}
</script>

```


####### packages/kit/test/apps/basics/src/routes/errors/stack-trace/_bad.js #######

```

const bad = foo().toUpperCase();
export default bad;

// @ts-expect-error
/** @returns {string} */
function foo() {}

```


####### packages/kit/test/apps/basics/src/routes/errors/stack-trace/+page.svelte #######

```

<script>
	import bad from './_bad.js';
</script>

<h1>{bad}</h1>

```


####### packages/kit/test/apps/basics/src/routes/+error.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<svelte:head>
	<title>Custom error page: {$page.error.message}</title>
</svelte:head>

<h1>{$page.status}</h1>

<p id="message">This is your custom error page saying: "<b>{$page.error.message}</b>"</p>

<style>
	h1,
	p {
		margin: 0 auto;
	}

	h1 {
		font-size: 2.8em;
		font-weight: 700;
		margin: 0 0 0.5em 0;
		color: red;
	}

	p {
		margin: 1em auto;
	}

	@media (min-width: 480px) {
		h1 {
			font-size: 4em;
		}
	}
</style>

```


####### packages/kit/test/apps/basics/src/routes/favicon.ico/+server.js #######

```

import { json } from '@sveltejs/kit';

export function GET() {
	return json({
		surprise: 'lol'
	});
}

```


####### packages/kit/test/apps/basics/src/routes/goto/+page.svelte #######

```

<script>
	import { goto } from '$app/navigation';

	let message = '...';
</script>

<button
	on:click={async () => {
		try {
			await goto('https://example.com');
		} catch (e) {
			message = e.message;
		}
	}}>goto</button
>

<p>{message}</p>

```


####### packages/kit/test/apps/basics/src/routes/headers/class/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const res = await fetch('/headers/echo', {
		headers: new Headers({ foo: 'bar' })
	});

	const { foo } = await res.json();
	return {
		foo
	};
}

```


####### packages/kit/test/apps/basics/src/routes/headers/class/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<p>{data.foo}</p>

```


####### packages/kit/test/apps/basics/src/routes/headers/echo/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').RequestHandler} */
export function GET({ request }) {
	/** @type {Record<string, string>} */
	const headers = {};
	request.headers.forEach((value, key) => {
		if (key !== 'cookie') {
			headers[key] = value;
		}
	});

	return json(headers);
}

```


####### packages/kit/test/apps/basics/src/routes/headers/+page.svelte #######

```

<h1>headers</h1>

```


####### packages/kit/test/apps/basics/src/routes/headers/set-cookie/+layout.server.js #######

```

/** @type {import('./$types').LayoutServerLoad} */
export function load({ cookies }) {
	cookies.set('cookie1', 'value1', {
		path: '/headers/set-cookie',
		secure: false // safari
	});
}

```


####### packages/kit/test/apps/basics/src/routes/headers/set-cookie/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/apps/basics/src/routes/headers/set-cookie/sub/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load({ cookies }) {
	cookies.set('cookie2', 'value2', {
		path: '',
		secure: false // safari
	});
}

```


####### packages/kit/test/apps/basics/src/routes/headers/set-cookie/sub/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/iframes/nested/child/+page.svelte #######

```

<h1>Hello from the child</h1>

```


####### packages/kit/test/apps/basics/src/routes/iframes/nested/parent/+page.svelte #######

```

<iframe title="Child content" src="./child"></iframe>

```


####### packages/kit/test/apps/basics/src/routes/iframes/+page.svelte #######

```

<a href="/iframes/nested/parent">parent</a>

```


####### packages/kit/test/apps/basics/src/routes/immutable-headers/+page.js #######

```

// This file will trigger the vary-header code-path in `src/runtime/server/respond.js`
export function load() {
	return { foo: 'bar' };
}

```


####### packages/kit/test/apps/basics/src/routes/immutable-headers/+server.js #######

```

export const GET = () => {
	const response = new Response('foo');
	// this simulates immutable Response Headers, like those returned by undici
	Object.defineProperty(response.headers, 'append', { value: null });
	Object.defineProperty(response.headers, 'set', { value: null });
	return response;
};

```


####### packages/kit/test/apps/basics/src/routes/imports/markdown/+page.svelte #######

```

<script>
	import { marked } from 'marked';
</script>

<main>{@html marked('this is some **markdown**')}</main>

```


####### packages/kit/test/apps/basics/src/routes/imports/+page.svelte #######

```

<a href="/imports/markdown">markdown</a>

```


####### packages/kit/test/apps/basics/src/routes/index.css #######

```

/* https://github.com/sveltejs/kit/issues/3997 */
h1 {
	color: blue;
}

```


####### packages/kit/test/apps/basics/src/routes/interactivity/toggle-element/+page.svelte #######

```

<script>
	let visible = true;

	function toggle() {
		visible = !visible;
	}
</script>

{#if visible}
	<button on:click={toggle}>remove</button>

	<!-- svelte-ignore a11y-missing-attribute a11y-click-events-have-key-events a11y-no-static-element-interactions -->
	<a on:click={toggle}>remove</a>
{:else}
	<button on:click={toggle}>add</button>

	<!-- svelte-ignore a11y-missing-attribute a11y-click-events-have-key-events a11y-no-static-element-interactions -->
	<a on:click={toggle}>add</a>
{/if}

```


####### packages/kit/test/apps/basics/src/routes/keepfocus/+page.svelte #######

```

<script>
	import { goto } from '$app/navigation';
	import { page } from '$app/stores';
</script>

<input
	id="input"
	type="text"
	value={$page.url.searchParams.get('foo')}
	on:input={(e) => {
		goto('?foo=' + e.currentTarget?.value, { keepFocus: true });
	}}
/>

```


####### packages/kit/test/apps/basics/src/routes/+layout.js #######

```

/** @type {import('./$types').LayoutLoad} */
export async function load() {
	// Do NOT make this load function depend on something which would cause it to rerun
	return {
		foo: {
			bar: 'Custom layout'
		}
	};
}

```


####### packages/kit/test/apps/basics/src/routes/+layout.server.js #######

```

import { error, redirect } from '@sveltejs/kit';
import { SOME_JSON } from '$env/static/private';

// https://github.com/sveltejs/kit/issues/8646
if (JSON.parse(SOME_JSON).answer !== 42) {
	throw new Error('failed to parse env var');
}

/** @type {import('./$types').LayoutServerLoad} */
export async function load({ cookies, locals, fetch }) {
	if (locals.url?.pathname === '/non-existent-route') {
		await fetch('/prerendering/prerendered-endpoint/api').then((r) => r.json());
	}

	if (locals.url?.pathname === '/non-existent-route-loop') {
		await fetch('/non-existent-route-loop');
	}

	const should_fail = cookies.get('fail-type');
	if (should_fail) {
		cookies.delete('fail-type', { path: '/' });
		if (should_fail === 'expected') {
			error(401, 'Not allowed');
		} else if (should_fail === 'unexpected') {
			throw new Error('Failed to load');
		} else {
			redirect(307, '/load');
		}
	}
	// Do NOT make this load function depend on something which would cause it to rerun
	return {
		rootlayout: 'rootlayout'
	};
}

```


####### packages/kit/test/apps/basics/src/routes/+layout.svelte #######

```

<script>
	import { setup } from '../../../../setup.js';

	/** @type {import('./$types').LayoutData} */
	export let data;

	setup();
</script>

<slot />

<footer>{data.foo.bar}</footer>

<style>
	footer {
		color: purple;
	}
</style>

```


####### packages/kit/test/apps/basics/src/routes/load/accumulated/+page.svelte #######

```

<a href="/load/accumulated/with-page-data">with page data</a>
<a href="/load/accumulated/without-page-data">without page data</a>

```


####### packages/kit/test/apps/basics/src/routes/load/accumulated/without-page-data/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>foo.bar: {data.foo.bar}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/accumulated/with-page-data/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export function load() {
	return {
		pagedata: 'pagedata'
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/accumulated/with-page-data/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>foo.bar: {data.foo.bar}</h1>
<h2>pagedata: {data.pagedata}</h2>

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/bust/count/+server.js #######

```

import { json } from '@sveltejs/kit';
import { count } from '../state.js';

export function GET({ setHeaders }) {
	setHeaders({ 'cache-control': 'public, max-age=4', age: '2' });
	return json({ count });
}

export function POST() {
	return new Response();
}

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/bust/increment/+server.js #######

```

import { json } from '@sveltejs/kit';
import { increment } from '../state.js';

export function GET() {
	increment();
	return json({});
}

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/bust/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ fetch }) {
	const resp = await fetch('/load/cache-control/bust/count');
	return resp.json();
}

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/bust/+page.svelte #######

```

<script>
	import { invalidate } from '$app/navigation';

	/** @type {import('./$types').PageData} */
	export let data;

	async function update() {
		await fetch('/load/cache-control/bust/increment');
		await fetch('/load/cache-control/bust/count', { method: 'POST' });
		invalidate('/load/cache-control/bust/count');
	}
</script>

<p>Count is {data.count}</p>
<button on:click={update}>update</button>

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/bust/state.js #######

```

export let count = 0;

export function increment() {
	return count++;
}

export function reset() {
	count = 0;
}

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/default/count/+server.js #######

```

import { json } from '@sveltejs/kit';
import { count } from '../state.js';

export function GET({ setHeaders }) {
	setHeaders({ 'cache-control': 'public, max-age=4', age: '2' });
	return json({ count });
}

export function POST() {
	return new Response();
}

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/default/increment/+server.js #######

```

import { json } from '@sveltejs/kit';
import { increment } from '../state.js';

export function GET() {
	increment();
	return json({});
}

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/default/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ fetch }) {
	const resp = await fetch('/load/cache-control/default/count');
	return resp.json();
}

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/default/+page.svelte #######

```

<script>
	import { invalidate } from '$app/navigation';

	/** @type {import('./$types').PageData} */
	export let data;

	async function update() {
		await fetch('/load/cache-control/default/increment');
		invalidate('/load/cache-control/default/count');
	}
</script>

<p>Count is {data.count}</p>
<button on:click={update}>update</button>

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/default/state.js #######

```

export let count = 0;

export function increment() {
	return count++;
}

export function reset() {
	count = 0;
}

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/force/count/+server.js #######

```

import { json } from '@sveltejs/kit';
import { count } from '../state.js';

export function GET({ setHeaders }) {
	setHeaders({ 'cache-control': 'public, max-age=4', age: '2' });
	return json({ count });
}

export function POST() {
	return new Response();
}

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/force/increment/+server.js #######

```

import { json } from '@sveltejs/kit';
import { increment } from '../state.js';

export function GET() {
	increment();
	return json({});
}

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/force/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ fetch }) {
	const resp = await fetch('/load/cache-control/force/count', { cache: 'no-cache' });
	return resp.json();
}

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/force/+page.svelte #######

```

<script>
	import { invalidate } from '$app/navigation';

	/** @type {import('./$types').PageData} */
	export let data;

	async function update() {
		await fetch('/load/cache-control/force/increment');
		invalidate('/load/cache-control/force/count');
	}
</script>

<p>Count is {data.count}</p>
<button on:click={update}>update</button>

```


####### packages/kit/test/apps/basics/src/routes/load/cache-control/force/state.js #######

```

export let count = 0;

export function increment() {
	return count++;
}

export function reset() {
	count = 0;
}

```


####### packages/kit/test/apps/basics/src/routes/load/change-detection/data.json/+server.js #######

```

import { json } from '@sveltejs/kit';

export function GET() {
	return json({
		type: 'layout'
	});
}

```


####### packages/kit/test/apps/basics/src/routes/load/change-detection/+layout.js #######

```

let count = 0;

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch, depends }) {
	const res = await fetch('/load/change-detection/data.json');
	const { type } = await res.json();

	count += 1;

	depends('custom:change-detection-layout');

	return {
		type,
		loads: count
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/change-detection/+layout.svelte #######

```

<script>
	/** @type {import('./$types').LayoutData} */
	export let data;
</script>

<h1>{data.type} loads: {data.loads}</h1>
<slot />

```


####### packages/kit/test/apps/basics/src/routes/load/change-detection/one/[x]/+page.js #######

```

import { browser } from '$app/environment';

let count = 0;

/** @type {import('@sveltejs/kit').Load} */
export async function load({ params, setHeaders }) {
	if (browser) {
		count += 1;
	}

	// Using setHeader has no effect on the client; testing that here
	setHeaders({
		'cache-control': 'public, max-age=5'
	});
	return {
		x: params.x,
		loads: count
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/change-detection/one/[x]/+page.svelte #######

```

<script>
	import { invalidate, invalidateAll } from '$app/navigation';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h2>x: {data.x}: {data.loads}</h2>

<button
	on:click={async () => {
		window.invalidated = false;
		await invalidate((url) => url.pathname.includes('change-detection/data.json'));
		window.invalidated = true;
	}}>invalidate change-detection/data.json</button
>

<button
	on:click={async () => {
		window.invalidated = false;
		await invalidateAll();
		window.invalidated = true;
	}}>invalidate all</button
>

```


####### packages/kit/test/apps/basics/src/routes/load/change-detection/two/[y]/+page.js #######

```

let count = 0;

/** @type {import('@sveltejs/kit').Load} */
export async function load({ params, setHeaders }) {
	count += 1;

	setHeaders({
		'cache-control': 'max-age=5'
	});
	return {
		y: params.y,
		loads: count
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/change-detection/two/[y]/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h2>y: {data.y}: {data.loads}</h2>

```


####### packages/kit/test/apps/basics/src/routes/load/devalue/+page.svelte #######

```

<a href="/load/devalue/regex">/load/devalue/regex</a>

```


####### packages/kit/test/apps/basics/src/routes/load/devalue/regex/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load() {
	return {
		regex: /hello/
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/devalue/regex/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.regex.test('hello')}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/dynamic-import-styles/+page.js #######

```

export async function load() {
	return {
		Thing: (await import('./_/Thing.svelte')).default
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/dynamic-import-styles/+page.svelte #######

```

<script>
	export let data;
</script>

<svelte:component this={data.Thing} />

```


####### packages/kit/test/apps/basics/src/routes/load/dynamic-import-styles/_/Thing.svelte #######

```

<p id="thing">this text is red</p>

<style>
	p {
		color: red;
	}
</style>

```


####### packages/kit/test/apps/basics/src/routes/load/[dynamic].json/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').RequestHandler} */
export function GET({ params }) {
	return json({
		name: params.dynamic
	});
}

```


####### packages/kit/test/apps/basics/src/routes/load/[dynamic]/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ params, fetch }) {
	const res = await fetch(`/load/${params.dynamic}.json`);
	return await res.json();
}

```


####### packages/kit/test/apps/basics/src/routes/load/[dynamic]/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.name}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-arraybuffer-b64/data/+server.js #######

```

export const GET = () => {
	return new Response(new Uint8Array([1, 2, 3, 4]));
};

export const POST = async ({ request }) => {
	return new Response(await request.arrayBuffer());
};

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-arraybuffer-b64/+page.js #######

```

export async function load({ fetch }) {
	const res = await fetch('/load/fetch-arraybuffer-b64/data');

	const l = await fetch('/load/fetch-arraybuffer-b64/data', {
		body: Uint8Array.from(Array(256).fill(0), (_, i) => i),
		method: 'POST'
	});

	return {
		data: await res.arrayBuffer(),
		data_long: await l.arrayBuffer()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-arraybuffer-b64/+page.svelte #######

```

<script>
	export let data;

	$: arr = [...new Uint8Array(data.data)];

	let ok = 'Ok';

	$: {
		const p = new Uint8Array(data.data_long);
		ok = p.length === 256 ? 'Ok' : 'Wrong length';

		if (p.length === 256) {
			for (let i = 0; i < p.length; i++) {
				if (p[i] !== i) {
					ok = `Expected ${i} but got ${p[i]}`;
					break;
				}
			}
		}
	}
</script>

<span class="test-content">{JSON.stringify(arr)}</span>

<br />

{ok}
<span style="word-wrap: break-word;">
	{JSON.stringify([...new Uint8Array(data.data_long)])}
</span>

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/headers-diff/+page.js #######

```

export async function load({ fetch, url }) {
	const r1 = await fetch(url.pathname, {
		headers: {
			'x-foo': 'a'
		}
	}).then((r) => r.json());

	const r2 = await fetch(url.pathname, {
		headers: {
			'x-foo': 'b'
		}
	}).then((r) => r.json());

	return {
		a: r1,
		b: r2
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/headers-diff/+page.svelte #######

```

<script>
	export let data;
</script>

<a href="/load/fetch-cache-control">fetch-cache-control</a>

<h2>{data.a.foo} / {data.b.foo}</h2>

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/headers-diff/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export async function GET({ request, setHeaders }) {
	setHeaders({
		'cache-control': 'public, max-age=7'
	});

	return json({
		foo: request.headers.get('x-foo')
	});
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/load-data/+page.js #######

```

export async function load(event) {
	const url = '/load/fetch-cache-control/load-data';

	const res_fr = await event.fetch(url, {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json'
		},
		body: JSON.stringify({ lang: 'fr' })
	});
	const fr = await res_fr.json();

	const res_hu = await event.fetch(url, {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json'
		},
		body: JSON.stringify({ lang: 'hu' })
	});

	const hu = await res_hu.json();

	return { fr, hu };
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/load-data/+page.svelte #######

```

<script>
	export let data;
	$: ({ fr, hu } = data);
</script>

<a href="/load/fetch-cache-control">fetch-cache-control</a>

<h2>fr</h2>
<div id="fr">
	{JSON.stringify(fr)}
</div>

<h2>hu</h2>
<div id="hu">
	{JSON.stringify(hu)}
</div>

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/load-data/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export async function POST({ request, setHeaders }) {
	setHeaders({
		'cache-control': 'public, max-age=7'
	});

	try {
		const { lang } = await request.json();
		if (lang === 'fr') {
			return json({ hi: 'bonjour' });
		} else if (lang === 'hu') {
			return json({ hi: 'szia' });
		}
	} catch (error) {}

	// default to english
	return json({ hi: 'hello' });
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-cache-control/+page.svelte #######

```

<a href="/load/fetch-cache-control/load-data">load-data</a>

<a href="/load/fetch-cache-control/headers-diff">headers-diff</a>

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-credentialed.json/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function GET(event) {
	return json({
		name: event.locals.name ?? 'Fail'
	});
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-credentialed/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const res = await fetch('/load/fetch-credentialed.json');

	/** @type {any} */
	const { name } = await res.json();

	return {
		name
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-credentialed/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>Hello {data.name}!</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-external-no-cookies/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ fetch, url }) {
	const port = url.searchParams.get('port');
	const res = await fetch(`http://localhost:${port}`);

	return await res.json();
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-external-no-cookies/+page.svelte #######

```

<h1>hello</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-origin-external/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ fetch, url }) {
	const port = url.searchParams.get('port');
	const res = await fetch(`http://localhost:${port}`);

	const { origin } = await res.json();
	return { origin };
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-origin-external/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>origin: {data.origin}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-origin-internal/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ fetch }) {
	const res = await fetch('/load/fetch-origin-internal/resource', {
		method: 'POST'
	});

	const { origin } = await res.json();

	return { origin };
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-origin-internal/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>origin: {data.origin}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-origin-internal/resource/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function POST({ request }) {
	const origin = request.headers.get('origin');
	return json({ origin });
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-relative.json/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function GET() {
	return json({
		answer: 42
	});
}

/** @type {import('./$types').RequestHandler} */
export async function POST({ request }) {
	return json({
		question: await request.text()
	});
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-relative/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const get = await fetch('fetch-relative.json');
	const post = await fetch('fetch-relative.json', { method: 'post', body: '?' });

	return { ...(await get.json()), ...(await post.json()) };
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-relative/+page.svelte #######

```

<script>
	export let data;
</script>

<h1>the answer is {data.answer}</h1>
<h2>the question was {data.question}</h2>

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-request-headers/data/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function GET({ request }) {
	return json(Object.fromEntries(request.headers));
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-request-headers/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const res = await fetch('/load/fetch-request-headers/data');

	return {
		headers: await res.json()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-request-headers/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;

	const json = JSON.stringify({
		accept: data.headers['accept'],
		'accept-language': data.headers['accept-language'],
		connection: data.headers['connection'],
		'sec-fetch-dest': data.headers['sec-fetch-dest'],
		'sec-fetch-mode': data.headers['sec-fetch-mode'],
		'if-none-match': data.headers['if-none-match'],
		referer: data.headers['referer']
	});
</script>

<pre>{json}</pre>

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-request.json/+server.js #######

```

import { json } from '@sveltejs/kit';

export function GET() {
	return json({
		answer: 42
	});
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-request/+page.js #######

```

import { browser } from '$app/environment';

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const url = '/load/fetch-request.json';

	// this is contrived, but saves us faffing about with node-fetch here
	const resource = browser ? new Request(url) : url;

	const res = await fetch(resource);
	const { answer } = await res.json();

	return { answer };
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-request/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>the answer is {data.answer}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-response-headers.json/+server.js #######

```

/** @type {import('./$types').RequestHandler} */
export function GET() {
	return new Response('ok', {
		headers: {
			'x-foo': 'this should not appear'
		}
	});
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-response-headers/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ fetch }) {
	const response = await fetch('/load/fetch-response-headers.json');

	return {
		message: await response.text(),
		foo: response.headers.get('x-foo')
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/fetch-response-headers/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.message}</h1>
<h2>{data.foo}</h2>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/depends/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export function load({ data, depends }) {
	depends('invalidate-depends:shared');
	return {
		shared: new Date().getTime(),
		...data
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/depends/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load({ depends }) {
	depends('invalidate-depends:server');
	return {
		server: new Date().getTime()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/depends/+page.svelte #######

```

<script>
	import { invalidate } from '$app/navigation';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<p class="shared">{data.shared}</p>
<button
	type="button"
	class="shared"
	on:click={() => (window.promise = invalidate('invalidate-depends:shared'))}
>
	invalidate shared
</button>

<p class="server">{data.server}</p>
<button
	type="button"
	class="server"
	on:click={() => (window.promise = invalidate('invalidate-depends:server'))}
>
	invalidate server
</button>

<p class="neither">neither</p>
<button
	type="button"
	class="neither"
	on:click={() => (window.promise = invalidate('invalidate-depends:neither'))}
>
	invalidate neither
</button>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/forced-goto/+layout.server.js #######

```

import { increment } from './state';

export const load = () => {
	return {
		a: increment()
	};
};

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/forced-goto/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/forced-goto/+page.server.js #######

```

import { increment } from './state';

export const load = () => {
	return {
		b: increment()
	};
};

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/forced-goto/+page.svelte #######

```

<script>
	import { invalidateAll, goto } from '$app/navigation';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>a: {data.a}, b: {data.b}</h1>

<button
	class="invalidateall"
	on:click={() => {
		window.promise = invalidateAll();
	}}>invalidate</button
>

<button
	class="goto"
	on:click={() => {
		window.promise = goto('/load/invalidation/forced-goto?test', { invalidateAll: true });
	}}>goto</button
>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/forced-goto/state.js #######

```

let count = 0;

export function increment() {
	return count++;
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/forced/+layout.server.js #######

```

import { increment } from './state';

export const load = () => {
	return {
		a: increment()
	};
};

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/forced/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/forced/+page.server.js #######

```

import { increment } from './state';

export const load = () => {
	return {
		b: increment()
	};
};

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/forced/+page.svelte #######

```

<script>
	import { invalidateAll, goto } from '$app/navigation';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>a: {data.a}, b: {data.b}</h1>

<button
	class="invalidateall"
	on:click={() => {
		window.promise = invalidateAll();
	}}>invalidate</button
>

<button
	class="goto"
	on:click={() => {
		window.promise = goto('/load/invalidation/forced?test', { invalidateAll: true });
	}}>goto</button
>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/forced/state.js #######

```

let count = 0;

export function increment() {
	return count++;
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/invalidate-then-goto/+layout.server.js #######

```

/** @type {import('./$types').LayoutServerLoad} */
export function load({ depends }) {
	depends('invalidate-depends:goto');
	return {
		layoutDate: new Date().getTime()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/invalidate-then-goto/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load({ url }) {
	url.searchParams.get('x');
	return {
		pageDate: new Date().getTime()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/invalidate-then-goto/+page.svelte #######

```

<script>
	import { invalidate, goto } from '$app/navigation';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<p class="layout">{data.layoutDate}</p>
<p class="page">{data.pageDate}</p>
<button
	type="button"
	class="invalidate"
	on:click={() => (window.promise = invalidate('invalidate-depends:goto'))}
>
	invalidate
</button>
<button
	type="button"
	class="goto"
	on:click={() => (window.promise = goto('/load/invalidation/invalidate-then-goto?x'))}
>
	goto
</button>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/multiple-batched/+page.js #######

```

export const ssr = false;

let count = 0;

export function load({ depends }) {
	depends('multiple:invalidations-go-brr');
	return { count: count++ };
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/multiple-batched/+page.svelte #######

```

<script>
	import { invalidate } from '$app/navigation';

	export let data;
</script>

<div>
	<button
		id="multiple-batched"
		on:click={(event) => {
			const btn = event.currentTarget;
			invalidate('multiple:invalidations-go-brr');
			invalidate('multiple:invalidations-go-brr');

			Promise.resolve()
				.then(() => invalidate('multiple:invalidations-go-brr'))
				.then(() => {
					btn.dataset.done = 'true';
				});
		}}>{data.count}</button
	>
</div>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/+layout.js #######

```

import { redirect } from '@sveltejs/kit';
import { get } from 'svelte/store';
import { get_layout, redirect_state } from './state';

/** @type {import('./$types').LayoutLoad} */
export function load({ depends }) {
	depends('invalid:layout');

	if (get(redirect_state) === 'running') {
		redirect_state.set('done');
		redirect(307, '/load/invalidation/multiple/redirect');
	}

	return new Promise((resolve) =>
		setTimeout(
			() =>
				resolve({
					count_layout: get_layout(),
					redirect_mode: get(redirect_state)
				}),
			Math.random() * 500
		)
	);
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/+layout.svelte #######

```

<script>
	import { invalidate, invalidateAll } from '$app/navigation';
	import { page } from '$app/stores';
	import { increment_layout, increment_page } from './state';

	/** @param {string} str */
	async function update(str) {
		if (str !== 'page') {
			increment_layout();
		}
		if (str !== 'layout') {
			increment_page();
		}

		if (str === 'all') {
			invalidateAll();
		} else {
			invalidate(`invalid:${str}`);
		}
	}
</script>

<button class="layout" on:click={() => update('layout')}>Invalidate layout</button>
<button class="page" on:click={() => update('page')}>Invalidate page</button>
<button class="all" on:click={() => update('all')}>Invalidate all</button>

<p>layout: {$page.data.count_layout}, page: {$page.data.count_page}</p>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/+page.js #######

```

import { get_page } from './state';

/** @type {import('./$types').PageLoad} */
export function load({ depends }) {
	depends('invalid:page');
	return new Promise((resolve) =>
		setTimeout(
			() =>
				resolve({
					count_page: get_page()
				}),
			Math.random() * 500
		)
	);
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/redirect/+page.js #######

```

import { redirect } from '@sveltejs/kit';
import { redirect_state } from '../state';

/** @type {import('./$types').PageLoad} */
export async function load({ parent }) {
	const { redirect_mode } = await parent();
	if (redirect_mode === 'start') {
		redirect_state.set('running');
		redirect(307, '/load/invalidation/multiple');
	}
	if (redirect_mode === 'running') {
		throw new Error('Shouldnt get redirected here with state "running"');
	}
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/redirect/+page.svelte #######

```

<script>
	import { invalidateAll } from '$app/navigation';
	import { redirect_state } from '../state';

	function redirect() {
		redirect_state.set('start');
		invalidateAll();
	}
</script>

<button class="redirect" on:click={redirect}>redirect</button>
<p class="redirect-state">Redirect state: {$redirect_state}</p>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/multiple/state.js #######

```

import { writable } from 'svelte/store';

let count_layout = 0;
let count_page = 0;

export const redirect_state = writable('initial');

export function increment_layout() {
	count_layout++;
}

export function increment_page() {
	count_page++;
}

export function get_layout() {
	return count_layout;
}

export function get_page() {
	return count_page;
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/params/[a]/[b]/+page.svelte #######

```

<h1>[a]/[b]</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/params/[a]/+page.svelte #######

```

<h1>[a]</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/params/+layout.js #######

```

/** @type {import('./$types').LayoutLoad} */
export function load({ params }) {
	return {
		a: params.a,
		b: params.b
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/params/+layout.svelte #######

```

<script>
	/** @type {import('./$types').LayoutData} */
	export let data;
</script>

<slot />

<pre>{JSON.stringify({
		a: data.a,
		b: data.b
	})}</pre>

<a href="/load/invalidation/params/1">1</a>
<a href="/load/invalidation/params/1/x">1/x</a>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/params/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/route/server/a/+page.svelte #######

```

<h2>a</h2>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/route/server/b/+page.svelte #######

```

<h2>b</h2>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/route/server/+layout.server.js #######

```

/** @type {import('./$types').LayoutServerLoad} */
export function load({ route }) {
	return {
		route: { ...route }
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/route/server/+layout.svelte #######

```

<script>
	/** @type {import('./$types').LayoutData} */
	export let data;
</script>

<h1>route.id: {data.route.id}</h1>
<slot />

<a href="/load/invalidation/route/server/a">/load/invalidation/route/server/a</a>
<a href="/load/invalidation/route/server/b">/load/invalidation/route/server/b</a>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/route/shared/a/+page.svelte #######

```

<h2>a</h2>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/route/shared/b/+page.svelte #######

```

<h2>b</h2>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/route/shared/+layout.js #######

```

/** @type {import('./$types').LayoutLoad} */
export function load({ route }) {
	return { route, random: Math.random() };
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/route/shared/+layout.svelte #######

```

<script>
	/** @type {import('./$types').LayoutData} */
	export let data;
</script>

<h1>route.id: {data.route.id}</h1>
<h2>random id: {data.random}</h2>
<slot />

<a href="/load/invalidation/route/shared/a">/load/invalidation/route/shared/a</a>
<a href="/load/invalidation/route/shared/b">/load/invalidation/route/shared/b</a>

<a href="/load/invalidation/route/shared/unchanged-x">/load/invalidation/route/shared/unchanged-x</a
>
<a href="/load/invalidation/route/shared/unchanged-y">/load/invalidation/route/shared/unchanged-y</a
>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/route/shared/[x]/+page.svelte #######

```

<p>[x]</p>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/search-params/server/+page.server.js #######

```

let count = 0;

export function load({ url }) {
	url.searchParams.get('a');
	return {
		count: count++
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/search-params/server/+page.svelte #######

```

<script>
	export let data;
</script>

<span>count: {data.count}</span>

<a data-id="tracked" href="?a={data.count + 1}">Change tracked parameter</a>
<a data-id="untracked" href="?a={data.count}&b={data.count + 1}">Change untracked parameter</a>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/search-params/universal/+page.js #######

```

let count = 0;

export function load({ url }) {
	url.searchParams.get('a');
	return {
		count: count++
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/search-params/universal/+page.svelte #######

```

<script>
	export let data;
</script>

<span>count: {data.count}</span>

<a data-id="tracked" href="?a={data.count + 1}">Change tracked parameter</a>
<a data-id="untracked" href="?a={data.count}&b={data.count + 1}">Change untracked parameter</a>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/server-fetch/count.json/+server.js #######

```

import { json } from '@sveltejs/kit';

let count = 0;

/** @type {import('./$types').RequestHandler} */
export function GET({ url }) {
	if (url.searchParams.has('reset')) count = 0;
	return json({ count: count++ });
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/server-fetch/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export async function load({ fetch }) {
	const res = await fetch('/load/invalidation/server-fetch/count.json');
	return res.json();
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/server-fetch/+page.svelte #######

```

<script>
	export let data;
</script>

<p data-testid="count">{data.count}</p>

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/url/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load({ url }) {
	return {
		a: url.searchParams.get('a')
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/invalidation/url/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.a}</h1>

<a href="?a=1">1</a>
<a href="?a=2">2</a>
<a href="?a=3">3</a>

```


####### packages/kit/test/apps/basics/src/routes/load/large-response/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const res = await fetch('/load/large-response/text.txt');
	const text = await res.text();

	return {
		text
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/large-response/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>text.length is {data.text.length}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/large-response/text.txt/+server.js #######

```

const chunk_size = 50000;
const chunk_count = 100;

let chunk = '';
for (let i = 0; i < chunk_size; i += 1) {
	chunk += String(i % 10);
}

const encoder = new TextEncoder();

export function GET() {
	let i = 0;

	return new Response(
		new ReadableStream({
			pull: (controller) => {
				if (i++ < chunk_count) {
					controller.enqueue(encoder.encode(chunk));
				} else {
					controller.close();
				}
			}
		})
	);
}

```


####### packages/kit/test/apps/basics/src/routes/load/mutated-url/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export function load({ url }) {
	return {
		q: url.searchParams.get('q')
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/mutated-url/+page.svelte #######

```

<script>
	import { goto } from '$app/navigation';
	import { page } from '$app/stores';

	/** @type {import('./$types').PageData} */
	export let data;

	function update_q() {
		$page.url.searchParams.set('q', 'updated');
		goto($page.url);
	}
</script>

<h1>{data.q}</h1>
<button on:click={update_q}>update q</button>

```


####### packages/kit/test/apps/basics/src/routes/load/no-server-load/a/+page.server.js #######

```

export const ssr = true;

```


####### packages/kit/test/apps/basics/src/routes/load/no-server-load/a/+page.svelte #######

```

<h1>a</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/no-server-load/b/+page.server.js #######

```

export const ssr = true;

```


####### packages/kit/test/apps/basics/src/routes/load/no-server-load/b/+page.svelte #######

```

<h1>b</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/no-server-load/+layout.svelte #######

```

<a href="/load/no-server-load/a">a</a>
<a href="/load/no-server-load/b">b</a>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/load/+page.js #######

```

import { browser } from '$app/environment';

/** @type {import('@sveltejs/kit').Load} */
export function load(pageContext) {
	if (browser) {
		window.pageContext = pageContext;
	}
	return { foo: 'bar' };
}

```


####### packages/kit/test/apps/basics/src/routes/load/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>bar == {data.foo}?</h1>

<a href="/load/fetch-request">fetch request</a>
<a href="/load/fetch-relative">fetch relative</a>
<a href="/load/fetch-credentialed">fetch credentialed</a>
<a href="/load/fetch-request-headers">fetch headers</a>
<a href="/load/large-response">large response</a>
<a href="/load/raw-body">raw body</a>
<a href="/load/server-fetch-request">server fetch request</a>

```


####### packages/kit/test/apps/basics/src/routes/load/parent/server/+layout.server.js #######

```

/** @type {import('./$types').LayoutServerLoad} */
export async function load() {
	return {
		message: 'original'
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/parent/server/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/apps/basics/src/routes/load/parent/server/[x]/+layout.server.js #######

```

/** @type {import('./$types').LayoutServerLoad} */
export async function load({ params, parent }) {
	const data = await parent();
	return {
		message: `${data.message} + new`,
		x: params.x,
		y: params.y
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/parent/server/[x]/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/apps/basics/src/routes/load/parent/server/[x]/[y]/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/apps/basics/src/routes/load/parent/server/[x]/[y]/[z]/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export async function load({ params, parent }) {
	const { y } = await parent();
	return {
		y: `${y} edited`,
		z: params.z
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/parent/server/[x]/[y]/[z]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>message: {$page.data.message}</h1>
<pre>{JSON.stringify($page.data)}</pre>

```


####### packages/kit/test/apps/basics/src/routes/load/parent/shared/+layout.js #######

```

/** @type {import('./$types').LayoutLoad} */
export async function load() {
	return {
		message: 'original'
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/parent/shared/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/apps/basics/src/routes/load/parent/shared/[x]/+layout.js #######

```

/** @type {import('./$types').LayoutLoad} */
export async function load({ params, parent }) {
	const data = await parent();
	return {
		message: `${data.message} + new`,
		x: params.x,
		y: params.y
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/parent/shared/[x]/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/apps/basics/src/routes/load/parent/shared/[x]/[y]/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/apps/basics/src/routes/load/parent/shared/[x]/[y]/[z]/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ params, parent }) {
	const { y } = await parent();
	return {
		y: `${y} edited`,
		z: params.z
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/parent/shared/[x]/[y]/[z]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>message: {$page.data.message}</h1>
<pre>{JSON.stringify($page.data)}</pre>

```


####### packages/kit/test/apps/basics/src/routes/load/props/+page.js #######

```

export async function load() {
	const message = 'Hello from Index!';
	return { message };
}

```


####### packages/kit/test/apps/basics/src/routes/load/props/+page.svelte #######

```

<script>
	export let data;
</script>

<h3>Index</h3>

<p>Data: {data.message}</p>

```


####### packages/kit/test/apps/basics/src/routes/load/raw-body/dataview/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const data = new TextEncoder().encode('{ "oddly" : { "formatted" : "json" } }');
	const res = await fetch('/load/raw-body.json', {
		method: 'POST',
		headers: {
			'content-type': 'application/octet-stream'
		},
		body: new DataView(data.buffer, data.byteOffset, data.byteLength)
	});

	return await res.json();
}

```


####### packages/kit/test/apps/basics/src/routes/load/raw-body/dataview/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<pre class="parsed">{JSON.stringify(data.body)}</pre>
<pre class="raw">{data.rawBody}</pre>

```


####### packages/kit/test/apps/basics/src/routes/load/raw-body.json/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').RequestHandler} */
export async function POST({ request }) {
	const rawBody = await request.text();
	const body = JSON.parse(rawBody);

	return json({
		body,
		rawBody
	});
}

```


####### packages/kit/test/apps/basics/src/routes/load/raw-body/+page.svelte #######

```

<a href="/load/raw-body/dataview">DataView</a>
<a href="/load/raw-body/string">String</a>
<a href="/load/raw-body/uint8array">Uint8Array</a>

```


####### packages/kit/test/apps/basics/src/routes/load/raw-body/string/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const res = await fetch('/load/raw-body.json', {
		method: 'POST',
		headers: {
			'content-type': 'application/json'
		},
		body: '{ "oddly" : { "formatted" : "json" } }'
	});

	return await res.json();
}

```


####### packages/kit/test/apps/basics/src/routes/load/raw-body/string/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<pre class="parsed">{JSON.stringify(data.body)}</pre>
<pre class="raw">{data.rawBody}</pre>

```


####### packages/kit/test/apps/basics/src/routes/load/raw-body/uint8array/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const res = await fetch('/load/raw-body.json', {
		method: 'POST',
		headers: {
			'content-type': 'application/octet-stream'
		},
		body: new TextEncoder().encode('{ "oddly" : { "formatted" : "json" } }')
	});

	return await res.json();
}

```


####### packages/kit/test/apps/basics/src/routes/load/raw-body/uint8array/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<pre class="parsed">{JSON.stringify(data.body)}</pre>
<pre class="raw">{data.rawBody}</pre>

```


####### packages/kit/test/apps/basics/src/routes/load/relay.json/+server.js #######

```

import { json } from '@sveltejs/kit';

export function GET() {
	return json('42');
}

```


####### packages/kit/test/apps/basics/src/routes/load/relay/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const res = await fetch('/load/relay.json');
	return {
		answer: await res.json()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/relay/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.answer}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/serialization/fetched-from-server.json/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function GET() {
	return json({ a: 1 });
}

```


####### packages/kit/test/apps/basics/src/routes/load/serialization/fetched-from-shared.json/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function GET() {
	return json({ b: 2 });
}

```


####### packages/kit/test/apps/basics/src/routes/load/serialization/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ fetch, data, url }) {
	const { a } = data;

	const res = await fetch(new URL('/load/serialization/fetched-from-shared.json', url.origin));
	const { b } = await res.json();

	return { a, b, c: a + b };
}

```


####### packages/kit/test/apps/basics/src/routes/load/serialization/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export async function load({ fetch }) {
	const res = await fetch('/load/serialization/fetched-from-server.json');
	const { a } = await res.json();
	return { a };
}

```


####### packages/kit/test/apps/basics/src/routes/load/serialization/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.a} + {data.b} = {data.c}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/serialization-post.json/+server.js #######

```

/** @type {import('@sveltejs/kit').RequestHandler} */
export async function POST({ request }) {
	const body = await request.text();
	return new Response(body.toUpperCase());
}

```


####### packages/kit/test/apps/basics/src/routes/load/serialization-post/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	/** @param {string} body */
	async function post(body) {
		const res = await fetch('/load/serialization-post.json', {
			method: 'POST',
			headers: {
				'content-type': 'text/plain'
			},
			body
		});

		return await res.text();
	}
	const a = await post('x');
	const b = await post('y');

	return { a, b };
}

```


####### packages/kit/test/apps/basics/src/routes/load/serialization-post/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>a: {data.a}</h1>
<h2>b: {data.b}</h2>

```


####### packages/kit/test/apps/basics/src/routes/load/serialization-post-request/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ url, fetch }) {
	/** @param {string} body */
	async function post(body) {
		const request = new Request(url.origin + '/load/serialization-post.json', {
			method: 'POST',
			headers: {
				'content-type': 'text/plain'
			},
			body
		});
		const res = await fetch(request);

		return await res.text();
	}
	const a = await post('x');
	const b = await post('y');

	return { a, b };
}

```


####### packages/kit/test/apps/basics/src/routes/load/serialization-post-request/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>a: {data.a}</h1>
<h2>b: {data.b}</h2>

```


####### packages/kit/test/apps/basics/src/routes/load/server-data-nostore/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load({ url }) {
	return {
		x: url.searchParams.get('x')
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/server-data-nostore/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>x: {data.x}</h1>
<a href="/load/server-data-nostore?x=2">2</a>

```


####### packages/kit/test/apps/basics/src/routes/load/server-data-reuse/no-load/+page.svelte #######

```

<script>
	export let data;
</script>

<p>Page without load</p>

<pre>{JSON.stringify(data)}</pre>

```


####### packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-changing-parent/+layout.server.js #######

```

/** @type {import('./$types').LayoutServerLoad} */
export function load(input) {
	return {
		title: input.url.pathname
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-changing-parent/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-changing-parent/no-load/+page.svelte #######

```

<script>
	export let data;
</script>

<p>Page without load</p>

<pre>{JSON.stringify(data)}</pre>

```


####### packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-changing-parent/with-server-load/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load() {
	return { server: true };
}

```


####### packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-changing-parent/with-server-load/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<p>Page with server load</p>

<pre>{JSON.stringify(data)}</pre>

```


####### packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-server-load/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load() {
	return { server: true };
}

```


####### packages/kit/test/apps/basics/src/routes/load/server-data-reuse/with-server-load/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<p>Page with server load</p>

<pre>{JSON.stringify(data)}</pre>

```


####### packages/kit/test/apps/basics/src/routes/load/server-fetch-request/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ url, fetch }) {
	const href = `http://localhost:${url.searchParams.get('port')}/server-fetch-request.json`;

	const res = await fetch(href);
	const { answer } = await res.json();
	return { answer };
}

```


####### packages/kit/test/apps/basics/src/routes/load/server-fetch-request/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>the answer is {data.answer}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/set-cookie-fetch/a.json/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function GET({ url }) {
	const answer = url.searchParams.get('answer') || '42';

	return json(
		{},
		{
			headers: {
				'set-cookie': `answer=${answer}; HttpOnly; Path=/load/set-cookie-fetch`
			}
		}
	);
}

```


####### packages/kit/test/apps/basics/src/routes/load/set-cookie-fetch/b.json/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function GET({ cookies }) {
	const answer = +cookies.get('answer');

	return json(
		{ answer },
		{
			headers: {
				'set-cookie': `doubled=${answer * 2}; HttpOnly; Path=/load/set-cookie-fetch`
			}
		}
	);
}

```


####### packages/kit/test/apps/basics/src/routes/load/set-cookie-fetch/+page.js #######

```

export async function load({ fetch, url }) {
	await fetch(`/load/set-cookie-fetch/a.json${url.search}`);
	const res = await fetch('/load/set-cookie-fetch/b.json');
	const { answer } = await res.json(); // need to read the response so it gets serialized

	return { answer };
}

```


####### packages/kit/test/apps/basics/src/routes/load/set-cookie-fetch/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>the answer is {data.answer}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/static-file-with-hash/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ fetch }) {
	const res = await fetch('/load/assets/a#b.txt');

	return {
		status: res.status
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/static-file-with-hash/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>status: {data.status}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/unchanged/isolated/[slug]/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load({ params }) {
	return {
		slug: params.slug
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/unchanged/isolated/[slug]/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>slug: {data.slug}</h1>
<h2>count: {data.count}</h2>

```


####### packages/kit/test/apps/basics/src/routes/load/unchanged/+layout.server.js #######

```

import { increment } from './state.js';

export function load() {
	return {
		count: increment()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/unchanged/+layout.svelte #######

```

<!-- TODO remove this file post-https://github.com/sveltejs/kit/issues/5967 -->
<slot />

<ul>
	<li><a href="/load/unchanged/isolated/a">/load/unchanged/isolated/a</a></li>
	<li><a href="/load/unchanged/isolated/b">/load/unchanged/isolated/b</a></li>
	<li><a href="/load/unchanged/uses-parent/a">/load/unchanged/uses-parent/a</a></li>
	<li><a href="/load/unchanged/uses-parent/b">/load/unchanged/uses-parent/b</a></li>
</ul>

```


####### packages/kit/test/apps/basics/src/routes/load/unchanged/+page.svelte #######

```

<a href="/load/unchanged/isolated/a">isolated</a>

```


####### packages/kit/test/apps/basics/src/routes/load/unchanged-parent/+layout.server.js #######

```

import { increment } from './state.js';

export function load() {
	return {
		count: increment()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/unchanged-parent/+layout.svelte #######

```

<!-- TODO remove this file post-https://github.com/sveltejs/kit/issues/5967 -->
<slot />

<ul>
	<li><a href="/load/unchanged-parent/isolated/a">/load/unchanged-parent/isolated/a</a></li>
	<li><a href="/load/unchanged-parent/isolated/b">/load/unchanged-parent/isolated/b</a></li>
	<li><a href="/load/unchanged-parent/uses-parent/a">/load/unchanged-parent/uses-parent/a</a></li>
	<li><a href="/load/unchanged-parent/uses-parent/b">/load/unchanged-parent/uses-parent/b</a></li>
</ul>

```


####### packages/kit/test/apps/basics/src/routes/load/unchanged-parent/+page.svelte #######

```

<a href="/load/unchanged-parent/uses-parent/a">uses parent</a>
<a href="/load/unchanged-parent/isolated/a">isolated</a>

```


####### packages/kit/test/apps/basics/src/routes/load/unchanged-parent/state.js #######

```

let count = 0;

export function increment() {
	return count++;
}

```


####### packages/kit/test/apps/basics/src/routes/load/unchanged-parent/uses-parent/[slug]/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export async function load({ params, parent }) {
	const { count } = await parent();

	return {
		doubled: count * 2,
		slug: params.slug
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/unchanged-parent/uses-parent/[slug]/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>slug: {data.slug}</h1>
<h2>count: {data.count}</h2>
<h3>doubled: {data.doubled}</h3>

```


####### packages/kit/test/apps/basics/src/routes/load/unchanged/state.js #######

```

let count = 0;

export function increment() {
	return count++;
}

```


####### packages/kit/test/apps/basics/src/routes/load/url-hash/+page.js #######

```

export const load = ({ url }) => {
	const hash = url.hash;
	return { hash };
};

```


####### packages/kit/test/apps/basics/src/routes/load/url-hash/+page.svelte #######

```

<script>
	export let data;
</script>

<p id="hash">
	{data.hash}
</p>

```


####### packages/kit/test/apps/basics/src/routes/load/url-query-param/+page.js #######

```

export function load({ data, url }) {
	return { ...data, currentClientState: url.searchParams.get('currentClientState') };
}

```


####### packages/kit/test/apps/basics/src/routes/load/url-query-param/+page.server.js #######

```

export function load() {
	return {
		textFromTheServer: 'This text comes from the server load function'
	};
}

```


####### packages/kit/test/apps/basics/src/routes/load/url-query-param/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>Hello {$page.data.currentClientState ?? ''}</h1>

<p>{$page.data.textFromTheServer}</p>

<a href="/load/url-query-param?currentClientState=ABC">ABC</a>
<a href="/load/url-query-param?currentClientState=DEF">DEF</a>
<hr />
<a href="/load/url-query-param" data-sveltekit-reload>Reload site</a>

```


####### packages/kit/test/apps/basics/src/routes/load/url-to-string/+page.js #######

```

export const load = ({ url }) => {
	url.toString();
	return {};
};

```


####### packages/kit/test/apps/basics/src/routes/load/url-to-string/+page.svelte #######

```

<h1>I didn't break!</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/window-fetch/correct/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ url, fetch }) {
	const res = await fetch(`${url.origin}/load/window-fetch/data.json`);
	const { answer } = await res.json();
	return { answer };
}

```


####### packages/kit/test/apps/basics/src/routes/load/window-fetch/correct/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.answer}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/window-fetch/data.json/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function GET() {
	return json({
		answer: 42
	});
}

```


####### packages/kit/test/apps/basics/src/routes/load/window-fetch/incorrect/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ url }) {
	const res = await fetch(`${url.origin}/load/window-fetch/data.json`);
	const { answer } = await res.json();
	return { answer };
}

```


####### packages/kit/test/apps/basics/src/routes/load/window-fetch/incorrect/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.answer}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/window-fetch/outside-load/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
	import { onMount } from 'svelte';

	let answer = 0;

	onMount(async () => {
		const res = await fetch(`${$page.url.origin}/load/window-fetch/data.json`);
		({ answer } = await res.json());
	});
</script>

<h1>{answer}</h1>

```


####### packages/kit/test/apps/basics/src/routes/load/window-fetch/patching/+page.js #######

```

import { browser } from '$app/environment';

/** @type {import('./$types').PageLoad} */
export async function load({ url, fetch }) {
	// simulate fetch being monkey-patched by a 3rd party library
	// run everything only in browser to avoid SSR caching
	if (browser) {
		const original_fetch = window.fetch;
		window.fetch = (input, init) => {
			console.log('Called a patched window.fetch');
			return original_fetch(input, init);
		};

		const res = await fetch(`${url.origin}/load/window-fetch/data.json`);
		const { answer } = await res.json();
		window.fetch = original_fetch;
		return { answer };
	}
	return {};
}

```


####### packages/kit/test/apps/basics/src/routes/load/window-fetch/patching/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.answer}</h1>

```


####### packages/kit/test/apps/basics/src/routes/navigation-lifecycle/after-navigate/a/+page.svelte #######

```

<script>
	import { afterNavigate } from '$app/navigation';

	/** @type {import('@sveltejs/kit').NavigationTarget | null} */
	let from;

	/** @type {import('@sveltejs/kit').NavigationTarget} */
	let to;

	afterNavigate((navigation) => {
		from = navigation.from;
		to = navigation.to;
	});
</script>

<h1>{from?.url.pathname} -> {to?.url.pathname}</h1>
<a href="/navigation-lifecycle/after-navigate/b">/b</a>

```


####### packages/kit/test/apps/basics/src/routes/navigation-lifecycle/after-navigate/b/+page.svelte #######

```

<script>
	import { afterNavigate } from '$app/navigation';

	/** @type {import('@sveltejs/kit').NavigationTarget | null} */
	let from;

	/** @type {import('@sveltejs/kit').NavigationTarget} */
	let to;

	afterNavigate((navigation) => {
		from = navigation.from;
		to = navigation.to;
	});
</script>

<h1>{from?.url.pathname} -> {to?.url.pathname}</h1>
<a href="/navigation-lifecycle/after-navigate/a">/a</a>

```


####### packages/kit/test/apps/basics/src/routes/navigation-lifecycle/before-navigate/a/+page.svelte #######

```

<h1>a</h1>

```


####### packages/kit/test/apps/basics/src/routes/navigation-lifecycle/before-navigate/hash-links/+page.svelte #######

```

<script>
	import { beforeNavigate } from '$app/navigation';

	let before_navigate_ran = false;

	beforeNavigate(() => {
		before_navigate_ran = true;
	});
</script>

<h1>before_navigate_ran: {before_navigate_ran}</h1>
<a href="#x">x</a>

```


####### packages/kit/test/apps/basics/src/routes/navigation-lifecycle/before-navigate/prevent-navigation/+page.svelte #######

```

<script>
	import { beforeNavigate } from '$app/navigation';

	let times_triggered = 0;
	let unload = false;
	let navigation_type;
	beforeNavigate(({ cancel, type, willUnload, to }) => {
		times_triggered++;
		unload = willUnload;
		navigation_type = type;
		if (!to?.route.id?.includes('redirect')) {
			cancel();
		}
	});
</script>

<h1>prevent navigation</h1>
<a href="/navigation-lifecycle/before-navigate/a">a</a>
<a href="/navigation-lifecycle/before-navigate/redirect">redirect</a>
<a href="/navigation-lifecycle/before-navigate/prevent-navigation?x=1">self</a>
<a href="https://google.com" target="_blank" rel="noreferrer">_blank</a>
<a href="https://google.de">external</a>
<!-- svelte-ignore a11y-invalid-attribute -->
<a download href="">external</a>
<pre>{times_triggered} {unload} {navigation_type}</pre>

```


####### packages/kit/test/apps/basics/src/routes/navigation-lifecycle/before-navigate/redirect/+page.js #######

```

import { redirect } from '@sveltejs/kit';

export function load() {
	redirect(307, '/navigation-lifecycle/before-navigate/prevent-navigation');
}

```


####### packages/kit/test/apps/basics/src/routes/navigation-lifecycle/on-navigate/[x]/+page.svelte #######

```

<script>
	import { onNavigate } from '$app/navigation';

	/** @type {import('@sveltejs/kit').NavigationTarget} */
	let from;

	/** @type {import('@sveltejs/kit').NavigationTarget} */
	let to;

	/** @type {Omit<import('@sveltejs/kit').NavigationType, 'enter' | 'leave'>} */
	let type;

	let called_return = false;

	onNavigate((navigation) => {
		from = navigation.from;
		to = navigation.to;
		type = navigation.type;
	});

	onNavigate(() => {
		return () => {
			called_return = true;
		};
	});
</script>

<h1>{from?.url.pathname} -> {to?.url.pathname} ({type ?? '...'}) {called_return}</h1>
<a href="/navigation-lifecycle/on-navigate/b">/b</a>

```


####### packages/kit/test/apps/basics/src/routes/nested-layout/error/+page.js #######

```

import { error } from '@sveltejs/kit';

export function load() {
	error(500, 'Error');
}

```


####### packages/kit/test/apps/basics/src/routes/nested-layout/error/+page.svelte #######

```

<h1>Not shown</h1>

```


####### packages/kit/test/apps/basics/src/routes/nested-layout/foo/bar/+error.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>Nested error page</h1>
<p id="nested-error-status">status: {$page.status}</p>
<p id="nested-error-message">error.message: {$page.error.message}</p>

<style>
	h1 {
		color: blue;
	}
</style>

```


####### packages/kit/test/apps/basics/src/routes/nested-layout/foo/bar/+layout.svelte #######

```

<slot />
<p id="nested-bar">Nested layout bar</p>

```


####### packages/kit/test/apps/basics/src/routes/nested-layout/foo/bar/nope/+page.js #######

```

export async function load() {
	throw new Error('nope');
}

```


####### packages/kit/test/apps/basics/src/routes/nested-layout/foo/bar/nope/+page.svelte #######

```

<h1>should not see this</h1>

```


####### packages/kit/test/apps/basics/src/routes/nested-layout/foo/baz/+page.svelte #######

```

<p id="baz">baz</p>

```


####### packages/kit/test/apps/basics/src/routes/nested-layout/foo/+layout.svelte #######

```

<slot />
<p id="nested-foo">Nested layout foo</p>

```


####### packages/kit/test/apps/basics/src/routes/nested-layout/+layout.svelte #######

```

<slot />
<p id="nested">This is a nested layout component</p>

```


####### packages/kit/test/apps/basics/src/routes/nested-layout/+page.svelte #######

```

<h1>Hello from inside the nested layout component</h1>

<div>
	<a href="/nested-layout/error">error</a>
</div>

```


####### packages/kit/test/apps/basics/src/routes/nested-layout/reset/+layout@.svelte #######

```

<h1>Layout reset</h1>
<slot />

```


####### packages/kit/test/apps/basics/src/routes/nested-layout/reset/+page.svelte #######

```

<h2>Hello</h2>

```


####### packages/kit/test/apps/basics/src/routes/no-csr/data.json/+server.js #######

```

import { json } from '@sveltejs/kit';

export function GET() {
	return json({
		type: 'no-csr'
	});
}

```


####### packages/kit/test/apps/basics/src/routes/no-csr/+page.js #######

```

export const csr = false;

/** @type {import('./$types').PageLoad} */
export async function load({ fetch }) {
	const res = await fetch('/no-csr/data.json');
	return await res.json();
}

```


####### packages/kit/test/apps/basics/src/routes/no-csr/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>look ma no javascript</h1>
<p>type: {data.type}</p>

```


####### packages/kit/test/apps/basics/src/routes/no-ssr/browser-only-global/+page.svelte #######

```

<script context="module">
	document;
</script>

{document}

<p>Works</p>

```


####### packages/kit/test/apps/basics/src/routes/no-ssr/+layout.js #######

```

export const ssr = false;

```


####### packages/kit/test/apps/basics/src/routes/no-ssr/+layout.svelte #######

```

<slot />;

```


####### packages/kit/test/apps/basics/src/routes/no-ssr/margin/+page.svelte #######

```

<div class="container">
	<span> ^this is not the top of the screen</span>
	<div class="spacer"></div>
</div>

<style>
	.container {
		margin-top: 300px;
	}

	.spacer {
		height: 1000px;
	}
</style>

```


####### packages/kit/test/apps/basics/src/routes/no-ssr/other/+page.svelte #######

```

<h1>other</h1>

```


####### packages/kit/test/apps/basics/src/routes/no-ssr/+page.svelte #######

```

<h1>content was rendered</h1>

<a href="/no-ssr/other">other</a>

<style>
	h1 {
		color: red;
	}
</style>

```


####### packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/layout/inherit/+page.svelte #######

```

<script context="module">
	document;
</script>

{document}

<p>Works</p>

```


####### packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/layout/+layout.js #######

```

export const ssr = false;

```


####### packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/layout/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/layout/overwrite/+page.js #######

```

export const ssr = true;

```


####### packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/layout/overwrite/+page.svelte #######

```

<script context="module">
	document;
</script>

{document}

<p>You shouldn't see this</p>

```


####### packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/+page.js #######

```

export const ssr = false;

```


####### packages/kit/test/apps/basics/src/routes/no-ssr/ssr-page-config/+page.svelte #######

```

<script context="module">
	document;
</script>

{document}

<p>Works</p>

```


####### packages/kit/test/apps/basics/src/routes/origin/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>{$page.url.origin}</h1>

```


####### packages/kit/test/apps/basics/src/routes/package.json/+server.js #######

```

import { json } from '@sveltejs/kit';

export function GET() {
	return json({
		works: true
	});
}

```


####### packages/kit/test/apps/basics/src/routes/+page.js #######

```

/** @type {import('@sveltejs/kit').Load}*/
export async function load({ fetch }) {
	const res = await fetch('/answer.json');
	const { answer } = await res.json();
	return { answer };
}

```


####### packages/kit/test/apps/basics/src/routes/+page.svelte #######

```

<script>
	import './index.css';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>the answer is {data.answer}</h1>

<a href="/routing/trailing-slash/never/"
	>URL with trailing slash that should redirect to remove it</a
>

```


####### packages/kit/test/apps/basics/src/routes/paths/deeply/nested/+page.svelte #######

```

<script>
	import { base, assets } from '$app/paths';
</script>

<pre>{JSON.stringify({ base, assets })}</pre>

```


####### packages/kit/test/apps/basics/src/routes/paths/+page.svelte #######

```

<script>
	import { base, assets } from '$app/paths';
</script>

<pre>{JSON.stringify({ base, assets })}</pre>

```


####### packages/kit/test/apps/basics/src/routes/prerendering/env/dynamic/+page.svelte #######

```

<script>
	import { env } from '$env/dynamic/public';
</script>

<h2>prerendering: {env.PUBLIC_PRERENDERING}</h2>

```


####### packages/kit/test/apps/basics/src/routes/prerendering/env/+layout.svelte #######

```

<a href="/prerendering/env/prerendered">prerendered</a>
<a href="/prerendering/env/dynamic">dynamic</a>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/prerendering/env/prerendered/+page.js #######

```

export const prerender = true;

```


####### packages/kit/test/apps/basics/src/routes/prerendering/env/prerendered/+page.svelte #######

```

<h2>prerendered</h2>

```


####### packages/kit/test/apps/basics/src/routes/prerendering/+error.svelte #######

```

<script>
	import { page } from '$app/stores';

	$: title = `${$page.status}: ${$page.error.message}`;
</script>

<h1>{title}</h1>

```


####### packages/kit/test/apps/basics/src/routes/prerendering/log-url/+page.js #######

```

export const prerender = true;

```


####### packages/kit/test/apps/basics/src/routes/prerendering/log-url/+page.svelte #######

```

<script>
	import { page } from '$app/stores';

	let error = false;

	try {
		console.log($page);
	} catch (e) {
		error = true;
	}
</script>

<p>error: {error}</p>

```


####### packages/kit/test/apps/basics/src/routes/prerendering/mutative-endpoint/+page.js #######

```

export const prerender = 'auto';

```


####### packages/kit/test/apps/basics/src/routes/prerendering/mutative-endpoint/+page.server.ts #######

```

export const actions = {};

```


####### packages/kit/test/apps/basics/src/routes/prerendering/mutative-endpoint/+page.svelte #######

```

<h1>I have a mutative endpoint!</h1>

```


####### packages/kit/test/apps/basics/src/routes/prerendering/no-ssr/+page.js #######

```

export const prerender = true;
export const ssr = false;

```


####### packages/kit/test/apps/basics/src/routes/prerendering/no-ssr/+page.svelte #######

```

<h1>Hello world!</h1>
<p>{window.location.origin}</p>

```


####### packages/kit/test/apps/basics/src/routes/prerendering/prerendered-endpoint/api/+server.js #######

```

import { json } from '@sveltejs/kit';

export const prerender = true;

export function GET() {
	return json({ message: 'Im prerendered and called from a non-prerendered +page.server.js' });
}

```


####### packages/kit/test/apps/basics/src/routes/prerendering/prerendered-endpoint/page/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export async function load({ fetch }) {
	const res = await fetch('/prerendering/prerendered-endpoint/api');
	const json = await res.json();
	return json;
}

```


####### packages/kit/test/apps/basics/src/routes/prerendering/prerendered-endpoint/page/+page.svelte #######

```

<script>
	export let data;
</script>

<h1>{data.message}</h1>

```


####### packages/kit/test/apps/basics/src/routes/prerendering/prerendered-endpoint/+page.svelte #######

```

<a href="/prerendering/prerendered-endpoint/from-handle-hook">through handle hook</a>

```


####### packages/kit/test/apps/basics/src/routes/prerendering/prerendered-endpoint/proxy/+server.js #######

```

export async function GET({ fetch }) {
	return await fetch('/prerendering/prerendered-endpoint/api');
}

```


####### packages/kit/test/apps/basics/src/routes/query/echo/+page.js #######

```

import { to_pojo } from './utils.js';

/** @type {import('@sveltejs/kit').Load} */
export function load({ url }) {
	return {
		values: to_pojo(url.searchParams)
	};
}

```


####### packages/kit/test/apps/basics/src/routes/query/echo/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
	import { to_pojo } from './utils.js';

	/** @type {import('./$types').PageData}*/
	export let data;
</script>

<pre id="one">{JSON.stringify(data.values)}</pre>
<pre id="two">{JSON.stringify(to_pojo($page.url.searchParams))}</pre>

<a href="/query/echo?bar=2">?bar=2</a>

```


####### packages/kit/test/apps/basics/src/routes/query/echo/utils.js #######

```

/** @typedef {Record<string, string[]>} Query */

/** @param {URLSearchParams} query */
export function to_pojo(query) {
	/** @type {Query}*/
	const values = {};

	query.forEach((value, key) => {
		if (!(key in values)) values[key] = [];
		values[key].push(value);
	});

	return values;
}

```


####### packages/kit/test/apps/basics/src/routes/read-file/auto.txt #######

Imported without ?url 😎

####### packages/kit/test/apps/basics/src/routes/read-file/+page.server.js #######

```

import { dev } from '$app/environment';
import { read } from '$app/server';
import auto from './auto.txt';
import url from './url.txt?url';

const glob = import.meta.glob('../../../../read-file-test.txt', {
	as: 'url',
	eager: true
});

export async function load() {
	if (!dev && !auto.startsWith('data:')) {
		throw new Error('expected auto.txt to be inlined');
	}

	return {
		auto: await read(auto).text(),
		url: await read(url).text(),
		glob: await read(Object.values(glob)[0]).text()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/read-file/+page.svelte #######

```

<script>
	export let data;
</script>

<p data-testid="auto">{data.auto}</p>
<p data-testid="url">{data.url}</p>
<p data-testid="glob">{data.glob}</p>

```


####### packages/kit/test/apps/basics/src/routes/read-file/url.txt #######

Imported with ?url 😎

####### packages/kit/test/apps/basics/src/routes/redirect/a/+page.js #######

```

import { redirect } from '@sveltejs/kit';

export function load() {
	redirect(307, './b');
}

```


####### packages/kit/test/apps/basics/src/routes/redirect/a/+page.svelte #######

```

<h1>a</h1>

```


####### packages/kit/test/apps/basics/src/routes/redirect/b/+page.js #######

```

import { redirect } from '@sveltejs/kit';

export function load() {
	redirect(307, './c');
}

```


####### packages/kit/test/apps/basics/src/routes/redirect/b/+page.svelte #######

```

<h1>a</h1>

```


####### packages/kit/test/apps/basics/src/routes/redirect/c/+page.svelte #######

```

<h1>c</h1>

```


####### packages/kit/test/apps/basics/src/routes/redirect/in-handle/+page.server.js #######

```

export function load() {}

```


####### packages/kit/test/apps/basics/src/routes/redirect/in-handle/+page.svelte #######

```

<h1>in-handle</h1>

```


####### packages/kit/test/apps/basics/src/routes/redirect/loopy/a/+page.js #######

```

import { redirect } from '@sveltejs/kit';

export function load() {
	redirect(307, './b');
}

```


####### packages/kit/test/apps/basics/src/routes/redirect/loopy/a/+page.svelte #######

```

<h1>a</h1>

```


####### packages/kit/test/apps/basics/src/routes/redirect/loopy/b/+page.js #######

```

import { redirect } from '@sveltejs/kit';

export function load() {
	redirect(307, './a');
}

```


####### packages/kit/test/apps/basics/src/routes/redirect/loopy/b/+page.svelte #######

```

<h1>b</h1>

```


####### packages/kit/test/apps/basics/src/routes/redirect/missing-status/a/+page.js #######

```

import { redirect } from '@sveltejs/kit';

export function load() {
	redirect(undefined, './b');
}

```


####### packages/kit/test/apps/basics/src/routes/redirect/missing-status/a/+page.svelte #######

```

<h1>a</h1>

```


####### packages/kit/test/apps/basics/src/routes/redirect/missing-status/b/+page.js #######

```

import { redirect } from '@sveltejs/kit';

export function load() {
	// @ts-ignore
	redirect(555, './a');
}

```


####### packages/kit/test/apps/basics/src/routes/redirect/missing-status/b/+page.svelte #######

```

<h1>b</h1>

```


####### packages/kit/test/apps/basics/src/routes/redirect-on-load/+page.js #######

```

import { redirect } from '@sveltejs/kit';
import { browser } from '$app/environment';

export async function load() {
	if (browser) {
		redirect(303, '/redirect-on-load/redirected');
	}

	return {};
}

```


####### packages/kit/test/apps/basics/src/routes/redirect-on-load/+page.svelte #######

```

<h1>Woops!</h1>
<p>You shouldn't be here. You should have been directed to /redirect!</p>

```


####### packages/kit/test/apps/basics/src/routes/redirect-on-load/redirected/+page.svelte #######

```

<h1>Hazaa!</h1>

```


####### packages/kit/test/apps/basics/src/routes/redirect/+page.svelte #######

```

<h1>redirects</h1>
<a href="/redirect/a">a</a>
<a href="/redirect/b">b</a>

<a href="/redirect/loopy/a">a (loopy)</a>
<a href="/redirect/loopy/b">b (loopy)</a>

<a href="/redirect/missing-status/a">a (missing-status)</a>
<a href="/redirect/missing-status/b">b (missing-status)</a>

<a href="/redirect/in-handle?throw">in-handle (redirect)</a>
<a href="/redirect/in-handle?response">in-handle (return Response)</a>

```


####### packages/kit/test/apps/basics/src/routes/reroute/basic/a/+page.svelte #######

```

<h1>Should have been rewritten to <code>/reroute/basic/b</code></h1>

```


####### packages/kit/test/apps/basics/src/routes/reroute/basic/b/+page.svelte #######

```

<h1>Successfully rewritten</h1>

```


####### packages/kit/test/apps/basics/src/routes/reroute/basic/+page.svelte #######

```

<a href="/reroute/basic/a">Go to url that should be rewritten</a>

```


####### packages/kit/test/apps/basics/src/routes/reroute/client-only-redirect/a/+page.svelte #######

```

<h1>Should have been rewritten to <code>/reroute/client-only-redirect/b</code></h1>

```


####### packages/kit/test/apps/basics/src/routes/reroute/client-only-redirect/b/+page.svelte #######

```

<h1>Successfully rewritten</h1>

```


####### packages/kit/test/apps/basics/src/routes/reroute/client-only-redirect/+page.js #######

```

import { browser } from '$app/environment';
import { redirect } from '@sveltejs/kit';

export async function load() {
	if (browser) {
		redirect(302, '/reroute/client-only-redirect/a');
	}

	return {};
}

```


####### packages/kit/test/apps/basics/src/routes/reroute/client-only-redirect/+page.svelte #######

```

<h1>Should be redirected</h1>

```


####### packages/kit/test/apps/basics/src/routes/reroute/error-handling/client-error/+page.svelte #######

```

<h1>
	The rewrite on this page should fail in the browser, causing a full navigation that resolves to
	<code>/reroute/error-handling/client-error-rewritten</code>
</h1>

```


####### packages/kit/test/apps/basics/src/routes/reroute/error-handling/client-error-rewritten/+page.svelte #######

```

<h1>Full Navigation</h1>

```


####### packages/kit/test/apps/basics/src/routes/reroute/error-handling/+page.svelte #######

```

<a href="/reroute/error-handling/client-error" id="client-error">Url with client error</a>
<a href="/reroute/error-handling/server-error" id="server-error">Url with server error</a>

```


####### packages/kit/test/apps/basics/src/routes/reroute/error-handling/server-error/+page.svelte #######

```

<h1>Should be unreachable - 500 expected</h1>

```


####### packages/kit/test/apps/basics/src/routes/reroute/external/+page.svelte #######

```

<a href="/reroute/external/rewritten">Go to rewritten page</a>
<a href="https://expired.badssl.com/" data-test="external-url">External Link</a>

```


####### packages/kit/test/apps/basics/src/routes/reroute/preload-data/a/+page.js #######

```

export async function load() {
	return {
		success: false
	};
}

```


####### packages/kit/test/apps/basics/src/routes/reroute/preload-data/b/+page.js #######

```

export async function load() {
	return {
		success: true
	};
}

```


####### packages/kit/test/apps/basics/src/routes/reroute/preload-data/+page.svelte #######

```

<script>
	import { preloadData } from '$app/navigation';
	let data = null;

	async function onClick() {
		const result = await preloadData('/reroute/preload-data/a');
		if (result.type === 'loaded') {
			data = result.data;
		}
	}
</script>

<button on:click={onClick}>Preload</button>

{#if data}
	<pre>{JSON.stringify(data, null, 2)}</pre>
{/if}

```


####### packages/kit/test/apps/basics/src/routes/routing/ambiguous/[slug].json/+server.js #######

```

/** @type {import('@sveltejs/kit').RequestHandler} */
export function GET(req) {
	return new Response(req.params.slug);
}

```


####### packages/kit/test/apps/basics/src/routes/routing/ambiguous/[slug]/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/routing/a/+page.svelte #######

```

<h1>a</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/b.json/+server.js #######

```

import { json } from '@sveltejs/kit';

export function GET() {
	return json('b');
}

```


####### packages/kit/test/apps/basics/src/routes/routing/b/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const letter = await fetch('/routing/b.json').then((r) => r.json());
	return { letter };
}

```


####### packages/kit/test/apps/basics/src/routes/routing/b/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.letter}</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/cancellation/a/+page.js #######

```

import { browser } from '$app/environment';

/** @type {import('@sveltejs/kit').Load} */
export async function load() {
	if (browser) {
		await new Promise((f) => {
			window.fulfil_navigation = f;
		});
	}

	return {};
}

```


####### packages/kit/test/apps/basics/src/routes/routing/cancellation/a/+page.svelte #######

```

<h1>this should not appear</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/cancellation/b/+page.svelte #######

```

<h1>b</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/cancellation/+layout.svelte #######

```

<slot />

<a href="/routing/cancellation/a">a</a>
<a href="/routing/cancellation/b">b</a>

```


####### packages/kit/test/apps/basics/src/routes/routing/cancellation/+page.svelte #######

```

<h1>cancellation</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/client/bar/b/+page.svelte #######

```

<h1>b</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/client/bar/+page.svelte #######

```

<h1>bar</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/client/foo/+page.svelte #######

```

<h1>foo</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/const/+page.svelte #######

```

<h1>reserved words are okay as routes</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/content-negotiation/+page.server.js #######

```

export const actions = {
	default: () => {
		return {
			submitted: true
		};
	}
};

```


####### packages/kit/test/apps/basics/src/routes/routing/content-negotiation/+page.svelte #######

```

<script>
	import { enhance } from '$app/forms';

	/** @type {import('./$types').ActionData} */
	export let form;

	let result;

	/** @param {string} method */
	async function request(method) {
		result = 'loading';
		const response = await fetch('/routing/content-negotiation', { method });
		result = await response.text();
	}
</script>

<p>Hi</p>
<button on:click={() => request('GET')}>GET</button>
<button on:click={() => request('PUT')}>PUT</button>
<button on:click={() => request('PATCH')}>PATCH</button>
<button on:click={() => request('POST')}>POST</button>
<button on:click={() => request('DELETE')}>DELETE</button>
<pre>{result}</pre>

<form method="POST" use:enhance>
	<button>Submit</button>
</form>

<p data-testid="form-result">form.submitted: {form?.submitted}</p>

```


####### packages/kit/test/apps/basics/src/routes/routing/content-negotiation/+server.js #######

```

/** @type {import('./$types').RequestHandler} */
export function GET() {
	return new Response('GET');
}

/** @type {import('./$types').RequestHandler} */
export function PUT() {
	return new Response('PUT');
}

/** @type {import('./$types').RequestHandler} */
export function PATCH() {
	return new Response('PATCH');
}

/** @type {import('./$types').RequestHandler} */
export function POST() {
	return new Response('POST');
}

/** @type {import('./$types').RequestHandler} */
export function DELETE() {
	return new Response('DELETE');
}

```


####### packages/kit/test/apps/basics/src/routes/routing/dirs/bar/[a]/+page.svelte #######

```

<h1>A page</h1>

<a href="/routing/dirs/foo/xyz">same segment</a>

```


####### packages/kit/test/apps/basics/src/routes/routing/dirs/bar/+page.svelte #######

```

<h1 class="bar">bar</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/dirs/foo/[b]/+page.svelte #######

```

<h1>B page</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/dirs/foo/+page.svelte #######

```

<h1>foo</h1>
<a href="bar">bar</a>

```


####### packages/kit/test/apps/basics/src/routes/routing/external-popstate/+page.svelte #######

```

<h1>hello</h1>

<button
	on:click={() => {
		history.pushState({}, '', '/routing/external-popstate/does-not-exist');
	}}>go to /routing/external-popstate/does-not-exist</button
>

```


####### packages/kit/test/apps/basics/src/routes/routing/form-get/+page.svelte #######

```

<script>
	import { afterNavigate } from '$app/navigation';
	import { page } from '$app/stores';

	let type = '...';

	afterNavigate((navigation) => {
		type = /** @type {string} */ (navigation.type);
	});
</script>

<h1>{$page.url.searchParams.get('q') ?? '...'}</h1>
<h2>{type}</h2>
<h3>{$page.url.searchParams.get('foo') ?? '...'}</h3>

<form>
	<input name="q" />
	<button type="submit" name="foo" value="bar">Submit</button>
</form>

```


####### packages/kit/test/apps/basics/src/routes/routing/hashes/a/+page.svelte #######

```

<h1 id="hash-target">a</h1>
<a href="#hash-target">hash link</a>
<a href="/routing/hashes/b">b</a>
<a href="#replace-state" data-sveltekit-replacestate>replace state</a>

```


####### packages/kit/test/apps/basics/src/routes/routing/hashes/b/+page.svelte #######

```

<h1>b</h1>
<button on:click={() => history.back()}>go back</button>

```


####### packages/kit/test/apps/basics/src/routes/routing/hashes/pagestore/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
	import { onMount } from 'svelte';

	/** @type {string} */
	let hash;

	onMount(set_hash);

	function set_hash() {
		hash = window.location.hash;
	}
</script>

<svelte:window on:hashchange={set_hash} />

<h1 id="window-hash">{hash}</h1>
<h1 id="page-url-hash">{$page.url.hash}</h1>

<a href="#target">Nav to hash</a>
<a href="/routing/hashes/pagestore">Nav to page</a>
<div id="target">Target</div>

```


####### packages/kit/test/apps/basics/src/routes/routing/hashes/target/+page.svelte #######

```

<ol>
	<li><a href="#p1">first paragraph</a></li>
	<li><a href="#p2">second paragraph</a></li>
</ol>

<p id="p1">paragraph 1</p>
<p id="p2">paragraph 2</p>

<li><button>next focus element</button></li>

<style>
	p:target {
		color: red;
	}
</style>

```


####### packages/kit/test/apps/basics/src/routes/routing/link-outside-app-target/source/+page.svelte #######

```

<script>
	import { onMount } from 'svelte';
	import { increment, count } from '../state.js';

	onMount(increment);
</script>

<h1>source: {count}</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/link-outside-app-target/state.js #######

```

export let count = 0;

export function increment() {
	count += 1;
}

```


####### packages/kit/test/apps/basics/src/routes/routing/link-outside-app-target/target/+page.svelte #######

```

<script>
	import { count } from '../state.js';
</script>

<h1>target: {count}</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/matched/[fallback]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>fallback: {$page.params.fallback}</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/matched/+layout.svelte #######

```

<a href="/routing/matched/a">/routing/matched/a</a>
<a href="/routing/matched/B">/routing/matched/B</a>
<a href="/routing/matched/1">/routing/matched/1</a>
<a href="/routing/matched/everything-else">/routing/matched/everything-else</a>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/routing/matched/[letter=lowercase]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>lowercase: {$page.params.letter}</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/matched/[letter=uppercase]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>uppercase: {$page.params.letter}</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/matched/[number=numeric]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>number: {$page.params.number}</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/matched/+page.svelte #######

```

<h1>Matchers</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/missing-href/+page.svelte #######

```

<script>
	import { afterNavigate } from '$app/navigation';

	let count = 0;

	afterNavigate(() => {
		count += 1;
	});
</script>

<!-- svelte-ignore a11y-missing-attribute -->
<a data-testid="count">count: {count}</a>

```


####### packages/kit/test/apps/basics/src/routes/routing/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>Great success!</h1>

<a href="/routing/a">a</a>
<a href="/routing/ambiguous/ok.json" rel="external">ok</a>
<a href="/routing/symlink-from">symlinked</a>
<a href="http://localhost:{$page.url.searchParams.get('port')}">elsewhere</a>
<a href="/static.json">static.json</a>

<a href="/routing/b" data-sveltekit-reload>b</a>

<div class="hydrate-test"></div>

```


####### packages/kit/test/apps/basics/src/routes/routing/params-in-handle/[x]/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function GET({ locals }) {
	return json({
		key: locals.key,
		params: locals.params
	});
}

```


####### packages/kit/test/apps/basics/src/routes/routing/preloading/hash-route/+page.js #######

```

let load_calls = 0;

export const load = () => {
	load_calls += 1;
	return { calls: load_calls };
};

```


####### packages/kit/test/apps/basics/src/routes/routing/preloading/hash-route/+page.svelte #######

```

<script>
	import { onMount } from 'svelte';
	import { page } from '$app/stores';

	export let data;

	const modal_contents = {
		'please-dont-show-me': {
			title: 'Oopsie'
		},
		'please-dont-show-me-jr': {
			title: 'Oopsie Jr.'
		}
	};

	let modal = undefined;

	const show_modal = () => {
		const hash = $page.url.hash.substring(1);
		modal = modal_contents[hash];
	};

	onMount(show_modal);
</script>

<svelte:window on:popstate={show_modal} />

<h1>{modal?.title ?? ''}</h1>
<p>Loaded {data.calls} times.</p>

```


####### packages/kit/test/apps/basics/src/routes/routing/preloading/preloaded.json/+server.js #######

```

import { json } from '@sveltejs/kit';

export function GET() {
	return json('preloaded');
}

```


####### packages/kit/test/apps/basics/src/routes/routing/preloading/preloaded/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const message = await fetch('/routing/preloading/preloaded.json').then((r) => r.json());
	return { message };
}

```


####### packages/kit/test/apps/basics/src/routes/routing/preloading/preloaded/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.message}</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/preloading/preload-error/+page.js #######

```

let throw_error = false;

/** @type {import('@sveltejs/kit').Load} */
export async function load() {
	throw_error = !throw_error;
	if (throw_error) {
		throw new Error('error');
	}
}

```


####### packages/kit/test/apps/basics/src/routes/routing/preloading/preload-error/+page.svelte #######

```

<p>hello</p>

```


####### packages/kit/test/apps/basics/src/routes/routing/prerendered/+layout.js #######

```

export const prerender = true;

```


####### packages/kit/test/apps/basics/src/routes/routing/prerendered/trailing-slash/always/+page.js #######

```

export const trailingSlash = 'always';

```


####### packages/kit/test/apps/basics/src/routes/routing/prerendered/trailing-slash/always/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/routing/prerendered/trailing-slash/ignore/+page.js #######

```

export const trailingSlash = 'ignore';

```


####### packages/kit/test/apps/basics/src/routes/routing/prerendered/trailing-slash/ignore/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/routing/prerendered/trailing-slash/never/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/routing/rest/complex/[...parts].json/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function GET({ params }) {
	return json({
		parts: params.parts
	});
}

```


####### packages/kit/test/apps/basics/src/routes/routing/rest/complex/prefix-[...parts]/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch, params }) {
	const res = await fetch(`/routing/rest/complex/${params.parts}.json`);
	const { parts } = await res.json();
	return { parts };
}

```


####### packages/kit/test/apps/basics/src/routes/routing/rest/complex/prefix-[...parts]/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>parts: {data.parts}</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/rest/non-greedy/[dynamic]-bar/[...rest]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h2>{JSON.stringify($page.params)}</h2>

```


####### packages/kit/test/apps/basics/src/routes/routing/rest/non-greedy/foo/[...rest]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h2>{JSON.stringify($page.params)}</h2>

```


####### packages/kit/test/apps/basics/src/routes/routing/rest/non-greedy/+layout.svelte #######

```

<h1>non-greedy</h1>

<slot />

<a href="/routing/rest/non-greedy/foo/one/two">foo/one/two</a>
<a href="/routing/rest/non-greedy/food/one/two">food/one/two</a>
<a href="/routing/rest/non-greedy/one-bar/two/three">one-bar/two/three</a>
<a href="/routing/rest/non-greedy/one-bard/two/three">one-bard/two/three</a>

```


####### packages/kit/test/apps/basics/src/routes/routing/rest/non-greedy/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/routing/rest/path/[...ignored]/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export function load({ url }) {
	const { pathname: path } = url;
	return { path };
}

```


####### packages/kit/test/apps/basics/src/routes/routing/rest/path/[...ignored]/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>path: {data.path}</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/rest/path/+layout.svelte #######

```

<a href="/routing/rest/path/one">one</a>
<a href="/routing/rest/path/two">two</a>
<a href="/routing/rest/path/three">three</a>
<a href="/routing/rest/path/four">four</a>
<a href="/routing/rest/path/five">five</a>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/routing/rest/[...rest]/deep.json/+server.js #######

```

/** @type {import('@sveltejs/kit').RequestHandler} */
export function GET({ params }) {
	return new Response(params.rest);
}

```


####### packages/kit/test/apps/basics/src/routes/routing/rest/[...rest]/deep/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export function load({ params }) {
	const { rest } = params;
	return { rest };
}

```


####### packages/kit/test/apps/basics/src/routes/routing/rest/[...rest]/deep/+page.svelte #######

```

<script>
	import { page } from '$app/stores';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{$page.params.rest}</h1>
<h2>{data.rest}</h2>

<a href="/routing/rest/xyz/abc/qwe/deep.json" rel="external">deep</a>
<a href="/routing/rest/xyz/abc">back</a>

```


####### packages/kit/test/apps/basics/src/routes/routing/rest/[...rest]/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export function load({ params }) {
	const { rest } = params;
	return { rest };
}

```


####### packages/kit/test/apps/basics/src/routes/routing/rest/[...rest]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{$page.params.rest}</h1>
<h2>{data.rest}</h2>

<a href="/routing/rest/xyz/abc/deep">deep</a>
<a href="/routing/rest/xyz/abc">abc</a>
<a href="/routing/rest/xyz/abc/def">def</a>
<a href="/routing/rest/xyz/abc/def/ghi">ghi</a>
<a href="/routing/rest">empty</a>

```


####### packages/kit/test/apps/basics/src/routes/routing/route-id/+page.svelte #######

```

<a href="/routing/route-id/foo">/routing/route-id/foo</a>

```


####### packages/kit/test/apps/basics/src/routes/routing/route-id/[x]/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export function load({ route }) {
	return { route };
}

```


####### packages/kit/test/apps/basics/src/routes/routing/route-id/[x]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>route.id in load: {data.route.id}</h1>
<h2>route.id in store: {$page.route.id}</h2>

```


####### packages/kit/test/apps/basics/src/routes/routing/shadow-dom/+page.svelte #######

```

<script>
	import { onMount } from 'svelte';

	/** @type {HTMLDivElement} */
	let elem;

	onMount(() => {
		const shadow = elem.attachShadow({ mode: 'open' });
		const anchor = document.createElement('a');
		anchor.href = '/routing/a';
		anchor.innerHTML = '<slot>';
		shadow.appendChild(anchor);
	});
</script>

<div bind:this={elem}>
	<div id="clickme">Hello world</div>
</div>

```


####### packages/kit/test/apps/basics/src/routes/routing/skipped/[one]/[two]/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export function load({ params }) {
	return params;
}

```


####### packages/kit/test/apps/basics/src/routes/routing/skipped/[one]/[two]/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.one}/{data.two}</h1>

<a href="../y/1" id="goto-y1">next</a>

```


####### packages/kit/test/apps/basics/src/routes/routing/slashes/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<a href="/routing/">/routing/</a>
<a href="/routing/?">/routing/?</a>
<a href="/routing/?foo=bar">/routing/?foo=bar</a>
<a href="http://localhost:{$page.url.searchParams.get('port')}/with-slash/">external</a>

```


####### packages/kit/test/apps/basics/src/routes/routing/[slug]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>{$page.params.slug}</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/split-params/[a]-[b]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>{$page.params.a}</h1>
<h2>{$page.params.b}</h2>

```


####### packages/kit/test/apps/basics/src/routes/routing/split-params/+page.svelte #######

```

<a href="/routing/split-params/x-y-z">/routing/split-params/x-y-z</a>

```


####### packages/kit/test/apps/basics/src/routes/routing/symlink-to/+page.svelte #######

```

<h1>symlinked</h1>

```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash/always/+page.js #######

```

export const trailingSlash = 'always';

```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash/always/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash/ignore/+page.js #######

```

export const trailingSlash = 'ignore';

```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash/ignore/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash/+layout.js #######

```

export const ssr = false;

```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash/+layout.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<ul data-sveltekit-preload-data="hover">
	<li><a href="/routing/trailing-slash/always">/always</a></li>
	<li><a href="/routing/trailing-slash/ignore/">/ignore/</a></li>
	<li><a href="/routing/trailing-slash/never/">/never/</a></li>
</ul>

<p>{$page.url.pathname}</p>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash/never/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/always/+page.server.js #######

```

export const trailingSlash = 'always';

```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/always/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/ignore/+page.server.js #######

```

export const trailingSlash = 'ignore';

```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/ignore/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/+layout.server.js #######

```

export function load({ url }) {
	return {
		pathname: url.pathname
	};
}

```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/+layout.svelte #######

```

<script>
	import { page } from '$app/stores';

	export let data;
</script>

<ul>
	<li><a href="/routing/trailing-slash-server/always">/always</a></li>
	<li><a href="/routing/trailing-slash-server/ignore">/ignore</a></li>
	<li><a href="/routing/trailing-slash-server/ignore/">/ignore/</a></li>
	<li><a href="/routing/trailing-slash-server/never/">/never/</a></li>
</ul>

<p data-test-id="pathname-store">{$page.url.pathname}</p>
<p data-test-id="pathname-data">{data.pathname}</p>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/never/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/routing/trailing-slash-server/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/scroll/cross-document/a/+page.svelte #######

```

<h1>a</h1>

<div style="height: 200vh; background: teal"></div>

<a data-sveltekit-reload href="/scroll/cross-document/b">b</a>

```


####### packages/kit/test/apps/basics/src/routes/scroll/cross-document/b/+page.svelte #######

```

<h1>b</h1>

<a href="/scroll/cross-document/c">c</a>

```


####### packages/kit/test/apps/basics/src/routes/scroll/cross-document/c/+page.svelte #######

```

<h1>c</h1>

```


####### packages/kit/test/apps/basics/src/routes/scroll/push-state/a/+page.svelte #######

```

<button id="back-button" type="button" on:click={() => history.back()}>Back</button>

```


####### packages/kit/test/apps/basics/src/routes/scroll/push-state/+page.svelte #######

```

<script>
	import { pushState } from '$app/navigation';
	import { page } from '$app/stores';

	function handleClick() {
		pushState('', { active: true });
	}
</script>

<a id="subpage-link" href="/scroll/push-state/a">Subpage</a>

{#each { length: 20 } as _, n}
	<p>#{n}</p>
{/each}

<button id="shallow-button" type="button" on:click={handleClick}>Shallow</button>

{#if $page.state.active}
	<button id="back-button" type="button" on:click={() => history.back()}>Back</button>
{/if}

```


####### packages/kit/test/apps/basics/src/routes/scroll/top/+page.svelte #######

```

<div style="width:100%; height: 200vh; background-color: goldenrod"></div>
<!-- svelte-ignore a11y-invalid-attribute -->
<p><a href="#">#</a></p>
<p><a href="#top">#top</a></p>

```


####### packages/kit/test/apps/basics/src/routes/selection/a/+page.svelte #######

```

<svelte:head>
	<title>a</title>
</svelte:head>

<h1>a</h1>

```


####### packages/kit/test/apps/basics/src/routes/selection/b/+page.svelte #######

```

<svelte:head>
	<title>b</title>
</svelte:head>

<h1>b</h1>

```


####### packages/kit/test/apps/basics/src/routes/selection/+layout.svelte #######

```

<nav><a href="/selection/a">a</a> <a href="/selection/b">b</a></nav>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/set-cookie/+server.js #######

```

export function GET() {
	const headers = new Headers();
	headers.append('set-cookie', 'answer=42; HttpOnly');
	headers.append('set-cookie', 'problem=comma, separated, values; HttpOnly');
	return new Response(undefined, {
		headers
	});
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/dynamic/[slug]/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load({ params }) {
	return { ...params };
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/dynamic/[slug]/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>slug: {data.slug}</h1>

<a href="/shadowed/dynamic/foo">foo</a>
<a href="/shadowed/dynamic/bar">bar</a>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/error-get/+page.server.js #######

```

import { error } from '@sveltejs/kit';

export function load() {
	error(404, undefined);
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/error-get/+page.svelte #######

```

<h1>This should not be visible</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/error-post/+page.server.js #######

```

import { fail } from '@sveltejs/kit';

export function load() {
	return {
		get_message: 'hello from get'
	};
}

/** @type {import('./$types').Actions} */
export const actions = {
	default: async ({ request }) => {
		const fields = await request.formData();
		return fail(400, {
			errors: { post_message: `echo: ${fields.get('message')}` }
		});
	}
};

```


####### packages/kit/test/apps/basics/src/routes/shadowed/error-post/+page.svelte #######

```

<script>
	import { page } from '$app/stores';

	/** @type {import('./$types').PageData} */
	export let data;

	/** @type {import('./$types').ActionData} */
	export let form;
</script>

<h1>{data.get_message} / {form?.errors?.post_message}</h1>
<h2>status: {$page.status}</h2>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/missing-get/+page.server.js #######

```

/** @type {import('./$types').Actions} */
export const actions = {
	default: () => {}
};

```


####### packages/kit/test/apps/basics/src/routes/shadowed/missing-get/+page.svelte #######

```

<h1>post without get</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/no-get/+page.server.js #######

```

/** @type {import('./$types').Actions} */
export const actions = {
	default: () => {
		return {};
	}
};

```


####### packages/kit/test/apps/basics/src/routes/shadowed/no-get/+page.svelte #######

```

<h1>hello</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/+page.svelte #######

```

<a href="/shadowed/simple">simple</a>
<a href="/shadowed/redirect-get">redirect-get</a>
<a href="/shadowed/redirect-get-with-cookie">redirect-get-with-cookie</a>
<a href="/shadowed/redirect-get-with-cookie-from-fetch">redirect-get-with-cookie-from-fetch</a>
<a href="/shadowed/error-get">error-get</a>
<a href="/shadowed/no-get">no-get</a>
<a href="/shadowed/dynamic/foo">dynamic/foo</a>
<a href="/shadowed/missing-get">missing-get</a>
<a href="/shadowed/serialization">serialization</a>

<form action="/shadowed/redirect-post" method="post">
	<button type="submit" id="redirect-post">redirect</button>
</form>

<form action="/shadowed/redirect-post-with-cookie" method="post">
	<button type="submit" id="redirect-post-with-cookie">redirect</button>
</form>

<form action="/shadowed/error-post" method="post" enctype="multipart/form-data">
	<input name="message" value="posted data" />
	<button type="submit" id="error-post">error</button>
</form>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/parent/+layout.server.js #######

```

export function load() {
	return { layout: 'layout' };
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/parent/+layout.svelte #######

```

<script>
	export let data;
</script>

<h2>Layout data: {JSON.stringify(data)}</h2>
<a href="/shadowed/parent?test">Reload</a>
<a href="/shadowed/parent/sub">Sub</a>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/shadowed/parent/+page.server.js #######

```

export async function load({ parent }) {
	const data = await parent();
	return { page: 'page', data };
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/parent/+page.svelte #######

```

<script>
	export let data;
</script>

<p>Page data: {JSON.stringify(data)}</p>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/parent/sub/+page.server.js #######

```

export async function load({ parent }) {
	const data = await parent();
	return { sub: 'sub', data };
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/parent/sub/+page.svelte #######

```

<script>
	export let data;
</script>

<p>Page data: {JSON.stringify(data)}</p>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/post-success-redirect/+page.server.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('./$types').Actions} */
export const actions = {
	default: () => {
		redirect(303, '/shadowed/post-success-redirect/redirected');
	}
};

```


####### packages/kit/test/apps/basics/src/routes/shadowed/post-success-redirect/+page.svelte #######

```

<form method="POST">
	<button>Click me</button>
</form>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/post-success-redirect/redirected/+page.svelte #######

```

<h1>POST was successful</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect/[a]/+page.server.js #######

```

import { redirect } from '@sveltejs/kit';

export function load() {
	redirect(302, '/shadowed/redirect/b');
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect/[a]/+page.svelte #######

```

<h1>redirect</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect/b/+page.svelte #######

```

<h1>done</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirected/+page.server.js #######

```

export function load() {
	return {
		status: 'successful'
	};
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirected/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>Redirection was {data.status}</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect-get/+page.server.js #######

```

import { redirect } from '@sveltejs/kit';

export function load() {
	redirect(302, '/shadowed/redirected');
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect-get/+page.svelte #######

```

<h1>This should not be visible</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect-get-with-cookie-from-fetch/endpoint/+server.js #######

```

/** @type {import('./$types').RequestHandler} */
export function GET({ cookies }) {
	cookies.set('shadow-redirect-fetch', 'happy', {
		path: '/',
		secure: false // safari
	});
	return new Response('ok');
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect-get-with-cookie-from-fetch/+page.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('./$types').PageLoad} */
export async function load({ fetch }) {
	await fetch('/shadowed/redirect-get-with-cookie-from-fetch/endpoint');
	redirect(302, '/shadowed/redirected');
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect-get-with-cookie-from-fetch/+page.svelte #######

```

<h1>This should not be visible</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect-get-with-cookie/+page.server.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('./$types').PageServerLoad} */
export function load({ cookies }) {
	cookies.set('shadow-redirect', 'happy', {
		path: '/shadowed',
		secure: false // safari
	});
	redirect(302, '/shadowed/redirected');
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect-get-with-cookie/+page.svelte #######

```

<h1>This should not be visible</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect/+page.svelte #######

```

<a href="/shadowed/redirect/a">redirect to c</a>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect-post/+page.server.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('./$types').Actions} */
export const actions = {
	default: () => {
		redirect(302, '/shadowed/redirected');
	}
};

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect-post/+page.svelte #######

```

<h1>This should not be visible</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect-post-with-cookie/+page.server.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('./$types').Actions} */
export const actions = {
	default: ({ cookies }) => {
		cookies.set('shadow-redirect', 'happy', {
			path: '/shadowed',
			secure: false // safari
		});
		redirect(302, '/shadowed/redirected');
	}
};

```


####### packages/kit/test/apps/basics/src/routes/shadowed/redirect-post-with-cookie/+page.svelte #######

```

<h1>This should not be visible</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/same-render-entry/+page.svelte #######

```

<a href="/shadowed/same-render?param1=value1">Click here to navigate</a>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/same-render/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load({ url }) {
	return { url: url.toString() };
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/same-render/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>URL: {data.url}</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/serialization/+page.server.js #######

```

class Nope {
	toString() {
		return 'should not see me';
	}
}

export function load() {
	return {
		nope: new Nope()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/serialization/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.nope}</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/simple/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load({ locals }) {
	return {
		answer: locals.answer
	};
}

```


####### packages/kit/test/apps/basics/src/routes/shadowed/simple/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>The answer is {data.answer}</h1>

```


####### packages/kit/test/apps/basics/src/routes/shadowed/simple/post/+page.server.js #######

```

/** @type {import('./$types').Actions} */
export const actions = {
	default: () => {}
};

```


####### packages/kit/test/apps/basics/src/routes/shadowed/simple/post/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/shallow-routing/push-state/a/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>a</h1>

<p>active: {$page.state.active ?? false}</p>

```


####### packages/kit/test/apps/basics/src/routes/shallow-routing/push-state/b/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>b</h1>

<p>active: {$page.state.active ?? false}</p>

```


####### packages/kit/test/apps/basics/src/routes/shallow-routing/push-state/+layout.svelte #######

```

<a href="/shallow-routing/push-state">push-state</a>
<a href="/shallow-routing/push-state/a">a</a>
<a href="/shallow-routing/push-state/b">b</a>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/shallow-routing/push-state/+page.js #######

```

export function load() {
	return {
		now: Date.now()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/shallow-routing/push-state/+page.svelte #######

```

<script>
	import { invalidateAll, pushState } from '$app/navigation';
	import { page } from '$app/stores';

	export let data;

	function one() {
		pushState('', { active: true });
	}

	function two() {
		pushState('/shallow-routing/push-state/a', { active: true });
	}
</script>

<h1>parent</h1>

<button data-id="one" on:click={one}>push state on current page</button>
<button data-id="two" on:click={two}>push state on child page</button>
<button data-id="invalidate" on:click={invalidateAll}>invalidate all</button>

<p>active: {$page.state.active ?? false}</p>
<span>{data.now}</span>

```


####### packages/kit/test/apps/basics/src/routes/shallow-routing/replace-state/a/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>a</h1>

<p>active: {$page.state.active ?? false}</p>

```


####### packages/kit/test/apps/basics/src/routes/shallow-routing/replace-state/b/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>b</h1>

<p>active: {$page.state.active ?? false}</p>

```


####### packages/kit/test/apps/basics/src/routes/shallow-routing/replace-state/+layout.svelte #######

```

<a href="/shallow-routing/replace-state">replace-state</a>
<a href="/shallow-routing/replace-state/a">a</a>
<a href="/shallow-routing/replace-state/b">b</a>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/shallow-routing/replace-state/+page.svelte #######

```

<script>
	import { replaceState } from '$app/navigation';
	import { page } from '$app/stores';

	function one() {
		replaceState('', { active: true });
	}

	function two() {
		replaceState('/shallow-routing/replace-state/a', { active: true });
	}
</script>

<h1>parent</h1>

<button data-id="one" on:click={one}>replace state on current page</button>
<button data-id="two" on:click={two}>replace state on child page</button>

<p>active: {$page.state.active ?? false}</p>

```


####### packages/kit/test/apps/basics/src/routes/snapshot/a/+page.svelte #######

```

<script>
	let message = '';

	/** @type {import('./$types').Snapshot<string>} */
	export const snapshot = {
		capture: () => message,
		restore: (snapshot) => (message = snapshot)
	};
</script>

<input bind:value={message} />

```


####### packages/kit/test/apps/basics/src/routes/snapshot/b/+page.svelte #######

```

<h1>b</h1>

```


####### packages/kit/test/apps/basics/src/routes/snapshot/c/+page.svelte #######

```

<h1>c</h1>

```


####### packages/kit/test/apps/basics/src/routes/snapshot/+layout.svelte #######

```

<a href="/snapshot/a">a</a>
<a href="/snapshot/b">b</a>
<a href="/snapshot/c" data-sveltekit-reload>c</a>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/src/[...anything]/+server.js #######

```

/** @type {import('./$types').RequestHandler} */
export function GET() {
	return new Response('dynamically rendered file');
}

```


####### packages/kit/test/apps/basics/src/routes/static/+page.svelte #######

```

<h1>hello</h1>

```


####### packages/kit/test/apps/basics/src/routes/store/client-access/+page.svelte #######

```

<script>
	import { getStores } from '$app/stores';

	let pathname;
</script>

<h1>{pathname}</h1>

<button
	on:click={() => {
		getStores().page.subscribe(($page) => (pathname = $page.url.pathname))();
	}}>click</button
>

```


####### packages/kit/test/apps/basics/src/routes/store/data/+error.svelte #######

```

<script>
	import { page } from '$app/stores';
	import { goto } from '$app/navigation';
</script>

<button id="reload-button" on:click={() => goto($page.url.toString())}>Reload</button>

```


####### packages/kit/test/apps/basics/src/routes/store/data/foo/+page.js #######

```

let is_first = true;

export function load({ url }) {
	if (url.searchParams.get('reset')) {
		is_first = true;
		return {};
	}

	if (is_first) {
		is_first = false;
		throw new Error('uh oh');
	}

	return {
		foo: true,
		number: 2
	};
}

```


####### packages/kit/test/apps/basics/src/routes/store/data/foo/+page.svelte #######

```

<script>
	export let data;
</script>

<h1>data - foo</h1>
<p>Number prop: {data.number}</p>

```


####### packages/kit/test/apps/basics/src/routes/store/data/[item]/+page.js #######

```

import { error } from '@sveltejs/kit';

/** @type {import('./$types').PageLoad} */
export function load({ params }) {
	if (params.item === 'xxx') {
		error(500, 'Params = xxx');
	}

	if (params.item === 'yyy') {
		error(500, 'Params = yyy');
	}

	return {
		page: params.item,
		value: 456
	};
}

```


####### packages/kit/test/apps/basics/src/routes/store/data/[item]/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/store/data/+layout.js #######

```

export function load() {
	return {
		name: 'SvelteKit',
		value: 123
	};
}

```


####### packages/kit/test/apps/basics/src/routes/store/data/+layout.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<div id="store-data">{JSON.stringify($page.data)}</div>
<div id="store-error">{$page.error?.message}</div>
<div id="url-hash">{$page.url.hash}</div>

<nav>
	<a href="/store/data/xxx">xxx</a> <a href="/store/data/yyy">yyy</a>
	<a href="/store/data/zzz">zzz</a> <a href="/store/data/foo">foo</a>
</nav>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/store/data/store-update/a/+page.svelte #######

```

Page A

```


####### packages/kit/test/apps/basics/src/routes/store/data/store-update/b/+page.svelte #######

```

Page B

```


####### packages/kit/test/apps/basics/src/routes/store/data/store-update/+layout.svelte #######

```

<script>
	import { page } from '$app/stores';
	let previous = $page.data;
	let count = 0;
	$: {
		if (previous !== $page.data) {
			count++;
		}
	}
</script>

<p>$page.data was updated {count} time(s)</p>
<a href="/store/data/store-updates/a">a</a>
<a href="/store/data/store-updates/b">b</a>
<slot />

```


####### packages/kit/test/apps/basics/src/routes/store/data/store-update/same-keys/+layout.js #######

```

export function load() {
	return {
		value: 'layout'
	};
}

```


####### packages/kit/test/apps/basics/src/routes/store/data/store-update/same-keys/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/store/data/store-update/same-keys/same-deep/nested/+page.js #######

```

export function load() {
	return {
		value: 'page'
	};
}

```


####### packages/kit/test/apps/basics/src/routes/store/data/store-update/same-keys/same-deep/nested/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/store/data/store-update/same-keys/same/+page.js #######

```

export function load() {
	return {
		value: 'page'
	};
}

```


####### packages/kit/test/apps/basics/src/routes/store/data/store-update/same-keys/same/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/store/navigating/a/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load() {
	await new Promise((f) => setTimeout(f, 250));
}

```


####### packages/kit/test/apps/basics/src/routes/store/navigating/a/+page.svelte #######

```

<p>a</p>

```


####### packages/kit/test/apps/basics/src/routes/store/navigating/b/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load() {
	await new Promise((f) => setTimeout(f, 250));
}

```


####### packages/kit/test/apps/basics/src/routes/store/navigating/b/+page.svelte #######

```

<p>b</p>

```


####### packages/kit/test/apps/basics/src/routes/store/navigating/c/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load() {
	await new Promise((f) => setTimeout(f, 1000));
	return {};
}

```


####### packages/kit/test/apps/basics/src/routes/store/navigating/c/+page.svelte #######

```

<p>c</p>

```


####### packages/kit/test/apps/basics/src/routes/store/navigating/+layout.svelte #######

```

<script>
	import { navigating } from '$app/stores';
</script>

<nav>
	<a href="/store/navigating/a">a</a>
	<a href="/store/navigating/b">b</a>
	<a href="/store/navigating/c">c</a>
</nav>

<div id="nav-status">
	{#if $navigating}
		<p id="navigating">
			navigating from {$navigating.from.url.pathname} to {$navigating.to.url.pathname} ({$navigating.type})
		</p>
	{:else}
		<p id="not-navigating">not currently navigating</p>
	{/if}
</div>

<slot />

```


####### packages/kit/test/apps/basics/src/routes/streaming/+page.svelte #######

```

<a href="/streaming/universal">Universal</a>
<a href="/streaming/server">Server</a>
<a href="/streaming/server-error">Server Error</a>

```


####### packages/kit/test/apps/basics/src/routes/streaming/server-error/+page.server.js #######

```

// Tests the case where a lazy promise is rejected before the rendering started
export async function load({ fetch }) {
	const eager = new Promise((resolve) => {
		setTimeout(() => {
			resolve('eager');
		}, 100);
	});

	return {
		eager: await eager,
		lazy: {
			fail: fetch('http://localhost:1337/')
		}
	};
}

```


####### packages/kit/test/apps/basics/src/routes/streaming/server-error/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<p class="eager">{data.eager}</p>

{#await data.lazy.fail}
	<p class="loadingfail">loading</p>
{:catch}
	<p class="fail">fail</p>
{/await}

```


####### packages/kit/test/apps/basics/src/routes/streaming/server/+page.server.js #######

```

export function load() {
	return {
		eager: 'eager',
		lazy: {
			success: new Promise((resolve) => {
				setTimeout(() => {
					resolve('success');
				}, 1000);
			}),
			fail: new Promise((_, reject) => {
				setTimeout(() => {
					reject(new Error('fail'));
				}, 1000);
			})
		}
	};
}

```


####### packages/kit/test/apps/basics/src/routes/streaming/server/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<p class="eager">{data.eager}</p>

{#await data.lazy.success}
	<p class="loadingsuccess">Loading success</p>
{:then result}
	<p class="success">{result}</p>
{/await}

{#await data.lazy.fail}
	<p class="loadingfail">Loading fail</p>
{:catch error}
	<p class="fail">{error.message}</p>
{/await}

```


####### packages/kit/test/apps/basics/src/routes/streaming/universal/+page.js #######

```

export function load() {
	return {
		eager: 'eager',
		lazy: {
			success: new Promise((resolve) => {
				setTimeout(() => {
					resolve('success');
				}, 1000);
			}),
			fail: new Promise((_, reject) => {
				setTimeout(() => {
					reject(new Error('fail'));
				}, 1000);
			})
		}
	};
}

```


####### packages/kit/test/apps/basics/src/routes/streaming/universal/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<p class="eager">{data.eager}</p>

{#await data.lazy.success}
	<p class="loadingsuccess">Loading success</p>
{:then result}
	<p class="success">{result}</p>
{/await}

{#await data.lazy.fail}
	<p class="loadingfail">Loading fail</p>
{:catch error}
	<p class="fail">{error.message}</p>
{/await}

```


####### packages/kit/test/apps/basics/src/routes/transform-page-chunk/+page.svelte #######

```


```


####### packages/kit/test/apps/basics/src/routes/unsafe-replacement/+page.js #######

```

export function load() {
	return { escape: '$&' };
}

```


####### packages/kit/test/apps/basics/src/routes/unsafe-replacement/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

$& {data.escape}

```


####### packages/kit/test/apps/basics/src/routes/untrack/server/+layout.server.js #######

```

export function load({ url }) {
	return {
		url: url.pathname
	};
}

```


####### packages/kit/test/apps/basics/src/routes/untrack/server/[x]/+page.server.js #######

```

export function load({ params, parent, url, untrack }) {
	untrack(() => {
		params.x;
		parent();
		url.pathname;
		url.search;
	});

	return {
		id: Math.random()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/untrack/server/[x]/+page.svelte #######

```

<script>
	export let data;
</script>

<p class="url">{data.url}</p>
<p class="id">{data.id}</p>
<a href="/untrack/server/2">2</a>

```


####### packages/kit/test/apps/basics/src/routes/untrack/universal/+layout.js #######

```

export function load({ url }) {
	return {
		url: url.pathname
	};
}

```


####### packages/kit/test/apps/basics/src/routes/untrack/universal/[x]/+page.js #######

```

export function load({ params, parent, url, untrack }) {
	untrack(() => {
		params.x;
		parent();
		url.pathname;
		url.search;
	});

	return {
		id: Math.random()
	};
}

```


####### packages/kit/test/apps/basics/src/routes/untrack/universal/[x]/+page.svelte #######

```

<script>
	export let data;
</script>

<p class="url">{data.url}</p>
<p class="id">{data.id}</p>
<a href="/untrack/universal/2">2</a>

```


####### packages/kit/test/apps/basics/src/routes/use-action/focus-and-scroll/+page.svelte #######

```

<script>
	import { disableScrollHandling } from '$app/navigation';

	const focusAndScroll = /** @param {HTMLInputElement} node */ (node) => {
		disableScrollHandling();

		node.focus();
		node.scrollIntoView();
	};
</script>

<div>They (don't) see me scrollin'...</div>
<div style="height: 180vh; background-color: peru;">
	<label for="input">Focus! </label>
	<input use:focusAndScroll id="input" type="text" />
</div>
<div style="height: 180vh; background-color: teal;">They (not) focusin'</div>

```


####### packages/kit/test/apps/basics/src/routes/use-action/+page.svelte #######

```

<h1>Welcome to a test project</h1>
<a href="/use-action/focus-and-scroll">Focus and scroll demo</a>

<style>
	:global(body) {
		background-color: tan;
		display: flex;
		flex-direction: column;
	}

	a {
		display: block;
		margin: 20px;
	}
</style>

```


####### packages/kit/test/apps/basics/src/routes/xss.json/+server.js #######

```

import { json } from '@sveltejs/kit';

export function GET() {
	return json({
		name: '</script><script>window.pwned = 1</script>'
	});
}

```


####### packages/kit/test/apps/basics/src/routes/xss/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const res = await fetch('/xss.json');
	const user = await res.json();
	return { user };
}

```


####### packages/kit/test/apps/basics/src/routes/xss/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>user.name is {data.user.name}</h1>

```


####### packages/kit/test/apps/basics/src/routes/xss/[path]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1 id="one">{$page.params.path}</h1>

```


####### packages/kit/test/apps/basics/src/routes/xss/query/+page.js #######

```

import { to_pojo } from './utils.js';

/** @type {import('@sveltejs/kit').Load} */
export function load({ url }) {
	return {
		values: to_pojo(url.searchParams)
	};
}

```


####### packages/kit/test/apps/basics/src/routes/xss/query/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
	import { to_pojo } from './utils.js';

	/** @type {import('./$types').PageData}*/
	export let data;
</script>

<pre id="one">{JSON.stringify(data.values)}</pre>
<pre id="two">{JSON.stringify(to_pojo($page.url.searchParams))}</pre>

```


####### packages/kit/test/apps/basics/src/routes/xss/query/utils.js #######

```

/** @typedef {Record<string, string[]>} Query */

/** @param {URLSearchParams} query */
export function to_pojo(query) {
	/** @type {Query}*/
	const values = {};

	query.forEach((value, key) => {
		if (!(key in values)) values[key] = [];
		values[key].push(value);
	});

	return values;
}

```


####### packages/kit/test/apps/basics/src/routes/xss/shadow/+page.server.js #######

```

/** @type {import('./$types').PageServerLoad} */
export function load() {
	const user = {
		name: '</script><script>window.pwned = 1</script>'
	};
	return { user };
}

```


####### packages/kit/test/apps/basics/src/routes/xss/shadow/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>user.name is {data.user.name}</h1>

```


####### packages/kit/test/apps/basics/src/service-worker.js #######

```

import { build, version } from '$service-worker';
import { PUBLIC_STATIC } from '$env/static/public';

const name = `cache-${version}-${PUBLIC_STATIC}`;

self.addEventListener('install', (event) => {
	// @ts-expect-error
	event.waitUntil(caches.open(name).then((cache) => cache.addAll(build)));
});

self.addEventListener('activate', (event) => {
	// @ts-expect-error
	event.waitUntil(
		caches.keys().then(async (keys) => {
			for (const key of keys) {
				if (!key.includes(version)) caches.delete(key);
			}
		})
	);
});

self.addEventListener('fetch', (event) => {
	// @ts-expect-error
	const { request } = event;

	if (request.method !== 'GET' || request.headers.has('range')) return;

	const url = new URL(request.url);
	const cached = caches.match(request);

	if (url.origin === location.origin && build.includes(url.pathname)) {
		// always return build files from cache
		// @ts-expect-error
		event.respondWith(cached);
	} else if (url.protocol === 'https:' || location.hostname === 'localhost') {
		// hit the network for everything else...
		const promise = fetch(request);

		// ...and cache successful responses...
		promise.then((response) => {
			// cache successful responses
			if (response.ok && response.type === 'basic') {
				const clone = response.clone();
				caches.open(name).then((cache) => {
					cache.put(request, clone);
				});
			}
		});

		// ...but if it fails, fall back to cache if available
		// @ts-expect-error
		event.respondWith(promise.catch(() => cached || promise));
	}
});

```


####### packages/kit/test/apps/basics/static/empty.js #######

```


```


####### packages/kit/test/apps/basics/static/load/assets/a#b.txt #######

nope
####### packages/kit/test/apps/basics/static/load/foo.json #######

```

{
	"name": "static file"
}

```


####### packages/kit/test/apps/basics/static/static.json #######

```

"static file"

```


####### packages/kit/test/apps/basics/static/subdirectory/static.json #######

```

"subdirectory file"

```


####### packages/kit/test/apps/basics/static/symlink-to/hello.txt #######

hello
####### packages/kit/test/apps/basics/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: {
			name: 'test-adapter',
			adapt() {},
			emulate() {
				return {
					platform({ config, prerender }) {
						return { config, prerender };
					}
				};
			},
			supports: {
				read: () => true
			}
		},

		prerender: {
			entries: [
				'*',
				'/routing/prerendered/trailing-slash/always/',
				'/routing/prerendered/trailing-slash/never',
				'/routing/prerendered/trailing-slash/ignore'
			],
			handleHttpError: 'warn'
		},

		version: {
			name: 'TEST_VERSION'
		}
	}
};

export default config;

```


####### packages/kit/test/apps/basics/test/client.test.js #######

```

import { expect } from '@playwright/test';
import { test } from '../../../utils.js';

/** @typedef {import('@playwright/test').Response} Response */

test.skip(({ javaScriptEnabled }) => !javaScriptEnabled);

test.describe.configure({ mode: 'parallel' });

test.describe('a11y', () => {
	test('applies autofocus after an enhanced form submit', async ({ page }) => {
		await page.goto('/accessibility/autofocus/b');

		await page.click('#submit');
		await page.waitForFunction(() => document.activeElement?.nodeName === 'INPUT', null, {
			timeout: 1000
		});
	});
});

test.describe('Caching', () => {
	test('caches __data.json requests with invalidated search param', async ({ page, app }) => {
		await page.goto('/');
		const [, response] = await Promise.all([
			app.goto('/caching/server-data'),
			page.waitForResponse((request) =>
				request.url().endsWith('server-data/__data.json?x-sveltekit-invalidated=01')
			)
		]);
		expect(response.headers()['cache-control']).toBe('public, max-age=30');
	});
});

test.describe('Endpoints', () => {
	test('calls a delete handler', async ({ page }) => {
		await page.goto('/delete-route');
		await page.locator('.del').click();
		expect(await page.innerHTML('h1')).toBe('deleted 42');
	});
});

test.describe('Load', () => {
	test('load function is only called when necessary', async ({ app, page }) => {
		await page.goto('/load/change-detection/one/a');
		expect(await page.textContent('h1')).toBe('layout loads: 1');
		expect(await page.textContent('h2')).toBe('x: a: 1');

		await app.goto('/load/change-detection/one/a?unused=whatever');
		expect(await page.textContent('h2')).toBe('x: a: 1');

		await app.goto('/load/change-detection/two/b');
		expect(await page.textContent('h2')).toBe('y: b: 1');

		await app.goto('/load/change-detection/one/a');
		expect(await page.textContent('h2')).toBe('x: a: 2');

		await app.goto('/load/change-detection/one/b');
		expect(await page.textContent('h2')).toBe('x: b: 3');

		await app.invalidate('/load/change-detection/data.json');
		expect(await page.textContent('h1')).toBe('layout loads: 2');
		expect(await page.textContent('h2')).toBe('x: b: 3');

		await app.invalidate('/load/change-detection/data.json');
		expect(await page.textContent('h1')).toBe('layout loads: 3');
		expect(await page.textContent('h2')).toBe('x: b: 3');

		await app.invalidate('custom:change-detection-layout');
		expect(await page.textContent('h1')).toBe('layout loads: 4');
		expect(await page.textContent('h2')).toBe('x: b: 3');

		await page.click('button:has-text("invalidate change-detection/data.json")');
		await page.waitForFunction('window.invalidated');
		expect(await page.textContent('h1')).toBe('layout loads: 5');
		expect(await page.textContent('h2')).toBe('x: b: 3');

		await page.click('button:has-text("invalidate all")');
		await page.waitForFunction('window.invalidated');
		expect(await page.textContent('h1')).toBe('layout loads: 6');
		expect(await page.textContent('h2')).toBe('x: b: 4');
	});

	if (process.env.DEV) {
		test('accessing url.hash from load errors and suggests using page store', async ({ page }) => {
			await page.goto('/load/url-hash#please-dont-send-me-to-load');
			expect(await page.textContent('#message')).toBe(
				'This is your custom error page saying: "Cannot access event.url.hash. Consider using `$page.url.hash` inside a component instead (500 Internal Error)"'
			);
		});
	}

	test('url instance methods work in load', async ({ page }) => {
		await page.goto('/load/url-to-string');
		expect(await page.textContent('h1')).toBe("I didn't break!");
	});

	test('server data from previous is not reused if next page has no load function', async ({
		page,
		app
	}) => {
		await page.goto('/load/server-data-reuse/with-server-load');
		expect(await page.textContent('pre')).toBe(
			JSON.stringify({ foo: { bar: 'Custom layout' }, server: true })
		);
		await app.goto('/load/server-data-reuse/no-load');
		expect(await page.textContent('pre')).toBe(JSON.stringify({ foo: { bar: 'Custom layout' } }));

		await page.goto('/load/server-data-reuse/with-changing-parent/with-server-load');
		expect(await page.textContent('pre')).toBe(
			JSON.stringify({
				foo: { bar: 'Custom layout' },
				title: '/load/server-data-reuse/with-changing-parent/with-server-load',
				server: true
			})
		);
		await app.goto('/load/server-data-reuse/with-changing-parent/no-load');
		expect(await page.textContent('pre')).toBe(
			JSON.stringify({
				foo: { bar: 'Custom layout' },
				title: '/load/server-data-reuse/with-changing-parent/no-load'
			})
		);
	});

	test('keeps server data when valid while not reusing client load data', async ({
		page,
		clicknav
	}) => {
		await page.goto('/load/url-query-param');

		expect(await page.textContent('h1')).toBe('Hello ');
		expect(await page.textContent('p')).toBe('This text comes from the server load function');

		await clicknav('a[href="/load/url-query-param?currentClientState=ABC"]');
		expect(await page.textContent('h1')).toBe('Hello ABC');
		expect(await page.textContent('p')).toBe('This text comes from the server load function');

		await clicknav('a[href="/load/url-query-param?currentClientState=DEF"]');
		expect(await page.textContent('h1')).toBe('Hello DEF');
		expect(await page.textContent('p')).toBe('This text comes from the server load function');

		await clicknav('a[href="/load/url-query-param"]');
		expect(await page.textContent('h1')).toBe('Hello ');
		expect(await page.textContent('p')).toBe('This text comes from the server load function');
	});

	test('load does not call fetch if max-age allows it', async ({ page }) => {
		page.addInitScript(`
			window.now = 0;
			window.performance.now = () => now;
		`);

		await page.goto('/load/cache-control/default');
		await expect(page.getByText('Count is 0')).toBeVisible();
		await page.locator('button').click();
		await page.waitForLoadState('networkidle');
		await expect(page.getByText('Count is 0')).toBeVisible();

		await page.evaluate(() => (window.now = 2500));

		await page.locator('button').click();
		await expect(page.getByText('Count is 2')).toBeVisible();
	});

	test('load does ignore ttl if fetch cache options says so', async ({ page }) => {
		await page.goto('/load/cache-control/force');
		await expect(page.getByText('Count is 0')).toBeVisible();
		await page.locator('button').click();
		await expect(page.getByText('Count is 1')).toBeVisible();
	});

	test('load busts cache if non-GET request to resource is made', async ({ page }) => {
		await page.goto('/load/cache-control/bust');
		await expect(page.getByText('Count is 0')).toBeVisible();
		await page.locator('button').click();
		await expect(page.getByText('Count is 1')).toBeVisible();
	});

	test('__data.json has cache-control: private, no-store', async ({ page, clicknav }) => {
		await page.goto('/load/server-data-nostore?x=1');

		const [response] = await Promise.all([
			page.waitForResponse((response) => /__data\.js/.test(response.url())),
			clicknav('[href="/load/server-data-nostore?x=2"]')
		]);

		expect(response.headers()['cache-control']).toBe('private, no-store');
	});

	test('cache with body hash', async ({ page, clicknav }) => {
		// 1. go to the page (first load, we expect the right data)
		await page.goto('/load/fetch-cache-control/load-data');
		expect(await page.textContent('div#fr')).toBe(JSON.stringify({ hi: 'bonjour' }));
		expect(await page.textContent('div#hu')).toBe(JSON.stringify({ hi: 'szia' }));

		// 2. change to another route (client side)
		await clicknav('[href="/load/fetch-cache-control"]');

		// 3. come back to the original page (client side)
		let did_request_data = false;
		page.on('request', (request) => {
			if (request.url().endsWith('fetch-cache-control/load-data')) {
				did_request_data = true;
			}
		});
		await clicknav('[href="/load/fetch-cache-control/load-data"]');

		// 4. data should still be the same (and cached)
		expect(await page.textContent('div#fr')).toBe(JSON.stringify({ hi: 'bonjour' }));
		expect(await page.textContent('div#hu')).toBe(JSON.stringify({ hi: 'szia' }));
		expect(did_request_data).toBe(false);
	});

	test('do not use cache if headers are different', async ({ page, clicknav }) => {
		await page.goto('/load/fetch-cache-control/headers-diff');

		// 1. We expect the right data
		expect(await page.textContent('h2')).toBe('a / b');

		// 2. Change to another route (client side)
		await clicknav('[href="/load/fetch-cache-control"]');

		// 3. Come back to the original page (client side)
		const requests = [];
		page.on('request', (request) => requests.push(request));
		await clicknav('[href="/load/fetch-cache-control/headers-diff"]');

		// 4. We expect the same data and no new request because it was cached.
		expect(await page.textContent('h2')).toBe('a / b');
		expect(requests).toEqual([]);
	});

	test('permits 3rd party patching of fetch in universal load functions', async ({ page }) => {
		/** @type {string[]} */
		const logs = [];
		page.on('console', (msg) => {
			if (msg.type() === 'log') {
				logs.push(msg.text());
			}
		});

		await page.goto('/load/window-fetch/patching');
		expect(await page.textContent('h1')).toBe('42');

		expect(logs).toContain('Called a patched window.fetch');
	});

	if (process.env.DEV) {
		test('using window.fetch causes a warning', async ({ page, baseURL }) => {
			await Promise.all([
				page.goto('/load/window-fetch/incorrect'),
				page.waitForEvent('console', {
					predicate: (message) => {
						return (
							message.text() ===
							`Loading ${baseURL}/load/window-fetch/data.json using \`window.fetch\`. For best results, use the \`fetch\` that is passed to your \`load\` function: https://kit.svelte.dev/docs/load#making-fetch-requests`
						);
					},
					timeout: 3_000
				})
			]);
			expect(await page.textContent('h1')).toBe('42');

			/** @type {string[]} */
			const warnings = [];
			page.on('console', (msg) => {
				if (msg.type() === 'warning') {
					warnings.push(msg.text());
				}
			});

			await page.goto('/load/window-fetch/correct');
			expect(await page.textContent('h1')).toBe('42');

			expect(warnings).not.toContain(
				`Loading ${baseURL}/load/window-fetch/data.json using \`window.fetch\`. For best results, use the \`fetch\` that is passed to your \`load\` function: https://kit.svelte.dev/docs/load#making-fetch-requests`
			);
		});
	}

	if (!process.env.DEV) {
		test('does not fetch __data.json if no server load function exists', async ({
			page,
			clicknav
		}) => {
			await page.goto('/load/no-server-load/a');

			/** @type {string[]} */
			const pathnames = [];
			page.on('request', (r) => pathnames.push(new URL(r.url()).pathname));
			await clicknav('[href="/load/no-server-load/b"]');

			expect(pathnames).not.toContain('/load/no-server-load/b/__data.json');
		});
	}
});

test.describe('Page options', () => {
	test('applies generated component styles with ssr=false (hides announcer)', async ({
		page,
		clicknav,
		get_computed_style
	}) => {
		await page.goto('/no-ssr');
		await clicknav('[href="/no-ssr/other"]');

		expect(await get_computed_style('#svelte-announcer', 'position')).toBe('absolute');
	});
});

test.describe('SPA mode / no SSR', () => {
	test('Can use browser-only global on client-only page through ssr config in handle', async ({
		page,
		read_errors
	}) => {
		await page.goto('/no-ssr/browser-only-global');
		await expect(page.locator('p')).toHaveText('Works');
		expect(read_errors('/no-ssr/browser-only-global')).toBe(undefined);
	});

	test('Can use browser-only global on client-only page through ssr config in +layout.js', async ({
		page,
		read_errors
	}) => {
		await page.goto('/no-ssr/ssr-page-config');
		await expect(page.locator('p')).toHaveText('Works');
		expect(read_errors('/no-ssr/ssr-page-config')).toBe(undefined);
	});

	test('Can use browser-only global on client-only page through ssr config in +page.js', async ({
		page,
		read_errors
	}) => {
		await page.goto('/no-ssr/ssr-page-config/layout/inherit');
		await expect(page.locator('p')).toHaveText('Works');
		expect(read_errors('/no-ssr/ssr-page-config/layout/inherit')).toBe(undefined);
	});

	test('Cannot use browser-only global on page because of ssr config in +page.js', async ({
		page
	}) => {
		await page.goto('/no-ssr/ssr-page-config/layout/overwrite');
		await expect(page.locator('p')).toHaveText(
			'This is your custom error page saying: "document is not defined (500 Internal Error)"'
		);
	});
});

test.describe('$app/stores', () => {
	test('can use $app/stores from anywhere on client', async ({ page }) => {
		await page.goto('/store/client-access');
		await expect(page.locator('h1')).toHaveText('undefined');
		await page.locator('button').click();
		await expect(page.locator('h1')).toHaveText('/store/client-access');
	});

	test('$page.data does not update if data is unchanged', async ({ page, app }) => {
		await page.goto('/store/data/store-update/a');
		await app.goto('/store/data/store-update/b');
		await expect(page.locator('p')).toHaveText('$page.data was updated 0 time(s)');
	});

	test('$page.data does update if keys did not change but data did', async ({ page, app }) => {
		await page.goto('/store/data/store-update/same-keys/same');
		await app.goto('/store/data/store-update/same-keys');
		await expect(page.locator('p')).toHaveText('$page.data was updated 1 time(s)');
	});

	test('$page.data does update if keys did not change but data did (2)', async ({ page, app }) => {
		await page.goto('/store/data/store-update/same-keys/same-deep/nested');
		await app.goto('/store/data/store-update/same-keys');
		await expect(page.locator('p')).toHaveText('$page.data was updated 1 time(s)');
	});
});

test.describe('Invalidation', () => {
	test('+layout.server.js does not re-run when downstream load functions are invalidated', async ({
		page,
		clicknav
	}) => {
		await page.goto('/load/unchanged/isolated/a');
		expect(await page.textContent('h1')).toBe('slug: a');
		expect(await page.textContent('h2')).toBe('count: 0');

		await clicknav('[href="/load/unchanged/isolated/b"]');
		expect(await page.textContent('h1')).toBe('slug: b');
		expect(await page.textContent('h2')).toBe('count: 0');
	});

	test('+layout.server.js re-runs when await parent() is called from downstream load function', async ({
		page,
		clicknav
	}) => {
		await page.goto('/load/unchanged-parent/uses-parent/a');
		expect(await page.textContent('h1')).toBe('slug: a');
		expect(await page.textContent('h2')).toBe('count: 0');
		expect(await page.textContent('h3')).toBe('doubled: 0');

		await clicknav('[href="/load/unchanged-parent/uses-parent/b"]');
		expect(await page.textContent('h1')).toBe('slug: b');
		expect(await page.textContent('h2')).toBe('count: 0');

		// this looks wrong, but is actually the intended behaviour (the increment side-effect in a GET would be a bug in a real app)
		expect(await page.textContent('h3')).toBe('doubled: 2');
	});

	test('load function re-runs when searchParams change', async ({ page, clicknav }) => {
		await page.goto('/load/invalidation/url?a=1');
		expect(await page.textContent('h1')).toBe('1');

		await clicknav('[href="?a=2"]');
		expect(await page.textContent('h1')).toBe('2');

		await clicknav('[href="?a=3"]');
		expect(await page.textContent('h1')).toBe('3');
	});

	test('load function only re-runs when tracked searchParams change (universal)', async ({
		page,
		clicknav
	}) => {
		await page.goto('/load/invalidation/search-params/universal?tracked=0');
		expect(await page.textContent('span')).toBe('count: 0');
		await clicknav('[data-id="tracked"]');
		expect(await page.textContent('span')).toBe('count: 1');
		await clicknav('[data-id="untracked"]');
		expect(await page.textContent('span')).toBe('count: 1');
	});

	test('load function only re-runs when tracked searchParams change (server)', async ({
		page,
		clicknav
	}) => {
		await page.goto('/load/invalidation/search-params/server?tracked=0');
		expect(await page.textContent('span')).toBe('count: 0');
		await clicknav('[data-id="tracked"]');
		expect(await page.textContent('span')).toBe('count: 1');
		await clicknav('[data-id="untracked"]');
		expect(await page.textContent('span')).toBe('count: 1');
	});

	test('server-only load functions are re-run following forced invalidation', async ({ page }) => {
		await page.goto('/load/invalidation/forced');
		expect(await page.textContent('h1')).toBe('a: 0, b: 1');

		await page.click('button.invalidateall');
		await page.evaluate(() => window.promise);
		expect(await page.textContent('h1')).toBe('a: 2, b: 3');

		await page.click('button.invalidateall');
		await page.evaluate(() => window.promise);
		expect(await page.textContent('h1')).toBe('a: 4, b: 5');
	});

	test('server-only load functions are re-run following goto with forced invalidation', async ({
		page
	}) => {
		await page.goto('/load/invalidation/forced-goto');
		expect(await page.textContent('h1')).toBe('a: 0, b: 1');

		await page.click('button.goto');
		await page.evaluate(() => window.promise);
		expect(await page.textContent('h1')).toBe('a: 2, b: 3');
	});

	test('multiple invalidations run concurrently', async ({ page }) => {
		await page.goto('/load/invalidation/multiple');
		await expect(page.getByText('layout: 0, page: 0')).toBeVisible();

		await page.click('button.layout');
		await page.click('button.layout');
		await page.click('button.page');
		await page.click('button.page');
		await page.click('button.layout');
		await page.click('button.page');
		await page.click('button.all');
		await expect(page.getByText('layout: 4, page: 4')).toBeVisible();
	});

	test('multiple synchronous invalidations are batched', async ({ page }) => {
		await page.goto('/load/invalidation/multiple-batched');
		const btn = page.locator('#multiple-batched');
		await expect(btn).toHaveText('0');

		await btn.click();
		await expect(btn).toHaveAttribute('data-done', 'true');
		await expect(btn).toHaveText('2');
	});

	test('invalidateAll persists through redirects', async ({ page }) => {
		await page.goto('/load/invalidation/multiple/redirect');
		await page.locator('button.redirect').click();
		await expect(page.locator('p.redirect-state')).toHaveText('Redirect state: done');
	});

	test('+layout(.server).js is re-run when server dep is invalidated', async ({ page }) => {
		await page.goto('/load/invalidation/depends');
		const server = await page.textContent('p.server');
		const shared = await page.textContent('p.shared');
		expect(server).toBeDefined();
		expect(shared).toBeDefined();

		await page.click('button.server');
		await page.evaluate(() => window.promise);
		const next_server = await page.textContent('p.server');
		const next_shared = await page.textContent('p.shared');
		expect(server).not.toBe(next_server);
		expect(shared).not.toBe(next_shared);

		await page.click('button.neither');
		await page.evaluate(() => window.promise);
		expect(await page.textContent('p.server')).toBe(next_server);
		expect(await page.textContent('p.shared')).toBe(next_shared);
	});

	test('fetch in server load cannot be invalidated', async ({ page, app, request }) => {
		// legacy behavior was to track server dependencies -- this could leak secrets to the client (see github.com/sveltejs/kit/pull/9945)
		// we keep this test just to make sure the behavior stays the same.
		await request.get('/load/invalidation/server-fetch/count.json?reset');
		await page.goto('/load/invalidation/server-fetch');
		const selector = '[data-testid="count"]';

		expect(await page.textContent(selector)).toBe('1');
		await app.invalidate('/load/invalidation/server-fetch/count.json');
		expect(await page.textContent(selector)).toBe('1');
	});

	test('+layout.js is re-run when shared dep is invalidated', async ({ page }) => {
		await page.goto('/load/invalidation/depends');
		const server = await page.textContent('p.server');
		const shared = await page.textContent('p.shared');
		expect(server).toBeDefined();
		expect(shared).toBeDefined();

		await page.click('button.shared');
		await page.evaluate(() => window.promise);
		const next_server = await page.textContent('p.server');
		const next_shared = await page.textContent('p.shared');
		expect(server).toBe(next_server);
		expect(shared).not.toBe(next_shared);

		await page.click('button.neither');
		await page.evaluate(() => window.promise);
		expect(await page.textContent('p.server')).toBe(next_server);
		expect(await page.textContent('p.shared')).toBe(next_shared);
	});

	test('Parameter use is tracked even for routes that do not use the parameters', async ({
		page,
		clicknav
	}) => {
		await page.goto('/load/invalidation/params');

		await clicknav('[href="/load/invalidation/params/1"]');
		expect(await page.textContent('pre')).toBe('{"a":"1"}');

		await clicknav('[href="/load/invalidation/params/1/x"]');
		expect(await page.textContent('pre')).toBe('{"a":"1","b":"x"}');

		await page.goBack();
		expect(await page.textContent('pre')).toBe('{"a":"1"}');
	});

	test('route.id use is tracked for server-only load functions', async ({ page, clicknav }) => {
		await page.goto('/load/invalidation/route/server/a');
		expect(await page.textContent('h1')).toBe('route.id: /load/invalidation/route/server/a');

		await clicknav('[href="/load/invalidation/route/server/b"]');
		expect(await page.textContent('h1')).toBe('route.id: /load/invalidation/route/server/b');
	});

	test('route.id use is tracked for shared load functions', async ({ page, clicknav }) => {
		await page.goto('/load/invalidation/route/shared/a');
		expect(await page.textContent('h1')).toBe('route.id: /load/invalidation/route/shared/a');

		await clicknav('[href="/load/invalidation/route/shared/b"]');
		expect(await page.textContent('h1')).toBe('route.id: /load/invalidation/route/shared/b');
	});

	test('route.id does not rerun layout if unchanged', async ({ page, clicknav }) => {
		await page.goto('/load/invalidation/route/shared/unchanged-x');
		expect(await page.textContent('h1')).toBe('route.id: /load/invalidation/route/shared/[x]');
		const id = await page.textContent('h2');

		await clicknav('[href="/load/invalidation/route/shared/unchanged-y"]');
		expect(await page.textContent('h1')).toBe('route.id: /load/invalidation/route/shared/[x]');
		expect(await page.textContent('h2')).toBe(id);
	});

	test('$page.url can safely be mutated', async ({ page }) => {
		await page.goto('/load/mutated-url?q=initial');
		await expect(page.getByText('initial')).toBeVisible();

		await page.locator('button').click();
		await expect(page.getByText('updated')).toBeVisible();
	});

	test('goto after invalidation does not reset state', async ({ page }) => {
		await page.goto('/load/invalidation/invalidate-then-goto');
		const layout = await page.textContent('p.layout');
		const _page = await page.textContent('p.page');
		expect(layout).toBeDefined();
		expect(_page).toBeDefined();

		await page.click('button.invalidate');
		await page.evaluate(() => window.promise);
		const next_layout_1 = await page.textContent('p.layout');
		const next_page_1 = await page.textContent('p.page');
		expect(next_layout_1).not.toBe(layout);
		expect(next_page_1).toBe(_page);

		await page.click('button.goto');
		await page.evaluate(() => window.promise);
		const next_layout_2 = await page.textContent('p.layout');
		const next_page_2 = await page.textContent('p.page');
		expect(next_layout_2).toBe(next_layout_1);
		expect(next_page_2).not.toBe(next_page_1);
	});
});

test.describe('data-sveltekit attributes', () => {
	test('data-sveltekit-preload-data', async ({ page }) => {
		/** @type {string[]} */
		const requests = [];
		page.on('request', (req) => {
			if (req.resourceType() === 'script') {
				req
					.response()
					.then(
						(res) => res.text(),
						() => ''
					)
					.then((response) => {
						if (response.includes('this string should only appear in this preloaded file')) {
							requests.push(req.url());
						}
					});
			}
		});

		await page.goto('/data-sveltekit/preload-data');
		await page.locator('#one').dispatchEvent('mousemove');
		await Promise.all([
			page.waitForTimeout(100), // wait for preloading to start
			page.waitForLoadState('networkidle') // wait for preloading to finish
		]);
		expect(requests.length).toBe(1);

		requests.length = 0;
		await page.goto('/data-sveltekit/preload-data');
		await page.locator('#two').dispatchEvent('mousemove');
		await Promise.all([
			page.waitForTimeout(100), // wait for preloading to start
			page.waitForLoadState('networkidle') // wait for preloading to finish
		]);
		expect(requests.length).toBe(1);

		requests.length = 0;
		await page.goto('/data-sveltekit/preload-data');
		await page.locator('#three').dispatchEvent('mousemove');
		await Promise.all([
			page.waitForTimeout(100), // wait for preloading to start
			page.waitForLoadState('networkidle') // wait for preloading to finish
		]);
		expect(requests.length).toBe(0);
	});

	test('data-sveltekit-preload-data network failure does not trigger navigation', async ({
		page,
		context,
		browserName
	}) => {
		await page.goto('/data-sveltekit/preload-data/offline');

		await context.setOffline(true);

		await page.locator('#one').dispatchEvent('mousemove');
		await Promise.all([
			page.waitForTimeout(100), // wait for preloading to start
			page.waitForLoadState('networkidle') // wait for preloading to finish
		]);

		let offline_url = /\/data-sveltekit\/preload-data\/offline/;
		if (browserName === 'chromium') {
			// it's chrome-error://chromewebdata/ on ubuntu but not on windows
			offline_url = /chrome-error:\/\/chromewebdata\/|\/data-sveltekit\/preload-data\/offline/;
		}
		expect(page).toHaveURL(offline_url);
	});

	test('data-sveltekit-preload-data error does not block user navigation', async ({
		page,
		context,
		browserName
	}) => {
		await page.goto('/data-sveltekit/preload-data/offline');

		await context.setOffline(true);

		await page.locator('#one').dispatchEvent('mousemove');
		await Promise.all([
			page.waitForTimeout(100), // wait for preloading to start
			page.waitForLoadState('networkidle') // wait for preloading to finish
		]);

		expect(page).toHaveURL('/data-sveltekit/preload-data/offline');

		await page.locator('#one').dispatchEvent('click');
		await page.waitForTimeout(100); // wait for navigation to start
		await page.waitForLoadState('networkidle');

		let offline_url = /\/data-sveltekit\/preload-data\/offline/;
		if (browserName === 'chromium') {
			// it's chrome-error://chromewebdata/ on ubuntu but not on windows
			offline_url = /chrome-error:\/\/chromewebdata\/|\/data-sveltekit\/preload-data\/offline/;
		}
		expect(page).toHaveURL(offline_url);
	});

	test('data-sveltekit-preload does not abort ongoing navigation', async ({ page }) => {
		await page.goto('/data-sveltekit/preload-data/offline');

		await page.locator('#slow-navigation').dispatchEvent('click');
		await page.waitForTimeout(100); // wait for navigation to start
		await page.locator('#slow-navigation').dispatchEvent('mousemove');
		await Promise.all([
			page.waitForTimeout(100), // wait for preloading to start
			page.waitForLoadState('networkidle') // wait for preloading to finish
		]);

		expect(page).toHaveURL('/data-sveltekit/preload-data/offline/slow-navigation');
	});

	test('data-sveltekit-reload', async ({ baseURL, page, clicknav }) => {
		/** @type {string[]} */
		const requests = [];
		page.on('request', (r) => requests.push(r.url()));

		await page.goto('/data-sveltekit/reload');
		await clicknav('#one');
		expect(requests).toContain(`${baseURL}/data-sveltekit/reload/target`);

		requests.length = 0;
		await page.goto('/data-sveltekit/reload');
		await clicknav('#two');
		expect(requests).toContain(`${baseURL}/data-sveltekit/reload/target`);

		requests.length = 0;
		await page.goto('/data-sveltekit/reload');
		await clicknav('#three');
		expect(requests).not.toContain(`${baseURL}/data-sveltekit/reload/target`);
	});

	test('data-sveltekit-noscroll', async ({ page, clicknav }) => {
		await page.goto('/data-sveltekit/noscroll');
		// await page.evaluate(() => window.scrollTo(0, 1000));
		await clicknav('#one');
		expect(await page.evaluate(() => window.scrollY)).toBeGreaterThan(1000);

		await page.goto('/data-sveltekit/noscroll');
		await clicknav('#two');
		expect(await page.evaluate(() => window.scrollY)).toBeGreaterThan(1000);

		await page.goto('/data-sveltekit/noscroll');
		// await page.evaluate(() => window.scrollTo(0, 1000));
		await clicknav('#three');
		expect(await page.evaluate(() => window.scrollY)).toBe(0);
	});

	test('data-sveltekit-replacestate', async ({ page, clicknav }) => {
		await page.goto('/');
		await page.goto('/data-sveltekit/replacestate');
		await clicknav('#one');
		await page.goBack();
		await expect(page).not.toHaveURL(/replacestate/);

		await page.goto('/');
		await page.goto('/data-sveltekit/replacestate');
		await clicknav('#two');
		await page.goBack();
		await expect(page).not.toHaveURL(/replacestate/);

		await page.goto('/');
		await page.goto('/data-sveltekit/replacestate');
		await clicknav('#three');
		await page.goBack();
		await expect(page).toHaveURL(/replacestate$/);
	});
});

test.describe('Content negotiation', () => {
	test('+server.js next to +page.svelte works', async ({ page }) => {
		const response = await page.goto('/routing/content-negotiation');

		expect(response.headers()['vary']).toBe('Accept');
		expect(await page.textContent('p')).toBe('Hi');

		const pre = page.locator('pre');
		for (const method of ['GET', 'PUT', 'PATCH', 'POST', 'DELETE']) {
			await page.click(`button:has-text("${method}")`);
			await expect(pre).toHaveText(method);
		}
	});

	test('use:enhance uses action, not POST handler', async ({ page }) => {
		await page.goto('/routing/content-negotiation');

		await Promise.all([
			page.waitForResponse('/routing/content-negotiation'),
			page.click('button:has-text("Submit")')
		]);

		await expect(page.locator('[data-testid="form-result"]')).toHaveText('form.submitted: true');
	});
});

test.describe('env', () => {
	test('can access public env in app.html', async ({ page }) => {
		await page.goto('/');
		expect(await page.locator('body').getAttribute('class')).toContain('groovy');
	});

	test('can access public env in hooks.client.js', async ({ page }) => {
		await page.goto('/');
		expect(await page.evaluate(() => window.PUBLIC_DYNAMIC)).toBe(
			'accessible anywhere/evaluated at run time'
		);
	});

	test('uses correct dynamic env when navigating from prerendered page', async ({
		page,
		clicknav
	}) => {
		await page.goto('/prerendering/env/prerendered');
		await clicknav('[href="/prerendering/env/dynamic"]');
		expect(await page.locator('h2')).toHaveText('prerendering: false');
	});
});

test.describe('Snapshots', () => {
	test('recovers snapshotted data', async ({ page, clicknav }) => {
		await page.goto('/snapshot/a');

		let input = page.locator('input');
		await input.type('hello');

		await clicknav('[href="/snapshot/b"]');
		await page.goBack();

		input = page.locator('input');
		expect(await input.inputValue()).toBe('hello');

		await input.clear();
		await input.type('works for cross-document navigations');

		await clicknav('[href="/snapshot/c"]');
		await page.goBack();
		expect(await page.locator('input').inputValue()).toBe('works for cross-document navigations');

		input = page.locator('input');
		await input.clear();
		await input.type('works for reloads');

		await page.reload();
		expect(await page.locator('input').inputValue()).toBe('works for reloads');
	});
});

test.describe('Streaming', () => {
	test('Works for universal load functions (client nav)', async ({ page }) => {
		await page.goto('/streaming');
		page.click('[href="/streaming/universal"]');

		await expect(page.locator('p.eager')).toHaveText('eager');
		expect(page.locator('p.loadingsuccess')).toBeVisible();
		expect(page.locator('p.loadingfail')).toBeVisible();

		await expect(page.locator('p.success')).toHaveText('success');
		await expect(page.locator('p.fail')).toHaveText('fail');
		expect(page.locator('p.loadingsuccess')).toBeHidden();
		expect(page.locator('p.loadingfail')).toBeHidden();
	});

	test('Works for server load functions (client nav)', async ({ page }) => {
		await page.goto('/streaming');
		page.click('[href="/streaming/server"]');

		await expect(page.locator('p.eager')).toHaveText('eager');
		expect(page.locator('p.loadingsuccess')).toBeVisible();
		expect(page.locator('p.loadingfail')).toBeVisible();

		await expect(page.locator('p.success', { timeout: 15000 })).toHaveText('success');
		await expect(page.locator('p.fail', { timeout: 15000 })).toHaveText(
			'fail (500 Internal Error)'
		);
		expect(page.locator('p.loadingsuccess')).toBeHidden();
		expect(page.locator('p.loadingfail')).toBeHidden();
	});

	test('Catches fetch errors from server load functions (client nav)', async ({ page }) => {
		await page.goto('/streaming');
		page.click('[href="/streaming/server-error"]');

		await expect(page.locator('p.eager')).toHaveText('eager');
		expect(page.locator('p.fail')).toBeVisible();
	});

	// TODO `vite preview` buffers responses, causing these tests to fail
	if (process.env.DEV) {
		test('Works for universal load functions (direct hit)', async ({ page }) => {
			page.goto('/streaming/universal');

			// Write first assertion like this to control the retry interval. Else it might happen that
			// the test fails because the next retry is too late (probably uses a back-off strategy)
			await expect(async () => {
				expect(await page.locator('p.eager').textContent()).toBe('eager');
			}).toPass({
				intervals: [100]
			});

			expect(page.locator('p.loadingsuccess')).toBeVisible();
			expect(page.locator('p.loadingfail')).toBeVisible();

			await expect(page.locator('p.success')).toHaveText('success');
			await expect(page.locator('p.fail')).toHaveText('fail');
			expect(page.locator('p.loadingsuccess')).toBeHidden();
			expect(page.locator('p.loadingfail')).toBeHidden();
		});

		test('Works for server load functions (direct hit)', async ({ page }) => {
			page.goto('/streaming/server');

			// Write first assertion like this to control the retry interval. Else it might happen that
			// the test fails because the next retry is too late (probably uses a back-off strategy)
			await expect(async () => {
				expect(await page.locator('p.eager').textContent()).toBe('eager');
			}).toPass({
				intervals: [100]
			});

			expect(page.locator('p.loadingsuccess')).toBeVisible();
			expect(page.locator('p.loadingfail')).toBeVisible();

			await expect(page.locator('p.success')).toHaveText('success');
			await expect(page.locator('p.fail')).toHaveText('fail (500 Internal Error)');
			expect(page.locator('p.loadingsuccess')).toBeHidden();
			expect(page.locator('p.loadingfail')).toBeHidden();
		});

		test('Catches fetch errors from server load functions (direct hit)', async ({ page }) => {
			page.goto('/streaming/server-error');
			await expect(page.locator('p.eager')).toHaveText('eager');
			await expect(page.locator('p.fail')).toHaveText('fail');
		});
	}
});

test.describe('Actions', () => {
	test('page store has correct data', async ({ page }) => {
		await page.goto('/actions/enhance');
		const pre = page.locator('pre.data1');

		await expect(pre).toHaveText('prop: 0, store: 0');
		await page.locator('.form4').click();
		await expect(pre).toHaveText('prop: 1, store: 1');
		await page.evaluate('window.svelte_tick()');
		await expect(pre).toHaveText('prop: 1, store: 1');
	});
});

test.describe('Assets', () => {
	test('only one link per stylesheet', async ({ page }) => {
		if (process.env.DEV) return;

		await page.goto('/');

		expect(
			await page.evaluate(() => {
				const links = Array.from(document.head.querySelectorAll('link[rel=stylesheet]'));

				for (let i = 0; i < links.length; ) {
					const link = links.shift();
					const asset_name = link.href.split('/').at(-1);
					if (links.some((link) => link.href.includes(asset_name))) {
						return false;
					}
				}

				return true;
			})
		).toBe(true);
	});
});

test.describe('goto', () => {
	test('goto fails with external URL', async ({ page }) => {
		await page.goto('/goto');
		await page.click('button');

		const message = process.env.DEV
			? 'Cannot use `goto` with an external URL. Use `window.location = "https://example.com/"` instead'
			: 'goto: invalid URL';
		await expect(page.locator('p')).toHaveText(message);
	});
});

test.describe('untrack', () => {
	test('untracks server load function', async ({ page, clicknav }) => {
		await page.goto('/untrack/server/1');
		expect(await page.textContent('p.url')).toBe('/untrack/server/1');
		const id = await page.textContent('p.id');
		await clicknav('a[href="/untrack/server/2"]');
		expect(await page.textContent('p.url')).toBe('/untrack/server/2');
		expect(await page.textContent('p.id')).toBe(id);
	});

	test('untracks universal load function', async ({ page }) => {
		await page.goto('/untrack/universal/1');
		expect(await page.textContent('p.url')).toBe('/untrack/universal/1');
		const id = await page.textContent('p.id');
		await page.click('a[href="/untrack/universal/2"]');
		expect(await page.textContent('p.url')).toBe('/untrack/universal/2');
		expect(await page.textContent('p.id')).toBe(id);
	});
});

test.describe('Shallow routing', () => {
	test('Pushes state to the current URL', async ({ page }) => {
		await page.goto('/shallow-routing/push-state');
		await expect(page.locator('p')).toHaveText('active: false');

		await page.locator('[data-id="one"]').click();
		await expect(page.locator('p')).toHaveText('active: true');

		await page.goBack();
		await expect(page.locator('p')).toHaveText('active: false');
	});

	test('Pushes state to a new URL', async ({ baseURL, page }) => {
		await page.goto('/shallow-routing/push-state');
		await expect(page.locator('p')).toHaveText('active: false');

		await page.locator('[data-id="two"]').click();
		expect(page.url()).toBe(`${baseURL}/shallow-routing/push-state/a`);
		await expect(page.locator('h1')).toHaveText('parent');
		await expect(page.locator('p')).toHaveText('active: true');

		await page.reload();
		await expect(page.locator('h1')).toHaveText('a');
		await expect(page.locator('p')).toHaveText('active: false');

		await page.goBack();
		expect(page.url()).toBe(`${baseURL}/shallow-routing/push-state`);
		await expect(page.locator('h1')).toHaveText('parent');
		await expect(page.locator('p')).toHaveText('active: false');

		await page.goForward();
		expect(page.url()).toBe(`${baseURL}/shallow-routing/push-state/a`);
		await expect(page.locator('h1')).toHaveText('parent');
		await expect(page.locator('p')).toHaveText('active: true');
	});

	test('Invalidates the correct route after pushing state to a new URL', async ({
		baseURL,
		page
	}) => {
		await page.goto('/shallow-routing/push-state');
		await expect(page.locator('p')).toHaveText('active: false');

		const now = await page.locator('span').textContent();

		await page.locator('[data-id="two"]').click();
		expect(page.url()).toBe(`${baseURL}/shallow-routing/push-state/a`);

		await page.locator('[data-id="invalidate"]').click();
		await expect(page.locator('h1')).toHaveText('parent');
		await expect(page.locator('span')).not.toHaveText(now);
	});

	test('Does not navigate when going back to shallow route', async ({ baseURL, page }) => {
		await page.goto('/shallow-routing/push-state');
		await page.locator('[data-id="two"]').click();
		await page.goBack();
		await page.goForward();

		expect(page.url()).toBe(`${baseURL}/shallow-routing/push-state/a`);
		await expect(page.locator('h1')).toHaveText('parent');
		await expect(page.locator('p')).toHaveText('active: true');
	});

	test('Replaces state on the current URL', async ({ baseURL, page, clicknav }) => {
		await page.goto('/shallow-routing/replace-state/b');
		await clicknav('[href="/shallow-routing/replace-state"]');

		await page.locator('[data-id="one"]').click();
		await expect(page.locator('p')).toHaveText('active: true');

		await page.goBack();
		expect(page.url()).toBe(`${baseURL}/shallow-routing/replace-state/b`);
		await expect(page.locator('h1')).toHaveText('b');

		await page.goForward();
		expect(page.url()).toBe(`${baseURL}/shallow-routing/replace-state`);
		await expect(page.locator('h1')).toHaveText('parent');
		await expect(page.locator('p')).toHaveText('active: true');
	});

	test('Replaces state on a new URL', async ({ baseURL, page, clicknav }) => {
		await page.goto('/shallow-routing/replace-state/b');
		await clicknav('[href="/shallow-routing/replace-state"]');

		await page.locator('[data-id="two"]').click();
		await expect(page.locator('p')).toHaveText('active: true');

		await page.goBack();
		expect(page.url()).toBe(`${baseURL}/shallow-routing/replace-state/b`);
		await expect(page.locator('h1')).toHaveText('b');

		await page.goForward();
		expect(page.url()).toBe(`${baseURL}/shallow-routing/replace-state/a`);
		await expect(page.locator('h1')).toHaveText('parent');
		await expect(page.locator('p')).toHaveText('active: true');
	});
});

test.describe('reroute', () => {
	test('Apply reroute during client side navigation', async ({ page }) => {
		await page.goto('/reroute/basic');
		await page.click("a[href='/reroute/basic/a']");
		expect(await page.textContent('h1')).toContain('Successfully rewritten');
	});

	test('Apply reroute after client-only redirects', async ({ page }) => {
		await page.goto('/reroute/client-only-redirect');
		expect(await page.textContent('h1')).toContain('Successfully rewritten');
	});

	test('Apply reroute to preload data', async ({ page }) => {
		await page.goto('/reroute/preload-data');
		await page.click('button');
		await page.waitForSelector('pre');
		expect(await page.textContent('pre')).toContain('"success": true');
	});

	test('reroute does not get applied to external URLs', async ({ page }) => {
		await page.goto('/reroute/external');
		const current_url = new URL(page.url());

		//click the link with the text External URL
		await page.click("a[data-test='external-url']");

		//The URl should not have the same origin as the current URL
		const new_url = new URL(page.url());
		expect(current_url.origin).not.toEqual(new_url.origin);
	});

	test('Falls back to native navigation if reroute throws on the client', async ({ page }) => {
		await page.goto('/reroute/error-handling');

		//click the link with the text External URL
		await page.click('a#client-error');

		expect(await page.textContent('h1')).toContain('Full Navigation');
	});
});

```


####### packages/kit/test/apps/basics/test/cross-platform/client.test.js #######

```

import { expect } from '@playwright/test';
import { test } from '../../../../utils.js';

/** @typedef {import('@playwright/test').Response} Response */

test.skip(({ javaScriptEnabled }) => !javaScriptEnabled);

test.describe.configure({ mode: 'parallel' });

test.describe('a11y', () => {
	test('resets focus', async ({ page, clicknav, browserName }) => {
		const tab = browserName === 'webkit' ? 'Alt+Tab' : 'Tab';

		await page.goto('/accessibility/a');

		await clicknav('[href="/accessibility/b"]');
		expect(await page.innerHTML('h1')).toBe('b');
		expect(await page.evaluate(() => (document.activeElement || {}).nodeName)).toBe('BODY');
		await page.keyboard.press(tab);

		expect(await page.evaluate(() => (document.activeElement || {}).nodeName)).toBe('BUTTON');
		expect(await page.evaluate(() => (document.activeElement || {}).textContent)).toBe('focus me');

		await clicknav('[href="/accessibility/a"]');
		expect(await page.innerHTML('h1')).toBe('a');
		expect(await page.evaluate(() => (document.activeElement || {}).nodeName)).toBe('BODY');

		await page.keyboard.press(tab);
		expect(await page.evaluate(() => (document.activeElement || {}).nodeName)).toBe('BUTTON');
		expect(await page.evaluate(() => (document.activeElement || {}).textContent)).toBe('focus me');

		expect(await page.evaluate(() => document.documentElement.getAttribute('tabindex'))).toBe(null);
	});

	test('applies autofocus after a navigation', async ({ page, clicknav }) => {
		await page.goto('/accessibility/autofocus/a');

		await clicknav('[href="/accessibility/autofocus/b"]');
		expect(await page.innerHTML('h1')).toBe('b');
		expect(await page.evaluate(() => (document.activeElement || {}).nodeName)).toBe('INPUT');
	});

	test('announces client-side navigation', async ({ page, clicknav, javaScriptEnabled }) => {
		await page.goto('/accessibility/a');

		const has_live_region = (await page.innerHTML('body')).includes('aria-live');

		if (javaScriptEnabled) {
			expect(has_live_region).toBeTruthy();

			// live region should exist, but be empty
			expect(await page.innerHTML('[aria-live]')).toBe('');

			await clicknav('[href="/accessibility/b"]');
			expect(await page.innerHTML('[aria-live]')).toBe('b'); // TODO i18n
		} else {
			expect(has_live_region).toBeFalsy();
		}
	});

	test('reset selection', async ({ page, clicknav }) => {
		await page.goto('/selection/a');

		expect(
			await page.evaluate(() => {
				const range = document.createRange();
				range.selectNodeContents(document.body);
				const selection = getSelection();
				if (selection) {
					selection.removeAllRanges();
					selection.addRange(range);
					return selection.rangeCount;
				}
				return -1;
			})
		).toBe(1);

		await clicknav('[href="/selection/b"]');
		expect(
			await page.evaluate(() => {
				const selection = getSelection();
				if (selection) {
					return selection.rangeCount;
				}
				return -1;
			})
		).toBe(0);
	});

	test('keepfocus works', async ({ page }) => {
		await page.goto('/keepfocus');

		await Promise.all([
			page.type('#input', 'bar'),
			page.waitForFunction(() => window.location.search === '?foo=bar')
		]);
		await expect(page.locator('#input')).toBeFocused();
	});

	test('autofocus from previous page is ignored', async ({ page, clicknav }) => {
		page.addInitScript(`
			window.active = null;
			window.addEventListener('focusin', () => window.active = document.activeElement);
		`);

		await page.goto('/accessibility/autofocus/a');
		await clicknav('[href="/"]');

		expect(await page.evaluate(() => (window.active || {}).nodeName)).toBe('BODY');
		expect(await page.evaluate(() => (document.activeElement || {}).nodeName)).toBe('BODY');
	});
});

test.describe('Navigation lifecycle functions', () => {
	test('beforeNavigate prevents navigation triggered by link click', async ({ page, baseURL }) => {
		await page.goto('/navigation-lifecycle/before-navigate/prevent-navigation');

		await page.click('[href="/navigation-lifecycle/before-navigate/a"]');
		await page.waitForLoadState('networkidle');

		expect(page.url()).toBe(baseURL + '/navigation-lifecycle/before-navigate/prevent-navigation');
		expect(await page.innerHTML('pre')).toBe('1 false link');
	});

	test('beforeNavigate prevents navigation to external', async ({ page, baseURL }) => {
		await page.goto('/navigation-lifecycle/before-navigate/prevent-navigation');
		await page.click('h1'); // The browsers block attempts to prevent navigation on a frame that's never had a user gesture.

		page.on('dialog', (dialog) => dialog.dismiss());

		page.click('a[href="https://google.de"]'); // do NOT await this, promise only resolves after successful navigation, which never happens
		await page.waitForTimeout(500);
		await expect(page.locator('pre')).toHaveText('1 true link');
		expect(page.url()).toBe(baseURL + '/navigation-lifecycle/before-navigate/prevent-navigation');
	});

	test('beforeNavigate prevents navigation triggered by goto', async ({ page, app, baseURL }) => {
		await page.goto('/navigation-lifecycle/before-navigate/prevent-navigation');
		await app.goto('/navigation-lifecycle/before-navigate/a');
		expect(page.url()).toBe(baseURL + '/navigation-lifecycle/before-navigate/prevent-navigation');
		expect(await page.innerHTML('pre')).toBe('1 false goto');
	});

	test('beforeNavigate prevents navigation triggered by back button', async ({
		page,
		app,
		baseURL
	}) => {
		await page.goto('/navigation-lifecycle/before-navigate/a');
		await app.goto('/navigation-lifecycle/before-navigate/prevent-navigation');
		await page.click('h1'); // The browsers block attempts to prevent navigation on a frame that's never had a user gesture.

		await page.goBack();
		expect(await page.innerHTML('pre')).toBe('1 false popstate');
		expect(page.url()).toBe(baseURL + '/navigation-lifecycle/before-navigate/prevent-navigation');
	});

	test('beforeNavigate prevents unload', async ({ page }) => {
		await page.goto('/navigation-lifecycle/before-navigate/prevent-navigation');
		await page.click('h1'); // The browsers block attempts to prevent navigation on a frame that's never had a user gesture.
		const type = new Promise((fulfil) => {
			page.on('dialog', async (dialog) => {
				fulfil(dialog.type());
				await dialog.dismiss();
			});
		});

		await page.close({ runBeforeUnload: true });
		expect(await type).toBe('beforeunload');
		expect(await page.innerHTML('pre')).toBe('1 true leave');
	});

	test('beforeNavigate is not triggered on redirect', async ({ page, baseURL }) => {
		await page.goto('/navigation-lifecycle/before-navigate/prevent-navigation');

		await page.click('[href="/navigation-lifecycle/before-navigate/redirect"]');
		await page.waitForLoadState('networkidle');

		expect(page.url()).toBe(baseURL + '/navigation-lifecycle/before-navigate/prevent-navigation');
		expect(await page.innerHTML('pre')).toBe('1 false link');
	});

	test('beforeNavigate is not triggered on target=_blank', async ({ page, baseURL }) => {
		await page.goto('/navigation-lifecycle/before-navigate/prevent-navigation');

		await page.click('a[href="https://google.com"]');
		await page.waitForTimeout(500);

		expect(page.url()).toBe(baseURL + '/navigation-lifecycle/before-navigate/prevent-navigation');
		expect(await page.innerHTML('pre')).toBe('0 false undefined');
	});

	test('beforeNavigate is not triggered on click or popstate for hash links', async ({ page }) => {
		await page.goto('/navigation-lifecycle/before-navigate/hash-links');

		await page.click('a[href="#x"]');
		await page.goBack();
		expect(await page.textContent('h1')).toBe('before_navigate_ran: false');
	});

	test('beforeNavigate cancel() on an unloading navigation does not prevent subsequent beforeNavigate callbacks', async ({
		page,
		app
	}) => {
		await page.goto('/navigation-lifecycle/before-navigate/prevent-navigation');
		await page.click('h1'); // The browsers block attempts to prevent navigation on a frame that's never had a user gesture.
		page.on('dialog', async (dialog) => {
			await dialog.dismiss();
		});
		await page.close({ runBeforeUnload: true });
		await page.waitForTimeout(100);
		await app.goto('/navigation-lifecycle/before-navigate/prevent-navigation?x=1');

		expect(await page.innerHTML('pre')).toBe('2 false goto');
	});

	test('beforeNavigate is triggered after clicking a download link', async ({ page, baseURL }) => {
		await page.goto('/navigation-lifecycle/before-navigate/prevent-navigation');

		await page.click('a[download]');
		expect(await page.innerHTML('pre')).toBe('0 false undefined');

		await page.click('a[href="/navigation-lifecycle/before-navigate/a"]');

		expect(page.url()).toBe(baseURL + '/navigation-lifecycle/before-navigate/prevent-navigation');
		expect(await page.innerHTML('pre')).toBe('1 false link');
	});

	test('afterNavigate calls callback', async ({ page, clicknav }) => {
		await page.goto('/navigation-lifecycle/after-navigate/a');
		expect(await page.textContent('h1')).toBe(
			'undefined -> /navigation-lifecycle/after-navigate/a'
		);

		await clicknav('[href="/navigation-lifecycle/after-navigate/b"]');
		expect(await page.textContent('h1')).toBe(
			'/navigation-lifecycle/after-navigate/a -> /navigation-lifecycle/after-navigate/b'
		);
	});

	test('onNavigate calls callback', async ({ page, clicknav }) => {
		await page.goto('/navigation-lifecycle/on-navigate/a');
		expect(await page.textContent('h1')).toBe('undefined -> undefined (...) false');

		await clicknav('[href="/navigation-lifecycle/on-navigate/b"]');
		expect(await page.textContent('h1')).toBe(
			'/navigation-lifecycle/on-navigate/a -> /navigation-lifecycle/on-navigate/b (link) true'
		);
	});
});

test.describe('Scrolling', () => {
	test('url-supplied anchor works on direct page load', async ({ page, in_view }) => {
		await page.goto('/anchor/anchor#go-to-element');
		expect(await in_view('#go-to-element')).toBe(true);
	});

	test('url-supplied anchor works on navigation to page', async ({ page, in_view, clicknav }) => {
		await page.goto('/anchor');
		await clicknav('#first-anchor');
		expect(await in_view('#go-to-element')).toBe(true);
	});

	test('url-supplied non-ascii anchor works on navigation to page', async ({
		page,
		in_view,
		clicknav
	}) => {
		await page.goto('/anchor');
		await clicknav('#non-ascii-anchor');
		expect(await in_view('#go-to-encöded')).toBe(true);
	});

	test('url-supplied anchor with special characters works on navigation to page', async ({
		page,
		in_view,
		clicknav
	}) => {
		await page.goto('/anchor');
		await clicknav('#special-char-anchor');
		expect(await in_view('.special-char-id')).toBe(true);
	});

	test('url-supplied anchor works when navigated from scrolled page', async ({
		page,
		clicknav,
		in_view
	}) => {
		await page.goto('/anchor');
		await clicknav('#second-anchor');
		expect(await in_view('#go-to-element')).toBe(true);
	});

	test('no-anchor url will scroll to top when navigated from scrolled page', async ({
		page,
		clicknav
	}) => {
		await page.goto('/anchor');
		await clicknav('#third-anchor');
		expect(await page.evaluate(() => scrollY)).toBe(0);
	});

	test('url-supplied anchor works when navigated from bottom of page', async ({
		page,
		clicknav,
		in_view
	}) => {
		await page.goto('/anchor');
		await clicknav('#last-anchor');
		expect(await in_view('#go-to-element')).toBe(true);
	});

	test('no-anchor url will scroll to top when navigated from bottom of page', async ({
		clicknav,
		page
	}) => {
		await page.goto('/anchor');
		await clicknav('#last-anchor-2');
		expect(await page.evaluate(() => scrollY)).toBe(0);
	});

	test('scroll is restored after hitting the back button', async ({ baseURL, clicknav, page }) => {
		await page.goto('/anchor');
		await page.locator('#scroll-anchor').click();
		const originalScrollY = /** @type {number} */ (await page.evaluate(() => scrollY));
		await clicknav('#routing-page');
		await page.goBack();
		await page.waitForLoadState('networkidle');
		expect(page.url()).toBe(baseURL + '/anchor#last-anchor-2');
		expect(await page.evaluate(() => scrollY)).toEqual(originalScrollY);

		await page.goBack();
		await page.waitForLoadState('networkidle');

		expect(page.url()).toBe(baseURL + '/anchor');
		expect(await page.evaluate(() => scrollY)).toEqual(0);
	});

	test('scroll is restored after hitting the back button for an in-app cross-document navigation', async ({
		page,
		clicknav
	}) => {
		await page.goto('/scroll/cross-document/a');

		const rect = await page.locator('[href="/scroll/cross-document/b"]').boundingBox();
		const height = await page.evaluate(() => innerHeight);
		if (!rect) throw new Error('Could not determine bounding box');

		const target_scroll_y = rect.y + rect.height - height;
		await page.evaluate((y) => scrollTo(0, y), target_scroll_y);

		await page.locator('[href="/scroll/cross-document/b"]').click();
		expect(await page.textContent('h1')).toBe('b');
		await page.waitForSelector('body.started');

		await clicknav('[href="/scroll/cross-document/c"]');
		expect(await page.textContent('h1')).toBe('c');

		await page.goBack(); // client-side back
		await page.goBack(); // native back
		expect(await page.textContent('h1')).toBe('a');
		await page.waitForSelector('body.started');

		await page.waitForTimeout(250); // needed for the test to fail reliably without the fix

		const scroll_y = await page.evaluate(() => scrollY);

		expect(Math.abs(scroll_y - target_scroll_y)).toBeLessThan(50); // we need a few pixels wiggle room, because browsers
	});

	test('url-supplied anchor is ignored with onMount() scrolling on direct page load', async ({
		page,
		in_view
	}) => {
		await page.goto('/anchor-with-manual-scroll/anchor-onmount#go-to-element');
		expect(await in_view('#abcde')).toBe(true);
	});

	test('url-supplied anchor is ignored with afterNavigate() scrolling on direct page load', async ({
		page,
		in_view,
		clicknav
	}) => {
		await page.goto('/anchor-with-manual-scroll/anchor-afternavigate#go-to-element');
		expect(await in_view('#abcde')).toBe(true);

		await clicknav('[href="/anchor-with-manual-scroll/anchor-afternavigate?x=y#go-to-element"]');
		expect(await in_view('#abcde')).toBe(true);
	});

	test('url-supplied anchor is ignored with onMount() scrolling on navigation to page', async ({
		page,
		clicknav,
		javaScriptEnabled,
		in_view
	}) => {
		await page.goto('/anchor-with-manual-scroll');
		await clicknav('[href="/anchor-with-manual-scroll/anchor-onmount#go-to-element"]');
		if (javaScriptEnabled) expect(await in_view('#abcde')).toBe(true);
		else expect(await in_view('#go-to-element')).toBe(true);
	});

	test('app-supplied scroll and focus work on direct page load', async ({ page, in_view }) => {
		await page.goto('/use-action/focus-and-scroll');
		expect(await in_view('#input')).toBe(true);
		await expect(page.locator('#input')).toBeFocused();
	});

	test('app-supplied scroll and focus work on navigation to page', async ({
		page,
		clicknav,
		in_view
	}) => {
		await page.goto('/use-action');
		await clicknav('[href="/use-action/focus-and-scroll"]');
		expect(await in_view('#input')).toBe(true);
		await expect(page.locator('input')).toBeFocused();
	});

	test('scroll positions are recovered on reloading the page', async ({
		page,
		app,
		browserName
	}) => {
		// No idea why the workaround below works only in dev mode
		// A better solution would probably be to set fission.webContentIsolationStrategy: 1
		// in the Firefox preferences but the Playwright API to do so is incomprehensible
		if (!process.env.DEV && browserName === 'firefox') {
			return;
		}

		await page.goto('/anchor');
		await page.evaluate(() => window.scrollTo(0, 1000));
		await app.goto('/anchor/anchor');
		await page.evaluate(() => window.scrollTo(0, 1000));

		await page.reload();
		if (browserName === 'firefox') {
			// Firefox with Playwright pushed new history entry history after reload
			// See https://github.com/microsoft/playwright/issues/22640
			await page.goBack();
		}
		expect(await page.evaluate(() => window.scrollY)).toBe(1000);

		await page.goBack();
		expect(await page.evaluate(() => window.scrollY)).toBe(1000);
	});

	test('scroll position is top of page on ssr:false reload', async ({ page }) => {
		await page.goto('/no-ssr/margin');
		expect(await page.evaluate(() => window.scrollY)).toBe(0);
		await page.reload();
		expect(await page.evaluate(() => window.scrollY)).toBe(0);
	});

	test('clicking # or #top takes you to the top of the current page', async ({ page }) => {
		await page.goto('/scroll/top');

		for (const href of ['#', '#top']) {
			await page.evaluate(() => window.scrollTo(0, 1000));
			await page.click(`a[href="${href}"]`);
			expect(await page.evaluate(() => window.scrollY)).toBe(0);

			await page.evaluate(() => window.scrollTo(0, 1000));
			await page.click(`a[href="${href}"]`);
			expect(await page.evaluate(() => window.scrollY)).toBe(0);
		}
	});

	test('Scroll position is correct after going back from a shallow route', async ({ page }) => {
		await page.goto('/scroll/push-state');
		await page.locator('#subpage-link').click();
		await page.locator('#back-button').click();

		await page.evaluate(() => window.scrollTo(0, 9999));

		const scroll = await page.evaluate(() => window.scrollY);
		expect(scroll).toBeGreaterThan(0);

		await page.locator('#shallow-button').click();
		await page.locator('#back-button').click();

		expect(await page.evaluate(() => window.scrollY)).toBe(scroll);
	});
});

test.describe('CSS', () => {
	test('applies generated component styles (hides announcer)', async ({
		page,
		clicknav,
		get_computed_style
	}) => {
		await page.goto('/css');
		await clicknav('[href="/css/other"]');

		expect(await get_computed_style('#svelte-announcer', 'position')).toBe('absolute');
	});
});

test.describe.serial('Errors', () => {
	test('client-side load errors', async ({ page }) => {
		await page.goto('/errors/load-client');

		expect(await page.textContent('footer')).toBe('Custom layout');
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Crashing now (500 Internal Error)"'
		);
	});

	test('client-side module context errors', async ({ page }) => {
		await page.goto('/errors/module-scope-client');

		expect(await page.textContent('footer')).toBe('Custom layout');
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Crashing now (500 Internal Error)"'
		);
	});

	test('client-side error from load()', async ({ page }) => {
		await page.goto('/errors/load-error-client');

		expect(await page.textContent('footer')).toBe('Custom layout');
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Not found"'
		);
		expect(await page.innerHTML('h1')).toBe('555');
	});

	test('client-side 4xx status without error from load()', async ({ page }) => {
		await page.goto('/errors/load-status-without-error-client');

		expect(await page.textContent('footer')).toBe('Custom layout');
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Error: 401"'
		);
		expect(await page.innerHTML('h1')).toBe('401');
	});

	test('Root error falls back to error.html (unexpected error)', async ({ page, clicknav }) => {
		await page.goto('/errors/error-html');
		await clicknav('button:text-is("Unexpected")');

		expect(await page.textContent('h1')).toBe('Error - 500');
		expect(await page.textContent('p')).toBe(
			'This is the static error page with the following message: Failed to load (500 Internal Error)'
		);
	});

	test('Root error falls back to error.html (expected error)', async ({ page, clicknav }) => {
		await page.goto('/errors/error-html');
		await clicknav('button:text-is("Expected")');

		expect(await page.textContent('h1')).toBe('Error - 401');
		expect(await page.textContent('p')).toBe(
			'This is the static error page with the following message: Not allowed'
		);
	});

	test('Root 404 redirects somewhere due to root layout', async ({ page, baseURL, clicknav }) => {
		await page.goto('/errors/error-html');
		await clicknav('button:text-is("Redirect")');
		expect(page.url()).toBe(baseURL + '/load');
	});
});

test.describe('Prefetching', () => {
	test('prefetches programmatically', async ({ baseURL, page, app }) => {
		await page.goto('/routing/a');

		/** @type {string[]} */
		let requests = [];
		page.on('request', (r) => requests.push(r.url()));

		// also wait for network processing to complete, see
		// https://playwright.dev/docs/network#network-events
		await Promise.all([
			page.waitForResponse(`${baseURL}/routing/preloading/preloaded.json`),
			app.preloadData('/routing/preloading/preloaded')
		]);

		// svelte request made is environment dependent
		if (process.env.DEV) {
			expect(requests.filter((req) => req.endsWith('+page.svelte')).length).toBe(1);
		} else {
			// the preload helper causes an additional request to be made in Firefox,
			// so we use toBeGreaterThan rather than toBe
			expect(requests.filter((req) => req.endsWith('.js')).length).toBeGreaterThan(0);
		}

		expect(requests.includes(`${baseURL}/routing/preloading/preloaded.json`)).toBe(true);

		requests = [];
		await app.goto('/routing/preloading/preloaded');
		expect(requests).toEqual([]);

		try {
			await app.preloadData('https://example.com');
			throw new Error('Error was not thrown');
		} catch (/** @type {any} */ e) {
			expect(e.message).toMatch('Attempted to preload a URL that does not belong to this app');
		}
	});

	test('chooses correct route when hash route is preloaded but regular route is clicked', async ({
		app,
		page
	}) => {
		await page.goto('/routing/a');
		await app.preloadData('/routing/preloading/hash-route#please-dont-show-me');
		await app.goto('/routing/preloading/hash-route');
		await expect(page.locator('h1')).not.toHaveText('Oopsie');
	});

	test('does not rerun load on calls to duplicate preload hash route', async ({ app, page }) => {
		await page.goto('/routing/a');

		await app.preloadData('/routing/preloading/hash-route#please-dont-show-me');
		await app.preloadData('/routing/preloading/hash-route#please-dont-show-me');
		await app.goto('/routing/preloading/hash-route#please-dont-show-me');
		await expect(page.locator('p')).toHaveText('Loaded 1 times.');
	});

	test('does not rerun load on calls to different preload hash route', async ({ app, page }) => {
		await page.goto('/routing/a');

		await app.preloadData('/routing/preloading/hash-route#please-dont-show-me');
		await app.preloadData('/routing/preloading/hash-route#please-dont-show-me-jr');
		await app.goto('/routing/preloading/hash-route#please-dont-show-me');
		await expect(page.locator('p')).toHaveText('Loaded 1 times.');
	});

	test('does rerun load when preload errored', async ({ app, page }) => {
		await page.goto('/routing/a');

		await app.preloadData('/routing/preloading/preload-error');
		await app.goto('/routing/preloading/preload-error');
		await expect(page.locator('p')).toHaveText('hello');
	});
});

test.describe('Routing', () => {
	test('navigates to a new page without reloading', async ({ app, page, clicknav }) => {
		await page.goto('/routing');

		await app.preloadData('/routing/a').catch((e) => {
			// from error handler tests; ignore
			if (!e.message.includes('Crashing now')) throw e;
		});

		/** @type {string[]} */
		const requests = [];
		page.on('request', (r) => requests.push(r.url()));

		await clicknav('a[href="/routing/a"]');
		expect(await page.textContent('h1')).toBe('a');

		expect(requests.filter((url) => !url.endsWith('/favicon.png'))).toEqual([]);
	});

	test('navigates programmatically', async ({ page, app }) => {
		await page.goto('/routing/a');
		await app.goto('/routing/b');
		expect(await page.textContent('h1')).toBe('b');
	});

	test('$page.url.hash is correctly set on page load', async ({ page }) => {
		await page.goto('/routing/hashes/pagestore#target');
		expect(await page.textContent('#window-hash')).toBe('#target');
		expect(await page.textContent('#page-url-hash')).toBe('#target');
	});

	test('$page.url.hash is correctly set on navigation', async ({ page }) => {
		await page.goto('/routing/hashes/pagestore');
		expect(await page.textContent('#window-hash')).toBe('');
		expect(await page.textContent('#page-url-hash')).toBe('');
		await page.locator('[href="#target"]').click();
		expect(await page.textContent('#window-hash')).toBe('#target');
		expect(await page.textContent('#page-url-hash')).toBe('#target');
		await page.locator('[href="/routing/hashes/pagestore"]').click();
		await expect(page.locator('#window-hash')).toHaveText('#target'); // hashchange doesn't fire for these
		await expect(page.locator('#page-url-hash')).toHaveText('');
		await page.goBack();
		expect(await page.textContent('#window-hash')).toBe('#target');
		expect(await page.textContent('#page-url-hash')).toBe('#target');
	});

	test('back button returns to previous route when previous route has been navigated to via hash anchor', async ({
		page,
		clicknav
	}) => {
		await page.goto('/routing/hashes/a');

		await page.locator('[href="#hash-target"]').click();
		await clicknav('[href="/routing/hashes/b"]');

		await page.goBack();
		expect(await page.textContent('h1')).toBe('a');
	});

	test('replaces state if the data-sveltekit-replacestate router option is specified for the hash link', async ({
		page,
		clicknav,
		baseURL
	}) => {
		await page.goto('/routing/hashes/a');

		await clicknav('[href="#hash-target"]');
		await clicknav('[href="#replace-state"]');

		await page.goBack();
		expect(await page.url()).toBe(`${baseURL}/routing/hashes/a`);
	});

	test('does not normalize external path', async ({ page, start_server }) => {
		const html_ok = '<html><head></head><body>ok</body></html>';
		const { port } = await start_server((_req, res) => {
			res.end(html_ok);
		});

		await page.goto(`/routing/slashes?port=${port}`);
		await page.locator(`a[href="http://localhost:${port}/with-slash/"]`).click();
		expect(await page.content()).toBe(html_ok);
		expect(page.url()).toBe(`http://localhost:${port}/with-slash/`);
	});

	test('ignores popstate events from outside the router', async ({ page }) => {
		await page.goto('/routing/external-popstate');
		expect(await page.textContent('h1')).toBe('hello');

		await page.locator('button').click();
		expect(await page.textContent('h1')).toBe('hello');

		await page.goBack();
		expect(await page.textContent('h1')).toBe('hello');

		await page.goForward();
		expect(await page.textContent('h1')).toBe('hello');
	});

	test('recognizes clicks outside the app target', async ({ page }) => {
		await page.goto('/routing/link-outside-app-target/source');

		await page.locator('[href="/routing/link-outside-app-target/target"]').click();
		await expect(page.locator('h1')).toHaveText('target: 1');
	});

	test('responds to <form method="GET"> submission without reload', async ({ page }) => {
		await page.goto('/routing/form-get');
		expect(await page.textContent('h1')).toBe('...');
		expect(await page.textContent('h2')).toBe('enter');
		expect(await page.textContent('h3')).toBe('...');

		/** @type {string[]} */
		const requests = [];
		page.on('request', (request) => requests.push(request.url()));

		await page.locator('input').fill('updated');
		await page.locator('button').click();

		expect(requests).toEqual([]);
		expect(await page.textContent('h1')).toBe('updated');
		expect(await page.textContent('h2')).toBe('form');
		expect(await page.textContent('h3')).toBe('bar');
	});

	test('ignores links with no href', async ({ page }) => {
		await page.goto('/routing/missing-href');
		const selector = '[data-testid="count"]';

		expect(await page.textContent(selector)).toBe('count: 1');

		await page.locator(selector).click();
		expect(await page.textContent(selector)).toBe('count: 1');
	});

	test('trailing slash redirect', async ({ page, clicknav }) => {
		await page.goto('/routing/trailing-slash');

		await clicknav('a[href="/routing/trailing-slash/always"]');
		expect(new URL(page.url()).pathname).toBe('/routing/trailing-slash/always/');
		await expect(page.locator('p')).toHaveText('/routing/trailing-slash/always/');

		await clicknav('a[href="/routing/trailing-slash/never/"]');
		expect(new URL(page.url()).pathname).toBe('/routing/trailing-slash/never');
		await expect(page.locator('p')).toHaveText('/routing/trailing-slash/never');

		await clicknav('a[href="/routing/trailing-slash/ignore/"]');
		expect(new URL(page.url()).pathname).toBe('/routing/trailing-slash/ignore/');
		await expect(page.locator('p')).toHaveText('/routing/trailing-slash/ignore/');
	});

	test('trailing slash redirect works when navigating from root page', async ({
		page,
		clicknav
	}) => {
		await page.goto('/');
		await clicknav('a[href="/routing/trailing-slash/never/"]');
		expect(new URL(page.url()).pathname).toBe('/routing/trailing-slash/never');
		await expect(page.locator('p')).toHaveText('/routing/trailing-slash/never');
	});
});

test.describe('Shadow DOM', () => {
	test('client router captures anchors in shadow dom', async ({ app, page, clicknav }) => {
		await page.goto('/routing/shadow-dom');

		await app.preloadData('/routing/a').catch((e) => {
			// from error handler tests; ignore
			if (!e.message.includes('Crashing now')) throw e;
		});

		/** @type {string[]} */
		const requests = [];
		page.on('request', (r) => requests.push(r.url()));

		await clicknav('div[id="clickme"]');
		expect(await page.textContent('h1')).toBe('a');

		expect(requests.filter((url) => !url.endsWith('/favicon.png'))).toEqual([]);
	});
});

test.describe('cookies', () => {
	test('etag forwards cookies', async ({ page }) => {
		await page.goto('/cookies/forwarded-in-etag');
		await expect(page.locator('p')).toHaveText('foo=bar');
		await page.locator('button').click();
		await expect(page.locator('p')).toHaveText('foo=bar');
	});

	test("fetch during SSR doesn't un- and re-escape cookies", async ({ page }) => {
		await page.goto('/cookies/collect-without-re-escaping');
		await expect(page.locator('p')).toHaveText('cookie-special-characters="foo"');
	});
});

test.describe('Interactivity', () => {
	test('click events on removed elements are ignored', async ({ page }) => {
		let errored = false;

		page.on('pageerror', (err) => {
			console.error(err);
			errored = true;
		});

		await page.goto('/interactivity/toggle-element');
		expect(await page.textContent('button')).toBe('remove');

		await page.locator('button').click();
		expect(await page.textContent('button')).toBe('add');
		expect(await page.textContent('a')).toBe('add');

		await page.locator('a').filter({ hasText: 'add' }).click();
		expect(await page.textContent('a')).toBe('remove');

		expect(errored).toBe(false);
	});
});

test.describe('Load', () => {
	if (process.env.DEV) {
		test('using window.fetch does not cause false-positive warning', async ({ page, baseURL }) => {
			/** @type {string[]} */
			const warnings = [];
			page.on('console', (msg) => {
				if (msg.type() === 'warning') {
					warnings.push(msg.text());
				}
			});

			await page.goto('/load/window-fetch/outside-load');
			expect(await page.textContent('h1')).toBe('42');

			expect(warnings).not.toContain(
				`Loading ${baseURL}/load/window-fetch/data.json using \`window.fetch\`. For best results, use the \`fetch\` that is passed to your \`load\` function: https://kit.svelte.dev/docs/load#making-fetch-requests`
			);
		});
	}
});

```


####### packages/kit/test/apps/basics/test/cross-platform/server.test.js #######

```

import { expect } from '@playwright/test';
import { test } from '../../../../utils.js';

/** @typedef {import('@playwright/test').Response} Response */

test.skip(({ javaScriptEnabled }) => javaScriptEnabled);

test.describe.configure({ mode: 'parallel' });

test.describe('Static files', () => {
	test('Filenames are case-sensitive', async ({ request }) => {
		const response = await request.get('/static.JSON');
		expect(response.status()).toBe(404);
	});
});

```


####### packages/kit/test/apps/basics/test/cross-platform/test.js #######

```

import { expect } from '@playwright/test';
import { test } from '../../../../utils.js';

/** @typedef {import('@playwright/test').Response} Response */

test.describe.configure({ mode: 'parallel' });

test.describe('CSS', () => {
	test('applies styles correctly', async ({ page, get_computed_style }) => {
		await page.goto('/css');

		test.step('applies imported styles', async () => {
			expect(await get_computed_style('.styled', 'color')).toBe('rgb(255, 0, 0)');
		});

		test.step('applies imported styles in the correct order', async () => {
			expect(await get_computed_style('.overridden', 'color')).toBe('rgb(0, 128, 0)');
		});

		test.step('applies layout styles', async () => {
			expect(await get_computed_style('footer', 'color')).toBe('rgb(128, 0, 128)');
		});

		test.step('applies local styles', async () => {
			expect(await get_computed_style('.also-styled', 'color')).toBe('rgb(0, 0, 255)');
		});

		test.step('does not apply raw and url', async () => {
			expect(await get_computed_style('.not', 'color')).toBe('rgb(0, 0, 0)');
		});
	});

	test('loads styles on routes with encoded characters', async ({ page, get_computed_style }) => {
		await page.goto('/css/encöded');
		expect(await get_computed_style('h1', 'color')).toBe('rgb(128, 0, 128)');
	});
});

test.describe('Shadowed pages', () => {
	test('Loads props from an endpoint', async ({ page, clicknav }) => {
		await page.goto('/shadowed');
		await clicknav('[href="/shadowed/simple"]');
		expect(await page.textContent('h1')).toBe('The answer is 42');
	});

	test('Handles GET redirects', async ({ page, clicknav }) => {
		await page.goto('/shadowed');
		await clicknav('[href="/shadowed/redirect-get"]');
		expect(await page.textContent('h1')).toBe('Redirection was successful');
	});

	test('Handles GET redirects with cookies', async ({ page, context, clicknav }) => {
		await page.goto('/shadowed');
		await clicknav('[href="/shadowed/redirect-get-with-cookie"]');
		expect(await page.textContent('h1')).toBe('Redirection was successful');

		const cookies = await context.cookies();
		expect(cookies).toEqual(
			expect.arrayContaining([expect.objectContaining({ name: 'shadow-redirect', value: 'happy' })])
		);
	});

	test('Handles GET redirects with cookies from fetch response', async ({
		page,
		context,
		clicknav
	}) => {
		await page.goto('/shadowed');
		await clicknav('[href="/shadowed/redirect-get-with-cookie-from-fetch"]');
		expect(await page.textContent('h1')).toBe('Redirection was successful');

		const cookies = await context.cookies();
		expect(cookies).toEqual(
			expect.arrayContaining([
				expect.objectContaining({ name: 'shadow-redirect-fetch', value: 'happy' })
			])
		);
	});

	test('Handles POST redirects', async ({ page, clicknav }) => {
		await page.goto('/shadowed');
		await clicknav('#redirect-post');
		expect(await page.textContent('h1')).toBe('Redirection was successful');
	});

	test('Handles POST redirects with cookies', async ({ page, context, clicknav }) => {
		await page.goto('/shadowed');
		await clicknav('#redirect-post-with-cookie');
		expect(await page.textContent('h1')).toBe('Redirection was successful');

		const cookies = await context.cookies();
		expect(cookies).toEqual(
			expect.arrayContaining([expect.objectContaining({ name: 'shadow-redirect', value: 'happy' })])
		);
	});

	test('Handles POST success with returned location', async ({ page, clicknav }) => {
		await page.goto('/shadowed/post-success-redirect');
		await clicknav('button');
		expect(await page.textContent('h1')).toBe('POST was successful');
	});

	test('Renders error page for 4xx and 5xx responses from GET', async ({ page, clicknav }) => {
		await page.goto('/shadowed');
		await clicknav('[href="/shadowed/error-get"]');
		expect(await page.textContent('h1')).toBe('404');
	});

	test('Merges bodies for 4xx and 5xx responses from non-GET', async ({ page }) => {
		await page.goto('/shadowed');
		const [response] = await Promise.all([page.waitForNavigation(), page.click('#error-post')]);
		expect(await page.textContent('h1')).toBe('hello from get / echo: posted data');

		expect(response?.status()).toBe(400);
		expect(await page.textContent('h2')).toBe('status: 400');
	});

	test('Endpoint receives consistent URL', async ({ baseURL, page, clicknav }) => {
		await page.goto('/shadowed/same-render-entry');
		await clicknav('[href="/shadowed/same-render?param1=value1"]');
		expect(await page.textContent('h1')).toBe(`URL: ${baseURL}/shadowed/same-render?param1=value1`);
	});

	test('Works with missing get handler', async ({ page, clicknav }) => {
		await page.goto('/shadowed');
		await clicknav('[href="/shadowed/no-get"]');
		expect(await page.textContent('h1')).toBe('hello');
	});

	test('Invalidates shadow data when URL changes', async ({ page, clicknav }) => {
		await page.goto('/shadowed');
		await clicknav('[href="/shadowed/dynamic/foo"]');
		expect(await page.textContent('h1')).toBe('slug: foo');

		await clicknav('[href="/shadowed/dynamic/bar"]');
		expect(await page.textContent('h1')).toBe('slug: bar');

		await page.goto('/shadowed/dynamic/foo');
		expect(await page.textContent('h1')).toBe('slug: foo');
		await clicknav('[href="/shadowed/dynamic/bar"]');
		expect(await page.textContent('h1')).toBe('slug: bar');
	});

	test('Shadow redirect', async ({ page, clicknav }) => {
		await page.goto('/shadowed/redirect');
		await clicknav('[href="/shadowed/redirect/a"]');
		expect(await page.textContent('h1')).toBe('done');
	});

	test('Endpoint without GET', async ({ page, clicknav, baseURL, javaScriptEnabled }) => {
		await page.goto('/shadowed');

		/** @type {string[]} */
		const requests = [];
		page.on('request', (r) => requests.push(r.url()));

		await clicknav('[href="/shadowed/missing-get"]');

		expect(await page.textContent('h1')).toBe('post without get');

		// check that the router didn't fall back to the server
		if (javaScriptEnabled) {
			expect(requests).not.toContain(`${baseURL}/shadowed/missing-get`);
		}
	});

	test('Parent data is present', async ({ page, clicknav }) => {
		await page.goto('/shadowed/parent');
		await expect(page.locator('h2')).toHaveText(
			'Layout data: {"foo":{"bar":"Custom layout"},"layout":"layout"}'
		);
		await expect(page.locator('p')).toHaveText(
			'Page data: {"foo":{"bar":"Custom layout"},"layout":"layout","page":"page","data":{"rootlayout":"rootlayout","layout":"layout"}}'
		);

		await clicknav('[href="/shadowed/parent?test"]');
		await expect(page.locator('h2')).toHaveText(
			'Layout data: {"foo":{"bar":"Custom layout"},"layout":"layout"}'
		);
		await expect(page.locator('p')).toHaveText(
			'Page data: {"foo":{"bar":"Custom layout"},"layout":"layout","page":"page","data":{"rootlayout":"rootlayout","layout":"layout"}}'
		);

		await clicknav('[href="/shadowed/parent/sub"]');
		await expect(page.locator('h2')).toHaveText(
			'Layout data: {"foo":{"bar":"Custom layout"},"layout":"layout"}'
		);
		await expect(page.locator('p')).toHaveText(
			'Page data: {"foo":{"bar":"Custom layout"},"layout":"layout","sub":"sub","data":{"rootlayout":"rootlayout","layout":"layout"}}'
		);
	});

	if (process.env.DEV) {
		test('Data must be serializable', async ({ page, clicknav }) => {
			await page.goto('/shadowed');
			await clicknav('[href="/shadowed/serialization"]');

			expect(await page.textContent('h1')).toBe('500');
			expect(await page.textContent('#message')).toBe(
				'This is your custom error page saying: "Data returned from `load` while rendering /shadowed/serialization is not serializable: Cannot stringify arbitrary non-POJOs (data.nope) (500 Internal Error)"'
			);
		});
	}
});

test.describe('Errors', () => {
	if (process.env.DEV) {
		// TODO these probably shouldn't have the full render treatment,
		// given that they will never be user-visible in prod
		test('server-side errors', async ({ page }) => {
			await page.goto('/errors/serverside');

			expect(await page.textContent('footer')).toBe('Custom layout');
			expect(await page.textContent('#message')).toBe(
				'This is your custom error page saying: "Crashing now (500 Internal Error)"'
			);
		});

		test('server-side module context errors', async ({ page }) => {
			test.fixme();

			await page.goto('/errors/module-scope-server');

			expect(await page.textContent('footer')).toBe('Custom layout');
			expect(await page.textContent('#message')).toBe(
				'This is your custom error page saying: "Crashing now"'
			);
		});

		test('errors on invalid load function response', async ({ page, app, javaScriptEnabled }) => {
			if (javaScriptEnabled) {
				await page.goto('/');
				await app.goto('/errors/invalid-load-response');
			} else {
				await page.goto('/errors/invalid-load-response');
			}

			expect(await page.textContent('footer')).toBe('Custom layout');

			const details = javaScriptEnabled
				? "related to route '/errors/invalid-load-response'"
				: 'in src/routes/errors/invalid-load-response/+page.js';

			expect(await page.textContent('#message')).toBe(
				`This is your custom error page saying: "a load function ${details} returned an array, but must return a plain object at the top level (i.e. \`return {...}\`) (500 Internal Error)"`
			);
		});

		test('errors on invalid server load function response', async ({
			page,
			app,
			javaScriptEnabled
		}) => {
			if (javaScriptEnabled) {
				await page.goto('/');
				await app.goto('/errors/invalid-server-load-response');
			} else {
				await page.goto('/errors/invalid-server-load-response');
			}

			expect(await page.textContent('footer')).toBe('Custom layout');

			expect(await page.textContent('#message')).toBe(
				'This is your custom error page saying: "a load function in src/routes/errors/invalid-server-load-response/+page.server.js returned an array, but must return a plain object at the top level (i.e. `return {...}`) (500 Internal Error)"'
			);
		});
	}

	test('server-side load errors', async ({ page, get_computed_style }) => {
		await page.goto('/errors/load-server');

		expect(await page.textContent('footer')).toBe('Custom layout');
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Crashing now (500 Internal Error)"'
		);

		expect(await get_computed_style('h1', 'color')).toBe('rgb(255, 0, 0)');
	});

	test('404', async ({ page }) => {
		const response = await page.goto('/why/would/anyone/fetch/this/url');

		expect(await page.textContent('footer')).toBe('Custom layout');
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Not found: /why/would/anyone/fetch/this/url (404 Not Found)"'
		);
		expect(/** @type {Response} */ (response).status()).toBe(404);
	});

	test('server-side error from load() is a string', async ({ page }) => {
		const response = await page.goto('/errors/load-error-string-server');

		expect(await page.textContent('footer')).toBe('Custom layout');
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Not found"'
		);
		expect(/** @type {Response} */ (response).status()).toBe(555);
	});

	test('server-side error from load() is an Error', async ({ page }) => {
		const response = await page.goto('/errors/load-error-server');

		expect(await page.textContent('footer')).toBe('Custom layout');
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Not found"'
		);
		expect(/** @type {Response} */ (response).status()).toBe(555);
	});

	test('error in endpoint', async ({ page, read_errors }) => {
		const res = await page.goto('/errors/endpoint');

		// should include stack trace
		const lines = read_errors('/errors/endpoint.json').stack.split('\n');
		expect(lines[0]).toMatch('nope');

		if (process.env.DEV) {
			expect(lines[1]).toMatch('endpoint.json');
		}

		expect(res && res.status()).toBe(500);
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "500 (500 Internal Error)"'
		);
	});

	test('error in shadow endpoint', async ({ page, read_errors }) => {
		const res = await page.goto('/errors/endpoint-shadow');

		// should include stack trace
		const lines = read_errors('/errors/endpoint-shadow').stack.split('\n');
		expect(lines[0]).toMatch('nope');

		if (process.env.DEV) {
			expect(lines[1]).toMatch('+page.server.js:3:8');
		}

		expect(res && res.status()).toBe(500);
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "nope (500 Internal Error)"'
		);
	});

	test('not ok response from shadow endpoint', async ({ page, read_errors }) => {
		const res = await page.goto('/errors/endpoint-shadow-not-ok');

		expect(read_errors('/errors/endpoint-shadow-not-ok')).toBeUndefined();

		expect(res && res.status()).toBe(555);
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Error: 555"'
		);
	});

	test('prerendering a page with a mutative page endpoint results in a catchable error', async ({
		page
	}) => {
		await page.goto('/prerendering/mutative-endpoint');
		expect(await page.textContent('h1')).toBe('500');

		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Cannot prerender pages with actions (500 Internal Error)"'
		);
	});

	test('page endpoint GET thrown error message is preserved', async ({
		page,
		clicknav,
		read_errors
	}) => {
		await page.goto('/errors/page-endpoint');
		await clicknav('#get-implicit');

		expect(await page.textContent('pre')).toBe(
			JSON.stringify({ status: 500, message: 'oops (500 Internal Error)' }, null, '  ')
		);

		const { status, name, message, stack, fancy } = read_errors(
			'/errors/page-endpoint/get-implicit'
		);
		expect(status).toBe(undefined);
		expect(name).toBe('FancyError');
		expect(message).toBe('oops');
		expect(fancy).toBe(true);
		if (process.env.DEV) {
			const lines = stack.split('\n');
			expect(lines[1]).toContain('+page.server.js:4:8');
		}
	});

	test('page endpoint GET HttpError message is preserved', async ({
		page,
		clicknav,
		read_errors
	}) => {
		await page.goto('/errors/page-endpoint');
		await clicknav('#get-explicit');

		expect(await page.textContent('pre')).toBe(
			JSON.stringify({ status: 400, message: 'oops' }, null, '  ')
		);

		const error = read_errors('/errors/page-endpoint/get-explicit');
		expect(error).toBe(undefined);
	});

	test('page endpoint POST unexpected error message is preserved', async ({
		page,
		clicknav,
		read_errors
	}) => {
		// The case where we're submitting a POST request via a form.
		// It should show the __error template with our message.
		await page.goto('/errors/page-endpoint');
		await clicknav('#post-implicit');

		expect(await page.textContent('pre')).toBe(
			JSON.stringify({ status: 500, message: 'oops (500 Internal Error)' }, null, '  ')
		);

		const { status, name, message, stack, fancy } = read_errors(
			'/errors/page-endpoint/post-implicit'
		);

		expect(status).toBe(undefined);
		expect(name).toBe('FancyError');
		expect(message).toBe('oops');
		expect(fancy).toBe(true);
		if (process.env.DEV) {
			const lines = stack.split('\n');
			expect(lines[1]).toContain('+page.server.js:6:9');
		}
	});

	test('page endpoint POST HttpError error message is preserved', async ({
		page,
		clicknav,
		read_errors
	}) => {
		// The case where we're submitting a POST request via a form.
		// It should show the __error template with our message.
		await page.goto('/errors/page-endpoint');
		await clicknav('#post-explicit');

		expect(await page.textContent('pre')).toBe(
			JSON.stringify({ status: 400, message: 'oops' }, null, '  ')
		);

		const error = read_errors('/errors/page-endpoint/post-explicit');
		expect(error).toBe(undefined);
	});
});

test.describe('Headers', () => {
	test('allows headers to be sent as a Headers class instead of a POJO', async ({ page }) => {
		await page.goto('/headers/class');
		expect(await page.innerHTML('p')).toBe('bar');
	});
});

test.describe('Redirects', () => {
	test('redirect', async ({ baseURL, page, clicknav }) => {
		await page.goto('/redirect');

		await clicknav('[href="/redirect/a"]');

		await page.waitForURL('/redirect/c');
		expect(await page.textContent('h1')).toBe('c');
		expect(page.url()).toBe(`${baseURL}/redirect/c`);

		await page.goBack();
		expect(page.url()).toBe(`${baseURL}/redirect`);
	});

	test('prevents redirect loops', async ({ baseURL, page, javaScriptEnabled, browserName }) => {
		await page.goto('/redirect');

		await page.locator('[href="/redirect/loopy/a"]').click();

		if (javaScriptEnabled) {
			await page.waitForSelector('#message');
			expect(page.url()).toBe(`${baseURL}/redirect/loopy/a`);
			expect(await page.textContent('h1')).toBe('500');
			expect(await page.textContent('#message')).toBe(
				'This is your custom error page saying: "Redirect loop (500 Internal Error)"'
			);
		} else {
			// there's not a lot we can do to handle server-side redirect loops
			if (browserName === 'chromium') {
				expect(page.url()).toBe('chrome-error://chromewebdata/');
			} else {
				expect(page.url()).toBe(`${baseURL}/redirect`);
			}
		}
	});

	test('errors on missing status', async ({
		baseURL,
		page,
		clicknav,
		javaScriptEnabled,
		read_errors
	}) => {
		await page.goto('/redirect');

		await clicknav('[href="/redirect/missing-status/a"]');

		const message = process.env.DEV || !javaScriptEnabled ? 'Invalid status code' : 'Redirect loop';

		expect(page.url()).toBe(`${baseURL}/redirect/missing-status/a`);
		expect(await page.textContent('h1')).toBe('500');
		expect(await page.textContent('#message')).toBe(
			`This is your custom error page saying: "${message} (500 Internal Error)"`
		);

		if (!javaScriptEnabled) {
			// handleError is not invoked for client-side navigation
			const lines = read_errors('/redirect/missing-status/a').stack.split('\n');
			expect(lines[0]).toBe(`Error: ${message}`);
		}
	});

	test('errors on invalid status', async ({ baseURL, page, clicknav, javaScriptEnabled }) => {
		await page.goto('/redirect');

		await clicknav('[href="/redirect/missing-status/b"]');

		const message = process.env.DEV || !javaScriptEnabled ? 'Invalid status code' : 'Redirect loop';

		expect(page.url()).toBe(`${baseURL}/redirect/missing-status/b`);
		expect(await page.textContent('h1')).toBe('500');
		expect(await page.textContent('#message')).toBe(
			`This is your custom error page saying: "${message} (500 Internal Error)"`
		);
	});

	test('redirect-on-load', async ({ baseURL, page, javaScriptEnabled }) => {
		const redirected_to_url = javaScriptEnabled
			? `${baseURL}/redirect-on-load/redirected`
			: `${baseURL}/redirect-on-load`;

		await Promise.all([page.waitForResponse(redirected_to_url), page.goto('/redirect-on-load')]);

		expect(page.url()).toBe(redirected_to_url);

		if (javaScriptEnabled) {
			expect(await page.textContent('h1')).toBe('Hazaa!');
		}
	});

	test('redirect response in handle hook', async ({ baseURL, clicknav, page }) => {
		await page.goto('/redirect');

		await clicknav('[href="/redirect/in-handle?response"]');

		await page.waitForURL('/redirect/c');
		expect(await page.textContent('h1')).toBe('c');
		expect(page.url()).toBe(`${baseURL}/redirect/c`);

		await page.goBack();
		expect(page.url()).toBe(`${baseURL}/redirect`);
	});

	test('redirect in handle hook', async ({ baseURL, clicknav, page }) => {
		await page.goto('/redirect');

		await clicknav('[href="/redirect/in-handle?throw"]');

		await page.waitForURL('/redirect/c');
		expect(await page.textContent('h1')).toBe('c');
		expect(page.url()).toBe(`${baseURL}/redirect/c`);

		await page.goBack();
		expect(page.url()).toBe(`${baseURL}/redirect`);
	});

	test('sets cookies when redirect in handle hook', async ({ page, app, javaScriptEnabled }) => {
		await page.goto('/cookies/set');
		let span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('teapot');

		if (javaScriptEnabled) {
			const [, response] = await Promise.all([
				app.goto('/redirect/in-handle?throw&cookies'),
				page.waitForResponse((request) =>
					request.url().endsWith('in-handle/__data.json?throw=&cookies=&x-sveltekit-invalidated=01')
				)
			]);
			expect((await response.allHeaders())['set-cookie']).toBeDefined();
		}

		await page.goto('/redirect/in-handle?throw&cookies');
		span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('undefined');
	});
});

test.describe('Routing', () => {
	test('redirects from /routing/ to /routing', async ({
		baseURL,
		page,
		clicknav,
		app,
		javaScriptEnabled
	}) => {
		await page.goto('/routing/slashes');

		await clicknav('a[href="/routing/"]');
		expect(page.url()).toBe(`${baseURL}/routing`);
		expect(await page.textContent('h1')).toBe('Great success!');

		if (javaScriptEnabled) {
			await page.goto(`${baseURL}/routing/slashes`);
			await app.goto('/routing/');
			expect(page.url()).toBe(`${baseURL}/routing`);
			expect(await page.textContent('h1')).toBe('Great success!');
		}
	});

	test('redirects from /routing/? to /routing', async ({
		baseURL,
		page,
		clicknav,
		app,
		javaScriptEnabled
	}) => {
		await page.goto('/routing/slashes');

		await clicknav('a[href="/routing/?"]');
		expect(page.url()).toBe(`${baseURL}/routing`);
		expect(await page.textContent('h1')).toBe('Great success!');

		if (javaScriptEnabled) {
			await page.goto(`${baseURL}/routing/slashes`);
			await app.goto('/routing/?');
			expect(page.url()).toBe(`${baseURL}/routing`);
			expect(await page.textContent('h1')).toBe('Great success!');
		}
	});

	test('redirects from /routing/?foo=bar to /routing?foo=bar', async ({
		baseURL,
		page,
		clicknav,
		app,
		javaScriptEnabled
	}) => {
		await page.goto('/routing/slashes');

		await clicknav('a[href="/routing/?foo=bar"]');
		expect(page.url()).toBe(`${baseURL}/routing?foo=bar`);
		expect(await page.textContent('h1')).toBe('Great success!');

		if (javaScriptEnabled) {
			await page.goto(`${baseURL}/routing/slashes`);
			await app.goto('/routing/?foo=bar');
			expect(page.url()).toBe(`${baseURL}/routing?foo=bar`);
			expect(await page.textContent('h1')).toBe('Great success!');
		}
	});

	test('serves static route', async ({ page }) => {
		await page.goto('/routing/a');
		expect(await page.textContent('h1')).toBe('a');
	});

	test('serves static route from dir/index.html file', async ({ page }) => {
		await page.goto('/routing/b');
		expect(await page.textContent('h1')).toBe('b');
	});

	test('serves static route under client directory', async ({ baseURL, page }) => {
		await page.goto('/routing/client/foo');

		expect(await page.textContent('h1')).toBe('foo');

		await page.goto(`${baseURL}/routing/client/bar`);
		expect(await page.textContent('h1')).toBe('bar');

		await page.goto(`${baseURL}/routing/client/bar/b`);
		expect(await page.textContent('h1')).toBe('b');
	});

	test('serves dynamic route', async ({ page }) => {
		await page.goto('/routing/test-slug');
		expect(await page.textContent('h1')).toBe('test-slug');
	});

	test('does not attempt client-side navigation to server routes', async ({ page }) => {
		await page.goto('/routing');
		await page.locator('[href="/routing/ambiguous/ok.json"]').click();
		expect(await page.textContent('body')).toBe('ok');
	});

	test('does not attempt client-side navigation to links with data-sveltekit-reload', async ({
		baseURL,
		page,
		clicknav
	}) => {
		await page.goto('/routing');

		/** @type {string[]} */
		const requests = [];
		page.on('request', (r) => requests.push(r.url()));

		await clicknav('[href="/routing/b"]');
		expect(await page.textContent('h1')).toBe('b');
		expect(requests).toContain(`${baseURL}/routing/b`);
	});

	test('allows reserved words as route names', async ({ page }) => {
		await page.goto('/routing/const');
		expect(await page.textContent('h1')).toBe('reserved words are okay as routes');
	});

	test('resets the active element after navigation', async ({ page, clicknav }) => {
		await page.goto('/routing');
		await clicknav('[href="/routing/a"]');
		await page.waitForFunction(() => (document.activeElement || {}).nodeName == 'BODY');
	});

	test('navigates between routes with empty parts', async ({ page, clicknav }) => {
		await page.goto('/routing/dirs/foo');
		expect(await page.textContent('h1')).toBe('foo');
		await clicknav('[href="bar"]');
		expect(await page.textContent('h1')).toBe('bar');
	});

	test('navigates between dynamic routes with same segments', async ({ page, clicknav }) => {
		await page.goto('/routing/dirs/bar/xyz');
		expect(await page.textContent('h1')).toBe('A page');

		await clicknav('[href="/routing/dirs/foo/xyz"]');
		expect(await page.textContent('h1')).toBe('B page');
	});

	test('invalidates page when a segment is skipped', async ({ page, clicknav }) => {
		await page.goto('/routing/skipped/x/1');
		expect(await page.textContent('h1')).toBe('x/1');

		await clicknav('#goto-y1');
		expect(await page.textContent('h1')).toBe('y/1');
	});

	test('back button returns to initial route', async ({ page, clicknav }) => {
		await page.goto('/routing');
		await clicknav('[href="/routing/a"]');

		await page.goBack();
		await page.waitForLoadState('networkidle');
		expect(await page.textContent('h1')).toBe('Great success!');
	});

	test('focus works if page load has hash', async ({ page, browserName }) => {
		await page.goto('/routing/hashes/target#p2');

		await page.keyboard.press(browserName === 'webkit' ? 'Alt+Tab' : 'Tab');
		await page.waitForTimeout(50); // give browser a bit of time to complete the native behavior of the key press
		expect(
			await page.evaluate(
				() => document.activeElement?.textContent || 'ERROR: document.activeElement not set'
			)
		).toBe('next focus element');
	});

	test('focus works when navigating to a hash on the same page', async ({ page, browserName }) => {
		await page.goto('/routing/hashes/target');

		await page.click('[href="#p2"]');
		await page.keyboard.press(browserName === 'webkit' ? 'Alt+Tab' : 'Tab');

		expect(await page.evaluate(() => (document.activeElement || {}).textContent)).toBe(
			'next focus element'
		);
	});

	test(':target pseudo-selector works when navigating to a hash on the same page', async ({
		page,
		get_computed_style
	}) => {
		await page.goto('/routing/hashes/target#p1');

		expect(await get_computed_style('#p1', 'color')).toBe('rgb(255, 0, 0)');
		await page.click('[href="#p2"]');
		expect(await get_computed_style('#p2', 'color')).toBe('rgb(255, 0, 0)');
	});

	test('last parameter in a segment wins in cases of ambiguity', async ({ page, clicknav }) => {
		await page.goto('/routing/split-params');
		await clicknav('[href="/routing/split-params/x-y-z"]');
		expect(await page.textContent('h1')).toBe('x');
		expect(await page.textContent('h2')).toBe('y-z');
	});

	test('ignores navigation to URLs the app does not own', async ({ page, start_server }) => {
		const { port } = await start_server((req, res) => res.end('ok'));

		await page.goto(`/routing?port=${port}`);
		await Promise.all([
			page.click(`[href="http://localhost:${port}"]`),
			// assert that the app can visit a URL not owned by the app without crashing
			page.waitForURL(`http://localhost:${port}/`)
		]);
	});

	test('navigates to ...rest', async ({ page, clicknav }) => {
		await page.goto('/routing/rest/abc/xyz');

		expect(await page.textContent('h1')).toBe('abc/xyz');

		await clicknav('[href="/routing/rest/xyz/abc/def/ghi"]');
		expect(await page.textContent('h1')).toBe('xyz/abc/def/ghi');
		expect(await page.textContent('h2')).toBe('xyz/abc/def/ghi');

		await clicknav('[href="/routing/rest/xyz/abc/def"]');
		expect(await page.textContent('h1')).toBe('xyz/abc/def');
		expect(await page.textContent('h2')).toBe('xyz/abc/def');

		await clicknav('[href="/routing/rest/xyz/abc"]');
		expect(await page.textContent('h1')).toBe('xyz/abc');
		expect(await page.textContent('h2')).toBe('xyz/abc');

		await clicknav('[href="/routing/rest"]');
		expect(await page.textContent('h1')).toBe('');
		expect(await page.textContent('h2')).toBe('');

		await clicknav('[href="/routing/rest/xyz/abc/deep"]');
		expect(await page.textContent('h1')).toBe('xyz/abc');
		expect(await page.textContent('h2')).toBe('xyz/abc');

		await page.locator('[href="/routing/rest/xyz/abc/qwe/deep.json"]').click();
		expect(await page.textContent('body')).toBe('xyz/abc/qwe');
	});

	test('rest parameters do not swallow characters', async ({ page, clicknav }) => {
		await page.goto('/routing/rest/non-greedy');

		await clicknav('[href="/routing/rest/non-greedy/foo/one/two"]');
		expect(await page.textContent('h1')).toBe('non-greedy');
		expect(await page.textContent('h2')).toBe('{"rest":"one/two"}');

		await clicknav('[href="/routing/rest/non-greedy/food/one/two"]');
		expect(await page.textContent('h1')).not.toBe('non-greedy');

		await page.goBack();

		await clicknav('[href="/routing/rest/non-greedy/one-bar/two/three"]');
		expect(await page.textContent('h1')).toBe('non-greedy');
		expect(await page.textContent('h2')).toBe('{"dynamic":"one","rest":"two/three"}');

		await clicknav('[href="/routing/rest/non-greedy/one-bard/two/three"]');
		expect(await page.textContent('h1')).not.toBe('non-greedy');
	});

	test('reloads when navigating between ...rest pages', async ({ page, clicknav }) => {
		await page.goto('/routing/rest/path/one');
		expect(await page.textContent('h1')).toBe('path: /routing/rest/path/one');

		await clicknav('[href="/routing/rest/path/two"]');
		expect(await page.textContent('h1')).toBe('path: /routing/rest/path/two');

		await clicknav('[href="/routing/rest/path/three"]');
		expect(await page.textContent('h1')).toBe('path: /routing/rest/path/three');
	});

	test('allows rest routes to have prefixes and suffixes', async ({ page }) => {
		await page.goto('/routing/rest/complex/prefix-one/two/three');
		expect(await page.textContent('h1')).toBe('parts: one/two/three');
	});

	test('links to unmatched routes result in a full page navigation, not a 404', async ({
		page,
		clicknav
	}) => {
		await page.goto('/routing');
		await clicknav('[href="/static.json"]');
		expect(await page.textContent('body')).toBe('"static file"\n');
	});

	test('navigation is cancelled upon subsequent navigation', async ({
		baseURL,
		page,
		clicknav
	}) => {
		await page.goto('/routing/cancellation');
		await page.locator('[href="/routing/cancellation/a"]').click();
		await clicknav('[href="/routing/cancellation/b"]');

		expect(await page.url()).toBe(`${baseURL}/routing/cancellation/b`);

		await page.evaluate('window.fulfil_navigation && window.fulfil_navigation()');
		expect(await page.url()).toBe(`${baseURL}/routing/cancellation/b`);
	});

	test('Relative paths are relative to the current URL', async ({ page, clicknav }) => {
		await page.goto('/iframes');
		await clicknav('[href="/iframes/nested/parent"]');

		expect(await page.frameLocator('iframe').locator('h1').textContent()).toBe(
			'Hello from the child'
		);
	});

	test('exposes page.route.id', async ({ page, clicknav }) => {
		await page.goto('/routing/route-id');
		await clicknav('[href="/routing/route-id/foo"]');

		expect(await page.textContent('h1')).toBe('route.id in load: /routing/route-id/[x]');
		expect(await page.textContent('h2')).toBe('route.id in store: /routing/route-id/[x]');
	});

	test('serves a page that clashes with a root directory', async ({ page }) => {
		await page.goto('/static');
		expect(await page.textContent('h1')).toBe('hello');
	});

	test('shows "Not Found" in 404 case', async ({ page }) => {
		await page.goto('/404-fallback');
		expect(await page.textContent('h1')).toBe('404');
		expect(await page.textContent('p')).toBe('This is your custom error page saying: "Not Found"');
	});

	if (process.platform !== 'win32') {
		test('Respects symlinks', async ({ page, clicknav }) => {
			await page.goto('/routing');
			await clicknav('[href="/routing/symlink-from"]');

			expect(await page.textContent('h1')).toBe('symlinked');
		});
	}

	test('trailing slash server with config always', async ({ page, clicknav }) => {
		await page.goto('/routing/trailing-slash-server');
		await clicknav('[href="/routing/trailing-slash-server/always"]');
		expect(await page.textContent('[data-test-id="pathname-store"]')).toBe(
			'/routing/trailing-slash-server/always/'
		);
		expect(await page.textContent('[data-test-id="pathname-data"]')).toBe(
			'/routing/trailing-slash-server/always/'
		);
	});

	test('trailing slash server with config ignore and no trailing slash in URL', async ({
		page,
		clicknav
	}) => {
		await page.goto('/routing/trailing-slash-server');
		await clicknav('[href="/routing/trailing-slash-server/ignore"]');
		expect(await page.textContent('[data-test-id="pathname-store"]')).toBe(
			'/routing/trailing-slash-server/ignore'
		);
		expect(await page.textContent('[data-test-id="pathname-data"]')).toBe(
			'/routing/trailing-slash-server/ignore'
		);
	});

	test('trailing slash server with config ignore and trailing slash in URL', async ({
		page,
		clicknav
	}) => {
		await page.goto('/routing/trailing-slash-server');
		await clicknav('[href="/routing/trailing-slash-server/ignore/"]');
		expect(await page.textContent('[data-test-id="pathname-store"]')).toBe(
			'/routing/trailing-slash-server/ignore/'
		);
		expect(await page.textContent('[data-test-id="pathname-data"]')).toBe(
			'/routing/trailing-slash-server/ignore/'
		);
	});

	test('trailing slash server with config never', async ({ page, clicknav }) => {
		await page.goto('/routing/trailing-slash-server');
		await clicknav('[href="/routing/trailing-slash-server/never/"]');
		expect(await page.textContent('[data-test-id="pathname-store"]')).toBe(
			'/routing/trailing-slash-server/never'
		);
		expect(await page.textContent('[data-test-id="pathname-data"]')).toBe(
			'/routing/trailing-slash-server/never'
		);
	});
});

test.describe('XSS', () => {
	test('replaces %sveltekit.xxx% tags safely', async ({ page }) => {
		await page.goto('/unsafe-replacement');

		const content = await page.textContent('body');
		expect(content).toMatch('$& $&');
	});

	test('escapes inline data', async ({ page, javaScriptEnabled }) => {
		await page.goto('/xss');

		expect(await page.textContent('h1')).toBe(
			'user.name is </script><script>window.pwned = 1</script>'
		);

		if (!javaScriptEnabled) {
			// @ts-expect-error - check global injected variable
			expect(await page.evaluate(() => window.pwned)).toBeUndefined();
		}
	});

	const uri_xss_payload = '</script><script>window.pwned=1</script>';
	const uri_xss_payload_encoded = encodeURIComponent(uri_xss_payload);

	test('no xss via dynamic route path', async ({ page }) => {
		await page.goto(`/xss/${uri_xss_payload_encoded}`);

		expect(await page.textContent('h1')).toBe(uri_xss_payload);

		// @ts-expect-error - check global injected variable
		expect(await page.evaluate(() => window.pwned)).toBeUndefined();
	});

	test('no xss via query param', async ({ page }) => {
		await page.goto(`/xss/query?key=${uri_xss_payload_encoded}`);

		expect(await page.textContent('#one')).toBe(JSON.stringify({ key: [uri_xss_payload] }));
		expect(await page.textContent('#two')).toBe(JSON.stringify({ key: [uri_xss_payload] }));

		// @ts-expect-error - check global injected variable
		expect(await page.evaluate(() => window.pwned)).toBeUndefined();
	});

	test('no xss via shadow endpoint', async ({ page }) => {
		await page.goto('/xss/shadow');

		// @ts-expect-error - check global injected variable
		expect(await page.evaluate(() => window.pwned)).toBeUndefined();
		expect(await page.textContent('h1')).toBe(
			'user.name is </script><script>window.pwned = 1</script>'
		);
	});
});

test.describe('$app/server', () => {
	test('can read a file', async ({ page }) => {
		await page.goto('/read-file');

		const auto = await page.textContent('[data-testid="auto"]');
		const url = await page.textContent('[data-testid="url"]');
		const glob = await page.textContent('[data-testid="glob"]');

		// the emoji is there to check that base64 decoding works correctly
		expect(auto.trim()).toBe('Imported without ?url 😎');
		expect(url.trim()).toBe('Imported with ?url 😎');
		expect(glob.trim()).toBe(
			'Imported with url glob from the read-file test in basics. Placed here outside the app folder to force a /@fs prefix 😎'
		);
	});
});

```


####### packages/kit/test/apps/basics/test/server.test.js #######

```

import { expect } from '@playwright/test';
import { test } from '../../../utils.js';
import { createHash, randomBytes } from 'node:crypto';

/** @typedef {import('@playwright/test').Response} Response */

test.skip(({ javaScriptEnabled }) => javaScriptEnabled);

test.describe.configure({ mode: 'parallel' });

test.describe('Caching', () => {
	test('caches pages', async ({ request }) => {
		const response = await request.get('/caching');
		expect(response.headers()['cache-control']).toBe('public, max-age=30');
	});
});

test.describe('Content-Type', () => {
	test('sets Content-Type on page', async ({ request }) => {
		const response = await request.get('/content-type-header');
		expect(response.headers()['content-type']).toBe('text/html');
	});
});

test.describe('Content-Length', () => {
	test('sets Content-Length on page', async ({ request }) => {
		const response = await request.get('/content-length-header');

		// TODO this would ideally be a unit test of `Server`,
		// as would most of the tests in this file
		if (!response.headers()['content-encoding']) {
			expect(+response.headers()['content-length']).toBeGreaterThan(1000);
		}
	});
});

test.describe('Cookies', () => {
	test('does not forward cookies from external domains', async ({ request, start_server }) => {
		const { port } = await start_server(async (req, res) => {
			if (req.url === '/') {
				res.writeHead(200, {
					'set-cookie': 'external=true',
					'access-control-allow-origin': '*'
				});

				res.end('ok');
			} else {
				res.writeHead(404);
				res.end('not found');
			}
		});

		const response = await request.get(`/load/fetch-external-no-cookies?port=${port}`);
		expect(response.headers()['set-cookie']).not.toContain('external=true');
	});
});

test.describe('CSRF', () => {
	test('Blocks requests with incorrect origin', async ({ baseURL }) => {
		const content_types = [
			'application/x-www-form-urlencoded',
			'multipart/form-data',
			'text/plain',
			'text/plaiN'
		];
		const methods = ['POST', 'PUT', 'PATCH', 'DELETE'];
		for (const method of methods) {
			for (const content_type of content_types) {
				const res = await fetch(`${baseURL}/csrf`, {
					method,
					headers: {
						'content-type': content_type
					}
				});
				const message = `request method: ${method}, content-type: ${content_type}`;
				expect(res.status, message).toBe(403);
				expect(await res.text(), message).toBe(
					`Cross-site ${method} form submissions are forbidden`
				);
			}
		}
	});
});

test.describe('Endpoints', () => {
	test('HEAD with matching headers but without body', async ({ request }) => {
		const url = '/endpoint-output/body';

		const responses = {
			head: await request.head(url),
			get: await request.get(url)
		};

		const headers = {
			head: responses.head.headers(),
			get: responses.get.headers()
		};

		expect(responses.head.status()).toBe(200);
		expect(responses.get.status()).toBe(200);
		expect(await responses.head.text()).toBe('');
		expect(await responses.get.text()).toBe('{}');

		['date', 'transfer-encoding'].forEach((name) => {
			delete headers.head[name];
			delete headers.get[name];
		});

		expect(headers.head).toEqual(headers.get);
	});

	test('Prerendered +server.js called from a non-prerendered +server.js works', async ({
		baseURL
	}) => {
		const res = await fetch(`${baseURL}/prerendering/prerendered-endpoint/proxy`);

		expect(res.status).toBe(200);
		expect(await res.json()).toStrictEqual({
			message: 'Im prerendered and called from a non-prerendered +page.server.js'
		});
	});

	test('invalid request method returns allow header', async ({ request }) => {
		const response = await request.post('/endpoint-output/body');

		expect(response.status()).toBe(405);

		const allow_header = response.headers()['allow'];
		expect(allow_header).toMatch(/\bGET\b/);
		expect(allow_header).toMatch(/\bHEAD\b/);
	});

	// TODO all the remaining tests in this section are really only testing
	// setResponse, since we're not otherwise changing anything on the response.
	// might be worth making these unit tests instead
	test('multiple set-cookie on endpoints using GET', async ({ request }) => {
		const response = await request.get('/set-cookie');

		const cookies = response
			.headersArray()
			.filter((obj) => obj.name === 'set-cookie')
			.map((obj) => obj.value);

		expect(cookies).toEqual([
			'answer=42; HttpOnly',
			'problem=comma, separated, values; HttpOnly',
			'name=SvelteKit; path=/; HttpOnly'
		]);
	});

	// TODO see above
	test('body can be a binary ReadableStream', async ({ request }) => {
		const interruptedResponse = request.get('/endpoint-output/stream-throw-error');
		await expect(interruptedResponse).rejects.toThrow('socket hang up');

		const response = await request.get('/endpoint-output/stream');
		const body = await response.body();
		const digest = createHash('sha256').update(body).digest('base64url');
		expect(response.headers()['digest']).toEqual(`sha-256=${digest}`);
	});

	// TODO see above
	test('stream can be canceled with TypeError', async ({ request }) => {
		const responseBefore = await request.get('/endpoint-output/stream-typeerror?what');
		expect(await responseBefore.text()).toEqual('null');

		const interruptedResponse = request.get('/endpoint-output/stream-typeerror');
		await expect(interruptedResponse).rejects.toThrow('socket hang up');

		const responseAfter = await request.get('/endpoint-output/stream-typeerror?what');
		expect(await responseAfter.text()).toEqual('TypeError');
	});

	// TODO see above
	test('request body can be read slow', async ({ request }) => {
		const data = randomBytes(1024 * 256);
		const digest = createHash('sha256').update(data).digest('base64url');
		const response = await request.put('/endpoint-input/sha256', { data });
		expect(await response.text()).toEqual(digest);
	});

	// TODO see above
	test('invalid headers return a 500', async ({ request }) => {
		const response = await request.get('/endpoint-output/head-write-error');
		expect(response.status()).toBe(500);
		expect(await response.text()).toMatch(
			'TypeError [ERR_INVALID_CHAR]: Invalid character in header content ["x-test"]'
		);
	});

	test('OPTIONS handler', async ({ request }) => {
		const url = '/endpoint-output';

		const response = await request.fetch(url, {
			method: 'OPTIONS'
		});

		expect(response.status()).toBe(200);
		expect(await response.text()).toBe('ok');
	});

	test('HEAD handler', async ({ request }) => {
		const url = '/endpoint-output/head-handler';

		const page_response = await request.fetch(url, {
			method: 'HEAD',
			headers: {
				accept: 'text/html'
			}
		});

		expect(page_response.status()).toBe(200);
		expect(await page_response.text()).toBe('');
		expect(page_response.headers()['x-sveltekit-page']).toBe('true');

		const endpoint_response = await request.fetch(url, {
			method: 'HEAD',
			headers: {
				accept: 'application/json'
			}
		});

		expect(endpoint_response.status()).toBe(200);
		expect(await endpoint_response.text()).toBe('');
		expect(endpoint_response.headers()['x-sveltekit-head-endpoint']).toBe('true');
	});

	test('catch-all handler', async ({ request }) => {
		const url = '/endpoint-output/fallback';

		let response = await request.fetch(url, {
			method: 'GET'
		});

		expect(response.status()).toBe(200);
		expect(await response.text()).toBe('ok');

		response = await request.fetch(url, {
			method: 'MOVE' // also works with arcane methods
		});

		expect(response.status()).toBe(200);
		expect(await response.text()).toBe('catch-all');

		response = await request.fetch(url, {
			method: 'OPTIONS'
		});

		expect(response.status()).toBe(200);
		expect(await response.text()).toBe('catch-all');
	});
});

test.describe('Errors', () => {
	test('invalid route response is handled', async ({ request }) => {
		const response = await request.get('/errors/invalid-route-response');

		expect(/** @type {import('@playwright/test').APIResponse} */ (response).status()).toBe(500);
		expect(await response.text()).toMatch(
			'Invalid response from route /errors/invalid-route-response: handler should return a Response object'
		);
	});

	test('unhandled http method', async ({ request }) => {
		const response = await request.put('/errors/invalid-route-response');

		expect(response.status()).toBe(405);
		expect(await response.text()).toMatch('PUT method not allowed');
	});

	test('error evaluating module', async ({ request }) => {
		const response = await request.get('/errors/init-error-endpoint');

		expect(response.status()).toBe(500);
		expect(await response.text()).toMatch('thisvariableisnotdefined is not defined');
	});

	test('returns 400 when accessing a malformed URI', async ({ page }) => {
		const response = await page.goto('/%c0%ae%c0%ae/etc/passwd');
		if (process.env.DEV) {
			// Vite will return a 500 error code
			// We mostly want to make sure malformed requests don't bring down the whole server
			expect(/** @type {Response} */ (response).status()).toBeGreaterThanOrEqual(400);
		} else {
			expect(/** @type {Response} */ (response).status()).toBe(400);
		}
	});

	test('stack traces are not fixed twice', async ({ page }) => {
		await page.goto('/errors/stack-trace');
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Cannot read properties of undefined (reading \'toUpperCase\') (500 Internal Error)"'
		);

		// check the stack wasn't mutated
		await page.goto('/errors/stack-trace');
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Cannot read properties of undefined (reading \'toUpperCase\') (500 Internal Error)"'
		);
	});

	test('error(...) in endpoint', async ({ request, read_errors }) => {
		// HTML
		{
			const res = await request.get('/errors/endpoint-throw-error', {
				headers: {
					accept: 'text/html'
				}
			});

			const error = read_errors('/errors/endpoint-throw-error');
			expect(error).toBe(undefined);

			expect(res.status()).toBe(401);
			expect(await res.text()).toContain(
				'This is the static error page with the following message: You shall not pass'
			);
		}

		// JSON (default)
		{
			const res = await request.get('/errors/endpoint-throw-error');

			const error = read_errors('/errors/endpoint-throw-error');
			expect(error).toBe(undefined);

			expect(res.status()).toBe(401);
			expect(await res.json()).toEqual({
				message: 'You shall not pass'
			});
		}
	});

	test('redirect(...) in endpoint', async ({ page, read_errors }) => {
		const res = await page.goto('/errors/endpoint-throw-redirect');
		expect(res?.status()).toBe(200); // redirects are opaque to the browser

		const error = read_errors('/errors/endpoint-throw-redirect');
		expect(error).toBe(undefined);

		expect(await page.textContent('h1')).toBe('the answer is 42');
	});

	test('POST to missing page endpoint', async ({ request }) => {
		const res = await request.post('/errors/missing-actions', {
			headers: {
				accept: 'text/html'
			}
		});
		expect(res?.status()).toBe(405);

		const res_json = await request.post('/errors/missing-actions', {
			headers: {
				accept: 'application/json'
			}
		});
		expect(res_json?.status()).toBe(405);
		expect(await res_json.json()).toEqual({
			type: 'error',
			error: {
				message: 'POST method not allowed. No actions exist for this page (405 Method Not Allowed)'
			}
		});
	});

	test('error thrown in handle results in a rendered error page or JSON response', async ({
		request
	}) => {
		// HTML
		{
			const res = await request.get('/errors/error-in-handle', {
				headers: {
					accept: 'text/html'
				}
			});

			expect(res.status()).toBe(500);
			expect(await res.text()).toContain(
				'This is the static error page with the following message: Error in handle'
			);
		}

		// JSON (default)
		{
			const res = await request.get('/errors/error-in-handle');

			const error = await res.json();

			expect(error.stack).toBe(undefined);
			expect(res.status()).toBe(500);
			expect(error).toEqual({
				message: 'Error in handle (500 Internal Error)'
			});
		}
	});

	test('expected error thrown in handle results in a rendered error page or JSON response', async ({
		request
	}) => {
		// HTML
		{
			const res = await request.get('/errors/expected-error-in-handle', {
				headers: {
					accept: 'text/html'
				}
			});

			expect(res.status()).toBe(500);
			expect(await res.text()).toContain(
				'This is the static error page with the following message: Expected error in handle'
			);
		}

		// JSON (default)
		{
			const res = await request.get('/errors/expected-error-in-handle');

			const error = await res.json();

			expect(error.stack).toBe(undefined);
			expect(res.status()).toBe(500);
			expect(error).toEqual({
				message: 'Expected error in handle'
			});
		}
	});
});

test.describe('Load', () => {
	test('fetching a non-existent resource in root layout fails without hanging', async ({
		request
	}) => {
		const response = await request.get('/errors/error-in-layout');
		expect(await response.text()).toContain('Error: 404');
	});

	test('fetch does not load a file with a # character', async ({ request }) => {
		const response = await request.get('/load/static-file-with-hash');
		expect(await response.text()).toContain('status: 404');
	});

	test('includes origin header on non-GET internal request', async ({ page, baseURL }) => {
		await page.goto('/load/fetch-origin-internal');
		expect(await page.textContent('h1')).toBe(`origin: ${new URL(baseURL).origin}`);
	});

	test('includes origin header on external request', async ({ page, baseURL, start_server }) => {
		const { port } = await start_server((req, res) => {
			if (req.url === '/') {
				res.writeHead(200, {
					'content-type': 'application/json',
					'access-control-allow-origin': '*'
				});

				res.end(JSON.stringify({ origin: req.headers.origin }));
			} else {
				res.writeHead(404);
				res.end('not found');
			}
		});

		await page.goto(`/load/fetch-origin-external?port=${port}`);
		expect(await page.textContent('h1')).toBe(`origin: ${new URL(baseURL).origin}`);
	});

	test('does not run when using invalid request methods', async ({ request }) => {
		const load_url = '/load';

		let response = await request.fetch(load_url, {
			method: 'OPTIONS'
		});

		expect(response.status()).toBe(204);
		expect(await response.text()).toBe('');
		expect(response.headers()['allow']).toBe('GET, HEAD, OPTIONS');

		const actions_url = '/actions/enhance';
		response = await request.fetch(actions_url, {
			method: 'OPTIONS'
		});

		expect(response.status()).toBe(204);
		expect(await response.text()).toBe('');
		expect(response.headers()['allow']).toBe('GET, HEAD, OPTIONS, POST');
	});
});

test.describe('Routing', () => {
	test('event.params are available in handle', async ({ request }) => {
		const response = await request.get('/routing/params-in-handle/banana');
		expect(await response.json()).toStrictEqual({
			key: '/routing/params-in-handle/[x]',
			params: { x: 'banana' }
		});
	});

	test('/favicon.ico is a valid route', async ({ request }) => {
		const response = await request.get('/favicon.ico');
		expect(response.status()).toBe(200);

		const data = await response.json();
		expect(data).toEqual({ surprise: 'lol' });
	});

	test('Vite trailing slash redirect for prerendered pages retains URL query string', async ({
		request
	}) => {
		if (process.env.DEV) return;

		let response = await request.get('/routing/prerendered/trailing-slash/always?a=1');
		expect(new URL(response.url()).search).toBe('?a=1');

		response = await request.get('/routing/prerendered/trailing-slash/never/?a=1');
		expect(new URL(response.url()).search).toBe('?a=1');

		response = await request.get('/routing/prerendered/trailing-slash/ignore/?a=1');
		expect(new URL(response.url()).search).toBe('?a=1');
	});
});

test.describe('Shadowed pages', () => {
	test('Action can return undefined', async ({ baseURL, request }) => {
		const response = await request.post('/shadowed/simple/post', {
			form: {},
			headers: {
				accept: 'application/json',
				origin: new URL(baseURL).origin
			}
		});

		expect(response.status()).toBe(200);
		expect(await response.json()).toEqual({ data: '-1', type: 'success', status: 204 });
	});
});

test.describe('Static files', () => {
	test('static files', async ({ request }) => {
		let response = await request.get('/static.json');
		expect(await response.json()).toBe('static file');

		response = await request.get('/subdirectory/static.json');
		expect(await response.json()).toBe('subdirectory file');

		expect(response.headers()['access-control-allow-origin']).toBe('*');

		response = await request.get('/favicon.ico');
		expect(response.status()).toBe(200);
	});

	test('does not use Vite to serve contents of static directory', async ({ request }) => {
		const response = await request.get('/static/static.json');
		expect(response.status()).toBe(process.env.DEV ? 403 : 404);
	});

	test('Vite serves assets in allowed directories', async ({ page, request }) => {
		await page.goto('/asset-import');
		const path = await page.getAttribute('img[alt=potatoes]', 'src');
		if (!path) throw new Error('Could not determine path');

		const r1 = await request.get(path);
		expect(r1.status()).toBe(200);
		expect(await r1.text()).toBeTruthy();

		// check that we can fetch a route which overlaps with the name of a file
		const r2 = await request.get('/package.json');
		expect(r2.status()).toBe(200);
		expect(await r2.json()).toEqual({ works: true });
	});

	test('Serves symlinked asset', async ({ request }) => {
		const response = await request.get('/symlink-from/hello.txt');
		expect(response.status()).toBe(200);
		expect(await response.text()).toBe('hello');
	});
});

test.describe('setHeaders', () => {
	test('allows multiple set-cookie headers with different values', async ({ page }) => {
		const response = await page.goto('/headers/set-cookie/sub');
		const cookies = (await response.allHeaders())['set-cookie'];

		expect(cookies).toMatch('cookie1=value1');
		expect(cookies).toMatch('cookie2=value2');
	});
});

test.describe('cookies', () => {
	test('cookie.serialize created correct cookie header string', async ({ page }) => {
		const response = await page.goto('/cookies/serialize');
		const cookies = await response.headerValue('set-cookie');

		expect(cookies).toMatch('before=before');
		expect(cookies).toMatch('after=after');
		expect(cookies).toMatch('endpoint=endpoint');
	});
});

test.describe('Miscellaneous', () => {
	test('does not serve version.json with an immutable cache header', async ({ request }) => {
		// this isn't actually a great test, because caching behaviour is down to adapters.
		// but it's better than nothing
		const response = await request.get('/_app/version.json');
		const headers = response.headers();
		expect(headers['cache-control'] || '').not.toContain('immutable');
	});

	test('handles responses with immutable headers', async ({ request }) => {
		const response = await request.get('/immutable-headers');
		expect(response.status()).toBe(200);
		expect(await response.text()).toBe('foo');
	});
});

test.describe('reroute', () => {
	test('Apply reroute when directly accessing a page', async ({ page }) => {
		await page.goto('/reroute/basic/a');
		expect(await page.textContent('h1')).toContain('Successfully rewritten');
	});

	test('Returns a 500 response if reroute throws an error on the server', async ({ page }) => {
		const response = await page.goto('/reroute/error-handling/server-error');
		expect(response?.status()).toBe(500);
	});
});

```


####### packages/kit/test/apps/basics/test/setup.js #######

```

import fs from 'node:fs';

if (process.platform !== 'win32') {
	process.chdir('src/routes/routing');
	fs.rmSync('symlink-from', { recursive: true, force: true });
	fs.symlinkSync('symlink-to', 'symlink-from', 'dir');
}

```


####### packages/kit/test/apps/basics/test/test.js #######

```

import { expect } from '@playwright/test';
import { test } from '../../../utils.js';

/** @typedef {import('@playwright/test').Response} Response */

test.skip(() => process.env.KIT_E2E_BROWSER === 'webkit');

test.describe.configure({ mode: 'parallel' });

test.describe('adapter', () => {
	test('populates event.platform for dynamic SSR', async ({ page }) => {
		await page.goto('/adapter/dynamic');
		const json = JSON.parse(await page.textContent('pre'));

		expect(json).toEqual({
			config: {
				message: 'hello from dynamic page'
			},
			prerender: false
		});
	});

	test('populates event.platform for prerendered page', async ({ page }) => {
		await page.goto('/adapter/prerendered');
		const json = JSON.parse(await page.textContent('pre'));

		expect(json).toEqual({
			config: {
				message: 'hello from prerendered page'
			},
			prerender: true
		});
	});
});

test.describe('Imports', () => {
	test('imports from node_modules', async ({ page, clicknav }) => {
		await page.goto('/imports');
		await clicknav('[href="/imports/markdown"]');
		expect(await page.innerHTML('p')).toBe('this is some <strong>markdown</strong>');
	});

	// https://github.com/sveltejs/kit/issues/461
	test('handles static asset imports', async ({ baseURL, page }) => {
		await page.goto('/asset-import');

		const sources = await page.evaluate(() =>
			Array.from(document.querySelectorAll('img'), (img) => img.src)
		);

		if (process.env.DEV) {
			expect(sources).toEqual([
				`${baseURL}/src/routes/asset-import/small.png`,
				`${baseURL}/src/routes/asset-import/large.jpg`
			]);
		} else {
			expect(sources[0].startsWith('data:image/png;base64,')).toBeTruthy();
			expect(sources[1]).toMatch(/\/_app\/immutable\/assets\/large\.[\w-]+\.jpg/);
		}
	});
});

test.describe('Encoded paths', () => {
	test('visits a route with non-ASCII character', async ({ page, clicknav }) => {
		await page.goto('/encoded');
		await clicknav('[href="/encoded/苗条"]');
		expect(await page.innerHTML('h1')).toBe('static');
		expect(decodeURI(await page.innerHTML('h2'))).toBe('/encoded/苗条');
		expect(decodeURI(await page.innerHTML('h3'))).toBe('/encoded/苗条');
	});

	test('visits a route with a doubly encoded space', async ({ page, clicknav }) => {
		await page.goto('/encoded');
		await clicknav('[href="/encoded/test%2520me"]');
		expect(await page.innerHTML('h1')).toBe('dynamic');
		expect(await page.innerHTML('h2')).toBe('/encoded/test%2520me: test%20me');
		expect(await page.innerHTML('h3')).toBe('/encoded/test%2520me: test%20me');
	});

	test('visits a route with a doubly encoded slash', async ({ page, clicknav }) => {
		await page.goto('/encoded');
		await clicknav('[href="/encoded/test%252fme"]');
		expect(await page.innerHTML('h1')).toBe('dynamic');
		expect(await page.innerHTML('h2')).toBe('/encoded/test%252fme: test%2fme');
		expect(await page.innerHTML('h3')).toBe('/encoded/test%252fme: test%2fme');
	});

	test('visits a route with an encoded slash', async ({ page, clicknav }) => {
		await page.goto('/encoded');
		await clicknav('[href="/encoded/AC%2fDC"]');
		expect(await page.innerHTML('h1')).toBe('dynamic');
		expect(await page.innerHTML('h2')).toBe('/encoded/AC%2fDC: AC/DC');
		expect(await page.innerHTML('h3')).toBe('/encoded/AC%2fDC: AC/DC');
	});

	test('visits a route with an encoded bracket', async ({ page, clicknav }) => {
		await page.goto('/encoded');
		await clicknav('[href="/encoded/%5b"]');
		expect(await page.innerHTML('h1')).toBe('dynamic');
		expect(await page.innerHTML('h2')).toBe('/encoded/%5b: [');
		expect(await page.innerHTML('h3')).toBe('/encoded/%5b: [');
	});

	test('visits a dynamic route with non-ASCII character', async ({ page, clicknav }) => {
		await page.goto('/encoded');
		await clicknav('[href="/encoded/土豆"]');
		expect(await page.innerHTML('h1')).toBe('dynamic');
		expect(decodeURI(await page.innerHTML('h2'))).toBe('/encoded/土豆: 土豆');
		expect(decodeURI(await page.innerHTML('h3'))).toBe('/encoded/土豆: 土豆');
	});

	test('redirects correctly with non-ASCII location', async ({ page, clicknav }) => {
		await page.goto('/encoded');

		await clicknav('[href="/encoded/反应"]');

		expect(await page.innerHTML('h1')).toBe('static');
		expect(decodeURI(await page.innerHTML('h2'))).toBe('/encoded/苗条');
		expect(decodeURI(await page.innerHTML('h3'))).toBe('/encoded/苗条');
	});

	test('redirects do not re-encode the redirect string', async ({ page, clicknav }) => {
		await page.goto('/encoded');

		await clicknav('[href="/encoded/redirect"]');

		// check innerText instead of innerHTML because innerHTML would return the '&amp;' character reference instead of '&' character.
		expect(await page.innerText('pre')).toBe('/苗条?foo=bar&fizz=buzz');
	});

	test('redirects do not re-encode the redirect string during ssr', async ({ page }) => {
		await page.goto('/encoded/redirect');

		// check innerText instead of innerHTML because innerHTML would return the '&amp;' character reference instead of '&' character.
		expect(await page.innerText('pre')).toBe('/苗条?foo=bar&fizz=buzz');
	});

	test('serializes JSON correctly', async ({ request }) => {
		const response = await request.get('/encoded/endpoint');
		expect(await response.json()).toEqual({
			fruit: '🍎🍇🍌'
		});
	});

	test('allows non-ASCII character in parameterized route segment', async ({ page, clicknav }) => {
		await page.goto('/encoded');
		await clicknav('[href="/encoded/@svelte"]');
		expect(await page.textContent('h1')).toBe('@svelte');
	});

	test('allows characters to be represented as escape sequences', async ({ page, clicknav }) => {
		await page.goto('/encoded/escape-sequences');

		await clicknav('[href="/encoded/escape-sequences/:-)"]');
		expect(await page.textContent('h1')).toBe(':-)');

		await clicknav('[href="/encoded/escape-sequences/%23"]');
		expect(await page.textContent('h1')).toBe('#');

		await clicknav('[href="/encoded/escape-sequences/%2F"]');
		expect(await page.textContent('h1')).toBe('/');

		await clicknav('[href="/encoded/escape-sequences/%3f"]');
		expect(await page.textContent('h1')).toBe('?');

		await clicknav('[href="/encoded/escape-sequences/%25"]');
		expect(await page.textContent('h1')).toBe('%');

		await clicknav('[href="/encoded/escape-sequences/<"]');
		expect(await page.textContent('h1')).toBe('<');

		await clicknav('[href="/encoded/escape-sequences/1<2"]');
		expect(await page.textContent('h1')).toBe('1<2');

		await clicknav('[href="/encoded/escape-sequences/苗"]');
		expect(await page.textContent('h1')).toBe('苗');

		await clicknav('[href="/encoded/escape-sequences/🤪"]');
		expect(await page.textContent('h1')).toBe('🤪');
	});
});

test.describe('$env', () => {
	test('includes environment variables', async ({ page, clicknav }) => {
		await page.goto('/env/includes');

		expect(await page.textContent('#static-private')).toBe(
			'PRIVATE_STATIC: accessible to server-side code/replaced at build time'
		);
		expect(await page.textContent('#dynamic-private')).toBe(
			'PRIVATE_DYNAMIC: accessible to server-side code/evaluated at run time'
		);

		expect(await page.textContent('#static-public')).toBe(
			'PUBLIC_STATIC: accessible anywhere/replaced at build time'
		);
		expect(await page.textContent('#dynamic-public')).toBe(
			'PUBLIC_DYNAMIC: accessible anywhere/evaluated at run time'
		);

		await page.goto('/env');
		await clicknav('[href="/env/includes"]');

		expect(await page.textContent('#static-private')).toBe(
			'PRIVATE_STATIC: accessible to server-side code/replaced at build time'
		);
		expect(await page.textContent('#dynamic-private')).toBe(
			'PRIVATE_DYNAMIC: accessible to server-side code/evaluated at run time'
		);

		expect(await page.textContent('#static-public')).toBe(
			'PUBLIC_STATIC: accessible anywhere/replaced at build time'
		);
		expect(await page.textContent('#dynamic-public')).toBe(
			'PUBLIC_DYNAMIC: accessible anywhere/evaluated at run time'
		);
	});
});

test.describe('Load', () => {
	test('fetch in root index.svelte works', async ({ page }) => {
		await page.goto('/');
		expect(await page.textContent('h1')).toBe('the answer is 42');
	});

	test('loads', async ({ page }) => {
		await page.goto('/load');
		expect(await page.textContent('h1')).toBe('bar == bar?');
	});

	test('GET fetches are serialized', async ({ page, javaScriptEnabled }) => {
		/** @type {string[]} */
		const requests = [];
		page.on('request', (r) => requests.push(r.url()));

		await page.goto('/load/serialization');

		if (!javaScriptEnabled) {
			// by the time JS has run, hydration will have nuked these scripts
			const script_contents = await page.innerHTML(
				'script[data-sveltekit-fetched][data-url="/load/serialization/fetched-from-shared.json"]'
			);

			const payload = '{"status":200,"statusText":"","headers":{},"body":"{\\"b\\":2}"}';

			expect(script_contents).toBe(payload);
		}

		expect(requests.some((r) => r.endsWith('/load/serialization/fetched-from-shared.json'))).toBe(
			false
		);
	});

	test('POST fetches are serialized', async ({ page, javaScriptEnabled }) => {
		/** @type {string[]} */
		const requests = [];
		page.on('request', (r) => requests.push(r.url()));

		await page.goto('/load/serialization-post');

		expect(await page.textContent('h1')).toBe('a: X');
		expect(await page.textContent('h2')).toBe('b: Y');

		if (!javaScriptEnabled) {
			const payload_a = '{"status":200,"statusText":"","headers":{},"body":"X"}';
			const payload_b = '{"status":200,"statusText":"","headers":{},"body":"Y"}';
			// by the time JS has run, hydration will have nuked these scripts
			const script_contents_a = await page.innerHTML(
				'script[data-sveltekit-fetched][data-url="/load/serialization-post.json"][data-hash="1vn6nlx"]'
			);
			const script_contents_b = await page.innerHTML(
				'script[data-sveltekit-fetched][data-url="/load/serialization-post.json"][data-hash="1vn6nlw"]'
			);

			expect(script_contents_a).toBe(payload_a);
			expect(script_contents_b).toBe(payload_b);
		}

		expect(requests.some((r) => r.endsWith('/load/serialization.json'))).toBe(false);
	});

	test('POST fetches with Request init are serialized', async ({ page, javaScriptEnabled }) => {
		await page.goto('/load/serialization-post-request');

		expect(await page.textContent('h1')).toBe('a: X');
		expect(await page.textContent('h2')).toBe('b: Y');

		if (!javaScriptEnabled) {
			const payload_a = '{"status":200,"statusText":"","headers":{},"body":"X"}';
			const payload_b = '{"status":200,"statusText":"","headers":{},"body":"Y"}';
			// by the time JS has run, hydration will have nuked these scripts
			const script_contents_a = await page.innerHTML(
				'script[data-sveltekit-fetched][data-url="/load/serialization-post.json"][data-hash="1vn6nlx"]'
			);
			const script_contents_b = await page.innerHTML(
				'script[data-sveltekit-fetched][data-url="/load/serialization-post.json"][data-hash="1vn6nlw"]'
			);

			expect(script_contents_a).toBe(payload_a);
			expect(script_contents_b).toBe(payload_b);
		}
	});

	test('fetches using an arraybuffer serialized with b64', async ({ page, javaScriptEnabled }) => {
		await page.goto('/load/fetch-arraybuffer-b64');

		expect(await page.textContent('.test-content')).toBe('[1,2,3,4]');

		if (!javaScriptEnabled) {
			const payload = '{"status":200,"statusText":"","headers":{},"body":"AQIDBA=="}';
			const post_payload =
				'{"status":200,"statusText":"","headers":{},"body":"AAECAwQFBgcICQoLDA0ODxAREhMUFRYXGBkaGxwdHh8gISIjJCUmJygpKissLS4vMDEyMzQ1Njc4OTo7PD0+P0BBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWltcXV5fYGFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6e3x9fn+AgYKDhIWGh4iJiouMjY6PkJGSk5SVlpeYmZqbnJ2en6ChoqOkpaanqKmqq6ytrq+wsbKztLW2t7i5uru8vb6/wMHCw8TFxsfIycrLzM3Oz9DR0tPU1dbX2Nna29zd3t/g4eLj5OXm5+jp6uvs7e7v8PHy8/T19vf4+fr7/P3+/w=="}';

			const script_content = await page.innerHTML(
				'script[data-sveltekit-fetched][data-b64][data-url="/load/fetch-arraybuffer-b64/data"]'
			);
			const post_script_content = await page.innerHTML(
				'script[data-sveltekit-fetched][data-b64][data-url="/load/fetch-arraybuffer-b64/data"][data-hash="16h3sp1"]'
			);

			expect(script_content).toBe(payload);
			expect(post_script_content).toBe(post_payload);
		}
	});

	test('json string is returned', async ({ page }) => {
		await page.goto('/load/relay');
		expect(await page.textContent('h1')).toBe('42');
	});

	test('prefers static data over endpoint', async ({ page }) => {
		await page.goto('/load/foo');
		expect(await page.textContent('h1')).toBe('static file');
	});

	test('data is inherited', async ({ page, javaScriptEnabled, app }) => {
		for (const kind of ['shared', 'server']) {
			await page.goto(`/load/parent/${kind}/a/b/c`);
			expect(await page.textContent('h1')).toBe('message: original + new');
			expect(await page.textContent('pre')).toBe(
				JSON.stringify({
					foo: { bar: 'Custom layout' },
					message: 'original + new',
					x: 'a',
					y: 'b edited',
					z: 'c'
				})
			);

			if (javaScriptEnabled) {
				await app.goto(`/load/parent/${kind}/d/e/f`);

				expect(await page.textContent('h1')).toBe('message: original + new');
				expect(await page.textContent('pre')).toBe(
					JSON.stringify({
						foo: { bar: 'Custom layout' },
						message: 'original + new',
						x: 'd',
						y: 'e edited',
						z: 'f'
					})
				);
			}
		}
	});

	test('fetch accepts a Request object', async ({ page, clicknav }) => {
		await page.goto('/load');
		await clicknav('[href="/load/fetch-request"]');
		expect(await page.textContent('h1')).toBe('the answer is 42');
	});

	test('fetch resolves urls relatively to the target page', async ({ page, clicknav }) => {
		await page.goto('/load');
		await clicknav('[href="/load/fetch-relative"]');
		expect(await page.textContent('h1')).toBe('the answer is 42');
		expect(await page.textContent('h2')).toBe('the question was ?');
	});

	test('handles large responses', async ({ page }) => {
		await page.goto('/load');

		await page.goto('/load/large-response');
		expect(await page.textContent('h1')).toBe('text.length is 5000000');
	});

	test('handles external api', async ({ page, start_server }) => {
		/** @type {string[]} */
		const requested_urls = [];

		const { port } = await start_server(async (req, res) => {
			requested_urls.push(req.url);

			if (req.url === '/server-fetch-request-modified.json') {
				res.writeHead(200, {
					'Access-Control-Allow-Origin': '*',
					'content-type': 'application/json'
				});

				res.end(JSON.stringify({ answer: 42 }));
			} else {
				res.statusCode = 404;
				res.end('not found');
			}
		});

		await page.goto(`/load/server-fetch-request?port=${port}`);

		expect(requested_urls).toEqual(['/server-fetch-request-modified.json']);
		expect(await page.textContent('h1')).toBe('the answer is 42');
	});

	test('makes credentialed fetches to endpoints by default', async ({
		page,
		clicknav,
		javaScriptEnabled
	}) => {
		if (javaScriptEnabled) return;
		await page.goto('/load');
		await clicknav('[href="/load/fetch-credentialed"]');
		expect(await page.textContent('h1')).toBe('Hello SvelteKit!');
	});

	test('includes correct page request headers', async ({
		baseURL,
		page,
		clicknav,
		javaScriptEnabled
	}) => {
		await page.goto('/load');
		await clicknav('[href="/load/fetch-request-headers"]');

		const json = /** @type {string} */ (await page.textContent('pre'));
		const headers = JSON.parse(json);

		if (javaScriptEnabled) {
			expect(headers).toEqual({
				accept: '*/*',
				'accept-language': 'en-US',
				// the referer will be the previous page in the client-side
				// navigation case
				referer: `${baseURL}/load`,
				// these headers aren't particularly useful, but they allow us to verify
				// that page headers are being forwarded
				'sec-fetch-dest': 'empty',
				'sec-fetch-mode': 'cors',
				connection: 'keep-alive'
			});
		} else {
			expect(headers).toEqual({
				accept: '*/*',
				'accept-language': 'en-US'
			});
		}
	});

	test('exposes rawBody as a DataView to endpoints', async ({ page, clicknav }) => {
		await page.goto('/load/raw-body');
		await clicknav('[href="/load/raw-body/dataview"]');

		expect(await page.innerHTML('.parsed')).toBe('{"oddly":{"formatted":"json"}}');
		expect(await page.innerHTML('.raw')).toBe('{ "oddly" : { "formatted" : "json" } }');
	});

	test('exposes rawBody as a string to endpoints', async ({ page, clicknav }) => {
		await page.goto('/load/raw-body');
		await clicknav('[href="/load/raw-body/string"]');

		expect(await page.innerHTML('.parsed')).toBe('{"oddly":{"formatted":"json"}}');
		expect(await page.innerHTML('.raw')).toBe('{ "oddly" : { "formatted" : "json" } }');
	});

	test('exposes rawBody as a Uint8Array to endpoints', async ({ page, clicknav }) => {
		await page.goto('/load/raw-body');
		await clicknav('[href="/load/raw-body/uint8array"]');

		expect(await page.innerHTML('.parsed')).toBe('{"oddly":{"formatted":"json"}}');
		expect(await page.innerHTML('.raw')).toBe('{ "oddly" : { "formatted" : "json" } }');
	});

	test('server-side fetch respects set-cookie header', async ({ page, context }) => {
		await context.clearCookies();

		await page.goto('/load/set-cookie-fetch');
		expect(await page.textContent('h1')).toBe('the answer is 42');

		/** @type {Record<string,string>} */
		const cookies = {};
		for (const cookie of await context.cookies()) {
			cookies[cookie.name] = cookie.value;
		}

		expect(cookies.answer).toBe('42');
		expect(cookies.doubled).toBe('84');
	});

	test('CSS for dynamically imported components is reflected in server render', async ({
		page,
		get_computed_style
	}) => {
		await page.goto('/load/dynamic-import-styles');

		expect(await get_computed_style('#thing', 'color')).toBe('rgb(255, 0, 0)');
	});

	test('page without load has access to layout data', async ({ page, clicknav }) => {
		await page.goto('/load/accumulated');

		await clicknav('[href="/load/accumulated/without-page-data"]');
		expect(await page.textContent('h1')).toBe('foo.bar: Custom layout');
	});

	test('page with load has access to layout data', async ({ page, clicknav }) => {
		await page.goto('/load/accumulated');

		await clicknav('[href="/load/accumulated/with-page-data"]');
		expect(await page.textContent('h1')).toBe('foo.bar: Custom layout');
		expect(await page.textContent('h2')).toBe('pagedata: pagedata');
	});

	test('Serializes non-JSON data', async ({ page, clicknav }) => {
		await page.goto('/load/devalue');
		await clicknav('[href="/load/devalue/regex"]');

		expect(await page.textContent('h1')).toBe('true');
	});

	test('Prerendered +server.js called from a non-prerendered +page.server.js works', async ({
		page,
		app,
		javaScriptEnabled
	}) => {
		if (javaScriptEnabled) {
			await page.goto('/');
			await app.goto('/prerendering/prerendered-endpoint/page');
		} else {
			await page.goto('/prerendering/prerendered-endpoint/page');
		}

		expect(await page.textContent('h1')).toBe(
			'Im prerendered and called from a non-prerendered +page.server.js'
		);
	});

	test('Prerendered +server.js called from a non-prerendered handle hook works', async ({
		page,
		javaScriptEnabled
	}) => {
		if (javaScriptEnabled) {
			await page.goto('/prerendering/prerendered-endpoint');
			await page.click('a', { noWaitAfter: true });
		} else {
			await page.goto('/prerendering/prerendered-endpoint/from-handle-hook');
		}

		expect(await page.textContent('html')).toBe(
			'{"message":"Im prerendered and called from a non-prerendered +page.server.js"}'
		);
	});

	test('Logging $page.url during prerendering works', async ({ page }) => {
		await page.goto('/prerendering/log-url');

		expect(await page.textContent('p')).toBe('error: false');
	});

	test('404 and root layout load fetch to prerendered endpoint works', async ({ page }) => {
		await page.goto('/non-existent-route');

		expect(await page.textContent('h1')).toBe('404');

		await page.goto('/non-existent-route-loop');

		expect(await page.textContent('h1')).toBe('404');
	});
});

test.describe('Nested layouts', () => {
	test('renders a nested layout', async ({ page }) => {
		await page.goto('/nested-layout');

		expect(await page.textContent('footer')).toBe('Custom layout');
		expect(await page.textContent('p')).toBe('This is a nested layout component');
		expect(await page.textContent('h1')).toBe('Hello from inside the nested layout component');
	});

	test('renders errors in the right layout', async ({ page }) => {
		await page.goto('/nested-layout/error');

		expect(await page.textContent('footer')).toBe('Custom layout');
		expect(await page.$('p#nested')).toBeNull();
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Error"'
		);
		expect(await page.textContent('h1')).toBe('500');
	});

	test('renders errors in the right layout after client navigation', async ({ page, clicknav }) => {
		await page.goto('/nested-layout/');
		await clicknav('[href="/nested-layout/error"]');
		expect(await page.textContent('footer')).toBe('Custom layout');
		expect(await page.$('p#nested')).toBe(null);
		expect(await page.textContent('#message')).toBe(
			'This is your custom error page saying: "Error"'
		);
		expect(await page.textContent('h1')).toBe('500');
	});

	test('renders deeply-nested errors in the right layout', async ({ page }) => {
		await page.goto('/nested-layout/foo/bar/nope');
		expect(await page.textContent('footer')).toBe('Custom layout');
		expect(await page.$('p#nested')).not.toBeNull();
		expect(await page.$('p#nested-foo')).not.toBeNull();
		expect(await page.$('p#nested-bar')).not.toBeNull();
		expect(await page.textContent('#nested-error-message')).toBe(
			'error.message: nope (500 Internal Error)'
		);
	});

	test('resets layout', async ({ page }) => {
		await page.goto('/nested-layout/reset');

		expect(await page.textContent('h1')).toBe('Layout reset');
		expect(await page.textContent('h2')).toBe('Hello');
		expect(await page.$('#nested')).toBeNull();
	});

	test('renders the closest error page', async ({ page, clicknav }) => {
		await page.goto('/errors/nested-error-page');

		await clicknav('[href="/errors/nested-error-page/nope"]');

		expect(await page.textContent('h1')).toBe('Nested error page');
		expect(await page.textContent('#nested-error-status')).toBe('status: 500');
		expect(await page.textContent('#nested-error-message')).toBe(
			'error.message: nope (500 Internal Error)'
		);
	});
});

test.describe('Page options', () => {
	test('does not include <script> or <link rel="modulepreload"> with csr=false', async ({
		page,
		javaScriptEnabled
	}) => {
		if (!javaScriptEnabled) {
			await page.goto('/no-csr');
			expect(await page.textContent('h1')).toBe('look ma no javascript');
			expect(await page.$$('link[rel="modulepreload"]')).toHaveLength(0);

			// ensure data wasn't inlined
			expect(await page.$$('script[sveltekit\\:data-type="data"]')).toHaveLength(0);
		}
	});

	test('does not SSR page with ssr=false', async ({ page, javaScriptEnabled }) => {
		await page.goto('/no-ssr');

		if (javaScriptEnabled) {
			expect(await page.textContent('h1')).toBe('content was rendered');
		} else {
			expect(await page.$('h1')).toBeNull();
			expect(await page.$('style[data-sveltekit]')).toBeNull();
		}
	});

	test('does not SSR error page for 404s with ssr=false', async ({ request }) => {
		const html = await request.get('/no-ssr/missing');
		expect(await html.text()).not.toContain('load function was called erroneously');
	});

	// TODO move this test somewhere more suitable
	test('transformPageChunk can change the html output', async ({ page }) => {
		await page.goto('/transform-page-chunk');
		expect(await page.getAttribute('meta[name="transform-page"]', 'content')).toBe('Worked!');
	});

	test('prerenders page that uses browser globals with ssr=false', async ({
		page,
		javaScriptEnabled
	}) => {
		test.skip(process.env.DEV, 'skip when in dev mode');
		test.skip(!javaScriptEnabled, 'skip when JavaScript is disabled');
		await page.goto('/prerendering/no-ssr');
		await expect(page.getByText('Hello world!')).toBeVisible();
	});
});

test.describe('$app/environment', () => {
	test('includes version', async ({ page }) => {
		await page.goto('/app-environment');
		expect(await page.textContent('h1')).toBe('TEST_VERSION');
	});
});

test.describe('$app/paths', () => {
	test('includes paths', async ({ page, javaScriptEnabled }) => {
		await page.goto('/paths');

		let base = javaScriptEnabled ? '' : '.';
		expect(await page.innerHTML('pre')).toBe(JSON.stringify({ base, assets: base }));

		await page.goto('/paths/deeply/nested');

		base = javaScriptEnabled ? '' : '../..';
		expect(await page.innerHTML('pre')).toBe(JSON.stringify({ base, assets: base }));
	});

	// some browsers will re-request assets after a `pushState`
	// https://github.com/sveltejs/kit/issues/3748#issuecomment-1125980897
	test('replaces %sveltekit.assets% in template with relative path, and makes it absolute in the client', async ({
		baseURL,
		page,
		javaScriptEnabled
	}) => {
		const absolute = `${baseURL}/favicon.png`;

		await page.goto('/');
		expect(await page.getAttribute('link[rel=icon]', 'href')).toBe(
			javaScriptEnabled ? absolute : './favicon.png'
		);

		await page.goto('/routing');
		expect(await page.getAttribute('link[rel=icon]', 'href')).toBe(
			javaScriptEnabled ? absolute : './favicon.png'
		);

		await page.goto('/routing/rest/foo/bar/baz');
		expect(await page.getAttribute('link[rel=icon]', 'href')).toBe(
			javaScriptEnabled ? absolute : '../../../../favicon.png'
		);
	});
});

test.describe('$app/stores', () => {
	test('can access page.url', async ({ baseURL, page }) => {
		await page.goto('/origin');
		expect(await page.textContent('h1')).toBe(baseURL);
	});

	test('page store contains data', async ({ page, clicknav }) => {
		await page.goto('/store/data/www');

		const foo = { bar: 'Custom layout' };

		expect(await page.textContent('#store-data')).toBe(
			JSON.stringify({ foo, name: 'SvelteKit', value: 456, page: 'www' })
		);

		await clicknav('a[href="/store/data/zzz"]');
		expect(await page.textContent('#store-data')).toBe(
			JSON.stringify({ foo, name: 'SvelteKit', value: 456, page: 'zzz' })
		);

		await clicknav('a[href="/store/data/xxx"]');
		expect(await page.textContent('#store-data')).toBe(
			JSON.stringify({ foo, name: 'SvelteKit', value: 123 })
		);
		expect(await page.textContent('#store-error')).toBe('Params = xxx');

		await clicknav('a[href="/store/data/yyy"]');
		expect(await page.textContent('#store-data')).toBe(
			JSON.stringify({ foo, name: 'SvelteKit', value: 123 })
		);
		expect(await page.textContent('#store-error')).toBe('Params = yyy');
	});

	test('should load data after reloading by goto', async ({
		page,
		clicknav,
		javaScriptEnabled
	}) => {
		await page.goto('/store/data/foo?reset=true');
		const stuff1 = { foo: { bar: 'Custom layout' }, name: 'SvelteKit', value: 123 };
		const stuff2 = { ...stuff1, foo: true, number: 2 };
		const stuff3 = { ...stuff2 };
		await page.goto('/store/data/www');

		await clicknav('a[href="/store/data/foo"]');
		expect(JSON.parse(await page.textContent('#store-data'))).toEqual(stuff1);

		await clicknav('#reload-button');
		expect(JSON.parse(await page.textContent('#store-data'))).toEqual(
			javaScriptEnabled ? stuff2 : stuff1
		);

		await clicknav('a[href="/store/data/zzz"]');
		await clicknav('a[href="/store/data/foo"]');
		expect(JSON.parse(await page.textContent('#store-data'))).toEqual(stuff3);
	});

	test('navigating store contains from, to and type', async ({ app, page, javaScriptEnabled }) => {
		await page.goto('/store/navigating/a');

		expect(await page.textContent('#nav-status')).toBe('not currently navigating');

		if (javaScriptEnabled) {
			await app.preloadCode('/store/navigating/b');

			const res = await Promise.all([
				page.click('a[href="/store/navigating/b"]'),
				page.textContent('#navigating')
			]);

			expect(res[1]).toBe('navigating from /store/navigating/a to /store/navigating/b (link)');

			await page.waitForSelector('#not-navigating');
			expect(await page.textContent('#nav-status')).toBe('not currently navigating');

			await Promise.all([
				expect(page.locator('#navigating')).toHaveText(
					'navigating from /store/navigating/b to /store/navigating/a (popstate)'
				),
				page.goBack()
			]);
		}
	});

	test('navigating store clears after aborted navigation', async ({ page, javaScriptEnabled }) => {
		await page.goto('/store/navigating/a');

		expect(await page.textContent('#nav-status')).toBe('not currently navigating');

		if (javaScriptEnabled) {
			await page.click('a[href="/store/navigating/c"]');
			await page.waitForTimeout(100); // gross, but necessary since no navigation occurs
			await page.click('a[href="/store/navigating/a"]');

			await page.waitForSelector('#not-navigating', { timeout: 5000 });
			expect(await page.textContent('#nav-status')).toBe('not currently navigating');
		}
	});

	test('should update page store when URL hash is changed through the address bar', async ({
		baseURL,
		page,
		javaScriptEnabled
	}) => {
		const href = `${baseURL}/store/data/zzz`;
		await page.goto(href);

		expect(await page.textContent('#url-hash')).toBe('');

		if (javaScriptEnabled) {
			for (const urlHash of ['#1', '#2', '#5', '#8']) {
				await page.evaluate(
					({ href, urlHash }) => {
						location.href = `${href}${urlHash}`;
					},
					{ href, urlHash }
				);

				expect(await page.textContent('#url-hash')).toBe(urlHash);
			}
		}
	});
});

test.describe('searchParams', () => {
	const tests = [
		{
			description: 'exposes query string parameters',
			search: '?foo=1',
			expected: { foo: ['1'] }
		},
		{
			description: 'value-less query parameter',
			search: '?foo',
			expected: { foo: [''] }
		},
		{
			description: 'duplicated query parameter',
			search: '?key=one&key=two',
			expected: { key: ['one', 'two'] }
		},
		{
			description: 'encoded query parameter',
			search: '?key=%26a=b',
			expected: { key: ['&a=b'] }
		}
	];

	tests.forEach(({ description, search, expected }) => {
		test(description, async ({ page }) => {
			await page.goto(`/query/echo${search}`);

			const json = JSON.stringify(expected);

			expect(await page.textContent('#one')).toBe(json);
			expect(await page.textContent('#two')).toBe(json);
		});
	});

	test('updates page on client-side nav', async ({ page, clicknav }) => {
		await page.goto('/query/echo?foo=1');

		await clicknav('[href="/query/echo?bar=2"]');

		const json = JSON.stringify({ bar: ['2'] });

		expect(await page.textContent('#one')).toBe(json);
		expect(await page.textContent('#two')).toBe(json);
	});
});

test.describe('Matchers', () => {
	test('Matches parameters', async ({ page, clicknav }) => {
		await page.goto('/routing/matched');

		await clicknav('[href="/routing/matched/a"]');
		expect(await page.textContent('h1')).toBe('lowercase: a');

		await clicknav('[href="/routing/matched/B"]');
		expect(await page.textContent('h1')).toBe('uppercase: B');

		await clicknav('[href="/routing/matched/1"]');
		expect(await page.textContent('h1')).toBe('number: 1');

		await clicknav('[href="/routing/matched/everything-else"]');
		expect(await page.textContent('h1')).toBe('fallback: everything-else');
	});
});

test.describe('Actions', () => {
	test("invalidateAll = false doesn't invalidate all", async ({ page, javaScriptEnabled }) => {
		await page.goto('/actions/invalidate-all?invalidate_all=false');
		const preSubmitContent = await page.locator('pre').textContent();
		await page.click('button');
		// The value that should not change is time-based and might not have the granularity to change
		// if we don't give it time to
		await page.waitForTimeout(1000);
		const postSubmitContent = await page.locator('pre').textContent();
		if (!javaScriptEnabled) {
			expect(preSubmitContent).not.toBe(postSubmitContent);
		} else {
			expect(preSubmitContent).toBe(postSubmitContent);
		}
	});

	test('invalidateAll = true does invalidate all', async ({ page }) => {
		await page.goto('/actions/invalidate-all?invalidate_all=true');
		const preSubmitContent = await page.locator('pre').textContent();
		await page.click('button');
		// The value that should not change is time-based and might not have the granularity to change
		// if we don't give it time to
		await page.waitForTimeout(1000);
		const postSubmitContent = await page.locator('pre').textContent();
		expect(preSubmitContent).not.toBe(postSubmitContent);
	});

	test('Submitting a form with a file input but no enctype="multipart/form-data" throws an error', async ({
		page,
		javaScriptEnabled
	}) => {
		test.skip(!javaScriptEnabled, 'Skip when JavaScript is disabled');
		test.skip(!process.env.DEV, 'Skip when not in dev mode');
		await page.goto('/actions/file-without-enctype');
		const error_promise = page.waitForEvent('pageerror');
		await page.click('button');
		const error = await error_promise;
		expect(error.message).toBe(
			'Your form contains <input type="file"> fields, but is missing the necessary `enctype="multipart/form-data"` attribute. This will lead to inconsistent behavior between enhanced and native forms. For more details, see https://github.com/sveltejs/kit/issues/9819.'
		);
	});

	test('Error props are returned', async ({ page, javaScriptEnabled }) => {
		await page.goto('/actions/form-errors');
		await page.click('button');
		expect(await page.textContent('p.server-prop')).toBe('an error occurred');
		if (javaScriptEnabled) {
			expect(await page.textContent('p.client-prop')).toBe('hydrated: an error occurred');
		}
	});

	test('Form fields are persisted', async ({ page, javaScriptEnabled }) => {
		await page.goto('/actions/form-errors-persist-fields');
		await page.locator('input[name="username"]').fill('foo');
		await page.locator('input[name="password"]').fill('bar');
		await Promise.all([
			page.waitForRequest((request) =>
				request.url().includes('/actions/form-errors-persist-fields')
			),
			page.click('button')
		]);
		expect(await page.inputValue('input[name="username"]')).toBe('foo');
		if (javaScriptEnabled) {
			expect(await page.inputValue('input[name="password"]')).toBe('bar');
			expect(await page.textContent('pre')).toBe(JSON.stringify({ username: 'foo' }));
		} else {
			expect(await page.inputValue('input[name="password"]')).toBe('');
		}
	});

	test('Success data as form-data is returned', async ({ page }) => {
		await page.goto('/actions/success-data');

		expect(await page.textContent('pre')).toBe(JSON.stringify(null));

		await page.locator('input[name="username"]').fill('foo');
		await page.locator('button[formenctype="multipart/form-data"]').click();

		await expect(page.locator('pre')).toHaveText(JSON.stringify({ result: 'foo' }));
	});

	test('Success data as form-urlencoded is returned', async ({ page }) => {
		await page.goto('/actions/success-data');

		expect(await page.textContent('pre')).toBe(JSON.stringify(null));

		await page.locator('input[name="username"]').fill('bar');
		await page.locator('button[formenctype="application/x-www-form-urlencoded"]').click();

		await expect(page.locator('pre')).toHaveText(JSON.stringify({ result: 'bar' }));
	});

	test('applyAction updates form prop', async ({ page, javaScriptEnabled }) => {
		await page.goto('/actions/update-form');
		expect(await page.textContent('pre')).toBe(JSON.stringify(null));

		if (javaScriptEnabled) {
			await page.locator('button.increment-success').click();
			await expect(page.locator('pre')).toHaveText(JSON.stringify({ count: 0 }));

			await page.locator('button.increment-invalid').click();
			await expect(page.locator('pre')).toHaveText(JSON.stringify({ count: 1 }));
		}
	});

	test('form prop stays after invalidation and is reset on navigation', async ({
		page,
		app,
		javaScriptEnabled
	}) => {
		await page.goto('/actions/update-form');
		expect(await page.textContent('pre')).toBe(JSON.stringify(null));

		if (javaScriptEnabled) {
			await page.locator('button.increment-success').click();
			await expect(page.locator('pre')).toHaveText(JSON.stringify({ count: 0 }));

			await page.locator('button.invalidateAll').click();
			await page.waitForTimeout(500);
			await expect(page.locator('pre')).toHaveText(JSON.stringify({ count: 0 }));
			await app.goto('/actions/enhance');
		} else {
			await page.goto('/actions/enhance');
		}

		expect(await page.textContent('pre.formdata1')).toBe(JSON.stringify(null));
	});

	test('applyAction redirects', async ({ page, javaScriptEnabled }) => {
		await page.goto('/actions/update-form');
		expect(await page.textContent('pre')).toBe(JSON.stringify(null));

		if (javaScriptEnabled) {
			await page.locator('button.redirect').click();
			await expect(page.locator('footer')).toHaveText('Custom layout');
		}
	});

	test('applyAction errors', async ({ page, javaScriptEnabled }) => {
		await page.goto('/actions/update-form');
		expect(await page.textContent('pre')).toBe(JSON.stringify(null));

		if (javaScriptEnabled) {
			await page.locator('button.error').click();
			await expect(page.locator('p')).toHaveText(
				'This is your custom error page saying: "Unexpected Form Error"'
			);
		}
	});

	test('use:enhance', async ({ page }) => {
		await page.goto('/actions/enhance');

		expect(await page.textContent('pre.formdata1')).toBe(JSON.stringify(null));
		expect(await page.textContent('pre.formdata2')).toBe(JSON.stringify(null));

		await page.locator('input[name="username"]').fill('foo');
		await page.locator('button.form1').click();

		await expect(page.locator('pre.formdata1')).toHaveText(JSON.stringify({ result: 'foo' }));
		await expect(page.locator('pre.formdata2')).toHaveText(JSON.stringify({ result: 'foo' }));
		await expect(page.locator('input[name=username]')).toHaveValue('');
	});

	test('use:enhance abort controller', async ({ page, javaScriptEnabled }) => {
		await page.goto('/actions/enhance');

		expect(await page.textContent('span.count')).toBe('0');

		if (javaScriptEnabled) {
			await Promise.all([
				page.waitForRequest((request) => request.url().includes('/actions/enhance')),
				page.click('button.form2'),
				page.click('button.form2')
			]);
			await page.waitForTimeout(500); // to make sure locator doesn't run exactly between submission 1 and 2

			await expect(page.locator('span.count')).toHaveText('1');
		}
	});

	test('use:enhance button with formAction', async ({ page }) => {
		await page.goto('/actions/enhance');

		expect(await page.textContent('pre.formdata1')).toBe(JSON.stringify(null));

		await page.locator('input[name="username"]').fill('foo');
		await page.locator('button.form1-register').click();

		await expect(page.locator('pre.formdata1')).toHaveText(
			JSON.stringify({ result: 'register: foo' })
		);
	});

	test('use:enhance button with formAction dialog', async ({ page }) => {
		await page.goto('/actions/enhance');

		await page.locator('button[formmethod="dialog"]').click();

		await expect(page.locator('button[formmethod="dialog"]')).not.toBeVisible();
	});

	test('use:enhance button with name', async ({ page }) => {
		await page.goto('/actions/enhance');

		expect(await page.textContent('pre.formdata1')).toBe(JSON.stringify(null));

		await Promise.all([
			page.waitForRequest((request) => request.url().includes('/actions/enhance')),
			page.click('button.form1-submitter')
		]);

		await expect(page.locator('pre.formdata1')).toHaveText(
			JSON.stringify({ result: 'submitter: foo' })
		);
	});

	test('use:enhance does not clear form on second submit', async ({ page }) => {
		await page.goto('/actions/enhance');

		await page.locator('input[name="message"]').fill('hello');

		await page.locator('.form3').click();
		await expect(page.locator('pre.formdata1')).toHaveText(JSON.stringify({ message: 'hello' }));
		await expect(page.locator('pre.formdata2')).toHaveText(JSON.stringify({ message: 'hello' }));

		await page.locator('.form3').click();
		await page.waitForTimeout(0); // wait for next tick
		await expect(page.locator('pre.formdata1')).toHaveText(JSON.stringify({ message: 'hello' }));
		await expect(page.locator('pre.formdata2')).toHaveText(JSON.stringify({ message: 'hello' }));
	});

	test('redirect', async ({ page, javaScriptEnabled }) => {
		await page.goto('/actions/redirect');

		page.click('button');

		const [redirect] = await Promise.all([
			page.waitForResponse('/actions/redirect'),
			page.waitForNavigation()
		]);
		if (javaScriptEnabled) {
			expect(await redirect.json()).toEqual({
				type: 'redirect',
				location: '/actions/enhance',
				status: 303
			});
		} else {
			expect(redirect.status()).toBe(303);
			expect(redirect.headers()['location']).toBe('/actions/enhance');
		}

		expect(page.url()).toContain('/actions/enhance');
	});

	test('redirect in handle', async ({ page, javaScriptEnabled }) => {
		await page.goto('/actions/redirect-in-handle');

		page.click('button');

		const [redirect] = await Promise.all([
			page.waitForResponse('/actions/redirect-in-handle'),
			page.waitForNavigation()
		]);
		if (javaScriptEnabled) {
			expect(await redirect.json()).toEqual({
				type: 'redirect',
				location: '/actions/enhance',
				status: 303
			});
		} else {
			expect(redirect.status()).toBe(303);
			expect(redirect.headers()['location']).toBe('/actions/enhance');
		}

		expect(page.url()).toContain('/actions/enhance');
	});

	test('$page.status reflects error status', async ({ page }) => {
		await page.goto('/actions/enhance');

		await Promise.all([
			page.waitForRequest((request) => request.url().includes('/actions/enhance')),
			page.click('button.form1-error')
		]);

		await expect(page.locator('h1')).toHaveText('400');
	});

	test('errors are rendered at the correct level', async ({ page }) => {
		await page.goto('/actions/form-errors/adjacent-error-boundary');
		await page.locator('button').click();

		await expect(page.locator('pre')).toHaveText('something went wrong');
	});

	test('submitting application/json should return http status code 415', async ({
		baseURL,
		page
	}) => {
		const response = await page.request.fetch(`${baseURL}/actions/form-errors`, {
			method: 'POST',
			body: JSON.stringify({ foo: 'bar' }),
			headers: {
				'Content-Type': 'application/json',
				Origin: `${baseURL}`
			}
		});
		const { type, error } = await response.json();
		expect(type).toBe('error');
		expect(error.message).toBe(
			'Form actions expect form-encoded data — received application/json (415 Unsupported Media Type)'
		);
		expect(response.status()).toBe(415);
	});

	test('submitting to a form action that does not exists, should return http status code 404', async ({
		baseURL,
		page
	}) => {
		const response = await page.request.fetch(`${baseURL}/actions/enhance?/doesnt-exist`, {
			method: 'POST',
			body: 'irrelevant',
			headers: {
				Origin: `${baseURL}`
			}
		});
		const { type, error } = await response.json();
		expect(type).toBe('error');
		expect(error.message).toBe("No action with name 'doesnt-exist' found (404 Not Found)");
		expect(response.status()).toBe(404);
	});
});

// Run in serial to not pollute the log with (correct) cookie warnings
test.describe.serial('Cookies API', () => {
	// there's a problem running these tests in the CI with webkit,
	// since AFAICT the browser is using http://localhost and webkit won't
	// set a `Secure` cookie on that. So we don't run these cross-platform

	test('sanity check for cookies', async ({ page }) => {
		await page.goto('/cookies');
		const span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('undefined');
	});

	test('set a cookie', async ({ page }) => {
		await page.goto('/cookies/set');
		const span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('teapot');
	});

	test('delete a cookie', async ({ page }) => {
		await page.goto('/cookies/set');
		let span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('teapot');
		await page.goto('/cookies/delete');
		span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('undefined');
	});

	test('more than one cookie can be set in one request', async ({ page }) => {
		await page.goto('/cookies/set-more-than-one');
		const span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('teapot');
		expect(await span.innerText()).toContain('jane austen');
	});

	test('default encoding and decoding', async ({ page }) => {
		await page.goto('/cookies/encoding/set');
		const span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('teapot, jane austen');
	});

	test('not decoded twice', async ({ page }) => {
		await page.goto('/cookies/encoding/not-decoded-twice');
		const span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('teapot%2C%20jane%20austen');
	});

	test('can be set in +layout.server.js', async ({ page }) => {
		await page.goto('/cookies/set-in-layout');
		const span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('i was set in the layout load');
	});

	test('works with basic enhance', async ({ page }) => {
		await page.goto('/cookies/enhanced/basic');
		const span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('undefined');

		await page.locator('button#teapot').click();
		await expect(page.locator('#cookie-value')).toHaveText('teapot');

		// setting a different value...
		await page.locator('button#janeAusten').click();
		await expect(page.locator('#cookie-value')).toHaveText('Jane Austen');
	});

	test('cookies can be set with a path', async ({ page }) => {
		await page.goto('/cookies/nested/a');
		let span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('teapot');
		await page.goto('/cookies/nested/b');
		span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('undefined');
		await page.goto('/cookies');
		span = page.locator('#cookie-value');
		expect(await span.innerText()).toContain('undefined');
	});
});

```


####### packages/kit/test/apps/basics/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"noEmit": true,
		"resolveJsonModule": true
	},
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/kit/test/apps/basics/vite.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},
	clearScreen: false,
	optimizeDeps: {
		// for CI, we need to explicitly prebundle deps, since
		// the reload confuses Playwright
		include: ['cookie', 'marked']
	},
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/apps/dev-only/package.json #######

```

{
	"name": "test-dev-only",
	"private": true,
	"version": "0.0.2-next.0",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"test": "cross-env DEV=true playwright test"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"cross-env": "^7.0.3",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/apps/dev-only/playwright.config.js #######

```

export { config as default } from '../../utils.js';

```


####### packages/kit/test/apps/dev-only/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/png" href="%sveltekit.assets%/favicon.png" />
		<meta name="transform-page" content="__REPLACEME__" />
		%sveltekit.head%
	</head>
	<body class="started">
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/apps/dev-only/src/hooks.server.js #######

```

/** @type {import("@sveltejs/kit").HandleServerError} */
export function handleError({ error }) {
	return { message: /**@type{any}*/ (error).message };
}

```


####### packages/kit/test/apps/dev-only/src/lib/server/blah/private.js #######

```

export const should_explode = 'boom';

```


####### packages/kit/test/apps/dev-only/src/lib/test.server.js #######

```

export const should_explode = 'boom';

```


####### packages/kit/test/apps/dev-only/src/routes/+error.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<pre>{$page.error.message}</pre>

```


####### packages/kit/test/apps/dev-only/src/routes/illegal-imports/env/dynamic-private-dynamic-import/+page.svelte #######

```

<script>
	const p = import('$env/dynamic/private');
</script>

{#await p then envModule}
	<p>{envModule.env.SHOULD_EXPLODE}</p>
{/await}

```


####### packages/kit/test/apps/dev-only/src/routes/illegal-imports/env/dynamic-private/+page.svelte #######

```

<script>
	import { env } from '$env/dynamic/private';
</script>

<p>{env.SHOULD_EXPLODE}</p>

```


####### packages/kit/test/apps/dev-only/src/routes/illegal-imports/env/static-private-dynamic-import/+page.svelte #######

```

<script>
	const p = import('$env/static/private');
</script>

{#await p then envModule}
	<p>{envModule.SHOULD_EXPLODE}</p>
{/await}

```


####### packages/kit/test/apps/dev-only/src/routes/illegal-imports/env/static-private/+page.svelte #######

```

<script>
	import { SHOULD_EXPLODE } from '$env/static/private';
</script>

<p>{SHOULD_EXPLODE}</p>

```


####### packages/kit/test/apps/dev-only/src/routes/illegal-imports/server-only-folder/dynamic-import/+page.svelte #######

```

<script>
	const mod = import('$lib/server/blah/private.js');
</script>

{#await mod then resolved}
	<p>{resolved.should_explode}</p>
{/await}

```


####### packages/kit/test/apps/dev-only/src/routes/illegal-imports/server-only-folder/static-import/+page.svelte #######

```

<script>
	import { should_explode } from '$lib/server/blah/private.js';
</script>

<p>{should_explode}</p>

```


####### packages/kit/test/apps/dev-only/src/routes/illegal-imports/server-only-modules/dynamic-import/+page.svelte #######

```

<script>
	const mod = import('../illegal.server.js');
</script>

{#await mod then resolved}
	<p>{resolved.should_explode}</p>
{/await}

```


####### packages/kit/test/apps/dev-only/src/routes/illegal-imports/server-only-modules/illegal.server.js #######

```

export const should_explode = 'boom';

```


####### packages/kit/test/apps/dev-only/src/routes/illegal-imports/server-only-modules/static-import/+page.svelte #######

```

<script>
	import { should_explode } from '../illegal.server.js';
</script>

<p>{should_explode}</p>

```


####### packages/kit/test/apps/dev-only/src/routes/+layout.svelte #######

```

<script>
	import { setup } from '../../../../setup.js';

	setup();
</script>

<slot />

```


####### packages/kit/test/apps/dev-only/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {}
};

export default config;

```


####### packages/kit/test/apps/dev-only/test/test.js #######

```

import { expect } from '@playwright/test';
import { test } from '../../../utils.js';

/** @typedef {import('@playwright/test').Response} Response */

test.describe.serial('Illegal imports', () => {
	test.skip(({ javaScriptEnabled }) => !process.env.DEV || !javaScriptEnabled);

	test('$env/dynamic/private is not statically importable from the client', async ({ page }) => {
		await page.goto('/illegal-imports/env/dynamic-private', {
			wait_for_started: false
		});
		expect(await page.textContent('.message-body')).toBe(
			'Cannot import $env/dynamic/private into client-side code'
		);
	});

	test('$env/dynamic/private is not dynamically importable from the client', async ({ page }) => {
		await page.goto('/illegal-imports/env/dynamic-private-dynamic-import', {
			wait_for_started: false
		});
		expect(await page.textContent('.message-body')).toBe(
			'Cannot import $env/dynamic/private into client-side code'
		);
	});

	test('$env/static/private is not statically importable from the client', async ({ page }) => {
		await page.goto('/illegal-imports/env/static-private', {
			wait_for_started: false
		});
		expect(await page.textContent('.message-body')).toBe(
			'Cannot import $env/static/private into client-side code'
		);
	});

	test('$env/static/private is not dynamically importable from the client', async ({ page }) => {
		await page.goto('/illegal-imports/env/static-private-dynamic-import', {
			wait_for_started: false
		});
		expect(await page.textContent('.message-body')).toBe(
			'Cannot import $env/static/private into client-side code'
		);
	});

	test('server-only module is not statically importable from the client', async ({ page }) => {
		await page.goto('/illegal-imports/server-only-modules/static-import', {
			wait_for_started: false
		});
		expect(await page.textContent('.message-body')).toBe(
			'Cannot import src/routes/illegal-imports/server-only-modules/illegal.server.js into client-side code'
		);
	});

	test('server-only module is not dynamically importable from the client', async ({ page }) => {
		await page.goto('/illegal-imports/server-only-modules/dynamic-import', {
			wait_for_started: false
		});
		expect(await page.textContent('.message-body')).toBe(
			'Cannot import src/routes/illegal-imports/server-only-modules/illegal.server.js into client-side code'
		);
	});

	test('server-only folder is not statically importable from the client', async ({ page }) => {
		await page.goto('/illegal-imports/server-only-folder/static-import', {
			wait_for_started: false
		});
		expect(await page.textContent('.message-body')).toBe(
			'Cannot import $lib/server/blah/private.js into client-side code'
		);
	});

	test('server-only folder is not dynamically importable from the client', async ({ page }) => {
		await page.goto('/illegal-imports/server-only-folder/dynamic-import', {
			wait_for_started: false
		});
		expect(await page.textContent('.message-body')).toBe(
			'Cannot import $lib/server/blah/private.js into client-side code'
		);
	});
});

```


####### packages/kit/test/apps/dev-only/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"noEmit": true,
		"resolveJsonModule": true
	},
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/kit/test/apps/dev-only/vite.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},
	clearScreen: false,
	optimizeDeps: {
		// for CI, we need to explicitly prebundle deps, since
		// the reload confuses Playwright
		include: ['cookie', 'marked']
	},
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/apps/embed/package.json #######

```

{
	"name": "test-embed",
	"private": true,
	"version": "0.0.1",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"test": "pnpm test:dev && pnpm test:build",
		"test:dev": "cross-env DEV=true playwright test",
		"test:build": "playwright test"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"cross-env": "^7.0.3",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/apps/embed/playwright.config.js #######

```

export { config as default } from '../../utils.js';

```


####### packages/kit/test/apps/embed/src/app.html #######

```

%sveltekit.head%
<div>%sveltekit.body%</div>

```


####### packages/kit/test/apps/embed/src/routes/embed/a/+page.svelte #######

```

<script>
	import { browser } from '$app/environment';
</script>

<h2 data-testid="a">a ({browser ? 'browser' : 'server'})</h2>

```


####### packages/kit/test/apps/embed/src/routes/embed/b/+page.svelte #######

```

<script>
	import { browser } from '$app/environment';
</script>

<h2 data-testid="b">b ({browser ? 'browser' : 'server'})</h2>

```


####### packages/kit/test/apps/embed/src/routes/embed/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	return {
		a: await fetch('/embed/a').then((x) => x.text()),
		b: await fetch('/embed/b').then((x) => x.text())
	};
}

```


####### packages/kit/test/apps/embed/src/routes/embed/+page.svelte #######

```

<script>
	export let data;
</script>

{@html data.a}
{@html data.b}

```


####### packages/kit/test/apps/embed/src/routes/+layout.svelte #######

```

<script>
	import { setup } from '../../../../setup.js';

	setup();
</script>

<slot />

```


####### packages/kit/test/apps/embed/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		embedded: true
	}
};

export default config;

```


####### packages/kit/test/apps/embed/test/test.js #######

```

import { expect } from '@playwright/test';
import { test } from '../../../utils.js';

/** @typedef {import('@playwright/test').Response} Response */

test.describe.configure({ mode: 'parallel' });

test.describe('embed', () => {
	test('serves embedded components in page', async ({ page, javaScriptEnabled }) => {
		await page.goto('/embed');

		if (javaScriptEnabled) {
			expect(await page.textContent('[data-testid="a"]')).toBe('a (browser)');
			expect(await page.textContent('[data-testid="b"]')).toBe('b (browser)');
		} else {
			expect(await page.textContent('[data-testid="a"]')).toBe('a (server)');
			expect(await page.textContent('[data-testid="b"]')).toBe('b (server)');
		}
	});
});

```


####### packages/kit/test/apps/embed/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"noEmit": true,
		"resolveJsonModule": true
	},
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/kit/test/apps/embed/vite.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},
	clearScreen: false,
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/apps/no-ssr/package.json #######

```

{
	"name": "test-no-ssr",
	"private": true,
	"version": "0.0.1",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"test": "pnpm test:dev && pnpm test:build",
		"test:dev": "cross-env DEV=true playwright test",
		"test:build": "playwright test"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"cross-env": "^7.0.3",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/apps/no-ssr/playwright.config.js #######

```

export { config as default } from '../../utils.js';

```


####### packages/kit/test/apps/no-ssr/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/png" href="%sveltekit.assets%/favicon.png" />
		%sveltekit.head%
	</head>
	<body>
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/apps/no-ssr/src/routes/+layout.js #######

```

export const ssr = false;

```


####### packages/kit/test/apps/no-ssr/src/routes/+layout.server.js #######

```


```


####### packages/kit/test/apps/no-ssr/src/routes/+layout.svelte #######

```

<script>
	import { setup } from '../../../../setup.js';

	setup();
</script>

<slot />

```


####### packages/kit/test/apps/no-ssr/src/routes/+page.svelte #######

```


```


####### packages/kit/test/apps/no-ssr/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {}
};

export default config;

```


####### packages/kit/test/apps/no-ssr/test/test.js #######

```

import { expect } from '@playwright/test';
import { test } from '../../../utils.js';

/** @typedef {import('@playwright/test').Response} Response */

test.skip(({ javaScriptEnabled }) => !javaScriptEnabled);

test.describe.configure({ mode: 'parallel' });

test('navigating to a non-existent route renders the default error page', async ({ page }) => {
	test.setTimeout(3000);
	await page.goto('/non-existent-route');
	await page.waitForLoadState('networkidle');
	expect(await page.textContent('h1')).toBe('404');
});

```


####### packages/kit/test/apps/no-ssr/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"noEmit": true,
		"resolveJsonModule": true
	},
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/kit/test/apps/no-ssr/vite.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},
	clearScreen: false,
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/apps/options-2/package.json #######

```

{
	"name": "test-options-2",
	"private": true,
	"version": "0.0.1",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"test": "pnpm test:dev && pnpm test:build",
		"test:dev": "cross-env DEV=true playwright test",
		"test:build": "playwright test"
	},
	"devDependencies": {
		"@sveltejs/adapter-node": "workspace:^",
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"cross-env": "^7.0.3",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/apps/options-2/playwright.config.js #######

```

export { config as default } from '../../utils.js';

```


####### packages/kit/test/apps/options-2/README.md #######

This app exists to test options that are equivalent with the ones specified in the other `options` test app.

####### packages/kit/test/apps/options-2/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/apps/options-2/src/routes/deeply/nested/page/+page.svelte #######

```

<script>
	import { base, assets } from '$app/paths';
</script>

<h1>Hello</h1>

<p data-testid="base">base: {base}</p>
<p data-testid="assets">assets: {assets}</p>

```


####### packages/kit/test/apps/options-2/src/routes/env/+page.svelte #######

```

<script>
	import { PUBLIC_LOOK_IN_OPTIONS_2 } from '$env/static/public';
	import { env } from '$env/dynamic/public';
</script>

<p data-testid="static">static: {PUBLIC_LOOK_IN_OPTIONS_2}</p>
<p data-testid="dynamic">dynamic: {env.PUBLIC_LOOK_IN_OPTIONS_2}</p>

```


####### packages/kit/test/apps/options-2/src/routes/hello/+page.js #######

```

export const prerender = true;

```


####### packages/kit/test/apps/options-2/src/routes/hello/+page.svelte #######

```

<h1>Prerendered</h1>

```


####### packages/kit/test/apps/options-2/src/routes/+layout.svelte #######

```

<script>
	import { setup } from '../../../../setup.js';

	setup();
</script>

<slot />

```


####### packages/kit/test/apps/options-2/src/routes/+page.svelte #######

```

<script>
	import { base, assets } from '$app/paths';
</script>

<h1>Hello</h1>

<p data-testid="base">base: {base}</p>
<p data-testid="assets">assets: {assets}</p>

<a href="{base}/hello" data-testid="link">Go to /hello</a>

```


####### packages/kit/test/apps/options-2/src/service-worker.js #######

```

import { base, build, version } from '$service-worker';
import src from './image.jpg?url';

//@ts-ignore
self.base = base;
//@ts-ignore
self.build = build;
//@ts-ignore
self.image_src = src;

const name = `cache-${version}`;

self.addEventListener('install', (event) => {
	// @ts-expect-error
	event.waitUntil(caches.open(name).then((cache) => cache.addAll(build)));
});

self.addEventListener('activate', (event) => {
	// @ts-expect-error
	event.waitUntil(
		caches.keys().then(async (keys) => {
			for (const key of keys) {
				if (!key.includes(version)) caches.delete(key);
			}
		})
	);
});

self.addEventListener('fetch', (event) => {
	// @ts-expect-error
	const { request } = event;

	if (request.method !== 'GET' || request.headers.has('range')) return;

	const url = new URL(request.url);
	const cached = caches.match(request);

	if (url.origin === location.origin && build.includes(url.pathname)) {
		// always return build files from cache
		// @ts-expect-error
		event.respondWith(cached);
	} else if (url.protocol === 'https:' || location.hostname === 'localhost') {
		// hit the network for everything else...
		const promise = fetch(request);

		// ...and cache successful responses...
		promise.then((response) => {
			// cache successful responses
			if (response.ok && response.type === 'basic') {
				const clone = response.clone();
				caches.open(name).then((cache) => {
					cache.put(request, clone);
				});
			}
		});

		// ...but if it fails, fall back to cache if available
		// @ts-expect-error
		event.respondWith(promise.catch(() => cached || promise));
	}
});

```


####### packages/kit/test/apps/options-2/static/answer.txt #######

42
####### packages/kit/test/apps/options-2/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		paths: {
			base: '/basepath',
			relative: true
		},
		serviceWorker: {
			register: false
		},
		env: {
			dir: '../../env'
		}
	}
};

export default config;

```


####### packages/kit/test/apps/options-2/test/test.js #######

```

import { expect } from '@playwright/test';
import { test } from '../../../utils.js';

/** @typedef {import('@playwright/test').Response} Response */

test.describe.configure({ mode: 'parallel' });

test.describe('env', () => {
	test('resolves upwards', async ({ page }) => {
		await page.goto('/basepath/env');
		expect(await page.textContent('[data-testid="static"]')).toBe('static: resolves upwards!');
		expect(await page.textContent('[data-testid="dynamic"]')).toBe('dynamic: resolves upwards!');
	});
});

test.describe('paths', () => {
	test('serves /basepath', async ({ page }) => {
		await page.goto('/basepath');
		expect(await page.textContent('h1')).toBe('Hello');
	});

	test('serves assets from /basepath', async ({ request }) => {
		const response = await request.get('/basepath/answer.txt');
		expect(await response.text()).toBe('42');
	});

	test('uses relative paths during SSR', async ({ page, javaScriptEnabled }) => {
		await page.goto('/basepath');

		let base = javaScriptEnabled ? '/basepath' : '.';
		expect(await page.textContent('[data-testid="base"]')).toBe(`base: ${base}`);
		expect(await page.textContent('[data-testid="assets"]')).toBe(`assets: ${base}`);

		await page.goto('/basepath/deeply/nested/page');

		base = javaScriptEnabled ? '/basepath' : '../..';
		expect(await page.textContent('[data-testid="base"]')).toBe(`base: ${base}`);
		expect(await page.textContent('[data-testid="assets"]')).toBe(`assets: ${base}`);
	});

	test('serves /basepath with trailing slash always', async ({ page }) => {
		await page.goto('/basepath');
		expect(new URL(page.url()).pathname).toBe('/basepath/');
	});

	test('respects trailing slash option when navigating from /basepath', async ({
		page,
		clicknav
	}) => {
		await page.goto('/basepath');
		expect(new URL(page.url()).pathname).toBe('/basepath/');
		await clicknav('[data-testid="link"]');
		expect(new URL(page.url()).pathname).toBe('/basepath/hello');
	});
});

test.describe('Service worker', () => {
	if (process.env.DEV) return;

	test('build /basepath/service-worker.js', async ({ baseURL, request }) => {
		const response = await request.get('/basepath/service-worker.js');
		const content = await response.text();

		const fn = new Function('self', 'location', content);

		const self = {
			addEventListener: () => {},
			base: null,
			build: null
		};

		const pathname = '/basepath/service-worker.js';

		fn(self, {
			href: baseURL + pathname,
			pathname
		});

		expect(self.base).toBe('/basepath');
		expect(self.build[0]).toMatch(/\/basepath\/_app\/immutable\/entry\/start\.[\w-]+\.js/);
		expect(self.image_src).toMatch(/\/basepath\/_app\/immutable\/assets\/image\.[\w-]+\.jpg/);
	});

	test('does not register /basepath/service-worker.js', async ({ page }) => {
		await page.goto('/basepath');
		expect(await page.content()).not.toMatch(/navigator\.serviceWorker/);
	});
});

```


####### packages/kit/test/apps/options-2/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true
	},
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/kit/test/apps/options-2/vite.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},
	clearScreen: false,
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/apps/options/package.json #######

```

{
	"name": "test-options",
	"private": true,
	"version": "0.0.1",
	"scripts": {
		"dev": "vite dev -c vite.custom.config.js",
		"build": "vite build -c vite.custom.config.js --mode custom",
		"preview": "vite preview -c vite.custom.config.js",
		"check": "svelte-kit sync && tsc && svelte-check",
		"test": "pnpm test:dev && pnpm test:build",
		"test:dev": "cross-env DEV=true playwright test",
		"test:build": "playwright test"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"cross-env": "^7.0.3",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/apps/options/playwright.config.js #######

```

export { config as default } from '../../utils.js';

```


####### packages/kit/test/apps/options/public/answer.html #######

```

42

```


####### packages/kit/test/apps/options/source/components/Message.svelte #######

```

<script>
	import { browser, dev } from '$app/environment';
</script>

<p>Hello from the {browser ? 'client' : 'server'} in {dev ? 'dev' : 'prod'} mode!</p>

```


####### packages/kit/test/apps/options/source/components/SvelteLogo.svelte #######

```

<div class="svelte-logo"></div>

<style>
	.svelte-logo {
		width: 107px;
		height: 128px;
		background: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="107" height="128" viewBox="0 0 107 128"><title>svelte-logo</title><path d="M94.1566,22.8189c-10.4-14.8851-30.94-19.2971-45.7914-9.8348L22.2825,29.6078A29.9234,29.9234,0,0,0,8.7639,49.6506a31.5136,31.5136,0,0,0,3.1076,20.2318A30.0061,30.0061,0,0,0,7.3953,81.0653a31.8886,31.8886,0,0,0,5.4473,24.1157c10.4022,14.8865,30.9423,19.2966,45.7914,9.8348L84.7167,98.3921A29.9177,29.9177,0,0,0,98.2353,78.3493,31.5263,31.5263,0,0,0,95.13,58.117a30,30,0,0,0,4.4743-11.1824,31.88,31.88,0,0,0-5.4473-24.1157" style="fill:%23ff3e00"/><path d="M45.8171,106.5815A20.7182,20.7182,0,0,1,23.58,98.3389a19.1739,19.1739,0,0,1-3.2766-14.5025,18.1886,18.1886,0,0,1,.6233-2.4357l.4912-1.4978,1.3363.9815a33.6443,33.6443,0,0,0,10.203,5.0978l.9694.2941-.0893.9675a5.8474,5.8474,0,0,0,1.052,3.8781,6.2389,6.2389,0,0,0,6.6952,2.485,5.7449,5.7449,0,0,0,1.6021-.7041L69.27,76.281a5.4306,5.4306,0,0,0,2.4506-3.631,5.7948,5.7948,0,0,0-.9875-4.3712,6.2436,6.2436,0,0,0-6.6978-2.4864,5.7427,5.7427,0,0,0-1.6.7036l-9.9532,6.3449a19.0329,19.0329,0,0,1-5.2965,2.3259,20.7181,20.7181,0,0,1-22.2368-8.2427,19.1725,19.1725,0,0,1-3.2766-14.5024,17.9885,17.9885,0,0,1,8.13-12.0513L55.8833,23.7472a19.0038,19.0038,0,0,1,5.3-2.3287A20.7182,20.7182,0,0,1,83.42,29.6611a19.1739,19.1739,0,0,1,3.2766,14.5025,18.4,18.4,0,0,1-.6233,2.4357l-.4912,1.4978-1.3356-.98a33.6175,33.6175,0,0,0-10.2037-5.1l-.9694-.2942.0893-.9675a5.8588,5.8588,0,0,0-1.052-3.878,6.2389,6.2389,0,0,0-6.6952-2.485,5.7449,5.7449,0,0,0-1.6021.7041L37.73,51.719a5.4218,5.4218,0,0,0-2.4487,3.63,5.7862,5.7862,0,0,0,.9856,4.3717,6.2437,6.2437,0,0,0,6.6978,2.4864,5.7652,5.7652,0,0,0,1.602-.7041l9.9519-6.3425a18.978,18.978,0,0,1,5.2959-2.3278,20.7181,20.7181,0,0,1,22.2368,8.2427,19.1725,19.1725,0,0,1,3.2766,14.5024,17.9977,17.9977,0,0,1-8.13,12.0532L51.1167,104.2528a19.0038,19.0038,0,0,1-5.3,2.3287" style="fill:%23fff"/></svg>');
	}
</style>

```


####### packages/kit/test/apps/options/source/hooks.client.js #######

```


```


####### packages/kit/test/apps/options/source/hooks.server.js #######

```

import { env } from '$env/dynamic/private';

// this verifies that dynamic env vars can be read during analysis phase
// (it would fail if this app contained prerendered routes)
// eslint-disable-next-line @typescript-eslint/no-unused-vars
const FOO = env.FOO;

/** @type {import('@sveltejs/kit').Handle} */
export function handle({ event, resolve }) {
	return resolve(event, {
		// this allows us to check that <link rel="stylesheet"> is still added
		// to the DOM even if they're not included by `preload`
		preload: ({ type }) => type !== 'css'
	});
}

```


####### packages/kit/test/apps/options/source/pages/base/+page.js #######

```

import { base, assets } from '$app/paths';

/** @type {import('@sveltejs/kit').Load} */
export async function load() {
	return {
		paths: {
			base,
			assets
		}
	};
}

```


####### packages/kit/test/apps/options/source/pages/base/+page.svelte #######

```

<script>
	import SvelteLogo from '$lib/SvelteLogo.svelte';

	/** @type {import('./$types').PageData} */
	export let data;

	let n = 0;
</script>

<SvelteLogo />

<p data-source="base">{data.paths.base}</p>
<p data-source="assets">{data.paths.assets}</p>

<button on:click={() => (n += 1)}>clicks: {n}</button>

{#if n === 1}
	<h2>button has been clicked 1 time</h2>
{/if}

<style>
	p {
		color: red;
	}
</style>

```


####### packages/kit/test/apps/options/source/pages/base/[slug]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
	import SvelteLogo from '$lib/SvelteLogo.svelte';
</script>

<SvelteLogo />

<h2>{$page.params.slug}</h2>

<a href="/path-base/base/two">/path-base/base/two</a>

```


####### packages/kit/test/apps/options/source/pages/csp/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<svelte:head>
	<script src="http://localhost:{$page.url.searchParams.get('port')}/blocked.js"></script>
</svelte:head>

```


####### packages/kit/test/apps/options/source/pages/custom-extensions/a/+page.svelte #######

```

<h2>a</h2>

```


####### packages/kit/test/apps/options/source/pages/custom-extensions/const/+page.whokilledthemuffinman #######

```

<h2>Tremendous!</h2> 

```


####### packages/kit/test/apps/options/source/pages/custom-extensions/+layout.svelte #######

```

<script>
	import { goto, preloadCode, preloadData } from '$app/navigation';

	if (typeof window !== 'undefined') {
		Object.assign(window, { goto, preloadCode, preloadData });
	}
</script>

<slot />

<footer>Custom layout</footer>

```


####### packages/kit/test/apps/options/source/pages/custom-extensions/+page.jesuslivesineveryone #######

```

<h2>Great success!</h2>

<a href="a">a</a>
<a href="ambiguous/ok.json">ok</a>
<a href="echo-query?message">ok</a>
<a href="echo-query?p=one&p=two">ok</a>

<div class='hydrate-test'></div> 

```


####### packages/kit/test/apps/options/source/pages/custom-extensions/[slug]/+page.svelte.md #######

<script>import { page } from '$app/stores';</script>

<h2>{$page.params.slug.toUpperCase()}</h2>

####### packages/kit/test/apps/options/source/pages/custom-extensions/unsafe-replacement/+page.svelte #######

```

<h2>Bazooom!</h2>

```


####### packages/kit/test/apps/options/source/pages/endpoint/+server.js #######

```

export function GET() {
	return new Response('hi');
}

```


####### packages/kit/test/apps/options/source/pages/endpoint-with-slash/+server.js #######

```

export function GET() {
	return new Response('hi');
}

export const trailingSlash = 'always';

```


####### packages/kit/test/apps/options/source/pages/env/+page.server.js #######

```

import { TOP_SECRET_SHH_PLS } from '$env/static/private';
import { env } from '$env/dynamic/private';

export function load() {
	return {
		TOP_SECRET_SHH_PLS,
		// @ts-expect-error
		MATCHES_NEITHER: env.MATCHES_NEITHER || ''
	};
}

```


####### packages/kit/test/apps/options/source/pages/env/+page.svelte #######

```

<script>
	import { GO_AWAY_PLEASE } from '$env/static/public';
	export let data;
</script>

<p id="public">{GO_AWAY_PLEASE}</p>
<p id="private">{data.TOP_SECRET_SHH_PLS}</p>
<p id="neither">{data.MATCHES_NEITHER}</p>

```


####### packages/kit/test/apps/options/source/pages/error/+page.svelte #######

```

<!-- https://github.com/sveltejs/kit/issues/4186 -->

```


####### packages/kit/test/apps/options/source/pages/+layout.server.js #######

```

export const trailingSlash = 'always';

```


####### packages/kit/test/apps/options/source/pages/+layout.svelte #######

```

<script>
	import { setup } from '../../../../setup.js';

	setup();
</script>

<slot />

```


####### packages/kit/test/apps/options/source/pages/mode/+page.server.js #######

```

export function load() {
	return {
		mode_from_endpoint: import.meta.env.MODE
	};
}

```


####### packages/kit/test/apps/options/source/pages/mode/+page.svelte #######

```

<script>
	import { dev } from '$app/environment';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h2>
	{data.mode_from_endpoint} === {import.meta.env.MODE} === {dev ? 'development' : 'custom'}
</h2>

```


####### packages/kit/test/apps/options/source/pages/page-endpoint/+page.server.js #######

```

export function load() {
	return {
		message: 'hi'
	};
}

```


####### packages/kit/test/apps/options/source/pages/page-endpoint/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h2>{data.message}</h2>

```


####### packages/kit/test/apps/options/source/pages/+page.svelte #######

```

<script>
	import Message from '$lib/Message.svelte';
</script>

<h2>We're on index.svelte</h2>
<Message />

```


####### packages/kit/test/apps/options/source/pages/preloading/code/+page.svelte #######

```

<h1>Should preload my code</h1>

```


####### packages/kit/test/apps/options/source/pages/preloading/+page.svelte #######

```

<a data-sveltekit-preload-data href="/path-base/preloading/preloaded">click me</a>
<a data-sveltekit-preload-code href="/path-base/preloading/code">click me 2</a>

```


####### packages/kit/test/apps/options/source/pages/preloading/preloaded/+page.server.js #######

```

export function load() {
	return {
		message: 'preloaded'
	};
}

```


####### packages/kit/test/apps/options/source/pages/preloading/preloaded/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.message}</h1>

```


####### packages/kit/test/apps/options/source/pages/resolve-route/[foo]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h2>{$page.params.foo}</h2>

```


####### packages/kit/test/apps/options/source/pages/resolve-route/+page.svelte #######

```

<script>
	import { resolveRoute } from '$app/paths';
</script>

<a data-id="target" href={resolveRoute('/resolve-route/[foo]', { foo: 'resolved' })}>click me</a>

```


####### packages/kit/test/apps/options/source/pages/routing/link-outside-app-target/source/+page.svelte #######

```

<script>
	import { onMount } from 'svelte';
	import { increment, count } from '../state.js';

	onMount(increment);
</script>

<h2>source: {count}</h2>

```


####### packages/kit/test/apps/options/source/pages/routing/link-outside-app-target/state.js #######

```

export let count = 0;

export function increment() {
	count += 1;
}

```


####### packages/kit/test/apps/options/source/pages/routing/link-outside-app-target/target/+page.svelte #######

```

<script>
	import { count } from '../state.js';
</script>

<h2>target: {count}</h2>

```


####### packages/kit/test/apps/options/source/pages/slash/child/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h2>{$page.url.pathname}</h2>

```


####### packages/kit/test/apps/options/source/pages/slash/+page.svelte #######

```

<script>
	import { base } from '$app/paths';
	import { page } from '$app/stores';
</script>

<h2>{$page.url.pathname}</h2>

<a data-testid="child" href="{base}/slash/child">/slash/child</a>

```


####### packages/kit/test/apps/options/source/pages/test.txt #######

hello there world

####### packages/kit/test/apps/options/source/template.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/png" href="%sveltekit.assets%/favicon.png" />
		%sveltekit.head%
	</head>
	<body>
		<h1>I am in the template</h1>
		<div>%sveltekit.body%</div>
		<a href="/path-base/routing/link-outside-app-target/target/">outside app target</a>
	</body>
</html>

```


####### packages/kit/test/apps/options/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {
	extensions: ['.jesuslivesineveryone', '.whokilledthemuffinman', '.svelte.md', '.svelte'],
	kit: {
		embedded: true,
		csp: {
			directives: {
				'script-src': ['self'],
				'require-trusted-types-for': ['script']
			}
		},
		files: {
			assets: 'public',
			lib: 'source/components',
			routes: 'source/pages',
			appTemplate: 'source/template.html',
			hooks: {
				client: 'source/hooks.client.js',
				server: 'source/hooks.server.js'
			},
			// while we specify a path for the service worker, we expect it to not exist in the test
			serviceWorker: 'source/service-worker'
		},
		appDir: '_wheee',
		inlineStyleThreshold: 1024,
		outDir: '.custom-out-dir',
		output: {
			preloadStrategy: 'preload-mjs'
		},
		paths: {
			base: '/path-base',
			assets: 'https://cdn.example.com/stuff'
		},
		env: {
			dir: './env-dir',
			publicPrefix: 'GO_AWAY_',
			privatePrefix: 'TOP_SECRET_SHH'
		}
	}
};

export default config;

```


####### packages/kit/test/apps/options/test/test.js #######

```

import * as http from 'node:http';
import { expect } from '@playwright/test';
import { test } from '../../../utils.js';

/** @typedef {import('@playwright/test').Response} Response */

test.describe.configure({ mode: 'parallel' });

test.describe('base path', () => {
	test('serves a useful 404 when visiting unprefixed path', async ({ request }) => {
		const html = await request.get('/slash/', { headers: { Accept: 'text/html' } });
		expect(html.status()).toBe(404);
		expect(await html.text()).toBe(
			'The server is configured with a public base URL of /path-base - did you mean to visit <a href="/path-base/slash/">/path-base/slash/</a> instead?'
		);

		const plain = await request.get('/slash/');
		expect(plain.status()).toBe(404);
		expect(await plain.text()).toBe(
			'The server is configured with a public base URL of /path-base - did you mean to visit /path-base/slash/ instead?'
		);
	});

	test('serves /', async ({ page, javaScriptEnabled }) => {
		await page.goto('/path-base/');

		expect(await page.textContent('h1')).toBe('I am in the template');
		expect(await page.textContent('h2')).toBe("We're on index.svelte");

		const mode = process.env.DEV ? 'dev' : 'prod';
		expect(await page.textContent('p')).toBe(
			`Hello from the ${javaScriptEnabled ? 'client' : 'server'} in ${mode} mode!`
		);
	});

	if (process.env.DEV) {
		test('serves files in source directory', async ({ request, javaScriptEnabled }) => {
			if (!javaScriptEnabled) return;

			const response = await request.get('/path-base/source/pages/test.txt');
			expect(response.ok()).toBe(true);
			expect(await response.text()).toBe('hello there world\n');
		});
	}

	test('paths available on server side', async ({ page }) => {
		await page.goto('/path-base/base/');
		expect(await page.textContent('[data-source="base"]')).toBe('/path-base');
		expect(await page.textContent('[data-source="assets"]')).toBe('/_svelte_kit_assets');
	});

	test('loads javascript', async ({ page, javaScriptEnabled }) => {
		await page.goto('/path-base/base/');
		expect(await page.textContent('button')).toBe('clicks: 0');

		if (javaScriptEnabled) {
			await page.click('button');
			expect(await page.innerHTML('h2')).toBe('button has been clicked 1 time');
		}
	});

	test('loads CSS', async ({ page, get_computed_style }) => {
		await page.goto('/path-base/base/');
		expect(await get_computed_style('p', 'color')).toBe('rgb(255, 0, 0)');
	});

	test('inlines CSS', async ({ page, javaScriptEnabled }) => {
		await page.goto('/path-base/base/');
		if (process.env.DEV) {
			const ssr_style = await page.$('style[data-sveltekit]');

			if (javaScriptEnabled) {
				// <style data-sveltekit> is removed upon hydration
				expect(ssr_style).toBeNull();
			} else {
				expect(ssr_style).not.toBeNull();
			}

			expect(await page.$('link[rel="stylesheet"]')).toBeNull();
		} else {
			expect(await page.$('style')).not.toBeNull();
			expect(await page.$('link[rel="stylesheet"][disabled]')).not.toBeNull();
			expect(await page.$('link[rel="stylesheet"]:not([disabled])')).not.toBeNull();
		}
	});

	test('sets params correctly', async ({ page, clicknav }) => {
		await page.goto('/path-base/base/one');

		expect(await page.textContent('h2')).toBe('one');

		await clicknav('[href="/path-base/base/two"]');
		expect(await page.textContent('h2')).toBe('two');
	});

	test('resolveRoute accounts for base path', async ({ baseURL, page, clicknav }) => {
		await page.goto('/path-base/resolve-route');
		await clicknav('[data-id=target]');
		expect(page.url()).toBe(`${baseURL}/path-base/resolve-route/resolved/`);
		expect(await page.textContent('h2')).toBe('resolved');
	});
});

test.describe('assets path', () => {
	test('serves static assets with correct prefix', async ({ page, request }) => {
		await page.goto('/path-base/');
		const href = await page.locator('link[rel="icon"]').getAttribute('href');

		const response = await request.get(href);
		expect(response.status()).toBe(200);
	});
});

test.describe('CSP', () => {
	test('blocks script from external site', async ({ page, start_server }) => {
		const { port } = await start_server((req, res) => {
			if (req.url === '/blocked.js') {
				res.writeHead(200, {
					'content-type': 'text/javascript'
				});

				res.end('window.pwned = true');
			} else {
				res.writeHead(404).end('not found');
			}
		});

		await page.goto(`/path-base/csp?port=${port}`);
		expect(await page.evaluate('window.pwned')).toBe(undefined);
	});

	test("quotes 'script'", async ({ page }) => {
		const response = await page.goto('/path-base');
		expect(response.headers()['content-security-policy']).toMatch(
			/require-trusted-types-for 'script'/
		);
	});
});

test.describe('Custom extensions', () => {
	test('works with arbitrary extensions', async ({ page }) => {
		await page.goto('/path-base/custom-extensions/');
		expect(await page.textContent('h2')).toBe('Great success!');
	});

	test('works with other arbitrary extensions', async ({ page }) => {
		await page.goto('/path-base/custom-extensions/const');
		expect(await page.textContent('h2')).toBe('Tremendous!');

		await page.goto('/path-base/custom-extensions/a');

		expect(await page.textContent('h2')).toBe('a');

		await page.goto('/path-base/custom-extensions/test-slug');

		expect(await page.textContent('h2')).toBe('TEST-SLUG');

		await page.goto('/path-base/custom-extensions/unsafe-replacement');

		expect(await page.textContent('h2')).toBe('Bazooom!');
	});
});

test.describe('env', () => {
	test('resolves downwards', async ({ page }) => {
		await page.goto('/path-base/env');
		expect(await page.textContent('#public')).toBe('and thank you');
	});
	test('respects private prefix', async ({ page }) => {
		await page.goto('/path-base/env');
		expect(await page.textContent('#private')).toBe('shhhh');
		expect(await page.textContent('#neither')).toBe('');
	});
});

test.describe('trailingSlash', () => {
	test('adds trailing slash', async ({ baseURL, page, clicknav }) => {
		// we can't use Playwright's `request` here, because it resolves redirects
		const status = await new Promise((fulfil, reject) => {
			const request = http.get(`${baseURL}/path-base/slash`);
			request.on('error', reject);
			request.on('response', (response) => {
				fulfil(response.statusCode);
			});
		});
		expect(status).toBe(308);

		await page.goto('/path-base/slash');

		expect(page.url()).toBe(`${baseURL}/path-base/slash/`);
		expect(await page.textContent('h2')).toBe('/path-base/slash/');

		await clicknav('[data-testid="child"]');
		expect(page.url()).toBe(`${baseURL}/path-base/slash/child/`);
		expect(await page.textContent('h2')).toBe('/path-base/slash/child/');
	});

	test('removes trailing slash on endpoint', async ({ baseURL, request }) => {
		const r1 = await request.get('/path-base/endpoint/');
		expect(r1.url()).toBe(`${baseURL}/path-base/endpoint`);
		expect(await r1.text()).toBe('hi');

		const r2 = await request.get('/path-base/endpoint');
		expect(r2.url()).toBe(`${baseURL}/path-base/endpoint`);
		expect(await r2.text()).toBe('hi');
	});

	test('adds trailing slash to endpoint', async ({ baseURL, request }) => {
		const r1 = await request.get('/path-base/endpoint-with-slash');
		expect(r1.url()).toBe(`${baseURL}/path-base/endpoint-with-slash/`);
		expect(await r1.text()).toBe('hi');

		const r2 = await request.get('/path-base/endpoint-with-slash/');
		expect(r2.url()).toBe(`${baseURL}/path-base/endpoint-with-slash/`);
		expect(await r2.text()).toBe('hi');
	});

	test('can fetch data from page-endpoint', async ({ request }) => {
		const r = await request.get('/path-base/page-endpoint/__data.json');
		const data = await r.json();

		expect(data).toEqual({
			type: 'data',
			nodes: [
				{ type: 'data', data: [null], uses: {}, slash: 'always' },
				{ type: 'data', data: [{ message: 1 }, 'hi'], uses: {} }
			]
		});
	});

	test('accounts for trailingSlash when preloading', async ({ app, page, javaScriptEnabled }) => {
		if (!javaScriptEnabled) return;

		await page.goto('/path-base/preloading');

		/** @type {string[]} */
		let requests = [];
		page.on('request', (r) => requests.push(new URL(r.url()).pathname));

		// also wait for network processing to complete, see
		// https://playwright.dev/docs/network#network-events
		await app.preloadCode('/path-base/preloading/preloaded');

		// svelte request made is environment dependent
		if (process.env.DEV) {
			expect(requests.filter((req) => req.endsWith('.svelte')).length).toBe(1);
		} else {
			expect(requests.filter((req) => req.endsWith('.mjs')).length).toBeGreaterThan(0);
		}

		requests = [];
		await app.preloadData('/path-base/preloading/preloaded');

		expect(requests.includes('/path-base/preloading/preloaded/__data.json')).toBe(true);

		requests = [];
		await app.goto('/path-base/preloading/preloaded');
		expect(requests).toEqual([]);
	});

	test('accounts for base path when running data-sveltekit-preload-code', async ({
		page,
		javaScriptEnabled
	}) => {
		if (!javaScriptEnabled) return;

		await page.goto('/path-base/preloading');

		/** @type {string[]} */
		let requests = [];
		page.on('request', (r) => requests.push(new URL(r.url()).pathname));

		await page.hover('a[href="/path-base/preloading/code"]');
		await page.waitForTimeout(100);

		// svelte request made is environment dependent
		if (process.env.DEV) {
			expect(requests.filter((req) => req.endsWith('.svelte')).length).toBe(1);
		} else {
			expect(requests.filter((req) => req.endsWith('.mjs')).length).toBeGreaterThan(0);
		}

		requests = [];
		await page.click('a[href="/path-base/preloading/code"]');
		expect(requests).toEqual([]);
	});
});

if (!process.env.DEV) {
	test.describe('serviceWorker', () => {
		test('does not register service worker if none created', async ({ page }) => {
			await page.goto('/path-base/');
			expect(await page.content()).not.toMatch('navigator.serviceWorker');
		});
	});
}

test.describe('Vite options', () => {
	test('Respects --mode', async ({ page }) => {
		await page.goto('/path-base/mode');

		const mode = process.env.DEV ? 'development' : 'custom';
		expect(await page.textContent('h2')).toBe(`${mode} === ${mode} === ${mode}`);
	});
});

test.describe('Routing', () => {
	test('ignores clicks outside the app target', async ({ page }) => {
		await page.goto('/path-base/routing/link-outside-app-target/source/');

		await page.click('[href="/path-base/routing/link-outside-app-target/target/"]');
		await expect(page.locator('h2')).toHaveText('target: 0');
	});
});

```


####### packages/kit/test/apps/options/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true
	},
	"extends": "./.custom-out-dir/tsconfig.json"
}

```


####### packages/kit/test/apps/options/vite.custom.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},
	clearScreen: false,
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/apps/read-file-test.txt #######

Imported with url glob from the read-file test in basics. Placed here outside the app folder to force a /@fs prefix 😎

####### packages/kit/test/apps/writes/package.json #######

```

{
	"name": "test-writes",
	"private": true,
	"version": "0.0.2-next.0",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"test": "pnpm test:dev && pnpm test:build",
		"test:dev": "cross-env DEV=true playwright test",
		"test:build": "playwright test"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"cross-env": "^7.0.3",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/apps/writes/playwright.config.js #######

```

export { config as default } from '../../utils.js';

```


####### packages/kit/test/apps/writes/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/png" href="%sveltekit.assets%/favicon.png" />
		%sveltekit.head%
	</head>
	<body>
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/apps/writes/src/global.d.ts #######

```

declare global {
	interface Window {
		mounted: number;
	}
}

export {};

```


####### packages/kit/test/apps/writes/src/routes/double-mount/+page.svelte #######

```

<script context="module">
	import { browser } from '$app/environment';

	if (browser) {
		window.mounted = window.mounted || 0;
	}
</script>

<script>
	import { goto } from '$app/navigation';
	import { onMount } from 'svelte';

	let mounted = 0;

	onMount(() => {
		mounted = window.mounted += 1;
	});
</script>

<h1>mounted: {browser ? mounted : 0}</h1>
<button on:click={() => goto('/double-mount')}>click me</button>
<span hidden>PLACEHOLDER:0</span>

```


####### packages/kit/test/apps/writes/src/routes/+layout.svelte #######

```

<script>
	import { setup } from '../../../../setup.js';

	setup();
</script>

<slot />

```


####### packages/kit/test/apps/writes/src/routes/new-route/+page.svelte #######

```

<h1>Great success!</h1>

```


####### packages/kit/test/apps/writes/src/routes/new-route/zzzz1662642734866/+page.svelte #######

```

<h1>Hello new route</h1>

```


####### packages/kit/test/apps/writes/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		prerender: {
			handleHttpError: 'warn'
		}
	}
};

export default config;

```


####### packages/kit/test/apps/writes/test/test.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import { expect } from '@playwright/test';
import { fileURLToPath } from 'node:url';
import { test } from '../../../utils.js';

/** @typedef {import('@playwright/test').Response} Response */

test.describe.configure({ mode: 'serial' });

test.describe('Filesystem updates', () => {
	if (process.env.DEV) {
		test('New route is immediately available in dev', async ({ page }) => {
			await page.goto('/new-route');

			// hash the filename so that it won't conflict with
			// future test file that has the same name
			const route = 'zzzz' + Date.now();
			const content = 'Hello new route';
			const __dirname = path.dirname(fileURLToPath(import.meta.url));
			const filepath = path.join(__dirname, `../src/routes/new-route/${route}/+page.svelte`);
			const dir = path.dirname(filepath);

			try {
				fs.mkdirSync(dir);
				fs.writeFileSync(filepath, `<h1>${content}</h1>`);
				await page.waitForTimeout(500); // this is the rare time we actually need waitForTimeout; we have no visibility into whether the module graph has been invalidated
				await page.goto(`/new-route/${route}`);

				expect(await page.textContent('h1')).toBe(content);
			} finally {
				fs.rmSync(dir, { recursive: true });
			}
		});
	}

	test('Components are not double-mounted', async ({ page, javaScriptEnabled }) => {
		const file = fileURLToPath(new URL('../src/routes/double-mount/+page.svelte', import.meta.url));
		const contents = fs.readFileSync(file, 'utf-8');

		const mounted = javaScriptEnabled ? 1 : 0;

		try {
			// we write to the file, to trigger HMR invalidation
			fs.writeFileSync(file, contents.replace(/PLACEHOLDER:\d+/, `PLACEHOLDER:${Date.now()}`));
			await page.goto('/double-mount');
			expect(await page.textContent('h1')).toBe(`mounted: ${mounted}`);
			await page.click('button');
			await page.waitForTimeout(100);
			expect(await page.textContent('h1')).toBe(`mounted: ${mounted}`);
		} finally {
			fs.writeFileSync(file, contents.replace(/PLACEHOLDER:\d+/, 'PLACEHOLDER:0'));
		}
	});
});

```


####### packages/kit/test/apps/writes/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"noEmit": true,
		"resolveJsonModule": true
	},
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/kit/test/apps/writes/vite.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},
	clearScreen: false,
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/package.json #######

```

{
	"name": "prerenderable-incorrect-fragment",
	"private": true,
	"version": "0.0.1",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check"
	},
	"devDependencies": {
		"@sveltejs/adapter-auto": "workspace:^",
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/src/routes/foo/+page.svelte #######

```

<h1 id="exists">foo</h1>

```


####### packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/src/routes/+layout.js #######

```

export const prerender = true;

```


####### packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/src/routes/+page.svelte #######

```

<a href="foo#missing">missing</a>

```


####### packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/svelte.config.js #######

```

import adapter from '../../../../../adapter-auto/index.js';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter()
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true
	},
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment/vite.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},

	clearScreen: false,

	logLevel: 'silent',

	plugins: [sveltekit()],

	server: {
		fs: {
			allow: [path.resolve('../../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/prerenderable-not-prerendered/package.json #######

```

{
	"name": "prerenderable-not-prerendered",
	"private": true,
	"version": "0.0.1",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check"
	},
	"devDependencies": {
		"@sveltejs/adapter-auto": "workspace:^",
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/prerenderable-not-prerendered/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/prerenderable-not-prerendered/src/routes/+page.svelte #######

```

<a href="/foo">this page is not prerendered, so this link is not crawled</a>

```


####### packages/kit/test/build-errors/apps/prerenderable-not-prerendered/src/routes/[x]/+page.js #######

```

export const prerender = true;

```


####### packages/kit/test/build-errors/apps/prerenderable-not-prerendered/src/routes/[x]/+page.svelte #######

```

<h1>foo</h1>

```


####### packages/kit/test/build-errors/apps/prerenderable-not-prerendered/svelte.config.js #######

```

import adapter from '../../../../../adapter-auto/index.js';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter()
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/prerenderable-not-prerendered/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true
	},
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/kit/test/build-errors/apps/prerenderable-not-prerendered/vite.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},

	clearScreen: false,

	logLevel: 'silent',

	plugins: [sveltekit()],

	server: {
		fs: {
			allow: [path.resolve('../../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/package.json #######

```

{
	"name": "prerenderable-incorrect-fragment",
	"private": true,
	"version": "0.0.1",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check"
	},
	"devDependencies": {
		"@sveltejs/adapter-auto": "workspace:^",
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/src/routes/+layout.js #######

```

export const prerender = true;

```


####### packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/src/routes/[slug]/[notSpecific]/+page.ts #######

```

/** @type {import('./$types').EntryGenerator} */
export const entries = () => {
	return [{ slug: 'whatever', notSpecific: 'specific' }];
};

```


####### packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/src/routes/[slug]/specific/+page.svelte #######

```

<div>This will be matched</div>

```


####### packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/svelte.config.js #######

```

import adapter from '../../../../../adapter-auto/index.js';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter()
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true
	},
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch/vite.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},

	clearScreen: false,

	logLevel: 'silent',

	plugins: [sveltekit()],

	server: {
		fs: {
			allow: [path.resolve('../../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/private-dynamic-env-dynamic-import/package.json #######

```

{
	"name": "private-dynamic-env-dynamic-import",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"check:watch": "svelte-check --watch"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/private-dynamic-env-dynamic-import/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/private-dynamic-env-dynamic-import/src/routes/+page.svelte #######

```

<script>
	const p = import('$env/dynamic/private');
</script>

{#await p}
	<p>Awaiting...</p>
{:then envModule}
	<p>{envModule.env.SHOULD_EXPLODE}</p>
{/await}

```


####### packages/kit/test/build-errors/apps/private-dynamic-env-dynamic-import/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {};

export default config;

```


####### packages/kit/test/build-errors/apps/private-dynamic-env-dynamic-import/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"sourceMap": true,
		"strict": true,
		"noEmit": true
	}
}

```


####### packages/kit/test/build-errors/apps/private-dynamic-env-dynamic-import/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import path from 'node:path';

/** @type {import('vite').UserConfig} */
const config = {
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/private-dynamic-env/package.json #######

```

{
	"name": "private-dynamic-env",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"check:watch": "svelte-check --watch"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/private-dynamic-env/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/private-dynamic-env/src/routes/+page.svelte #######

```

<script>
	import { env } from '$env/dynamic/private';
</script>

<p>{env.SHOULD_EXPLODE}</p>

```


####### packages/kit/test/build-errors/apps/private-dynamic-env/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {};

export default config;

```


####### packages/kit/test/build-errors/apps/private-dynamic-env/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"sourceMap": true,
		"strict": true,
		"noEmit": true
	}
}

```


####### packages/kit/test/build-errors/apps/private-dynamic-env/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import path from 'node:path';

/** @type {import('vite').UserConfig} */
const config = {
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/private-static-env-dynamic-import/package.json #######

```

{
	"name": "private-static-env-dynamic-import",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"check:watch": "svelte-check --watch"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/private-static-env-dynamic-import/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/private-static-env-dynamic-import/src/routes/+page.svelte #######

```

<script>
	const p = import('$env/static/private');
</script>

{#await p}
	<p>Awaiting...</p>
{:then envModule}
	<p>{envModule.SHOULD_EXPLODE}</p>
{/await}

```


####### packages/kit/test/build-errors/apps/private-static-env-dynamic-import/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {};

export default config;

```


####### packages/kit/test/build-errors/apps/private-static-env-dynamic-import/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"sourceMap": true,
		"strict": true,
		"noEmit": true
	}
}

```


####### packages/kit/test/build-errors/apps/private-static-env-dynamic-import/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	plugins: [sveltekit()]
};

export default config;

```


####### packages/kit/test/build-errors/apps/private-static-env/package.json #######

```

{
	"name": "private-static-env",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"check:watch": "svelte-check --watch"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"cross-env": "^7.0.3",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/private-static-env/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/private-static-env/src/routes/+page.svelte #######

```

<script>
	import { SHOULD_EXPLODE } from '$env/static/private';
</script>

<p>{SHOULD_EXPLODE}</p>

```


####### packages/kit/test/build-errors/apps/private-static-env/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {};

export default config;

```


####### packages/kit/test/build-errors/apps/private-static-env/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"sourceMap": true,
		"strict": true,
		"noEmit": true
	}
}

```


####### packages/kit/test/build-errors/apps/private-static-env/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import path from 'node:path';

/** @type {import('vite').UserConfig} */
const config = {
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/package.json #######

```

{
	"name": "server-only-folder-dynamic-import",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"check:watch": "svelte-check --watch"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/src/lib/server/something/private.js #######

```

export const should_explode = 'boom';

```


####### packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/src/routes/+page.svelte #######

```

<script>
	const mod = import('$lib/server/something/private.js');
</script>

{#await mod then resolved}
	<p>{resolved.should_explode}</p>
{/await}

```


####### packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {};

export default config;

```


####### packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"sourceMap": true,
		"strict": true,
		"noEmit": true
	}
}

```


####### packages/kit/test/build-errors/apps/server-only-folder-dynamic-import/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import path from 'node:path';

/** @type {import('vite').UserConfig} */
const config = {
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/server-only-folder/package.json #######

```

{
	"name": "server-only-folder",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"check:watch": "svelte-check --watch"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/server-only-folder/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/server-only-folder/src/lib/server/something/private.js #######

```

export const should_explode = 'boom';

```


####### packages/kit/test/build-errors/apps/server-only-folder/src/routes/+page.svelte #######

```

<script>
	import { should_explode } from '$lib/server/something/private.js';
</script>

<p>{should_explode}</p>

```


####### packages/kit/test/build-errors/apps/server-only-folder/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {};

export default config;

```


####### packages/kit/test/build-errors/apps/server-only-folder/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"sourceMap": true,
		"strict": true,
		"noEmit": true
	}
}

```


####### packages/kit/test/build-errors/apps/server-only-folder/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import path from 'node:path';

/** @type {import('vite').UserConfig} */
const config = {
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/server-only-module-dynamic-import/package.json #######

```

{
	"name": "server-only-module-dynamic-import",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"check:watch": "svelte-check --watch"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/server-only-module-dynamic-import/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/server-only-module-dynamic-import/src/lib/test.server.js #######

```

export const should_explode = 'boom';

```


####### packages/kit/test/build-errors/apps/server-only-module-dynamic-import/src/routes/+page.svelte #######

```

<script>
	const mod = import('$lib/test.server.js');
</script>

{#await mod then resolved}
	<p>{resolved.should_explode}</p>
{/await}

```


####### packages/kit/test/build-errors/apps/server-only-module-dynamic-import/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {};

export default config;

```


####### packages/kit/test/build-errors/apps/server-only-module-dynamic-import/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"sourceMap": true,
		"strict": true,
		"noEmit": true
	}
}

```


####### packages/kit/test/build-errors/apps/server-only-module-dynamic-import/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import path from 'node:path';

/** @type {import('vite').UserConfig} */
const config = {
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/server-only-module/package.json #######

```

{
	"name": "server-only-module",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"check:watch": "svelte-check --watch"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/server-only-module/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/server-only-module/src/lib/test.server.js #######

```

export const should_explode = 'boom';

```


####### packages/kit/test/build-errors/apps/server-only-module/src/routes/+page.svelte #######

```

<script>
	import { should_explode } from '$lib/test.server.js';
</script>

<p>{should_explode}</p>

```


####### packages/kit/test/build-errors/apps/server-only-module/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {};

export default config;

```


####### packages/kit/test/build-errors/apps/server-only-module/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"sourceMap": true,
		"strict": true,
		"noEmit": true
	}
}

```


####### packages/kit/test/build-errors/apps/server-only-module/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import path from 'node:path';

/** @type {import('vite').UserConfig} */
const config = {
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/package.json #######

```

{
	"name": "service-worker-dynamic-public-env",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"check:watch": "svelte-check --watch"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/src/routes/+page.svelte #######

```

<h1>Bonjour</h1>

```


####### packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/src/service-worker.js #######

```

import { env } from '$env/dynamic/public';

console.log('Logging dynamic public env', env.PUBLIC_SHOULD_EXPLODE);

```


####### packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {};

export default config;

```


####### packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"sourceMap": true,
		"strict": true,
		"noEmit": true
	}
}

```


####### packages/kit/test/build-errors/apps/service-worker-dynamic-public-env/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import path from 'node:path';

/** @type {import('vite').UserConfig} */
const config = {
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/service-worker-private-env/package.json #######

```

{
	"name": "service-worker-private-env",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"check:watch": "svelte-check --watch"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/service-worker-private-env/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/service-worker-private-env/src/routes/+page.svelte #######

```

<h1>Bonjour</h1>

```


####### packages/kit/test/build-errors/apps/service-worker-private-env/src/service-worker.js #######

```

import { env } from '$env/dynamic/private';

console.log('Logging private env', env);

```


####### packages/kit/test/build-errors/apps/service-worker-private-env/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {};

export default config;

```


####### packages/kit/test/build-errors/apps/service-worker-private-env/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"sourceMap": true,
		"strict": true,
		"noEmit": true
	}
}

```


####### packages/kit/test/build-errors/apps/service-worker-private-env/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import path from 'node:path';

/** @type {import('vite').UserConfig} */
const config = {
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/apps/syntax-error/package.json #######

```

{
	"name": "syntax-error",
	"version": "0.0.1",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module"
}

```


####### packages/kit/test/build-errors/apps/syntax-error/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
	</body>
</html>

```


####### packages/kit/test/build-errors/apps/syntax-error/src/lib/test.server.js #######

```

export const should_explode = 'boom';

```


####### packages/kit/test/build-errors/apps/syntax-error/src/routes/+page.svelte #######

```

<div
```


####### packages/kit/test/build-errors/apps/syntax-error/svelte.config.js #######

```

/** @type {import('@sveltejs/kit').Config} */
const config = {};

export default config;

```


####### packages/kit/test/build-errors/apps/syntax-error/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"sourceMap": true,
		"strict": true,
		"noEmit": true
	}
}

```


####### packages/kit/test/build-errors/apps/syntax-error/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import path from 'node:path';

/** @type {import('vite').UserConfig} */
const config = {
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: [path.resolve('../../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/build-errors/env.spec.js #######

```

import { assert, test } from 'vitest';
import { execSync } from 'node:child_process';
import path from 'node:path';

test('$env/dynamic/private is not statically importable from the client', () => {
	assert.throws(
		() =>
			execSync('pnpm build', {
				cwd: path.join(process.cwd(), 'apps/private-dynamic-env'),
				stdio: 'pipe',
				timeout: 60000
			}),
		/.*Cannot import \$env\/dynamic\/private into client-side code:.*/gs
	);
});

test('$env/dynamic/private is not dynamically importable from the client', () => {
	assert.throws(
		() =>
			execSync('pnpm build', {
				cwd: path.join(process.cwd(), 'apps/private-dynamic-env-dynamic-import'),
				stdio: 'pipe',
				timeout: 60000
			}),
		/.*Cannot import \$env\/dynamic\/private into client-side code:.*/gs
	);
});

test('$env/static/private is not statically importable from the client', () => {
	assert.throws(
		() =>
			execSync('pnpm build', {
				cwd: path.join(process.cwd(), 'apps/private-static-env'),
				stdio: 'pipe',
				timeout: 60000
			}),
		/.*Cannot import \$env\/static\/private into client-side code:.*/gs
	);
});

test('$env/static/private is not dynamically importable from the client', () => {
	assert.throws(
		() =>
			execSync('pnpm build', {
				cwd: path.join(process.cwd(), 'apps/private-static-env-dynamic-import'),
				stdio: 'pipe',
				timeout: 60000
			}),
		/.*Cannot import \$env\/static\/private into client-side code:.*/gs
	);
});

test('$env/dynamic/private is not importable from the service worker', () => {
	assert.throws(
		() =>
			execSync('pnpm build', {
				cwd: path.join(process.cwd(), 'apps/service-worker-private-env'),
				stdio: 'pipe',
				timeout: 60000
			}),
		/.*Cannot import \$env\/dynamic\/private into service-worker code.*/gs
	);
});

test('$env/dynamic/public is not importable from the service worker', () => {
	assert.throws(
		() =>
			execSync('pnpm build', {
				cwd: path.join(process.cwd(), 'apps/service-worker-dynamic-public-env'),
				stdio: 'pipe',
				timeout: 60000
			}),
		/.*Cannot import \$env\/dynamic\/public into service-worker code.*/gs
	);
});

```


####### packages/kit/test/build-errors/package.json #######

```

{
	"name": "test-build-errors",
	"private": true,
	"version": "0.0.0-next.0",
	"scripts": {
		"test": "vitest run",
		"test:cross-platform:build": "vitest run"
	},
	"type": "module",
	"devDependencies": {
		"vitest": "^1.5.0"
	}
}

```


####### packages/kit/test/build-errors/prerender.spec.js #######

```

import { assert, test } from 'vitest';
import { execSync } from 'node:child_process';
import path from 'node:path';
import { EOL } from 'node:os';

test('prerenderable routes must be prerendered', () => {
	assert.throws(
		() =>
			execSync('pnpm build', {
				cwd: path.join(process.cwd(), 'apps/prerenderable-not-prerendered'),
				stdio: 'pipe',
				timeout: 60000
			}),
		/The following routes were marked as prerenderable, but were not prerendered because they were not found while crawling your app:\r?\n {2}- \/\[x\]/gs
	);
});

test('entry generators should match their own route', () => {
	assert.throws(
		() =>
			execSync('pnpm build', {
				cwd: path.join(process.cwd(), 'apps/prerender-entry-generator-mismatch'),
				stdio: 'pipe',
				timeout: 60000
			}),
		`Error: The entries export from /[slug]/[notSpecific] generated entry /whatever/specific, which was matched by /[slug]/specific - see the \`handleEntryGeneratorMismatch\` option in https://kit.svelte.dev/docs/configuration#prerender for more info.${EOL}To suppress or handle this error, implement \`handleEntryGeneratorMismatch\` in https://kit.svelte.dev/docs/configuration#prerender`
	);
});

```


####### packages/kit/test/build-errors/server-only.spec.js #######

```

import { assert, test } from 'vitest';
import { execSync } from 'node:child_process';
import path from 'node:path';

test('$lib/*.server.* is not statically importable from the client', () => {
	try {
		execSync('pnpm build', {
			cwd: path.join(process.cwd(), 'apps/server-only-module'),
			stdio: 'pipe',
			timeout: 60000
		});
	} catch (err) {
		assert.ok(
			err.message.includes('Cannot import $lib/test.server.js into client-side code'),
			`received unexpected exception message ${err.message}`
		);
		return;
	}
	throw new Error();
});

test('$lib/*.server.* is not dynamically importable from the client', () => {
	try {
		execSync('pnpm build', {
			cwd: path.join(process.cwd(), 'apps/server-only-module-dynamic-import'),
			stdio: 'pipe',
			timeout: 60000
		});
	} catch (err) {
		assert.ok(
			err.message.includes('Cannot import $lib/test.server.js into client-side code'),
			`received unexpected exception message ${err.message}`
		);
		return;
	}
	throw new Error();
});

test('$lib/server/* is not statically importable from the client', () => {
	try {
		execSync('pnpm build', {
			cwd: path.join(process.cwd(), 'apps/server-only-folder'),
			stdio: 'pipe',
			timeout: 60000
		});
	} catch (err) {
		assert.ok(
			err.message.includes('Cannot import $lib/server/something/private.js into client-side code'),
			`received unexpected exception message ${err.message}`
		);
		return;
	}
	throw new Error();
});

test('$lib/server/* is not dynamically importable from the client', () => {
	try {
		execSync('pnpm build', {
			cwd: path.join(process.cwd(), 'apps/server-only-folder-dynamic-import'),
			stdio: 'pipe',
			timeout: 60000
		});
	} catch (err) {
		assert.ok(
			err.message.includes('Cannot import $lib/server/something/private.js into client-side code'),
			`received unexpected exception message ${err.message}`
		);
		return;
	}
	throw new Error();
});

```


####### packages/kit/test/build-errors/syntax-error.spec.js #######

```

import { assert, test } from 'vitest';
import { execSync } from 'node:child_process';
import path from 'node:path';

test('$lib/*.server.* is not statically importable from the client', () => {
	try {
		execSync('pnpm build', {
			cwd: path.join(process.cwd(), 'apps/syntax-error'),
			stdio: 'pipe',
			timeout: 60000
		});
	} catch (err) {
		assert.ok(
			err.message.includes('Unexpected end of input'),
			`received unexpected exception message ${err.message}`
		);
		return;
	}
	throw new Error();
});

```


####### packages/kit/test/github-flaky-warning-reporter.js #######

```

/**
 * @class
 * @implements {import('@playwright/test/reporter').Reporter}
 */
export default class GithubFlakyWarningReporter {
	/**
	 * @type {{ file: string; line: number; title: string; message: string; }[]}
	 */
	_flaky = [];

	onBegin() {
		this._flaky = [];
	}
	/**
	 * @param test {import('@playwright/test/reporter').TestCase}
	 */
	onTestEnd(test) {
		if (test.outcome() === 'flaky') {
			const { file, line } = test.location;
			const title = `flaky test: ${test.title}`;
			const message = `retries: ${test.retries}`;
			this._flaky.push({ file, line, title, message });
		}
	}

	onEnd() {
		this._flaky.forEach(({ file, line, title, message }) => {
			console.log(`::warning file=${file},line=${line},title=${title}::${message}`);
		});
	}

	printsToStdio() {
		return true;
	}
}

```


####### packages/kit/test/prerendering/basics/package.json #######

```

{
	"name": "prerendering-test-basics",
	"private": true,
	"version": "0.0.2-next.0",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"test": "svelte-kit sync && pnpm build && vitest run",
		"test:cross-platform": "pnpm test"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8",
		"vitest": "^1.5.0"
	},
	"type": "module"
}

```


####### packages/kit/test/prerendering/basics/src/app.d.ts #######

```

/// <reference types="@sveltejs/kit" />;

```


####### packages/kit/test/prerendering/basics/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body>
		%sveltekit.body%
	</body>
</html>

```


####### packages/kit/test/prerendering/basics/src/hooks.server.js #######

```

import { building } from '$app/environment';

const initial_building = building;

/** @type {import('@sveltejs/kit').Handle} */
export const handle = async ({ event, resolve }) => {
	if (event.url.pathname === '/prerendering-true' && building) {
		return await resolve(event, {
			transformPageChunk: ({ html }) =>
				html
					.replace('__INITIAL_PRERENDERING__', String(initial_building))
					.replace('__PRERENDERING__', String(building))
		});
	}
	return await resolve(event, {
		filterSerializedResponseHeaders: (name) => name === 'content-type'
	});
};

// this code is here to make sure that we kill the process
setInterval(() => {
	console.log('process is still alive');
}, 5000);

```


####### packages/kit/test/prerendering/basics/src/routes/encöded-hash-link/+page.svelte #######

```

<h2 id="encöded">
	<a href="#encöded">encöded</a>
</h2>

```


####### packages/kit/test/prerendering/basics/src/routes/encoding/[path].json/+server.js #######

```

import { json } from '@sveltejs/kit';

/** @type {import('./$types').RequestHandler} */
export function GET({ params }) {
	return json({
		path: params.path
	});
}

```


####### packages/kit/test/prerendering/basics/src/routes/encoding/[path]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>{$page.params.path} / {$page.url.pathname}</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/encoding/path with spaces/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const a = await fetch('/encoding/path with spaces.json');
	const b = await fetch('/encoding/path%20with%20encoded%20spaces.json');

	return {
		a: await a.json(),
		b: await b.json()
	};
}

```


####### packages/kit/test/prerendering/basics/src/routes/encoding/path with spaces/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<p id="a">{data.a.path}</p>
<p id="b">{data.b.path}</p>

<a href="/encoding/dynamic path with spaces">dynamic path with spaces</a>
<a href="/encoding/dynamic%20path%20with%20encoded%20spaces">dynamic path with encoded spaces</a>

```


####### packages/kit/test/prerendering/basics/src/routes/encoding/redirect/+page.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').Load} */
export function load() {
	redirect(307, '/encoding/redirected%20path%20with%20encoded%20spaces');
}

```


####### packages/kit/test/prerendering/basics/src/routes/encoding/redirect/+page.svelte #######

```


```


####### packages/kit/test/prerendering/basics/src/routes/env/+page.server.js #######

```

import { PRIVATE_STATIC } from '$env/static/private';

export function load() {
	return {
		PRIVATE_STATIC
	};
}

```


####### packages/kit/test/prerendering/basics/src/routes/env/+page.svelte #######

```

<script>
	import { PUBLIC_STATIC } from '$env/static/public';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<p id="static-private">PRIVATE_STATIC: {data.PRIVATE_STATIC}</p>
<p id="static-public">PUBLIC_STATIC: {PUBLIC_STATIC}</p>

```


####### packages/kit/test/prerendering/basics/src/routes/fetch-404/+page.js #######

```

/** @type {import('./$types').PageLoad} */
export async function load({ fetch }) {
	const { status } = await fetch('/missing.json');

	return { status };
}

```


####### packages/kit/test/prerendering/basics/src/routes/fetch-404/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>status: {data.status}</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/also-not-buffered/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const url = '/fetch-endpoint/not-buffered.json';
	const res = await fetch(url);

	return {
		headers: res.headers
	};
}

```


####### packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/also-not-buffered/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>content-type: {data.headers.get('content-type')}</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/buffered.json/+server.js #######

```

import { json } from '@sveltejs/kit';

export async function GET() {
	return json({ answer: 42 });
}

```


####### packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/buffered/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const url = '/fetch-endpoint/buffered.json';
	const res = await fetch(url);

	return await res.json();
}

```


####### packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/buffered/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>the answer is {data.answer}</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/not-buffered.json/+server.js #######

```

import { json } from '@sveltejs/kit';

let called = false;

export async function GET() {
	if (called) throw new Error('should only be called once');
	called = true;

	return json({ answer: 42 });
}

```


####### packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/not-buffered/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const url = '/fetch-endpoint/not-buffered.json';
	const res = await fetch(url);

	return {
		headers: res.headers
	};
}

```


####### packages/kit/test/prerendering/basics/src/routes/fetch-endpoint/not-buffered/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>content-type: {data.headers.get('content-type')}</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/fetch-image/+page.svelte #######

```

<img src="/fetch-image/image.jpg" alt="" />
<img src="/fetch-image/image.png" alt="" />

```


####### packages/kit/test/prerendering/basics/src/routes/fetch-image/[...slug]/+server.js #######

```

import * as fs from 'node:fs';

export const prerender = true;

export async function GET({ params }) {
	const slug = params.slug.split('/');
	const extension = slug[0].split('.').pop();

	const file = fs.readFileSync(`./static/image.${extension}`);

	return new Response(file, {
		headers: {
			'Content-Type': 'image/' + extension
		}
	});
}

```


####### packages/kit/test/prerendering/basics/src/routes/(grouped)/grouped/+page.svelte #######

```

<h1>grouped</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/immutable-headers/+server.js #######

```

export const prerender = true;

export const GET = () => {
	const response = new Response('foo');
	// this simulates immutable Response Headers, like those returned by undici
	Object.defineProperty(response.headers, 'set', { value: null });
	return response;
};

```


####### packages/kit/test/prerendering/basics/src/routes/+layout.js #######

```

export const prerender = true;

```


####### packages/kit/test/prerendering/basics/src/routes/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/prerendering/basics/src/routes/load-file-with-spaces/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export async function load({ fetch }) {
	const r1 = await fetch('/file%20with%20spaces.json');
	const p1 = await r1.json();

	const r2 = await fetch('/file with spaces.json');
	const p2 = await r2.json();

	if (p1.answer !== p2.answer) {
		throw new Error('oops');
	}

	return p1;
}

```


####### packages/kit/test/prerendering/basics/src/routes/load-file-with-spaces/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>answer: {data.answer}</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/max-age/+page.js #######

```

/** @type {import('@sveltejs/kit').Load} */
export function load({ setHeaders }) {
	setHeaders({
		'cache-control': 'max-age=300'
	});
}

```


####### packages/kit/test/prerendering/basics/src/routes/max-age/+page.svelte #######

```

<h1>This page will be cached for 5 minutes</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/optional-params/[[optional]]/+page.svelte #######

```

<a href="/optional-params/with-value">Path with Value</a>

```


####### packages/kit/test/prerendering/basics/src/routes/origin/message.json/+server.js #######

```

import { json } from '@sveltejs/kit';

// TODO remove this when we're able to replace the global `fetch` call in the
// neighbouring `+page.server.js` with SvelteKit's `fetch`
export const prerender = true;

export function GET() {
	return json({
		message: 'hello'
	});
}

```


####### packages/kit/test/prerendering/basics/src/routes/origin/+page.server.js #######

```

export const prerender = true;

export async function load({ fetch }) {
	const res = await fetch('/origin/message.json');
	const { message } = await res.json();

	return {
		message
	};
}

```


####### packages/kit/test/prerendering/basics/src/routes/origin/+page.svelte #######

```

<script>
	import { page } from '$app/stores';

	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.message}</h1>
<h2>{$page.url.origin}</h2>

```


####### packages/kit/test/prerendering/basics/src/routes/page.html/+page.server.js #######

```

export function load() {
	return {
		message: 'hello'
	};
}

```


####### packages/kit/test/prerendering/basics/src/routes/page.html/+page.svelte #######

```

<script>
	export let data;
</script>

<h1>{data.message}</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/+page.server.js #######

```

export function load() {
	return {
		message: 'hello'
	};
}

```


####### packages/kit/test/prerendering/basics/src/routes/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.message}</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/prerendering-true/+page.svelte #######

```

<h1>prerendering: __INITIAL_PRERENDERING__/__PRERENDERING__</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/redirect-encoded/+page.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').Load} */
export function load() {
	redirect(301, `https://example.com/redirected?returnTo=${encodeURIComponent('/foo?bar=baz')}`);
}

```


####### packages/kit/test/prerendering/basics/src/routes/redirect-malicious/+page.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').Load} */
export function load() {
	redirect(301, 'https://example.com/</' + 'script>alert("pwned")');
}

```


####### packages/kit/test/prerendering/basics/src/routes/redirect/+page.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').Load} */
export function load() {
	redirect(301, 'https://example.com/redirected');
}

```


####### packages/kit/test/prerendering/basics/src/routes/redirect-relative/+page.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').Load} */
export function load() {
	redirect(301, '/env');
}

```


####### packages/kit/test/prerendering/basics/src/routes/redirect-server/+page.server.js #######

```

import { redirect } from '@sveltejs/kit';

/** @type {import('@sveltejs/kit').Load} */
export function load() {
	redirect(301, 'https://example.com/redirected');
}

```


####### packages/kit/test/prerendering/basics/src/routes/shadowed-get/+page.server.js #######

```

export function load() {
	return {
		answer: 42
	};
}

```


####### packages/kit/test/prerendering/basics/src/routes/shadowed-get/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>The answer is {data.answer}</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/shadowed-get/ssr-off/+page.server.js #######

```

export const ssr = false;

export function load() {
	return {
		answer: 42
	};
}

```


####### packages/kit/test/prerendering/basics/src/routes/shadowed-get/ssr-off/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>The answer is {data.answer}</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/shadowed-post/+page.server.js #######

```

export function load() {
	return {
		answer: 42
	};
}

/** @type {import('./$types').Actions} */
export const actions = {
	default: () => {}
};

```


####### packages/kit/test/prerendering/basics/src/routes/shadowed-post/+page.svelte #######

```

<h1>This should not be visible</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/spa-shell/+page.js #######

```

import { redirect } from '@sveltejs/kit';

export const prerender = true;

export const ssr = false;

/** @type {import('@sveltejs/kit').Load} */
export function load() {
	redirect(301, 'https://example.com/redirected');
}

```


####### packages/kit/test/prerendering/basics/src/routes/spa-shell/+page.server.js #######

```

// spa shell should still prererender when +page.server.js exists but it has no load function

```


####### packages/kit/test/prerendering/basics/src/routes/spa-shell/+page.svelte #######

```

<h1>this won't be prerendered</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/trailing-slash/+layout.js #######

```

export const trailingSlash = 'always';

```


####### packages/kit/test/prerendering/basics/src/routes/trailing-slash/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/prerendering/basics/src/routes/trailing-slash/page/+page.server.js #######

```

export function load() {
	return {
		message: 'hello'
	};
}

```


####### packages/kit/test/prerendering/basics/src/routes/trailing-slash/page/+page.svelte #######

```

<script>
	/** @type {import('./$types').PageData} */
	export let data;
</script>

<h1>{data.message}</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/trailing-slash/+page.svelte #######

```

<h1>hello</h1>

```


####### packages/kit/test/prerendering/basics/src/routes/trailing-slash/standalone-endpoint.json/+server.js #######

```

import { json } from '@sveltejs/kit';

export const prerender = true;

export async function GET() {
	return json({ answer: 42 });
}

```


####### packages/kit/test/prerendering/basics/src/routes/初めまして/+page.svelte #######

```

<p>Test for characters that need to be en/decoded during prerendering</p>

```


####### packages/kit/test/prerendering/basics/src/service-worker.js #######

```

import { prerendered } from '$service-worker';

console.log(prerendered);

if (process.env.MY_ENV === 'MY_ENV DEFINED') {
	console.log(process.env.MY_ENV);
}

```


####### packages/kit/test/prerendering/basics/static/file with spaces.json #######

```

{ "answer": 42 }

```


####### packages/kit/test/prerendering/basics/svelte.config.js #######

```

import adapter from '../../../../adapter-static/index.js';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter(),

		prerender: {
			handleHttpError: 'warn',
			origin: 'http://example.com'
		}
	}
};

export default config;

```


####### packages/kit/test/prerendering/basics/test/tests.spec.js #######

```

import * as fs from 'node:fs';
import { fileURLToPath } from 'node:url';
import { assert, expect, test } from 'vitest';
import { replace_hydration_attrs } from '../../test-utils';

const build = fileURLToPath(new URL('../build', import.meta.url));

/** @param {string} file */
const read = (file, encoding = 'utf-8') => fs.readFileSync(`${build}/${file}`, encoding);

test('prerenders /', () => {
	const content = read('index.html');
	expect(content).toMatch('<h1>hello</h1>');
});

test('renders a redirect', () => {
	const content = read('redirect.html');
	assert.equal(
		content,
		'<script>location.href="https://example.com/redirected";</script><meta http-equiv="refresh" content="0;url=https://example.com/redirected">'
	);
});

test('renders a server-side redirect', () => {
	const html = read('redirect-server.html');
	assert.equal(
		html,
		'<script>location.href="https://example.com/redirected";</script><meta http-equiv="refresh" content="0;url=https://example.com/redirected">'
	);

	const data = JSON.parse(read('redirect-server/__data.json'));

	expect(data).toEqual({
		type: 'redirect',
		location: 'https://example.com/redirected'
	});
});

test('does not double-encode redirect locations', () => {
	const content = read('redirect-encoded.html');
	assert.equal(
		content,
		'<script>location.href="https://example.com/redirected?returnTo=%2Ffoo%3Fbar%3Dbaz";</script><meta http-equiv="refresh" content="0;url=https://example.com/redirected?returnTo=%2Ffoo%3Fbar%3Dbaz">'
	);
});

test('escapes characters in redirect', () => {
	const content = read('redirect-malicious.html');
	assert.equal(
		content,
		'<script>location.href="https://example.com/\\u003C/script>alert(\\"pwned\\")";</script><meta http-equiv="refresh" content="0;url=https://example.com/</script>alert(&quot;pwned&quot;)">'
	);
});

test('renders a relative redirect', () => {
	const content = read('redirect-relative.html');
	assert.equal(
		content,
		'<script>location.href="/env";</script><meta http-equiv="refresh" content="0;url=/env">'
	);
});

test('renders a shell when SSR is turned off and there is no server data', () => {
	const content = read('spa-shell.html');
	assert.match(
		content,
		/<!doctype html>\n<html lang="en">([\s]*?)<head>([\s]*?)<meta charset="utf-8" \/>([\s]*?)<meta name="viewport" content="width=device-width, initial-scale=1" \/>([\s\S]*?)<\/head>\n([\s]*?)<body>([\s]*?)<script>([\s\S]*?)<\/script>([\s]*?)<\/body>\n<\/html>/g
	);
});

test('inserts http-equiv tag for cache-control headers', () => {
	const content = read('max-age.html');
	expect(content).toMatch('<meta http-equiv="cache-control" content="max-age=300">');
});

test('renders page with data from endpoint', () => {
	const content = read('fetch-endpoint/buffered.html');
	expect(content).toMatch('<h1>the answer is 42</h1>');

	const json = read('fetch-endpoint/buffered.json');
	assert.equal(json, JSON.stringify({ answer: 42 }));
});

test('renders page with unbuffered data from endpoint', () => {
	const content = read('fetch-endpoint/not-buffered.html');
	expect(content).toMatch('<h1>content-type: application/json</h1>');

	const json = read('fetch-endpoint/not-buffered.json');
	assert.equal(json, JSON.stringify({ answer: 42 }));
});

test('loads a file with spaces in the filename', () => {
	const content = read('load-file-with-spaces.html');
	expect(content).toMatch('<h1>answer: 42</h1>');
});

test('generates __data.json file for shadow endpoints', () => {
	let data = JSON.parse(read('__data.json'));
	expect(data).toEqual({
		type: 'data',
		nodes: [
			null,
			{
				type: 'data',
				data: [{ message: 1 }, 'hello'],
				uses: {}
			}
		]
	});

	data = JSON.parse(read('shadowed-get/__data.json'));
	expect(data).toEqual({
		type: 'data',
		nodes: [
			null,
			{
				type: 'data',
				data: [{ answer: 1 }, 42],
				uses: {}
			}
		]
	});
});

test('generates __data.json file for shadow endpoints with ssr turned off', () => {
	const data = JSON.parse(read('shadowed-get/ssr-off/__data.json'));
	expect(data).toEqual({
		type: 'data',
		nodes: [
			null,
			{
				type: 'data',
				data: [{ answer: 1 }, 42],
				uses: {}
			}
		]
	});
});

test('does not prerender page with shadow endpoint with non-load handler', () => {
	assert.isFalse(fs.existsSync(`${build}/shadowed-post.html`));
	assert.isFalse(fs.existsSync(`${build}/shadowed-post/__data.json`));
});

test('decodes paths when writing files', () => {
	let content = read('encoding/path with spaces.html');
	expect(content).toMatch('<p id="a">path with spaces</p>');
	expect(content).toMatch('<p id="b">path with encoded spaces</p>');

	content = read('encoding/dynamic path with spaces.html');
	expect(content).toMatch(
		'<h1>dynamic path with spaces / /encoding/dynamic%20path%20with%20spaces</h1>'
	);

	content = read('encoding/dynamic path with encoded spaces.html');
	expect(content).toMatch(
		'<h1>dynamic path with encoded spaces / /encoding/dynamic%20path%20with%20encoded%20spaces</h1>'
	);

	content = read('encoding/redirected path with encoded spaces.html');
	expect(content).toMatch(
		'<h1>redirected path with encoded spaces / /encoding/redirected%20path%20with%20encoded%20spaces</h1>'
	);

	content = read('encoding/path with spaces.json');
	assert.equal(content, JSON.stringify({ path: 'path with spaces' }));

	content = read('encoding/path with encoded spaces.json');
	assert.equal(content, JSON.stringify({ path: 'path with encoded spaces' }));
});

test('prerendering is set to true in root +layout.js', () => {
	const content = replace_hydration_attrs(read('prerendering-true.html'));
	expect(content).toMatch('<h1>prerendering: true/true</h1>');
});

test('fetching missing content results in a 404', () => {
	const content = read('fetch-404.html');
	expect(content).toMatch('<h1>status: 404</h1>');
});

test('prerenders binary data', async () => {
	assert.equal(Buffer.compare(read('fetch-image/image.jpg', null), read('image.jpg', null)), 0);
	assert.equal(Buffer.compare(read('fetch-image/image.png', null), read('image.png', null)), 0);
});

test('fetches data from local endpoint', () => {
	const data = JSON.parse(read('origin/__data.json'));

	expect(data).toEqual({
		type: 'data',
		nodes: [
			null,
			{
				type: 'data',
				data: [{ message: 1 }, 'hello'],
				uses: {}
			}
		]
	});
	assert.equal(read('origin/message.json'), JSON.stringify({ message: 'hello' }));
});

test('respects config.prerender.origin', () => {
	const content = read('origin.html');
	expect(content).toMatch('<h2>http://example.com</h2>');
});

test('$env - includes environment variables', () => {
	const content = read('env.html');

	assert.match(
		content,
		/.*PRIVATE_STATIC: accessible to server-side code\/replaced at build time.*/gs
	);

	assert.match(content, /.*PUBLIC_STATIC: accessible anywhere\/replaced at build time.*/gs);
});

test('prerenders a page in a (group)', () => {
	const content = replace_hydration_attrs(read('grouped.html'));
	expect(content).toMatch('<h1>grouped</h1>');
});

test('injects relative service worker', () => {
	const content = read('index.html');
	expect(content).toMatch("navigator.serviceWorker.register('./service-worker.js')");
});

test('define service worker variables', () => {
	const content = read('service-worker.js');
	expect(content).toMatch('MY_ENV DEFINED');
});

test('prerendered.paths omits trailing slashes for endpoints', () => {
	const content = read('service-worker.js');

	for (const path of [
		'/trailing-slash/page/',
		'/trailing-slash/page/__data.json',
		'/trailing-slash/standalone-endpoint.json'
	]) {
		expect(content, `Missing ${path}`).toMatch(`"${path}"`);
	}
});

test('prerenders responses with immutable Headers', () => {
	const content = read('immutable-headers');
	expect(content).toMatch('foo');
});

test('prerenders paths with optional parameters with empty values', () => {
	const content = read('optional-params.html');
	expect(content).includes('Path with Value');
});

```


####### packages/kit/test/prerendering/basics/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true
	},
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/kit/test/prerendering/basics/vite.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},

	clearScreen: false,

	logLevel: 'silent',

	plugins: [sveltekit()],

	define: {
		'process.env.MY_ENV': '"MY_ENV DEFINED"'
	},

	server: {
		fs: {
			allow: [path.resolve('../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/prerendering/options/package.json #######

```

{
	"name": "prerendering-test-options",
	"private": true,
	"version": "0.0.1",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"test": "svelte-kit sync && pnpm build && vitest run"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8",
		"vitest": "^1.5.0"
	},
	"type": "module"
}

```


####### packages/kit/test/prerendering/options/public/robots.txt #######

# https://www.robotstxt.org/robotstxt.html
User-agent: *
Disallow:
####### packages/kit/test/prerendering/options/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		%sveltekit.head%
	</head>
	<body>
		%sveltekit.body%
	</body>
</html>

```


####### packages/kit/test/prerendering/options/src/routes/(group)/+page.svelte #######

```

<h1>hello</h1>

```


####### packages/kit/test/prerendering/options/src/routes/+layout.js #######

```

export const prerender = true;
export const trailingSlash = 'always';

```


####### packages/kit/test/prerendering/options/src/routes/+layout.svelte #######

```

<svelte:head>
	<link rel="alternate" href="/path-base/rss.xml" />
</svelte:head>

<slot />

```


####### packages/kit/test/prerendering/options/src/routes/nested/+page.svelte #######

```

<h1>nested hello</h1>

```


####### packages/kit/test/prerendering/options/src/routes/rss.xml/+server.js #######

```

export function GET() {
	return new Response('dynamic');
}

```


####### packages/kit/test/prerendering/options/svelte.config.js #######

```

import adapter from '../../../../adapter-static/index.js';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter({
			fallback: '200.html'
		}),

		csp: {
			directives: {
				'script-src': ['self']
			}
		},

		files: {
			assets: 'public'
		},

		paths: {
			base: '/path-base',
			assets: 'https://cdn.example.com/stuff'
		}
	}
};

export default config;

```


####### packages/kit/test/prerendering/options/test/tests.spec.js #######

```

import * as fs from 'node:fs';
import { fileURLToPath } from 'node:url';
import { assert, expect, test } from 'vitest';
import { replace_hydration_attrs } from '../../test-utils';

const build = fileURLToPath(new URL('../build', import.meta.url));

/** @param {string} file */
const read = (file) => fs.readFileSync(`${build}/${file}`, 'utf-8');

test('prerenders /path-base', () => {
	const content = replace_hydration_attrs(read('index.html'));
	expect(content).toMatch('<h1>hello</h1>');
});

test('prerenders nested /path-base', () => {
	const content = replace_hydration_attrs(read('nested/index.html'));
	expect(content).toMatch('<h1>nested hello</h1>');
});

test('adds CSP headers via meta tag', () => {
	const content = read('index.html');
	expect(content).toMatch(
		'<meta http-equiv="content-security-policy" content="script-src \'self\' \'sha256-'
	);
});

test('does not copy `public` into `_app`', () => {
	assert.isFalse(fs.existsSync(`${build}/_app/robots.txt`));
});

// https://github.com/sveltejs/kit/issues/4340
test('populates fallback 200.html file', () => {
	const content = read('200.html');
	assert.isNotEmpty(content);
});

test('does not prerender linked +server.js route', () => {
	assert.isFalse(fs.existsSync(`${build}/rss.xml`));
});

```


####### packages/kit/test/prerendering/options/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true
	},
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/kit/test/prerendering/options/vite.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false
	},

	clearScreen: false,

	logLevel: 'silent',

	plugins: [sveltekit()],

	server: {
		fs: {
			allow: [path.resolve('../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/prerendering/paths-base/package.json #######

```

{
	"name": "prerendering-test-paths-base",
	"private": true,
	"version": "0.0.1",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"check": "svelte-kit sync && tsc && svelte-check",
		"test": "svelte-kit sync && pnpm build && vitest run"
	},
	"devDependencies": {
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8",
		"vitest": "^1.5.0"
	},
	"type": "module"
}

```


####### packages/kit/test/prerendering/paths-base/src/app.d.ts #######

```

/// <reference types="@sveltejs/kit" />;

```


####### packages/kit/test/prerendering/paths-base/src/app.html #######

```

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<base href="/path-base/" />
		<link rel="icon" href="favicon.png" />
		%sveltekit.head%
	</head>
	<body>
		%sveltekit.body%
	</body>
</html>

```


####### packages/kit/test/prerendering/paths-base/src/hooks.server.js #######

```


```


####### packages/kit/test/prerendering/paths-base/src/routes/a/b/c/+page.svelte #######

```

<a href="a/b/d">a/b/d</a>

```


####### packages/kit/test/prerendering/paths-base/src/routes/a/b/d/+page.svelte #######

```

<a href="a/b/c">a/b/c</a>

```


####### packages/kit/test/prerendering/paths-base/src/routes/assets/+page.svelte #######

```

<script>
	import logo from './logo.svg';
</script>

<img src={logo} alt="Svelte logo" />

```


####### packages/kit/test/prerendering/paths-base/src/routes/dynamic/[slug]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
</script>

<h1>{$page.params.slug}</h1>

```


####### packages/kit/test/prerendering/paths-base/src/routes/+layout.js #######

```

export const prerender = true;

```


####### packages/kit/test/prerendering/paths-base/src/routes/+layout.svelte #######

```

<slot />

```


####### packages/kit/test/prerendering/paths-base/src/routes/nested/+page.svelte #######

```

<h1>nested hello</h1>

```


####### packages/kit/test/prerendering/paths-base/src/routes/+page.svelte #######

```

<div>
	<h1>Main Page</h1>
	<a href="nested">Nested Link</a>
</div>

```


####### packages/kit/test/prerendering/paths-base/src/routes/redirect/+page.js #######

```

import { redirect } from '@sveltejs/kit';
import { base } from '$app/paths';

export function load() {
	redirect(301, `${base}/dynamic/foo`);
}

```


####### packages/kit/test/prerendering/paths-base/svelte.config.js #######

```

import adapter from '../../../../adapter-static/index.js';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter(),

		paths: {
			base: '/path-base',
			relative: false
		}
	}
};

export default config;

```


####### packages/kit/test/prerendering/paths-base/test/tests.spec.js #######

```

import * as fs from 'node:fs';
import { fileURLToPath } from 'node:url';
import { assert, test } from 'vitest';

const build = fileURLToPath(new URL('../build', import.meta.url));

/** @param {string} file */
const read = (file) => fs.readFileSync(`${build}/${file}`, 'utf-8');

test('prerenders /path-base', () => {
	const content = read('index.html');
	assert.ok(content.includes('favicon.png') && content.includes('nested'));
});

test('prerenders /path-base/redirect', () => {
	const content = read('redirect.html');
	assert.equal(
		content,
		'<script>location.href="/path-base/dynamic/foo";</script><meta http-equiv="refresh" content="0;url=/path-base/dynamic/foo">'
	);
});

test('prerenders /path-base/dynamic/foo', () => {
	const content = read('dynamic/foo.html');
	assert.ok(content.includes('<h1>foo</h1>'));
});

test('prerenders /path-base/assets', () => {
	const content = read('assets.html');
	assert.match(content, /<img[^>]+src="\/path-base\//u);
});

```


####### packages/kit/test/prerendering/paths-base/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true
	},
	"extends": "./.svelte-kit/tsconfig.json"
}

```


####### packages/kit/test/prerendering/paths-base/vite.config.js #######

```

import * as path from 'node:path';
import { sveltekit } from '@sveltejs/kit/vite';

/** @type {import('vite').UserConfig} */
const config = {
	build: {
		minify: false,
		// disable inlining to test asset base path
		assetsInlineLimit: 0
	},

	clearScreen: false,

	logLevel: 'silent',

	plugins: [sveltekit()],

	server: {
		fs: {
			allow: [path.resolve('../../../src')]
		}
	}
};

export default config;

```


####### packages/kit/test/prerendering/test-utils.js #######

```

/**
 * For static content, Svelte v4 will add a data-svelte-h attribute.
 * Replace the hash with something predictable before comparing the output.
 *
 * @param {string} html
 */
export function replace_hydration_attrs(html) {
	return html.replace(/(\s+)data-svelte-h="svelte-\w+"/g, '');
}

```


####### packages/kit/test/setup.js #######

```

import {
	goto,
	invalidate,
	preloadCode,
	preloadData,
	beforeNavigate,
	afterNavigate
} from '$app/navigation';
import { onMount, tick } from 'svelte';

export function setup() {
	onMount(() => {
		// give tests programmatic control over the app
		Object.assign(window, {
			goto,
			invalidate,
			preloadCode,
			preloadData,
			beforeNavigate,
			afterNavigate,
			svelte_tick: tick
		});

		// communicate that the app is ready
		document.body.classList.add('started');
	});
}

```


####### packages/kit/test/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true,
		"strict": true,
		"target": "esnext",
		"module": "esnext",
		"moduleResolution": "node",
		"allowSyntheticDefaultImports": true
	}
}

```


####### packages/kit/test/types/actions.test.ts #######

```

import * as Kit from '@sveltejs/kit';

// Test: Action types inferred correctly and transformed into a union
type Actions = {
	foo: () => Promise<void>;
	bar: () => Promise<{ success: boolean } | Kit.ActionFailure<{ message: string }>>;
	baz: () => Kit.ActionFailure<{ foo: string }> | { status: number; data: string };
};

let form: Kit.AwaitedActions<Actions> = null as any;
form.message = '';
form.success = true;
// @ts-expect-error - cannot both be present at the same time
form = { message: '', success: true };

// Test: Actions with different return types are transformed into a union that has all types accessible
type Actions2 = {
	foo: () => Promise<{ message: string }>;
	bar: () => Promise<{ success: boolean }>;
};

let form2: Kit.AwaitedActions<Actions2> = null as any;
form2.message = '';
form2.success = true;
// @ts-expect-error - cannot both be present at the same time
form2 = { message: '', success: true };

// Test: ActionFailure is correctly infered to be different from the normal return type even if they have the same shape
type Actions3 = {
	bar: () => Kit.ActionFailure<{ foo: string }> | { status: number; data: { bar: string } };
};
let form3: Kit.AwaitedActions<Actions3> = null as any;
form3.foo = '';
form3.status = 200;
// @ts-expect-error - cannot both be present at the same time
form3 = { foo: '', status: 200 };

let foo: any = null;
// @ts-expect-error ActionFailure is not a class and so you can't do instanceof
foo instanceof Kit.ActionFailure;

```


####### packages/kit/test/types/load.test.ts #######

```

import * as Kit from '@sveltejs/kit';

// Test: Return types inferred correctly and transformed into a union
type LoadReturn1 =
	| { success: true; message?: undefined }
	| { success?: undefined; message: string };

let result1: Kit.LoadProperties<LoadReturn1> = null as any;
result1.message = '';
result1.success = true;
// @ts-expect-error - cannot both be present at the same time
result1 = { message: '', success: true };

```


####### packages/kit/test/types/tsconfig.json #######

```

{
	"extends": "../../tsconfig.json",
	"compilerOptions": {
		"noEmit": true
	},
	"include": ["**/*.test.ts"]
}

```


####### packages/kit/test/utils.d.ts #######

```

import {
	PlaywrightTestArgs,
	PlaywrightTestConfig,
	PlaywrightTestOptions,
	PlaywrightWorkerArgs,
	PlaywrightWorkerOptions,
	TestType
} from '@playwright/test';
import { IncomingMessage, ServerResponse } from 'http';
import { Plugin } from 'vite';

export const test: TestType<
	PlaywrightTestArgs &
		PlaywrightTestOptions & {
			app: {
				goto(url: string, opts?: { replaceState?: boolean }): Promise<void>;
				invalidate(url: string): Promise<void>;
				beforeNavigate(url: URL): void | boolean;
				afterNavigate(url: URL): void;
				preloadCode(...urls: string[]): Promise<void>;
				preloadData(url: string): Promise<void>;
			};
			clicknav(selector: string, options?: { timeout?: number }): Promise<void>;
			in_view(selector: string): Promise<boolean>;
			get_computed_style(selector: string, prop: string): Promise<string>;
			/**
			 * `handleError` defines the shape
			 */
			read_errors(href: string): Record<string, any>;
			start_server(
				handler: (req: IncomingMessage, res: ServerResponse) => void
			): Promise<{ port: number }>;
			page: PlaywrightTestArgs['page'] & {
				goto: (
					url: string,
					opts?: Parameters<PlaywrightTestArgs['page']['goto']>[1] & { wait_for_started?: boolean }
				) => ReturnType<PlaywrightTestArgs['page']['goto']>;
			};
		},
	PlaywrightWorkerArgs & PlaywrightWorkerOptions
>;

export const config: PlaywrightTestConfig;

export const plugin: () => Plugin;

```


####### packages/kit/test/utils.js #######

```

import fs from 'node:fs';
import http from 'node:http';
import path from 'node:path';
import { fileURLToPath } from 'node:url';
import { test as base, devices } from '@playwright/test';

export const test = base.extend({
	app: async ({ page }, use) => {
		// these are assumed to have been put in the global scope by the layout
		use({
			/**
			 * @param {string} url
			 * @param {{ replaceState?: boolean }} opts
			 * @returns {Promise<void>}
			 */
			goto: (url, opts) =>
				page.evaluate(
					(/** @type {{ url: string, opts: { replaceState?: boolean } }} */ { url, opts }) =>
						goto(url, opts),
					{ url, opts }
				),

			/**
			 * @param {string} url
			 * @returns {Promise<void>}
			 */
			invalidate: (url) => page.evaluate((/** @type {string} */ url) => invalidate(url), url),

			/**
			 * @param {(url: URL) => void | boolean | Promise<void | boolean>} fn
			 * @returns {Promise<void>}
			 */
			beforeNavigate: (fn) =>
				page.evaluate((/** @type {(url: URL) => any} */ fn) => beforeNavigate(fn), fn),

			/**
			 * @returns {Promise<void>}
			 */
			afterNavigate: () => page.evaluate(() => afterNavigate(() => {})),

			/**
			 * @param {string[]} urls
			 * @returns {Promise<void>}
			 */
			preloadCode: (...urls) => page.evaluate((urls) => preloadCode(...urls), urls),

			/**
			 * @param {string} url
			 * @returns {Promise<void>}
			 */
			preloadData: (url) => page.evaluate((/** @type {string} */ url) => preloadData(url), url)
		});
	},

	clicknav: async ({ page, javaScriptEnabled }, use) => {
		/**
		 * @param {string} selector
		 * @param {{ timeout: number }} options
		 */
		async function clicknav(selector, options) {
			const element = page.locator(selector);
			if (javaScriptEnabled) {
				await Promise.all([page.waitForNavigation(options), element.click()]);
			} else {
				await element.click();
			}
		}

		use(clicknav);
	},

	in_view: async ({ page }, use) => {
		/** @param {string} selector */
		async function in_view(selector) {
			const box = await page.locator(selector).boundingBox();
			const view = page.viewportSize();
			return box && view && box.y < view.height && box.y + box.height > 0;
		}

		use(in_view);
	},

	get_computed_style: async ({ page }, use) => {
		/**
		 * @param {string} selector
		 * @param {string} prop
		 */
		async function get_computed_style(selector, prop) {
			return page.$eval(
				selector,
				(node, prop) => window.getComputedStyle(node).getPropertyValue(prop),
				prop
			);
		}

		await use(get_computed_style);
	},

	page: async ({ page, javaScriptEnabled }, use) => {
		// automatically wait for kit started event after navigation functions if js is enabled
		const page_navigation_functions = ['goto', 'goBack', 'reload'];
		page_navigation_functions.forEach((fn) => {
			// @ts-expect-error
			const page_fn = page[fn];
			if (!page_fn) {
				throw new Error(`function does not exist on page: ${fn}`);
			}
			// @ts-expect-error
			page[fn] = async function (...args) {
				const res = await page_fn.call(page, ...args);
				if (javaScriptEnabled && args[1]?.wait_for_started !== false) {
					await page.waitForSelector('body.started', { timeout: 15000 });
				}
				return res;
			};
		});

		await use(page);
	},

	// eslint-disable-next-line no-empty-pattern
	read_errors: ({}, use) => {
		/** @param {string} path */
		function read_errors(path) {
			const errors =
				fs.existsSync('test/errors.json') &&
				JSON.parse(fs.readFileSync('test/errors.json', 'utf8'));
			return errors[path];
		}

		use(read_errors);
	},

	// eslint-disable-next-line no-empty-pattern
	start_server: async ({}, use) => {
		/**
		 * @type {http.Server}
		 */
		let server;

		/**
		 * @type {Set<import('net').Socket>}
		 */
		let sockets;

		/**
		 * @param {(req: http.IncomingMessage, res: http.ServerResponse) => void} handler
		 */
		async function start_server(handler) {
			if (server) {
				throw new Error('server already started');
			}
			server = http.createServer(handler);

			await new Promise((fulfil) => {
				server.listen(0, 'localhost', () => {
					fulfil(undefined);
				});
			});

			const { port } = /** @type {import('net').AddressInfo} */ (server.address());
			if (!port) {
				throw new Error(`Could not find port from server ${JSON.stringify(server.address())}`);
			}
			sockets = new Set();
			server.on('connection', (socket) => {
				sockets.add(socket);
				socket.on('close', () => {
					sockets.delete(socket);
				});
			});
			return {
				port
			};
		}
		await use(start_server);

		// @ts-expect-error use before set
		if (server) {
			// @ts-expect-error use before set
			if (sockets) {
				sockets.forEach((socket) => {
					if (!socket.destroyed) {
						socket.destroy();
					}
				});
			}

			await new Promise((fulfil, reject) => {
				server.close((err) => {
					if (err) {
						reject(err);
					} else {
						fulfil(undefined);
					}
				});
			});
		}
	},

	// make sure context fixture depends on start server, so setup/teardown order is
	// setup start_server
	// setup context
	// teardown context
	// teardown start_server
	async context({ context, start_server }, use) {
		// just here make sure start_server is referenced, don't call
		if (!start_server) {
			throw new Error('start_server fixture not present');
		}
		await use(context);
		try {
			await context.close();
		} catch (e) {
			console.error('failed to close context fixture', e);
		}
	}
});

const known_devices = {
	chromium: devices['Desktop Chrome'],
	firefox: devices['Desktop Firefox'],
	webkit: devices['Desktop Safari']
};
const test_browser = /** @type {keyof typeof known_devices} */ (
	process.env.KIT_E2E_BROWSER ?? 'chromium'
);

const test_browser_device = known_devices[test_browser];

if (!test_browser_device) {
	throw new Error(
		`invalid test browser specified: KIT_E2E_BROWSER=${
			process.env.KIT_E2E_BROWSER
		}. Allowed values: ${Object.keys(known_devices).join(', ')}`
	);
}

/** @type {import('@playwright/test').PlaywrightTestConfig} */
export const config = {
	forbidOnly: !!process.env.CI,
	// generous timeouts on CI
	timeout: process.env.CI ? 45000 : 15000,
	webServer: {
		command: process.env.DEV ? 'pnpm dev' : 'pnpm build && pnpm preview',
		port: process.env.DEV ? 5173 : 4173
	},
	retries: process.env.CI ? 2 : 0,
	projects: [
		{
			name: `${test_browser}-${process.env.DEV ? 'dev' : 'build'}`,
			use: {
				javaScriptEnabled: true
			}
		},
		{
			name: `${test_browser}-${process.env.DEV ? 'dev' : 'build'}-no-js`,
			use: {
				javaScriptEnabled: false
			}
		}
	],
	use: {
		...test_browser_device,
		screenshot: 'only-on-failure',
		trace: 'retain-on-failure'
	},
	workers: process.env.CI ? 2 : undefined,
	reporter: process.env.CI
		? [
				['dot'],
				[path.resolve(fileURLToPath(import.meta.url), '../github-flaky-warning-reporter.js')]
			]
		: 'list',
	testDir: 'test',
	testMatch: /(.+\.)?(test|spec)\.[jt]s/
};

```


####### packages/kit/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true,
		"strict": true,
		"target": "es2022",
		"module": "node16",
		"moduleResolution": "node16",
		"allowSyntheticDefaultImports": true,
		"paths": {
			"@sveltejs/kit": ["./src/exports/public.d.ts"],
			"@sveltejs/kit/node": ["./src/exports/node/index.js"],
			// internal use only
			"types": ["./src/types/internal.d.ts"]
		},
		"noUnusedLocals": true,
		"noUnusedParameters": true
	},
	"include": [
		"postinstall.js",
		"scripts/**/*",
		"src/**/*",
		"src/types/**/*",
		"../../sites/kit.svelte.dev/scripts/extract-types.js"
	],
	"exclude": ["./**/write_types/test/**"]
}

```


####### packages/kit/types/index.d.ts #######

```

/// <reference types="svelte" />
/// <reference types="vite/client" />

declare module '@sveltejs/kit' {
	import type { CompileOptions } from 'svelte/compiler';
	import type { PluginOptions } from '@sveltejs/vite-plugin-svelte';
	/**
	 * [Adapters](https://kit.svelte.dev/docs/adapters) are responsible for taking the production build and turning it into something that can be deployed to a platform of your choosing.
	 */
	export interface Adapter {
		/**
		 * The name of the adapter, using for logging. Will typically correspond to the package name.
		 */
		name: string;
		/**
		 * This function is called after SvelteKit has built your app.
		 * @param builder An object provided by SvelteKit that contains methods for adapting the app
		 */
		adapt(builder: Builder): MaybePromise<void>;
		/**
		 * Checks called during dev and build to determine whether specific features will work in production with this adapter
		 */
		supports?: {
			/**
			 * Test support for `read` from `$app/server`
			 * @param config The merged route config
			 */
			read?: (details: { config: any; route: { id: string } }) => boolean;
		};
		/**
		 * Creates an `Emulator`, which allows the adapter to influence the environment
		 * during dev, build and prerendering
		 */
		emulate?(): MaybePromise<Emulator>;
	}

	export type LoadProperties<input extends Record<string, any> | void> = input extends void
		? undefined // needs to be undefined, because void will break intellisense
		: input extends Record<string, any>
			? input
			: unknown;

	export type AwaitedActions<T extends Record<string, (...args: any) => any>> = OptionalUnion<
		{
			[Key in keyof T]: UnpackValidationError<Awaited<ReturnType<T[Key]>>>;
		}[keyof T]
	>;

	// Takes a union type and returns a union type where each type also has all properties
	// of all possible types (typed as undefined), making accessing them more ergonomic
	type OptionalUnion<
		U extends Record<string, any>, // not unknown, else interfaces don't satisfy this constraint
		A extends keyof U = U extends U ? keyof U : never
	> = U extends unknown ? { [P in Exclude<A, keyof U>]?: never } & U : never;

	const uniqueSymbol: unique symbol;

	export interface ActionFailure<T extends Record<string, unknown> | undefined = undefined> {
		status: number;
		data: T;
		[uniqueSymbol]: true; // necessary or else UnpackValidationError could wrongly unpack objects with the same shape as ActionFailure
	}

	type UnpackValidationError<T> =
		T extends ActionFailure<infer X>
			? X
			: T extends void
				? undefined // needs to be undefined, because void will corrupt union type
				: T;

	/**
	 * This object is passed to the `adapt` function of adapters.
	 * It contains various methods and properties that are useful for adapting the app.
	 */
	export interface Builder {
		/** Print messages to the console. `log.info` and `log.minor` are silent unless Vite's `logLevel` is `info`. */
		log: Logger;
		/** Remove `dir` and all its contents. */
		rimraf(dir: string): void;
		/** Create `dir` and any required parent directories. */
		mkdirp(dir: string): void;

		/** The fully resolved `svelte.config.js`. */
		config: ValidatedConfig;
		/** Information about prerendered pages and assets, if any. */
		prerendered: Prerendered;
		/** An array of all routes (including prerendered) */
		routes: RouteDefinition[];

		// TODO 3.0 remove this method
		/**
		 * Create separate functions that map to one or more routes of your app.
		 * @param fn A function that groups a set of routes into an entry point
		 * @deprecated Use `builder.routes` instead
		 */
		createEntries(fn: (route: RouteDefinition) => AdapterEntry): Promise<void>;

		/**
		 * Find all the assets imported by server files belonging to `routes`
		 */
		findServerAssets(routes: RouteDefinition[]): string[];

		/**
		 * Generate a fallback page for a static webserver to use when no route is matched. Useful for single-page apps.
		 */
		generateFallback(dest: string): Promise<void>;

		/**
		 * Generate a module exposing build-time environment variables as `$env/dynamic/public`.
		 */
		generateEnvModule(): void;

		/**
		 * Generate a server-side manifest to initialise the SvelteKit [server](https://kit.svelte.dev/docs/types#public-types-server) with.
		 * @param opts a relative path to the base directory of the app and optionally in which format (esm or cjs) the manifest should be generated
		 */
		generateManifest(opts: { relativePath: string; routes?: RouteDefinition[] }): string;

		/**
		 * Resolve a path to the `name` directory inside `outDir`, e.g. `/path/to/.svelte-kit/my-adapter`.
		 * @param name path to the file, relative to the build directory
		 */
		getBuildDirectory(name: string): string;
		/** Get the fully resolved path to the directory containing client-side assets, including the contents of your `static` directory. */
		getClientDirectory(): string;
		/** Get the fully resolved path to the directory containing server-side code. */
		getServerDirectory(): string;
		/** Get the application path including any configured `base` path, e.g. `my-base-path/_app`. */
		getAppPath(): string;

		/**
		 * Write client assets to `dest`.
		 * @param dest the destination folder
		 * @returns an array of files written to `dest`
		 */
		writeClient(dest: string): string[];
		/**
		 * Write prerendered files to `dest`.
		 * @param dest the destination folder
		 * @returns an array of files written to `dest`
		 */
		writePrerendered(dest: string): string[];
		/**
		 * Write server-side code to `dest`.
		 * @param dest the destination folder
		 * @returns an array of files written to `dest`
		 */
		writeServer(dest: string): string[];
		/**
		 * Copy a file or directory.
		 * @param from the source file or directory
		 * @param to the destination file or directory
		 * @param opts.filter a function to determine whether a file or directory should be copied
		 * @param opts.replace a map of strings to replace
		 * @returns an array of files that were copied
		 */
		copy(
			from: string,
			to: string,
			opts?: {
				filter?(basename: string): boolean;
				replace?: Record<string, string>;
			}
		): string[];

		/**
		 * Compress files in `directory` with gzip and brotli, where appropriate. Generates `.gz` and `.br` files alongside the originals.
		 * @param directory The directory containing the files to be compressed
		 */
		compress(directory: string): Promise<void>;
	}

	export interface Config {
		/**
		 * Options passed to [`svelte.compile`](https://svelte.dev/docs#compile-time-svelte-compile).
		 * @default {}
		 */
		compilerOptions?: CompileOptions;
		/**
		 * List of file extensions that should be treated as Svelte files.
		 * @default [".svelte"]
		 */
		extensions?: string[];
		/** SvelteKit options */
		kit?: KitConfig;
		/** Preprocessor options, if any. Preprocessing can alternatively also be done through Vite's preprocessor capabilities. */
		preprocess?: any;
		/** `vite-plugin-svelte` plugin options. */
		vitePlugin?: PluginOptions;
		/** Any additional options required by tooling that integrates with Svelte. */
		[key: string]: any;
	}

	export interface Cookies {
		/**
		 * Gets a cookie that was previously set with `cookies.set`, or from the request headers.
		 * @param name the name of the cookie
		 * @param opts the options, passed directly to `cookie.parse`. See documentation [here](https://github.com/jshttp/cookie#cookieparsestr-options)
		 */
		get(name: string, opts?: import('cookie').CookieParseOptions): string | undefined;

		/**
		 * Gets all cookies that were previously set with `cookies.set`, or from the request headers.
		 * @param opts the options, passed directly to `cookie.parse`. See documentation [here](https://github.com/jshttp/cookie#cookieparsestr-options)
		 */
		getAll(opts?: import('cookie').CookieParseOptions): Array<{ name: string; value: string }>;

		/**
		 * Sets a cookie. This will add a `set-cookie` header to the response, but also make the cookie available via `cookies.get` or `cookies.getAll` during the current request.
		 *
		 * The `httpOnly` and `secure` options are `true` by default (except on http://localhost, where `secure` is `false`), and must be explicitly disabled if you want cookies to be readable by client-side JavaScript and/or transmitted over HTTP. The `sameSite` option defaults to `lax`.
		 *
		 * You must specify a `path` for the cookie. In most cases you should explicitly set `path: '/'` to make the cookie available throughout your app. You can use relative paths, or set `path: ''` to make the cookie only available on the current path and its children
		 * @param name the name of the cookie
		 * @param value the cookie value
		 * @param opts the options, passed directly to `cookie.serialize`. See documentation [here](https://github.com/jshttp/cookie#cookieserializename-value-options)
		 */
		set(
			name: string,
			value: string,
			opts: import('cookie').CookieSerializeOptions & { path: string }
		): void;

		/**
		 * Deletes a cookie by setting its value to an empty string and setting the expiry date in the past.
		 *
		 * You must specify a `path` for the cookie. In most cases you should explicitly set `path: '/'` to make the cookie available throughout your app. You can use relative paths, or set `path: ''` to make the cookie only available on the current path and its children
		 * @param name the name of the cookie
		 * @param opts the options, passed directly to `cookie.serialize`. The `path` must match the path of the cookie you want to delete. See documentation [here](https://github.com/jshttp/cookie#cookieserializename-value-options)
		 */
		delete(name: string, opts: import('cookie').CookieSerializeOptions & { path: string }): void;

		/**
		 * Serialize a cookie name-value pair into a `Set-Cookie` header string, but don't apply it to the response.
		 *
		 * The `httpOnly` and `secure` options are `true` by default (except on http://localhost, where `secure` is `false`), and must be explicitly disabled if you want cookies to be readable by client-side JavaScript and/or transmitted over HTTP. The `sameSite` option defaults to `lax`.
		 *
		 * You must specify a `path` for the cookie. In most cases you should explicitly set `path: '/'` to make the cookie available throughout your app. You can use relative paths, or set `path: ''` to make the cookie only available on the current path and its children
		 *
		 * @param name the name of the cookie
		 * @param value the cookie value
		 * @param opts the options, passed directly to `cookie.serialize`. See documentation [here](https://github.com/jshttp/cookie#cookieserializename-value-options)
		 */
		serialize(
			name: string,
			value: string,
			opts: import('cookie').CookieSerializeOptions & { path: string }
		): string;
	}

	/**
	 * A collection of functions that influence the environment during dev, build and prerendering
	 */
	export interface Emulator {
		/**
		 * A function that is called with the current route `config` and `prerender` option
		 * and returns an `App.Platform` object
		 */
		platform?(details: { config: any; prerender: PrerenderOption }): MaybePromise<App.Platform>;
	}

	export interface KitConfig {
		/**
		 * Your [adapter](https://kit.svelte.dev/docs/adapters) is run when executing `vite build`. It determines how the output is converted for different platforms.
		 * @default undefined
		 */
		adapter?: Adapter;
		/**
		 * An object containing zero or more aliases used to replace values in `import` statements. These aliases are automatically passed to Vite and TypeScript.
		 *
		 * ```js
		 * /// file: svelte.config.js
		 * /// type: import('@sveltejs/kit').Config
		 * const config = {
		 *   kit: {
		 *     alias: {
		 *       // this will match a file
		 *       'my-file': 'path/to/my-file.js',
		 *
		 *       // this will match a directory and its contents
		 *       // (`my-directory/x` resolves to `path/to/my-directory/x`)
		 *       'my-directory': 'path/to/my-directory',
		 *
		 *       // an alias ending /* will only match
		 *       // the contents of a directory, not the directory itself
		 *       'my-directory/*': 'path/to/my-directory/*'
		 *     }
		 *   }
		 * };
		 * ```
		 *
		 * > The built-in `$lib` alias is controlled by `config.kit.files.lib` as it is used for packaging.
		 *
		 * > You will need to run `npm run dev` to have SvelteKit automatically generate the required alias configuration in `jsconfig.json` or `tsconfig.json`.
		 * @default {}
		 */
		alias?: Record<string, string>;
		/**
		 * The directory where SvelteKit keeps its stuff, including static assets (such as JS and CSS) and internally-used routes.
		 *
		 * If `paths.assets` is specified, there will be two app directories — `${paths.assets}/${appDir}` and `${paths.base}/${appDir}`.
		 * @default "_app"
		 */
		appDir?: string;
		/**
		 * [Content Security Policy](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy) configuration. CSP helps to protect your users against cross-site scripting (XSS) attacks, by limiting the places resources can be loaded from. For example, a configuration like this...
		 *
		 * ```js
		 * /// file: svelte.config.js
		 * /// type: import('@sveltejs/kit').Config
		 * const config = {
		 *   kit: {
		 *     csp: {
		 *       directives: {
		 *         'script-src': ['self']
		 *       },
		 *       reportOnly: {
		 *         'script-src': ['self']
		 *       }
		 *     }
		 *   }
		 * };
		 *
		 * export default config;
		 * ```
		 *
		 * ...would prevent scripts loading from external sites. SvelteKit will augment the specified directives with nonces or hashes (depending on `mode`) for any inline styles and scripts it generates.
		 *
		 * To add a nonce for scripts and links manually included in `src/app.html`, you may use the placeholder `%sveltekit.nonce%` (for example `<script nonce="%sveltekit.nonce%">`).
		 *
		 * When pages are prerendered, the CSP header is added via a `<meta http-equiv>` tag (note that in this case, `frame-ancestors`, `report-uri` and `sandbox` directives will be ignored).
		 *
		 * > When `mode` is `'auto'`, SvelteKit will use nonces for dynamically rendered pages and hashes for prerendered pages. Using nonces with prerendered pages is insecure and therefore forbidden.
		 *
		 * > Note that most [Svelte transitions](https://svelte.dev/tutorial/transition) work by creating an inline `<style>` element. If you use these in your app, you must either leave the `style-src` directive unspecified or add `unsafe-inline`.
		 *
		 * If this level of configuration is insufficient and you have more dynamic requirements, you can use the [`handle` hook](https://kit.svelte.dev/docs/hooks#server-hooks-handle) to roll your own CSP.
		 */
		csp?: {
			/**
			 * Whether to use hashes or nonces to restrict `<script>` and `<style>` elements. `'auto'` will use hashes for prerendered pages, and nonces for dynamically rendered pages.
			 */
			mode?: 'hash' | 'nonce' | 'auto';
			/**
			 * Directives that will be added to `Content-Security-Policy` headers.
			 */
			directives?: CspDirectives;
			/**
			 * Directives that will be added to `Content-Security-Policy-Report-Only` headers.
			 */
			reportOnly?: CspDirectives;
		};
		/**
		 * Protection against [cross-site request forgery (CSRF)](https://owasp.org/www-community/attacks/csrf) attacks.
		 */
		csrf?: {
			/**
			 * Whether to check the incoming `origin` header for `POST`, `PUT`, `PATCH`, or `DELETE` form submissions and verify that it matches the server's origin.
			 *
			 * To allow people to make `POST`, `PUT`, `PATCH`, or `DELETE` requests with a `Content-Type` of `application/x-www-form-urlencoded`, `multipart/form-data`, or `text/plain` to your app from other origins, you will need to disable this option. Be careful!
			 * @default true
			 */
			checkOrigin?: boolean;
		};
		/**
		 * Whether or not the app is embedded inside a larger app. If `true`, SvelteKit will add its event listeners related to navigation etc on the parent of `%sveltekit.body%` instead of `window`, and will pass `params` from the server rather than inferring them from `location.pathname`.
		 * Note that it is generally not supported to embed multiple SvelteKit apps on the same page and use client-side SvelteKit features within them (things such as pushing to the history state assume a single instance).
		 * @default false
		 */
		embedded?: boolean;
		/**
		 * Environment variable configuration
		 */
		env?: {
			/**
			 * The directory to search for `.env` files.
			 * @default "."
			 */
			dir?: string;
			/**
			 * A prefix that signals that an environment variable is safe to expose to client-side code. See [`$env/static/public`](/docs/modules#$env-static-public) and [`$env/dynamic/public`](/docs/modules#$env-dynamic-public). Note that Vite's [`envPrefix`](https://vitejs.dev/config/shared-options.html#envprefix) must be set separately if you are using Vite's environment variable handling - though use of that feature should generally be unnecessary.
			 * @default "PUBLIC_"
			 */
			publicPrefix?: string;
			/**
			 * A prefix that signals that an environment variable is unsafe to expose to client-side code. Environment variables matching neither the public nor the private prefix will be discarded completely. See [`$env/static/private`](/docs/modules#$env-static-private) and [`$env/dynamic/private`](/docs/modules#$env-dynamic-private).
			 * @default ""
			 * @since 1.21.0
			 */
			privatePrefix?: string;
		};
		/**
		 * Where to find various files within your project.
		 */
		files?: {
			/**
			 * a place to put static files that should have stable URLs and undergo no processing, such as `favicon.ico` or `manifest.json`
			 * @default "static"
			 */
			assets?: string;
			hooks?: {
				/**
				 * The location of your client [hooks](https://kit.svelte.dev/docs/hooks).
				 * @default "src/hooks.client"
				 */
				client?: string;
				/**
				 * The location of your server [hooks](https://kit.svelte.dev/docs/hooks).
				 * @default "src/hooks.server"
				 */
				server?: string;
				/**
				 * The location of your universal [hooks](https://kit.svelte.dev/docs/hooks).
				 * @default "src/hooks"
				 * @since 2.3.0
				 */
				universal?: string;
			};
			/**
			 * your app's internal library, accessible throughout the codebase as `$lib`
			 * @default "src/lib"
			 */
			lib?: string;
			/**
			 * a directory containing [parameter matchers](https://kit.svelte.dev/docs/advanced-routing#matching)
			 * @default "src/params"
			 */
			params?: string;
			/**
			 * the files that define the structure of your app (see [Routing](https://kit.svelte.dev/docs/routing))
			 * @default "src/routes"
			 */
			routes?: string;
			/**
			 * the location of your service worker's entry point (see [Service workers](https://kit.svelte.dev/docs/service-workers))
			 * @default "src/service-worker"
			 */
			serviceWorker?: string;
			/**
			 * the location of the template for HTML responses
			 * @default "src/app.html"
			 */
			appTemplate?: string;
			/**
			 * the location of the template for fallback error responses
			 * @default "src/error.html"
			 */
			errorTemplate?: string;
		};
		/**
		 * Inline CSS inside a `<style>` block at the head of the HTML. This option is a number that specifies the maximum length of a CSS file in UTF-16 code units, as specified by the [String.length](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/length) property, to be inlined. All CSS files needed for the page and smaller than this value are merged and inlined in a `<style>` block.
		 *
		 * > This results in fewer initial requests and can improve your [First Contentful Paint](https://web.dev/first-contentful-paint) score. However, it generates larger HTML output and reduces the effectiveness of browser caches. Use it advisedly.
		 * @default 0
		 */
		inlineStyleThreshold?: number;
		/**
		 * An array of file extensions that SvelteKit will treat as modules. Files with extensions that match neither `config.extensions` nor `config.kit.moduleExtensions` will be ignored by the router.
		 * @default [".js", ".ts"]
		 */
		moduleExtensions?: string[];
		/**
		 * The directory that SvelteKit writes files to during `dev` and `build`. You should exclude this directory from version control.
		 * @default ".svelte-kit"
		 */
		outDir?: string;
		/**
		 * Options related to the build output format
		 */
		output?: {
			/**
			 * SvelteKit will preload the JavaScript modules needed for the initial page to avoid import 'waterfalls', resulting in faster application startup. There
			 * are three strategies with different trade-offs:
			 * - `modulepreload` - uses `<link rel="modulepreload">`. This delivers the best results in Chromium-based browsers, in Firefox 115+, and Safari 17+. It is ignored in older browsers.
			 * - `preload-js` - uses `<link rel="preload">`. Prevents waterfalls in Chromium and Safari, but Chromium will parse each module twice (once as a script, once as a module). Causes modules to be requested twice in Firefox. This is a good setting if you want to maximise performance for users on iOS devices at the cost of a very slight degradation for Chromium users.
			 * - `preload-mjs` - uses `<link rel="preload">` but with the `.mjs` extension which prevents double-parsing in Chromium. Some static webservers will fail to serve .mjs files with a `Content-Type: application/javascript` header, which will cause your application to break. If that doesn't apply to you, this is the option that will deliver the best performance for the largest number of users, until `modulepreload` is more widely supported.
			 * @default "modulepreload"
			 * @since 1.8.4
			 */
			preloadStrategy?: 'modulepreload' | 'preload-js' | 'preload-mjs';
		};
		paths?: {
			/**
			 * An absolute path that your app's files are served from. This is useful if your files are served from a storage bucket of some kind.
			 * @default ""
			 */
			assets?: '' | `http://${string}` | `https://${string}`;
			/**
			 * A root-relative path that must start, but not end with `/` (e.g. `/base-path`), unless it is the empty string. This specifies where your app is served from and allows the app to live on a non-root path. Note that you need to prepend all your root-relative links with the base value or they will point to the root of your domain, not your `base` (this is how the browser works). You can use [`base` from `$app/paths`](/docs/modules#$app-paths-base) for that: `<a href="{base}/your-page">Link</a>`. If you find yourself writing this often, it may make sense to extract this into a reusable component.
			 * @default ""
			 */
			base?: '' | `/${string}`;
			/**
			 * Whether to use relative asset paths.
			 *
			 * If `true`, `base` and `assets` imported from `$app/paths` will be replaced with relative asset paths during server-side rendering, resulting in more portable HTML.
			 * If `false`, `%sveltekit.assets%` and references to build artifacts will always be root-relative paths, unless `paths.assets` is an external URL
			 *
			 * [Single-page app](https://kit.svelte.dev/docs/single-page-apps) fallback pages will always use absolute paths, regardless of this setting.
			 *
			 * If your app uses a `<base>` element, you should set this to `false`, otherwise asset URLs will incorrectly be resolved against the `<base>` URL rather than the current page.
			 *
			 * In 1.0, `undefined` was a valid value, which was set by default. In that case, if `paths.assets` was not external, SvelteKit would replace `%sveltekit.assets%` with a relative path and use relative paths to reference build artifacts, but `base` and `assets` imported from `$app/paths` would be as specified in your config.
			 *
			 * @default true
			 * @since 1.9.0
			 */
			relative?: boolean;
		};
		/**
		 * See [Prerendering](https://kit.svelte.dev/docs/page-options#prerender).
		 */
		prerender?: {
			/**
			 * How many pages can be prerendered simultaneously. JS is single-threaded, but in cases where prerendering performance is network-bound (for example loading content from a remote CMS) this can speed things up by processing other tasks while waiting on the network response.
			 * @default 1
			 */
			concurrency?: number;
			/**
			 * Whether SvelteKit should find pages to prerender by following links from `entries`.
			 * @default true
			 */
			crawl?: boolean;
			/**
			 * An array of pages to prerender, or start crawling from (if `crawl: true`). The `*` string includes all routes containing no required `[parameters]`  with optional parameters included as being empty (since SvelteKit doesn't know what value any parameters should have).
			 * @default ["*"]
			 */
			entries?: Array<'*' | `/${string}`>;
			/**
			 * How to respond to HTTP errors encountered while prerendering the app.
			 *
			 * - `'fail'` — fail the build
			 * - `'ignore'` - silently ignore the failure and continue
			 * - `'warn'` — continue, but print a warning
			 * - `(details) => void` — a custom error handler that takes a `details` object with `status`, `path`, `referrer`, `referenceType` and `message` properties. If you `throw` from this function, the build will fail
			 *
			 * ```js
			 * /// file: svelte.config.js
			 * /// type: import('@sveltejs/kit').Config
			 * const config = {
			 *   kit: {
			 *     prerender: {
			 *       handleHttpError: ({ path, referrer, message }) => {
			 *         // ignore deliberate link to shiny 404 page
			 *         if (path === '/not-found' && referrer === '/blog/how-we-built-our-404-page') {
			 *           return;
			 *         }
			 *
			 *         // otherwise fail the build
			 *         throw new Error(message);
			 *       }
			 *     }
			 *   }
			 * };
			 * ```
			 *
			 * @default "fail"
			 * @since 1.15.7
			 */
			handleHttpError?: PrerenderHttpErrorHandlerValue;
			/**
			 * How to respond when hash links from one prerendered page to another don't correspond to an `id` on the destination page.
			 *
			 * - `'fail'` — fail the build
			 * - `'ignore'` - silently ignore the failure and continue
			 * - `'warn'` — continue, but print a warning
			 * - `(details) => void` — a custom error handler that takes a `details` object with `path`, `id`, `referrers` and `message` properties. If you `throw` from this function, the build will fail
			 *
			 * @default "fail"
			 * @since 1.15.7
			 */
			handleMissingId?: PrerenderMissingIdHandlerValue;
			/**
			 * How to respond when an entry generated by the `entries` export doesn't match the route it was generated from.
			 *
			 * - `'fail'` — fail the build
			 * - `'ignore'` - silently ignore the failure and continue
			 * - `'warn'` — continue, but print a warning
			 * - `(details) => void` — a custom error handler that takes a `details` object with `generatedFromId`, `entry`, `matchedId` and `message` properties. If you `throw` from this function, the build will fail
			 *
			 * @default "fail"
			 * @since 1.16.0
			 */
			handleEntryGeneratorMismatch?: PrerenderEntryGeneratorMismatchHandlerValue;
			/**
			 * The value of `url.origin` during prerendering; useful if it is included in rendered content.
			 * @default "http://sveltekit-prerender"
			 */
			origin?: string;
		};
		serviceWorker?: {
			/**
			 * Whether to automatically register the service worker, if it exists.
			 * @default true
			 */
			register?: boolean;
			/**
			 * Determine which files in your `static` directory will be available in `$service-worker.files`.
			 * @default (filename) => !/\.DS_Store/.test(filename)
			 */
			files?(filepath: string): boolean;
		};
		typescript?: {
			/**
			 * A function that allows you to edit the generated `tsconfig.json`. You can mutate the config (recommended) or return a new one.
			 * This is useful for extending a shared `tsconfig.json` in a monorepo root, for example.
			 * @default (config) => config
			 * @since 1.3.0
			 */
			config?: (config: Record<string, any>) => Record<string, any> | void;
		};
		/**
		 * Client-side navigation can be buggy if you deploy a new version of your app while people are using it. If the code for the new page is already loaded, it may have stale content; if it isn't, the app's route manifest may point to a JavaScript file that no longer exists.
		 * SvelteKit helps you solve this problem through version management.
		 * If SvelteKit encounters an error while loading the page and detects that a new version has been deployed (using the `name` specified here, which defaults to a timestamp of the build) it will fall back to traditional full-page navigation.
		 * Not all navigations will result in an error though, for example if the JavaScript for the next page is already loaded. If you still want to force a full-page navigation in these cases, use techniques such as setting the `pollInterval` and then using `beforeNavigate`:
		 * ```html
		 * /// file: +layout.svelte
		 * <script>
		 *   import { beforeNavigate } from '$app/navigation';
		 *   import { updated } from '$app/stores';
		 *
		 *   beforeNavigate(({ willUnload, to }) => {
		 *     if ($updated && !willUnload && to?.url) {
		 *       location.href = to.url.href;
		 *     }
		 *   });
		 * </script>
		 * ```
		 *
		 * If you set `pollInterval` to a non-zero value, SvelteKit will poll for new versions in the background and set the value of the [`updated`](/docs/modules#$app-stores-updated) store to `true` when it detects one.
		 */
		version?: {
			/**
			 * The current app version string. If specified, this must be deterministic (e.g. a commit ref rather than `Math.random()` or `Date.now().toString()`), otherwise defaults to a timestamp of the build.
			 *
			 * For example, to use the current commit hash, you could do use `git rev-parse HEAD`:
			 *
			 * ```js
			 * /// file: svelte.config.js
			 * import * as child_process from 'node:child_process';
			 *
			 * export default {
			 *   kit: {
			 *     version: {
			 *       name: child_process.execSync('git rev-parse HEAD').toString().trim()
			 *     }
			 *   }
			 * };
			 * ```
			 */
			name?: string;
			/**
			 * The interval in milliseconds to poll for version changes. If this is `0`, no polling occurs.
			 * @default 0
			 */
			pollInterval?: number;
		};
	}

	/**
	 * The [`handle`](https://kit.svelte.dev/docs/hooks#server-hooks-handle) hook runs every time the SvelteKit server receives a [request](https://kit.svelte.dev/docs/web-standards#fetch-apis-request) and
	 * determines the [response](https://kit.svelte.dev/docs/web-standards#fetch-apis-response).
	 * It receives an `event` object representing the request and a function called `resolve`, which renders the route and generates a `Response`.
	 * This allows you to modify response headers or bodies, or bypass SvelteKit entirely (for implementing routes programmatically, for example).
	 */
	export type Handle = (input: {
		event: RequestEvent;
		resolve(event: RequestEvent, opts?: ResolveOptions): MaybePromise<Response>;
	}) => MaybePromise<Response>;

	/**
	 * The server-side [`handleError`](https://kit.svelte.dev/docs/hooks#shared-hooks-handleerror) hook runs when an unexpected error is thrown while responding to a request.
	 *
	 * If an unexpected error is thrown during loading or rendering, this function will be called with the error and the event.
	 * Make sure that this function _never_ throws an error.
	 */
	export type HandleServerError = (input: {
		error: unknown;
		event: RequestEvent;
		status: number;
		message: string;
	}) => MaybePromise<void | App.Error>;

	/**
	 * The client-side [`handleError`](https://kit.svelte.dev/docs/hooks#shared-hooks-handleerror) hook runs when an unexpected error is thrown while navigating.
	 *
	 * If an unexpected error is thrown during loading or the following render, this function will be called with the error and the event.
	 * Make sure that this function _never_ throws an error.
	 */
	export type HandleClientError = (input: {
		error: unknown;
		event: NavigationEvent;
		status: number;
		message: string;
	}) => MaybePromise<void | App.Error>;

	/**
	 * The [`handleFetch`](https://kit.svelte.dev/docs/hooks#server-hooks-handlefetch) hook allows you to modify (or replace) a `fetch` request that happens inside a `load` function that runs on the server (or during pre-rendering)
	 */
	export type HandleFetch = (input: {
		event: RequestEvent;
		request: Request;
		fetch: typeof fetch;
	}) => MaybePromise<Response>;

	/**
	 * The [`reroute`](https://kit.svelte.dev/docs/hooks#universal-hooks-reroute) hook allows you to modify the URL before it is used to determine which route to render.
	 * @since 2.3.0
	 */
	export type Reroute = (event: { url: URL }) => void | string;

	/**
	 * The generic form of `PageLoad` and `LayoutLoad`. You should import those from `./$types` (see [generated types](https://kit.svelte.dev/docs/types#generated-types))
	 * rather than using `Load` directly.
	 */
	export type Load<
		Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
		InputData extends Record<string, unknown> | null = Record<string, any> | null,
		ParentData extends Record<string, unknown> = Record<string, any>,
		OutputData extends Record<string, unknown> | void = Record<string, any> | void,
		RouteId extends string | null = string | null
	> = (event: LoadEvent<Params, InputData, ParentData, RouteId>) => MaybePromise<OutputData>;

	/**
	 * The generic form of `PageLoadEvent` and `LayoutLoadEvent`. You should import those from `./$types` (see [generated types](https://kit.svelte.dev/docs/types#generated-types))
	 * rather than using `LoadEvent` directly.
	 */
	export interface LoadEvent<
		Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
		Data extends Record<string, unknown> | null = Record<string, any> | null,
		ParentData extends Record<string, unknown> = Record<string, any>,
		RouteId extends string | null = string | null
	> extends NavigationEvent<Params, RouteId> {
		/**
		 * `fetch` is equivalent to the [native `fetch` web API](https://developer.mozilla.org/en-US/docs/Web/API/fetch), with a few additional features:
		 *
		 * - It can be used to make credentialed requests on the server, as it inherits the `cookie` and `authorization` headers for the page request.
		 * - It can make relative requests on the server (ordinarily, `fetch` requires a URL with an origin when used in a server context).
		 * - Internal requests (e.g. for `+server.js` routes) go directly to the handler function when running on the server, without the overhead of an HTTP call.
		 * - During server-side rendering, the response will be captured and inlined into the rendered HTML by hooking into the `text` and `json` methods of the `Response` object. Note that headers will _not_ be serialized, unless explicitly included via [`filterSerializedResponseHeaders`](https://kit.svelte.dev/docs/hooks#server-hooks-handle)
		 * - During hydration, the response will be read from the HTML, guaranteeing consistency and preventing an additional network request.
		 *
		 * You can learn more about making credentialed requests with cookies [here](https://kit.svelte.dev/docs/load#cookies)
		 */
		fetch: typeof fetch;
		/**
		 * Contains the data returned by the route's server `load` function (in `+layout.server.js` or `+page.server.js`), if any.
		 */
		data: Data;
		/**
		 * If you need to set headers for the response, you can do so using the this method. This is useful if you want the page to be cached, for example:
		 *
		 *	```js
		 *	/// file: src/routes/blog/+page.js
		 *	export async function load({ fetch, setHeaders }) {
		 *		const url = `https://cms.example.com/articles.json`;
		 *		const response = await fetch(url);
		 *
		 *		setHeaders({
		 *			age: response.headers.get('age'),
		 *			'cache-control': response.headers.get('cache-control')
		 *		});
		 *
		 *		return response.json();
		 *	}
		 *	```
		 *
		 * Setting the same header multiple times (even in separate `load` functions) is an error — you can only set a given header once.
		 *
		 * You cannot add a `set-cookie` header with `setHeaders` — use the [`cookies`](https://kit.svelte.dev/docs/types#public-types-cookies) API in a server-only `load` function instead.
		 *
		 * `setHeaders` has no effect when a `load` function runs in the browser.
		 */
		setHeaders(headers: Record<string, string>): void;
		/**
		 * `await parent()` returns data from parent `+layout.js` `load` functions.
		 * Implicitly, a missing `+layout.js` is treated as a `({ data }) => data` function, meaning that it will return and forward data from parent `+layout.server.js` files.
		 *
		 * Be careful not to introduce accidental waterfalls when using `await parent()`. If for example you only want to merge parent data into the returned output, call it _after_ fetching your other data.
		 */
		parent(): Promise<ParentData>;
		/**
		 * This function declares that the `load` function has a _dependency_ on one or more URLs or custom identifiers, which can subsequently be used with [`invalidate()`](/docs/modules#$app-navigation-invalidate) to cause `load` to rerun.
		 *
		 * Most of the time you won't need this, as `fetch` calls `depends` on your behalf — it's only necessary if you're using a custom API client that bypasses `fetch`.
		 *
		 * URLs can be absolute or relative to the page being loaded, and must be [encoded](https://developer.mozilla.org/en-US/docs/Glossary/percent-encoding).
		 *
		 * Custom identifiers have to be prefixed with one or more lowercase letters followed by a colon to conform to the [URI specification](https://www.rfc-editor.org/rfc/rfc3986.html).
		 *
		 * The following example shows how to use `depends` to register a dependency on a custom identifier, which is `invalidate`d after a button click, making the `load` function rerun.
		 *
		 * ```js
		 * /// file: src/routes/+page.js
		 * let count = 0;
		 * export async function load({ depends }) {
		 * 	depends('increase:count');
		 *
		 * 	return { count: count++ };
		 * }
		 * ```
		 *
		 * ```html
		 * /// file: src/routes/+page.svelte
		 * <script>
		 * 	import { invalidate } from '$app/navigation';
		 *
		 * 	export let data;
		 *
		 * 	const increase = async () => {
		 * 		await invalidate('increase:count');
		 * 	}
		 * </script>
		 *
		 * <p>{data.count}<p>
		 * <button on:click={increase}>Increase Count</button>
		 * ```
		 */
		depends(...deps: Array<`${string}:${string}`>): void;
		/**
		 * Use this function to opt out of dependency tracking for everything that is synchronously called within the callback. Example:
		 *
		 * ```js
		 * /// file: src/routes/+page.server.js
		 * export async function load({ untrack, url }) {
		 * 	// Untrack url.pathname so that path changes don't trigger a rerun
		 * 	if (untrack(() => url.pathname === '/')) {
		 * 		return { message: 'Welcome!' };
		 * 	}
		 * }
		 * ```
		 */
		untrack<T>(fn: () => T): T;
	}

	export interface NavigationEvent<
		Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
		RouteId extends string | null = string | null
	> {
		/**
		 * The parameters of the current page - e.g. for a route like `/blog/[slug]`, a `{ slug: string }` object
		 */
		params: Params;
		/**
		 * Info about the current route
		 */
		route: {
			/**
			 * The ID of the current route - e.g. for `src/routes/blog/[slug]`, it would be `/blog/[slug]`
			 */
			id: RouteId;
		};
		/**
		 * The URL of the current page
		 */
		url: URL;
	}

	/**
	 * Information about the target of a specific navigation.
	 */
	export interface NavigationTarget {
		/**
		 * Parameters of the target page - e.g. for a route like `/blog/[slug]`, a `{ slug: string }` object.
		 * Is `null` if the target is not part of the SvelteKit app (could not be resolved to a route).
		 */
		params: Record<string, string> | null;
		/**
		 * Info about the target route
		 */
		route: { id: string | null };
		/**
		 * The URL that is navigated to
		 */
		url: URL;
	}

	/**
	 * - `enter`: The app has hydrated
	 * - `form`: The user submitted a `<form>` with a GET method
	 * - `leave`: The user is leaving the app by closing the tab or using the back/forward buttons to go to a different document
	 * - `link`: Navigation was triggered by a link click
	 * - `goto`: Navigation was triggered by a `goto(...)` call or a redirect
	 * - `popstate`: Navigation was triggered by back/forward navigation
	 */
	export type NavigationType = 'enter' | 'form' | 'leave' | 'link' | 'goto' | 'popstate';

	export interface Navigation {
		/**
		 * Where navigation was triggered from
		 */
		from: NavigationTarget | null;
		/**
		 * Where navigation is going to/has gone to
		 */
		to: NavigationTarget | null;
		/**
		 * The type of navigation:
		 * - `form`: The user submitted a `<form>`
		 * - `leave`: The app is being left either because the tab is being closed or a navigation to a different document is occurring
		 * - `link`: Navigation was triggered by a link click
		 * - `goto`: Navigation was triggered by a `goto(...)` call or a redirect
		 * - `popstate`: Navigation was triggered by back/forward navigation
		 */
		type: Exclude<NavigationType, 'enter'>;
		/**
		 * Whether or not the navigation will result in the page being unloaded (i.e. not a client-side navigation)
		 */
		willUnload: boolean;
		/**
		 * In case of a history back/forward navigation, the number of steps to go back/forward
		 */
		delta?: number;
		/**
		 * A promise that resolves once the navigation is complete, and rejects if the navigation
		 * fails or is aborted. In the case of a `willUnload` navigation, the promise will never resolve
		 */
		complete: Promise<void>;
	}

	/**
	 * The argument passed to [`beforeNavigate`](https://kit.svelte.dev/docs/modules#$app-navigation-beforenavigate) callbacks.
	 */
	export interface BeforeNavigate extends Navigation {
		/**
		 * Call this to prevent the navigation from starting.
		 */
		cancel(): void;
	}

	/**
	 * The argument passed to [`onNavigate`](https://kit.svelte.dev/docs/modules#$app-navigation-onnavigate) callbacks.
	 */
	export interface OnNavigate extends Navigation {
		/**
		 * The type of navigation:
		 * - `form`: The user submitted a `<form>`
		 * - `link`: Navigation was triggered by a link click
		 * - `goto`: Navigation was triggered by a `goto(...)` call or a redirect
		 * - `popstate`: Navigation was triggered by back/forward navigation
		 */
		type: Exclude<NavigationType, 'enter' | 'leave'>;
		/**
		 * Since `onNavigate` callbacks are called immediately before a client-side navigation, they will never be called with a navigation that unloads the page.
		 */
		willUnload: false;
	}

	/**
	 * The argument passed to [`afterNavigate`](https://kit.svelte.dev/docs/modules#$app-navigation-afternavigate) callbacks.
	 */
	export interface AfterNavigate extends Omit<Navigation, 'type'> {
		/**
		 * The type of navigation:
		 * - `enter`: The app has hydrated
		 * - `form`: The user submitted a `<form>`
		 * - `link`: Navigation was triggered by a link click
		 * - `goto`: Navigation was triggered by a `goto(...)` call or a redirect
		 * - `popstate`: Navigation was triggered by back/forward navigation
		 */
		type: Exclude<NavigationType, 'leave'>;
		/**
		 * Since `afterNavigate` callbacks are called after a navigation completes, they will never be called with a navigation that unloads the page.
		 */
		willUnload: false;
	}

	/**
	 * The shape of the `$page` store
	 */
	export interface Page<
		Params extends Record<string, string> = Record<string, string>,
		RouteId extends string | null = string | null
	> {
		/**
		 * The URL of the current page
		 */
		url: URL;
		/**
		 * The parameters of the current page - e.g. for a route like `/blog/[slug]`, a `{ slug: string }` object
		 */
		params: Params;
		/**
		 * Info about the current route
		 */
		route: {
			/**
			 * The ID of the current route - e.g. for `src/routes/blog/[slug]`, it would be `/blog/[slug]`
			 */
			id: RouteId;
		};
		/**
		 * Http status code of the current page
		 */
		status: number;
		/**
		 * The error object of the current page, if any. Filled from the `handleError` hooks.
		 */
		error: App.Error | null;
		/**
		 * The merged result of all data from all `load` functions on the current page. You can type a common denominator through `App.PageData`.
		 */
		data: App.PageData & Record<string, any>;
		/**
		 * The page state, which can be manipulated using the [`pushState`](https://kit.svelte.dev/docs/modules#$app-navigation-pushstate) and [`replaceState`](https://kit.svelte.dev/docs/modules#$app-navigation-replacestate) functions from `$app/navigation`.
		 */
		state: App.PageState;
		/**
		 * Filled only after a form submission. See [form actions](https://kit.svelte.dev/docs/form-actions) for more info.
		 */
		form: any;
	}

	/**
	 * The shape of a param matcher. See [matching](https://kit.svelte.dev/docs/advanced-routing#matching) for more info.
	 */
	export type ParamMatcher = (param: string) => boolean;

	export interface RequestEvent<
		Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
		RouteId extends string | null = string | null
	> {
		/**
		 * Get or set cookies related to the current request
		 */
		cookies: Cookies;
		/**
		 * `fetch` is equivalent to the [native `fetch` web API](https://developer.mozilla.org/en-US/docs/Web/API/fetch), with a few additional features:
		 *
		 * - It can be used to make credentialed requests on the server, as it inherits the `cookie` and `authorization` headers for the page request.
		 * - It can make relative requests on the server (ordinarily, `fetch` requires a URL with an origin when used in a server context).
		 * - Internal requests (e.g. for `+server.js` routes) go directly to the handler function when running on the server, without the overhead of an HTTP call.
		 * - During server-side rendering, the response will be captured and inlined into the rendered HTML by hooking into the `text` and `json` methods of the `Response` object. Note that headers will _not_ be serialized, unless explicitly included via [`filterSerializedResponseHeaders`](https://kit.svelte.dev/docs/hooks#server-hooks-handle)
		 * - During hydration, the response will be read from the HTML, guaranteeing consistency and preventing an additional network request.
		 *
		 * You can learn more about making credentialed requests with cookies [here](https://kit.svelte.dev/docs/load#cookies)
		 */
		fetch: typeof fetch;
		/**
		 * The client's IP address, set by the adapter.
		 */
		getClientAddress(): string;
		/**
		 * Contains custom data that was added to the request within the [`handle hook`](https://kit.svelte.dev/docs/hooks#server-hooks-handle).
		 */
		locals: App.Locals;
		/**
		 * The parameters of the current route - e.g. for a route like `/blog/[slug]`, a `{ slug: string }` object
		 */
		params: Params;
		/**
		 * Additional data made available through the adapter.
		 */
		platform: Readonly<App.Platform> | undefined;
		/**
		 * The original request object
		 */
		request: Request;
		/**
		 * Info about the current route
		 */
		route: {
			/**
			 * The ID of the current route - e.g. for `src/routes/blog/[slug]`, it would be `/blog/[slug]`
			 */
			id: RouteId;
		};
		/**
		 * If you need to set headers for the response, you can do so using the this method. This is useful if you want the page to be cached, for example:
		 *
		 *	```js
		 *	/// file: src/routes/blog/+page.js
		 *	export async function load({ fetch, setHeaders }) {
		 *		const url = `https://cms.example.com/articles.json`;
		 *		const response = await fetch(url);
		 *
		 *		setHeaders({
		 *			age: response.headers.get('age'),
		 *			'cache-control': response.headers.get('cache-control')
		 *		});
		 *
		 *		return response.json();
		 *	}
		 *	```
		 *
		 * Setting the same header multiple times (even in separate `load` functions) is an error — you can only set a given header once.
		 *
		 * You cannot add a `set-cookie` header with `setHeaders` — use the [`cookies`](https://kit.svelte.dev/docs/types#public-types-cookies) API instead.
		 */
		setHeaders(headers: Record<string, string>): void;
		/**
		 * The requested URL.
		 */
		url: URL;
		/**
		 * `true` if the request comes from the client asking for `+page/layout.server.js` data. The `url` property will be stripped of the internal information
		 * related to the data request in this case. Use this property instead if the distinction is important to you.
		 */
		isDataRequest: boolean;
		/**
		 * `true` for `+server.js` calls coming from SvelteKit without the overhead of actually making an HTTP request. This happens when you make same-origin `fetch` requests on the server.
		 */
		isSubRequest: boolean;
	}

	/**
	 * A `(event: RequestEvent) => Response` function exported from a `+server.js` file that corresponds to an HTTP verb (`GET`, `PUT`, `PATCH`, etc) and handles requests with that method.
	 *
	 * It receives `Params` as the first generic argument, which you can skip by using [generated types](https://kit.svelte.dev/docs/types#generated-types) instead.
	 */
	export type RequestHandler<
		Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
		RouteId extends string | null = string | null
	> = (event: RequestEvent<Params, RouteId>) => MaybePromise<Response>;

	export interface ResolveOptions {
		/**
		 * Applies custom transforms to HTML. If `done` is true, it's the final chunk. Chunks are not guaranteed to be well-formed HTML
		 * (they could include an element's opening tag but not its closing tag, for example)
		 * but they will always be split at sensible boundaries such as `%sveltekit.head%` or layout/page components.
		 * @param input the html chunk and the info if this is the last chunk
		 */
		transformPageChunk?(input: { html: string; done: boolean }): MaybePromise<string | undefined>;
		/**
		 * Determines which headers should be included in serialized responses when a `load` function loads a resource with `fetch`.
		 * By default, none will be included.
		 * @param name header name
		 * @param value header value
		 */
		filterSerializedResponseHeaders?(name: string, value: string): boolean;
		/**
		 * Determines what should be added to the `<head>` tag to preload it.
		 * By default, `js` and `css` files will be preloaded.
		 * @param input the type of the file and its path
		 */
		preload?(input: { type: 'font' | 'css' | 'js' | 'asset'; path: string }): boolean;
	}

	export interface RouteDefinition<Config = any> {
		id: string;
		api: {
			methods: Array<HttpMethod | '*'>;
		};
		page: {
			methods: Array<Extract<HttpMethod, 'GET' | 'POST'>>;
		};
		pattern: RegExp;
		prerender: PrerenderOption;
		segments: RouteSegment[];
		methods: Array<HttpMethod | '*'>;
		config: Config;
	}

	export class Server {
		constructor(manifest: SSRManifest);
		init(options: ServerInitOptions): Promise<void>;
		respond(request: Request, options: RequestOptions): Promise<Response>;
	}

	export interface ServerInitOptions {
		/** A map of environment variables */
		env: Record<string, string>;
		/** A function that turns an asset filename into a `ReadableStream`. Required for the `read` export from `$app/server` to work */
		read?: (file: string) => ReadableStream;
	}

	export interface SSRManifest {
		appDir: string;
		appPath: string;
		assets: Set<string>;
		mimeTypes: Record<string, string>;

		/** private fields */
		_: {
			client: NonNullable<BuildData['client']>;
			nodes: SSRNodeLoader[];
			routes: SSRRoute[];
			matchers(): Promise<Record<string, ParamMatcher>>;
			/** A `[file]: size` map of all assets imported by server code */
			server_assets: Record<string, number>;
		};
	}

	/**
	 * The generic form of `PageServerLoad` and `LayoutServerLoad`. You should import those from `./$types` (see [generated types](https://kit.svelte.dev/docs/types#generated-types))
	 * rather than using `ServerLoad` directly.
	 */
	export type ServerLoad<
		Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
		ParentData extends Record<string, any> = Record<string, any>,
		OutputData extends Record<string, any> | void = Record<string, any> | void,
		RouteId extends string | null = string | null
	> = (event: ServerLoadEvent<Params, ParentData, RouteId>) => MaybePromise<OutputData>;

	export interface ServerLoadEvent<
		Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
		ParentData extends Record<string, any> = Record<string, any>,
		RouteId extends string | null = string | null
	> extends RequestEvent<Params, RouteId> {
		/**
		 * `await parent()` returns data from parent `+layout.server.js` `load` functions.
		 *
		 * Be careful not to introduce accidental waterfalls when using `await parent()`. If for example you only want to merge parent data into the returned output, call it _after_ fetching your other data.
		 */
		parent(): Promise<ParentData>;
		/**
		 * This function declares that the `load` function has a _dependency_ on one or more URLs or custom identifiers, which can subsequently be used with [`invalidate()`](/docs/modules#$app-navigation-invalidate) to cause `load` to rerun.
		 *
		 * Most of the time you won't need this, as `fetch` calls `depends` on your behalf — it's only necessary if you're using a custom API client that bypasses `fetch`.
		 *
		 * URLs can be absolute or relative to the page being loaded, and must be [encoded](https://developer.mozilla.org/en-US/docs/Glossary/percent-encoding).
		 *
		 * Custom identifiers have to be prefixed with one or more lowercase letters followed by a colon to conform to the [URI specification](https://www.rfc-editor.org/rfc/rfc3986.html).
		 *
		 * The following example shows how to use `depends` to register a dependency on a custom identifier, which is `invalidate`d after a button click, making the `load` function rerun.
		 *
		 * ```js
		 * /// file: src/routes/+page.js
		 * let count = 0;
		 * export async function load({ depends }) {
		 * 	depends('increase:count');
		 *
		 * 	return { count: count++ };
		 * }
		 * ```
		 *
		 * ```html
		 * /// file: src/routes/+page.svelte
		 * <script>
		 * 	import { invalidate } from '$app/navigation';
		 *
		 * 	export let data;
		 *
		 * 	const increase = async () => {
		 * 		await invalidate('increase:count');
		 * 	}
		 * </script>
		 *
		 * <p>{data.count}<p>
		 * <button on:click={increase}>Increase Count</button>
		 * ```
		 */
		depends(...deps: string[]): void;
		/**
		 * Use this function to opt out of dependency tracking for everything that is synchronously called within the callback. Example:
		 *
		 * ```js
		 * /// file: src/routes/+page.js
		 * export async function load({ untrack, url }) {
		 * 	// Untrack url.pathname so that path changes don't trigger a rerun
		 * 	if (untrack(() => url.pathname === '/')) {
		 * 		return { message: 'Welcome!' };
		 * 	}
		 * }
		 * ```
		 */
		untrack<T>(fn: () => T): T;
	}

	/**
	 * Shape of a form action method that is part of `export const actions = {..}` in `+page.server.js`.
	 * See [form actions](https://kit.svelte.dev/docs/form-actions) for more information.
	 */
	export type Action<
		Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
		OutputData extends Record<string, any> | void = Record<string, any> | void,
		RouteId extends string | null = string | null
	> = (event: RequestEvent<Params, RouteId>) => MaybePromise<OutputData>;

	/**
	 * Shape of the `export const actions = {..}` object in `+page.server.js`.
	 * See [form actions](https://kit.svelte.dev/docs/form-actions) for more information.
	 */
	export type Actions<
		Params extends Partial<Record<string, string>> = Partial<Record<string, string>>,
		OutputData extends Record<string, any> | void = Record<string, any> | void,
		RouteId extends string | null = string | null
	> = Record<string, Action<Params, OutputData, RouteId>>;

	/**
	 * When calling a form action via fetch, the response will be one of these shapes.
	 * ```svelte
	 * <form method="post" use:enhance={() => {
	 *   return ({ result }) => {
	 * 		// result is of type ActionResult
	 *   };
	 * }}
	 * ```
	 */
	export type ActionResult<
		Success extends Record<string, unknown> | undefined = Record<string, any>,
		Failure extends Record<string, unknown> | undefined = Record<string, any>
	> =
		| { type: 'success'; status: number; data?: Success }
		| { type: 'failure'; status: number; data?: Failure }
		| { type: 'redirect'; status: number; location: string }
		| { type: 'error'; status?: number; error: any };

	/**
	 * The object returned by the [`error`](https://kit.svelte.dev/docs/modules#sveltejs-kit-error) function.
	 */
	export interface HttpError {
		/** The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses), in the range 400-599. */
		status: number;
		/** The content of the error. */
		body: App.Error;
	}

	/**
	 * The object returned by the [`redirect`](https://kit.svelte.dev/docs/modules#sveltejs-kit-redirect) function
	 */
	export interface Redirect {
		/** The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#redirection_messages), in the range 300-308. */
		status: 300 | 301 | 302 | 303 | 304 | 305 | 306 | 307 | 308;
		/** The location to redirect to. */
		location: string;
	}

	export type SubmitFunction<
		Success extends Record<string, unknown> | undefined = Record<string, any>,
		Failure extends Record<string, unknown> | undefined = Record<string, any>
	> = (input: {
		action: URL;
		formData: FormData;
		formElement: HTMLFormElement;
		controller: AbortController;
		submitter: HTMLElement | null;
		cancel(): void;
	}) => MaybePromise<
		| void
		| ((opts: {
				formData: FormData;
				formElement: HTMLFormElement;
				action: URL;
				result: ActionResult<Success, Failure>;
				/**
				 * Call this to get the default behavior of a form submission response.
				 * @param options Set `reset: false` if you don't want the `<form>` values to be reset after a successful submission.
				 * @param invalidateAll Set `invalidateAll: false` if you don't want the action to call `invalidateAll` after submission.
				 */
				update(options?: { reset?: boolean; invalidateAll?: boolean }): Promise<void>;
		  }) => void)
	>;

	/**
	 * The type of `export const snapshot` exported from a page or layout component.
	 */
	export interface Snapshot<T = any> {
		capture: () => T;
		restore: (snapshot: T) => void;
	}
	interface AdapterEntry {
		/**
		 * A string that uniquely identifies an HTTP service (e.g. serverless function) and is used for deduplication.
		 * For example, `/foo/a-[b]` and `/foo/[c]` are different routes, but would both
		 * be represented in a Netlify _redirects file as `/foo/:param`, so they share an ID
		 */
		id: string;

		/**
		 * A function that compares the candidate route with the current route to determine
		 * if it should be grouped with the current route.
		 *
		 * Use cases:
		 * - Fallback pages: `/foo/[c]` is a fallback for `/foo/a-[b]`, and `/[...catchall]` is a fallback for all routes
		 * - Grouping routes that share a common `config`: `/foo` should be deployed to the edge, `/bar` and `/baz` should be deployed to a serverless function
		 */
		filter(route: RouteDefinition): boolean;

		/**
		 * A function that is invoked once the entry has been created. This is where you
		 * should write the function to the filesystem and generate redirect manifests.
		 */
		complete(entry: { generateManifest(opts: { relativePath: string }): string }): MaybePromise<void>;
	}

	// Based on https://github.com/josh-hemphill/csp-typed-directives/blob/latest/src/csp.types.ts
	//
	// MIT License
	//
	// Copyright (c) 2021-present, Joshua Hemphill
	// Copyright (c) 2021, Tecnico Corporation
	//
	// Permission is hereby granted, free of charge, to any person obtaining a copy
	// of this software and associated documentation files (the "Software"), to deal
	// in the Software without restriction, including without limitation the rights
	// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	// copies of the Software, and to permit persons to whom the Software is
	// furnished to do so, subject to the following conditions:
	//
	// The above copyright notice and this permission notice shall be included in all
	// copies or substantial portions of the Software.
	//
	// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
	// SOFTWARE.

	namespace Csp {
		type ActionSource = 'strict-dynamic' | 'report-sample';
		type BaseSource =
			| 'self'
			| 'unsafe-eval'
			| 'unsafe-hashes'
			| 'unsafe-inline'
			| 'wasm-unsafe-eval'
			| 'none';
		type CryptoSource = `${'nonce' | 'sha256' | 'sha384' | 'sha512'}-${string}`;
		type FrameSource = HostSource | SchemeSource | 'self' | 'none';
		type HostNameScheme = `${string}.${string}` | 'localhost';
		type HostSource = `${HostProtocolSchemes}${HostNameScheme}${PortScheme}`;
		type HostProtocolSchemes = `${string}://` | '';
		type HttpDelineator = '/' | '?' | '#' | '\\';
		type PortScheme = `:${number}` | '' | ':*';
		type SchemeSource = 'http:' | 'https:' | 'data:' | 'mediastream:' | 'blob:' | 'filesystem:';
		type Source = HostSource | SchemeSource | CryptoSource | BaseSource;
		type Sources = Source[];
	}

	interface CspDirectives {
		'child-src'?: Csp.Sources;
		'default-src'?: Array<Csp.Source | Csp.ActionSource>;
		'frame-src'?: Csp.Sources;
		'worker-src'?: Csp.Sources;
		'connect-src'?: Csp.Sources;
		'font-src'?: Csp.Sources;
		'img-src'?: Csp.Sources;
		'manifest-src'?: Csp.Sources;
		'media-src'?: Csp.Sources;
		'object-src'?: Csp.Sources;
		'prefetch-src'?: Csp.Sources;
		'script-src'?: Array<Csp.Source | Csp.ActionSource>;
		'script-src-elem'?: Csp.Sources;
		'script-src-attr'?: Csp.Sources;
		'style-src'?: Array<Csp.Source | Csp.ActionSource>;
		'style-src-elem'?: Csp.Sources;
		'style-src-attr'?: Csp.Sources;
		'base-uri'?: Array<Csp.Source | Csp.ActionSource>;
		sandbox?: Array<
			| 'allow-downloads-without-user-activation'
			| 'allow-forms'
			| 'allow-modals'
			| 'allow-orientation-lock'
			| 'allow-pointer-lock'
			| 'allow-popups'
			| 'allow-popups-to-escape-sandbox'
			| 'allow-presentation'
			| 'allow-same-origin'
			| 'allow-scripts'
			| 'allow-storage-access-by-user-activation'
			| 'allow-top-navigation'
			| 'allow-top-navigation-by-user-activation'
		>;
		'form-action'?: Array<Csp.Source | Csp.ActionSource>;
		'frame-ancestors'?: Array<Csp.HostSource | Csp.SchemeSource | Csp.FrameSource>;
		'navigate-to'?: Array<Csp.Source | Csp.ActionSource>;
		'report-uri'?: string[];
		'report-to'?: string[];

		'require-trusted-types-for'?: Array<'script'>;
		'trusted-types'?: Array<'none' | 'allow-duplicates' | '*' | string>;
		'upgrade-insecure-requests'?: boolean;

		/** @deprecated */
		'require-sri-for'?: Array<'script' | 'style' | 'script style'>;

		/** @deprecated */
		'block-all-mixed-content'?: boolean;

		/** @deprecated */
		'plugin-types'?: Array<`${string}/${string}` | 'none'>;

		/** @deprecated */
		referrer?: Array<
			| 'no-referrer'
			| 'no-referrer-when-downgrade'
			| 'origin'
			| 'origin-when-cross-origin'
			| 'same-origin'
			| 'strict-origin'
			| 'strict-origin-when-cross-origin'
			| 'unsafe-url'
			| 'none'
		>;
	}

	type HttpMethod = 'GET' | 'HEAD' | 'POST' | 'PUT' | 'DELETE' | 'PATCH' | 'OPTIONS';

	interface Logger {
		(msg: string): void;
		success(msg: string): void;
		error(msg: string): void;
		warn(msg: string): void;
		minor(msg: string): void;
		info(msg: string): void;
	}

	type MaybePromise<T> = T | Promise<T>;

	interface Prerendered {
		/**
		 * A map of `path` to `{ file }` objects, where a path like `/foo` corresponds to `foo.html` and a path like `/bar/` corresponds to `bar/index.html`.
		 */
		pages: Map<
			string,
			{
				/** The location of the .html file relative to the output directory */
				file: string;
			}
		>;
		/**
		 * A map of `path` to `{ type }` objects.
		 */
		assets: Map<
			string,
			{
				/** The MIME type of the asset */
				type: string;
			}
		>;
		/**
		 * A map of redirects encountered during prerendering.
		 */
		redirects: Map<
			string,
			{
				status: number;
				location: string;
			}
		>;
		/** An array of prerendered paths (without trailing slashes, regardless of the trailingSlash config) */
		paths: string[];
	}

	interface PrerenderHttpErrorHandler {
		(details: {
			status: number;
			path: string;
			referrer: string | null;
			referenceType: 'linked' | 'fetched';
			message: string;
		}): void;
	}

	interface PrerenderMissingIdHandler {
		(details: { path: string; id: string; referrers: string[]; message: string }): void;
	}

	interface PrerenderEntryGeneratorMismatchHandler {
		(details: { generatedFromId: string; entry: string; matchedId: string; message: string }): void;
	}

	type PrerenderHttpErrorHandlerValue = 'fail' | 'warn' | 'ignore' | PrerenderHttpErrorHandler;
	type PrerenderMissingIdHandlerValue = 'fail' | 'warn' | 'ignore' | PrerenderMissingIdHandler;
	type PrerenderEntryGeneratorMismatchHandlerValue =
		| 'fail'
		| 'warn'
		| 'ignore'
		| PrerenderEntryGeneratorMismatchHandler;

	export type PrerenderOption = boolean | 'auto';

	interface RequestOptions {
		getClientAddress(): string;
		platform?: App.Platform;
	}

	interface RouteSegment {
		content: string;
		dynamic: boolean;
		rest: boolean;
	}

	type TrailingSlash = 'never' | 'always' | 'ignore';
	interface Asset {
		file: string;
		size: number;
		type: string | null;
	}

	interface BuildData {
		app_dir: string;
		app_path: string;
		manifest_data: ManifestData;
		out_dir: string;
		service_worker: string | null;
		client: {
			start: string;
			app: string;
			imports: string[];
			stylesheets: string[];
			fonts: string[];
			uses_env_dynamic_public: boolean;
		} | null;
		server_manifest: import('vite').Manifest;
	}

	interface ManifestData {
		assets: Asset[];
		hooks: {
			client: string | null;
			server: string | null;
			universal: string | null;
		};
		nodes: PageNode[];
		routes: RouteData[];
		matchers: Record<string, string>;
	}

	interface PageNode {
		depth: number;
		component?: string; // TODO supply default component if it's missing (bit of an edge case)
		universal?: string;
		server?: string;
		parent_id?: string;
		parent?: PageNode;
		/**
		 * Filled with the pages that reference this layout (if this is a layout)
		 */
		child_pages?: PageNode[];
	}

	type RecursiveRequired<T> = {
		// Recursive implementation of TypeScript's Required utility type.
		// Will recursively continue until it reaches a primitive or Function
		[K in keyof T]-?: Extract<T[K], Function> extends never // If it does not have a Function type
			? RecursiveRequired<T[K]> // recursively continue through.
			: T[K]; // Use the exact type for everything else
	};

	interface RouteParam {
		name: string;
		matcher: string;
		optional: boolean;
		rest: boolean;
		chained: boolean;
	}

	/**
	 * Represents a route segment in the app. It can either be an intermediate node
	 * with only layout/error pages, or a leaf, at which point either `page` and `leaf`
	 * or `endpoint` is set.
	 */
	interface RouteData {
		id: string;
		parent: RouteData | null;

		segment: string;
		pattern: RegExp;
		params: RouteParam[];

		layout: PageNode | null;
		error: PageNode | null;
		leaf: PageNode | null;

		page: {
			layouts: Array<number | undefined>;
			errors: Array<number | undefined>;
			leaf: number;
		} | null;

		endpoint: {
			file: string;
		} | null;
	}

	interface SSRComponent {
		default: {
			render(props: Record<string, any>): {
				html: string;
				head: string;
				css: {
					code: string;
					map: any; // TODO
				};
			};
		};
	}

	type SSRComponentLoader = () => Promise<SSRComponent>;

	interface SSRNode {
		component: SSRComponentLoader;
		/** index into the `components` array in client/manifest.js */
		index: number;
		/** external JS files */
		imports: string[];
		/** external CSS files */
		stylesheets: string[];
		/** external font files */
		fonts: string[];
		/** inlined styles */
		inline_styles?(): MaybePromise<Record<string, string>>;

		universal: {
			load?: Load;
			prerender?: PrerenderOption;
			ssr?: boolean;
			csr?: boolean;
			trailingSlash?: TrailingSlash;
			config?: any;
			entries?: PrerenderEntryGenerator;
		};

		server: {
			load?: ServerLoad;
			prerender?: PrerenderOption;
			ssr?: boolean;
			csr?: boolean;
			trailingSlash?: TrailingSlash;
			actions?: Actions;
			config?: any;
			entries?: PrerenderEntryGenerator;
		};

		universal_id: string;
		server_id: string;
	}

	type SSRNodeLoader = () => Promise<SSRNode>;

	interface PageNodeIndexes {
		errors: Array<number | undefined>;
		layouts: Array<number | undefined>;
		leaf: number;
	}

	type PrerenderEntryGenerator = () => MaybePromise<Array<Record<string, string>>>;

	type SSREndpoint = Partial<Record<HttpMethod, RequestHandler>> & {
		prerender?: PrerenderOption;
		trailingSlash?: TrailingSlash;
		config?: any;
		entries?: PrerenderEntryGenerator;
		fallback?: RequestHandler;
	};

	interface SSRRoute {
		id: string;
		pattern: RegExp;
		params: RouteParam[];
		page: PageNodeIndexes | null;
		endpoint: (() => Promise<SSREndpoint>) | null;
		endpoint_id?: string;
	}

	type ValidatedConfig = Config & {
		kit: ValidatedKitConfig;
		extensions: string[];
	};

	type ValidatedKitConfig = Omit<RecursiveRequired<KitConfig>, 'adapter'> & {
		adapter?: Adapter;
	};
	/**
	 * Throws an error with a HTTP status code and an optional message.
	 * When called during request handling, this will cause SvelteKit to
	 * return an error response without invoking `handleError`.
	 * Make sure you're not catching the thrown error, which would prevent SvelteKit from handling it.
	 * @param status The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses). Must be in the range 400-599.
	 * @param body An object that conforms to the App.Error type. If a string is passed, it will be used as the message property.
	 * @throws {HttpError} This error instructs SvelteKit to initiate HTTP error handling.
	 * @throws {Error} If the provided status is invalid (not between 400 and 599).
	 */
	export function error(status: number, body: App.Error): never;
	/**
	 * Throws an error with a HTTP status code and an optional message.
	 * When called during request handling, this will cause SvelteKit to
	 * return an error response without invoking `handleError`.
	 * Make sure you're not catching the thrown error, which would prevent SvelteKit from handling it.
	 * @param status The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses). Must be in the range 400-599.
	 * @param body An object that conforms to the App.Error type. If a string is passed, it will be used as the message property.
	 * @throws {HttpError} This error instructs SvelteKit to initiate HTTP error handling.
	 * @throws {Error} If the provided status is invalid (not between 400 and 599).
	 */
	export function error(status: number, body?: {
		message: string;
	} extends App.Error ? App.Error | string | undefined : never): never;
	/**
	 * Checks whether this is an error thrown by {@link error}.
	 * @param status The status to filter for.
	 * */
	export function isHttpError<T extends number>(e: unknown, status?: T | undefined): e is HttpError_1 & {
		status: T extends undefined ? never : T;
	};
	/**
	 * Redirect a request. When called during request handling, SvelteKit will return a redirect response.
	 * Make sure you're not catching the thrown redirect, which would prevent SvelteKit from handling it.
	 * @param status The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#redirection_messages). Must be in the range 300-308.
	 * @param location The location to redirect to.
	 * @throws {Redirect} This error instructs SvelteKit to redirect to the specified location.
	 * @throws {Error} If the provided status is invalid.
	 * */
	export function redirect(status: 300 | 301 | 302 | 303 | 304 | 305 | 306 | 307 | 308 | ({} & number), location: string | URL): never;
	/**
	 * Checks whether this is a redirect thrown by {@link redirect}.
	 * @param e The object to check.
	 * */
	export function isRedirect(e: unknown): e is Redirect_1;
	/**
	 * Create a JSON `Response` object from the supplied data.
	 * @param data The value that will be serialized as JSON.
	 * @param init Options such as `status` and `headers` that will be added to the response. `Content-Type: application/json` and `Content-Length` headers will be added automatically.
	 */
	export function json(data: any, init?: ResponseInit | undefined): Response;
	/**
	 * Create a `Response` object from the supplied body.
	 * @param body The value that will be used as-is.
	 * @param init Options such as `status` and `headers` that will be added to the response. A `Content-Length` header will be added automatically.
	 */
	export function text(body: string, init?: ResponseInit | undefined): Response;
	/**
	 * Create an `ActionFailure` object.
	 * @param status The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses). Must be in the range 400-599.
	 * */
	export function fail(status: number): ActionFailure<undefined>;
	/**
	 * Create an `ActionFailure` object.
	 * @param status The [HTTP status code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses). Must be in the range 400-599.
	 * @param data Data associated with the failure (e.g. validation errors)
	 * */
	export function fail<T extends Record<string, unknown> | undefined = undefined>(status: number, data: T): ActionFailure<T>;
	export type LessThan<TNumber extends number, TArray extends any[] = []> = TNumber extends TArray['length'] ? TArray[number] : LessThan<TNumber, [...TArray, TArray['length']]>;
	export type NumericRange<TStart extends number, TEnd extends number> = Exclude<TEnd | LessThan<TEnd>, LessThan<TStart>>;
	export const VERSION: string;
	class HttpError_1 {
		
		constructor(status: number, body: {
			message: string;
		} extends App.Error ? (App.Error | string | undefined) : App.Error);
		status: number;
		body: App.Error;
		toString(): string;
	}
	class Redirect_1 {
		
		constructor(status: 300 | 301 | 302 | 303 | 304 | 305 | 306 | 307 | 308, location: string);
		status: 301 | 302 | 303 | 307 | 308 | 300 | 304 | 305 | 306;
		location: string;
	}
}

declare module '@sveltejs/kit/hooks' {
	/**
	 * A helper function for sequencing multiple `handle` calls in a middleware-like manner.
	 * The behavior for the `handle` options is as follows:
	 * - `transformPageChunk` is applied in reverse order and merged
	 * - `preload` is applied in forward order, the first option "wins" and no `preload` options after it are called
	 * - `filterSerializedResponseHeaders` behaves the same as `preload`
	 *
	 * ```js
	 * /// file: src/hooks.server.js
	 * import { sequence } from '@sveltejs/kit/hooks';
	 *
	 * /// type: import('@sveltejs/kit').Handle
	 * async function first({ event, resolve }) {
	 * 	console.log('first pre-processing');
	 * 	const result = await resolve(event, {
	 * 		transformPageChunk: ({ html }) => {
	 * 			// transforms are applied in reverse order
	 * 			console.log('first transform');
	 * 			return html;
	 * 		},
	 * 		preload: () => {
	 * 			// this one wins as it's the first defined in the chain
	 * 			console.log('first preload');
	 * 		}
	 * 	});
	 * 	console.log('first post-processing');
	 * 	return result;
	 * }
	 *
	 * /// type: import('@sveltejs/kit').Handle
	 * async function second({ event, resolve }) {
	 * 	console.log('second pre-processing');
	 * 	const result = await resolve(event, {
	 * 		transformPageChunk: ({ html }) => {
	 * 			console.log('second transform');
	 * 			return html;
	 * 		},
	 * 		preload: () => {
	 * 			console.log('second preload');
	 * 		},
	 * 		filterSerializedResponseHeaders: () => {
	 * 			// this one wins as it's the first defined in the chain
	 *    		console.log('second filterSerializedResponseHeaders');
	 * 		}
	 * 	});
	 * 	console.log('second post-processing');
	 * 	return result;
	 * }
	 *
	 * export const handle = sequence(first, second);
	 * ```
	 *
	 * The example above would print:
	 *
	 * ```
	 * first pre-processing
	 * first preload
	 * second pre-processing
	 * second filterSerializedResponseHeaders
	 * second transform
	 * first transform
	 * second post-processing
	 * first post-processing
	 * ```
	 *
	 * @param handlers The chain of `handle` functions
	 * */
	export function sequence(...handlers: import('@sveltejs/kit').Handle[]): import('@sveltejs/kit').Handle;
}

declare module '@sveltejs/kit/node' {
	export function getRequest({ request, base, bodySizeLimit }: {
		request: import('http').IncomingMessage;
		base: string;
		bodySizeLimit?: number;
	}): Promise<Request>;

	export function setResponse(res: import('http').ServerResponse, response: Response): Promise<void>;
	/**
	 * Converts a file on disk to a readable stream
	 * @since 2.4.0
	 */
	export function createReadableStream(file: string): ReadableStream;
}

declare module '@sveltejs/kit/node/polyfills' {
	/**
	 * Make various web APIs available as globals:
	 * - `crypto`
	 * - `File`
	 */
	export function installPolyfills(): void;
}

declare module '@sveltejs/kit/vite' {
	/**
	 * Returns the SvelteKit Vite plugins.
	 * */
	export function sveltekit(): Promise<import('vite').Plugin[]>;
}

declare module '$app/environment' {
	/**
	 * `true` if the app is running in the browser.
	 */
	export const browser: boolean;

	/**
	 * Whether the dev server is running. This is not guaranteed to correspond to `NODE_ENV` or `MODE`.
	 */
	export const dev: boolean;

	/**
	 * SvelteKit analyses your app during the `build` step by running it. During this process, `building` is `true`. This also applies during prerendering.
	 */
	export const building: boolean;

	/**
	 * The value of `config.kit.version.name`.
	 */
	export const version: string;
}

declare module '$app/forms' {
	/**
	 * Use this function to deserialize the response from a form submission.
	 * Usage:
	 *
	 * ```js
	 * import { deserialize } from '$app/forms';
	 *
	 * async function handleSubmit(event) {
	 *   const response = await fetch('/form?/action', {
	 *     method: 'POST',
	 *     body: new FormData(event.target)
	 *   });
	 *
	 *   const result = deserialize(await response.text());
	 *   // ...
	 * }
	 * ```
	 * */
	export function deserialize<Success extends Record<string, unknown> | undefined, Failure extends Record<string, unknown> | undefined>(result: string): import("@sveltejs/kit").ActionResult<Success, Failure>;
	/**
	 * This action enhances a `<form>` element that otherwise would work without JavaScript.
	 *
	 * The `submit` function is called upon submission with the given FormData and the `action` that should be triggered.
	 * If `cancel` is called, the form will not be submitted.
	 * You can use the abort `controller` to cancel the submission in case another one starts.
	 * If a function is returned, that function is called with the response from the server.
	 * If nothing is returned, the fallback will be used.
	 *
	 * If this function or its return value isn't set, it
	 * - falls back to updating the `form` prop with the returned data if the action is one same page as the form
	 * - updates `$page.status`
	 * - resets the `<form>` element and invalidates all data in case of successful submission with no redirect response
	 * - redirects in case of a redirect response
	 * - redirects to the nearest error page in case of an unexpected error
	 *
	 * If you provide a custom function with a callback and want to use the default behavior, invoke `update` in your callback.
	 * @param form_element The form element
	 * @param submit Submit callback
	 */
	export function enhance<Success extends Record<string, unknown> | undefined, Failure extends Record<string, unknown> | undefined>(form_element: HTMLFormElement, submit?: import("@sveltejs/kit").SubmitFunction<Success, Failure>): {
		destroy(): void;
	};
	/**
	 * This action updates the `form` property of the current page with the given data and updates `$page.status`.
	 * In case of an error, it redirects to the nearest error page.
	 * */
	export function applyAction<Success extends Record<string, unknown> | undefined, Failure extends Record<string, unknown> | undefined>(result: import("@sveltejs/kit").ActionResult<Success, Failure>): Promise<void>;
}

declare module '$app/navigation' {
	/**
	 * A lifecycle function that runs the supplied `callback` when the current component mounts, and also whenever we navigate to a new URL.
	 *
	 * `afterNavigate` must be called during a component initialization. It remains active as long as the component is mounted.
	 * */
	export function afterNavigate(callback: (navigation: import('@sveltejs/kit').AfterNavigate) => void): void;
	/**
	 * A navigation interceptor that triggers before we navigate to a new URL, whether by clicking a link, calling `goto(...)`, or using the browser back/forward controls.
	 *
	 * Calling `cancel()` will prevent the navigation from completing. If `navigation.type === 'leave'` — meaning the user is navigating away from the app (or closing the tab) — calling `cancel` will trigger the native browser unload confirmation dialog. In this case, the navigation may or may not be cancelled depending on the user's response.
	 *
	 * When a navigation isn't to a SvelteKit-owned route (and therefore controlled by SvelteKit's client-side router), `navigation.to.route.id` will be `null`.
	 *
	 * If the navigation will (if not cancelled) cause the document to unload — in other words `'leave'` navigations and `'link'` navigations where `navigation.to.route === null` — `navigation.willUnload` is `true`.
	 *
	 * `beforeNavigate` must be called during a component initialization. It remains active as long as the component is mounted.
	 * */
	export function beforeNavigate(callback: (navigation: import('@sveltejs/kit').BeforeNavigate) => void): void;
	/**
	 * A lifecycle function that runs the supplied `callback` immediately before we navigate to a new URL except during full-page navigations.
	 *
	 * If you return a `Promise`, SvelteKit will wait for it to resolve before completing the navigation. This allows you to — for example — use `document.startViewTransition`. Avoid promises that are slow to resolve, since navigation will appear stalled to the user.
	 *
	 * If a function (or a `Promise` that resolves to a function) is returned from the callback, it will be called once the DOM has updated.
	 *
	 * `onNavigate` must be called during a component initialization. It remains active as long as the component is mounted.
	 * */
	export function onNavigate(callback: (navigation: import('@sveltejs/kit').OnNavigate) => MaybePromise<(() => void) | void>): void;
	/**
	 * If called when the page is being updated following a navigation (in `onMount` or `afterNavigate` or an action, for example), this disables SvelteKit's built-in scroll handling.
	 * This is generally discouraged, since it breaks user expectations.
	 * */
	export function disableScrollHandling(): void;
	/**
	 * Returns a Promise that resolves when SvelteKit navigates (or fails to navigate, in which case the promise rejects) to the specified `url`.
	 * For external URLs, use `window.location = url` instead of calling `goto(url)`.
	 *
	 * @param url Where to navigate to. Note that if you've set [`config.kit.paths.base`](https://kit.svelte.dev/docs/configuration#paths) and the URL is root-relative, you need to prepend the base path if you want to navigate within the app.
	 * @param {Object} opts Options related to the navigation
	 * */
	export function goto(url: string | URL, opts?: {
		replaceState?: boolean | undefined;
		noScroll?: boolean | undefined;
		keepFocus?: boolean | undefined;
		invalidateAll?: boolean | undefined;
		state?: App.PageState | undefined;
	} | undefined): Promise<void>;
	/**
	 * Causes any `load` functions belonging to the currently active page to re-run if they depend on the `url` in question, via `fetch` or `depends`. Returns a `Promise` that resolves when the page is subsequently updated.
	 *
	 * If the argument is given as a `string` or `URL`, it must resolve to the same URL that was passed to `fetch` or `depends` (including query parameters).
	 * To create a custom identifier, use a string beginning with `[a-z]+:` (e.g. `custom:state`) — this is a valid URL.
	 *
	 * The `function` argument can be used define a custom predicate. It receives the full `URL` and causes `load` to rerun if `true` is returned.
	 * This can be useful if you want to invalidate based on a pattern instead of a exact match.
	 *
	 * ```ts
	 * // Example: Match '/path' regardless of the query parameters
	 * import { invalidate } from '$app/navigation';
	 *
	 * invalidate((url) => url.pathname === '/path');
	 * ```
	 * @param resource The invalidated URL
	 * */
	export function invalidate(resource: string | URL | ((url: URL) => boolean)): Promise<void>;
	/**
	 * Causes all `load` functions belonging to the currently active page to re-run. Returns a `Promise` that resolves when the page is subsequently updated.
	 * */
	export function invalidateAll(): Promise<void>;
	/**
	 * Programmatically preloads the given page, which means
	 *  1. ensuring that the code for the page is loaded, and
	 *  2. calling the page's load function with the appropriate options.
	 *
	 * This is the same behaviour that SvelteKit triggers when the user taps or mouses over an `<a>` element with `data-sveltekit-preload-data`.
	 * If the next navigation is to `href`, the values returned from load will be used, making navigation instantaneous.
	 * Returns a Promise that resolves with the result of running the new route's `load` functions once the preload is complete.
	 *
	 * @param href Page to preload
	 * */
	export function preloadData(href: string): Promise<{
		type: 'loaded';
		status: number;
		data: Record<string, any>;
	} | {
		type: 'redirect';
		location: string;
	}>;
	/**
	 * Programmatically imports the code for routes that haven't yet been fetched.
	 * Typically, you might call this to speed up subsequent navigation.
	 *
	 * You can specify routes by any matching pathname such as `/about` (to match `src/routes/about/+page.svelte`) or `/blog/*` (to match `src/routes/blog/[slug]/+page.svelte`).
	 *
	 * Unlike `preloadData`, this won't call `load` functions.
	 * Returns a Promise that resolves when the modules have been imported.
	 *
	 * */
	export function preloadCode(pathname: string): Promise<void>;
	/**
	 * Programmatically create a new history entry with the given `$page.state`. To use the current URL, you can pass `''` as the first argument. Used for [shallow routing](https://kit.svelte.dev/docs/shallow-routing).
	 *
	 * */
	export function pushState(url: string | URL, state: App.PageState): void;
	/**
	 * Programmatically replace the current history entry with the given `$page.state`. To use the current URL, you can pass `''` as the first argument. Used for [shallow routing](https://kit.svelte.dev/docs/shallow-routing).
	 *
	 * */
	export function replaceState(url: string | URL, state: App.PageState): void;
	type MaybePromise<T> = T | Promise<T>;
}

declare module '$app/paths' {
	/**
	 * A string that matches [`config.kit.paths.base`](https://kit.svelte.dev/docs/configuration#paths).
	 *
	 * Example usage: `<a href="{base}/your-page">Link</a>`
	 */
	export let base: '' | `/${string}`;

	/**
	 * An absolute path that matches [`config.kit.paths.assets`](https://kit.svelte.dev/docs/configuration#paths).
	 *
	 * > If a value for `config.kit.paths.assets` is specified, it will be replaced with `'/_svelte_kit_assets'` during `vite dev` or `vite preview`, since the assets don't yet live at their eventual URL.
	 */
	export let assets: '' | `https://${string}` | `http://${string}` | '/_svelte_kit_assets';

	/**
	 * Populate a route ID with params to resolve a pathname.
	 * @example
	 * ```js
	 * resolveRoute(
	 *   `/blog/[slug]/[...somethingElse]`,
	 *   {
	 *     slug: 'hello-world',
	 *     somethingElse: 'something/else'
	 *   }
	 * ); // `/blog/hello-world/something/else`
	 * ```
	 */
	export function resolveRoute(id: string, params: Record<string, string | undefined>): string;
}

declare module '$app/server' {
	/**
	 * Read the contents of an imported asset from the filesystem
	 * @example
	 * ```js
	 * import { read } from '$app/server';
	 * import somefile from './somefile.txt';
	 *
	 * const asset = read(somefile);
	 * const text = await asset.text();
	 * ```
	 * @since 2.4.0
	 */
	export function read(asset: string): Response;
}

declare module '$app/stores' {
	export function getStores(): {
		
		page: typeof page;
		
		navigating: typeof navigating;
		
		updated: typeof updated;
	};
	/**
	 * A readable store whose value contains page data.
	 *
	 * On the server, this store can only be subscribed to during component initialization. In the browser, it can be subscribed to at any time.
	 *
	 * */
	export const page: import('svelte/store').Readable<import('@sveltejs/kit').Page>;
	/**
	 * A readable store.
	 * When navigating starts, its value is a `Navigation` object with `from`, `to`, `type` and (if `type === 'popstate'`) `delta` properties.
	 * When navigating finishes, its value reverts to `null`.
	 *
	 * On the server, this store can only be subscribed to during component initialization. In the browser, it can be subscribed to at any time.
	 * */
	export const navigating: import('svelte/store').Readable<import('@sveltejs/kit').Navigation | null>;
	/**
	 * A readable store whose initial value is `false`. If [`version.pollInterval`](https://kit.svelte.dev/docs/configuration#version) is a non-zero value, SvelteKit will poll for new versions of the app and update the store value to `true` when it detects one. `updated.check()` will force an immediate check, regardless of polling.
	 *
	 * On the server, this store can only be subscribed to during component initialization. In the browser, it can be subscribed to at any time.
	 * */
	export const updated: import('svelte/store').Readable<boolean> & {
		check(): Promise<boolean>;
	};
}/**
 * It's possible to tell SvelteKit how to type objects inside your app by declaring the `App` namespace. By default, a new project will have a file called `src/app.d.ts` containing the following:
 *
 * ```ts
 * declare global {
 * 	namespace App {
 * 		// interface Error {}
 * 		// interface Locals {}
 * 		// interface PageData {}
 * 		// interface PageState {}
 * 		// interface Platform {}
 * 	}
 * }
 *
 * export {};
 * ```
 *
 * The `export {}` line exists because without it, the file would be treated as an _ambient module_ which prevents you from adding `import` declarations.
 * If you need to add ambient `declare module` declarations, do so in a separate file like `src/ambient.d.ts`.
 *
 * By populating these interfaces, you will gain type safety when using `event.locals`, `event.platform`, and `data` from `load` functions.
 */
declare namespace App {
	/**
	 * Defines the common shape of expected and unexpected errors. Expected errors are thrown using the `error` function. Unexpected errors are handled by the `handleError` hooks which should return this shape.
	 */
	export interface Error {
		message: string;
	}

	/**
	 * The interface that defines `event.locals`, which can be accessed in [hooks](https://kit.svelte.dev/docs/hooks) (`handle`, and `handleError`), server-only `load` functions, and `+server.js` files.
	 */
	export interface Locals {}

	/**
	 * Defines the common shape of the [$page.data store](https://kit.svelte.dev/docs/modules#$app-stores-page) - that is, the data that is shared between all pages.
	 * The `Load` and `ServerLoad` functions in `./$types` will be narrowed accordingly.
	 * Use optional properties for data that is only present on specific pages. Do not add an index signature (`[key: string]: any`).
	 */
	export interface PageData {}

	/**
	 * The shape of the `$page.state` object, which can be manipulated using the [`pushState`](https://kit.svelte.dev/docs/modules#$app-navigation-pushstate) and [`replaceState`](https://kit.svelte.dev/docs/modules#$app-navigation-replacestate) functions from `$app/navigation`.
	 */
	export interface PageState {}

	/**
	 * If your adapter provides [platform-specific context](https://kit.svelte.dev/docs/adapters#platform-specific-context) via `event.platform`, you can specify it here.
	 */
	export interface Platform {}
}

/**
 * This module is only available to [service workers](https://kit.svelte.dev/docs/service-workers).
 */
declare module '$service-worker' {
	/**
	 * The `base` path of the deployment. Typically this is equivalent to `config.kit.paths.base`, but it is calculated from `location.pathname` meaning that it will continue to work correctly if the site is deployed to a subdirectory.
	 * Note that there is a `base` but no `assets`, since service workers cannot be used if `config.kit.paths.assets` is specified.
	 */
	export const base: string;
	/**
	 * An array of URL strings representing the files generated by Vite, suitable for caching with `cache.addAll(build)`.
	 * During development, this is an empty array.
	 */
	export const build: string[];
	/**
	 * An array of URL strings representing the files in your static directory, or whatever directory is specified by `config.kit.files.assets`. You can customize which files are included from `static` directory using [`config.kit.serviceWorker.files`](https://kit.svelte.dev/docs/configuration)
	 */
	export const files: string[];
	/**
	 * An array of pathnames corresponding to prerendered pages and endpoints.
	 * During development, this is an empty array.
	 */
	export const prerendered: string[];
	/**
	 * See [`config.kit.version`](https://kit.svelte.dev/docs/configuration#version). It's useful for generating unique cache names inside your service worker, so that a later deployment of your app can invalidate old caches.
	 */
	export const version: string;
}

//# sourceMappingURL=index.d.ts.map
```


####### packages/migrate/bin.js #######

```

#!/usr/bin/env node
import fs from 'node:fs';
import { fileURLToPath } from 'node:url';
import colors from 'kleur';

const migration = process.argv[2];
const dir = fileURLToPath(new URL('.', import.meta.url));

const migrations = fs
	.readdirSync(`${dir}/migrations`)
	.filter((migration) => fs.existsSync(`${dir}/migrations/${migration}/index.js`));

if (migrations.includes(migration)) {
	const { migrate } = await import(`./migrations/${migration}/index.js`);
	migrate();
} else {
	console.error(
		colors
			.bold()
			.red(
				`You must specify one of the following migrations: ${migrations.join(', ')}\n` +
					'If you expected this to work, try re-running the command with the latest svelte-migrate version:\n' +
					`  npx svelte-migrate@latest ${migration}`
			)
	);
}

```


####### packages/migrate/CHANGELOG.md #######

# svelte-migrate

## 1.4.0

### Minor Changes

- feat: add self-closing-tags migration ([#12128](https://github.com/sveltejs/kit/pull/12128))

## 1.3.8

### Patch Changes

- chore(deps): update dependency ts-morph to v22 ([`4447269e979f2b5be18e0fded0b5843a6258542d`](https://github.com/sveltejs/kit/commit/4447269e979f2b5be18e0fded0b5843a6258542d))

## 1.3.7

### Patch Changes

- fix: don't downgrade versions when bumping dependencies ([#11716](https://github.com/sveltejs/kit/pull/11716))

## 1.3.6

### Patch Changes

- fix: correct link to docs ([#11407](https://github.com/sveltejs/kit/pull/11407))

## 1.3.5

### Patch Changes

- chore: update primary branch from master to main ([`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d))

## 1.3.4

### Patch Changes

- suggest running migrate command with latest if migration does not exist ([#11362](https://github.com/sveltejs/kit/pull/11362))

## 1.3.3

### Patch Changes

- chore: insert package at sorted position ([#11332](https://github.com/sveltejs/kit/pull/11332))

- fix: adjust cookie migration logic, note installation ([#11331](https://github.com/sveltejs/kit/pull/11331))

## 1.3.2

### Patch Changes

- fix: handle jsconfig.json ([#11325](https://github.com/sveltejs/kit/pull/11325))

## 1.3.1

### Patch Changes

- chore: fix broken migration links ([#11320](https://github.com/sveltejs/kit/pull/11320))

## 1.3.0

### Minor Changes

- feat: add sveltekit v2 migration ([#11294](https://github.com/sveltejs/kit/pull/11294))

## 1.2.8

### Patch Changes

- chore(deps): update dependency ts-morph to v21 ([#11181](https://github.com/sveltejs/kit/pull/11181))

## 1.2.7

### Patch Changes

- chore(deps): update dependency ts-morph to v20 ([#10766](https://github.com/sveltejs/kit/pull/10766))

## 1.2.6

### Patch Changes

- fix: do not downgrade versions ([#10352](https://github.com/sveltejs/kit/pull/10352))

## 1.2.5

### Patch Changes

- fix: note old eslint plugin deprecation ([#10319](https://github.com/sveltejs/kit/pull/10319))

## 1.2.4

### Patch Changes

- fix: ensure glob finds all files in folders ([#10230](https://github.com/sveltejs/kit/pull/10230))

## 1.2.3

### Patch Changes

- fix: handle missing fields in migrate script ([#10221](https://github.com/sveltejs/kit/pull/10221))

## 1.2.2

### Patch Changes

- fix: finalize svelte-4 migration ([#10195](https://github.com/sveltejs/kit/pull/10195))

- fix: changed `index` to `index.d.ts` in `typesVersions` ([#10180](https://github.com/sveltejs/kit/pull/10180))

## 1.2.1

### Patch Changes

- docs: update readme ([#10066](https://github.com/sveltejs/kit/pull/10066))

## 1.2.0

### Minor Changes

- feat: add Svelte 4 migration ([#9729](https://github.com/sveltejs/kit/pull/9729))

## 1.1.3

### Patch Changes

- fix: include index in typesVersions because it's always matched ([#9147](https://github.com/sveltejs/kit/pull/9147))

## 1.1.2

### Patch Changes

- fix: update existing exports with prepended outdir ([#9133](https://github.com/sveltejs/kit/pull/9133))

- fix: use typesVersions to wire up deep imports ([#9133](https://github.com/sveltejs/kit/pull/9133))

## 1.1.1

### Patch Changes

- fix: include utils in migrate's published files ([#9085](https://github.com/sveltejs/kit/pull/9085))

## 1.1.0

### Minor Changes

- feat: add `@sveltejs/package` migration (v1->v2) ([#8922](https://github.com/sveltejs/kit/pull/8922))

## 1.0.1

### Patch Changes

- fix: correctly check for old load props ([#8537](https://github.com/sveltejs/kit/pull/8537))

## 1.0.0

### Major Changes

First major release, see below for the history of changes that lead up to this.
Starting from now all releases follow semver and changes will be listed as Major/Minor/Patch

## 1.0.0-next.13

### Patch Changes

- fix: more robust uppercase migration ([#7033](https://github.com/sveltejs/kit/pull/7033))

## 1.0.0-next.12

### Patch Changes

- feat: do uppercase http verbs migration on the fly ([#6371](https://github.com/sveltejs/kit/pull/6371))

## 1.0.0-next.11

### Patch Changes

- fix: git mv files correctly when they contain \$ characters ([#6129](https://github.com/sveltejs/kit/pull/6129))

## 1.0.0-next.10

### Patch Changes

- Revert change to suggest props destructuring ([#6099](https://github.com/sveltejs/kit/pull/6099))

## 1.0.0-next.9

### Patch Changes

- Handle Error without message, handle status 200, handle missing body ([#6096](https://github.com/sveltejs/kit/pull/6096))

## 1.0.0-next.8

### Patch Changes

- Suggest props destructuring if possible ([#6069](https://github.com/sveltejs/kit/pull/6069))
- Fix typo in migration task ([#6070](https://github.com/sveltejs/kit/pull/6070))

## 1.0.0-next.7

### Patch Changes

- Migrate type comments on arrow functions ([#5933](https://github.com/sveltejs/kit/pull/5933))
- Use LayoutLoad inside +layout.js files ([#5931](https://github.com/sveltejs/kit/pull/5931))

## 1.0.0-next.6

### Patch Changes

- Create `.ts` files from `<script context="module" lang="ts">` ([#5905](https://github.com/sveltejs/kit/pull/5905))

## 1.0.0-next.5

### Patch Changes

- Rewrite type names ([#5778](https://github.com/sveltejs/kit/pull/5778))

## 1.0.0-next.4

### Patch Changes

- handle lone return statements ([#5831](https://github.com/sveltejs/kit/pull/5831))
- Fix error placement on (arrow) function when checking load input ([#5840](https://github.com/sveltejs/kit/pull/5840))

## 1.0.0-next.3

### Patch Changes

- handle more import cases ([#5828](https://github.com/sveltejs/kit/pull/5828))
- check load function input ([#5838](https://github.com/sveltejs/kit/pull/5838))

## 1.0.0-next.2

### Patch Changes

- Correctly rename files with spaces when migrating ([#5820](https://github.com/sveltejs/kit/pull/5820))

## 1.0.0-next.1

### Patch Changes

- Add a README ([#5817](https://github.com/sveltejs/kit/pull/5817))

####### packages/migrate/migrations/package/index.js #######

```

import fs from 'node:fs';
import colors from 'kleur';
import path from 'node:path';
import prompts from 'prompts';
import { pathToFileURL } from 'node:url';
import { bail, check_git } from '../../utils.js';
import { migrate_config } from './migrate_config.js';
import { migrate_pkg } from './migrate_pkg.js';

export async function migrate() {
	if (!fs.existsSync('svelte.config.js')) {
		bail('Please re-run this script in a directory with a svelte.config.js');
	}
	if (!fs.existsSync('package.json')) {
		bail('Please re-run this script in a directory with a package.json');
	}

	console.log(
		colors
			.bold()
			.yellow(
				'\nThis will update your svelte.config.js and package.json in the current directory\n'
			)
	);

	const use_git = check_git();

	const response = await prompts({
		type: 'confirm',
		name: 'value',
		message: 'Continue?',
		initial: false
	});

	if (!response.value) {
		process.exit(1);
	}

	const { default: config } = await import(pathToFileURL(path.resolve('svelte.config.js')).href);
	const has_package_config = !!config.package;

	config.package = {
		source: path.resolve(config.kit?.files?.lib ?? config.package?.source ?? 'src/lib'),
		dir: config.package?.dir ?? 'package',
		exports:
			config.package?.exports ??
			((/** @type {string} */ filepath) => !/^_|\/_|\.d\.ts$/.test(filepath)),
		files: config.package?.files ?? (() => true),
		emitTypes: config.package?.emitTypes ?? true
	};
	config.extensions = config.extensions ?? ['.svelte'];

	migrate_pkg(config);

	if (has_package_config) {
		migrate_config();
	}

	console.log(colors.bold().green('✔ Your project has been migrated'));

	console.log('\nRecommended next steps:\n');

	const cyan = colors.bold().cyan;

	const tasks = [
		use_git && cyan('git commit -m "migration to @sveltejs/package v2"'),
		'Review the migration guide at https://github.com/sveltejs/kit/pull/8922',
		'Read the updated docs at https://kit.svelte.dev/docs/packaging'
	].filter(Boolean);

	tasks.forEach((task, i) => {
		console.log(`  ${i + 1}: ${task}`);
	});

	console.log('');

	if (use_git) {
		console.log(`Run ${cyan('git diff')} to review changes.\n`);
	}
}

```


####### packages/migrate/migrations/package/migrate_config.js #######

```

import fs from 'node:fs';
import colors from 'kleur';
import MagicString from 'magic-string';
import ts from 'typescript';

export function migrate_config() {
	try {
		const content = fs.readFileSync('svelte.config.js', 'utf8');
		fs.writeFileSync('svelte.config.js', remove_package_from_config(content));
	} catch {
		console.log(
			colors
				.bold()
				.yellow('Could not remove package config from svelte.config.js, please remove it manually')
		);
	}
}

/**
 * @param {string} content
 */
export function remove_package_from_config(content) {
	const ast = ts.createSourceFile(
		'filename.ts',
		content,
		ts.ScriptTarget.Latest,
		true,
		ts.ScriptKind.TS
	);

	const code = new MagicString(content);

	for (const statement of ast.statements) {
		if (ts.isExportAssignment(statement)) {
			if (ts.isObjectLiteralExpression(statement.expression)) {
				remove(statement.expression);
			} else if (ts.isIdentifier(statement.expression)) {
				for (const statement2 of ast.statements) {
					if (ts.isVariableStatement(statement2)) {
						for (const declaration of statement2.declarationList.declarations) {
							if (
								ts.isIdentifier(declaration.name) &&
								declaration.name.text === statement.expression.text &&
								declaration.initializer &&
								ts.isObjectLiteralExpression(declaration.initializer)
							) {
								remove(declaration.initializer);
							}
						}
					}
				}
			}
		}
	}

	return code.toString();

	/** @param {ts.ObjectLiteralExpression} expression */
	function remove(expression) {
		for (let i = 0; i < expression.properties.length; i++) {
			const property = expression.properties[i];
			if (
				ts.isPropertyAssignment(property) &&
				ts.isIdentifier(property.name) &&
				property.name.text === 'package' &&
				ts.isObjectLiteralExpression(property.initializer)
			) {
				if (expression.properties.length === 1) {
					code.overwrite(expression.getStart(), expression.getEnd(), '{}');
				} else {
					const next_property = expression.properties[i + 1];
					if (next_property) {
						code.remove(property.getStart(), next_property.getStart());
					} else {
						code.remove(property.getStart(), content.lastIndexOf('}', expression.getEnd()));
					}
				}
			}
		}
	}
}

```


####### packages/migrate/migrations/package/migrate_config.spec.js #######

```

import { assert, test } from 'vitest';
import { remove_package_from_config } from './migrate_config.js';

test('Removes package config #1', () => {
	const result = remove_package_from_config(`
    export default {
        kit: {
            files: {
                lib: 'src/lib'
            }
        },
        package: {
            dir: 'package',
            exports: (filepath) => !/^_|\\/_|\\.d\\.ts$/.test(filepath),
            files: () => true
        },
        preprocess: []
    }`);
	assert.equal(
		result,
		`
    export default {
        kit: {
            files: {
                lib: 'src/lib'
            }
        },
        preprocess: []
    }`
	);
});

test('Removes package config #2', () => {
	const result = remove_package_from_config(`
    export default {
        package: {
            dir: 'package',
            exports: (filepath) => !/^_|\\/_|\\.d\\.ts$/.test(filepath),
            files: () => true
        },
    }`);
	assert.equal(
		result,
		`
    export default {}`
	);
});

test('Removes package config #3', () => {
	const result = remove_package_from_config(`
    const config = {
        package: {
            dir: 'package',
            exports: (filepath) => !/^_|\\/_|\\.d\\.ts$/.test(filepath),
            files: () => true
        },
    };
    export default config;`);
	assert.equal(
		result,
		`
    const config = {};
    export default config;`
	);
});

test('Leaves config untouched', () => {
	const content = `
    export default {
        kit: {
            files: {
                lib: 'src/lib'
            }
        },
    }`;
	const result = remove_package_from_config(content);
	assert.equal(result, content);
});

```


####### packages/migrate/migrations/package/migrate_pkg.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import colors from 'kleur';
import { guess_indent, posixify, walk } from '../../utils.js';

/**
 * @param {any} config
 */
export function migrate_pkg(config) {
	const files = scan(config);
	const pkg_str = fs.readFileSync('package.json', 'utf8');
	const pkg = update_pkg_json(config, JSON.parse(pkg_str), files);
	fs.writeFileSync('package.json', JSON.stringify(pkg, null, guess_indent(pkg_str) ?? '\t'));
}

/**
 * @param {any} config
 */
function scan(config) {
	return walk(config.package.source).map((file) => analyze(config, file));
}

/**
 * @param {any} config
 * @param {string} file
 */
function analyze(config, file) {
	const name = posixify(file);

	const svelte_extension = config.extensions.find((/** @type {string} */ ext) =>
		name.endsWith(ext)
	);

	const dest = svelte_extension
		? name.slice(0, -svelte_extension.length) + '.svelte'
		: name.endsWith('.d.ts')
			? name
			: name.endsWith('.ts')
				? name.slice(0, -3) + '.js'
				: name;

	return {
		name,
		dest,
		is_included: config.package.files(name),
		is_exported: config.package.exports(name),
		is_svelte: !!svelte_extension
	};
}

/**
 * @param {any} config
 * @param {any} pkg
 * @param {ReturnType<typeof analyze>[]} files
 */
export function update_pkg_json(config, pkg, files) {
	const out_dir = path.relative('.', config.package.dir);

	// See: https://pnpm.io/package_json#publishconfigdirectory
	if (pkg.publishConfig?.directory || pkg.linkDirectory?.directory) {
		console.log(
			colors.yellow(
				'Detected "publishConfig.directory" or "linkDirectory.directory" fields in your package.json. ' +
					'This migration removes them, which may or may not be what you want. Please review closely.'
			)
		);
		delete pkg.publishConfig?.directory;
		delete pkg.linkDirectory?.directory;
	}

	for (const key in pkg.scripts || []) {
		const script = pkg.scripts[key];
		if (script.includes('svelte-package')) {
			pkg.scripts[key] = script.replace('svelte-package', `svelte-package -o ${out_dir}`);
		}
	}

	pkg.type = 'module';
	pkg.exports = {
		'./package.json': './package.json',
		...pkg.exports
	};

	pkg.files = pkg.files || [];
	if (!pkg.files.includes(out_dir)) {
		pkg.files.push(out_dir);
	}

	if (pkg.devDependencies?.['@sveltejs/package']) {
		pkg.devDependencies['@sveltejs/package'] = '^2.0.0';
	}

	/** @type {Record<string, string>} */
	const clashes = {};
	/** @type {Record<string, [string]>} */
	const types_versions = {};

	for (const file of files) {
		if (file.is_included && file.is_exported) {
			const original = `$lib/${file.name}`;
			const key = `./${file.dest}`.replace(/\/index\.js$|(\/[^/]+)\.js$/, '$1');

			if (clashes[key]) {
				console.log(
					colors.yellow(
						`Duplicate "${key}" export. Closely review your "exports" field in package.json after the migration.`
					)
				);
			}

			const has_type = config.package.emitTypes && (file.is_svelte || file.dest.endsWith('.js'));
			const out_dir_type_path = `./${out_dir}/${
				file.is_svelte ? `${file.dest}.d.ts` : file.dest.slice(0, -'.js'.length) + '.d.ts'
			}`;

			if (has_type) {
				const type_key = key.slice(2) || 'index.d.ts';
				if (!pkg.exports[key]) {
					types_versions[type_key] = [out_dir_type_path];
				} else {
					const path_without_ext = pkg.exports[key].slice(
						0,
						-path.extname(pkg.exports[key]).length
					);
					types_versions[type_key] = [
						`./${out_dir}/${(pkg.exports[key].types ?? path_without_ext + '.d.ts').slice(2)}`
					];
				}
			}

			if (!pkg.exports[key]) {
				const needs_svelte_condition = file.is_svelte || path.basename(file.dest) === 'index.js';
				// JSON.stringify will remove the undefined entries
				pkg.exports[key] = {
					types: has_type ? out_dir_type_path : undefined,
					svelte: needs_svelte_condition ? `./${out_dir}/${file.dest}` : undefined,
					default: `./${out_dir}/${file.dest}`
				};

				if (Object.values(pkg.exports[key]).filter(Boolean).length === 1) {
					pkg.exports[key] = pkg.exports[key].default;
				}
			} else {
				// Rewrite existing export to point to the new output directory
				if (typeof pkg.exports[key] === 'string') {
					pkg.exports[key] = prepend_out_dir(pkg.exports[key], out_dir);
				} else {
					for (const condition in pkg.exports[key]) {
						if (typeof pkg.exports[key][condition] === 'string') {
							pkg.exports[key][condition] = prepend_out_dir(pkg.exports[key][condition], out_dir);
						}
					}
				}
			}

			clashes[key] = original;
		}
	}

	if (!pkg.svelte && files.some((file) => file.is_svelte)) {
		// Several heuristics in Kit/vite-plugin-svelte to tell Vite to mark Svelte packages
		// rely on the "svelte" property. Vite/Rollup/Webpack plugin can all deal with it.
		// See https://github.com/sveltejs/kit/issues/1959 for more info and related threads.
		if (pkg.exports['.']) {
			const svelte_export =
				typeof pkg.exports['.'] === 'string'
					? pkg.exports['.']
					: pkg.exports['.'].svelte || pkg.exports['.'].import || pkg.exports['.'].default;
			if (svelte_export) {
				pkg.svelte = svelte_export;
			} else {
				console.log(
					colors.yellow(
						'Cannot generate a "svelte" entry point because the "." entry in "exports" is not a string. Please specify a "svelte" entry point yourself\n'
					)
				);
			}
		} else {
			console.log(
				colors.yellow(
					'Cannot generate a "svelte" entry point because the "." entry in "exports" is missing. Please specify a "svelte" entry point yourself\n'
				)
			);
		}
	} else if (pkg.svelte) {
		// Rewrite existing "svelte" field to point to the new output directory
		pkg.svelte = prepend_out_dir(pkg.svelte, out_dir);
	}

	// https://www.typescriptlang.org/docs/handbook/declaration-files/publishing.html#version-selection-with-typesversions
	// A hack to get around the limitation that TS doesn't support "exports" field  with moduleResolution: 'node'
	if (
		Object.keys(types_versions).length > 1 ||
		(Object.keys(types_versions).length > 0 && !types_versions['index.d.ts'])
	) {
		pkg.typesVersions = { '>4.0': types_versions };
	}

	return pkg;
}

/**
 * Rewrite existing path to point to the new output directory
 * @param {string} path
 * @param {string} out_dir
 */
function prepend_out_dir(path, out_dir) {
	if (!path.startsWith(`./${out_dir}`) && path.startsWith('./')) {
		return `./${out_dir}/${path.slice(2)}`;
	}
}

```


####### packages/migrate/migrations/package/migrate_pkg.spec.js #######

```

import { expect, test } from 'vitest';
import { update_pkg_json } from './migrate_pkg.js';

test('Updates package.json', () => {
	const result = update_pkg_json(
		{ package: { dir: 'package', emitTypes: true } },
		{
			name: 'foo',
			version: '1.0.0',
			scripts: {
				packages: 'svelte-package'
			},
			exports: {
				'./ignored': './something.js'
			},
			svelte: './index.js'
		},
		[
			{
				name: 'foo/Bar.svelte',
				dest: 'foo/Bar.svelte',
				is_exported: true,
				is_included: true,
				is_svelte: true
			},
			{
				name: 'foo/Bar2.svelte',
				dest: 'foo/Bar2.svelte',
				is_exported: false,
				is_included: false,
				is_svelte: true
			},
			{
				name: 'baz.js',
				dest: 'baz.js',
				is_exported: true,
				is_included: true,
				is_svelte: false
			},
			{
				name: 'bar/index.js',
				dest: 'bar/index.js',
				is_exported: true,
				is_included: true,
				is_svelte: false
			},
			{
				name: 'index.js',
				dest: 'index.js',
				is_exported: true,
				is_included: true,
				is_svelte: false
			},
			{
				name: 'ignored.js',
				dest: 'ignored.js',
				is_exported: true,
				is_included: true,
				is_svelte: false
			}
		]
	);
	expect(JSON.parse(JSON.stringify(result))).toEqual({
		name: 'foo',
		version: '1.0.0',
		type: 'module',
		files: ['package'],
		scripts: {
			packages: 'svelte-package -o package'
		},
		exports: {
			'./package.json': './package.json',
			'.': {
				types: './package/index.d.ts',
				svelte: './package/index.js',
				default: './package/index.js'
			},
			'./foo/Bar.svelte': {
				types: './package/foo/Bar.svelte.d.ts',
				svelte: './package/foo/Bar.svelte',
				default: './package/foo/Bar.svelte'
			},
			'./baz': {
				types: './package/baz.d.ts',
				default: './package/baz.js'
			},
			'./bar': {
				types: './package/bar/index.d.ts',
				svelte: './package/bar/index.js',
				default: './package/bar/index.js'
			},
			'./ignored': './package/something.js'
		},
		svelte: './package/index.js',
		typesVersions: {
			'>4.0': {
				'index.d.ts': ['./package/index.d.ts'],
				'foo/Bar.svelte': ['./package/foo/Bar.svelte.d.ts'],
				baz: ['./package/baz.d.ts'],
				bar: ['./package/bar/index.d.ts'],
				ignored: ['./package/something.d.ts']
			}
		}
	});
});

test('Updates package.json #2', () => {
	const result = update_pkg_json(
		{ package: { dir: 'dist', emitTypes: false } },
		{
			name: 'foo',
			version: '1.0.0'
		},
		[
			{
				name: 'foo/Bar.svelte',
				dest: 'foo/Bar.svelte',
				is_exported: true,
				is_included: true,
				is_svelte: true
			},
			{
				name: 'baz.js',
				dest: 'baz.js',
				is_exported: true,
				is_included: true,
				is_svelte: false
			},
			{
				name: 'index.js',
				dest: 'index.js',
				is_exported: true,
				is_included: true,
				is_svelte: false
			}
		]
	);
	expect(JSON.parse(JSON.stringify(result))).toEqual({
		name: 'foo',
		version: '1.0.0',
		type: 'module',
		files: ['dist'],
		exports: {
			'./package.json': './package.json',
			'.': {
				svelte: './dist/index.js',
				default: './dist/index.js'
			},
			'./foo/Bar.svelte': {
				svelte: './dist/foo/Bar.svelte',
				default: './dist/foo/Bar.svelte'
			},
			'./baz': './dist/baz.js'
		},
		svelte: './dist/index.js'
	});
});

```


####### packages/migrate/migrations/routes/index.js #######

```

import fs from 'node:fs';
import colors from 'kleur';
import path from 'node:path';
import prompts from 'prompts';
import glob from 'tiny-glob/sync.js';
import { pathToFileURL } from 'node:url';
import { migrate_scripts } from './migrate_scripts/index.js';
import { migrate_page } from './migrate_page_js/index.js';
import { migrate_page_server } from './migrate_page_server/index.js';
import { migrate_server } from './migrate_server/index.js';
import { adjust_imports, task } from './utils.js';
import { bail, relative, move_file, check_git } from '../../utils.js';

export async function migrate() {
	if (!fs.existsSync('svelte.config.js')) {
		bail('Please re-run this script in a directory with a svelte.config.js');
	}

	const { default: config } = await import(pathToFileURL(path.resolve('svelte.config.js')).href);

	const routes = path.resolve(config.kit?.files?.routes ?? 'src/routes');

	/** @type {string[]} */
	const extensions = config.extensions ?? ['.svelte'];

	/** @type {string[]} */
	const module_extensions = config.kit?.moduleExtensions ?? ['.js', '.ts'];

	/** @type {((filepath: string) => boolean)} */
	const filter =
		config.kit?.routes ??
		((filepath) => !/(?:(?:^_|\/_)|(?:^\.|\/\.)(?!well-known))/.test(filepath));

	const files = glob(`${routes}/**`, { filesOnly: true, dot: true }).map((file) =>
		file.replace(/\\/g, '/')
	);

	// validate before proceeding
	for (const file of files) {
		const basename = path.basename(file);
		if (
			basename.startsWith('+page.') ||
			basename.startsWith('+layout.') ||
			basename.startsWith('+server.') ||
			basename.startsWith('+error.')
		) {
			bail(`It looks like this migration has already been run (found ${relative(file)}). Aborting`);
		}

		if (basename.startsWith('+')) {
			// prettier-ignore
			bail(
				`Please rename any files in ${relative(routes)} with a leading + character before running this migration (found ${relative(file)}). Aborting`
			);
		}
	}

	console.log(colors.bold().yellow('\nThis will overwrite files in the current directory!\n'));

	const use_git = check_git();

	const response = await prompts({
		type: 'confirm',
		name: 'value',
		message: 'Continue?',
		initial: false
	});

	if (!response.value) {
		process.exit(1);
	}

	for (const file of files) {
		const basename = path.basename(file);
		if (!filter(file) && !basename.startsWith('__')) continue;

		// replace `./__types` or `./__types/foo` with `./$types`
		const content = fs.readFileSync(file, 'utf8').replace(/\.\/__types(?:\/[^'"]+)?/g, './$types');

		const svelte_ext = extensions.find((ext) => file.endsWith(ext));
		const module_ext = module_extensions.find((ext) => file.endsWith(ext));

		if (svelte_ext) {
			// file is a component
			const bare = basename.slice(0, -svelte_ext.length);
			const [name, layout] = bare.split('@');
			const is_error_page = bare === '__error';

			/**
			 * Whether file should be moved to a subdirectory — e.g. `src/routes/about.svelte`
			 * should become `src/routes/about/+page.svelte`
			 */
			let move_to_directory = false;

			/**
			 * The new name of the file
			 */
			let renamed = file.slice(0, -basename.length);

			/**
			 * If a component has `<script context="module">`, the contents are moved
			 * into a sibling module with the same name
			 */
			let sibling;

			if (bare.startsWith('__layout')) {
				sibling = renamed + '+layout';
				renamed += '+' + bare.slice(2); // account for __layout-foo etc
			} else if (is_error_page) {
				renamed += '+error';
				// no sibling, because error files can no longer have load
			} else if (name === 'index') {
				sibling = renamed + '+page';
				renamed += '+page' + (layout ? '@' + layout : '');
			} else {
				sibling = `${renamed}${name}/+page`;
				renamed += `${name}/+page${layout ? '@' + layout : ''}`;

				move_to_directory = true;
			}

			renamed += svelte_ext;

			const { module, main, ext } = migrate_scripts(content, is_error_page, move_to_directory);

			if (move_to_directory) {
				const dir = path.dirname(renamed);
				if (!fs.existsSync(dir)) fs.mkdirSync(dir);
			}

			move_file(file, renamed, main, use_git);

			// if component has a <script context="module">, move it to a sibling .js file
			if (module) {
				fs.writeFileSync(sibling + ext, migrate_page(module, bare));
			}
		} else if (module_ext) {
			// file is a module
			const bare = basename.slice(0, -module_ext.length);
			const [name] = bare.split('@');

			/**
			 * Whether the file is paired with a page component, and should
			 * therefore become `+page.server.js`, or not in which case
			 * it should become `+server.js`
			 */
			const is_page_endpoint = extensions.some((ext) =>
				files.includes(`${file.slice(0, -module_ext.length)}${ext}`)
			);

			const type = is_page_endpoint ? '+page.server' : '+server';

			const move_to_directory = name !== 'index';
			const is_standalone_index = !is_page_endpoint && name.startsWith('index.');

			let renamed = '';
			if (is_standalone_index) {
				// handle <folder>/index.json.js -> <folder>.json/+server.js
				const dir = path.dirname(file);
				renamed =
					// prettier-ignore
					`${file.slice(0, -(basename.length + dir.length + 1))}${dir + name.slice('index'.length)}/+server${module_ext}`;
			} else if (move_to_directory) {
				renamed = `${file.slice(0, -basename.length)}${name}/${type}${module_ext}`;
			} else {
				renamed = `${file.slice(0, -basename.length)}${type}${module_ext}`;
			}

			// Standalone index endpoints are edge case enough that we don't spend time on trying to update all the imports correctly
			const edited =
				(is_standalone_index && /import/.test(content) ? `\n// ${task('Check imports')}\n` : '') +
				(!is_standalone_index && move_to_directory ? adjust_imports(content) : content);
			if (move_to_directory) {
				const dir = path.dirname(renamed);
				if (!fs.existsSync(dir)) fs.mkdirSync(dir);
			}

			move_file(
				file,
				renamed,
				is_page_endpoint ? migrate_page_server(edited, bare) : migrate_server(edited),
				use_git
			);
		}
	}

	console.log(colors.bold().green('✔ Your project has been migrated'));

	console.log('\nRecommended next steps:\n');

	const cyan = colors.bold().cyan;

	const tasks = [
		use_git && cyan('git commit -m "svelte-migrate: renamed files"'),
		'Review the migration guide at https://github.com/sveltejs/kit/discussions/5774',
		`Search codebase for ${cyan('"@migration"')} and manually complete migration tasks`,
		use_git && cyan('git add -A'),
		use_git && cyan('git commit -m "svelte-migrate: updated files"')
	].filter(Boolean);

	tasks.forEach((task, i) => {
		console.log(`  ${i + 1}: ${task}`);
	});

	console.log('');

	if (use_git) {
		console.log(`Run ${cyan('git diff')} to review changes.\n`);
	}
}

```


####### packages/migrate/migrations/routes/migrate_page_js/index.js #######

```

import ts from 'typescript';
import {
	automigration,
	error,
	get_function_node,
	get_object_nodes,
	is_new,
	is_string_like,
	manual_migration,
	manual_return_migration,
	parse,
	rewrite_returns,
	rewrite_type,
	unwrap
} from '../utils.js';
import * as TASKS from '../tasks.js';
import { dedent } from '../../../utils.js';

const give_up = `${error('Update load function', TASKS.PAGE_LOAD)}\n\n`;

/**
 * @param {string} content
 * @param {string} filename
 */
export function migrate_page(content, filename) {
	// early out if we can tell there's no load function
	// without parsing the file
	if (!/load/.test(content)) return content;

	const file = parse(content);
	if (!file) return give_up + content;

	const name = file.exports.map.get('load');

	if (!name && !file.exports.complex) {
		// there's no load function here, so there's nothing to do
		return content;
	}

	const match = /__layout(?:-([^.@]+))?/.exec(filename);
	const load_name = match?.[1] ? `LayoutLoad.${match[1]}` : match ? 'LayoutLoad' : 'PageLoad';

	for (const statement of file.ast.statements) {
		const fn = name ? get_function_node(statement, name) : undefined;
		if (fn?.body) {
			check_fn_param(fn, file.code);

			/** @type {Set<string>} */
			const imports = new Set();

			rewrite_type(fn, file.code, 'Load', load_name);

			rewrite_returns(fn.body, (expr, node) => {
				const value = unwrap(expr);
				const nodes = ts.isObjectLiteralExpression(value) && get_object_nodes(value);

				if (nodes) {
					const keys = Object.keys(nodes).sort().join(' ');

					if (keys === '') {
						return; // nothing to do
					}

					if (
						keys === 'props' ||
						((keys === 'status' || keys === 'props status') &&
							Number(nodes.status.getText()) === 200)
					) {
						automigration(value, file.code, dedent(nodes.props?.getText() || ''));
						return;
					}

					// check for existence of `node`, otherwise it's an arrow function
					// with an implicit body, which we bail out on
					if (node) {
						const status = nodes.status && Number(nodes.status.getText());

						// logic based on https://github.com/sveltejs/kit/blob/67e2342149847d267eb0c50809a1f93f41fa529b/packages/kit/src/runtime/load.js
						if (keys === 'redirect status' && status > 300 && status < 400) {
							automigration(
								node,
								file.code,
								`throw redirect(${status}, ${nodes.redirect.getText()});`
							);
							imports.add('redirect');
							return;
						}

						if (nodes.error) {
							const message = is_string_like(nodes.error)
								? nodes.error.getText()
								: is_new(nodes.error, 'Error')
									? /** @type {string | undefined} */ (nodes.error.arguments[0]?.getText())
									: false;

							if (message !== false) {
								automigration(
									node,
									file.code,
									`throw error(${status || 500}${message ? `, ${message}` : ''});`
								);
								imports.add('error');
								return;
							}
						} else if (status >= 400) {
							automigration(node, file.code, `throw error(${status});`);
							imports.add('error');
							return;
						}
					}
				}

				manual_return_migration(node || fn, file.code, TASKS.PAGE_LOAD);
			});

			if (imports.size) {
				const has_imports = file.ast.statements.some((statement) =>
					ts.isImportDeclaration(statement)
				);
				const declaration = `import { ${[...imports.keys()].join(', ')} } from '@sveltejs/kit';`;

				return declaration + (has_imports ? '\n' : '\n\n') + file.code.toString();
			}

			return file.code.toString();
		}

		if (ts.isImportDeclaration(statement) && statement.importClause) {
			const bindings = statement.importClause.namedBindings;

			if (bindings && !ts.isNamespaceImport(bindings)) {
				for (const binding of bindings.elements) {
					if (binding.name.escapedText === 'Load') {
						file.code.overwrite(binding.getStart(), binding.getEnd(), load_name);
					}
				}
			}
		}
	}

	// we failed to rewrite the load function, so we inject
	// an error at the top of the file
	return give_up + content;
}

/**
 * Check the load function parameter, and either adjust
 * the property names, or add an error
 * @param {ts.FunctionDeclaration | ts.FunctionExpression | ts.ArrowFunction} fn
 * @param {import('magic-string').default} str
 */
function check_fn_param(fn, str) {
	const param = fn.parameters[0];
	if (!param) {
		return;
	}
	if (ts.isObjectBindingPattern(param.name)) {
		for (const binding of param.name.elements) {
			if (
				!ts.isIdentifier(binding.name) ||
				(binding.propertyName && !ts.isIdentifier(binding.propertyName))
			) {
				bail(true);
				return;
			}
			const name = binding.propertyName
				? /** @type {ts.Identifier} */ (binding.propertyName).text
				: binding.name.text;
			if (['stuff', 'status', 'error'].includes(name)) {
				bail();
				return;
			}
			if (name === 'props') {
				if (binding.propertyName) {
					bail();
					return;
				} else {
					str.overwrite(binding.name.getStart(), binding.name.getEnd(), 'data: props');
				}
			}
		}
	} else {
		// load(param) { .. } -> bail, we won't check what is used in the function body
		bail(true);
	}

	function bail(check = false) {
		manual_migration(
			fn,
			str,
			(check ? 'Check if you need to migrate' : 'Migrate') + ' the load function input',
			TASKS.PAGE_LOAD
		);
	}
}

```


####### packages/migrate/migrations/routes/migrate_page_js/index.spec.js #######

```

import { assert, test } from 'vitest';
import { migrate_page } from './index.js';
import { read_samples } from '../../../utils.js';

for (const sample of read_samples(new URL('./samples.md', import.meta.url))) {
	test(sample.description, () => {
		const actual = migrate_page(sample.before, sample.filename ?? '+page.js');
		assert.equal(actual, sample.after);
	});
}

```


####### packages/migrate/migrations/routes/migrate_page_js/samples.md #######

## A load function that only returns props

```js before
/** @type {import('./$types').Load} */
export function load() {
	return {
		props: {
			a: 1
		}
	};
}
```

```js after
/** @type {import('./$types').PageLoad} */
export function load() {
	return {
		a: 1
	};
}
```

## A TypeScript load function that only returns props

```ts before
import type { Load } from './$types';

export const load: Load = () => {
	return {
		props: {
			a: 1
		}
	};
}
```

```ts after
import type { PageLoad } from './$types';

export const load: PageLoad = () => {
	return {
		a: 1
	};
}
```

## A file without a load function

```js before
export const prerender = true;
```

```js after
export const prerender = true;
```

## A renamed load function

```js before
function myload() {
	return {
		props: {
			a: 1
		}
	};
}

export { myload as load };
```

```js after
function myload() {
	return {
		a: 1
	};
}

export { myload as load };
```

## A load function with a redirect

```js before
export function load({ session }) {
	if (!session.user) {
		return {
			status: 307,
			redirect: '/login'
		};
	}

	return {
		props: {
			a: 1
		};
	}
}
```

```js after
import { redirect } from '@sveltejs/kit';

export function load({ session }) {
	if (!session.user) {
		throw redirect(307, '/login');
	}

	return {
		a: 1
	}
}
```

## String error

```js before
export function load({ session }) {
	if (!session.user?.admin) {
		return {
			status: 403,
			error: 'unauthorized'
		};
	}
}
```

```js after
import { error } from '@sveltejs/kit';

export function load({ session }) {
	if (!session.user?.admin) {
		throw error(403, 'unauthorized');
	}
}
```

## Error constructor

```js before
export function load({ session }) {
	if (!session.user?.admin) {
		return {
			status: 403,
			error: new Error('unauthorized')
		};
	}
}
```

```js after
import { error } from '@sveltejs/kit';

export function load({ session }) {
	if (!session.user?.admin) {
		throw error(403, 'unauthorized');
	}
}
```

## Error constructor with no arguments

```js before
export function load({ session }) {
	if (!session.user?.admin) {
		return {
			status: 403,
			error: new Error()
		};
	}
}
```

```js after
import { error } from '@sveltejs/kit';

export function load({ session }) {
	if (!session.user?.admin) {
		throw error(403);
	}
}
```

## Error status with no error

```js before
export function load() {
	return { status: 518 };
}
```

```js after
import { error } from '@sveltejs/kit';

export function load() {
	throw error(518);
}
```

## Unknown error type

```js before
export function load() {
	return { error: blah };
}
```

```js after
export function load() {
	throw new Error("@migration task: Migrate this return statement (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292693)");
	return { error: blah };
}
```

## Arrow function load

```js before
/** @type {import('./$types').Load} */
export const load = () => ({
	props: {
		a: 1
	}
});
```

```js after
/** @type {import('./$types').PageLoad} */
export const load = () => ({
	a: 1
});
```

## Arrow function that can't be migrated

```js before
export const load = () => ({
	cache: {
		maxage: 300
	}
});
```

```js after
throw new Error("@migration task: Migrate this return statement (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292693)");
export const load = () => ({
	cache: {
		maxage: 300
	}
});
```

## Returns cache

```js before
export function load() {
	return {
		cache: {
			maxage: 300
		}
	};
}
```

```js after
export function load() {
	throw new Error("@migration task: Migrate this return statement (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292693)");
	return {
		cache: {
			maxage: 300
		}
	};
}
```

## Returns non-object-literal

```js before
export async function load({ fetch }) {
	const res = await fetch('/x.json');
	return await res.json();
}
```

```js after
export async function load({ fetch }) {
	const res = await fetch('/x.json');
	throw new Error("@migration task: Migrate this return statement (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292693)");
	return await res.json();
}
```

## Renames props -> data, leaves unchanged alone

```js before
export async function load({ props, params }) {
	return {};
}
```

```js after
export async function load({ data: props, params }) {
	return {};
}
```

## Errors on stuff

```js before
export async function load({ stuff }) {
	return {};
}
```

```js after
throw new Error("@migration task: Migrate the load function input (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292693)");
export async function load({ stuff }) {
	return {};
}
```

## Bails on non-destructured param

```js before
export const load = (input) => {
	return {};
}
```

```js after
throw new Error("@migration task: Check if you need to migrate the load function input (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292693)");
export const load = (input) => {
	return {};
}
```

## A load function that returns nothing

```js before
export function load() {
	return;
}
```

```js after
export function load() {
	return;
}
```

## A load function that returns props and status 200

```js before
export function load() {
	return {
		status: 200,
		props: {}
	};
}
```

```js after
export function load() {
	return {};
}
```

## A load function that returns status 200

```js before
export function load() {
	return {
		status: 200 
	};
}
```

```js after
export function load() {
	return ;
}
```

####### packages/migrate/migrations/routes/migrate_page_server/index.js #######

```

import ts from 'typescript';
import {
	automigration,
	error,
	get_function_node,
	get_object_nodes,
	manual_migration,
	manual_return_migration,
	parse,
	rewrite_returns,
	rewrite_type,
	unwrap,
	uppercase_migration
} from '../utils.js';
import * as TASKS from '../tasks.js';
import { dedent } from '../../../utils.js';

const give_up = `${error('Update +page.server.js', TASKS.PAGE_ENDPOINT)}\n\n`;

/**
 * @param {string} content
 * @param {string} filename
 * @returns {string}
 */
export function migrate_page_server(content, filename) {
	const file = parse(content);
	if (!file) return give_up + content;

	const methods = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'].filter((name) =>
		file.exports.map.has(name)
	);

	// If user didn't do the uppercase verbs migration yet, do it here on the fly.
	const uppercased = uppercase_migration(methods, file);
	if (!uppercased) {
		return give_up + content;
	} else if (uppercased !== content) {
		return migrate_page_server(uppercased, filename);
	}

	const non_get_methods = methods.filter((name) => name !== 'GET');

	const unmigrated = new Set(methods);

	const match = /\+(?:(page)|(layout(?:-([^.@]+))?))/.exec(filename);
	const load_name = match?.[3]
		? `LayoutServerLoad.${match[3]}`
		: match?.[2]
			? 'LayoutServerLoad'
			: 'PageServerLoad';

	const has_load = file.exports.map.has('GET');
	const has_action = non_get_methods.some((method) => file.exports.map.has(method));

	for (const statement of file.ast.statements) {
		const GET_id = file.exports.map.get('GET');
		if (GET_id) {
			const GET = get_function_node(statement, GET_id);
			if (GET) {
				if (GET.body) {
					// possible TODOs — handle errors and redirects
					rewrite_returns(GET.body, (expr, node) => {
						const value = unwrap(expr);
						const nodes = ts.isObjectLiteralExpression(value) && get_object_nodes(value);

						if (!nodes || nodes.headers || (nodes.status && nodes.status.getText() !== '200')) {
							manual_return_migration(node || GET, file.code, TASKS.PAGE_ENDPOINT);
							return;
						}

						automigration(value, file.code, dedent(nodes.body?.getText() || ''));
					});
				}

				rewrite_type(GET, file.code, 'RequestHandler', load_name);

				if (ts.isFunctionDeclaration(GET) && GET.name) {
					automigration(GET.name, file.code, 'load');
				} else if (ts.isVariableDeclaration(GET.parent) && ts.isIdentifier(GET.parent.name)) {
					automigration(GET.parent.name, file.code, 'load');
				} else {
					manual_migration(GET, file.code, 'Rename GET to load', TASKS.PAGE_ENDPOINT);
				}

				unmigrated.delete('GET');
			}
		}

		for (const method of non_get_methods) {
			const fn = get_function_node(statement, /** @type{string} */ (file.exports.map.get(method)));
			if (fn?.body) {
				rewrite_returns(fn.body, (expr, node) => {
					manual_return_migration(node || fn, file.code, TASKS.PAGE_ENDPOINT);
				});

				rewrite_type(fn, file.code, 'RequestHandler', 'Action');

				unmigrated.delete(method);
			}
		}

		if (ts.isImportDeclaration(statement) && statement.importClause) {
			const bindings = statement.importClause.namedBindings;

			if (bindings && !ts.isNamespaceImport(bindings)) {
				for (const binding of bindings.elements) {
					if (binding.name.escapedText === 'RequestHandler') {
						const types = [has_load && load_name, has_action && 'Action'].filter(Boolean);

						file.code.overwrite(binding.getStart(), binding.getEnd(), types.join(', '));
					}
				}
			}
		}
	}

	if (unmigrated.size) {
		return give_up + file.code.toString();
	}

	return file.code.toString();
}

```


####### packages/migrate/migrations/routes/migrate_page_server/index.spec.js #######

```

import { assert, test } from 'vitest';
import { migrate_page_server } from './index.js';
import { read_samples } from '../../../utils.js';

for (const sample of read_samples(new URL('./samples.md', import.meta.url))) {
	test(sample.description, () => {
		const actual = migrate_page_server(sample.before, sample.filename ?? '+page.server.js');
		assert.equal(actual, sample.after);
	});
}

```


####### packages/migrate/migrations/routes/migrate_page_server/samples.md #######

## A GET function that only returns body

```js before
/** @type {import('./$types').RequestHandler} */
export function GET() {
	return {
		body: {
			a: 1
		}
	};
}
```

```js after
/** @type {import('./$types').PageServerLoad} */
export function load() {
	return {
		a: 1
	};
}
```

## A TypeScript GET function that only returns body

```ts before
import type { RequestHandler } from './$types';

export const GET: RequestHandler = () => {
	return {
		body: {
			a: 1
		}
	};
}
```

```ts after
import type { PageServerLoad } from './$types';

export const load: PageServerLoad = () => {
	return {
		a: 1
	};
}
```

## A GET function in a +layout-foo.server.js

> file: +layout-foo.server.js

```js before
/** @type {import('./$types').RequestHandler} */
export function GET() {
	return {
		body: {
			a: 1
		}
	};
}
```

```js after
/** @type {import('./$types').LayoutServerLoad.foo} */
export function load() {
	return {
		a: 1
	};
}
```

## 200 status

```js before
export function GET() {
	return {
		status: 200,
		body: {
			a: 1
		}
	};
}
```

```js after
export function load() {
	return {
		a: 1
	};
}
```

## Arrow function GET

```js before
/** @type {import('./$types').RequestHandler} */
export const GET = () => ({
	body: {
		a: 1
	}
});
```

```js after
/** @type {import('./$types').PageServerLoad} */
export const load = () => ({
	a: 1
});
```

## POST

```js before
/** @type {import('./$types').RequestHandler} */
export function POST() {
	return {};
}
```

```js after
/** @type {import('./$types').Action} */
export function POST() {
	throw new Error("@migration task: Migrate this return statement (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292699)");
	return {};
}
```

## A function that returns nothing

```js before
export function GET() {
	return;
}
```

```js after
export function load() {
	return;
}
```

## A function that wrongfully has no body

```js before
export function GET() {
	return {
		status: 200
	};
}
```

```js after
export function load() {
	return ;
}
```

## A get function that only returns body

```js before
import something from 'somewhere';

/** @type {import('./$types').RequestHandler} */
export function get() {
	return {
		body: {
			a: something
		}
	};
}
```

```js after
import something from 'somewhere';

/** @type {import('./$types').PageServerLoad} */
export function load() {
	return {
		a: something
	};
}
```

####### packages/migrate/migrations/routes/migrate_scripts/index.js #######

```

import ts from 'typescript';
import { adjust_imports, error, parse } from '../utils.js';
import * as TASKS from '../tasks.js';
import { comment, dedent, except_str, guess_indent } from '../../../utils.js';

/**
 * @param {string} content
 * @param {boolean} is_error
 * @param {boolean} moved
 */
export function migrate_scripts(content, is_error, moved) {
	/** @type {string | null} */
	let module = null;

	let ext = '.js';

	// instance script
	const main = content.replace(
		/<script([^]*?)>([^]+?)<\/script>(\n*)/g,
		(match, attrs, contents, whitespace) => {
			const indent = guess_indent(contents) ?? '';

			if (moved) {
				contents = adjust_imports(contents);
			}

			if (/context=(['"])module\1/.test(attrs)) {
				// special case — load is no longer supported in error
				if (is_error) {
					const body = `\n${indent}${error('Replace error load function', '3293209')}\n${comment(
						contents,
						indent
					)}`;

					return `<script${attrs}>${body}</script>${whitespace}`;
				}

				if (/lang(?:uage)?=(['"])(ts|typescript)\1/.test(attrs)) {
					ext = '.ts';
				}

				module = dedent(contents.replace(/^\n/, ''));

				const declared = find_declarations(contents);
				const delete_var = (/** @type {string } */ key) => {
					const declaration = declared?.get(key);
					if (declaration && !declaration.import) {
						declared?.delete(key);
					}
				};
				delete_var('load');
				delete_var('router');
				delete_var('hydrate');
				delete_var('prerender');
				const delete_kit_type = (/** @type {string } */ key) => {
					const declaration = declared?.get(key);
					if (
						declaration &&
						declaration.import?.type_only &&
						declaration.import.from === '@sveltejs/kit' &&
						!new RegExp(`\\W${key}\\W`).test(except_str(content, match))
					) {
						declared?.delete(key);
					}
				};
				delete_kit_type('Load');
				delete_kit_type('LoadEvent');
				delete_kit_type('LoadOutput');

				if (!declared || declared.size > 0) {
					const body = `\n${indent}${error(
						'Check code was safely removed',
						TASKS.PAGE_MODULE_CTX
					)}\n${comment(contents, indent)}`;

					return `<script${attrs}>${body}</script>${whitespace}`;
				}

				// nothing was declared here, we can safely remove the script
				return '';
			}

			if (!is_error && /export let [\w]+[^"`'\w\s]/.test(contents)) {
				contents = `\n${indent}${error('Add data prop', TASKS.PAGE_DATA_PROP)}\n${contents}`;
				// Possible TODO: migrate props to data.prop, or suggest $: ({propX, propY, ...} = data);
			}

			return `<script${attrs}>${contents}</script>${whitespace}`;
		}
	);

	return { module, main, ext };
}

/** @param {string} content */
function find_declarations(content) {
	const file = parse(content);
	if (!file) return;

	/** @type {Map<string, {name: string, import?: {from: string, type_only: boolean}}>} */
	const declared = new Map();
	/**
	 * @param {string} name
	 * @param {{from: string, type_only: boolean}} [import_def]
	 */
	function add(name, import_def) {
		declared.set(name, { name, import: import_def });
	}

	for (const statement of file.ast.statements) {
		if (ts.isImportDeclaration(statement) && statement.importClause) {
			const type_only = statement.importClause.isTypeOnly;
			const from = ts.isStringLiteral(statement.moduleSpecifier)
				? statement.moduleSpecifier.text
				: '';

			if (statement.importClause.name) {
				add(statement.importClause.name.text, { from, type_only });
			}

			const bindings = statement.importClause.namedBindings;

			if (bindings) {
				if (ts.isNamespaceImport(bindings)) {
					add(bindings.name.text, { from, type_only });
				} else {
					for (const binding of bindings.elements) {
						add(binding.name.text, { from, type_only: type_only || binding.isTypeOnly });
					}
				}
			}
		} else if (ts.isVariableStatement(statement)) {
			for (const declaration of statement.declarationList.declarations) {
				if (ts.isIdentifier(declaration.name)) {
					add(declaration.name.text);
				} else {
					return; // bail out if it's not a simple variable
				}
			}
		} else if (ts.isFunctionDeclaration(statement) || ts.isClassDeclaration(statement)) {
			if (statement.name && ts.isIdentifier(statement.name)) {
				add(statement.name.text);
			}
		} else if (ts.isExportDeclaration(statement) && !statement.exportClause) {
			return; // export * from '..' -> bail
		}
	}

	return declared;
}

```


####### packages/migrate/migrations/routes/migrate_scripts/index.spec.js #######

```

import { assert, test } from 'vitest';
import { migrate_scripts } from './index.js';
import { read_samples } from '../../../utils.js';

for (const sample of read_samples(new URL('./samples.md', import.meta.url))) {
	test(sample.description, () => {
		const actual = migrate_scripts(
			sample.before,
			sample.description.includes('error'),
			sample.description.includes('moved')
		);
		assert.equal(actual.main, sample.after);
	});
}

```


####### packages/migrate/migrations/routes/migrate_scripts/samples.md #######

## No module context, no page exports

```svelte before
<script>
	let hello = 'world';
<script>

<p>{hello}</p>
```

```svelte after
<script>
	let hello = 'world';
<script>

<p>{hello}</p>
```

## Module context on error page

```svelte before
<script context="module">
	export function load() {
		return {
			props: {
				sry: 'not anymore'
			}
		}
	}
</script>

<script>
	export let sry;
</script>

<p>{sry}</p>
```

```svelte after
<script context="module">
	throw new Error("@migration task: Replace error load function (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3293209)");

	// export function load() {
	// 	return {
	// 		props: {
	// 			sry: 'not anymore'
	// 		}
	// 	}
	// }
</script>

<script>
	export let sry;
</script>

<p>{sry}</p>
```

## Module context that can be removed

```svelte before
<script context="module">
	export function load() {
		return {
			props: {
				a: 1
			}
		}
	}
</script>

<script>
	export let a;
</script>
```

```svelte after
<script>
	throw new Error("@migration task: Add data prop (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292707)");

	export let a;
</script>
```

## Module context with moved imports

```svelte before
<script context="module">
	import Foo from './Foo.svelte';
	export function load() {
		return {
			props: {
				sry: 'not anymore'
			}
		}
	}
</script>

<script>
	export let sry;
</script>

<Foo>{sry}</Foo>
```

```svelte after
<script context="module">
	throw new Error("@migration task: Check code was safely removed (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292722)");

	// import Foo from '../Foo.svelte';
	// export function load() {
	// 	return {
	// 		props: {
	// 			sry: 'not anymore'
	// 		}
	// 	}
	// }
</script>

<script>
	throw new Error("@migration task: Add data prop (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292707)");

	export let sry;
</script>

<Foo>{sry}</Foo>
```

## Module context with type imports only

```svelte before
<script context="module">
	import type { Load, LoadEvent, LoadOutput } from '@sveltejs/kit';
	export function load() {
		return {
			props: {
				sry: 'not anymore'
			}
		}
	}
</script>
```

```svelte after
```

## Module context with type imports only but used in instance script

```svelte before
<script context="module">
	import type { Load, LoadEvent, LoadOutput } from '@sveltejs/kit';
	export function load() {
		return {
			props: {
				sry: 'not anymore'
			}
		}
	}
</script>

<script>
	const whywouldyoudothis: Load = 'I dont know lol';
</script>
```

```svelte after
<script context="module">
	throw new Error("@migration task: Check code was safely removed (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292722)");

	// import type { Load, LoadEvent, LoadOutput } from '@sveltejs/kit';
	// export function load() {
	// 	return {
	// 		props: {
	// 			sry: 'not anymore'
	// 		}
	// 	}
	// }
</script>

<script>
	const whywouldyoudothis: Load = 'I dont know lol';
</script>
```

## Module context with export * from '..'

```svelte before
<script context="module">
	export * from './somewhere';
</script>
```

```svelte after
<script context="module">
	throw new Error("@migration task: Check code was safely removed (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292722)");

	// export * from './somewhere';
</script>
```

## Module context with named imports

```svelte before
<script context="module">
	import { bar } from './somewhere';
</script>

<script>
	let foo = bar;
</script>
```

```svelte after
<script context="module">
	throw new Error("@migration task: Check code was safely removed (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292722)");

	// import { bar } from './somewhere';
</script>

<script>
	let foo = bar;
</script>
```

## Module context with named imports that have same name as a load option

```svelte before
<script context="module">
	import { router } from './somewhere';
</script>

<script>
	let foo = router;
</script>
```

```svelte after
<script context="module">
	throw new Error("@migration task: Check code was safely removed (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292722)");

	// import { router } from './somewhere';
</script>

<script>
	let foo = router;
</script>
```

####### packages/migrate/migrations/routes/migrate_server/index.js #######

```

import ts from 'typescript';
import {
	automigration,
	uppercase_migration,
	error,
	get_function_node,
	get_object_nodes,
	is_new,
	is_string_like,
	manual_return_migration,
	parse,
	rewrite_returns,
	unwrap
} from '../utils.js';
import * as TASKS from '../tasks.js';
import { dedent, guess_indent, indent_at_line } from '../../../utils.js';

const give_up = `${error('Update +server.js', TASKS.STANDALONE_ENDPOINT)}\n\n`;

/**
 * @param {string} content
 * @returns {string}
 */
export function migrate_server(content) {
	const file = parse(content);
	if (!file) return give_up + content;

	const indent = guess_indent(content);

	const methods = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'].filter((name) =>
		file.exports.map.has(name)
	);

	// If user didn't do the uppercase verbs migration yet, do it here on the fly.
	const uppercased = uppercase_migration(methods, file);
	if (!uppercased) {
		return give_up + content;
	} else if (uppercased !== content) {
		return migrate_server(uppercased);
	}

	const unmigrated = new Set(methods);

	/** @type {Map<string, string>} */
	const imports = new Map();

	for (const statement of file.ast.statements) {
		for (const method of methods) {
			const fn = get_function_node(statement, /** @type{string} */ (file.exports.map.get(method)));
			if (fn?.body) {
				rewrite_returns(fn.body, (expr, node) => {
					// leave `() => new Response(...)` alone
					if (is_new(expr, 'Response')) return;

					const value = unwrap(expr);
					const nodes = ts.isObjectLiteralExpression(value) && get_object_nodes(value);

					if (nodes) {
						const body_is_object_literal = nodes.body && ts.isObjectLiteralExpression(nodes.body);

						if (body_is_object_literal || (nodes.body && ts.isIdentifier(nodes.body))) {
							let result;

							let name = 'json';
							let i = 1;
							while (content.includes(name)) name = `json$${i++}`;

							imports.set('json', name);

							const body = dedent(nodes.body.getText());

							if (nodes.headers || (nodes.status && nodes.status.getText() !== '200')) {
								const start = indent_at_line(content, expr.pos);
								const properties = [];

								if (nodes.status && nodes.status.getText() !== '200') {
									properties.push(`status: ${nodes.status.getText()}`);
								}

								if (nodes.headers) {
									properties.push(`headers: ${nodes.headers.getText()}`);
								}

								const ws = `\n${start}`;
								const init = `{${ws}${indent}${properties.join(`,${ws}${indent}`)}${ws}}`;

								result = `${name}(${body}, ${init})`;
							} else {
								result = `${name}(${body})`;
							}

							if (body_is_object_literal) {
								automigration(expr, file.code, result);
							} else {
								manual_return_migration(
									node || fn,
									file.code,
									TASKS.STANDALONE_ENDPOINT,
									`return ${result};`
								);
							}

							return;
						}

						let safe_headers = !nodes.headers || !ts.isObjectLiteralExpression(nodes.headers);
						if (nodes.headers && ts.isObjectLiteralExpression(nodes.headers)) {
							// if `headers` is an object literal, and it either doesn't contain
							// `set-cookie` or `set-cookie` is a string, then the headers
							// are safe to use in a `Response`
							const set_cookie_value = nodes.headers.properties.find((prop) => {
								return (
									ts.isPropertyAssignment(prop) &&
									ts.isStringLiteral(prop.name) &&
									/set-cookie/i.test(prop.name.text)
								);
							});

							if (!set_cookie_value || is_string_like(set_cookie_value)) {
								safe_headers = true;
							}
						}

						const safe_body =
							!nodes.body ||
							is_string_like(nodes.body) ||
							(ts.isCallExpression(nodes.body) &&
								nodes.body.expression.getText() === 'JSON.stringify');

						if (safe_headers) {
							const status = nodes.status ? nodes.status.getText() : '200';
							const headers = nodes.headers?.getText();
							const body = dedent(nodes.body?.getText() || 'undefined');

							const multiline = /\n/.test(headers);

							const init = [
								status !== '200' && `status: ${status}`,
								headers && `headers: ${headers}`
							].filter(Boolean);

							const indent = indent_at_line(content, expr.getStart());
							const end_whitespace = multiline ? `\n${indent}` : ' ';
							const join_whitespace = multiline ? end_whitespace + guess_indent(content) : ' ';

							const response =
								init.length > 0
									? `new Response(${body}, {${join_whitespace}${init.join(
											`,${join_whitespace}`
										)}${end_whitespace}})`
									: `new Response(${body})`;

							if (safe_body) {
								automigration(expr, file.code, response);
							} else {
								manual_return_migration(
									node || fn,
									file.code,
									TASKS.STANDALONE_ENDPOINT,
									`return ${response};`
								);
							}

							return;
						}
					}

					manual_return_migration(node || fn, file.code, TASKS.STANDALONE_ENDPOINT);
				});

				unmigrated.delete(method);
			}
		}
	}

	if (imports.size) {
		const has_imports = file.ast.statements.some((statement) => ts.isImportDeclaration(statement));
		const specifiers = Array.from(imports).map(([name, local]) =>
			name === local ? name : `${name} as ${local}`
		);
		const declaration = `import { ${specifiers.join(', ')} } from '@sveltejs/kit';`;
		file.code.prependLeft(0, declaration + (has_imports ? '\n' : '\n\n'));
	}

	if (unmigrated.size) {
		return give_up + file.code.toString();
	}

	return file.code.toString();
}

```


####### packages/migrate/migrations/routes/migrate_server/index.spec.js #######

```

import { assert, test } from 'vitest';
import { migrate_server } from './index.js';
import { read_samples } from '../../../utils.js';

for (const sample of read_samples(new URL('./samples.md', import.meta.url))) {
	test(sample.description, () => {
		const actual = migrate_server(sample.before);
		assert.equal(actual, sample.after);
	});
}

```


####### packages/migrate/migrations/routes/migrate_server/samples.md #######

## A GET function that returns a JSON object

```js before
export function GET() {
	return {
		body: {
			a: 1
		}
	};
}
```

```js after
import { json } from '@sveltejs/kit';

export function GET() {
	return json({
		a: 1
	});
}
```

## A GET function that returns a JSON object and already specifies a 'json' identifier

```js before
export function GET() {
	const json = 'shadow';

	return {
		body: {
			a: 1
		}
	};
}
```

```js after
import { json as json$1 } from '@sveltejs/kit';

export function GET() {
	const json = 'shadow';

	return json$1({
		a: 1
	});
}
```

## A GET function that returns a JSON object with custom headers

```js before
export function GET() {
	return {
		headers: {
			'x-foo': '123'
		},
		body: {
			a: 1
		}
	};
}
```

```js after
import { json } from '@sveltejs/kit';

export function GET() {
	return json({
		a: 1
	}, {
		headers: {
			'x-foo': '123'
		}
	});
}
```

## A GET arrow function that returns a JSON object

```js before
export const GET = () => ({
	body: {
		a: 1
	}
});
```

```js after
import { json } from '@sveltejs/kit';

export const GET = () => json({
	a: 1
});
```

## GET returns we can't migrate

```js before
export function GET() {
	if (a) {
		return {
			body
		};
	} else if (b) {
		return {
			body: new ReadableStream(),
			headers: {
				'content-type': 'octasomething'
			}
		}
	} else if (c) {
		return {
			body: 'string',
			headers: {
				'x-foo': 'bar'
			}
		}
	}
}
```

```js after
import { json } from '@sveltejs/kit';

export function GET() {
	if (a) {
		throw new Error("@migration task: Migrate this return statement (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292701)");
		// Suggestion (check for correctness before using):
		// return json(body);
		return {
			body
		};
	} else if (b) {
		throw new Error("@migration task: Migrate this return statement (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292701)");
		// Suggestion (check for correctness before using):
		// return new Response(new ReadableStream(), {
		// 	headers: {
		// 		'content-type': 'octasomething'
		// 	}
		// });
		return {
			body: new ReadableStream(),
			headers: {
				'content-type': 'octasomething'
			}
		}
	} else if (c) {
		return new Response('string', {
			headers: {
				'x-foo': 'bar'
			}
		})
	}
}
```

## A function that returns a Response

```js before
export const GET = () => new Response('text');
```

```js after
export const GET = () => new Response('text');
```

## A function that returns an unknown value

```js before
export const GET = () => createResponse('text');
```

```js after
throw new Error("@migration task: Migrate this return statement (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-3292701)");
export const GET = () => createResponse('text');
```

## A function that returns nothing

```js before
export function GET() {
	return;
}
```

```js after
export function GET() {
	return;
}
```

## A GET function that returns a JSON object

```js before
export function get() {
	return {
		body: {
			a: 1
		}
	};
}
```

```js after
import { json } from '@sveltejs/kit';

export function GET() {
	return json({
		a: 1
	});
}
```

####### packages/migrate/migrations/routes/tasks.js #######

```

export const STANDALONE_ENDPOINT = '3292701';
export const PAGE_ENDPOINT = '3292699';
export const PAGE_LOAD = '3292693';
export const PAGE_MODULE_CTX = '3292722';
export const PAGE_DATA_PROP = '3292707';

```


####### packages/migrate/migrations/routes/utils.js #######

```

import ts from 'typescript';
import MagicString from 'magic-string';
import { comment, indent_at_line } from '../../utils.js';

/**
 * @param {string} description
 * @param {string} [comment_id]
 */
export function task(description, comment_id) {
	return (
		`@migration task: ${description}` +
		(comment_id
			? ` (https://github.com/sveltejs/kit/discussions/5774#discussioncomment-${comment_id})`
			: '')
	);
}

/**
 * @param {string} description
 * @param {string} comment_id
 */
export function error(description, comment_id) {
	return `throw new Error(${JSON.stringify(task(description, comment_id))});`;
}

/** @param {string} content */
export function adjust_imports(content) {
	try {
		const ast = ts.createSourceFile(
			'filename.ts',
			content,
			ts.ScriptTarget.Latest,
			true,
			ts.ScriptKind.TS
		);

		const code = new MagicString(content);

		/** @param {number} pos */
		function adjust(pos) {
			// TypeScript AST is a clusterfuck, we need to step forward to find
			// where the node _actually_ starts
			while (content[pos] !== '.') pos += 1;

			// replace ../ with ../../ and ./ with ../
			code.prependLeft(pos, content[pos + 1] === '.' ? '../' : '.');
		}

		/** @param {ts.Node} node */
		function walk(node) {
			if (ts.isImportDeclaration(node)) {
				const text = /** @type {ts.StringLiteral} */ (node.moduleSpecifier).text;
				if (text[0] === '.') adjust(node.moduleSpecifier.pos);
			}

			if (ts.isCallExpression(node) && node.expression.getText() === 'import') {
				const arg = node.arguments[0];

				if (ts.isStringLiteral(arg)) {
					if (arg.text[0] === '.') adjust(arg.pos);
				} else if (ts.isTemplateLiteral(arg) && !ts.isNoSubstitutionTemplateLiteral(arg)) {
					if (arg.head.text[0] === '.') adjust(arg.head.pos);
				}
			}

			node.forEachChild(walk);
		}

		ast.forEachChild(walk);

		return code.toString();
	} catch {
		// this is enough of an edge case that it's probably fine to
		// just leave the code as we found it
		return content;
	}
}

/**
 *
 * @param {ts.Node} node
 * @param {MagicString} str
 * @param {string} comment_nr
 * @param {string} [suggestion]
 */
export function manual_return_migration(node, str, comment_nr, suggestion) {
	manual_migration(node, str, 'Migrate this return statement', comment_nr, suggestion);
}

/**
 * @param {ts.Node} node
 * @param {MagicString} str
 * @param {string} message
 * @param {string} comment_nr
 * @param {string} [suggestion]
 */
export function manual_migration(node, str, message, comment_nr, suggestion) {
	// handle case where this is called on a (arrow) function
	if (ts.isFunctionExpression(node) || ts.isArrowFunction(node)) {
		node = node.parent.parent.parent;
	}

	const indent = indent_at_line(str.original, node.getStart());

	let appended = '';

	if (suggestion) {
		appended = `\n${indent}// Suggestion (check for correctness before using):\n${indent}// ${comment(
			suggestion,
			indent
		)}`;
	}

	str.prependLeft(node.getStart(), error(message, comment_nr) + appended + `\n${indent}`);
}

/**
 *
 * @param {ts.Node} node
 * @param {MagicString} str
 * @param {string} migration
 */
export function automigration(node, str, migration) {
	str.overwrite(node.getStart(), node.getEnd(), migration);
}

/**
 * @param {ts.ObjectLiteralExpression} node
 */
export function get_object_nodes(node) {
	/** @type {Record<string, ts.Node>} */
	const obj = {};

	for (const property of node.properties) {
		if (ts.isPropertyAssignment(property) && ts.isIdentifier(property.name)) {
			obj[property.name.text] = property.initializer;
		} else if (ts.isShorthandPropertyAssignment(property)) {
			obj[property.name.text] = property.name;
		} else {
			return null; // object contains funky stuff like computed properties/accessors — bail
		}
	}

	return obj;
}

/**
 * @param {ts.Node} node
 */
export function is_string_like(node) {
	return (
		ts.isStringLiteral(node) ||
		ts.isTemplateExpression(node) ||
		ts.isNoSubstitutionTemplateLiteral(node)
	);
}

/** @param {ts.SourceFile} node */
export function get_exports(node) {
	/** @type {Map<string, string>} */
	const map = new Map();

	let complex = false;

	for (const statement of node.statements) {
		if (
			ts.isExportDeclaration(statement) &&
			statement.exportClause &&
			ts.isNamedExports(statement.exportClause)
		) {
			// export { x }, export { x as y }
			for (const specifier of statement.exportClause.elements) {
				map.set(specifier.name.text, specifier.propertyName?.text || specifier.name.text);
			}
		} else if (
			ts.isFunctionDeclaration(statement) &&
			statement.name &&
			ts.getModifiers(statement)?.[0]?.kind === ts.SyntaxKind.ExportKeyword
		) {
			// export function x ...
			map.set(statement.name.text, statement.name.text);
		} else if (
			ts.isVariableStatement(statement) &&
			ts.getModifiers(statement)?.[0]?.kind === ts.SyntaxKind.ExportKeyword
		) {
			// export const x = ..., y = ...
			for (const declaration of statement.declarationList.declarations) {
				if (ts.isIdentifier(declaration.name)) {
					map.set(declaration.name.text, declaration.name.text);
				} else {
					// might need to bail out on encountering this edge case,
					// because this stuff can get pretty intense
					complex = true;
				}
			}
		}
	}

	return { map, complex };
}

/**
 * @param {ts.Node} statement
 * @param {string[]} names
 * @returns {ts.FunctionDeclaration | ts.FunctionExpression | ts.ArrowFunction | undefined}
 */
export function get_function_node(statement, ...names) {
	if (
		ts.isFunctionDeclaration(statement) &&
		statement.name &&
		names.includes(statement.name.text)
	) {
		// export function x ...
		return statement;
	}

	if (ts.isVariableStatement(statement)) {
		for (const declaration of statement.declarationList.declarations) {
			if (
				ts.isIdentifier(declaration.name) &&
				names.includes(declaration.name.text) &&
				declaration.initializer &&
				(ts.isArrowFunction(declaration.initializer) ||
					ts.isFunctionExpression(declaration.initializer))
			) {
				// export const x = ...
				return declaration.initializer;
			}
		}
	}
}

/**
 * Utility for rewriting return statements.
 * If `node` is `undefined`, it means it's a concise arrow function body (`() => ({}))`.
 * Lone `return;` statements are left untouched.
 * @param {ts.Block | ts.ConciseBody} block
 * @param {(expression: ts.Expression, node: ts.ReturnStatement | undefined) => void} callback
 */
export function rewrite_returns(block, callback) {
	if (ts.isBlock(block)) {
		/** @param {ts.Node} node */
		function walk(node) {
			if (
				ts.isArrowFunction(node) ||
				ts.isFunctionExpression(node) ||
				ts.isFunctionDeclaration(node)
			) {
				// don't cross this boundary
				return;
			}

			if (ts.isReturnStatement(node) && node.expression) {
				callback(node.expression, node);
				return;
			}

			node.forEachChild(walk);
		}

		block.forEachChild(walk);
	} else {
		callback(block, undefined);
	}
}

/** @param {ts.Node} node */
export function unwrap(node) {
	if (ts.isParenthesizedExpression(node)) {
		return node.expression;
	}

	return node;
}

/**
 * @param {ts.Node} node
 * @param {string} name
 * @returns {node is ts.isNewExpression}
 */
export function is_new(node, name) {
	return (
		ts.isNewExpression(node) && ts.isIdentifier(node.expression) && node.expression.text === name
	);
}

/** @param {string} content */
export function parse(content) {
	try {
		const ast = ts.createSourceFile(
			'filename.ts',
			content,
			ts.ScriptTarget.Latest,
			true,
			ts.ScriptKind.TS
		);

		const code = new MagicString(content);

		return {
			ast,
			code,
			exports: get_exports(ast)
		};
	} catch {
		return null;
	}
}

/**
 * @param {ts.Node} node
 * @param {MagicString} code
 * @param {string} old_type
 * @param {string} new_type
 */
export function rewrite_type(node, code, old_type, new_type) {
	// @ts-ignore
	const jsDoc = node.jsDoc || node.parent?.parent?.parent?.jsDoc;
	if (jsDoc) {
		// @ts-ignore
		for (const comment of jsDoc) {
			const str = comment.getText();
			const index = str.indexOf(old_type);

			if (index !== -1) {
				code.overwrite(comment.pos + index, comment.pos + index + old_type.length, new_type);
			}
		}
	}

	// @ts-ignore
	const type = node.type || node.parent.type; // handle both fn and var declarations

	if (type?.typeName?.escapedText.startsWith(old_type)) {
		const start = type.getStart();
		code.overwrite(start, start + old_type.length, new_type);
	}
}

/**
 * Does the HTTP verbs uppercase migration if it didn't happen yet. If a string
 * is returned, the migration was done or wasn't needed. If undefined is returned,
 * the migration is needed but couldn't be done.
 *
 * @param {string[]} methods
 * @param {NonNullable<ReturnType<typeof parse>>} file
 */
export function uppercase_migration(methods, file) {
	const old_methods = new Set(
		['get', 'post', 'put', 'patch', 'del'].filter((name) => file.exports.map.has(name))
	);

	if (old_methods.size && !methods.length) {
		for (const statement of file.ast.statements) {
			for (const method of old_methods) {
				const fn = get_function_node(
					statement,
					/** @type{string} */ (file.exports.map.get(method))
				);
				if (!fn?.name) {
					continue;
				}
				file.code.overwrite(
					fn.name.getStart(),
					fn.name.getEnd(),
					method === 'del' ? 'DELETE' : method.toUpperCase()
				);
				old_methods.delete(method);
			}
		}
	}

	return old_methods.size ? undefined : file.code.toString();
}

```


####### packages/migrate/migrations/self-closing-tags/index.js #######

```

import colors from 'kleur';
import fs from 'node:fs';
import prompts from 'prompts';
import glob from 'tiny-glob/sync.js';
import { remove_self_closing_tags } from './migrate.js';
import { pathToFileURL } from 'node:url';
import { resolve } from 'import-meta-resolve';

export async function migrate() {
	let compiler;
	try {
		compiler = await import_from_cwd('svelte/compiler');
	} catch (e) {
		console.log(colors.bold().red('❌ Could not find a local Svelte installation.'));
		return;
	}

	console.log(
		colors.bold().yellow('\nThis will update .svelte files inside the current directory\n')
	);

	const response = await prompts({
		type: 'confirm',
		name: 'value',
		message: 'Continue?',
		initial: false
	});

	if (!response.value) {
		process.exit(1);
	}

	const files = glob('**/*.svelte')
		.map((file) => file.replace(/\\/g, '/'))
		.filter((file) => !file.includes('/node_modules/'));

	for (const file of files) {
		try {
			const code = await remove_self_closing_tags(compiler, fs.readFileSync(file, 'utf-8'));
			fs.writeFileSync(file, code);
		} catch (e) {
			// continue
		}
	}

	console.log(colors.bold().green('✔ Your project has been updated'));
	console.log('  If using Prettier, please upgrade to the latest prettier-plugin-svelte version');
}

/** @param {string} name */
async function import_from_cwd(name) {
	const cwd = pathToFileURL(process.cwd()).href;
	const url = await resolve(name, cwd + '/x.js');

	return import(url);
}

```


####### packages/migrate/migrations/self-closing-tags/migrate.js #######

```

import MagicString from 'magic-string';
import { walk } from 'zimmerframe';

const VoidElements = [
	'area',
	'base',
	'br',
	'col',
	'embed',
	'hr',
	'img',
	'input',
	'keygen',
	'link',
	'menuitem',
	'meta',
	'param',
	'source',
	'track',
	'wbr'
];

const SVGElements = [
	'altGlyph',
	'altGlyphDef',
	'altGlyphItem',
	'animate',
	'animateColor',
	'animateMotion',
	'animateTransform',
	'circle',
	'clipPath',
	'color-profile',
	'cursor',
	'defs',
	'desc',
	'discard',
	'ellipse',
	'feBlend',
	'feColorMatrix',
	'feComponentTransfer',
	'feComposite',
	'feConvolveMatrix',
	'feDiffuseLighting',
	'feDisplacementMap',
	'feDistantLight',
	'feDropShadow',
	'feFlood',
	'feFuncA',
	'feFuncB',
	'feFuncG',
	'feFuncR',
	'feGaussianBlur',
	'feImage',
	'feMerge',
	'feMergeNode',
	'feMorphology',
	'feOffset',
	'fePointLight',
	'feSpecularLighting',
	'feSpotLight',
	'feTile',
	'feTurbulence',
	'filter',
	'font',
	'font-face',
	'font-face-format',
	'font-face-name',
	'font-face-src',
	'font-face-uri',
	'foreignObject',
	'g',
	'glyph',
	'glyphRef',
	'hatch',
	'hatchpath',
	'hkern',
	'image',
	'line',
	'linearGradient',
	'marker',
	'mask',
	'mesh',
	'meshgradient',
	'meshpatch',
	'meshrow',
	'metadata',
	'missing-glyph',
	'mpath',
	'path',
	'pattern',
	'polygon',
	'polyline',
	'radialGradient',
	'rect',
	'set',
	'solidcolor',
	'stop',
	'svg',
	'switch',
	'symbol',
	'text',
	'textPath',
	'tref',
	'tspan',
	'unknown',
	'use',
	'view',
	'vkern'
];

/**
 * @param {{ preprocess: any, parse: any }} svelte_compiler
 * @param {string} source
 */
export async function remove_self_closing_tags({ preprocess, parse }, source) {
	const preprocessed = await preprocess(source, {
		/** @param {{ content: string }} input */
		script: ({ content }) => ({
			code: content
				.split('\n')
				.map((line) => ' '.repeat(line.length))
				.join('\n')
		}),
		/** @param {{ content: string }} input */
		style: ({ content }) => ({
			code: content
				.split('\n')
				.map((line) => ' '.repeat(line.length))
				.join('\n')
		})
	});
	const ast = parse(preprocessed.code);
	const ms = new MagicString(source);
	/** @type {Array<() => void>} */
	const updates = [];
	let is_foreign = false;
	let is_custom_element = false;

	walk(ast.html, null, {
		_(node, { next, stop }) {
			if (node.type === 'Options') {
				const namespace = node.attributes.find(
					/** @param {any} a */
					(a) => a.type === 'Attribute' && a.name === 'namespace'
				);
				if (namespace?.value[0].data === 'foreign') {
					is_foreign = true;
					stop();
					return;
				}

				is_custom_element = node.attributes.some(
					/** @param {any} a */
					(a) => a.type === 'Attribute' && (a.name === 'customElement' || a.name === 'tag')
				);
			}

			if (node.type === 'Element' || node.type === 'Slot') {
				const is_self_closing = source[node.end - 2] === '/';
				if (
					!is_self_closing ||
					VoidElements.includes(node.name) ||
					SVGElements.includes(node.name) ||
					!/^[a-z0-9_-]+$/.test(node.name)
				) {
					next();
					return;
				}

				let start = node.end - 2;
				if (source[start - 1] === ' ') {
					start--;
				}
				updates.push(() => {
					if (node.type === 'Element' || is_custom_element) {
						ms.update(start, node.end, `></${node.name}>`);
					}
				});
			}

			next();
		}
	});

	if (is_foreign) {
		return source;
	}

	updates.forEach((update) => update());
	return ms.toString();
}

```


####### packages/migrate/migrations/self-closing-tags/migrate.spec.js #######

```

import { assert, test } from 'vitest';
import * as compiler from 'svelte/compiler';
import { remove_self_closing_tags } from './migrate.js';

/** @type {Record<string, string>} */
const tests = {
	'<div/>': '<div></div>',
	'<div />': '<div></div>',
	'<custom-element />': '<custom-element></custom-element>',
	'<div class="foo"/>': '<div class="foo"></div>',
	'<div class="foo" />': '<div class="foo"></div>',
	'\t<div\n\t\tonclick={blah}\n\t/>': '\t<div\n\t\tonclick={blah}\n\t></div>',
	'<foo-bar/>': '<foo-bar></foo-bar>',
	'<link/>': '<link/>',
	'<link />': '<link />',
	'<svg><g /></svg>': '<svg><g /></svg>',
	'<slot />': '<slot />',
	'<svelte:options customElement="my-element" /><slot />':
		'<svelte:options customElement="my-element" /><slot></slot>',
	'<svelte:options namespace="foreign" /><foo />': '<svelte:options namespace="foreign" /><foo />',
	'<script>console.log("<div />")</script>': '<script>console.log("<div />")</script>',
	'<script lang="ts">let a: string = ""</script><div />':
		'<script lang="ts">let a: string = ""</script><div></div>',
	'<div><i/></div>': '<div><i></i></div>'
};

for (const input in tests) {
	test(input, async () => {
		const output = tests[input];
		assert.equal(await remove_self_closing_tags(compiler, input), output);
	});
}

```


####### packages/migrate/migrations/svelte-4/index.js #######

```

import colors from 'kleur';
import fs from 'node:fs';
import prompts from 'prompts';
import glob from 'tiny-glob/sync.js';
import { bail, check_git, update_js_file, update_svelte_file } from '../../utils.js';
import { transform_code, transform_svelte_code, update_pkg_json } from './migrate.js';

export async function migrate() {
	if (!fs.existsSync('package.json')) {
		bail('Please re-run this script in a directory with a package.json');
	}

	console.log(
		colors
			.bold()
			.yellow(
				'\nThis will update files in the current directory\n' +
					"If you're inside a monorepo, don't run this in the root directory, rather run it in all projects independently.\n"
			)
	);

	const use_git = check_git();

	const response = await prompts({
		type: 'confirm',
		name: 'value',
		message: 'Continue?',
		initial: false
	});

	if (!response.value) {
		process.exit(1);
	}

	const folders = await prompts({
		type: 'multiselect',
		name: 'value',
		message: 'Which folders should be migrated?',
		choices: fs
			.readdirSync('.')
			.filter(
				(dir) => fs.statSync(dir).isDirectory() && dir !== 'node_modules' && !dir.startsWith('.')
			)
			.map((dir) => ({ title: dir, value: dir, selected: true }))
	});

	if (!folders.value?.length) {
		process.exit(1);
	}

	const migrate_transition = await prompts({
		type: 'confirm',
		name: 'value',
		message:
			'Add the `|global` modifier to currently global transitions for backwards compatibility? More info at https://svelte.dev/docs/v4-migration-guide#transitions-are-local-by-default',
		initial: true
	});

	update_pkg_json();

	// const { default: config } = fs.existsSync('svelte.config.js')
	// 	? await import(pathToFileURL(path.resolve('svelte.config.js')).href)
	// 	: { default: {} };

	/** @type {string[]} */
	const svelte_extensions = /* config.extensions ?? - disabled because it would break .svx */ [
		'.svelte'
	];
	const extensions = [...svelte_extensions, '.ts', '.js'];
	// For some reason {folders.value.join(',')} as part of the glob doesn't work and returns less files
	const files = folders.value.flatMap(
		/** @param {string} folder */ (folder) =>
			glob(`${folder}/**`, { filesOnly: true, dot: true })
				.map((file) => file.replace(/\\/g, '/'))
				.filter((file) => !file.includes('/node_modules/'))
	);

	for (const file of files) {
		if (extensions.some((ext) => file.endsWith(ext))) {
			if (svelte_extensions.some((ext) => file.endsWith(ext))) {
				update_svelte_file(file, transform_code, (code) =>
					transform_svelte_code(code, migrate_transition.value)
				);
			} else {
				update_js_file(file, transform_code);
			}
		}
	}

	console.log(colors.bold().green('✔ Your project has been migrated'));

	console.log('\nRecommended next steps:\n');

	const cyan = colors.bold().cyan;

	const tasks = [
		use_git && cyan('git commit -m "migration to Svelte 4"'),
		'Review the migration guide at https://svelte.dev/docs/v4-migration-guide',
		'Read the updated docs at https://svelte.dev/docs'
	].filter(Boolean);

	tasks.forEach((task, i) => {
		console.log(`  ${i + 1}: ${task}`);
	});

	console.log('');

	if (use_git) {
		console.log(`Run ${cyan('git diff')} to review changes.\n`);
	}
}

```


####### packages/migrate/migrations/svelte-4/migrate.js #######

```

import fs from 'node:fs';
import { Project, ts, Node } from 'ts-morph';
import { log_migration, log_on_ts_modification, update_pkg } from '../../utils.js';

export function update_pkg_json() {
	fs.writeFileSync(
		'package.json',
		update_pkg_json_content(fs.readFileSync('package.json', 'utf8'))
	);
}

/**
 * @param {string} content
 */
export function update_pkg_json_content(content) {
	return update_pkg(content, [
		['svelte', '^4.0.0'],
		['svelte-check', '^3.4.3'],
		['svelte-preprocess', '^5.0.3'],
		['@sveltejs/kit', '^1.20.4'],
		['@sveltejs/vite-plugin-svelte', '^2.4.1'],
		[
			'svelte-loader',
			'^3.1.8',
			' (if you are still on webpack 4, you need to update to webpack 5)'
		],
		['rollup-plugin-svelte', '^7.1.5'],
		['prettier-plugin-svelte', '^2.10.1'],
		['eslint-plugin-svelte', '^2.30.0'],
		[
			'eslint-plugin-svelte3',
			'^4.0.0',
			' (this package is deprecated, use eslint-plugin-svelte instead. More info: https://svelte.dev/docs/v4-migration-guide#new-eslint-package)'
		],
		[
			'typescript',
			'^5.0.0',
			' (this might introduce new type errors due to breaking changes within TypeScript)'
		]
	]);
}

/**
 * @param {string} code
 * @param {boolean} is_ts
 */
export function transform_code(code, is_ts) {
	const project = new Project({ useInMemoryFileSystem: true });
	const source = project.createSourceFile('svelte.ts', code);
	update_imports(source, is_ts);
	update_typeof_svelte_component(source, is_ts);
	update_action_types(source, is_ts);
	update_action_return_types(source, is_ts);
	return source.getFullText();
}

/**
 * @param {string} code
 * @param {boolean} migrate_transition
 */
export function transform_svelte_code(code, migrate_transition) {
	code = update_svelte_options(code);
	return update_transitions(code, migrate_transition);
}

/**
 * <svelte:options tag=".." /> -> <svelte:options customElement=".." />
 * @param {string} code
 */
function update_svelte_options(code) {
	return code.replace(/<svelte:options([^]*?)\stag=([^]*?)\/?>/, (match) => {
		log_migration(
			'Replaced `svelte:options` `tag` attribute with `customElement` attribute: https://svelte.dev/docs/v4-migration-guide#custom-elements-with-svelte'
		);
		return match.replace('tag=', 'customElement=');
	});
}

/**
 * transition/in/out:x -> transition/in/out:x|global
 * transition/in/out|local:x -> transition/in/out:x
 * @param {string} code
 * @param {boolean} migrate_transition
 */
function update_transitions(code, migrate_transition) {
	if (migrate_transition) {
		const replaced = code.replace(/(\s)(transition:|in:|out:)(\w+)(?=[\s>=])/g, '$1$2$3|global');
		if (replaced !== code) {
			log_migration(
				'Added `|global` to `transition`, `in`, and `out` directives (transitions are local by default now): https://svelte.dev/docs/v4-migration-guide#transitions-are-local-by-default'
			);
		}
		code = replaced;
	}
	const replaced = code.replace(/(\s)(transition:|in:|out:)(\w+)(\|local)(?=[\s>=])/g, '$1$2$3');
	if (replaced !== code) {
		log_migration(
			'Removed `|local` from `transition`, `in`, and `out` directives (transitions are local by default now): https://svelte.dev/docs/v4-migration-guide#transitions-are-local-by-default'
		);
	}
	return replaced;
}

/**
 * Action<T> -> Action<T, any>
 * @param {import('ts-morph').SourceFile} source
 * @param {boolean} is_ts
 */
function update_action_types(source, is_ts) {
	const logger = log_on_ts_modification(
		source,
		'Updated `Action` interface usages: https://svelte.dev/docs/v4-migration-guide#stricter-types-for-svelte-functions'
	);

	const imports = get_imports(source, 'svelte/action', 'Action');
	for (const namedImport of imports) {
		const identifiers = find_identifiers(source, namedImport.getAliasNode()?.getText() ?? 'Action');
		for (const id of identifiers) {
			const parent = id.getParent();
			if (Node.isTypeReference(parent)) {
				const type_args = parent.getTypeArguments();
				if (type_args.length === 1) {
					parent.addTypeArgument('any');
				} else if (type_args.length === 0) {
					parent.addTypeArgument('HTMLElement');
					parent.addTypeArgument('any');
				}
			}
		}
	}

	if (!is_ts) {
		replaceInJsDoc(source, (text) => {
			return text.replace(
				/import\((['"])svelte\/action['"]\).Action(<\w+>)?(?=[^<\w]|$)/g,
				(_, quote, type) =>
					`import(${quote}svelte/action${quote}).Action<${
						type ? type.slice(1, -1) + '' : 'HTMLElement'
					}, any>`
			);
		});
	}

	logger();
}

/**
 * ActionReturn -> ActionReturn<any>
 * @param {import('ts-morph').SourceFile} source
 * @param {boolean} is_ts
 */
function update_action_return_types(source, is_ts) {
	const logger = log_on_ts_modification(
		source,
		'Updated `ActionReturn` interface usages: https://svelte.dev/docs/v4-migration-guide#stricter-types-for-svelte-functions'
	);

	const imports = get_imports(source, 'svelte/action', 'ActionReturn');
	for (const namedImport of imports) {
		const identifiers = find_identifiers(
			source,
			namedImport.getAliasNode()?.getText() ?? 'ActionReturn'
		);
		for (const id of identifiers) {
			const parent = id.getParent();
			if (Node.isTypeReference(parent)) {
				const type_args = parent.getTypeArguments();
				if (type_args.length === 0) {
					parent.addTypeArgument('any');
				}
			}
		}
	}

	if (!is_ts) {
		replaceInJsDoc(source, (text) => {
			return text.replace(
				/import\((['"])svelte\/action['"]\).ActionReturn(?=[^<\w]|$)/g,
				'import($1svelte/action$1).ActionReturn<any>'
			);
		});
	}

	logger();
}

/**
 * SvelteComponentTyped -> SvelteComponent
 * @param {import('ts-morph').SourceFile} source
 * @param {boolean} is_ts
 */
function update_imports(source, is_ts) {
	const logger = log_on_ts_modification(
		source,
		'Replaced `SvelteComponentTyped` imports with `SvelteComponent` imports: https://svelte.dev/docs/v4-migration-guide#stricter-types-for-svelte-functions'
	);

	const identifiers = find_identifiers(source, 'SvelteComponent');
	const can_rename = identifiers.every((id) => {
		const parent = id.getParent();
		return (
			(Node.isImportSpecifier(parent) &&
				!parent.getAliasNode() &&
				parent.getParent().getParent().getParent().getModuleSpecifier().getText() === 'svelte') ||
			!is_declaration(parent)
		);
	});

	const imports = get_imports(source, 'svelte', 'SvelteComponentTyped');
	for (const namedImport of imports) {
		if (can_rename) {
			namedImport.renameAlias('SvelteComponent');
			if (
				namedImport
					.getParent()
					.getElements()
					.some((e) => !e.getAliasNode() && e.getNameNode().getText() === 'SvelteComponent')
			) {
				namedImport.remove();
			} else {
				namedImport.setName('SvelteComponent');
				namedImport.removeAlias();
			}
		} else {
			namedImport.renameAlias('SvelteComponentTyped');
			namedImport.setName('SvelteComponent');
		}
	}

	if (!is_ts) {
		replaceInJsDoc(source, (text) => {
			return text.replace(
				/import\((['"])svelte['"]\)\.SvelteComponentTyped(?=\W|$)/g,
				'import($1svelte$1).SvelteComponent'
			);
		});
	}

	logger();
}

/**
 * typeof SvelteComponent -> typeof SvelteComponent<any>
 * @param {import('ts-morph').SourceFile} source
 * @param {boolean} is_ts
 */
function update_typeof_svelte_component(source, is_ts) {
	const logger = log_on_ts_modification(
		source,
		'Adjusted `typeof SvelteComponent` to `typeof SvelteComponent<any>`: https://svelte.dev/docs/v4-migration-guide#stricter-types-for-svelte-functions'
	);

	const imports = get_imports(source, 'svelte', 'SvelteComponent');

	for (const type of imports) {
		if (type) {
			const name = type.getAliasNode() ?? type.getNameNode();
			name.findReferencesAsNodes().forEach((ref) => {
				const parent = ref.getParent();
				if (parent && Node.isTypeQuery(parent)) {
					const id = parent.getFirstChildByKind(ts.SyntaxKind.Identifier);
					if (id?.getText() === name.getText()) {
						const typeArguments = parent.getTypeArguments();
						if (typeArguments.length === 0) {
							parent.addTypeArgument('any');
						}
					}
				}
			});
		}
	}

	if (!is_ts) {
		replaceInJsDoc(source, (text) => {
			return text.replace(
				/typeof import\((['"])svelte['"]\)\.SvelteComponent(?=[^<\w]|$)/g,
				'typeof import($1svelte$1).SvelteComponent<any>'
			);
		});
	}

	logger();
}

/**
 * @param {import('ts-morph').SourceFile} source
 * @param {string} from
 * @param {string} name
 */
function get_imports(source, from, name) {
	return source
		.getImportDeclarations()
		.filter((i) => i.getModuleSpecifierValue() === from)
		.flatMap((i) => i.getNamedImports())
		.filter((i) => i.getName() === name);
}

/**
 * @param {import('ts-morph').SourceFile} source
 * @param {string} name
 */
function find_identifiers(source, name) {
	return source.getDescendantsOfKind(ts.SyntaxKind.Identifier).filter((i) => i.getText() === name);
}

/**
 * Does not include imports
 * @param {Node} node
 */
function is_declaration(node) {
	return (
		Node.isVariableDeclaration(node) ||
		Node.isFunctionDeclaration(node) ||
		Node.isClassDeclaration(node) ||
		Node.isTypeAliasDeclaration(node) ||
		Node.isInterfaceDeclaration(node)
	);
}

/**
 * @param {import('ts-morph').SourceFile} source
 * @param {(text: string) => string | undefined} replacer
 */
function replaceInJsDoc(source, replacer) {
	source.forEachChild((node) => {
		if (Node.isJSDocable(node)) {
			const tags = node.getJsDocs().flatMap((jsdoc) => jsdoc.getTags());
			tags.forEach((t) =>
				t.forEachChild((c) => {
					if (Node.isJSDocTypeExpression(c)) {
						const text = c.getText().slice(1, -1);
						const replacement = replacer(text);
						if (replacement && replacement !== text) {
							c.replaceWithText(`{${replacement}}`);
						}
					}
				})
			);
		}
	});
}

```


####### packages/migrate/migrations/svelte-4/migrate.spec.js #######

```

import { assert, test } from 'vitest';
import { transform_code, transform_svelte_code, update_pkg_json_content } from './migrate.js';

test('Updates SvelteComponentTyped #1', () => {
	const result = transform_code(
		`import { SvelteComponentTyped } from 'svelte';
        
export class Foo extends SvelteComponentTyped<{}> {}

const bar: SvelteComponentTyped = null;`,
		true
	);
	assert.equal(
		result,
		`import { SvelteComponent } from 'svelte';
        
export class Foo extends SvelteComponent<{}> {}

const bar: SvelteComponent = null;`
	);
});

test('Updates SvelteComponentTyped #2', () => {
	const result = transform_code(
		`import { SvelteComponentTyped, SvelteComponent } from 'svelte';
        
export class Foo extends SvelteComponentTyped<{}> {}

const bar: SvelteComponentTyped = null;
const baz: SvelteComponent = null;`,
		true
	);
	assert.equal(
		result,
		`import { SvelteComponent } from 'svelte';
        
export class Foo extends SvelteComponent<{}> {}

const bar: SvelteComponent = null;
const baz: SvelteComponent = null;`
	);
});

test('Updates SvelteComponentTyped #3', () => {
	const result = transform_code(
		`import { SvelteComponentTyped } from 'svelte';

interface SvelteComponent {}

export class Foo extends SvelteComponentTyped<{}> {}

const bar: SvelteComponentTyped = null;
const baz: SvelteComponent = null;`,
		true
	);
	assert.equal(
		result,
		`import { SvelteComponent as SvelteComponentTyped } from 'svelte';

interface SvelteComponent {}

export class Foo extends SvelteComponentTyped<{}> {}

const bar: SvelteComponentTyped = null;
const baz: SvelteComponent = null;`
	);
});

test('Updates SvelteComponentTyped (jsdoc)', () => {
	const result = transform_code(
		`
		/** @type {import('svelte').SvelteComponentTyped} */
		const bar = null;
		/** @type {import('svelte').SvelteComponentTyped<any>} */
		const baz = null;
		`,
		false
	);
	assert.equal(
		result,
		`
		/** @type {import('svelte').SvelteComponent} */
		const bar = null;
		/** @type {import('svelte').SvelteComponent<any>} */
		const baz = null;
		`
	);
});

test('Updates typeof SvelteComponent', () => {
	const result = transform_code(
		`import { SvelteComponent } from 'svelte';
		import { SvelteComponent as C } from 'svelte';

        const a: typeof SvelteComponent = null;
        function b(c: typeof SvelteComponent) {}
		const c: typeof SvelteComponent<any> = null;
		const d: typeof C = null;
        `,
		true
	);
	assert.equal(
		result,
		`import { SvelteComponent } from 'svelte';
		import { SvelteComponent as C } from 'svelte';

        const a: typeof SvelteComponent<any> = null;
        function b(c: typeof SvelteComponent<any>) {}
		const c: typeof SvelteComponent<any> = null;
		const d: typeof C<any> = null;
        `
	);
});

test('Updates typeof SvelteComponent (jsdoc)', () => {
	const result = transform_code(
		`
		/** @type {typeof import('svelte').SvelteComponent} */
        const a = null;
		/** @type {typeof import('svelte').SvelteComponent<any>} */
		const c = null;
		/** @type {typeof C} */
		const d: typeof C = null;
        `,
		false
	);
	assert.equal(
		result,
		`
		/** @type {typeof import('svelte').SvelteComponent<any>} */
        const a = null;
		/** @type {typeof import('svelte').SvelteComponent<any>} */
		const c = null;
		/** @type {typeof C} */
		const d: typeof C = null;
        `
	);
});

test('Updates Action and ActionReturn', () => {
	const result = transform_code(
		`import type { Action, ActionReturn } from 'svelte/action';

        const a: Action = () => {};
        const b: Action<HTMLDivElement> = () => {};
        const c: Action<HTMLDivElement, true> = () => {};
        const d: Action<HTMLDivElement, true, {}> = () => {};
		const e: ActionReturn = () => {};
		const f: ActionReturn<true> = () => {};
		const g: ActionReturn<true, {}> = () => {};
        `,
		true
	);
	assert.equal(
		result,

		`import type { Action, ActionReturn } from 'svelte/action';

        const a: Action<HTMLElement, any> = () => {};
        const b: Action<HTMLDivElement, any> = () => {};
        const c: Action<HTMLDivElement, true> = () => {};
        const d: Action<HTMLDivElement, true, {}> = () => {};
		const e: ActionReturn<any> = () => {};
		const f: ActionReturn<true> = () => {};
		const g: ActionReturn<true, {}> = () => {};
        `
	);
});

test('Updates Action and ActionReturn (jsdoc)', () => {
	const result = transform_code(
		`
		/** @type {import('svelte/action').Action} */
        const a = () => {};
		/** @type {import('svelte/action').Action<HTMLDivElement>} */
        const b = () => {};
		/** @type {import('svelte/action').Action<HTMLDivElement, true>} */
        const c = () => {};
		/** @type {import('svelte/action').Action<HTMLDivElement, true, {}>} */
        const d = () => {};
		/** @type {import('svelte/action').ActionReturn} */
		const e = () => {};
		/** @type {import('svelte/action').ActionReturn<true>} */
		const f = () => {};
		/** @type {import('svelte/action').ActionReturn<true, {}>} */
		const g = () => {};
        `,
		false
	);
	assert.equal(
		result,

		`
		/** @type {import('svelte/action').Action<HTMLElement, any>} */
        const a = () => {};
		/** @type {import('svelte/action').Action<HTMLDivElement, any>} */
        const b = () => {};
		/** @type {import('svelte/action').Action<HTMLDivElement, true>} */
        const c = () => {};
		/** @type {import('svelte/action').Action<HTMLDivElement, true, {}>} */
        const d = () => {};
		/** @type {import('svelte/action').ActionReturn<any>} */
		const e = () => {};
		/** @type {import('svelte/action').ActionReturn<true>} */
		const f = () => {};
		/** @type {import('svelte/action').ActionReturn<true, {}>} */
		const g = () => {};
        `
	);
});

test('Updates svelte:options #1', () => {
	const result = transform_svelte_code(
		`<svelte:options tag="asd-asd" />
		
		<div>hi</div>`,
		true
	);
	assert.equal(
		result,
		`<svelte:options customElement="asd-asd" />
		
		<div>hi</div>`
	);
});

test('Updates svelte:options #2', () => {
	const result = transform_svelte_code(
		`<script>
		export let foo;
		</script>
		
		<svelte:options
			immutable={true}
			tag="asd-asd"></svelte:options>
		
		<div>hi</div>`,
		true
	);
	assert.equal(
		result,
		`<script>
		export let foo;
		</script>
		
		<svelte:options
			immutable={true}
			customElement="asd-asd"></svelte:options>
		
		<div>hi</div>`
	);
});

test('Updates transitions', () => {
	const result = transform_svelte_code(
		`<div transition:fade />
		<div transition:fade={true} />
		<div transition:fade></div>
		<div transition:fade|local />
		<div in:fade />
		<div in:fade={true} />
		<div in:fade></div>
		<div in:fade|local />
		<div out:fade />
		<div out:fade={true} />
		<div out:fade></div>
		<div out:fade|local />

		<div transitionn:fade />
		<div allin:fade />
		`,
		true
	);
	assert.equal(
		result,
		`<div transition:fade|global />
		<div transition:fade|global={true} />
		<div transition:fade|global></div>
		<div transition:fade />
		<div in:fade|global />
		<div in:fade|global={true} />
		<div in:fade|global></div>
		<div in:fade />
		<div out:fade|global />
		<div out:fade|global={true} />
		<div out:fade|global></div>
		<div out:fade />

		<div transitionn:fade />
		<div allin:fade />
		`
	);
});

test('Updates transitions #2', () => {
	const result = transform_svelte_code(
		`<div transition:fade />
		<div transition:fade={true} />
		<div transition:fade></div>
		<div transition:fade|local />
		<div in:fade />
		<div in:fade={true} />
		<div in:fade></div>
		<div in:fade|local />
		<div out:fade />
		<div out:fade={true} />
		<div out:fade></div>
		<div out:fade|local />

		<div transitionn:fade />
		<div allin:fade />
		`,
		false
	);
	assert.equal(
		result,
		`<div transition:fade />
		<div transition:fade={true} />
		<div transition:fade></div>
		<div transition:fade />
		<div in:fade />
		<div in:fade={true} />
		<div in:fade></div>
		<div in:fade />
		<div out:fade />
		<div out:fade={true} />
		<div out:fade></div>
		<div out:fade />

		<div transitionn:fade />
		<div allin:fade />
		`
	);
});

test('Update package.json', () => {
	const result = update_pkg_json_content(`{
	"name": "svelte-app",
	"version": "1.0.0",
	"devDependencies": {
		"svelte": "^3.0.0",
		"svelte-check": "^1.0.0",
		"svelte-preprocess": "^5.0.0"
	},
	"dependencies": {
		"@sveltejs/kit": "^1.0.0"
	}
}`);
	assert.equal(
		result,
		`{
	"name": "svelte-app",
	"version": "1.0.0",
	"devDependencies": {
		"svelte": "^4.0.0",
		"svelte-check": "^3.4.3",
		"svelte-preprocess": "^5.0.3"
	},
	"dependencies": {
		"@sveltejs/kit": "^1.20.4"
	}
}`
	);
});

test('Does not downgrade versions', () => {
	const result = update_pkg_json_content(`{
	"devDependencies": {
		"svelte": "^4.0.5",
		"typescript": "github:idk"
	}
}`);
	assert.equal(
		result,
		`{
	"devDependencies": {
		"svelte": "^4.0.5",
		"typescript": "github:idk"
	}
}`
	);
});

```


####### packages/migrate/migrations/sveltekit-2/index.js #######

```

import colors from 'kleur';
import fs from 'node:fs';
import prompts from 'prompts';
import semver from 'semver';
import glob from 'tiny-glob/sync.js';
import {
	bail,
	check_git,
	update_js_file,
	update_svelte_file,
	update_tsconfig
} from '../../utils.js';
import { migrate as migrate_svelte_4 } from '../svelte-4/index.js';
import {
	transform_code,
	update_pkg_json,
	update_svelte_config,
	update_tsconfig_content
} from './migrate.js';

export async function migrate() {
	if (!fs.existsSync('package.json')) {
		bail('Please re-run this script in a directory with a package.json');
	}

	if (!fs.existsSync('svelte.config.js')) {
		bail('Please re-run this script in a directory with a svelte.config.js');
	}

	console.log(
		colors
			.bold()
			.yellow(
				'\nThis will update files in the current directory\n' +
					"If you're inside a monorepo, run this in individual project directories rather than the workspace root.\n"
			)
	);

	const use_git = check_git();

	const response = await prompts({
		type: 'confirm',
		name: 'value',
		message: 'Continue?',
		initial: false
	});

	if (!response.value) {
		process.exit(1);
	}

	const pkg = JSON.parse(fs.readFileSync('package.json', 'utf8'));
	const svelte_dep = pkg.devDependencies?.svelte ?? pkg.dependencies?.svelte;
	if (svelte_dep === undefined) {
		bail('Please install Svelte before continuing');
	}

	if (semver.validRange(svelte_dep) && semver.gtr('4.0.0', svelte_dep)) {
		console.log(
			colors
				.bold()
				.yellow(
					'\nSvelteKit 2 requires Svelte 4 or newer. We recommend running the `svelte-4` migration first (`npx svelte-migrate svelte-4`).\n'
				)
		);
		const response = await prompts({
			type: 'confirm',
			name: 'value',
			message: 'Run `svelte-4` migration now?',
			initial: false
		});
		if (!response.value) {
			process.exit(1);
		} else {
			await migrate_svelte_4();
			console.log(
				colors
					.bold()
					.green('`svelte-4` migration complete. Continue with `sveltekit-2` migration?\n')
			);
			const response = await prompts({
				type: 'confirm',
				name: 'value',
				message: 'Continue?',
				initial: false
			});
			if (!response.value) {
				process.exit(1);
			}
		}
	}

	const folders = await prompts({
		type: 'multiselect',
		name: 'value',
		message: 'Which folders should be migrated?',
		choices: fs
			.readdirSync('.')
			.filter(
				(dir) =>
					fs.statSync(dir).isDirectory() &&
					dir !== 'node_modules' &&
					dir !== 'dist' &&
					!dir.startsWith('.')
			)
			.map((dir) => ({ title: dir, value: dir, selected: dir === 'src' }))
	});

	if (!folders.value?.length) {
		process.exit(1);
	}

	update_pkg_json();
	update_tsconfig(update_tsconfig_content);
	update_svelte_config();

	// const { default: config } = fs.existsSync('svelte.config.js')
	// 	? await import(pathToFileURL(path.resolve('svelte.config.js')).href)
	// 	: { default: {} };

	/** @type {string[]} */
	const svelte_extensions = /* config.extensions ?? - disabled because it would break .svx */ [
		'.svelte'
	];
	const extensions = [...svelte_extensions, '.ts', '.js'];
	// For some reason {folders.value.join(',')} as part of the glob doesn't work and returns less files
	const files = folders.value.flatMap(
		/** @param {string} folder */ (folder) =>
			glob(`${folder}/**`, { filesOnly: true, dot: true })
				.map((file) => file.replace(/\\/g, '/'))
				.filter((file) => !file.includes('/node_modules/'))
	);

	for (const file of files) {
		if (extensions.some((ext) => file.endsWith(ext))) {
			if (svelte_extensions.some((ext) => file.endsWith(ext))) {
				update_svelte_file(file, transform_code, (code) => code);
			} else {
				update_js_file(file, transform_code);
			}
		}
	}

	console.log(colors.bold().green('✔ Your project has been migrated'));

	console.log('\nRecommended next steps:\n');

	const cyan = colors.bold().cyan;

	const tasks = [
		'Run npm install (or the corresponding installation command of your package manager)',
		use_git && cyan('git commit -m "migration to SvelteKit 2"'),
		'Review the migration guide at https://kit.svelte.dev/docs/migrating-to-sveltekit-2',
		'Read the updated docs at https://kit.svelte.dev/docs'
	].filter(Boolean);

	tasks.forEach((task, i) => {
		console.log(`  ${i + 1}: ${task}`);
	});

	console.log('');

	if (use_git) {
		console.log(`Run ${cyan('git diff')} to review changes.\n`);
	}
}

```


####### packages/migrate/migrations/sveltekit-2/migrate.js #######

```

import fs from 'node:fs';
import { Project, Node, SyntaxKind } from 'ts-morph';
import { log_migration, log_on_ts_modification, update_pkg } from '../../utils.js';
import path from 'node:path';

export function update_pkg_json() {
	fs.writeFileSync(
		'package.json',
		update_pkg_json_content(fs.readFileSync('package.json', 'utf8'))
	);
}

/**
 * @param {string} content
 */
export function update_pkg_json_content(content) {
	return update_pkg(content, [
		// All other bumps are done as part of the Svelte 4 migration
		['@sveltejs/kit', '^2.0.0'],
		['@sveltejs/adapter-static', '^3.0.0'],
		['@sveltejs/adapter-node', '^2.0.0'],
		['@sveltejs/adapter-vercel', '^4.0.0'],
		['@sveltejs/adapter-netlify', '^3.0.0'],
		['@sveltejs/adapter-cloudflare', '^3.0.0'],
		['@sveltejs/adapter-cloudflare-workers', '^2.0.0'],
		['@sveltejs/adapter-auto', '^3.0.0'],
		['vite', '^5.0.0'],
		['vitest', '^1.0.0'],
		['typescript', '^5.0.0'], // should already be done by Svelte 4 migration, but who knows
		[
			'@sveltejs/vite-plugin-svelte',
			'^3.0.0',
			' (vite-plugin-svelte is a peer dependency of SvelteKit now)',
			'devDependencies'
		]
	]);
}

/** @param {string} content */
export function update_tsconfig_content(content) {
	if (!content.includes('"extends"')) {
		// Don't touch the tsconfig if people opted out of our default config
		return content;
	}

	let updated = content
		.split('\n')
		.filter(
			(line) => !line.includes('importsNotUsedAsValues') && !line.includes('preserveValueImports')
		)
		.join('\n');
	if (updated !== content) {
		log_migration(
			'Removed deprecated `importsNotUsedAsValues` and `preserveValueImports`' +
				' from tsconfig.json: https://kit.svelte.dev/docs/migrating-to-sveltekit-2#updated-dependency-requirements'
		);
	}

	content = updated;
	updated = content.replace('"moduleResolution": "node"', '"moduleResolution": "bundler"');
	if (updated !== content) {
		log_migration(
			'Updated `moduleResolution` to `bundler`' +
				' in tsconfig.json: https://kit.svelte.dev/docs/migrating-to-sveltekit-2#updated-dependency-requirements'
		);
	}

	if (content.includes('"paths":') || content.includes('"baseUrl":')) {
		log_migration(
			'`paths` and/or `baseUrl` detected in your tsconfig.json - remove it and use `kit.alias` instead: https://kit.svelte.dev/docs/migrating-to-sveltekit-2#generated-tsconfig-json-is-more-strict'
		);
	}

	return updated;
}

export function update_svelte_config() {
	fs.writeFileSync(
		'svelte.config.js',
		update_svelte_config_content(fs.readFileSync('svelte.config.js', 'utf8'))
	);
}

/**
 * @param {string} code
 */
export function update_svelte_config_content(code) {
	const regex = /\s*dangerZone:\s*{[^}]*},?/g;
	const result = code.replace(regex, '');
	if (result !== code) {
		log_migration(
			'Removed `dangerZone` from svelte.config.js: https://kit.svelte.dev/docs/migrating-to-sveltekit-2#server-fetches-are-not-trackable-anymore'
		);
	}

	const project = new Project({ useInMemoryFileSystem: true });
	const source = project.createSourceFile('svelte.ts', result);

	const namedImport = get_import(source, '@sveltejs/kit/vite', 'vitePreprocess');
	if (!namedImport) return result;

	const logger = log_on_ts_modification(
		source,
		'Changed `vitePreprocess` import: https://kit.svelte.dev/docs/migrating-to-sveltekit-2#vitepreprocess-is-no-longer-exported-from-sveltejs-kit-vite'
	);

	if (namedImport.getParent().getParent().getNamedImports().length === 1) {
		namedImport
			.getParent()
			.getParent()
			.getParent()
			.setModuleSpecifier('@sveltejs/vite-plugin-svelte');
	} else {
		namedImport.remove();
		const vps = source.getImportDeclaration(
			(i) => i.getModuleSpecifierValue() === '@sveltejs/vite-plugin-svelte'
		);
		if (vps) {
			vps.addNamedImport('vitePreprocess');
		} else {
			source.addImportDeclaration({
				moduleSpecifier: '@sveltejs/vite-plugin-svelte',
				namedImports: ['vitePreprocess']
			});
		}
	}

	logger();
	return source.getFullText();
}

/**
 * @param {string} code
 * @param {boolean} _is_ts
 * @param {string} file_path
 */
export function transform_code(code, _is_ts, file_path) {
	const project = new Project({ useInMemoryFileSystem: true });
	const source = project.createSourceFile('svelte.ts', code);
	remove_throws(source);
	add_cookie_note(file_path, source);
	replace_resolve_path(source);
	return source.getFullText();
}

/**
 * `throw redirect(..)` -> `redirect(..)`
 * @param {import('ts-morph').SourceFile} source
 */
function remove_throws(source) {
	const logger = log_on_ts_modification(
		source,
		'Removed `throw` from redirect/error functions: https://kit.svelte.dev/docs/migrating-to-sveltekit-2#redirect-and-error-are-no-longer-thrown-by-you'
	);

	/** @param {string} id */
	function remove_throw(id) {
		const namedImport = get_import(source, '@sveltejs/kit', id);
		if (!namedImport) return;
		for (const id of namedImport.getNameNode().findReferencesAsNodes()) {
			const call_expression = id.getParent();
			const throw_stmt = call_expression?.getParent();
			if (Node.isCallExpression(call_expression) && Node.isThrowStatement(throw_stmt)) {
				throw_stmt.replaceWithText((writer) => {
					writer.setIndentationLevel(0);
					writer.write(call_expression.getText() + ';');
				});
			}
		}
	}

	remove_throw('redirect');
	remove_throw('error');

	logger();
}

/**
 * Adds `path` option to `cookies.set/delete/serialize` calls
 * @param {string} file_path
 * @param {import('ts-morph').SourceFile} source
 */
function add_cookie_note(file_path, source) {
	const basename = path.basename(file_path);
	if (
		basename !== '+page.js' &&
		basename !== '+page.ts' &&
		basename !== '+page.server.js' &&
		basename !== '+page.server.ts' &&
		basename !== '+server.js' &&
		basename !== '+server.ts' &&
		basename !== 'hooks.server.js' &&
		basename !== 'hooks.server.ts'
	) {
		return;
	}

	const logger = log_on_ts_modification(
		source,
		'Search codebase for `@migration` and manually add the `path` option to `cookies.set/delete/serialize` calls: https://kit.svelte.dev/docs/migrating-to-sveltekit-2#path-is-now-a-required-option-for-cookies'
	);

	const calls = [];

	for (const call of source.getDescendantsOfKind(SyntaxKind.CallExpression)) {
		const expression = call.getExpression();
		if (!Node.isPropertyAccessExpression(expression)) {
			continue;
		}

		const name = expression.getName();
		if (name !== 'set' && name !== 'delete' && name !== 'serialize') {
			continue;
		}

		if (call.getText().includes('path')) {
			continue;
		}

		const options_arg = call.getArguments()[name === 'delete' ? 1 : 2];
		if (options_arg && !Node.isObjectLiteralExpression(options_arg)) {
			continue;
		}

		const parent_function = call.getFirstAncestor(
			/** @returns {ancestor is import('ts-morph').FunctionDeclaration | import('ts-morph').FunctionExpression | import('ts-morph').ArrowFunction} */
			(ancestor) => {
				// Check if this is inside a function
				const fn_declaration = ancestor.asKind(SyntaxKind.FunctionDeclaration);
				const fn_expression = ancestor.asKind(SyntaxKind.FunctionExpression);
				const arrow_fn_expression = ancestor.asKind(SyntaxKind.ArrowFunction);
				return !!fn_declaration || !!fn_expression || !!arrow_fn_expression;
			}
		);
		if (!parent_function) {
			continue;
		}

		const expression_text = expression.getExpression().getText();
		if (
			expression_text !== 'cookies' &&
			(!expression_text.includes('.') ||
				expression_text.split('.').pop() !== 'cookies' ||
				!parent_function.getParameter(expression_text.split('.')[0]))
		) {
			continue;
		}

		const parent = call.getFirstAncestorByKind(SyntaxKind.Block);
		if (!parent) {
			continue;
		}

		calls.push(() =>
			call.replaceWithText((writer) => {
				writer.setIndentationLevel(0); // prevent ts-morph from being unhelpful and adding its own indentation
				writer.write('/* @migration task: add path argument */ ' + call.getText());
			})
		);
	}

	for (const call of calls) {
		call();
	}

	logger();
}

/**
 * `resolvePath` from `@sveltejs/kit` -> `resolveRoute` from `$app/paths`
 * @param {import('ts-morph').SourceFile} source
 */
function replace_resolve_path(source) {
	const namedImport = get_import(source, '@sveltejs/kit', 'resolvePath');
	if (!namedImport) return;

	const logger = log_on_ts_modification(
		source,
		'Replaced `resolvePath` with `resolveRoute`: https://kit.svelte.dev/docs/migrating-to-sveltekit-2#resolvePath-has-been-removed'
	);

	for (const id of namedImport.getNameNode().findReferencesAsNodes()) {
		id.replaceWithText('resolveRoute');
	}
	if (namedImport.getParent().getParent().getNamedImports().length === 1) {
		namedImport.getParent().getParent().getParent().remove();
	} else {
		namedImport.remove();
	}

	const paths_import = source.getImportDeclaration(
		(i) => i.getModuleSpecifierValue() === '$app/paths'
	);
	if (paths_import) {
		paths_import.addNamedImport('resolveRoute');
	} else {
		source.addImportDeclaration({
			moduleSpecifier: '$app/paths',
			namedImports: ['resolveRoute']
		});
	}

	logger();
}

/**
 * @param {import('ts-morph').SourceFile} source
 * @param {string} from
 * @param {string} name
 */
function get_import(source, from, name) {
	return source
		.getImportDeclarations()
		.filter((i) => i.getModuleSpecifierValue() === from)
		.flatMap((i) => i.getNamedImports())
		.find((i) => i.getName() === name);
}

```


####### packages/migrate/migrations/sveltekit-2/migrate.spec.js #######

```

import { assert, test } from 'vitest';
import {
	transform_code,
	update_svelte_config_content,
	update_tsconfig_content
} from './migrate.js';
import { read_samples } from '../../utils.js';

for (const sample of read_samples(new URL('./svelte-config-samples.md', import.meta.url))) {
	test('svelte.config.js: ' + sample.description, () => {
		const actual = update_svelte_config_content(sample.before);
		assert.equal(actual, sample.after);
	});
}

for (const sample of read_samples(new URL('./tsconfig-samples.md', import.meta.url))) {
	test('tsconfig.json: ' + sample.description, () => {
		const actual = update_tsconfig_content(sample.before);
		assert.equal(actual, sample.after);
	});
}

for (const sample of read_samples(new URL('./tsjs-samples.md', import.meta.url))) {
	test('JS/TS file: ' + sample.description, () => {
		const actual = transform_code(
			sample.before,
			sample.filename?.endsWith('.ts') ?? false,
			sample.filename ?? '+page.js'
		);
		assert.equal(actual, sample.after);
	});
}

```


####### packages/migrate/migrations/sveltekit-2/svelte-config-samples.md #######

## Removes dangerZone (1)

```js before
export default {
	kit: {
		foo: bar,
		dangerZone: {
			trackServerFetches: true
		},
		baz: qux
	}
};
```

```js after
export default {
	kit: {
		foo: bar,
		baz: qux
	}
};
```

## Removes dangerZone (2)

```js before
export default {
	kit: {
		foo: bar,
		dangerZone: {
			trackServerFetches: true
		}
	}
};
```

<!-- prettier-ignore -->
```js after
export default {
	kit: {
		foo: bar,
	}
};
```

## Replaces vitePreprocess import (1)

```js before
import adapter from '@sveltejs/adapter-auto';
import { vitePreprocess } from '@sveltejs/kit/vite';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	// Consult https://kit.svelte.dev/docs/integrations#preprocessors
	// for more information about preprocessors
	preprocess: vitePreprocess(),

	kit: {
		adapter: adapter()
	}
};

export default config;
```

```js after
import adapter from '@sveltejs/adapter-auto';
import { vitePreprocess } from '@sveltejs/vite-plugin-svelte';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	// Consult https://kit.svelte.dev/docs/integrations#preprocessors
	// for more information about preprocessors
	preprocess: vitePreprocess(),

	kit: {
		adapter: adapter()
	}
};

export default config;
```

## Replaces vitePreprocess import (2)

```js before
import adapter from '@sveltejs/adapter-auto';
import { vitePreprocess, foo } from '@sveltejs/kit/vite';

export default {
	preprocess: vitePreprocess()
};
```

<!-- prettier-ignore -->
```js after
import adapter from '@sveltejs/adapter-auto';
import { foo } from '@sveltejs/kit/vite';
import { vitePreprocess } from "@sveltejs/vite-plugin-svelte";

export default {
	preprocess: vitePreprocess()
};
```

## Replaces vitePreprocess import (3)

```js before
import adapter from '@sveltejs/adapter-auto';
import { vitePreprocess, foo } from '@sveltejs/kit/vite';
import { a } from '@sveltejs/vite-plugin-svelte';

export default {
	preprocess: vitePreprocess()
};
```

```js after
import adapter from '@sveltejs/adapter-auto';
import { foo } from '@sveltejs/kit/vite';
import { a, vitePreprocess } from '@sveltejs/vite-plugin-svelte';

export default {
	preprocess: vitePreprocess()
};
```

####### packages/migrate/migrations/sveltekit-2/tsconfig-samples.md #######

## Removes importsNotUsedAsValues/preserveValueImports

```json before
{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"importsNotUsedAsValues": "error",
		"preserveValueImports": true
	}
}
```

<!-- prettier-ignore -->
```json after
{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
	}
}
```

## Leaves tsconfig alone

```json before
{
	"compilerOptions": {
		"importsNotUsedAsValues": "error",
		"preserveValueImports": true
	}
}
```

```json after
{
	"compilerOptions": {
		"importsNotUsedAsValues": "error",
		"preserveValueImports": true
	}
}
```

####### packages/migrate/migrations/sveltekit-2/tsjs-samples.md #######

## Removes throws

```js before
import { redirect, error } from '@sveltejs/kit';

throw redirect();
redirect();
throw error();
error();
function x() {
	let redirect = true;
	throw redirect();
}
```

```js after
import { redirect, error } from '@sveltejs/kit';

redirect();
redirect();
error();
error();
function x() {
	let redirect = true;
	throw redirect();
}
```

## Leaves redirect/error from other sources alone

```js before
import { redirect, error } from 'somewhere-else';

throw redirect();
redirect();
throw error();
error();
```

```js after
import { redirect, error } from 'somewhere-else';

throw redirect();
redirect();
throw error();
error();
```

## Notes cookie migration

```js before
export function load({ cookies }) {
	cookies.set('foo', 'bar');
}
```

```js after
export function load({ cookies }) {
	/* @migration task: add path argument */ cookies.set('foo', 'bar');
}
```

## Notes cookie migration with multiple occurences

```js before
export function load({ cookies }) {
	cookies.delete('foo');
	cookies.set('x', 'y', { z: '' });
}
```

```js after
export function load({ cookies }) {
	/* @migration task: add path argument */ cookies.delete('foo');
	/* @migration task: add path argument */ cookies.set('x', 'y', { z: '' });
}
```

## Handles non-destructured argument

```js before
export function load(event) {
	event.cookies.set('x', 'y');
}
```

```js after
export function load(event) {
	/* @migration task: add path argument */ event.cookies.set('x', 'y');
}
```

## Recognizes cookies false positives

```js before
export function load({ cookies }) {
	cookies.set('foo', 'bar', { path: '/' });
}

export function foo(event) {
	x.cookies.set('foo', 'bar');
}

export function bar(event) {
	event.x.set('foo', 'bar');
}

cookies.set('foo', 'bar');
```

```js after
export function load({ cookies }) {
	cookies.set('foo', 'bar', { path: '/' });
}

export function foo(event) {
	x.cookies.set('foo', 'bar');
}

export function bar(event) {
	event.x.set('foo', 'bar');
}

cookies.set('foo', 'bar');
```

## Replaces resolvePath

```js before
import { resolvePath } from '@sveltejs/kit';

resolvePath('x', y);
```

<!-- prettier-ignore -->
```js after
import { resolveRoute } from "$app/paths";

resolveRoute('x', y);
```

## Replaces resolvePath taking care of imports

```js before
import { resolvePath, x } from '@sveltejs/kit';
import { y } from '$app/paths';

resolvePath('x');
```

```js after
import { x } from '@sveltejs/kit';
import { y, resolveRoute } from '$app/paths';

resolveRoute('x');
```

## Doesn't replace resolvePath from other sources

```js before
import { resolvePath } from 'x';

resolvePath('x');
```

```js after
import { resolvePath } from 'x';

resolvePath('x');
```

####### packages/migrate/package.json #######

```

{
	"name": "svelte-migrate",
	"version": "1.4.0",
	"description": "A CLI for migrating Svelte(Kit) codebases",
	"repository": {
		"type": "git",
		"url": "https://github.com/sveltejs/kit",
		"directory": "packages/migrate"
	},
	"license": "MIT",
	"homepage": "https://kit.svelte.dev",
	"publishConfig": {
		"access": "public"
	},
	"type": "module",
	"bin": {
		"svelte-migrate": "./bin.js"
	},
	"files": [
		"bin.js",
		"migrations",
		"utils.js",
		"!migrations/**/*.spec.js",
		"!migrations/**/samples.md"
	],
	"dependencies": {
		"import-meta-resolve": "^4.0.0",
		"kleur": "^4.1.5",
		"magic-string": "^0.30.5",
		"prompts": "^2.4.2",
		"semver": "^7.5.4",
		"tiny-glob": "^0.2.9",
		"ts-morph": "^22.0.0",
		"typescript": "^5.3.3",
		"zimmerframe": "^1.1.2"
	},
	"devDependencies": {
		"@types/node": "^18.19.3",
		"@types/prompts": "^2.4.9",
		"@types/semver": "^7.5.6",
		"prettier": "^3.1.1",
		"svelte": "^4.2.10",
		"vitest": "^1.5.0"
	},
	"scripts": {
		"test": "vitest run --silent",
		"check": "tsc",
		"lint": "prettier --check .",
		"format": "pnpm lint --write"
	}
}

```


####### packages/migrate/README.md #######

# svelte-migrate

A CLI for migrating Svelte(Kit) codebases.

Run it using

```
npx svelte-migrate [migration]
```

Or if you're using `pnpm`:

```
pnpm dlx svelte-migrate [migration]
```

## Migrations

| Migration     | From                  | To                    | Guide                                                           |
| ------------- | --------------------- | --------------------- | --------------------------------------------------------------- |
| `sveltekit-2` | SvelteKit 1.0         | SvelteKit 2.0         | [Website](https://kit.svelte.dev/docs/migrating-to-sveltekit-2) |
| `svelte-4`    | Svelte 3              | Svelte 4              | [Website](https://svelte.dev/docs/v4-migration-guide)           |
| `package`     | `@sveltejs/package@1` | `@sveltejs/package@2` | [#8922](https://github.com/sveltejs/kit/pull/8922)              |
| `routes`      | SvelteKit pre-1.0     | SvelteKit 1.0         | [#5774](https://github.com/sveltejs/kit/discussions/5774)       |

Some migrations may annotate your codebase with tasks for completion that you can find by searching for `@migration`.

## Changelog

[The Changelog for this package is available on GitHub](https://github.com/sveltejs/kit/blob/main/packages/migrate/CHANGELOG.md).

####### packages/migrate/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true,
		"strict": true,
		"target": "es2022",
		"module": "node16",
		"moduleResolution": "node16",
		"allowSyntheticDefaultImports": true
	},
	"include": ["./migrations/**/*", "./utils.js", "./bin.js"]
}

```


####### packages/migrate/utils.js #######

```

import colors from 'kleur';
import MagicString from 'magic-string';
import { execFileSync, execSync } from 'node:child_process';
import fs from 'node:fs';
import path from 'node:path';
import semver from 'semver';
import ts from 'typescript';

/** @param {string} message */
export function bail(message) {
	console.error(colors.bold().red(message));
	process.exit(1);
}

/** @param {string} file */
export function relative(file) {
	return path.relative('.', file);
}
/**
 *
 * @param {string} file
 * @param {string} renamed
 * @param {string} content
 * @param {boolean} use_git
 */
export function move_file(file, renamed, content, use_git) {
	if (use_git) {
		execFileSync('git', ['mv', file, renamed]);
	} else {
		fs.unlinkSync(file);
	}

	fs.writeFileSync(renamed, content);
}

/**
 * @param {string} contents
 * @param {string} indent
 */
export function comment(contents, indent) {
	return contents.replace(new RegExp(`^${indent}`, 'gm'), `${indent}// `);
}

/** @param {string} content */
export function dedent(content) {
	const indent = guess_indent(content);
	if (!indent) return content;

	/** @type {string[]} */
	const substitutions = [];

	try {
		const ast = ts.createSourceFile(
			'filename.ts',
			content,
			ts.ScriptTarget.Latest,
			true,
			ts.ScriptKind.TS
		);

		const code = new MagicString(content);

		/** @param {ts.Node} node */
		function walk(node) {
			if (ts.isTemplateLiteral(node)) {
				let pos = node.pos;
				while (/\s/.test(content[pos])) pos += 1;

				code.overwrite(pos, node.end, `____SUBSTITUTION_${substitutions.length}____`);
				substitutions.push(node.getText());
			}

			node.forEachChild(walk);
		}

		ast.forEachChild(walk);

		return code
			.toString()
			.replace(new RegExp(`^${indent}`, 'gm'), '')
			.replace(/____SUBSTITUTION_(\d+)____/g, (match, index) => substitutions[index]);
	} catch {
		// as above — ignore this edge case
		return content;
	}
}

/** @param {string} content */
export function guess_indent(content) {
	const lines = content.split('\n');

	const tabbed = lines.filter((line) => /^\t+/.test(line));
	const spaced = lines.filter((line) => /^ {2,}/.test(line));

	if (tabbed.length === 0 && spaced.length === 0) {
		return null;
	}

	// More lines tabbed than spaced? Assume tabs, and
	// default to tabs in the case of a tie (or nothing
	// to go on)
	if (tabbed.length >= spaced.length) {
		return '\t';
	}

	// Otherwise, we need to guess the multiple
	const min = spaced.reduce((previous, current) => {
		const count = /^ +/.exec(current)?.[0].length ?? 0;
		return Math.min(count, previous);
	}, Infinity);

	return ' '.repeat(min);
}

/**
 * @param {string} content
 * @param {number} offset
 */
export function indent_at_line(content, offset) {
	const substr = content.substring(content.lastIndexOf('\n', offset) + 1, offset);
	return /\s*/.exec(substr)?.[0] ?? '';
}

/**
 * @param {string} content
 * @param {string} except
 */
export function except_str(content, except) {
	const start = content.indexOf(except);
	const end = start + except.length;
	return content.substring(0, start) + content.substring(end);
}

/**
 * @returns {boolean} True if git is installed
 */
export function check_git() {
	let use_git = false;

	let dir = process.cwd();
	do {
		if (fs.existsSync(path.join(dir, '.git'))) {
			use_git = true;
			break;
		}
	} while (dir !== (dir = path.dirname(dir)));

	if (use_git) {
		try {
			const status = execSync('git status --porcelain', { stdio: 'pipe' }).toString();

			if (status) {
				const message =
					'Your git working directory is dirty — we recommend committing your changes before running this migration.\n';
				console.log(colors.bold().red(message));
			}
		} catch {
			// would be weird to have a .git folder if git is not installed,
			// but always expect the unexpected
			const message =
				'Could not detect a git installation. If this is unexpected, please raise an issue: https://github.com/sveltejs/kit.\n';
			console.log(colors.bold().red(message));
			use_git = false;
		}
	}

	return use_git;
}

/**
 * Get a list of all files in a directory
 * @param {string} cwd - the directory to walk
 * @param {boolean} [dirs] - whether to include directories in the result
 */
export function walk(cwd, dirs = false) {
	/** @type {string[]} */
	const all_files = [];

	/** @param {string} dir */
	function walk_dir(dir) {
		const files = fs.readdirSync(path.join(cwd, dir));

		for (const file of files) {
			const joined = path.join(dir, file);
			const stats = fs.statSync(path.join(cwd, joined));
			if (stats.isDirectory()) {
				if (dirs) all_files.push(joined);
				walk_dir(joined);
			} else {
				all_files.push(joined);
			}
		}
	}

	return walk_dir(''), all_files;
}

/** @param {string} str */
export function posixify(str) {
	return str.replace(/\\/g, '/');
}

/**
 * @param {string} content
 * @param {Array<[string, string, string?, ('dependencies' | 'devDependencies')?]>} updates
 */
export function update_pkg(content, updates) {
	const indent = content.split('\n')[1].match(/^\s+/)?.[0] || '  ';
	const pkg = JSON.parse(content);

	/**
	 * @param {string} name
	 * @param {string} version
	 * @param {string} [additional]
	 * @param {'dependencies' | 'devDependencies' | undefined} [insert]
	 */
	function update_pkg(name, version, additional = '', insert) {
		/**
		 * @param {string} type
		 */
		const updateVersion = (type) => {
			const existingRange = pkg[type]?.[name];

			if (
				existingRange &&
				semver.validRange(existingRange) &&
				!semver.subset(existingRange, version)
			) {
				// Check if the new version range is an upgrade
				const minExistingVersion = semver.minVersion(existingRange);
				const minNewVersion = semver.minVersion(version);

				if (minExistingVersion && minNewVersion && semver.gt(minNewVersion, minExistingVersion)) {
					log_migration(`Updated ${name} to ${version}`);
					pkg[type][name] = version;
				}
			}
		};

		updateVersion('dependencies');
		updateVersion('devDependencies');

		if (insert && !pkg[insert]?.[name]) {
			if (!pkg[insert]) pkg[insert] = {};

			// Insert the property in sorted position without adjusting other positions so diffs are easier to read
			const sorted_keys = Object.keys(pkg[insert]).sort();
			const index = sorted_keys.findIndex((key) => name.localeCompare(key) === -1);
			const insert_index = index !== -1 ? index : sorted_keys.length;
			const new_properties = Object.entries(pkg[insert]);
			new_properties.splice(insert_index, 0, [name, version]);
			pkg[insert] = Object.fromEntries(new_properties);

			log_migration(`Added ${name} version ${version} ${additional}`);
		}
	}

	for (const update of updates) {
		update_pkg(...update);
	}

	return JSON.stringify(pkg, null, indent);
}

const logged_migrations = new Set();

/**
 * @param {import('ts-morph').SourceFile} source
 * @param {string} text
 */
export function log_on_ts_modification(source, text) {
	let logged = false;
	const log = () => {
		if (!logged) {
			logged = true;
			log_migration(text);
		}
	};
	source.onModified(log);
	return () => source.onModified(log, false);
}

/** @param {string} text */
export function log_migration(text) {
	if (logged_migrations.has(text)) return;
	console.log(text);
	logged_migrations.add(text);
}

/**
 * Parses the scripts contents and invoked `transform_script_code` with it, then runs the result through `transform_svelte_code`.
 * The result is written back to disk.
 * @param {string} file_path
 * @param {(code: string, is_ts: boolean, file_path: string) => string} transform_script_code
 * @param {(code: string, file_path: string) => string} transform_svelte_code
 */
export function update_svelte_file(file_path, transform_script_code, transform_svelte_code) {
	try {
		const content = fs.readFileSync(file_path, 'utf-8');
		const updated = content.replace(
			/<script([^]*?)>([^]+?)<\/script>(\n*)/g,
			(_match, attrs, contents, whitespace) => {
				return `<script${attrs}>${transform_script_code(
					contents,
					(attrs.includes('lang=') || attrs.includes('type=')) &&
						(attrs.includes('ts') || attrs.includes('typescript')),
					file_path
				)}</script>${whitespace}`;
			}
		);
		fs.writeFileSync(file_path, transform_svelte_code(updated, file_path), 'utf-8');
	} catch (e) {
		console.error(`Error updating ${file_path}:`, e);
	}
}

/**
 * Reads the file and invokes `transform_code` with its contents. The result is written back to disk.
 * @param {string} file_path
 * @param {(code: string, is_ts: boolean, file_path: string) => string} transform_code
 */
export function update_js_file(file_path, transform_code) {
	try {
		const content = fs.readFileSync(file_path, 'utf-8');
		const updated = transform_code(content, file_path.endsWith('.ts'), file_path);
		fs.writeFileSync(file_path, updated, 'utf-8');
	} catch (e) {
		console.error(`Error updating ${file_path}:`, e);
	}
}

/**
 * Updates the tsconfig/jsconfig.json file with the provided function.
 * @param {(content: string) => string} update_tsconfig_content
 */
export function update_tsconfig(update_tsconfig_content) {
	const file = fs.existsSync('tsconfig.json')
		? 'tsconfig.json'
		: fs.existsSync('jsconfig.json')
			? 'jsconfig.json'
			: null;
	if (file) {
		fs.writeFileSync(file, update_tsconfig_content(fs.readFileSync(file, 'utf8')));
	}
}

/** @param {string | URL} test_file */
export function read_samples(test_file) {
	const markdown = fs.readFileSync(test_file, 'utf8').replaceAll('\r\n', '\n');
	const samples = markdown
		.split(/^##/gm)
		.slice(1)
		.map((block) => {
			const description = block.split('\n')[0];
			const before = /```(js|ts|svelte) before\n([^]*?)\n```/.exec(block);
			const after = /```(js|ts|svelte) after\n([^]*?)\n```/.exec(block);

			const match = /> file: (.+)/.exec(block);

			return {
				description,
				before: before ? before[2] : '',
				after: after ? after[2] : '',
				filename: match?.[1],
				solo: block.includes('> solo')
			};
		});

	if (samples.some((sample) => sample.solo)) {
		return samples.filter((sample) => sample.solo);
	}

	return samples;
}

```


####### packages/migrate/utils.spec.js #######

```

import { assert, test } from 'vitest';
import { update_pkg } from './utils.js';

test('Inserts package at correct position (1)', () => {
	const result = update_pkg(
		`{
	"dependencies": {
		"a": "1",
		"z": "3",
		"c": "4"
	}
}`,
		[['b', '2', '', 'dependencies']]
	);

	assert.equal(
		result,
		`{
	"dependencies": {
		"a": "1",
		"b": "2",
		"z": "3",
		"c": "4"
	}
}`
	);
});

test('Inserts package at correct position (2)', () => {
	const result = update_pkg(
		`{
	"dependencies": {
		"a": "1",
		"b": "2"
	}
}`,
		[['c', '3', '', 'dependencies']]
	);

	assert.equal(
		result,
		`{
	"dependencies": {
		"a": "1",
		"b": "2",
		"c": "3"
	}
}`
	);
});

test('Inserts package at correct position (3)', () => {
	const result = update_pkg(
		`{
	"dependencies": {
		"b": "2",
		"c": "3"
	}
}`,
		[['a', '1', '', 'dependencies']]
	);

	assert.equal(
		result,
		`{
	"dependencies": {
		"a": "1",
		"b": "2",
		"c": "3"
	}
}`
	);
});

test('Does not downgrade versions', () => {
	const result = update_pkg(
		`{
	"devDependencies": {
		"@sveltejs/kit": "^2.4.3"
	}
}`,
		[['@sveltejs/kit', '^2.0.0']]
	);

	assert.equal(
		result,
		`{
	"devDependencies": {
		"@sveltejs/kit": "^2.4.3"
	}
}`
	);
});

```


####### packages/package/CHANGELOG.md #######

# @sveltejs/package

## 2.3.1

### Patch Changes

- fix: don't strip `lang="ts"` tag in Svelte 5 ([#12080](https://github.com/sveltejs/kit/pull/12080))

## 2.3.0

### Minor Changes

- feat: add option to specify the tsconfig/jsconfig ([#11698](https://github.com/sveltejs/kit/pull/11698))

## 2.2.7

### Patch Changes

- chore: update chokidar to 3.6.0 ([#11811](https://github.com/sveltejs/kit/pull/11811))

## 2.2.6

### Patch Changes

- chore: bump svelte2tsx dependency to support generating types for `.svelte.js/ts` files ([#11619](https://github.com/sveltejs/kit/pull/11619))

## 2.2.5

### Patch Changes

- fix: improve warning when encountering import.meta.env ([#11440](https://github.com/sveltejs/kit/pull/11440))

## 2.2.4

### Patch Changes

- chore: update primary branch from master to main ([`47779436c5f6c4d50011d0ef8b2709a07c0fec5d`](https://github.com/sveltejs/kit/commit/47779436c5f6c4d50011d0ef8b2709a07c0fec5d))

## 2.2.3

### Patch Changes

- fix: overwrite nodenext option when transpiling ([#11092](https://github.com/sveltejs/kit/pull/11092))

## 2.2.2

### Patch Changes

- fix: prevent crash on errors in watch mode ([#10628](https://github.com/sveltejs/kit/pull/10628))

## 2.2.1

### Patch Changes

- fix: delay emptying `dist/` folder ([#10514](https://github.com/sveltejs/kit/pull/10514))

## 2.2.0

### Minor Changes

- feat: use Svelte 4 typings when packaging if dependencies allow it ([#10328](https://github.com/sveltejs/kit/pull/10328))

## 2.1.0

### Minor Changes

- feat: support Svelte 4 ([#10225](https://github.com/sveltejs/kit/pull/10225))

## 2.0.2

### Patch Changes

- fix: don't emit false positive export condition warning ([#9109](https://github.com/sveltejs/kit/pull/9109))

## 2.0.1

### Patch Changes

- fix: print version when running `svelte-package --version` ([#9078](https://github.com/sveltejs/kit/pull/9078))

## 2.0.0

### Major Changes

- breaking: remove `package.json` generation and package options from `svelte.config.js`. New default output directory is `dist`. Read the migration guide at https://github.com/sveltejs/kit/pull/8922 to learn how to update ([#8922](https://github.com/sveltejs/kit/pull/8922))

## 1.0.2

### Patch Changes

- chore: update svelte2tsx ([`50a3c5a6`](https://github.com/sveltejs/kit/commit/50a3c5a6d1282c64422e80fe19b352c14e41c853))

## 1.0.1

### Patch Changes

- fix: explicitly mark Node 17.x as not supported ([#8174](https://github.com/sveltejs/kit/pull/8174))

## 1.0.0

### Major Changes

First major release, see below for the history of changes that lead up to this.
Starting from now all releases follow semver and changes will be listed as Major/Minor/Patch

## 1.0.0-next.6

### Patch Changes

- feat: warn if svelte not found in dependencies or peerDependencies ([#7685](https://github.com/sveltejs/kit/pull/7685))

## 1.0.0-next.5

### Patch Changes

- fix check for undefined on application/ strip ([#6932](https://github.com/sveltejs/kit/pull/6932))

## 1.0.0-next.4

### Patch Changes

- fix: don't strip `type="application/.."` tags ([#6887](https://github.com/sveltejs/kit/pull/6887))

## 1.0.0-next.3

### Patch Changes

- feat: Support aliases set through `kit.alias` ([#6350](https://github.com/sveltejs/kit/pull/6350))

## 1.0.0-next.2

### Patch Changes

- breaking: require Node 16.14 ([#6388](https://github.com/sveltejs/kit/pull/6388))

####### packages/package/package.json #######

```

{
	"name": "@sveltejs/package",
	"version": "2.3.1",
	"description": "The fastest way to build Svelte packages",
	"repository": {
		"type": "git",
		"url": "https://github.com/sveltejs/kit",
		"directory": "packages/package"
	},
	"license": "MIT",
	"homepage": "https://kit.svelte.dev",
	"type": "module",
	"dependencies": {
		"chokidar": "^3.6.0",
		"kleur": "^4.1.5",
		"sade": "^1.8.1",
		"semver": "^7.5.4",
		"svelte2tsx": "~0.7.0"
	},
	"devDependencies": {
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"@types/node": "^18.19.3",
		"@types/semver": "^7.5.6",
		"svelte": "^4.2.10",
		"svelte-preprocess": "^5.1.3",
		"typescript": "^5.3.3",
		"uvu": "^0.5.6"
	},
	"peerDependencies": {
		"svelte": "^3.44.0 || ^4.0.0 || ^5.0.0-next.1"
	},
	"bin": {
		"svelte-package": "svelte-package.js"
	},
	"files": [
		"src",
		"types"
	],
	"scripts": {
		"lint": "prettier --check .",
		"check": "tsc",
		"check:all": "tsc && pnpm -r --filter=\"./**\" check",
		"format": "pnpm lint --write",
		"test": "uvu test \"^index.js$\""
	},
	"exports": {
		"./package.json": "./package.json",
		".": {
			"types": "./types/index.d.ts"
		}
	},
	"types": "types/index.d.ts",
	"engines": {
		"node": "^16.14 || >=18"
	}
}

```


####### packages/package/README.md #######

# The fastest way to build Svelte packages

Create Svelte packages, build and push them to npm. This is part of the [SvelteKit](https://kit.svelte.dev) framework and CLI.

The quickest way to get started is via the [create-svelte](https://github.com/sveltejs/kit/tree/main/packages/create-svelte) package:

```bash
npm create svelte@latest my-app
cd my-app
npm install
npm run dev
```

See the [documentation](https://kit.svelte.dev/docs/packaging) to learn more.

## Changelog

[The Changelog for this package is available on GitHub](https://github.com/sveltejs/kit/blob/main/packages/package/CHANGELOG.md).

####### packages/package/src/cli.js #######

```

import fs from 'node:fs';
import colors from 'kleur';
import sade from 'sade';
import { load_config } from './config.js';

/** @param {Error} error */
function handle_error(error) {
	if (error.name === 'SyntaxError') throw error;

	console.error(colors.bold().red(`> ${error.message}`));
	if (error.stack) {
		console.error(colors.gray(error.stack.split('\n').slice(1).join('\n')));
	}

	process.exit(1);
}

const pkg = JSON.parse(fs.readFileSync(new URL('../package.json', import.meta.url), 'utf-8'));
const prog = sade('svelte-package', true).version(pkg.version);

prog
	.describe('Create a package')
	.option('-i, --input', 'Input directory')
	.option('-o, --output', 'Output directory', 'dist')
	.option('-t, --types', 'Emit type declarations', true)
	.option('-w, --watch', 'Rerun when files change', false)
	.option(
		'--tsconfig',
		'A path to a tsconfig or jsconfig file. When not provided, searches for the next upper tsconfig/jsconfig in the workspace path.'
	)
	.action(async (args) => {
		try {
			const config = await load_config();

			// @ts-expect-error
			if (config.package) {
				throw new Error(
					'config.package is no longer supported. See https://github.com/sveltejs/kit/pull/8922 for more information and how to migrate.'
				);
			}

			const packaging = await import('./index.js');

			/** @type {import('./types.js').Options} */
			const options = {
				cwd: process.cwd(),
				input: args.input ?? config.kit?.files?.lib ?? 'src/lib',
				output: args.output,
				tsconfig: args.tsconfig,
				types: args.types,
				config
			};

			await (args.watch ? packaging.watch(options) : packaging.build(options));
		} catch (error) {
			handle_error(/** @type {Error} */ (error));
		}
	});

prog.parse(process.argv, { unknown: (arg) => `Unknown option: ${arg}` });

```


####### packages/package/src/config.js #######

```

import path from 'node:path';
import fs from 'node:fs';
import url from 'node:url';

/**
 * Loads and validates svelte.config.js
 * @param {{ cwd?: string }} options
 * @returns {Promise<import('./types.js').Options['config']>}
 */
export async function load_config({ cwd = process.cwd() } = {}) {
	const config_file = path.join(cwd, 'svelte.config.js');

	if (!fs.existsSync(config_file)) {
		return {};
	}

	const module = await import(`${url.pathToFileURL(config_file).href}?ts=${Date.now()}`);
	const config = module.default;

	if (config.package) {
		throw new Error(
			'config.package is no longer supported. See https://github.com/sveltejs/kit/discussions/8825 for more information.'
		);
	}

	return config;
}

/**
 * @param {string} cwd
 * @returns Record<string, any>
 */
export function load_pkg_json(cwd = process.cwd()) {
	const pkg_json_file = path.join(cwd, 'package.json');

	if (!fs.existsSync(pkg_json_file)) {
		return {};
	}

	return JSON.parse(fs.readFileSync(pkg_json_file, 'utf-8'));
}

```


####### packages/package/src/filesystem.js #######

```

import fs from 'node:fs';
import path from 'node:path';

/** @param {string} dir */
export function mkdirp(dir) {
	try {
		fs.mkdirSync(dir, { recursive: true });
	} catch (/** @type {any} */ e) {
		if (e.code === 'EEXIST') return;
		throw e;
	}
}

/** @param {string} path */
export function rimraf(path) {
	fs.rmSync(path, { force: true, recursive: true });
}

/** @param {string} str */
export function posixify(str) {
	return str.replace(/\\/g, '/');
}

/**
 * Get a list of all files in a directory
 * @param {string} cwd - the directory to walk
 * @param {boolean} [dirs] - whether to include directories in the result
 */
export function walk(cwd, dirs = false) {
	/** @type {string[]} */
	const all_files = [];

	/** @param {string} dir */
	function walk_dir(dir) {
		const files = fs.readdirSync(path.join(cwd, dir));

		for (const file of files) {
			const joined = path.join(dir, file);
			const stats = fs.statSync(path.join(cwd, joined));
			if (stats.isDirectory()) {
				if (dirs) all_files.push(joined);
				walk_dir(joined);
			} else {
				all_files.push(joined);
			}
		}
	}

	return walk_dir(''), all_files;
}

/**
 * @param {string} source
 * @param {string} target
 * @param {{
 *   filter?: (basename: string) => boolean;
 *   replace?: Record<string, string>;
 * }} opts
 */
export function copy(source, target, opts = {}) {
	if (!fs.existsSync(source)) return [];

	/** @type {string[]} */
	const files = [];

	const prefix = posixify(target) + '/';

	const regex = opts.replace
		? new RegExp(`\\b(${Object.keys(opts.replace).join('|')})\\b`, 'g')
		: null;

	/**
	 * @param {string} from
	 * @param {string} to
	 */
	function go(from, to) {
		if (opts.filter && !opts.filter(path.basename(from))) return;

		const stats = fs.statSync(from);

		if (stats.isDirectory()) {
			fs.readdirSync(from).forEach((file) => {
				go(path.join(from, file), path.join(to, file));
			});
		} else {
			mkdirp(path.dirname(to));

			if (opts.replace) {
				const data = fs.readFileSync(from, 'utf-8');
				fs.writeFileSync(
					to,
					data.replace(
						/** @type {RegExp} */ (regex),
						(_match, key) => /** @type {Record<string, string>} */ (opts.replace)[key]
					)
				);
			} else {
				fs.copyFileSync(from, to);
			}

			files.push(to === target ? posixify(path.basename(to)) : posixify(to).replace(prefix, ''));
		}
	}

	go(source, target);

	return files;
}

```


####### packages/package/src/index.js #######

```

import * as fs from 'node:fs';
import * as path from 'node:path';
import colors from 'kleur';
import chokidar from 'chokidar';
import { preprocess } from 'svelte/compiler';
import { copy, mkdirp, rimraf } from './filesystem.js';
import { analyze, resolve_aliases, scan, strip_lang_tags, write } from './utils.js';
import { emit_dts, transpile_ts } from './typescript.js';
import { create_validator } from './validate.js';

/**
 * @param {import('./types.js').Options} options
 */
export async function build(options) {
	const { analyse_code, validate } = create_validator(options);
	await do_build(options, analyse_code);
	validate();
}

/**
 * @param {import('./types.js').Options} options
 * @param {(name: string, code: string) => void} analyse_code
 */
async function do_build(options, analyse_code) {
	const { input, output, temp, extensions, alias, tsconfig } = normalize_options(options);

	if (!fs.existsSync(input)) {
		throw new Error(`${path.relative('.', input)} does not exist`);
	}

	rimraf(temp);
	mkdirp(temp);

	const files = scan(input, extensions);

	if (options.types) {
		await emit_dts(input, temp, options.cwd, alias, files);
	}

	for (const file of files) {
		await process_file(input, temp, file, options.config.preprocess, alias, tsconfig, analyse_code);
	}

	rimraf(output);
	mkdirp(output);
	copy(temp, output);

	console.log(
		colors
			.bold()
			.green(`${path.relative(options.cwd, input)} -> ${path.relative(options.cwd, output)}`)
	);
}

/**
 * @param {import('./types.js').Options} options
 */
export async function watch(options) {
	const { analyse_code, validate } = create_validator(options);

	await do_build(options, analyse_code);

	validate();

	const { input, output, extensions, alias, tsconfig } = normalize_options(options);

	const message = `\nWatching ${path.relative(options.cwd, input)} for changes...\n`;

	console.log(message);

	/** @type {Array<{ file: import('./types.js').File, type: string }>} */
	const pending = [];

	/** @type {Array<(value?: any) => void>} */
	const fulfillers = [];

	/** @type {NodeJS.Timeout} */
	let timeout;

	const watcher = chokidar.watch(input, { ignoreInitial: true });
	const ready = new Promise((resolve) => watcher.on('ready', resolve));

	watcher.on('all', async (type, filepath) => {
		const file = analyze(path.relative(input, filepath), extensions);

		pending.push({ file, type });

		clearTimeout(timeout);
		timeout = setTimeout(async () => {
			const files = scan(input, extensions);

			const events = pending.slice();
			pending.length = 0;

			let errored = false;

			for (const { file, type } of events) {
				if (type === 'unlink') {
					for (const candidate of [
						file.name,
						`${file.base}.d.ts`,
						`${file.base}.d.mts`,
						`${file.base}.d.cts`
					]) {
						const resolved = path.join(output, candidate);

						if (fs.existsSync(resolved)) {
							fs.unlinkSync(resolved);

							const parent = path.dirname(resolved);
							if (parent !== output && fs.readdirSync(parent).length === 0) {
								fs.rmdirSync(parent);
							}
						}
					}
					console.log(`Removed ${file.dest}`);
				}

				if (type === 'add' || type === 'change') {
					console.log(`Processing ${file.name}`);
					try {
						await process_file(
							input,
							output,
							file,
							options.config.preprocess,
							alias,
							tsconfig,
							analyse_code
						);
					} catch (e) {
						errored = true;
						console.error(e);
					}
				}
			}

			if (!errored && options.types) {
				try {
					await emit_dts(input, output, options.cwd, alias, files);
					console.log('Updated .d.ts files');
				} catch (e) {
					errored = true;
					console.error(e);
				}
			}

			if (!errored) {
				validate();
			}

			console.log(message);

			fulfillers.forEach((fn) => fn());
		}, 100);
	});

	return {
		watcher,
		ready,
		settled: () =>
			new Promise((fulfil, reject) => {
				fulfillers.push(fulfil);
				setTimeout(() => reject(new Error('Timed out')), 1000);
			})
	};
}

/**
 * @param {import('./types.js').Options} options
 */
function normalize_options(options) {
	const input = path.resolve(options.cwd, options.input);
	const output = path.resolve(options.cwd, options.output);
	const temp = path.resolve(
		options.cwd,
		options.config.kit?.outDir ?? '.svelte-kit',
		'__package__'
	);
	const extensions = options.config.extensions ?? ['.svelte'];
	const tsconfig = options.tsconfig ? path.resolve(options.cwd, options.tsconfig) : undefined;

	const alias = {
		$lib: path.resolve(options.cwd, options.config.kit?.files?.lib ?? 'src/lib'),
		...(options.config.kit?.alias ?? {})
	};

	return {
		input,
		output,
		temp,
		extensions,
		alias,
		tsconfig
	};
}

/**
 * @param {string} input
 * @param {string} output
 * @param {import('./types.js').File} file
 * @param {import('svelte/types/compiler/preprocess').PreprocessorGroup | undefined} preprocessor
 * @param {Record<string, string>} aliases
 * @param {string | undefined} tsconfig
 * @param {(name: string, code: string) => void} analyse_code
 */
async function process_file(input, output, file, preprocessor, aliases, tsconfig, analyse_code) {
	const filename = path.join(input, file.name);
	const dest = path.join(output, file.dest);

	if (file.is_svelte || file.name.endsWith('.ts') || file.name.endsWith('.js')) {
		let contents = fs.readFileSync(filename, 'utf-8');

		if (file.is_svelte) {
			if (preprocessor) {
				const preprocessed = (await preprocess(contents, preprocessor, { filename })).code;
				contents = strip_lang_tags(preprocessed);
			}
		}

		if (file.name.endsWith('.ts') && !file.name.endsWith('.d.ts')) {
			contents = await transpile_ts(tsconfig, filename, contents);
		}

		contents = resolve_aliases(input, file.name, contents, aliases);
		analyse_code(file.name, contents);
		write(dest, contents);
	} else {
		copy(filename, dest);
	}
}

```


####### packages/package/src/typescript.js #######

```

import * as fs from 'node:fs';
import * as path from 'node:path';
import { createRequire } from 'node:module';
import semver from 'semver';
import { posixify, mkdirp, rimraf, walk } from './filesystem.js';
import { resolve_aliases, write } from './utils.js';
import { emitDts } from 'svelte2tsx';
import { load_pkg_json } from './config.js';

/**
 * Generates d.ts files by invoking TypeScript's "emit d.ts files from input files".
 * The files are written to a temporary location and those which should be kept
 * are sanitized ($lib alias resolved) and copied over to the destination folder.
 *
 * @param {string} input
 * @param {string} output
 * @param {string} cwd
 * @param {Record<string, string>} alias
 * @param {import('./types.js').File[]} files
 */
export async function emit_dts(input, output, cwd, alias, files) {
	const tmp = `${output}/__package_types_tmp__`;
	rimraf(tmp);
	mkdirp(tmp);

	const require = createRequire(import.meta.url);
	const pkg = load_pkg_json(cwd);
	const svelte_dep = pkg.peerDependencies?.svelte || pkg.dependencies?.svelte || '3.0';
	const no_svelte_3 = !semver.intersects(svelte_dep, '^3.0.0');
	await emitDts({
		libRoot: input,
		svelteShimsPath: no_svelte_3
			? require.resolve('svelte2tsx/svelte-shims-v4.d.ts')
			: require.resolve('svelte2tsx/svelte-shims.d.ts'),
		declarationDir: path.relative(cwd, tmp)
	});

	const handwritten = new Set();

	// skip files that conflict with hand-written .d.ts
	for (const file of files) {
		if (file.name.endsWith('.d.ts')) {
			handwritten.add(file.name);
		}
	}

	// resolve $lib alias (TODO others), copy into package dir
	for (const file of walk(tmp)) {
		const normalized = posixify(file);

		if (handwritten.has(normalized)) {
			console.warn(`Using $lib/${normalized} instead of generated .d.ts file`);
		}

		const source = fs.readFileSync(path.join(tmp, normalized), 'utf8');
		write(path.join(output, normalized), resolve_aliases(input, normalized, source, alias));
	}

	rimraf(tmp);
}

/**
 * TS -> JS
 *
 * @param {string | undefined} tsconfig
 * @param {string} filename
 * @param {string} source
 */
export async function transpile_ts(tsconfig, filename, source) {
	const ts = await try_load_ts();
	const options = load_tsconfig(tsconfig, filename, ts);
	// transpileModule treats NodeNext as CommonJS because it doesn't read the package.json. Therefore we need to override it.
	// Also see https://github.com/microsoft/TypeScript/issues/53022 (the filename workaround doesn't work).
	return ts.transpileModule(source, {
		compilerOptions: {
			...options,
			module: ts.ModuleKind.ESNext,
			moduleResolution: ts.ModuleResolutionKind.NodeNext
		},
		fileName: filename
	}).outputText;
}

async function try_load_ts() {
	try {
		return (await import('typescript')).default;
	} catch (e) {
		throw new Error(
			'You need to install TypeScript if you want to transpile TypeScript files and/or generate type definitions'
		);
	}
}

/**
 * @param {string | undefined} tsconfig
 * @param {string} filename
 * @param {import('typescript')} ts
 */
function load_tsconfig(tsconfig, filename, ts) {
	let config_filename;

	if (tsconfig) {
		if (fs.existsSync(tsconfig)) {
			config_filename = tsconfig;
		} else {
			throw new Error('Failed to locate provided tsconfig or jsconfig');
		}
	} else {
		// ts.findConfigFile is broken (it will favour a distant tsconfig
		// over a near jsconfig, and then only when you call it twice)
		// so we implement it ourselves
		let dir = filename;
		while (dir !== (dir = path.dirname(dir))) {
			const tsconfig = path.join(dir, 'tsconfig.json');
			const jsconfig = path.join(dir, 'jsconfig.json');

			if (fs.existsSync(tsconfig)) {
				config_filename = tsconfig;
				break;
			}

			if (fs.existsSync(jsconfig)) {
				config_filename = jsconfig;
				break;
			}
		}
	}

	if (!config_filename) {
		throw new Error('Failed to locate tsconfig or jsconfig');
	}

	const { error, config } = ts.readConfigFile(config_filename, ts.sys.readFile);

	if (error) {
		throw new Error('Malformed tsconfig\n' + JSON.stringify(error, null, 2));
	}

	// Do this so TS will not search for initial files which might take a while
	config.include = [];
	config.files = [];
	const { options } = ts.parseJsonConfigFileContent(
		config,
		ts.sys,
		path.dirname(config_filename),
		{ sourceMap: false },
		config_filename
	);
	return options;
}

```


####### packages/package/src/types.d.ts #######

```

import { PreprocessorGroup } from 'svelte/types/compiler/preprocess';

export interface Options {
	cwd: string;
	input: string;
	output: string;
	types: boolean;
	tsconfig?: string;
	config: {
		extensions?: string[];
		kit?: {
			alias?: Record<string, string>;
			files?: {
				lib?: string;
			};
			outDir?: string;
		};
		preprocess?: PreprocessorGroup;
	};
}

export interface File {
	name: string;
	dest: string;
	base: string;
	is_svelte: boolean;
}

export type RecursiveRequired<T> = {
	// Recursive implementation of TypeScript's Required utility type.
	// Will recursively continue until it reaches a primitive or Function
	[K in keyof T]-?: Extract<T[K], Function> extends never // If it does not have a Function type
		? RecursiveRequired<T[K]> // recursively continue through.
		: T[K]; // Use the exact type for everything else
};

export interface ValidatedConfig {
	extensions: string[];
	kit?: any;
	preprocess?: any;
}

export type Validator<T = any> = (input: T, keypath: string) => T;

```


####### packages/package/src/utils.js #######

```

import * as fs from 'node:fs';
import * as path from 'node:path';
import { VERSION } from 'svelte/compiler';
import { posixify, mkdirp, walk } from './filesystem.js';

const is_svelte_5_plus = Number(VERSION.split('.')[0]) >= 5;

/**
 * Resolves aliases
 *
 * @param {string} input
 * @param {string} file Relative to the input
 * @param {string} content
 * @param {Record<string, string>} aliases
 * @returns {string}
 */
export function resolve_aliases(input, file, content, aliases) {
	/**
	 * @param {string} match
	 * @param {string} _
	 * @param {string} import_path
	 */
	const replace_import_path = (match, _, import_path) => {
		for (const [alias, value] of Object.entries(aliases)) {
			if (!import_path.startsWith(alias)) continue;

			const full_path = path.join(input, file);
			const full_import_path = path.join(value, import_path.slice(alias.length));
			let resolved = posixify(path.relative(path.dirname(full_path), full_import_path));
			resolved = resolved.startsWith('.') ? resolved : './' + resolved;
			return match.replace(import_path, resolved);
		}
		return match;
	};

	content = content.replace(/from\s+('|")([^"';,]+?)\1/g, replace_import_path);
	content = content.replace(/import\s*\(\s*('|")([^"';,]+?)\1\s*\)/g, replace_import_path);
	return content;
}

/**
 * Strip out lang="X" or type="text/X" tags. Doing it here is only a temporary solution.
 * See https://github.com/sveltejs/kit/issues/2450 for ideas for places where it's handled better.
 *
 * @param {string} content
 */
export function strip_lang_tags(content) {
	return content
		.replace(
			/(<!--[^]*?-->)|(<script[^>]*?)\s(?:type|lang)=(["'])(.*?)\3/g,
			// Things like application/ld+json should be kept as-is. Preprocessed languages are "ts" etc.
			// Svelte 5 deals with TypeScript natively, and in the template, too, therefore keep it in.
			// Not removing it would mean Svelte parses without its TS plugin and then runs into errors.
			(match, comment, tag_open, _, type) =>
				type?.startsWith('application/') || (is_svelte_5_plus && type === 'ts')
					? match
					: (comment ?? '') + (tag_open ?? '')
		)
		.replace(/(<!--[^]*?-->)|(<style[^>]*?)\s(?:type|lang)=(["']).*?\3/g, '$1$2');
}

/**
 * @param {string} file
 * @param {Parameters<typeof fs.writeFileSync>[1]} contents
 */
export function write(file, contents) {
	mkdirp(path.dirname(file));
	fs.writeFileSync(file, contents);
}

/**
 * @param {string} input
 * @param {string[]} extensions
 * @returns {import('./types.js').File[]}
 */
export function scan(input, extensions) {
	return walk(input).map((file) => analyze(file, extensions));
}

/**
 * @param {string} file
 * @param {string[]} extensions
 * @returns {import('./types.js').File}
 */
export function analyze(file, extensions) {
	const name = posixify(file);

	const svelte_extension = extensions.find((ext) => name.endsWith(ext));

	const base = svelte_extension ? name : name.slice(0, -path.extname(name).length);

	const dest = svelte_extension
		? name.slice(0, -svelte_extension.length) + '.svelte'
		: name.endsWith('.d.ts')
			? name
			: name.endsWith('.ts')
				? name.slice(0, -3) + '.js'
				: name;

	return {
		name,
		dest,
		base,
		is_svelte: !!svelte_extension
	};
}

```


####### packages/package/src/validate.js #######

```

import { readFileSync } from 'node:fs';
import { join } from 'node:path';
import colors from 'kleur';

/**
 * @param {import("./types.js").Options} options
 */
export function create_validator(options) {
	const { analyse_code, validate } = _create_validator(options);

	return {
		/**
		 * Checks a file content for problematic imports and things like `import.meta`
		 * @param {string} name
		 * @param {string} content
		 */
		analyse_code(name, content) {
			analyse_code(name, content);
		},
		validate() {
			/** @type {Record<string, any>} */
			const pkg = JSON.parse(readFileSync(join(options.cwd, 'package.json'), 'utf-8'));
			const warnings = validate(pkg);
			// Just warnings, not errors, because
			// - would be annoying in watch mode (would have to restart the server)
			// - maybe there's a custom post-build script that fixes some of these
			if (warnings.length) {
				console.log(
					colors
						.bold()
						.yellow('@sveltejs/package found the following issues while packaging your library:')
				);
				for (const warning of warnings) {
					console.log(colors.yellow(`${warning}\n`));
				}
			}
		}
	};
}
/**
 * @param {import("./types.js").Options} options
 */
export function _create_validator(options) {
	/** @type {Set<string>} */
	const imports = new Set();
	let uses_import_meta = false;
	let has_svelte_files = false;

	/**
	 * Checks a file content for problematic imports and things like `import.meta`
	 * @param {string} name
	 * @param {string} content
	 */
	function analyse_code(name, content) {
		has_svelte_files =
			has_svelte_files ||
			(options.config.extensions ?? ['.svelte']).some((ext) => name.endsWith(ext));
		uses_import_meta = uses_import_meta || content.includes('import.meta.env');

		const file_imports = [
			...content.matchAll(/from\s+('|")([^"';,]+?)\1/g),
			...content.matchAll(/import\s*\(\s*('|")([^"';,]+?)\1\s*\)/g)
		];
		for (const [, , import_path] of file_imports) {
			if (import_path.startsWith('$app/')) {
				imports.add(import_path);
			}
		}
	}

	/**
	 * @param {Record<string, any>} pkg
	 */
	function validate(pkg) {
		/** @type {string[]} */
		const warnings = [];

		if (
			imports.has('$app/environment') &&
			[...imports].filter((i) => i.startsWith('$app/')).length === 1
		) {
			warnings.push(
				'Avoid usage of `$app/environment` in your code, if you want to library to work for people not using SvelteKit (only regular Svelte, for example). ' +
					'Consider using packages like `esm-env` instead which provide cross-bundler-compatible environment variables.'
			);
		}

		if (uses_import_meta) {
			warnings.push(
				'Avoid usage of `import.meta.env` in your code. It only works in apps bundled with Vite. ' +
					'Consider using packages like `esm-env` instead which works with all bundlers or without bundling.'
			);
		}

		if (
			!(pkg.dependencies?.['@sveltejs/kit'] || pkg.peerDependencies?.['@sveltejs/kit']) &&
			([...imports].some((i) => i.startsWith('$app/')) || imports.has('@sveltejs/kit'))
		) {
			warnings.push(
				'You are using SvelteKit-specific imports in your code, but you have not declared a dependency on `@sveltejs/kit` in your `package.json`. ' +
					'Add it to your `dependencies` or `peerDependencies`.'
			);
		}

		if (
			!(pkg.dependencies?.svelte || pkg.peerDependencies?.svelte) &&
			(has_svelte_files ||
				[...imports].some((i) => i.startsWith('svelte/') || imports.has('svelte')))
		) {
			warnings.push(
				'You are using Svelte components or Svelte-specific imports in your code, but you have not declared a dependency on `svelte` in your `package.json`. ' +
					'Add it to your `dependencies` or `peerDependencies`.'
			);
		}

		if (pkg.exports) {
			const { conditions } = traverse_exports(pkg.exports);
			if (has_svelte_files && !pkg.svelte && !conditions.has('svelte')) {
				warnings.push(
					'You are using Svelte files, but did not declare a `svelte` condition in one of your `exports` in your `package.json`. ' +
						'Add a `svelte` condition to your `exports` to ensure that your package is recognized as Svelte package by tooling. ' +
						'See https://kit.svelte.dev/docs/packaging#anatomy-of-a-package-json-exports for more info'
				);
			}

			if (pkg.svelte) {
				const root_export = pkg.exports['.'];
				if (!root_export) {
					warnings.push(
						'You have a `svelte` field in your `package.json`, but no root export in your `exports`. Please align them so that bundlers will resolve consistently to the same file.'
					);
				} else {
					const { exports } = traverse_exports({ '.': root_export });
					if (![...exports].map(export_to_regex).some((_export) => _export.test(pkg.svelte))) {
						warnings.push(
							'The `svelte` field in your `package.json` does not match any export in your root `exports`. Please align them so that bundlers will resolve consistently to the same file.'
						);
						Object.keys(pkg.exports).map(export_to_regex);
					}
				}
			}
		} else {
			warnings.push(
				'No `exports` field found in `package.json`, please provide one. ' +
					'See https://kit.svelte.dev/docs/packaging#anatomy-of-a-package-json-exports for more info'
			);
		}

		return warnings;
	}

	return {
		analyse_code,
		validate
	};
}

/**
 * @param {Record<string, any>} exports_map
 * @returns {{ exports: Set<string>; conditions: Set<string> }}
 */
function traverse_exports(exports_map) {
	/** @type {Set<string>} */
	const exports = new Set();
	/** @type {Set<string>} */
	const conditions = new Set();

	/**
	 * @param {Record<string, any>} exports_map
	 * @param {boolean} is_first_level
	 */
	function traverse(exports_map, is_first_level) {
		for (const key of Object.keys(exports_map ?? {})) {
			if (!is_first_level) {
				conditions.add(key);
			}

			const _export = exports_map[key];

			if (typeof _export === 'string') {
				exports.add(_export);
			} else {
				traverse(_export, false);
			}
		}
	}

	traverse(exports_map, true);

	return { exports, conditions };
}

/** @param {string} _export */
function export_to_regex(_export) {
	// $& means the whole matched string
	const regex_str = _export.replace(/[.+?^${}()|[\]\\]/g, '\\$&').replace(/\*/g, '.*');
	return new RegExp(`^${regex_str}$`);
}

```


####### packages/package/svelte-package.js #######

```

#!/usr/bin/env node
import './src/cli.js';

```


####### packages/package/test/errors/no-lib-folder/package.json #######

```

{
	"name": "error-no-lib-folder",
	"private": true,
	"version": "1.0.0",
	"description": "validate no lib folder error output"
}

```


####### packages/package/test/errors/no-lib-folder/svelte.config.js #######

```


```


####### packages/package/test/errors/no-lib-folder/tsconfig.json #######

```

{
	"compilerOptions": {
		"checkJs": true,
		"baseUrl": ".",
		"paths": {
			"$lib/*": ["./src/lib/*"]
		}
	},
	"include": ["src/**/*.d.ts", "src/**/*.js", "src/**/*.svelte"]
}

```


####### packages/package/test/fixtures/assets/jsconfig.json #######

```

{}

```


####### packages/package/test/fixtures/assets/package.json #######

```

{
	"name": "assets",
	"private": true,
	"version": "1.0.0",
	"description": "no tampering assets",
	"peerDependencies": {
		"svelte": "^4.0.0"
	},
	"exports": {
		".": {
			"types": "./dist/index.d.ts",
			"svelte": "./dist/index.js"
		}
	}
}

```


####### packages/package/test/fixtures/assets/svelte.config.js #######

```


```


####### packages/package/test/fixtures/emitTypes-false/expected/foo.d.ts #######

```

export type Foo = boolean;

```


####### packages/package/test/fixtures/emitTypes-false/expected/index.js #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/emitTypes-false/expected/Test2.svelte #######

```

<script>
	/**
	 * @type {import('./foo').Foo}
	 */
	export let foo;
</script>

```


####### packages/package/test/fixtures/emitTypes-false/expected/Test.svelte #######

```

<script>
	import { createEventDispatcher } from 'svelte';
	/**
	 * @type {string}
	 */
	export const astring = 'potato';

	const dispatch = createEventDispatcher();
	dispatch('event', true);
</script>

<slot {astring} />

```


####### packages/package/test/fixtures/emitTypes-false/package.json #######

```

{
	"name": "emit-types",
	"private": true,
	"version": "1.0.0",
	"description": "emitTypes settings disabled",
	"type": "module",
	"peerDependencies": {
		"svelte": "^4.0.0"
	},
	"exports": {
		".": {
			"svelte": "./dist/index.js"
		}
	}
}

```


####### packages/package/test/fixtures/emitTypes-false/src/lib/foo.d.ts #######

```

export type Foo = boolean;

```


####### packages/package/test/fixtures/emitTypes-false/src/lib/index.js #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/emitTypes-false/src/lib/Test2.svelte #######

```

<script>
	/**
	 * @type {import('./foo').Foo}
	 */
	export let foo;
</script>

```


####### packages/package/test/fixtures/emitTypes-false/src/lib/Test.svelte #######

```

<script>
	import { createEventDispatcher } from 'svelte';
	/**
	 * @type {string}
	 */
	export const astring = 'potato';

	const dispatch = createEventDispatcher();
	dispatch('event', true);
</script>

<slot {astring} />

```


####### packages/package/test/fixtures/emitTypes-false/svelte.config.js #######

```

const config = {};

export default config;

```


####### packages/package/test/fixtures/javascript/expected/foo.d.ts #######

```

export type Foo = boolean;

```


####### packages/package/test/fixtures/javascript/expected/index.d.ts #######

```

export { default as Test } from './Test.svelte';
export { default as Internal } from './internal/Test.svelte';

```


####### packages/package/test/fixtures/javascript/expected/index.js #######

```

export { default as Test } from './Test.svelte';
export { default as Internal } from './internal/Test.svelte';

```


####### packages/package/test/fixtures/javascript/expected/internal/foo.d.ts #######

```

export type Foo = boolean;

```


####### packages/package/test/fixtures/javascript/expected/internal/index.d.ts #######

```

export const foo: 'bar';
export { x } from "./runes.svelte.js";

```


####### packages/package/test/fixtures/javascript/expected/internal/index.js #######

```

export const foo = 'bar';
export { x } from './runes.svelte.js';

```


####### packages/package/test/fixtures/javascript/expected/internal/runes.svelte.d.ts #######

```

export const x: true;

```


####### packages/package/test/fixtures/javascript/expected/internal/runes.svelte.js #######

```

export const x = true;

```


####### packages/package/test/fixtures/javascript/expected/internal/Test.svelte #######

```

<script>
	/**
	 * @type {import('./foo').Foo}
	 */
	export let foo;
</script>

```


####### packages/package/test/fixtures/javascript/expected/internal/Test.svelte.d.ts #######

```

/** @typedef {typeof __propDef.props}  TestProps */
/** @typedef {typeof __propDef.events}  TestEvents */
/** @typedef {typeof __propDef.slots}  TestSlots */
export default class Test extends SvelteComponent<
	{
		foo: boolean;
	},
	{
		[evt: string]: CustomEvent<any>;
	},
	{}
> {}
export type TestProps = typeof __propDef.props;
export type TestEvents = typeof __propDef.events;
export type TestSlots = typeof __propDef.slots;
import { SvelteComponent } from 'svelte';
declare const __propDef: {
	props: {
		foo: import('./foo').Foo;
	};
	events: {
		[evt: string]: CustomEvent<any>;
	};
	slots: {};
};
export {};

```


####### packages/package/test/fixtures/javascript/expected/Test2.svelte #######

```

<script>
	/**
	 * @type {import('./foo').Foo}
	 */
	export let foo;
</script>

```


####### packages/package/test/fixtures/javascript/expected/Test2.svelte.d.ts #######

```

/** @typedef {typeof __propDef.props}  Test2Props */
/** @typedef {typeof __propDef.events}  Test2Events */
/** @typedef {typeof __propDef.slots}  Test2Slots */
export default class Test2 extends SvelteComponent<
	{
		foo: boolean;
	},
	{
		[evt: string]: CustomEvent<any>;
	},
	{}
> {}
export type Test2Props = typeof __propDef.props;
export type Test2Events = typeof __propDef.events;
export type Test2Slots = typeof __propDef.slots;
import { SvelteComponent } from 'svelte';
declare const __propDef: {
	props: {
		foo: import('./foo').Foo;
	};
	events: {
		[evt: string]: CustomEvent<any>;
	};
	slots: {};
};
export {};

```


####### packages/package/test/fixtures/javascript/expected/Test.svelte #######

```

<script>
	import { createEventDispatcher } from 'svelte';
	/**
	 * @type {string}
	 */
	export const astring = 'potato';

	const dispatch = createEventDispatcher();
	dispatch('event', true);
</script>

<slot {astring} />

```


####### packages/package/test/fixtures/javascript/expected/Test.svelte.d.ts #######

```

/** @typedef {typeof __propDef.props}  TestProps */
/** @typedef {typeof __propDef.events}  TestEvents */
/** @typedef {typeof __propDef.slots}  TestSlots */
export default class Test extends SvelteComponent<
	{
		astring?: string;
	},
	{
		event: CustomEvent<any>;
	} & {
		[evt: string]: CustomEvent<any>;
	},
	{
		default: {
			astring: string;
		};
	}
> {
	get astring(): string;
}
export type TestProps = typeof __propDef.props;
export type TestEvents = typeof __propDef.events;
export type TestSlots = typeof __propDef.slots;
import { SvelteComponent } from 'svelte';
declare const __propDef: {
	props: {
		astring?: string;
	};
	events: {
		event: CustomEvent<any>;
	} & {
		[evt: string]: CustomEvent<any>;
	};
	slots: {
		default: {
			astring: string;
		};
	};
};
export {};

```


####### packages/package/test/fixtures/javascript/expected/utils.d.ts #######

```


```


####### packages/package/test/fixtures/javascript/expected/utils.js #######

```


```


####### packages/package/test/fixtures/javascript/jsconfig.json #######

```

{}

```


####### packages/package/test/fixtures/javascript/package.json #######

```

{
	"name": "javascript",
	"private": true,
	"version": "1.0.0",
	"description": "standard javascript package",
	"peerDependencies": {
		"svelte": "^4.0.0"
	},
	"exports": {
		".": {
			"types": "./dist/index.d.ts",
			"svelte": "./dist/index.js"
		}
	}
}

```


####### packages/package/test/fixtures/javascript/ReadMe.md #######

Hello

####### packages/package/test/fixtures/javascript/src/lib/foo.d.ts #######

```

export type Foo = boolean;

```


####### packages/package/test/fixtures/javascript/src/lib/index.js #######

```

export { default as Test } from './Test.svelte';
export { default as Internal } from './internal/Test.svelte';

```


####### packages/package/test/fixtures/javascript/src/lib/internal/foo.d.ts #######

```

export type Foo = boolean;

```


####### packages/package/test/fixtures/javascript/src/lib/internal/index.js #######

```

export const foo = 'bar';
export { x } from './runes.svelte.js';

```


####### packages/package/test/fixtures/javascript/src/lib/internal/runes.svelte.js #######

```

export const x = true;

```


####### packages/package/test/fixtures/javascript/src/lib/internal/Test.svelte #######

```

<script>
	/**
	 * @type {import('./foo').Foo}
	 */
	export let foo;
</script>

```


####### packages/package/test/fixtures/javascript/src/lib/Test2.svelte #######

```

<script>
	/**
	 * @type {import('./foo').Foo}
	 */
	export let foo;
</script>

```


####### packages/package/test/fixtures/javascript/src/lib/Test.svelte #######

```

<script>
	import { createEventDispatcher } from 'svelte';
	/**
	 * @type {string}
	 */
	export const astring = 'potato';

	const dispatch = createEventDispatcher();
	dispatch('event', true);
</script>

<slot {astring} />

```


####### packages/package/test/fixtures/javascript/src/lib/utils.js #######

```


```


####### packages/package/test/fixtures/javascript/svelte.config.js #######

```


```


####### packages/package/test/fixtures/resolve-alias/expected/baz.d.ts #######

```

export interface Baz {
	baz: string;
}
export declare const baz: Baz;

```


####### packages/package/test/fixtures/resolve-alias/expected/baz.js #######

```

export const baz = { baz: 'baz' };

```


####### packages/package/test/fixtures/resolve-alias/expected/index.d.ts #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/resolve-alias/expected/index.js #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/resolve-alias/expected/sub/bar.d.ts #######

```

export declare const bar1: import('./foo').Foo;
export declare const bar2: import('../baz').Baz;

```


####### packages/package/test/fixtures/resolve-alias/expected/sub/bar.js #######

```

import { baz } from '../baz';
import { foo } from './foo';
export const bar1 = foo;
export const bar2 = baz;

```


####### packages/package/test/fixtures/resolve-alias/expected/sub/foo.d.ts #######

```

export interface Foo {
	foo: string;
}
export declare const foo: Foo;

```


####### packages/package/test/fixtures/resolve-alias/expected/sub/foo.js #######

```

export const foo = { foo: 'foo' };

```


####### packages/package/test/fixtures/resolve-alias/expected/Test.svelte #######

```

<script>
    import { foo } from './sub/foo';
		import { util } from './utils';
    export let bar = foo;
		util();
</script>

```


####### packages/package/test/fixtures/resolve-alias/expected/Test.svelte.d.ts #######

```

import { SvelteComponent } from 'svelte';
declare const __propDef: {
	props: {
		bar?: import('./sub/foo').Foo;
	};
	events: {
		[evt: string]: CustomEvent<any>;
	};
	slots: {};
};
export type TestProps = typeof __propDef.props;
export type TestEvents = typeof __propDef.events;
export type TestSlots = typeof __propDef.slots;
export default class Test extends SvelteComponent<TestProps, TestEvents, TestSlots> {}
export {};

```


####### packages/package/test/fixtures/resolve-alias/expected/utils/index.d.ts #######

```

export declare const util: () => void;

```


####### packages/package/test/fixtures/resolve-alias/expected/utils/index.js #######

```

export const util = () => { };

```


####### packages/package/test/fixtures/resolve-alias/package.json #######

```

{
	"name": "resolve-alias",
	"private": true,
	"version": "1.0.0",
	"description": "package using $lib alias",
	"type": "module",
	"peerDependencies": {
		"svelte": "^4.0.0"
	},
	"exports": {
		".": {
			"types": "./dist/index.d.ts",
			"svelte": "./dist/index.js"
		}
	}
}

```


####### packages/package/test/fixtures/resolve-alias/src/lib/baz.ts #######

```

export interface Baz {
	baz: string;
}

export const baz: Baz = { baz: 'baz' };

```


####### packages/package/test/fixtures/resolve-alias/src/lib/index.ts #######

```

export { default as Test } from '$lib/Test.svelte';

```


####### packages/package/test/fixtures/resolve-alias/src/lib/sub/bar.ts #######

```

import { baz } from '$lib/baz';
import { foo } from '$lib/sub/foo';

export const bar1 = foo;
export const bar2 = baz;

```


####### packages/package/test/fixtures/resolve-alias/src/lib/sub/foo.ts #######

```

export interface Foo {
	foo: string;
}

export const foo: Foo = { foo: 'foo' };

```


####### packages/package/test/fixtures/resolve-alias/src/lib/Test.svelte #######

```

<script lang="ts">
	import { foo } from '$lib/sub/foo';
	import { util } from '$utils';

	export let bar = foo;

	util();
</script>

```


####### packages/package/test/fixtures/resolve-alias/src/lib/utils/index.ts #######

```

export const util = () => {};

```


####### packages/package/test/fixtures/resolve-alias/svelte.config.js #######

```

import { vitePreprocess } from '@sveltejs/vite-plugin-svelte';
import { fileURLToPath } from 'node:url';
import path from 'node:path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.join(__filename, '..');

export default {
	preprocess: vitePreprocess(),
	kit: {
		alias: {
			$utils: path.resolve(__dirname, './src/lib/utils')
		}
	}
};

```


####### packages/package/test/fixtures/resolve-alias/tsconfig.json #######

```

{
	"compilerOptions": {
		"module": "ESNext",
		"target": "ESNext",
		"checkJs": true,
		"baseUrl": ".",
		"paths": {
			"$lib/*": ["./src/lib/*"],
			"$utils/*": ["./src/lib/utils/*"]
		}
	},
	"include": ["src/**/*.d.ts", "src/**/*.js", "src/**/*.svelte"]
}

```


####### packages/package/test/fixtures/svelte-3-types/expected/index.d.ts #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/svelte-3-types/expected/index.js #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/svelte-3-types/expected/Test.svelte #######

```

<script>
import { createEventDispatcher } from 'svelte';
export const astring = 'potato';
const dispatch = createEventDispatcher();
dispatch('event', true);
</script>

<slot {astring} />

```


####### packages/package/test/fixtures/svelte-3-types/expected/Test.svelte.d.ts #######

```

import { SvelteComponentTyped } from 'svelte';
declare const __propDef: {
	props: {
		astring?: string;
	};
	events: {
		event: CustomEvent<boolean>;
	} & {
		[evt: string]: CustomEvent<any>;
	};
	slots: {
		default: {
			astring: string;
		};
	};
};
export type TestProps = typeof __propDef.props;
export type TestEvents = typeof __propDef.events;
export type TestSlots = typeof __propDef.slots;
export default class Test extends SvelteComponentTyped<TestProps, TestEvents, TestSlots> {
	get astring(): string;
}
export {};

```


####### packages/package/test/fixtures/svelte-3-types/package.json #######

```

{
	"name": "svelte-3-types",
	"private": true,
	"version": "1.0.0",
	"description": "creates Svelte 3 backwards compatible types",
	"type": "module",
	"peerDependencies": {
		"svelte": "^3.0.0 || ^4.0.0"
	},
	"exports": {
		".": {
			"types": "./dist/index.d.ts",
			"svelte": "./dist/index.js"
		}
	}
}

```


####### packages/package/test/fixtures/svelte-3-types/src/lib/index.ts #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/svelte-3-types/src/lib/Test.svelte #######

```

<script lang="ts">
	import { createEventDispatcher } from 'svelte';
	export const astring: string = 'potato';

	const dispatch = createEventDispatcher<{ event: boolean }>();
	dispatch('event', true);
</script>

<slot {astring} />

```


####### packages/package/test/fixtures/svelte-3-types/svelte.config.js #######

```

import preprocess from 'svelte-preprocess';

export default {
	preprocess: preprocess({
		preserve: ['ld+json']
	})
};

```


####### packages/package/test/fixtures/svelte-3-types/tsconfig.json #######

```

{
	"compilerOptions": {
		"target": "ESNext",
		"module": "ESNext"
	}
}

```


####### packages/package/test/fixtures/svelte-kit/expected/foo.d.ts #######

```

export type Foo = boolean;

```


####### packages/package/test/fixtures/svelte-kit/expected/index.d.ts #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/svelte-kit/expected/index.js #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/svelte-kit/expected/Test.svelte #######

```

<script>
	import { createEventDispatcher } from 'svelte';
	/**
	 * @type {string}
	 */
	export const astring = 'potato';

	const dispatch = createEventDispatcher();
	dispatch('event', true);
</script>

<slot {astring} />

```


####### packages/package/test/fixtures/svelte-kit/expected/Test.svelte.d.ts #######

```

/** @typedef {typeof __propDef.props}  TestProps */
/** @typedef {typeof __propDef.events}  TestEvents */
/** @typedef {typeof __propDef.slots}  TestSlots */
export default class Test extends SvelteComponent<
	{
		astring?: string;
	},
	{
		event: CustomEvent<any>;
	} & {
		[evt: string]: CustomEvent<any>;
	},
	{
		default: {
			astring: string;
		};
	}
> {
	get astring(): string;
}
export type TestProps = typeof __propDef.props;
export type TestEvents = typeof __propDef.events;
export type TestSlots = typeof __propDef.slots;
import { SvelteComponent } from 'svelte';
declare const __propDef: {
	props: {
		astring?: string;
	};
	events: {
		event: CustomEvent<any>;
	} & {
		[evt: string]: CustomEvent<any>;
	};
	slots: {
		default: {
			astring: string;
		};
	};
};
export {};

```


####### packages/package/test/fixtures/svelte-kit/jsconfig.json #######

```

{}

```


####### packages/package/test/fixtures/svelte-kit/package.json #######

```

{
	"name": "svelte-kit",
	"private": true,
	"version": "1.0.0",
	"type": "module",
	"description": "SvelteKit library project",
	"peerDependencies": {
		"svelte": "^4.0.0"
	},
	"exports": {
		".": {
			"types": "./dist/index.d.ts",
			"svelte": "./dist/index.js"
		}
	}
}

```


####### packages/package/test/fixtures/svelte-kit/src/kitlib/foo.d.ts #######

```

export type Foo = boolean;

```


####### packages/package/test/fixtures/svelte-kit/src/kitlib/index.js #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/svelte-kit/src/kitlib/Test.svelte #######

```

<script>
	import { createEventDispatcher } from 'svelte';
	/**
	 * @type {string}
	 */
	export const astring = 'potato';

	const dispatch = createEventDispatcher();
	dispatch('event', true);
</script>

<slot {astring} />

```


####### packages/package/test/fixtures/svelte-kit/svelte.config.js #######

```

export default {
	kit: {
		files: {
			lib: 'src/kitlib'
		}
	}
};

```


####### packages/package/test/fixtures/tsconfig-specified/expected/runes.svelte.d.ts #######

```

export declare const x = true;

```


####### packages/package/test/fixtures/tsconfig-specified/expected/runes.svelte.js #######

```

export const x = true;

```


####### packages/package/test/fixtures/tsconfig-specified/package.json #######

```

{
	"name": "typescript",
	"private": true,
	"version": "1.0.0",
	"description": "typescript package using esnext",
	"type": "module",
	"peerDependencies": {
		"svelte": "^4.0.0"
	},
	"exports": {
		".": {
			"types": "./dist/index.d.ts",
			"svelte": "./dist/index.js"
		}
	}
}

```


####### packages/package/test/fixtures/tsconfig-specified/src/lib/runes.svelte.ts #######

```

// a comment to delete
export const x = true;

```


####### packages/package/test/fixtures/tsconfig-specified/svelte.config.js #######

```

import preprocess from 'svelte-preprocess';

export default {
	preprocess: preprocess({
		preserve: ['ld+json']
	})
};

```


####### packages/package/test/fixtures/tsconfig-specified/tsconfig.build.json #######

```

{
	"extends": "./tsconfig.json",
	"compilerOptions": {
		"removeComments": true
	}
}

```


####### packages/package/test/fixtures/tsconfig-specified/tsconfig.json #######

```

{
	"compilerOptions": {
		"target": "ESNext",
		"module": "ESNext"
	}
}

```


####### packages/package/test/fixtures/typescript-esnext/expected/foo.d.ts #######

```

export type Foo = boolean;

```


####### packages/package/test/fixtures/typescript-esnext/expected/index.d.ts #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/typescript-esnext/expected/index.js #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/typescript-esnext/expected/Plain.svelte #######

```

<script>
	/** @type {import('./foo').Foo} */
	export let foo;
</script>

<svelte:head>
  <script type="application/ld+json">{JSON.stringify(jsonLd)}</script>
</svelte:head>

```


####### packages/package/test/fixtures/typescript-esnext/expected/Plain.svelte.d.ts #######

```

/** @typedef {typeof __propDef.props}  PlainProps */
/** @typedef {typeof __propDef.events}  PlainEvents */
/** @typedef {typeof __propDef.slots}  PlainSlots */
export default class Plain extends SvelteComponent<
	{
		foo: boolean;
	},
	{
		[evt: string]: CustomEvent<any>;
	},
	{}
> {}
export type PlainProps = typeof __propDef.props;
export type PlainEvents = typeof __propDef.events;
export type PlainSlots = typeof __propDef.slots;
import { SvelteComponent } from 'svelte';
declare const __propDef: {
	props: {
		foo: import('./foo').Foo;
	};
	events: {
		[evt: string]: CustomEvent<any>;
	};
	slots: {};
};
export {};

```


####### packages/package/test/fixtures/typescript-esnext/expected/runes.svelte.d.ts #######

```

export declare const x = true;

```


####### packages/package/test/fixtures/typescript-esnext/expected/runes.svelte.js #######

```

export const x = true;

```


####### packages/package/test/fixtures/typescript-esnext/expected/Test2.svelte #######

```

<script>
	export let foo;
</script>

```


####### packages/package/test/fixtures/typescript-esnext/expected/Test2.svelte.d.ts #######

```

import { SvelteComponent } from 'svelte';
import type { Foo } from './foo';
declare const __propDef: {
	props: {
		foo: Foo;
	};
	events: {
		[evt: string]: CustomEvent<any>;
	};
	slots: {};
};
export type Test2Props = typeof __propDef.props;
export type Test2Events = typeof __propDef.events;
export type Test2Slots = typeof __propDef.slots;
export default class Test2 extends SvelteComponent<Test2Props, Test2Events, Test2Slots> {}
export {};

```


####### packages/package/test/fixtures/typescript-esnext/expected/Test.svelte #######

```

<script>
import { createEventDispatcher } from 'svelte';
export const astring = 'potato';
const dispatch = createEventDispatcher();
dispatch('event', true);
</script>

<slot {astring} />

```


####### packages/package/test/fixtures/typescript-esnext/expected/Test.svelte.d.ts #######

```

import { SvelteComponent } from 'svelte';
declare const __propDef: {
	props: {
		astring?: string;
	};
	events: {
		event: CustomEvent<boolean>;
	} & {
		[evt: string]: CustomEvent<any>;
	};
	slots: {
		default: {
			astring: string;
		};
	};
};
export type TestProps = typeof __propDef.props;
export type TestEvents = typeof __propDef.events;
export type TestSlots = typeof __propDef.slots;
export default class Test extends SvelteComponent<TestProps, TestEvents, TestSlots> {
	get astring(): string;
}
export {};

```


####### packages/package/test/fixtures/typescript-esnext/expected/utils.d.ts #######

```


```


####### packages/package/test/fixtures/typescript-esnext/expected/utils.js #######

```


```


####### packages/package/test/fixtures/typescript-esnext/package.json #######

```

{
	"name": "typescript",
	"private": true,
	"version": "1.0.0",
	"description": "typescript package using esnext",
	"type": "module",
	"peerDependencies": {
		"svelte": "^4.0.0"
	},
	"exports": {
		".": {
			"types": "./dist/index.d.ts",
			"svelte": "./dist/index.js"
		}
	}
}

```


####### packages/package/test/fixtures/typescript-esnext/src/lib/foo.d.ts #######

```

export type Foo = boolean;

```


####### packages/package/test/fixtures/typescript-esnext/src/lib/index.ts #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/typescript-esnext/src/lib/Plain.svelte #######

```

<script>
	/** @type {import('./foo').Foo} */
	export let foo;
</script>

<svelte:head>
	<script type="application/ld+json">
		{
			JSON.stringify(jsonLd);
		}
	</script>
</svelte:head>

```


####### packages/package/test/fixtures/typescript-esnext/src/lib/runes.svelte.ts #######

```

export const x = true;

```


####### packages/package/test/fixtures/typescript-esnext/src/lib/Test2.svelte #######

```

<script lang="ts">
	import type { Foo } from './foo';
	export let foo: Foo;
</script>

```


####### packages/package/test/fixtures/typescript-esnext/src/lib/Test.svelte #######

```

<script lang="ts">
	import { createEventDispatcher } from 'svelte';
	export const astring: string = 'potato';

	const dispatch = createEventDispatcher<{ event: boolean }>();
	dispatch('event', true);
</script>

<slot {astring} />

```


####### packages/package/test/fixtures/typescript-esnext/src/lib/utils.ts #######

```


```


####### packages/package/test/fixtures/typescript-esnext/svelte.config.js #######

```

import preprocess from 'svelte-preprocess';

export default {
	preprocess: preprocess({
		preserve: ['ld+json']
	})
};

```


####### packages/package/test/fixtures/typescript-esnext/tsconfig.json #######

```

{
	"compilerOptions": {
		"target": "ESNext",
		"module": "ESNext"
	}
}

```


####### packages/package/test/fixtures/typescript-nodenext/expected/index.d.ts #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/typescript-nodenext/expected/index.js #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/typescript-nodenext/expected/runes.svelte.d.ts #######

```

export declare const x = true;

```


####### packages/package/test/fixtures/typescript-nodenext/expected/runes.svelte.js #######

```

export const x = true;

```


####### packages/package/test/fixtures/typescript-nodenext/expected/Test.svelte #######

```

<script>
import { createEventDispatcher } from 'svelte';
export const astring = 'potato';
const dispatch = createEventDispatcher();
dispatch('event', true);
</script>

<slot {astring} />

```


####### packages/package/test/fixtures/typescript-nodenext/expected/Test.svelte.d.ts #######

```

import { SvelteComponent } from 'svelte';
declare const __propDef: {
	props: {
		astring?: string;
	};
	events: {
		event: CustomEvent<boolean>;
	} & {
		[evt: string]: CustomEvent<any>;
	};
	slots: {
		default: {
			astring: string;
		};
	};
};
export type TestProps = typeof __propDef.props;
export type TestEvents = typeof __propDef.events;
export type TestSlots = typeof __propDef.slots;
export default class Test extends SvelteComponent<TestProps, TestEvents, TestSlots> {
	get astring(): string;
}
export {};

```


####### packages/package/test/fixtures/typescript-nodenext/package.json #######

```

{
	"name": "typescript-nodenext",
	"private": true,
	"version": "1.0.0",
	"description": "typescript package using nodenext",
	"type": "module",
	"peerDependencies": {
		"svelte": "^4.0.0"
	},
	"exports": {
		".": {
			"types": "./dist/index.d.ts",
			"svelte": "./dist/index.js"
		}
	}
}

```


####### packages/package/test/fixtures/typescript-nodenext/src/lib/index.ts #######

```

export { default as Test } from './Test.svelte';

```


####### packages/package/test/fixtures/typescript-nodenext/src/lib/runes.svelte.ts #######

```

export const x = true;

```


####### packages/package/test/fixtures/typescript-nodenext/src/lib/Test.svelte #######

```

<script lang="ts">
	import { createEventDispatcher } from 'svelte';
	export const astring: string = 'potato';

	const dispatch = createEventDispatcher<{ event: boolean }>();
	dispatch('event', true);
</script>

<slot {astring} />

```


####### packages/package/test/fixtures/typescript-nodenext/svelte.config.js #######

```

import preprocess from 'svelte-preprocess';

export default {
	preprocess: preprocess({})
};

```


####### packages/package/test/fixtures/typescript-nodenext/tsconfig.json #######

```

{
	"compilerOptions": {
		"target": "ESNext",
		"module": "NodeNext",
		"moduleResolution": "NodeNext"
	}
}

```


####### packages/package/test/index.js #######

```

import fs from 'node:fs';
import { join, resolve } from 'node:path';
import { fileURLToPath } from 'node:url';

import prettier from 'prettier';
import { test } from 'uvu';
import * as assert from 'uvu/assert';

import { build, watch } from '../src/index.js';
import { load_config } from '../src/config.js';
import { rimraf, walk } from '../src/filesystem.js';
import { _create_validator } from '../src/validate.js';

const __filename = fileURLToPath(import.meta.url);
const __dirname = join(__filename, '..');

/**
 * @param {string} path
 * @param {Partial<import('../src/types.js').Options>} [options]
 */
async function test_make_package(path, options) {
	const cwd = join(__dirname, 'fixtures', path);
	const ewd = join(cwd, 'expected');
	const output = join(cwd, 'dist');

	const config = await load_config({ cwd });

	const input = resolve(cwd, config.kit?.files?.lib ?? 'src/lib');

	await build({
		cwd,
		input,
		output,
		types: true,
		config,
		...options
	});

	const expected_files = walk(ewd, true);
	const actual_files = walk(output, true);

	assert.equal(actual_files, expected_files);

	const extensions = ['.json', '.svelte', '.ts', 'js'];
	for (const file of actual_files) {
		const pathname = join(output, file);
		if (fs.statSync(pathname).isDirectory()) continue;
		assert.ok(expected_files.includes(file), `Did not expect ${file} in ${path}`);

		const expected = fs.readFileSync(join(ewd, file));
		const actual = fs.readFileSync(join(output, file));
		const err_msg = `Expected equal file contents for ${file} in ${path}`;

		if (extensions.some((ext) => pathname.endsWith(ext))) {
			const expected_content = await format(file, expected.toString('utf-8'));
			const actual_content = await format(file, actual.toString('utf-8'));
			assert.fixture(actual_content, expected_content, err_msg);
		} else {
			assert.ok(expected.equals(actual), err_msg);
		}
	}
}

/**
 * Format with Prettier in order to get expected and actual content aligned
 * @param {string} file
 * @param {string} content
 */
async function format(file, content) {
	if (file.endsWith('package.json')) {
		// For some reason these are ordered differently in different test environments
		const json = JSON.parse(content);
		json.exports = Object.entries(json.exports).sort(([ak], [bk]) => ak.localeCompare(bk));
		content = JSON.stringify(json);
	}
	return await prettier.format(content, {
		parser: file.endsWith('.svelte') ? 'svelte' : file.endsWith('.json') ? 'json' : 'typescript',
		plugins: ['prettier-plugin-svelte']
	});
}

for (const dir of fs.readdirSync(join(__dirname, 'errors'))) {
	test(`package error [${dir}]`, async () => {
		const cwd = join(__dirname, 'errors', dir);
		const output = join(cwd, 'dist');

		const config = await load_config({ cwd });

		const input = resolve(cwd, config.kit?.files?.lib ?? 'src/lib');

		try {
			await build({ cwd, input, output, types: true, config });
			assert.unreachable('Must not pass build');
		} catch (/** @type {any} */ error) {
			assert.instance(error, Error);
			switch (dir) {
				case 'no-lib-folder':
					assert.match(
						error.message.replace(/\\/g, '/'),
						'test/errors/no-lib-folder/src/lib does not exist'
					);
					break;
				// TODO: non-existent tsconfig passes without error
				// 	it detects tsconfig in packages/kit instead and creates package folder
				// 	in packages/kit/package, not sure how to handle and test this yet
				// case 'no-tsconfig':
				// 	assert.match(error.message, 'Failed to locate tsconfig or jsconfig');
				// 	break;

				default:
					assert.unreachable('All error test must be handled');
					break;
			}
		} finally {
			rimraf(output);
		}
	});
}

test('create package with javascript', async () => {
	// should also preserve filename casing
	// should also correctly handle nested folders
	await test_make_package('javascript');
});

test('create package with typescript using esnext', async () => {
	await test_make_package('typescript-esnext');
});

test('create package with typescript using nodenext', async () => {
	await test_make_package('typescript-nodenext');
});

test('create package and assets are not tampered', async () => {
	await test_make_package('assets');
});

test('create package with emitTypes settings disabled', async () => {
	await test_make_package('emitTypes-false', { types: false });
});

test('create package with SvelteComponentTyped for backwards compatibility', async () => {
	await test_make_package('svelte-3-types');
});

test('create package and resolves $lib alias', async () => {
	await test_make_package('resolve-alias');
});

test('SvelteKit interop', async () => {
	await test_make_package('svelte-kit');
});

test('create package with tsconfig specified', async () => {
	await test_make_package('tsconfig-specified', { tsconfig: 'tsconfig.build.json' });
});

// chokidar doesn't fire events in github actions :shrug:
if (!process.env.CI) {
	test('watches for changes', async () => {
		const cwd = join(__dirname, 'watch');

		const config = await load_config({ cwd });

		const { watcher, ready, settled } = await watch({
			cwd,
			input: 'src/lib',
			output: 'package',
			types: true,
			config
		});

		/** @param {string} file */
		function compare(file) {
			assert.equal(read(`package/${file}`), read(`expected/${file}`));
		}

		/** @param {string} file */
		function read(file) {
			return fs.readFileSync(join(__dirname, 'watch', file), 'utf-8');
		}

		/**
		 * @param {string} file
		 * @param {string} data
		 */
		function write(file, data) {
			return fs.writeFileSync(join(__dirname, 'watch', file), data);
		}

		/** @param {string} file */
		function remove(file) {
			const filepath = join(__dirname, 'watch', file);
			if (fs.existsSync(filepath)) fs.unlinkSync(filepath);
		}

		try {
			await ready;

			// completes initial build
			compare('index.js');

			// processes a .js file
			write('src/lib/a.js', "export const a = 'a';");
			await settled();
			compare('a.js');
			compare('a.d.ts');

			// processes a .ts file
			write('src/lib/b.ts', "export const b = 'b';");
			await settled();
			compare('b.js');
			compare('b.d.ts');

			// processes a Svelte file
			write('src/lib/Test.svelte', '<script lang="ts">export let answer: number</script>');
			await settled();
			compare('Test.svelte');
			compare('Test.svelte.d.ts');

			// doesn't crash on an error
			write('src/lib/post-error.svelte', '<button on:={foo}>click me</button>');
			await settled();

			// recovers on subsequent change
			write('src/lib/post-error.svelte', '<button on:click={foo}>click me</button>');
			await settled();
			compare('post-error.svelte');
		} finally {
			watcher.close();

			remove('src/lib/Test.svelte');
			remove('src/lib/a.js');
			remove('src/lib/b.ts');
			remove('src/lib/post-error.svelte');
		}
	});
}

/**
 * @param {string[]} actual
 * @param {string[]} expected
 */
function has_warnings(actual, expected) {
	assert.equal(actual.length, expected.length);
	assert.equal(
		actual.filter((warning) => expected.some((str) => warning.startsWith(str))).length,
		expected.length
	);
}

test('validates package (1)', () => {
	const { analyse_code, validate } = _create_validator({
		config: {},
		cwd: '',
		input: '',
		output: '',
		types: true
	});
	analyse_code('src/lib/index.js', 'export const a = 1;import.meta.env;');
	analyse_code('src/lib/C.svelte', '');
	const warnings = validate({});

	has_warnings(warnings, [
		'No `exports` field found in `package.json`, please provide one.',
		'Avoid usage of `import.meta.env` in your code',
		'You are using Svelte components or Svelte-specific imports in your code, but you have not declared a dependency on `svelte` in your `package.json`. '
	]);
});

test('validates package (2)', () => {
	const { analyse_code, validate } = _create_validator({
		config: {},
		cwd: '',
		input: '',
		output: '',
		types: true
	});
	analyse_code('src/lib/C.svelte', '');
	const warnings = validate({
		exports: { '.': './dist/C.svelte' },
		peerDependencies: { svelte: '^3.55.0' }
	});

	has_warnings(warnings, [
		'You are using Svelte files, but did not declare a `svelte` condition in one of your `exports` in your `package.json`. '
	]);
});

test('validates package (all ok 1)', () => {
	const { analyse_code, validate } = _create_validator({
		config: {},
		cwd: '',
		input: '',
		output: '',
		types: true
	});
	analyse_code('src/lib/C.svelte', '');
	const warnings = validate({
		exports: { '.': { svelte: './dist/C.svelte' } },
		peerDependencies: { svelte: '^3.55.0' }
	});

	assert.equal(warnings.length, 0);
});

test('validates package (all ok 2)', () => {
	const { analyse_code, validate } = _create_validator({
		config: {},
		cwd: '',
		input: '',
		output: '',
		types: true
	});
	analyse_code('src/lib/C.svelte', '');
	const warnings = validate({
		exports: { '.': { svelte: './dist/C.svelte' } },
		peerDependencies: { svelte: '^3.55.0' },
		svelte: './dist/C.svelte'
	});

	assert.equal(warnings.length, 0);
});

test.run();

```


####### packages/package/test/watch/expected/a.d.ts #######

```

export const a: "a";

```


####### packages/package/test/watch/expected/a.js #######

```

export const a = 'a';
```


####### packages/package/test/watch/expected/b.d.ts #######

```

export declare const b = "b";

```


####### packages/package/test/watch/expected/b.js #######

```

export const b = 'b';

```


####### packages/package/test/watch/expected/index.js #######

```

console.log('index.js');

```


####### packages/package/test/watch/expected/package.json #######

```

{
  "type": "module",
  "exports": {
    "./package.json": "./package.json",
    "./Test.svelte": "./Test.svelte",
    ".": "./index.js"
  },
  "svelte": "./index.js"
}
```


####### packages/package/test/watch/expected/post-error.svelte #######

```

<button on:click={foo}>click me</button>
```


####### packages/package/test/watch/expected/Test.svelte #######

```

<script>export let answer;
</script>
```


####### packages/package/test/watch/expected/Test.svelte.d.ts #######

```

import { SvelteComponent } from "svelte";
declare const __propDef: {
    props: {
        answer: number;
    };
    events: {
        [evt: string]: CustomEvent<any>;
    };
    slots: {};
};
export type TestProps = typeof __propDef.props;
export type TestEvents = typeof __propDef.events;
export type TestSlots = typeof __propDef.slots;
export default class Test extends SvelteComponent<TestProps, TestEvents, TestSlots> {
}
export {};

```


####### packages/package/test/watch/package.json #######

```

{
	"name": "watch",
	"type": "module",
	"peerDependencies": {
		"svelte": "^4.0.0"
	},
	"exports": {
		".": {
			"types": "./dist/index.d.ts",
			"svelte": "./dist/index.js"
		}
	}
}

```


####### packages/package/test/watch/src/lib/index.js #######

```

console.log('index.js');

```


####### packages/package/test/watch/svelte.config.js #######

```

import preprocess from 'svelte-preprocess';

export default {
	preprocess: preprocess()
};

```


####### packages/package/test/watch/tsconfig.json #######

```

{
	"compilerOptions": {
		"target": "ESNext",
		"module": "ESNext",
		"allowJs": true,
		"checkJs": true,
		"newLine": "lf"
	}
}

```


####### packages/package/tsconfig.json #######

```

{
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"noEmit": true,
		"strict": true,
		"target": "es2022",
		"module": "node16",
		"moduleResolution": "node16",
		"allowSyntheticDefaultImports": true,
		"paths": {
			// internal use only
			"types": ["./types/index"]
		}
	},
	"include": ["src/**/*", "test/index.js", "types/**/*"],
	"exclude": ["src/test/fixtures/**/*", "src/test/watch/**/*"]
}

```


####### playgrounds/basic/jsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"skipLibCheck": true,
		"sourceMap": true,
		"strict": true
	}
	// Path aliases are handled by https://kit.svelte.dev/docs/configuration#alias and https://kit.svelte.dev/docs/configuration#files
	//
	// If you want to overwrite includes/excludes, make sure to copy over the relevant includes/excludes
	// from the referenced tsconfig.json - TypeScript does not merge them in
}

```


####### playgrounds/basic/package.json #######

```

{
	"name": "playground-basic",
	"version": "0.0.0",
	"private": true,
	"scripts": {
		"dev": "vite dev",
		"build": "vite build && npm run package",
		"preview": "vite preview",
		"package": "svelte-kit sync && svelte-package && publint",
		"prepublishOnly": "npm run package",
		"check": "svelte-kit sync && svelte-check --tsconfig ./jsconfig.json",
		"check:watch": "svelte-kit sync && svelte-check --tsconfig ./jsconfig.json --watch"
	},
	"devDependencies": {
		"@sveltejs/adapter-auto": "workspace:*",
		"@sveltejs/adapter-cloudflare": "workspace:*",
		"@sveltejs/adapter-cloudflare-workers": "workspace:*",
		"@sveltejs/adapter-netlify": "workspace:*",
		"@sveltejs/adapter-node": "workspace:*",
		"@sveltejs/adapter-static": "workspace:*",
		"@sveltejs/adapter-vercel": "workspace:*",
		"@sveltejs/amp": "workspace:*",
		"@sveltejs/kit": "workspace:*",
		"@sveltejs/package": "workspace:*",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"publint": "^0.2.0",
		"svelte": "^4.2.10",
		"svelte-check": "^3.6.3",
		"typescript": "^5.3.3",
		"vite": "^5.2.8"
	},
	"type": "module",
	"exports": {
		".": {
			"types": "./dist/index.d.ts",
			"svelte": "./dist/index.js"
		}
	},
	"files": [
		"dist",
		"!dist/**/*.test.*",
		"!dist/**/*.spec.*"
	],
	"peerDependencies": {
		"svelte": "^4.0.0"
	},
	"svelte": "./dist/index.js",
	"types": "./dist/index.d.ts"
}

```


####### playgrounds/basic/src/app.d.ts #######

```

// See https://kit.svelte.dev/docs/types#app
// for information about these interfaces
declare global {
	namespace App {
		// interface Error {}
		// interface Locals {}
		// interface PageData {}
		// interface Platform {}
	}
}

export {};

```


####### playgrounds/basic/src/app.html #######

```

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>

```


####### playgrounds/basic/src/lib/index.js #######

```

// place files you want to import through the `$lib` alias in this folder.

```


####### playgrounds/basic/src/routes/+page.svelte #######

```

<h1>Welcome to SvelteKit</h1>
<p>Visit <a href="https://kit.svelte.dev">kit.svelte.dev</a> to read the documentation</p>

```


####### playgrounds/basic/svelte.config.js #######

```

import adapter from '@sveltejs/adapter-auto';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter()
	}
};

export default config;

```


####### playgrounds/basic/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import { defineConfig } from 'vite';

export default defineConfig({
	plugins: [sveltekit()],
	server: {
		fs: {
			allow: ['../../packages/kit']
		}
	}
});

```


####### playgrounds/README.md #######

You may use these playgrounds to experiment with your changes to SvelteKit. Make sure you don't check in any changes to this folder.

Alternatively, clone the [kit-sandbox](https://github.com/sveltejs/kit-sandbox) repo next to the `kit` repo, and use `pnpm link` to link your dependencies. This way you can have multiple different sandbox projects in different branches, and you never need to worry about accidentally committing throwaway code.

####### pnpm-lock.yaml #######

```

lockfileVersion: '6.0'

settings:
  autoInstallPeers: true
  excludeLinksFromLockfile: false

importers:

  .:
    devDependencies:
      '@changesets/cli':
        specifier: ^2.27.1
        version: 2.27.1
      '@sveltejs/eslint-config':
        specifier: ^6.0.4
        version: 6.0.4(@typescript-eslint/eslint-plugin@7.6.0)(@typescript-eslint/parser@7.6.0)(eslint-config-prettier@9.1.0)(eslint-plugin-svelte@2.37.0)(eslint-plugin-unicorn@52.0.0)(eslint@8.57.0)(typescript@5.4.5)
      '@svitejs/changesets-changelog-github-compact':
        specifier: ^1.1.0
        version: 1.1.0
      '@typescript-eslint/eslint-plugin':
        specifier: ^7.0.0
        version: 7.6.0(@typescript-eslint/parser@7.6.0)(eslint@8.57.0)(typescript@5.4.5)
      eslint:
        specifier: ^8.56.0
        version: 8.57.0
      eslint-config-prettier:
        specifier: ^9.1.0
        version: 9.1.0(eslint@8.57.0)
      eslint-plugin-svelte:
        specifier: ^2.35.1
        version: 2.37.0(eslint@8.57.0)
      eslint-plugin-unicorn:
        specifier: ^52.0.0
        version: 52.0.0(eslint@8.57.0)
      playwright:
        specifier: ^1.41.0
        version: 1.43.1

  packages/adapter-auto:
    dependencies:
      import-meta-resolve:
        specifier: ^4.0.0
        version: 4.0.0
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../kit
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      '@types/node':
        specifier: ^18.19.3
        version: 18.19.31
      typescript:
        specifier: ^5.3.3
        version: 5.4.5

  packages/adapter-cloudflare:
    dependencies:
      '@cloudflare/workers-types':
        specifier: ^4.20231121.0
        version: 4.20240405.0
      esbuild:
        specifier: ^0.20.2
        version: 0.20.2
      worktop:
        specifier: 0.8.0-next.18
        version: 0.8.0-next.18
      wrangler:
        specifier: ^3.28.4
        version: 3.50.0(@cloudflare/workers-types@4.20240405.0)
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../kit
      '@types/node':
        specifier: ^18.19.3
        version: 18.19.31
      '@types/ws':
        specifier: ^8.5.10
        version: 8.5.10
      typescript:
        specifier: ^5.3.3
        version: 5.4.5

  packages/adapter-cloudflare-workers:
    dependencies:
      '@cloudflare/workers-types':
        specifier: ^4.20231121.0
        version: 4.20240405.0
      '@iarna/toml':
        specifier: ^2.2.5
        version: 2.2.5
      esbuild:
        specifier: ^0.20.2
        version: 0.20.2
      wrangler:
        specifier: ^3.28.4
        version: 3.50.0(@cloudflare/workers-types@4.20240405.0)
    devDependencies:
      '@cloudflare/kv-asset-handler':
        specifier: ^0.3.0
        version: 0.3.1
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../kit
      '@types/node':
        specifier: ^18.19.3
        version: 18.19.31
      typescript:
        specifier: ^5.3.3
        version: 5.4.5

  packages/adapter-netlify:
    dependencies:
      '@iarna/toml':
        specifier: ^2.2.5
        version: 2.2.5
      esbuild:
        specifier: ^0.20.2
        version: 0.20.2
      set-cookie-parser:
        specifier: ^2.6.0
        version: 2.6.0
    devDependencies:
      '@netlify/functions':
        specifier: ^2.4.1
        version: 2.6.0
      '@rollup/plugin-commonjs':
        specifier: ^25.0.7
        version: 25.0.7(rollup@4.14.2)
      '@rollup/plugin-json':
        specifier: ^6.1.0
        version: 6.1.0(rollup@4.14.2)
      '@rollup/plugin-node-resolve':
        specifier: ^15.2.3
        version: 15.2.3(rollup@4.14.2)
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../kit
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      '@types/node':
        specifier: ^18.19.3
        version: 18.19.31
      '@types/set-cookie-parser':
        specifier: ^2.4.7
        version: 2.4.7
      rollup:
        specifier: ^4.14.2
        version: 4.14.2
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vitest:
        specifier: ^1.5.0
        version: 1.5.0(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/adapter-node:
    dependencies:
      '@rollup/plugin-commonjs':
        specifier: ^25.0.7
        version: 25.0.7(rollup@4.14.2)
      '@rollup/plugin-json':
        specifier: ^6.1.0
        version: 6.1.0(rollup@4.14.2)
      '@rollup/plugin-node-resolve':
        specifier: ^15.2.3
        version: 15.2.3(rollup@4.14.2)
      rollup:
        specifier: ^4.9.5
        version: 4.14.2
    devDependencies:
      '@polka/url':
        specifier: 1.0.0-next.25
        version: 1.0.0-next.25
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../kit
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      '@types/node':
        specifier: ^18.19.3
        version: 18.19.31
      c8:
        specifier: ^9.0.0
        version: 9.1.0
      polka:
        specifier: 1.0.0-next.25
        version: 1.0.0-next.25
      sirv:
        specifier: ^2.0.4
        version: 2.0.4
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vitest:
        specifier: ^1.5.0
        version: 1.5.0(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/adapter-static:
    devDependencies:
      '@playwright/test':
        specifier: ^1.41.0
        version: 1.43.1
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../kit
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      '@types/node':
        specifier: ^18.19.3
        version: 18.19.31
      sirv:
        specifier: ^2.0.4
        version: 2.0.4
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/adapter-static/test/apps/prerendered:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../../kit
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      sirv-cli:
        specifier: ^2.0.2
        version: 2.0.2
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/adapter-static/test/apps/spa:
    devDependencies:
      '@sveltejs/adapter-node':
        specifier: workspace:^
        version: link:../../../../adapter-node
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../../kit
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      sirv-cli:
        specifier: ^2.0.2
        version: 2.0.2
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/adapter-vercel:
    dependencies:
      '@vercel/nft':
        specifier: ^0.26.1
        version: 0.26.4
      esbuild:
        specifier: ^0.20.2
        version: 0.20.2
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../kit
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      '@types/node':
        specifier: ^18.19.3
        version: 18.19.31
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vitest:
        specifier: ^1.5.0
        version: 1.5.0(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/amp:
    dependencies:
      '@sveltejs/kit':
        specifier: ^1.0.0 || ^2.0.0
        version: link:../kit

  packages/create-svelte:
    dependencies:
      '@clack/prompts':
        specifier: ^0.7.0
        version: 0.7.0
      kleur:
        specifier: ^4.1.5
        version: 4.1.5
    devDependencies:
      '@playwright/test':
        specifier: ^1.41.0
        version: 1.43.1
      '@types/gitignore-parser':
        specifier: ^0.0.3
        version: 0.0.3
      gitignore-parser:
        specifier: ^0.0.2
        version: 0.0.2
      prettier:
        specifier: ^3.1.1
        version: 3.2.5
      prettier-plugin-svelte:
        specifier: ^3.1.2
        version: 3.1.2(prettier@3.2.5)(svelte@4.2.14)
      sucrase:
        specifier: ^3.34.0
        version: 3.35.0
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      tiny-glob:
        specifier: ^0.2.9
        version: 0.2.9
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vitest:
        specifier: ^1.5.0
        version: 1.5.0(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/create-svelte/templates/default:
    dependencies:
      '@fontsource/fira-mono':
        specifier: ^5.0.8
        version: 5.0.12
    devDependencies:
      '@neoconfetti/svelte':
        specifier: ^1.0.0
        version: 1.0.0
      '@sveltejs/adapter-auto':
        specifier: workspace:*
        version: link:../../../adapter-auto
      '@sveltejs/kit':
        specifier: workspace:*
        version: link:../../../kit
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.0
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/create-svelte/templates/skeleton:
    devDependencies:
      '@sveltejs/adapter-auto':
        specifier: workspace:*
        version: link:../../../adapter-auto

  packages/enhanced-img:
    dependencies:
      magic-string:
        specifier: ^0.30.5
        version: 0.30.9
      svelte-parse-markup:
        specifier: ^0.1.2
        version: 0.1.2(svelte@4.2.14)
      vite-imagetools:
        specifier: ^7.0.1
        version: 7.0.1(rollup@4.14.2)
    devDependencies:
      '@types/estree':
        specifier: ^1.0.5
        version: 1.0.5
      '@types/node':
        specifier: ^18.19.3
        version: 18.19.31
      estree-walker:
        specifier: ^3.0.3
        version: 3.0.3
      rollup:
        specifier: ^4.14.2
        version: 4.14.2
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)
      vitest:
        specifier: ^1.5.0
        version: 1.5.0(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit:
    dependencies:
      '@types/cookie':
        specifier: ^0.6.0
        version: 0.6.0
      cookie:
        specifier: ^0.6.0
        version: 0.6.0
      devalue:
        specifier: ^5.0.0
        version: 5.0.0
      esm-env:
        specifier: ^1.0.0
        version: 1.0.0
      import-meta-resolve:
        specifier: ^4.0.0
        version: 4.0.0
      kleur:
        specifier: ^4.1.5
        version: 4.1.5
      magic-string:
        specifier: ^0.30.5
        version: 0.30.9
      mrmime:
        specifier: ^2.0.0
        version: 2.0.0
      sade:
        specifier: ^1.8.1
        version: 1.8.1
      set-cookie-parser:
        specifier: ^2.6.0
        version: 2.6.0
      sirv:
        specifier: ^2.0.4
        version: 2.0.4
      tiny-glob:
        specifier: ^0.2.9
        version: 0.2.9
    devDependencies:
      '@playwright/test':
        specifier: ^1.41.0
        version: 1.43.1
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      '@types/connect':
        specifier: ^3.4.38
        version: 3.4.38
      '@types/node':
        specifier: ^18.19.3
        version: 18.19.31
      '@types/sade':
        specifier: ^1.7.8
        version: 1.8.0
      '@types/set-cookie-parser':
        specifier: ^2.4.7
        version: 2.4.7
      dts-buddy:
        specifier: 0.4.6
        version: 0.4.6(typescript@5.4.5)
      rollup:
        specifier: ^4.14.2
        version: 4.14.2
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-preprocess:
        specifier: ^5.1.3
        version: 5.1.3(postcss@8.4.38)(svelte@4.2.14)(typescript@5.4.5)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)
      vitest:
        specifier: ^1.5.0
        version: 1.5.0(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/apps/amp:
    devDependencies:
      '@sveltejs/amp':
        specifier: workspace:^
        version: link:../../../../amp
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      cross-env:
        specifier: ^7.0.3
        version: 7.0.3
      dropcss:
        specifier: ^1.0.16
        version: 1.0.16
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/apps/basics:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      cross-env:
        specifier: ^7.0.3
        version: 7.0.3
      marked:
        specifier: ^12.0.0
        version: 12.0.1
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/apps/dev-only:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      cross-env:
        specifier: ^7.0.3
        version: 7.0.3
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/apps/embed:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      cross-env:
        specifier: ^7.0.3
        version: 7.0.3
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/apps/no-ssr:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      cross-env:
        specifier: ^7.0.3
        version: 7.0.3
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/apps/options:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      cross-env:
        specifier: ^7.0.3
        version: 7.0.3
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/apps/options-2:
    devDependencies:
      '@sveltejs/adapter-node':
        specifier: workspace:^
        version: link:../../../../adapter-node
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      cross-env:
        specifier: ^7.0.3
        version: 7.0.3
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/apps/writes:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      cross-env:
        specifier: ^7.0.3
        version: 7.0.3
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors:
    devDependencies:
      vitest:
        specifier: ^1.5.0
        version: 1.5.0(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/prerender-entry-generator-mismatch:
    devDependencies:
      '@sveltejs/adapter-auto':
        specifier: workspace:^
        version: link:../../../../../adapter-auto
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/prerenderable-incorrect-fragment:
    devDependencies:
      '@sveltejs/adapter-auto':
        specifier: workspace:^
        version: link:../../../../../adapter-auto
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/prerenderable-not-prerendered:
    devDependencies:
      '@sveltejs/adapter-auto':
        specifier: workspace:^
        version: link:../../../../../adapter-auto
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/private-dynamic-env:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/private-dynamic-env-dynamic-import:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/private-static-env:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      cross-env:
        specifier: ^7.0.3
        version: 7.0.3
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/private-static-env-dynamic-import:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/server-only-folder:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/server-only-folder-dynamic-import:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/server-only-module:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/server-only-module-dynamic-import:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/service-worker-dynamic-public-env:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/service-worker-private-env:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/build-errors/apps/syntax-error:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/prerendering/basics:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)
      vitest:
        specifier: ^1.5.0
        version: 1.5.0(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/prerendering/options:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)
      vitest:
        specifier: ^1.5.0
        version: 1.5.0(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/kit/test/prerendering/paths-base:
    devDependencies:
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../..
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)
      vitest:
        specifier: ^1.5.0
        version: 1.5.0(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/migrate:
    dependencies:
      import-meta-resolve:
        specifier: ^4.0.0
        version: 4.0.0
      kleur:
        specifier: ^4.1.5
        version: 4.1.5
      magic-string:
        specifier: ^0.30.5
        version: 0.30.9
      prompts:
        specifier: ^2.4.2
        version: 2.4.2
      semver:
        specifier: ^7.5.4
        version: 7.6.0
      tiny-glob:
        specifier: ^0.2.9
        version: 0.2.9
      ts-morph:
        specifier: ^22.0.0
        version: 22.0.0
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      zimmerframe:
        specifier: ^1.1.2
        version: 1.1.2
    devDependencies:
      '@types/node':
        specifier: ^18.19.3
        version: 18.19.31
      '@types/prompts':
        specifier: ^2.4.9
        version: 2.4.9
      '@types/semver':
        specifier: ^7.5.6
        version: 7.5.8
      prettier:
        specifier: ^3.1.1
        version: 3.2.5
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      vitest:
        specifier: ^1.5.0
        version: 1.5.0(@types/node@18.19.31)(lightningcss@1.24.1)

  packages/package:
    dependencies:
      chokidar:
        specifier: ^3.6.0
        version: 3.6.0
      kleur:
        specifier: ^4.1.5
        version: 4.1.5
      sade:
        specifier: ^1.8.1
        version: 1.8.1
      semver:
        specifier: ^7.5.4
        version: 7.6.0
      svelte2tsx:
        specifier: ~0.7.0
        version: 0.7.6(svelte@4.2.14)(typescript@5.4.5)
    devDependencies:
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      '@types/node':
        specifier: ^18.19.3
        version: 18.19.31
      '@types/semver':
        specifier: ^7.5.6
        version: 7.5.8
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-preprocess:
        specifier: ^5.1.3
        version: 5.1.3(postcss@8.4.38)(svelte@4.2.14)(typescript@5.4.5)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      uvu:
        specifier: ^0.5.6
        version: 0.5.6

  playgrounds/basic:
    devDependencies:
      '@sveltejs/adapter-auto':
        specifier: workspace:*
        version: link:../../packages/adapter-auto
      '@sveltejs/adapter-cloudflare':
        specifier: workspace:*
        version: link:../../packages/adapter-cloudflare
      '@sveltejs/adapter-cloudflare-workers':
        specifier: workspace:*
        version: link:../../packages/adapter-cloudflare-workers
      '@sveltejs/adapter-netlify':
        specifier: workspace:*
        version: link:../../packages/adapter-netlify
      '@sveltejs/adapter-node':
        specifier: workspace:*
        version: link:../../packages/adapter-node
      '@sveltejs/adapter-static':
        specifier: workspace:*
        version: link:../../packages/adapter-static
      '@sveltejs/adapter-vercel':
        specifier: workspace:*
        version: link:../../packages/adapter-vercel
      '@sveltejs/amp':
        specifier: workspace:*
        version: link:../../packages/amp
      '@sveltejs/kit':
        specifier: workspace:*
        version: link:../../packages/kit
      '@sveltejs/package':
        specifier: workspace:*
        version: link:../../packages/package
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      publint:
        specifier: ^0.2.0
        version: 0.2.7
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      svelte-check:
        specifier: ^3.6.3
        version: 3.6.9(postcss@8.4.38)(svelte@4.2.14)
      typescript:
        specifier: ^5.3.3
        version: 5.4.5
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)

  sites/kit.svelte.dev:
    dependencies:
      d3-geo:
        specifier: ^3.1.0
        version: 3.1.1
      d3-geo-projection:
        specifier: ^4.0.0
        version: 4.0.0
      topojson-client:
        specifier: ^3.1.0
        version: 3.1.0
    devDependencies:
      '@sveltejs/adapter-vercel':
        specifier: workspace:^
        version: link:../../packages/adapter-vercel
      '@sveltejs/amp':
        specifier: workspace:^
        version: link:../../packages/amp
      '@sveltejs/enhanced-img':
        specifier: workspace:^
        version: link:../../packages/enhanced-img
      '@sveltejs/kit':
        specifier: workspace:^
        version: link:../../packages/kit
      '@sveltejs/site-kit':
        specifier: 6.0.0-next.59
        version: 6.0.0-next.59(@sveltejs/kit@packages+kit)(svelte@4.2.14)
      '@sveltejs/vite-plugin-svelte':
        specifier: ^3.0.1
        version: 3.1.0(svelte@4.2.14)(vite@5.2.8)
      '@types/d3-geo':
        specifier: ^3.1.0
        version: 3.1.0
      '@types/node':
        specifier: ^18.19.3
        version: 18.19.31
      browserslist:
        specifier: ^4.22.2
        version: 4.23.0
      flexsearch:
        specifier: ^0.7.31
        version: 0.7.43
      lightningcss:
        specifier: ^1.22.1
        version: 1.24.1
      marked:
        specifier: ^12.0.0
        version: 12.0.1
      prettier:
        specifier: ^3.1.1
        version: 3.2.5
      prettier-plugin-svelte:
        specifier: ^3.1.2
        version: 3.1.2(prettier@3.2.5)(svelte@4.2.14)
      prism-svelte:
        specifier: ^0.5.0
        version: 0.5.0
      prismjs:
        specifier: ^1.29.0
        version: 1.29.0
      shiki-twoslash:
        specifier: ^3.1.2
        version: 3.1.2(typescript@5.0.4)
      svelte:
        specifier: ^4.2.10
        version: 4.2.14
      typescript:
        specifier: 5.0.4
        version: 5.0.4
      vite:
        specifier: ^5.2.8
        version: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)
      vitest:
        specifier: ^1.5.0
        version: 1.5.0(@types/node@18.19.31)(lightningcss@1.24.1)

packages:

  /@aashutoshrathi/word-wrap@1.2.6:
    resolution: {integrity: sha512-1Yjs2SvM8TflER/OD3cOjhWWOZb58A2t7wpE2S9XfBYTiIl+XFhQG2bjy4Pu1I+EAlCNUzRDYDdFwFYUKvXcIA==}
    engines: {node: '>=0.10.0'}
    dev: true

  /@ampproject/remapping@2.3.0:
    resolution: {integrity: sha512-30iZtAPgz+LTIYoeivqYo853f02jBYSd5uGnGpkFV0M3xOt9aN73erkgYAmZU43x4VfqcnLxW9Kpg3R5LC4YYw==}
    engines: {node: '>=6.0.0'}
    dependencies:
      '@jridgewell/gen-mapping': 0.3.5
      '@jridgewell/trace-mapping': 0.3.25

  /@babel/code-frame@7.24.2:
    resolution: {integrity: sha512-y5+tLQyV8pg3fsiln67BVLD1P13Eg4lh5RW9mF0zUuvLrv9uIQ4MCL+CRT+FTsBlBjcIan6PGsLcBN0m3ClUyQ==}
    engines: {node: '>=6.9.0'}
    dependencies:
      '@babel/highlight': 7.24.2
      picocolors: 1.0.0
    dev: true

  /@babel/helper-validator-identifier@7.22.20:
    resolution: {integrity: sha512-Y4OZ+ytlatR8AI+8KZfKuL5urKp7qey08ha31L8b3BwewJAoJamTzyvxPR/5D+KkdJCGPq/+8TukHBlY10FX9A==}
    engines: {node: '>=6.9.0'}
    dev: true

  /@babel/highlight@7.24.2:
    resolution: {integrity: sha512-Yac1ao4flkTxTteCDZLEvdxg2fZfz1v8M4QpaGypq/WPDqg3ijHYbDfs+LG5hvzSoqaSZ9/Z9lKSP3CjZjv+pA==}
    engines: {node: '>=6.9.0'}
    dependencies:
      '@babel/helper-validator-identifier': 7.22.20
      chalk: 2.4.2
      js-tokens: 4.0.0
      picocolors: 1.0.0
    dev: true

  /@babel/runtime@7.24.4:
    resolution: {integrity: sha512-dkxf7+hn8mFBwKjs9bvBlArzLVxVbS8usaPUDd5p2a9JCL9tB8OaOVN1isD4+Xyk4ns89/xeOmbQvgdK7IIVdA==}
    engines: {node: '>=6.9.0'}
    dependencies:
      regenerator-runtime: 0.14.1
    dev: true

  /@bcoe/v8-coverage@0.2.3:
    resolution: {integrity: sha512-0hYQ8SB4Db5zvZB4axdMHGwEaQjkZzFjQiN9LVYvIFB2nSUHW9tYpxWriPrWDASIxiaXax83REcLxuSdnGPZtw==}
    dev: true

  /@changesets/apply-release-plan@7.0.0:
    resolution: {integrity: sha512-vfi69JR416qC9hWmFGSxj7N6wA5J222XNBmezSVATPWDVPIF7gkd4d8CpbEbXmRWbVrkoli3oerGS6dcL/BGsQ==}
    dependencies:
      '@babel/runtime': 7.24.4
      '@changesets/config': 3.0.0
      '@changesets/get-version-range-type': 0.4.0
      '@changesets/git': 3.0.0
      '@changesets/types': 6.0.0
      '@manypkg/get-packages': 1.1.3
      detect-indent: 6.1.0
      fs-extra: 7.0.1
      lodash.startcase: 4.4.0
      outdent: 0.5.0
      prettier: 2.8.8
      resolve-from: 5.0.0
      semver: 7.6.0
    dev: true

  /@changesets/assemble-release-plan@6.0.0:
    resolution: {integrity: sha512-4QG7NuisAjisbW4hkLCmGW2lRYdPrKzro+fCtZaILX+3zdUELSvYjpL4GTv0E4aM9Mef3PuIQp89VmHJ4y2bfw==}
    dependencies:
      '@babel/runtime': 7.24.4
      '@changesets/errors': 0.2.0
      '@changesets/get-dependents-graph': 2.0.0
      '@changesets/types': 6.0.0
      '@manypkg/get-packages': 1.1.3
      semver: 7.6.0
    dev: true

  /@changesets/changelog-git@0.2.0:
    resolution: {integrity: sha512-bHOx97iFI4OClIT35Lok3sJAwM31VbUM++gnMBV16fdbtBhgYu4dxsphBF/0AZZsyAHMrnM0yFcj5gZM1py6uQ==}
    dependencies:
      '@changesets/types': 6.0.0
    dev: true

  /@changesets/cli@2.27.1:
    resolution: {integrity: sha512-iJ91xlvRnnrJnELTp4eJJEOPjgpF3NOh4qeQehM6Ugiz9gJPRZ2t+TsXun6E3AMN4hScZKjqVXl0TX+C7AB3ZQ==}
    hasBin: true
    dependencies:
      '@babel/runtime': 7.24.4
      '@changesets/apply-release-plan': 7.0.0
      '@changesets/assemble-release-plan': 6.0.0
      '@changesets/changelog-git': 0.2.0
      '@changesets/config': 3.0.0
      '@changesets/errors': 0.2.0
      '@changesets/get-dependents-graph': 2.0.0
      '@changesets/get-release-plan': 4.0.0
      '@changesets/git': 3.0.0
      '@changesets/logger': 0.1.0
      '@changesets/pre': 2.0.0
      '@changesets/read': 0.6.0
      '@changesets/types': 6.0.0
      '@changesets/write': 0.3.0
      '@manypkg/get-packages': 1.1.3
      '@types/semver': 7.5.8
      ansi-colors: 4.1.3
      chalk: 2.4.2
      ci-info: 3.9.0
      enquirer: 2.4.1
      external-editor: 3.1.0
      fs-extra: 7.0.1
      human-id: 1.0.2
      meow: 6.1.1
      outdent: 0.5.0
      p-limit: 2.3.0
      preferred-pm: 3.1.3
      resolve-from: 5.0.0
      semver: 7.6.0
      spawndamnit: 2.0.0
      term-size: 2.2.1
      tty-table: 4.2.3
    dev: true

  /@changesets/config@3.0.0:
    resolution: {integrity: sha512-o/rwLNnAo/+j9Yvw9mkBQOZySDYyOr/q+wptRLcAVGlU6djOeP9v1nlalbL9MFsobuBVQbZCTp+dIzdq+CLQUA==}
    dependencies:
      '@changesets/errors': 0.2.0
      '@changesets/get-dependents-graph': 2.0.0
      '@changesets/logger': 0.1.0
      '@changesets/types': 6.0.0
      '@manypkg/get-packages': 1.1.3
      fs-extra: 7.0.1
      micromatch: 4.0.5
    dev: true

  /@changesets/errors@0.2.0:
    resolution: {integrity: sha512-6BLOQUscTpZeGljvyQXlWOItQyU71kCdGz7Pi8H8zdw6BI0g3m43iL4xKUVPWtG+qrrL9DTjpdn8eYuCQSRpow==}
    dependencies:
      extendable-error: 0.1.7
    dev: true

  /@changesets/get-dependents-graph@2.0.0:
    resolution: {integrity: sha512-cafUXponivK4vBgZ3yLu944mTvam06XEn2IZGjjKc0antpenkYANXiiE6GExV/yKdsCnE8dXVZ25yGqLYZmScA==}
    dependencies:
      '@changesets/types': 6.0.0
      '@manypkg/get-packages': 1.1.3
      chalk: 2.4.2
      fs-extra: 7.0.1
      semver: 7.6.0
    dev: true

  /@changesets/get-github-info@0.5.2:
    resolution: {integrity: sha512-JppheLu7S114aEs157fOZDjFqUDpm7eHdq5E8SSR0gUBTEK0cNSHsrSR5a66xs0z3RWuo46QvA3vawp8BxDHvg==}
    dependencies:
      dataloader: 1.4.0
      node-fetch: 2.7.0
    transitivePeerDependencies:
      - encoding
    dev: true

  /@changesets/get-release-plan@4.0.0:
    resolution: {integrity: sha512-9L9xCUeD/Tb6L/oKmpm8nyzsOzhdNBBbt/ZNcjynbHC07WW4E1eX8NMGC5g5SbM5z/V+MOrYsJ4lRW41GCbg3w==}
    dependencies:
      '@babel/runtime': 7.24.4
      '@changesets/assemble-release-plan': 6.0.0
      '@changesets/config': 3.0.0
      '@changesets/pre': 2.0.0
      '@changesets/read': 0.6.0
      '@changesets/types': 6.0.0
      '@manypkg/get-packages': 1.1.3
    dev: true

  /@changesets/get-version-range-type@0.4.0:
    resolution: {integrity: sha512-hwawtob9DryoGTpixy1D3ZXbGgJu1Rhr+ySH2PvTLHvkZuQ7sRT4oQwMh0hbqZH1weAooedEjRsbrWcGLCeyVQ==}
    dev: true

  /@changesets/git@3.0.0:
    resolution: {integrity: sha512-vvhnZDHe2eiBNRFHEgMiGd2CT+164dfYyrJDhwwxTVD/OW0FUD6G7+4DIx1dNwkwjHyzisxGAU96q0sVNBns0w==}
    dependencies:
      '@babel/runtime': 7.24.4
      '@changesets/errors': 0.2.0
      '@changesets/types': 6.0.0
      '@manypkg/get-packages': 1.1.3
      is-subdir: 1.2.0
      micromatch: 4.0.5
      spawndamnit: 2.0.0
    dev: true

  /@changesets/logger@0.1.0:
    resolution: {integrity: sha512-pBrJm4CQm9VqFVwWnSqKEfsS2ESnwqwH+xR7jETxIErZcfd1u2zBSqrHbRHR7xjhSgep9x2PSKFKY//FAshA3g==}
    dependencies:
      chalk: 2.4.2
    dev: true

  /@changesets/parse@0.4.0:
    resolution: {integrity: sha512-TS/9KG2CdGXS27S+QxbZXgr8uPsP4yNJYb4BC2/NeFUj80Rni3TeD2qwWmabymxmrLo7JEsytXH1FbpKTbvivw==}
    dependencies:
      '@changesets/types': 6.0.0
      js-yaml: 3.14.1
    dev: true

  /@changesets/pre@2.0.0:
    resolution: {integrity: sha512-HLTNYX/A4jZxc+Sq8D1AMBsv+1qD6rmmJtjsCJa/9MSRybdxh0mjbTvE6JYZQ/ZiQ0mMlDOlGPXTm9KLTU3jyw==}
    dependencies:
      '@babel/runtime': 7.24.4
      '@changesets/errors': 0.2.0
      '@changesets/types': 6.0.0
      '@manypkg/get-packages': 1.1.3
      fs-extra: 7.0.1
    dev: true

  /@changesets/read@0.6.0:
    resolution: {integrity: sha512-ZypqX8+/im1Fm98K4YcZtmLKgjs1kDQ5zHpc2U1qdtNBmZZfo/IBiG162RoP0CUF05tvp2y4IspH11PLnPxuuw==}
    dependencies:
      '@babel/runtime': 7.24.4
      '@changesets/git': 3.0.0
      '@changesets/logger': 0.1.0
      '@changesets/parse': 0.4.0
      '@changesets/types': 6.0.0
      chalk: 2.4.2
      fs-extra: 7.0.1
      p-filter: 2.1.0
    dev: true

  /@changesets/types@4.1.0:
    resolution: {integrity: sha512-LDQvVDv5Kb50ny2s25Fhm3d9QSZimsoUGBsUioj6MC3qbMUCuC8GPIvk/M6IvXx3lYhAs0lwWUQLb+VIEUCECw==}
    dev: true

  /@changesets/types@6.0.0:
    resolution: {integrity: sha512-b1UkfNulgKoWfqyHtzKS5fOZYSJO+77adgL7DLRDr+/7jhChN+QcHnbjiQVOz/U+Ts3PGNySq7diAItzDgugfQ==}
    dev: true

  /@changesets/write@0.3.0:
    resolution: {integrity: sha512-slGLb21fxZVUYbyea+94uFiD6ntQW0M2hIKNznFizDhZPDgn2c/fv1UzzlW43RVzh1BEDuIqW6hzlJ1OflNmcw==}
    dependencies:
      '@babel/runtime': 7.24.4
      '@changesets/types': 6.0.0
      fs-extra: 7.0.1
      human-id: 1.0.2
      prettier: 2.8.8
    dev: true

  /@clack/core@0.3.4:
    resolution: {integrity: sha512-H4hxZDXgHtWTwV3RAVenqcC4VbJZNegbBjlPvzOzCouXtS2y3sDvlO3IsbrPNWuLWPPlYVYPghQdSF64683Ldw==}
    dependencies:
      picocolors: 1.0.0
      sisteransi: 1.0.5
    dev: false

  /@clack/prompts@0.7.0:
    resolution: {integrity: sha512-0MhX9/B4iL6Re04jPrttDm+BsP8y6mS7byuv0BvXgdXhbV5PdlsHt55dvNsuBCPZ7xq1oTAOOuotR9NFbQyMSA==}
    dependencies:
      '@clack/core': 0.3.4
      picocolors: 1.0.0
      sisteransi: 1.0.5
    dev: false
    bundledDependencies:
      - is-unicode-supported

  /@cloudflare/kv-asset-handler@0.3.1:
    resolution: {integrity: sha512-lKN2XCfKCmpKb86a1tl4GIwsJYDy9TGuwjhDELLmpKygQhw8X2xR4dusgpC5Tg7q1pB96Eb0rBo81kxSILQMwA==}
    dependencies:
      mime: 3.0.0

  /@cloudflare/workerd-darwin-64@1.20240405.0:
    resolution: {integrity: sha512-ut8kwpHmlz9dNSjoov6v1b6jS50J46Mj9QcMA0t1Hne36InaQk/qqPSd12fN5p2GesZ9OOBJvBdDsTblVdyJ1w==}
    engines: {node: '>=16'}
    cpu: [x64]
    os: [darwin]
    requiresBuild: true
    dev: false
    optional: true

  /@cloudflare/workerd-darwin-arm64@1.20240405.0:
    resolution: {integrity: sha512-x3A3Ym+J2DH1uYnw0aedeKOTnUebEo312+Aladv7bFri97pjRJcqVbYhMtOHLkHjwYn7bpKSY2eL5iM+0XT29A==}
    engines: {node: '>=16'}
    cpu: [arm64]
    os: [darwin]
    requiresBuild: true
    dev: false
    optional: true

  /@cloudflare/workerd-linux-64@1.20240405.0:
    resolution: {integrity: sha512-3tYpfjtxEQ0R30Pna7OF3Bz0CTx30hc0QNtH61KnkvXtaeYMkWutSKQKXIuVlPa/7v1MHp+8ViBXMflmS7HquA==}
    engines: {node: '>=16'}
    cpu: [x64]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@cloudflare/workerd-linux-arm64@1.20240405.0:
    resolution: {integrity: sha512-NpKZlvmdgcX/m4tP5zM91AfJpZrue2/GRA+Sl3szxAivu2uE5jDVf5SS9dzqzCVfPrdhylqH7yeL4U/cafFNOg==}
    engines: {node: '>=16'}
    cpu: [arm64]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@cloudflare/workerd-windows-64@1.20240405.0:
    resolution: {integrity: sha512-REBeJMxvUCjwuEVzSSIBtzAyM69QjToab8qBst0S9vdih+9DObym4dw8CevdBQhDbFrHiyL9E6pAZpLPNHVgCw==}
    engines: {node: '>=16'}
    cpu: [x64]
    os: [win32]
    requiresBuild: true
    dev: false
    optional: true

  /@cloudflare/workers-types@4.20240405.0:
    resolution: {integrity: sha512-sEVOhyOgXUwfLkgHqbLZa/sfkSYrh7/zLmI6EZNibPaVPvAnAcItbNNl3SAlLyLKuwf8m4wAIAgu9meKWCvXjg==}
    dev: false

  /@cspotcode/source-map-support@0.8.1:
    resolution: {integrity: sha512-IchNf6dN4tHoMFIn/7OE8LWZ19Y6q/67Bmf6vnGREv8RSbBVb9LPJxEcnwrcwX6ixSvaiGoomAUvu4YSxXrVgw==}
    engines: {node: '>=12'}
    dependencies:
      '@jridgewell/trace-mapping': 0.3.9
    dev: false

  /@emnapi/runtime@1.1.1:
    resolution: {integrity: sha512-3bfqkzuR1KLx57nZfjr2NLnFOobvyS0aTszaEGCGqmYMVDRaGvgIZbjGSV/MHSSmLgQ/b9JFHQ5xm5WRZYd+XQ==}
    requiresBuild: true
    dependencies:
      tslib: 2.6.2
    dev: false
    optional: true

  /@esbuild-plugins/node-globals-polyfill@0.2.3(esbuild@0.17.19):
    resolution: {integrity: sha512-r3MIryXDeXDOZh7ih1l/yE9ZLORCd5e8vWg02azWRGj5SPTuoh69A2AIyn0Z31V/kHBfZ4HgWJ+OK3GTTwLmnw==}
    peerDependencies:
      esbuild: '*'
    dependencies:
      esbuild: 0.17.19
    dev: false

  /@esbuild-plugins/node-modules-polyfill@0.2.2(esbuild@0.17.19):
    resolution: {integrity: sha512-LXV7QsWJxRuMYvKbiznh+U1ilIop3g2TeKRzUxOG5X3YITc8JyyTa90BmLwqqv0YnX4v32CSlG+vsziZp9dMvA==}
    peerDependencies:
      esbuild: '*'
    dependencies:
      esbuild: 0.17.19
      escape-string-regexp: 4.0.0
      rollup-plugin-node-polyfills: 0.2.1
    dev: false

  /@esbuild/aix-ppc64@0.20.2:
    resolution: {integrity: sha512-D+EBOJHXdNZcLJRBkhENNG8Wji2kgc9AZ9KiPr1JuZjsNtyHzrsfLRrY0tk2H2aoFu6RANO1y1iPPUCDYWkb5g==}
    engines: {node: '>=12'}
    cpu: [ppc64]
    os: [aix]
    requiresBuild: true
    optional: true

  /@esbuild/android-arm64@0.17.19:
    resolution: {integrity: sha512-KBMWvEZooR7+kzY0BtbTQn0OAYY7CsiydT63pVEaPtVYF0hXbUaOyZog37DKxK7NF3XacBJOpYT4adIJh+avxA==}
    engines: {node: '>=12'}
    cpu: [arm64]
    os: [android]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/android-arm64@0.20.2:
    resolution: {integrity: sha512-mRzjLacRtl/tWU0SvD8lUEwb61yP9cqQo6noDZP/O8VkwafSYwZ4yWy24kan8jE/IMERpYncRt2dw438LP3Xmg==}
    engines: {node: '>=12'}
    cpu: [arm64]
    os: [android]
    requiresBuild: true
    optional: true

  /@esbuild/android-arm@0.17.19:
    resolution: {integrity: sha512-rIKddzqhmav7MSmoFCmDIb6e2W57geRsM94gV2l38fzhXMwq7hZoClug9USI2pFRGL06f4IOPHHpFNOkWieR8A==}
    engines: {node: '>=12'}
    cpu: [arm]
    os: [android]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/android-arm@0.20.2:
    resolution: {integrity: sha512-t98Ra6pw2VaDhqNWO2Oph2LXbz/EJcnLmKLGBJwEwXX/JAN83Fym1rU8l0JUWK6HkIbWONCSSatf4sf2NBRx/w==}
    engines: {node: '>=12'}
    cpu: [arm]
    os: [android]
    requiresBuild: true
    optional: true

  /@esbuild/android-x64@0.17.19:
    resolution: {integrity: sha512-uUTTc4xGNDT7YSArp/zbtmbhO0uEEK9/ETW29Wk1thYUJBz3IVnvgEiEwEa9IeLyvnpKrWK64Utw2bgUmDveww==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [android]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/android-x64@0.20.2:
    resolution: {integrity: sha512-btzExgV+/lMGDDa194CcUQm53ncxzeBrWJcncOBxuC6ndBkKxnHdFJn86mCIgTELsooUmwUm9FkhSp5HYu00Rg==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [android]
    requiresBuild: true
    optional: true

  /@esbuild/darwin-arm64@0.17.19:
    resolution: {integrity: sha512-80wEoCfF/hFKM6WE1FyBHc9SfUblloAWx6FJkFWTWiCoht9Mc0ARGEM47e67W9rI09YoUxJL68WHfDRYEAvOhg==}
    engines: {node: '>=12'}
    cpu: [arm64]
    os: [darwin]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/darwin-arm64@0.20.2:
    resolution: {integrity: sha512-4J6IRT+10J3aJH3l1yzEg9y3wkTDgDk7TSDFX+wKFiWjqWp/iCfLIYzGyasx9l0SAFPT1HwSCR+0w/h1ES/MjA==}
    engines: {node: '>=12'}
    cpu: [arm64]
    os: [darwin]
    requiresBuild: true
    optional: true

  /@esbuild/darwin-x64@0.17.19:
    resolution: {integrity: sha512-IJM4JJsLhRYr9xdtLytPLSH9k/oxR3boaUIYiHkAawtwNOXKE8KoU8tMvryogdcT8AU+Bflmh81Xn6Q0vTZbQw==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [darwin]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/darwin-x64@0.20.2:
    resolution: {integrity: sha512-tBcXp9KNphnNH0dfhv8KYkZhjc+H3XBkF5DKtswJblV7KlT9EI2+jeA8DgBjp908WEuYll6pF+UStUCfEpdysA==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [darwin]
    requiresBuild: true
    optional: true

  /@esbuild/freebsd-arm64@0.17.19:
    resolution: {integrity: sha512-pBwbc7DufluUeGdjSU5Si+P3SoMF5DQ/F/UmTSb8HXO80ZEAJmrykPyzo1IfNbAoaqw48YRpv8shwd1NoI0jcQ==}
    engines: {node: '>=12'}
    cpu: [arm64]
    os: [freebsd]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/freebsd-arm64@0.20.2:
    resolution: {integrity: sha512-d3qI41G4SuLiCGCFGUrKsSeTXyWG6yem1KcGZVS+3FYlYhtNoNgYrWcvkOoaqMhwXSMrZRl69ArHsGJ9mYdbbw==}
    engines: {node: '>=12'}
    cpu: [arm64]
    os: [freebsd]
    requiresBuild: true
    optional: true

  /@esbuild/freebsd-x64@0.17.19:
    resolution: {integrity: sha512-4lu+n8Wk0XlajEhbEffdy2xy53dpR06SlzvhGByyg36qJw6Kpfk7cp45DR/62aPH9mtJRmIyrXAS5UWBrJT6TQ==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [freebsd]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/freebsd-x64@0.20.2:
    resolution: {integrity: sha512-d+DipyvHRuqEeM5zDivKV1KuXn9WeRX6vqSqIDgwIfPQtwMP4jaDsQsDncjTDDsExT4lR/91OLjRo8bmC1e+Cw==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [freebsd]
    requiresBuild: true
    optional: true

  /@esbuild/linux-arm64@0.17.19:
    resolution: {integrity: sha512-ct1Tg3WGwd3P+oZYqic+YZF4snNl2bsnMKRkb3ozHmnM0dGWuxcPTTntAF6bOP0Sp4x0PjSF+4uHQ1xvxfRKqg==}
    engines: {node: '>=12'}
    cpu: [arm64]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/linux-arm64@0.20.2:
    resolution: {integrity: sha512-9pb6rBjGvTFNira2FLIWqDk/uaf42sSyLE8j1rnUpuzsODBq7FvpwHYZxQ/It/8b+QOS1RYfqgGFNLRI+qlq2A==}
    engines: {node: '>=12'}
    cpu: [arm64]
    os: [linux]
    requiresBuild: true
    optional: true

  /@esbuild/linux-arm@0.17.19:
    resolution: {integrity: sha512-cdmT3KxjlOQ/gZ2cjfrQOtmhG4HJs6hhvm3mWSRDPtZ/lP5oe8FWceS10JaSJC13GBd4eH/haHnqf7hhGNLerA==}
    engines: {node: '>=12'}
    cpu: [arm]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/linux-arm@0.20.2:
    resolution: {integrity: sha512-VhLPeR8HTMPccbuWWcEUD1Az68TqaTYyj6nfE4QByZIQEQVWBB8vup8PpR7y1QHL3CpcF6xd5WVBU/+SBEvGTg==}
    engines: {node: '>=12'}
    cpu: [arm]
    os: [linux]
    requiresBuild: true
    optional: true

  /@esbuild/linux-ia32@0.17.19:
    resolution: {integrity: sha512-w4IRhSy1VbsNxHRQpeGCHEmibqdTUx61Vc38APcsRbuVgK0OPEnQ0YD39Brymn96mOx48Y2laBQGqgZ0j9w6SQ==}
    engines: {node: '>=12'}
    cpu: [ia32]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/linux-ia32@0.20.2:
    resolution: {integrity: sha512-o10utieEkNPFDZFQm9CoP7Tvb33UutoJqg3qKf1PWVeeJhJw0Q347PxMvBgVVFgouYLGIhFYG0UGdBumROyiig==}
    engines: {node: '>=12'}
    cpu: [ia32]
    os: [linux]
    requiresBuild: true
    optional: true

  /@esbuild/linux-loong64@0.17.19:
    resolution: {integrity: sha512-2iAngUbBPMq439a+z//gE+9WBldoMp1s5GWsUSgqHLzLJ9WoZLZhpwWuym0u0u/4XmZ3gpHmzV84PonE+9IIdQ==}
    engines: {node: '>=12'}
    cpu: [loong64]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/linux-loong64@0.20.2:
    resolution: {integrity: sha512-PR7sp6R/UC4CFVomVINKJ80pMFlfDfMQMYynX7t1tNTeivQ6XdX5r2XovMmha/VjR1YN/HgHWsVcTRIMkymrgQ==}
    engines: {node: '>=12'}
    cpu: [loong64]
    os: [linux]
    requiresBuild: true
    optional: true

  /@esbuild/linux-mips64el@0.17.19:
    resolution: {integrity: sha512-LKJltc4LVdMKHsrFe4MGNPp0hqDFA1Wpt3jE1gEyM3nKUvOiO//9PheZZHfYRfYl6AwdTH4aTcXSqBerX0ml4A==}
    engines: {node: '>=12'}
    cpu: [mips64el]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/linux-mips64el@0.20.2:
    resolution: {integrity: sha512-4BlTqeutE/KnOiTG5Y6Sb/Hw6hsBOZapOVF6njAESHInhlQAghVVZL1ZpIctBOoTFbQyGW+LsVYZ8lSSB3wkjA==}
    engines: {node: '>=12'}
    cpu: [mips64el]
    os: [linux]
    requiresBuild: true
    optional: true

  /@esbuild/linux-ppc64@0.17.19:
    resolution: {integrity: sha512-/c/DGybs95WXNS8y3Ti/ytqETiW7EU44MEKuCAcpPto3YjQbyK3IQVKfF6nbghD7EcLUGl0NbiL5Rt5DMhn5tg==}
    engines: {node: '>=12'}
    cpu: [ppc64]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/linux-ppc64@0.20.2:
    resolution: {integrity: sha512-rD3KsaDprDcfajSKdn25ooz5J5/fWBylaaXkuotBDGnMnDP1Uv5DLAN/45qfnf3JDYyJv/ytGHQaziHUdyzaAg==}
    engines: {node: '>=12'}
    cpu: [ppc64]
    os: [linux]
    requiresBuild: true
    optional: true

  /@esbuild/linux-riscv64@0.17.19:
    resolution: {integrity: sha512-FC3nUAWhvFoutlhAkgHf8f5HwFWUL6bYdvLc/TTuxKlvLi3+pPzdZiFKSWz/PF30TB1K19SuCxDTI5KcqASJqA==}
    engines: {node: '>=12'}
    cpu: [riscv64]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/linux-riscv64@0.20.2:
    resolution: {integrity: sha512-snwmBKacKmwTMmhLlz/3aH1Q9T8v45bKYGE3j26TsaOVtjIag4wLfWSiZykXzXuE1kbCE+zJRmwp+ZbIHinnVg==}
    engines: {node: '>=12'}
    cpu: [riscv64]
    os: [linux]
    requiresBuild: true
    optional: true

  /@esbuild/linux-s390x@0.17.19:
    resolution: {integrity: sha512-IbFsFbxMWLuKEbH+7sTkKzL6NJmG2vRyy6K7JJo55w+8xDk7RElYn6xvXtDW8HCfoKBFK69f3pgBJSUSQPr+4Q==}
    engines: {node: '>=12'}
    cpu: [s390x]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/linux-s390x@0.20.2:
    resolution: {integrity: sha512-wcWISOobRWNm3cezm5HOZcYz1sKoHLd8VL1dl309DiixxVFoFe/o8HnwuIwn6sXre88Nwj+VwZUvJf4AFxkyrQ==}
    engines: {node: '>=12'}
    cpu: [s390x]
    os: [linux]
    requiresBuild: true
    optional: true

  /@esbuild/linux-x64@0.17.19:
    resolution: {integrity: sha512-68ngA9lg2H6zkZcyp22tsVt38mlhWde8l3eJLWkyLrp4HwMUr3c1s/M2t7+kHIhvMjglIBrFpncX1SzMckomGw==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/linux-x64@0.20.2:
    resolution: {integrity: sha512-1MdwI6OOTsfQfek8sLwgyjOXAu+wKhLEoaOLTjbijk6E2WONYpH9ZU2mNtR+lZ2B4uwr+usqGuVfFT9tMtGvGw==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [linux]
    requiresBuild: true
    optional: true

  /@esbuild/netbsd-x64@0.17.19:
    resolution: {integrity: sha512-CwFq42rXCR8TYIjIfpXCbRX0rp1jo6cPIUPSaWwzbVI4aOfX96OXY8M6KNmtPcg7QjYeDmN+DD0Wp3LaBOLf4Q==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [netbsd]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/netbsd-x64@0.20.2:
    resolution: {integrity: sha512-K8/DhBxcVQkzYc43yJXDSyjlFeHQJBiowJ0uVL6Tor3jGQfSGHNNJcWxNbOI8v5k82prYqzPuwkzHt3J1T1iZQ==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [netbsd]
    requiresBuild: true
    optional: true

  /@esbuild/openbsd-x64@0.17.19:
    resolution: {integrity: sha512-cnq5brJYrSZ2CF6c35eCmviIN3k3RczmHz8eYaVlNasVqsNY+JKohZU5MKmaOI+KkllCdzOKKdPs762VCPC20g==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [openbsd]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/openbsd-x64@0.20.2:
    resolution: {integrity: sha512-eMpKlV0SThJmmJgiVyN9jTPJ2VBPquf6Kt/nAoo6DgHAoN57K15ZghiHaMvqjCye/uU4X5u3YSMgVBI1h3vKrQ==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [openbsd]
    requiresBuild: true
    optional: true

  /@esbuild/sunos-x64@0.17.19:
    resolution: {integrity: sha512-vCRT7yP3zX+bKWFeP/zdS6SqdWB8OIpaRq/mbXQxTGHnIxspRtigpkUcDMlSCOejlHowLqII7K2JKevwyRP2rg==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [sunos]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/sunos-x64@0.20.2:
    resolution: {integrity: sha512-2UyFtRC6cXLyejf/YEld4Hajo7UHILetzE1vsRcGL3earZEW77JxrFjH4Ez2qaTiEfMgAXxfAZCm1fvM/G/o8w==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [sunos]
    requiresBuild: true
    optional: true

  /@esbuild/win32-arm64@0.17.19:
    resolution: {integrity: sha512-yYx+8jwowUstVdorcMdNlzklLYhPxjniHWFKgRqH7IFlUEa0Umu3KuYplf1HUZZ422e3NU9F4LGb+4O0Kdcaag==}
    engines: {node: '>=12'}
    cpu: [arm64]
    os: [win32]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/win32-arm64@0.20.2:
    resolution: {integrity: sha512-GRibxoawM9ZCnDxnP3usoUDO9vUkpAxIIZ6GQI+IlVmr5kP3zUq+l17xELTHMWTWzjxa2guPNyrpq1GWmPvcGQ==}
    engines: {node: '>=12'}
    cpu: [arm64]
    os: [win32]
    requiresBuild: true
    optional: true

  /@esbuild/win32-ia32@0.17.19:
    resolution: {integrity: sha512-eggDKanJszUtCdlVs0RB+h35wNlb5v4TWEkq4vZcmVt5u/HiDZrTXe2bWFQUez3RgNHwx/x4sk5++4NSSicKkw==}
    engines: {node: '>=12'}
    cpu: [ia32]
    os: [win32]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/win32-ia32@0.20.2:
    resolution: {integrity: sha512-HfLOfn9YWmkSKRQqovpnITazdtquEW8/SoHW7pWpuEeguaZI4QnCRW6b+oZTztdBnZOS2hqJ6im/D5cPzBTTlQ==}
    engines: {node: '>=12'}
    cpu: [ia32]
    os: [win32]
    requiresBuild: true
    optional: true

  /@esbuild/win32-x64@0.17.19:
    resolution: {integrity: sha512-lAhycmKnVOuRYNtRtatQR1LPQf2oYCkRGkSFnseDAKPl8lu5SOsK/e1sXe5a0Pc5kHIHe6P2I/ilntNv2xf3cA==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [win32]
    requiresBuild: true
    dev: false
    optional: true

  /@esbuild/win32-x64@0.20.2:
    resolution: {integrity: sha512-N49X4lJX27+l9jbLKSqZ6bKNjzQvHaT8IIFUy+YIqmXQdjYCToGWwOItDrfby14c78aDd5NHQl29xingXfCdLQ==}
    engines: {node: '>=12'}
    cpu: [x64]
    os: [win32]
    requiresBuild: true
    optional: true

  /@eslint-community/eslint-utils@4.4.0(eslint@8.57.0):
    resolution: {integrity: sha512-1/sA4dwrzBAyeUoQ6oxahHKmrZvsnLCg4RfxW3ZFGGmQkSNQPFNLV9CUEFQP1x9EYXHTo5p6xdhZM1Ne9p/AfA==}
    engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}
    peerDependencies:
      eslint: ^6.0.0 || ^7.0.0 || >=8.0.0
    dependencies:
      eslint: 8.57.0
      eslint-visitor-keys: 3.4.3
    dev: true

  /@eslint-community/regexpp@4.10.0:
    resolution: {integrity: sha512-Cu96Sd2By9mCNTx2iyKOmq10v22jUVQv0lQnlGNy16oE9589yE+QADPbrMGCkA51cKZSg3Pu/aTJVTGfL/qjUA==}
    engines: {node: ^12.0.0 || ^14.0.0 || >=16.0.0}
    dev: true

  /@eslint/eslintrc@2.1.4:
    resolution: {integrity: sha512-269Z39MS6wVJtsoUl10L60WdkhJVdPG24Q4eZTH3nnF6lpvSShEK3wQjDX9JRWAUPvPh7COouPpU9IrqaZFvtQ==}
    engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}
    dependencies:
      ajv: 6.12.6
      debug: 4.3.4
      espree: 9.6.1
      globals: 13.24.0
      ignore: 5.3.1
      import-fresh: 3.3.0
      js-yaml: 4.1.0
      minimatch: 3.1.2
      strip-json-comments: 3.1.1
    transitivePeerDependencies:
      - supports-color
    dev: true

  /@eslint/js@8.57.0:
    resolution: {integrity: sha512-Ys+3g2TaW7gADOJzPt83SJtCDhMjndcDMFVQ/Tj9iA1BfJzFKD9mAUXT3OenpuPHbI6P/myECxRJrofUsDx/5g==}
    engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}
    dev: true

  /@fastify/busboy@2.1.1:
    resolution: {integrity: sha512-vBZP4NlzfOlerQTnba4aqZoMhE/a9HY7HRqoOPaETQcSQuWEIyZMHGfVu6w9wGtGK5fED5qRs2DteVCjOH60sA==}
    engines: {node: '>=14'}
    dev: false

  /@fontsource/fira-mono@5.0.12:
    resolution: {integrity: sha512-1uFRjqCcxVv4F31PjyLm8o4oNlT5ywwh6OwcDGkZbafOeFZHXekvholS9IlfZkRsZvVhSbFRHT/5iDib4KTtpg==}
    dev: false

  /@humanwhocodes/config-array@0.11.14:
    resolution: {integrity: sha512-3T8LkOmg45BV5FICb15QQMsyUSWrQ8AygVfC7ZG32zOalnqrilm018ZVCw0eapXux8FtA33q8PSRSstjee3jSg==}
    engines: {node: '>=10.10.0'}
    dependencies:
      '@humanwhocodes/object-schema': 2.0.3
      debug: 4.3.4
      minimatch: 3.1.2
    transitivePeerDependencies:
      - supports-color
    dev: true

  /@humanwhocodes/module-importer@1.0.1:
    resolution: {integrity: sha512-bxveV4V8v5Yb4ncFTT3rPSgZBOpCkjfK0y4oVVVJwIuDVBRMDXrPyXRL988i5ap9m9bnyEEjWfm5WkBmtffLfA==}
    engines: {node: '>=12.22'}
    dev: true

  /@humanwhocodes/object-schema@2.0.3:
    resolution: {integrity: sha512-93zYdMES/c1D69yZiKDBj0V24vqNzB/koF26KPaagAfd3P/4gUlh3Dys5ogAK+Exi9QyzlD8x/08Zt7wIKcDcA==}
    dev: true

  /@iarna/toml@2.2.5:
    resolution: {integrity: sha512-trnsAYxU3xnS1gPHPyU961coFyLkh4gAD/0zQ5mymY4yOZ+CYvsPqUbOFSw0aDM4y0tV7tiFxL/1XfXPNC6IPg==}
    dev: false

  /@img/sharp-darwin-arm64@0.33.3:
    resolution: {integrity: sha512-FaNiGX1MrOuJ3hxuNzWgsT/mg5OHG/Izh59WW2mk1UwYHUwtfbhk5QNKYZgxf0pLOhx9ctGiGa2OykD71vOnSw==}
    engines: {glibc: '>=2.26', node: ^18.17.0 || ^20.3.0 || >=21.0.0, npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [arm64]
    os: [darwin]
    requiresBuild: true
    optionalDependencies:
      '@img/sharp-libvips-darwin-arm64': 1.0.2
    dev: false
    optional: true

  /@img/sharp-darwin-x64@0.33.3:
    resolution: {integrity: sha512-2QeSl7QDK9ru//YBT4sQkoq7L0EAJZA3rtV+v9p8xTKl4U1bUqTIaCnoC7Ctx2kCjQgwFXDasOtPTCT8eCTXvw==}
    engines: {glibc: '>=2.26', node: ^18.17.0 || ^20.3.0 || >=21.0.0, npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [x64]
    os: [darwin]
    requiresBuild: true
    optionalDependencies:
      '@img/sharp-libvips-darwin-x64': 1.0.2
    dev: false
    optional: true

  /@img/sharp-libvips-darwin-arm64@1.0.2:
    resolution: {integrity: sha512-tcK/41Rq8IKlSaKRCCAuuY3lDJjQnYIW1UXU1kxcEKrfL8WR7N6+rzNoOxoQRJWTAECuKwgAHnPvqXGN8XfkHA==}
    engines: {macos: '>=11', npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [arm64]
    os: [darwin]
    requiresBuild: true
    dev: false
    optional: true

  /@img/sharp-libvips-darwin-x64@1.0.2:
    resolution: {integrity: sha512-Ofw+7oaWa0HiiMiKWqqaZbaYV3/UGL2wAPeLuJTx+9cXpCRdvQhCLG0IH8YGwM0yGWGLpsF4Su9vM1o6aer+Fw==}
    engines: {macos: '>=10.13', npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [x64]
    os: [darwin]
    requiresBuild: true
    dev: false
    optional: true

  /@img/sharp-libvips-linux-arm64@1.0.2:
    resolution: {integrity: sha512-x7kCt3N00ofFmmkkdshwj3vGPCnmiDh7Gwnd4nUwZln2YjqPxV1NlTyZOvoDWdKQVDL911487HOueBvrpflagw==}
    engines: {glibc: '>=2.26', npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [arm64]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@img/sharp-libvips-linux-arm@1.0.2:
    resolution: {integrity: sha512-iLWCvrKgeFoglQxdEwzu1eQV04o8YeYGFXtfWU26Zr2wWT3q3MTzC+QTCO3ZQfWd3doKHT4Pm2kRmLbupT+sZw==}
    engines: {glibc: '>=2.28', npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [arm]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@img/sharp-libvips-linux-s390x@1.0.2:
    resolution: {integrity: sha512-cmhQ1J4qVhfmS6szYW7RT+gLJq9dH2i4maq+qyXayUSn9/3iY2ZeWpbAgSpSVbV2E1JUL2Gg7pwnYQ1h8rQIog==}
    engines: {glibc: '>=2.28', npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [s390x]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@img/sharp-libvips-linux-x64@1.0.2:
    resolution: {integrity: sha512-E441q4Qdb+7yuyiADVi5J+44x8ctlrqn8XgkDTwr4qPJzWkaHwD489iZ4nGDgcuya4iMN3ULV6NwbhRZJ9Z7SQ==}
    engines: {glibc: '>=2.26', npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [x64]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@img/sharp-libvips-linuxmusl-arm64@1.0.2:
    resolution: {integrity: sha512-3CAkndNpYUrlDqkCM5qhksfE+qSIREVpyoeHIU6jd48SJZViAmznoQQLAv4hVXF7xyUB9zf+G++e2v1ABjCbEQ==}
    engines: {musl: '>=1.2.2', npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [arm64]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@img/sharp-libvips-linuxmusl-x64@1.0.2:
    resolution: {integrity: sha512-VI94Q6khIHqHWNOh6LLdm9s2Ry4zdjWJwH56WoiJU7NTeDwyApdZZ8c+SADC8OH98KWNQXnE01UdJ9CSfZvwZw==}
    engines: {musl: '>=1.2.2', npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [x64]
    os: [linux]
    requiresBuild: true
    dev: false
    optional: true

  /@img/sharp-linux-arm64@0.33.3:
    resolution: {integrity: sha512-Zf+sF1jHZJKA6Gor9hoYG2ljr4wo9cY4twaxgFDvlG0Xz9V7sinsPp8pFd1XtlhTzYo0IhDbl3rK7P6MzHpnYA==}
    engines: {glibc: '>=2.26', node: ^18.17.0 || ^20.3.0 || >=21.0.0, npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [arm64]
    os: [linux]
    requiresBuild: true
    optionalDependencies:
      '@img/sharp-libvips-linux-arm64': 1.0.2
    dev: false
    optional: true

  /@img/sharp-linux-arm@0.33.3:
    resolution: {integrity: sha512-Q7Ee3fFSC9P7vUSqVEF0zccJsZ8GiiCJYGWDdhEjdlOeS9/jdkyJ6sUSPj+bL8VuOYFSbofrW0t/86ceVhx32w==}
    engines: {glibc: '>=2.28', node: ^18.17.0 || ^20.3.0 || >=21.0.0, npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [arm]
    os: [linux]
    requiresBuild: true
    optionalDependencies:
      '@img/sharp-libvips-linux-arm': 1.0.2
    dev: false
    optional: true

  /@img/sharp-linux-s390x@0.33.3:
    resolution: {integrity: sha512-vFk441DKRFepjhTEH20oBlFrHcLjPfI8B0pMIxGm3+yilKyYeHEVvrZhYFdqIseSclIqbQ3SnZMwEMWonY5XFA==}
    engines: {glibc: '>=2.28', node: ^18.17.0 || ^20.3.0 || >=21.0.0, npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [s390x]
    os: [linux]
    requiresBuild: true
    optionalDependencies:
      '@img/sharp-libvips-linux-s390x': 1.0.2
    dev: false
    optional: true

  /@img/sharp-linux-x64@0.33.3:
    resolution: {integrity: sha512-Q4I++herIJxJi+qmbySd072oDPRkCg/SClLEIDh5IL9h1zjhqjv82H0Seupd+q2m0yOfD+/fJnjSoDFtKiHu2g==}
    engines: {glibc: '>=2.26', node: ^18.17.0 || ^20.3.0 || >=21.0.0, npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [x64]
    os: [linux]
    requiresBuild: true
    optionalDependencies:
      '@img/sharp-libvips-linux-x64': 1.0.2
    dev: false
    optional: true

  /@img/sharp-linuxmusl-arm64@0.33.3:
    resolution: {integrity: sha512-qnDccehRDXadhM9PM5hLvcPRYqyFCBN31kq+ErBSZtZlsAc1U4Z85xf/RXv1qolkdu+ibw64fUDaRdktxTNP9A==}
    engines: {musl: '>=1.2.2', node: ^18.17.0 || ^20.3.0 || >=21.0.0, npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [arm64]
    os: [linux]
    requiresBuild: true
    optionalDependencies:
      '@img/sharp-libvips-linuxmusl-arm64': 1.0.2
    dev: false
    optional: true

  /@img/sharp-linuxmusl-x64@0.33.3:
    resolution: {integrity: sha512-Jhchim8kHWIU/GZ+9poHMWRcefeaxFIs9EBqf9KtcC14Ojk6qua7ghKiPs0sbeLbLj/2IGBtDcxHyjCdYWkk2w==}
    engines: {musl: '>=1.2.2', node: ^18.17.0 || ^20.3.0 || >=21.0.0, npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [x64]
    os: [linux]
    requiresBuild: true
    optionalDependencies:
      '@img/sharp-libvips-linuxmusl-x64': 1.0.2
    dev: false
    optional: true

  /@img/sharp-wasm32@0.33.3:
    resolution: {integrity: sha512-68zivsdJ0koE96stdUfM+gmyaK/NcoSZK5dV5CAjES0FUXS9lchYt8LAB5rTbM7nlWtxaU/2GON0HVN6/ZYJAQ==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0, npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [wasm32]
    requiresBuild: true
    dependencies:
      '@emnapi/runtime': 1.1.1
    dev: false
    optional: true

  /@img/sharp-win32-ia32@0.33.3:
    resolution: {integrity: sha512-CyimAduT2whQD8ER4Ux7exKrtfoaUiVr7HG0zZvO0XTFn2idUWljjxv58GxNTkFb8/J9Ub9AqITGkJD6ZginxQ==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0, npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [ia32]
    os: [win32]
    requiresBuild: true
    dev: false
    optional: true

  /@img/sharp-win32-x64@0.33.3:
    resolution: {integrity: sha512-viT4fUIDKnli3IfOephGnolMzhz5VaTvDRkYqtZxOMIoMQ4MrAziO7pT1nVnOt2FAm7qW5aa+CCc13aEY6Le0g==}
    engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0, npm: '>=9.6.5', pnpm: '>=7.1.0', yarn: '>=3.2.0'}
    cpu: [x64]
    os: [win32]
    requiresBuild: true
    dev: false
    optional: true

  /@isaacs/cliui@8.0.2:
    resolution: {integrity: sha512-O8jcjabXaleOG9DQ0+ARXWZBTfnP4WNAqzuiJK7ll44AmxGKv/J2M4TPjxjY3znBCfvBXFzucm1twdyFybFqEA==}
    engines: {node: '>=12'}
    dependencies:
      string-width: 5.1.2
      string-width-cjs: /string-width@4.2.3
      strip-ansi: 7.1.0
      strip-ansi-cjs: /strip-ansi@6.0.1
      wrap-ansi: 8.1.0
      wrap-ansi-cjs: /wrap-ansi@7.0.0
    dev: true

  /@istanbuljs/schema@0.1.3:
    resolution: {integrity: sha512-ZXRY4jNvVgSVQ8DL3LTcakaAtXwTVUxE81hslsyD2AtoXW/wVob10HkOJ1X/pAlcI7D+2YoZKg5do8G/w6RYgA==}
    engines: {node: '>=8'}
    dev: true

  /@jest/schemas@29.6.3:
    resolution: {integrity: sha512-mo5j5X+jIZmJQveBKeS/clAueipV7KgiX1vMgCxam1RNYiqE1w62n0/tJJnHtjW8ZHcQco5gY85jA3mi0L+nSA==}
    engines: {node: ^14.15.0 || ^16.10.0 || >=18.0.0}
    dependencies:
      '@sinclair/typebox': 0.27.8
    dev: true

  /@jridgewell/gen-mapping@0.3.5:
    resolution: {integrity: sha512-IzL8ZoEDIBRWEzlCcRhOaCupYyN5gdIK+Q6fbFdPDg6HqX6jpkItn7DFIpW9LQzXG6Df9sA7+OKnq0qlz/GaQg==}
    engines: {node: '>=6.0.0'}
    dependencies:
      '@jridgewell/set-array': 1.2.1
      '@jridgewell/sourcemap-codec': 1.4.15
      '@jridgewell/trace-mapping': 0.3.25

  /@jridgewell/resolve-uri@3.1.2:
    resolution: {integrity: sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==}
    engines: {node: '>=6.0.0'}

  /@jridgewell/set-array@1.2.1:
    resolution: {integrity: sha512-R8gLRTZeyp03ymzP/6Lil/28tGeGEzhx1q2k703KGWRAI1VdvPIXdG70VJc2pAMw3NA6JKL5hhFu1sJX0Mnn/A==}
    engines: {node: '>=6.0.0'}

  /@jridgewell/source-map@0.3.6:
    resolution: {integrity: sha512-1ZJTZebgqllO79ue2bm3rIGud/bOe0pP5BjSRCRxxYkEZS8STV7zN84UBbiYu7jy+eCKSnVIUgoWWE/tt+shMQ==}
    dependencies:
      '@jridgewell/gen-mapping': 0.3.5
      '@jridgewell/trace-mapping': 0.3.25
    dev: true

  /@jridgewell/sourcemap-codec@1.4.15:
    resolution: {integrity: sha512-eF2rxCRulEKXHTRiDrDy6erMYWqNw4LPdQ8UQA4huuxaQsVeRPFl2oM8oDGxMFhJUWZf9McpLtJasDDZb/Bpeg==}

  /@jridgewell/trace-mapping@0.3.25:
    resolution: {integrity: sha512-vNk6aEwybGtawWmy/PzwnGDOjCkLWSD2wqvjGGAgOAwCGWySYXfYoxt00IJkTF+8Lb57DwOb3Aa0o9CApepiYQ==}
    dependencies:
      '@jridgewell/resolve-uri': 3.1.2
      '@jridgewell/sourcemap-codec': 1.4.15

  /@jridgewell/trace-mapping@0.3.9:
    resolution: {integrity: sha512-3Belt6tdc8bPgAtbcmdtNJlirVoTmEb5e2gC94PnkwEW9jI6CAHUeoG85tjWP5WquqfavoMtMwiG4P926ZKKuQ==}
    dependencies:
      '@jridgewell/resolve-uri': 3.1.2
      '@jridgewell/sourcemap-codec': 1.4.15
    dev: false

  /@manypkg/find-root@1.1.0:
    resolution: {integrity: sha512-mki5uBvhHzO8kYYix/WRy2WX8S3B5wdVSc9D6KcU5lQNglP2yt58/VfLuAK49glRXChosY8ap2oJ1qgma3GUVA==}
    dependencies:
      '@babel/runtime': 7.24.4
      '@types/node': 12.20.55
      find-up: 4.1.0
      fs-extra: 8.1.0
    dev: true

  /@manypkg/get-packages@1.1.3:
    resolution: {integrity: sha512-fo+QhuU3qE/2TQMQmbVMqaQ6EWbMhi4ABWP+O4AM1NqPBuy0OrApV5LO6BrrgnhtAHS2NH6RrVk9OL181tTi8A==}
    dependencies:
      '@babel/runtime': 7.24.4
      '@changesets/types': 4.1.0
      '@manypkg/find-root': 1.1.0
      fs-extra: 8.1.0
      globby: 11.1.0
      read-yaml-file: 1.1.0
    dev: true

  /@mapbox/node-pre-gyp@1.0.11:
    resolution: {integrity: sha512-Yhlar6v9WQgUp/He7BdgzOz8lqMQ8sU+jkCq7Wx8Myc5YFJLbEe7lgui/V7G1qB1DJykHSGwreceSaD60Y0PUQ==}
    hasBin: true
    dependencies:
      detect-libc: 2.0.3
      https-proxy-agent: 5.0.1
      make-dir: 3.1.0
      node-fetch: 2.7.0
      nopt: 5.0.0
      npmlog: 5.0.1
      rimraf: 3.0.2
      semver: 7.6.0
      tar: 6.2.1
    transitivePeerDependencies:
      - encoding
      - supports-color
    dev: false

  /@neoconfetti/svelte@1.0.0:
    resolution: {integrity: sha512-SmksyaJAdSlMa9cTidVSIqYo1qti+WTsviNDwgjNVm+KQ3DRP2Df9umDIzC4vCcpEYY+chQe0i2IKnLw03AT8Q==}
    dev: true

  /@netlify/functions@2.6.0:
    resolution: {integrity: sha512-vU20tij0fb4nRGACqb+5SQvKd50JYyTyEhQetCMHdakcJFzjLDivvRR16u1G2Oy4A7xNAtGJF1uz8reeOtTVcQ==}
    engines: {node: '>=14.0.0'}
    dependencies:
      '@netlify/serverless-functions-api': 1.14.0
    dev: true

  /@netlify/node-cookies@0.1.0:
    resolution: {integrity: sha512-OAs1xG+FfLX0LoRASpqzVntVV/RpYkgpI0VrUnw2u0Q1qiZUzcPffxRK8HF3gc4GjuhG5ahOEMJ9bswBiZPq0g==}
    engines: {node: ^14.16.0 || >=16.0.0}
    dev: true

  /@netlify/serverless-functions-api@1.14.0:
    resolution: {integrity: sha512-HUNETLNvNiC2J+SB/YuRwJA9+agPrc0azSoWVk8H85GC+YE114hcS5JW+dstpKwVerp2xILE3vNWN7IMXP5Q5Q==}
    engines: {node: ^14.18.0 || >=16.0.0}
    dependencies:
      '@netlify/node-cookies': 0.1.0
      urlpattern-polyfill: 8.0.2
    dev: true

  /@nodelib/fs.scandir@2.1.5:
    resolution: {integrity: sha512-vq24Bq3ym5HEQm2NKCr3yXDwjc7vTsEThRDnkp2DK9p1uqLR+DHurm/NOTo0KG7HYHU7eppKZj3MyqYuMBf62g==}
    engines: {node: '>= 8'}
    dependencies:
      '@nodelib/fs.stat': 2.0.5
      run-parallel: 1.2.0

  /@nodelib/fs.stat@2.0.5:
    resolution: {integrity: sha512-RkhPPp2zrqDAQA/2jNhnztcPAlv64XdhIp7a7454A5ovI7Bukxgt7MX7udwAu3zg1DcpPU0rz3VV1SeaqvY4+A==}
    engines: {node: '>= 8'}

  /@nodelib/fs.walk@1.2.8:
    resolution: {integrity: sha512-oGB+UxlgWcgQkgwo8GcEGwemoTFt3FIO9ababBmaGwXIoBKZ+GTy0pP185beGg7Llih/NSHSV2XAs1lnznocSg==}
    engines: {node: '>= 8'}
    dependencies:
      '@nodelib/fs.scandir': 2.1.5
      fastq: 1.17.1

  /@pkgjs/parseargs@0.11.0:
    resolution: {integrity: sha512-+1VkjdD0QBLPodGrJUeqarH8VAIvQODIbwh9XpP5Syisf7YoQgsJKPNFoqqLQlu+VQ/tVSshMR6loPMn8U+dPg==}
    engines: {node: '>=14'}
    requiresBuild: true
    dev: true
    optional: true

  /@playwright/test@1.43.1:
    resolution: {integrity: sha512-HgtQzFgNEEo4TE22K/X7sYTYNqEMMTZmFS8kTq6m8hXj+m1D8TgwgIbumHddJa9h4yl4GkKb8/bgAl2+g7eDgA==}
    engines: {node: '>=16'}
    hasBin: true
    dependencies:
      playwright: 1.43.1
    dev: true

  /@polka/url@1.0.0-next.25:
    resolution: {integrity: sha512-j7P6Rgr3mmtdkeDGTe0E/aYyWEWVtc5yFXtHCRHs28/jptDEWfaVOc5T7cblqy1XKPPfCxJc/8DwQ5YgLOZOVQ==}

  /@rollup/plugin-commonjs@25.0.7(rollup@4.14.2):
    resolution: {integrity: sha512-nEvcR+LRjEjsaSsc4x3XZfCCvZIaSMenZu/OiwOKGN2UhQpAYI7ru7czFvyWbErlpoGjnSX3D5Ch5FcMA3kRWQ==}
    engines: {node: '>=14.0.0'}
    peerDependencies:
      rollup: ^2.68.0||^3.0.0||^4.0.0
    peerDependenciesMeta:
      rollup:
        optional: true
    dependencies:
      '@rollup/pluginutils': 5.1.0(rollup@4.14.2)
      commondir: 1.0.1
      estree-walker: 2.0.2
      glob: 8.1.0
      is-reference: 1.2.1
      magic-string: 0.30.9
      rollup: 4.14.2

  /@rollup/plugin-json@6.1.0(rollup@4.14.2):
    resolution: {integrity: sha512-EGI2te5ENk1coGeADSIwZ7G2Q8CJS2sF120T7jLw4xFw9n7wIOXHo+kIYRAoVpJAN+kmqZSoO3Fp4JtoNF4ReA==}
    engines: {node: '>=14.0.0'}
    peerDependencies:
      rollup: ^1.20.0||^2.0.0||^3.0.0||^4.0.0
    peerDependenciesMeta:
      rollup:
        optional: true
    dependencies:
      '@rollup/pluginutils': 5.1.0(rollup@4.14.2)
      rollup: 4.14.2

  /@rollup/plugin-node-resolve@15.2.3(rollup@4.14.2):
    resolution: {integrity: sha512-j/lym8nf5E21LwBT4Df1VD6hRO2L2iwUeUmP7litikRsVp1H6NWx20NEp0Y7su+7XGc476GnXXc4kFeZNGmaSQ==}
    engines: {node: '>=14.0.0'}
    peerDependencies:
      rollup: ^2.78.0||^3.0.0||^4.0.0
    peerDependenciesMeta:
      rollup:
        optional: true
    dependencies:
      '@rollup/pluginutils': 5.1.0(rollup@4.14.2)
      '@types/resolve': 1.20.2
      deepmerge: 4.3.1
      is-builtin-module: 3.2.1
      is-module: 1.0.0
      resolve: 1.22.8
      rollup: 4.14.2

  /@rollup/pluginutils@4.2.1:
    resolution: {integrity: sha512-iKnFXr7NkdZAIHiIWE+BX5ULi/ucVFYWD6TbAV+rZctiRTY2PL6tsIKhoIOaoskiWAkgu+VsbXgUVDNLHf+InQ==}
    engines: {node: '>= 8.0.0'}
    dependencies:
      estree-walker: 2.0.2
      picomatch: 2.3.1
    dev: false

  /@rollup/pluginutils@5.1.0(rollup@4.14.2):
    resolution: {integrity: sha512-XTIWOPPcpvyKI6L1NHo0lFlCyznUEyPmPY1mc3KpPVDYulHSTvyeLNVW00QTLIAFNhR3kYnJTQHeGqU4M3n09g==}
    engines: {node: '>=14.0.0'}
    peerDependencies:
      rollup: ^1.20.0||^2.0.0||^3.0.0||^4.0.0
    peerDependenciesMeta:
      rollup:
        optional: true
    dependencies:
      '@types/estree': 1.0.5
      estree-walker: 2.0.2
      picomatch: 2.3.1
      rollup: 4.14.2

  /@rollup/rollup-android-arm-eabi@4.14.2:
    resolution: {integrity: sha512-ahxSgCkAEk+P/AVO0vYr7DxOD3CwAQrT0Go9BJyGQ9Ef0QxVOfjDZMiF4Y2s3mLyPrjonchIMH/tbWHucJMykQ==}
    cpu: [arm]
    os: [android]
    requiresBuild: true
    optional: true

  /@rollup/rollup-android-arm64@4.14.2:
    resolution: {integrity: sha512-lAarIdxZWbFSHFSDao9+I/F5jDaKyCqAPMq5HqnfpBw8dKDiCaaqM0lq5h1pQTLeIqueeay4PieGR5jGZMWprw==}
    cpu: [arm64]
    os: [android]
    requiresBuild: true
    optional: true

  /@rollup/rollup-darwin-arm64@4.14.2:
    resolution: {integrity: sha512-SWsr8zEUk82KSqquIMgZEg2GE5mCSfr9sE/thDROkX6pb3QQWPp8Vw8zOq2GyxZ2t0XoSIUlvHDkrf5Gmf7x3Q==}
    cpu: [arm64]
    os: [darwin]
    requiresBuild: true
    optional: true

  /@rollup/rollup-darwin-x64@4.14.2:
    resolution: {integrity: sha512-o/HAIrQq0jIxJAhgtIvV5FWviYK4WB0WwV91SLUnsliw1lSAoLsmgEEgRWzDguAFeUEUUoIWXiJrPqU7vGiVkA==}
    cpu: [x64]
    os: [darwin]
    requiresBuild: true
    optional: true

  /@rollup/rollup-linux-arm-gnueabihf@4.14.2:
    resolution: {integrity: sha512-nwlJ65UY9eGq91cBi6VyDfArUJSKOYt5dJQBq8xyLhvS23qO+4Nr/RreibFHjP6t+5ap2ohZrUJcHv5zk5ju/g==}
    cpu: [arm]
    os: [linux]
    requiresBuild: true
    optional: true

  /@rollup/rollup-linux-arm64-gnu@4.14.2:
    resolution: {integrity: sha512-Pg5TxxO2IVlMj79+c/9G0LREC9SY3HM+pfAwX7zj5/cAuwrbfj2Wv9JbMHIdPCfQpYsI4g9mE+2Bw/3aeSs2rQ==}
    cpu: [arm64]
    os: [linux]
    requiresBuild: true
    optional: true

  /@rollup/rollup-linux-arm64-musl@4.14.2:
    resolution: {integrity: sha512-cAOTjGNm84gc6tS02D1EXtG7tDRsVSDTBVXOLbj31DkwfZwgTPYZ6aafSU7rD/4R2a34JOwlF9fQayuTSkoclA==}
    cpu: [arm64]
    os: [linux]
    requiresBuild: true
    optional: true

  /@rollup/rollup-linux-powerpc64le-gnu@4.14.2:
    resolution: {integrity: sha512-4RyT6v1kXb7C0fn6zV33rvaX05P0zHoNzaXI/5oFHklfKm602j+N4mn2YvoezQViRLPnxP8M1NaY4s/5kXO5cw==}
    cpu: [ppc64]
    os: [linux]
    requiresBuild: true
    optional: true

  /@rollup/rollup-linux-riscv64-gnu@4.14.2:
    resolution: {integrity: sha512-KNUH6jC/vRGAKSorySTyc/yRYlCwN/5pnMjXylfBniwtJx5O7X17KG/0efj8XM3TZU7raYRXJFFReOzNmL1n1w==}
    cpu: [riscv64]
    os: [linux]
    requiresBuild: true
    optional: true

  /@rollup/rollup-linux-s390x-gnu@4.14.2:
    resolution: {integrity: sha512-xPV4y73IBEXToNPa3h5lbgXOi/v0NcvKxU0xejiFw6DtIYQqOTMhZ2DN18/HrrP0PmiL3rGtRG9gz1QE8vFKXQ==}
    cpu: [s390x]
    os: [linux]
    requiresBuild: true
    optional: true

  /@rollup/rollup-linux-x64-gnu@4.14.2:
    resolution: {integrity: sha512-QBhtr07iFGmF9egrPOWyO5wciwgtzKkYPNLVCFZTmr4TWmY0oY2Dm/bmhHjKRwZoGiaKdNcKhFtUMBKvlchH+Q==}
    cpu: [x64]
    os: [linux]
    requiresBuild: true
    optional: true

  /@rollup/rollup-linux-x64-musl@4.14.2:
    resolution: {integrity: sha512-8zfsQRQGH23O6qazZSFY5jP5gt4cFvRuKTpuBsC1ZnSWxV8ZKQpPqOZIUtdfMOugCcBvFGRa1pDC/tkf19EgBw==}
    cpu: [x64]
    os: [linux]
    requiresBuild: true
    optional: true

  /@rollup/rollup-win32-arm64-msvc@4.14.2:
    resolution: {integrity: sha512-H4s8UjgkPnlChl6JF5empNvFHp77Jx+Wfy2EtmYPe9G22XV+PMuCinZVHurNe8ggtwoaohxARJZbaH/3xjB/FA==}
    cpu: [arm64]
    os: [win32]
    requiresBuild: true
    optional: true

  /@rollup/rollup-win32-ia32-msvc@4.14.2:
    resolution: {integrity: sha512-djqpAjm/i8erWYF0K6UY4kRO3X5+T4TypIqw60Q8MTqSBaQNpNXDhxdjpZ3ikgb+wn99svA7jxcXpiyg9MUsdw==}
    cpu: [ia32]
    os: [win32]
    requiresBuild: true
    optional: true

  /@rollup/rollup-win32-x64-msvc@4.14.2:
    resolution: {integrity: sha512-teAqzLT0yTYZa8ZP7zhFKEx4cotS8Tkk5XiqNMJhD4CpaWB1BHARE4Qy+RzwnXvSAYv+Q3jAqCVBS+PS+Yee8Q==}
    cpu: [x64]
    os: [win32]
    requiresBuild: true
    optional: true

  /@sinclair/typebox@0.27.8:
    resolution: {integrity: sha512-+Fj43pSMwJs4KRrH/938Uf+uAELIgVBmQzg/q1YG10djyfA3TnrU8N8XzqCh/okZdszqBQTZf96idMfE5lnwTA==}
    dev: true

  /@sveltejs/eslint-config@6.0.4(@typescript-eslint/eslint-plugin@7.6.0)(@typescript-eslint/parser@7.6.0)(eslint-config-prettier@9.1.0)(eslint-plugin-svelte@2.37.0)(eslint-plugin-unicorn@52.0.0)(eslint@8.57.0)(typescript@5.4.5):
    resolution: {integrity: sha512-U9pwmDs+DbmsnCgTfu6Bacdwqn0DuI1IQNSiQqTgzVyYfaaj+zy9ZoQCiJfxFBGXHkklyXuRHp0KMx346N0lcQ==}
    peerDependencies:
      '@typescript-eslint/eslint-plugin': '>= 5'
      '@typescript-eslint/parser': '>= 5'
      eslint: '>= 8'
      eslint-config-prettier: '>= 8'
      eslint-plugin-svelte: '>= 2'
      eslint-plugin-unicorn: '>= 47'
      typescript: '>= 4'
    dependencies:
      '@typescript-eslint/eslint-plugin': 7.6.0(@typescript-eslint/parser@7.6.0)(eslint@8.57.0)(typescript@5.4.5)
      '@typescript-eslint/parser': 7.6.0(eslint@8.57.0)(typescript@5.4.5)
      eslint: 8.57.0
      eslint-config-prettier: 9.1.0(eslint@8.57.0)
      eslint-plugin-svelte: 2.37.0(eslint@8.57.0)
      eslint-plugin-unicorn: 52.0.0(eslint@8.57.0)
      typescript: 5.4.5
    dev: true

  /@sveltejs/site-kit@6.0.0-next.59(@sveltejs/kit@packages+kit)(svelte@4.2.14):
    resolution: {integrity: sha512-nAUCuunhN0DmurQBxbsauqvdvv4mL0F/Aluxq0hFf6gB3iSn9WdaUZdPMXoujy+8cy+m6UvKuyhkgApZhmOLvw==}
    peerDependencies:
      '@sveltejs/kit': ^1.20.0
      svelte: ^4.0.0
    dependencies:
      '@sveltejs/kit': link:packages/kit
      esm-env: 1.0.0
      svelte: 4.2.14
      svelte-local-storage-store: 0.6.4(svelte@4.2.14)
    dev: true

  /@sveltejs/vite-plugin-svelte-inspector@2.1.0(@sveltejs/vite-plugin-svelte@3.1.0)(svelte@4.2.14)(vite@5.2.8):
    resolution: {integrity: sha512-9QX28IymvBlSCqsCll5t0kQVxipsfhFFL+L2t3nTWfXnddYwxBuAEtTtlaVQpRz9c37BhJjltSeY4AJSC03SSg==}
    engines: {node: ^18.0.0 || >=20}
    peerDependencies:
      '@sveltejs/vite-plugin-svelte': ^3.0.0
      svelte: ^4.0.0 || ^5.0.0-next.0
      vite: ^5.0.0
    dependencies:
      '@sveltejs/vite-plugin-svelte': 3.1.0(svelte@4.2.14)(vite@5.2.8)
      debug: 4.3.4
      svelte: 4.2.14
      vite: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)
    transitivePeerDependencies:
      - supports-color
    dev: true

  /@sveltejs/vite-plugin-svelte@3.1.0(svelte@4.2.14)(vite@5.2.8):
    resolution: {integrity: sha512-sY6ncCvg+O3njnzbZexcVtUqOBE3iYmQPJ9y+yXSkOwG576QI/xJrBnQSRXFLGwJNBa0T78JEKg5cIR0WOAuUw==}
    engines: {node: ^18.0.0 || >=20}
    peerDependencies:
      svelte: ^4.0.0 || ^5.0.0-next.0
      vite: ^5.0.0
    dependencies:
      '@sveltejs/vite-plugin-svelte-inspector': 2.1.0(@sveltejs/vite-plugin-svelte@3.1.0)(svelte@4.2.14)(vite@5.2.8)
      debug: 4.3.4
      deepmerge: 4.3.1
      kleur: 4.1.5
      magic-string: 0.30.9
      svelte: 4.2.14
      svelte-hmr: 0.16.0(svelte@4.2.14)
      vite: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)
      vitefu: 0.2.5(vite@5.2.8)
    transitivePeerDependencies:
      - supports-color
    dev: true

  /@svitejs/changesets-changelog-github-compact@1.1.0:
    resolution: {integrity: sha512-qhUGGDHcpbY2zpjW3SwqchuW8J/5EzlPFud7xNntHKA7f3a/mx5+g+ruJKFHSAiVZYo30PALt+AyhmPUNKH/Og==}
    engines: {node: ^14.13.1 || ^16.0.0 || >=18}
    dependencies:
      '@changesets/get-github-info': 0.5.2
      dotenv: 16.4.5
    transitivePeerDependencies:
      - encoding
    dev: true

  /@ts-morph/common@0.23.0:
    resolution: {integrity: sha512-m7Lllj9n/S6sOkCkRftpM7L24uvmfXQFedlW/4hENcuJH1HHm9u5EgxZb9uVjQSCGrbBWBkOGgcTxNg36r6ywA==}
    dependencies:
      fast-glob: 3.3.2
      minimatch: 9.0.4
      mkdirp: 3.0.1
      path-browserify: 1.0.1
    dev: false

  /@types/connect@3.4.38:
    resolution: {integrity: sha512-K6uROf1LD88uDQqJCktA4yzL1YYAK6NgfsI0v/mTgyPKWsX1CnJ0XPSDhViejru1GcRkLWb8RlzFYJRqGUbaug==}
    dependencies:
      '@types/node': 18.19.31
    dev: true

  /@types/cookie@0.6.0:
    resolution: {integrity: sha512-4Kh9a6B2bQciAhf7FSuMRRkUWecJgJu9nPnx3yzpsfXX/c50REIqpHY4C82bXP90qrLtXtkDxTZosYO3UpOwlA==}
    dev: false

  /@types/d3-geo@3.1.0:
    resolution: {integrity: sha512-856sckF0oP/diXtS4jNsiQw/UuK5fQG8l/a9VVLeSouf1/PPbBE1i1W852zVwKwYCBkFJJB7nCFTbk6UMEXBOQ==}
    dependencies:
      '@types/geojson': 7946.0.14
    dev: true

  /@types/estree@1.0.5:
    resolution: {integrity: sha512-/kYRxGDLWzHOB7q+wtSUQlFrtcdUccpfy+X+9iMBpHK8QLLhx2wIPYuS5DYtR9Wa/YlZAbIovy7qVdB1Aq6Lyw==}

  /@types/geojson@7946.0.14:
    resolution: {integrity: sha512-WCfD5Ht3ZesJUsONdhvm84dmzWOiOzOAqOncN0++w0lBw1o8OuDNJF2McvvCef/yBqb/HYRahp1BYtODFQ8bRg==}
    dev: true

  /@types/gitignore-parser@0.0.3:
    resolution: {integrity: sha512-sbdu1sG2pQcwjEYWTsX78OqJo5pKnonwC4FV3m2JeQRE2xYb3q0icHHopCHEvpn4uIBuvWBTpJUCJ76ISK24CA==}
    dev: true

  /@types/istanbul-lib-coverage@2.0.6:
    resolution: {integrity: sha512-2QF/t/auWm0lsy8XtKVPG19v3sSOQlJe/YHZgfjb/KBBHOGSV+J2q/S671rcq9uTBrLAXmZpqJiaQbMT+zNU1w==}
    dev: true

  /@types/json-schema@7.0.15:
    resolution: {integrity: sha512-5+fP8P8MFNC+AyZCDxrB2pkZFPGzqQWUzpSeuuVLvm8VMcorNYavBqoFcxK8bQz4Qsbn4oUEEem4wDLfcysGHA==}

  /@types/minimist@1.2.5:
    resolution: {integrity: sha512-hov8bUuiLiyFPGyFPE1lwWhmzYbirOXQNNo40+y3zow8aFVTeyn3VWL0VFFfdNddA8S4Vf0Tc062rzyNr7Paag==}
    dev: true

  /@types/node-forge@1.3.11:
    resolution: {integrity: sha512-FQx220y22OKNTqaByeBGqHWYz4cl94tpcxeFdvBo3wjG6XPBuZ0BNgNZRV5J5TFmmcsJ4IzsLkmGRiQbnYsBEQ==}
    dependencies:
      '@types/node': 18.19.31
    dev: false

  /@types/node@12.20.55:
    resolution: {integrity: sha512-J8xLz7q2OFulZ2cyGTLE1TbbZcjpno7FaN6zdJNrgAdrJ+DZzh/uFR6YrTb4C+nXakvud8Q4+rbhoIWlYQbUFQ==}
    dev: true

  /@types/node@18.19.31:
    resolution: {integrity: sha512-ArgCD39YpyyrtFKIqMDvjz79jto5fcI/SVUs2HwB+f0dAzq68yqOdyaSivLiLugSziTpNXLQrVb7RZFmdZzbhA==}
    dependencies:
      undici-types: 5.26.5

  /@types/normalize-package-data@2.4.4:
    resolution: {integrity: sha512-37i+OaWTh9qeK4LSHPsyRC7NahnGotNuZvjLSgcPzblpHB3rrCJxAOgI5gCdKm7coonsaX1Of0ILiTcnZjbfxA==}
    dev: true

  /@types/prompts@2.4.9:
    resolution: {integrity: sha512-qTxFi6Buiu8+50/+3DGIWLHM6QuWsEKugJnnP6iv2Mc4ncxE4A/OJkjuVOA+5X0X1S/nq5VJRa8Lu+nwcvbrKA==}
    dependencies:
      '@types/node': 18.19.31
      kleur: 3.0.3
    dev: true

  /@types/pug@2.0.10:
    resolution: {integrity: sha512-Sk/uYFOBAB7mb74XcpizmH0KOR2Pv3D2Hmrh1Dmy5BmK3MpdSa5kqZcg6EKBdklU0bFXX9gCfzvpnyUehrPIuA==}
    dev: true

  /@types/resolve@1.20.2:
    resolution: {integrity: sha512-60BCwRFOZCQhDncwQdxxeOEEkbc5dIMccYLwbxsS4TUNeVECQ/pBJ0j09mrHOl/JJvpRPGwO9SvE4nR2Nb/a4Q==}

  /@types/sade@1.8.0:
    resolution: {integrity: sha512-AaEFFSbi9xUFPVmsmlo0X8gXpdUJxoT6Ve36Qqorqb/wxagc5v4W44mCPeiw5HqWjwypJ1X1qNL7lmofqX5C7g==}
    deprecated: This is a stub types definition. sade provides its own type definitions, so you do not need this installed.
    dependencies:
      sade: 1.8.1
    dev: true

  /@types/semver@7.5.8:
    resolution: {integrity: sha512-I8EUhyrgfLrcTkzV3TSsGyl1tSuPrEDzr0yd5m90UgNxQkyDXULk3b6MlQqTCpZpNtWe1K0hzclnZkTcLBe2UQ==}
    dev: true

  /@types/set-cookie-parser@2.4.7:
    resolution: {integrity: sha512-+ge/loa0oTozxip6zmhRIk8Z/boU51wl9Q6QdLZcokIGMzY5lFXYy/x7Htj2HTC6/KZP1hUbZ1ekx8DYXICvWg==}
    dependencies:
      '@types/node': 18.19.31
    dev: true

  /@types/ws@8.5.10:
    resolution: {integrity: sha512-vmQSUcfalpIq0R9q7uTo2lXs6eGIpt9wtnLdMv9LVpIjCA/+ufZRozlVoVelIYixx1ugCBKDhn89vnsEGOCx9A==}
    dependencies:
      '@types/node': 18.19.31
    dev: true

  /@typescript-eslint/eslint-plugin@7.6.0(@typescript-eslint/parser@7.6.0)(eslint@8.57.0)(typescript@5.4.5):
    resolution: {integrity: sha512-gKmTNwZnblUdnTIJu3e9kmeRRzV2j1a/LUO27KNNAnIC5zjy1aSvXSRp4rVNlmAoHlQ7HzX42NbKpcSr4jF80A==}
    engines: {node: ^18.18.0 || >=20.0.0}
    peerDependencies:
      '@typescript-eslint/parser': ^7.0.0
      eslint: ^8.56.0
      typescript: '*'
    peerDependenciesMeta:
      typescript:
        optional: true
    dependencies:
      '@eslint-community/regexpp': 4.10.0
      '@typescript-eslint/parser': 7.6.0(eslint@8.57.0)(typescript@5.4.5)
      '@typescript-eslint/scope-manager': 7.6.0
      '@typescript-eslint/type-utils': 7.6.0(eslint@8.57.0)(typescript@5.4.5)
      '@typescript-eslint/utils': 7.6.0(eslint@8.57.0)(typescript@5.4.5)
      '@typescript-eslint/visitor-keys': 7.6.0
      debug: 4.3.4
      eslint: 8.57.0
      graphemer: 1.4.0
      ignore: 5.3.1
      natural-compare: 1.4.0
      semver: 7.6.0
      ts-api-utils: 1.3.0(typescript@5.4.5)
      typescript: 5.4.5
    transitivePeerDependencies:
      - supports-color
    dev: true

  /@typescript-eslint/parser@7.6.0(eslint@8.57.0)(typescript@5.4.5):
    resolution: {integrity: sha512-usPMPHcwX3ZoPWnBnhhorc14NJw9J4HpSXQX4urF2TPKG0au0XhJoZyX62fmvdHONUkmyUe74Hzm1//XA+BoYg==}
    engines: {node: ^18.18.0 || >=20.0.0}
    peerDependencies:
      eslint: ^8.56.0
      typescript: '*'
    peerDependenciesMeta:
      typescript:
        optional: true
    dependencies:
      '@typescript-eslint/scope-manager': 7.6.0
      '@typescript-eslint/types': 7.6.0
      '@typescript-eslint/typescript-estree': 7.6.0(typescript@5.4.5)
      '@typescript-eslint/visitor-keys': 7.6.0
      debug: 4.3.4
      eslint: 8.57.0
      typescript: 5.4.5
    transitivePeerDependencies:
      - supports-color
    dev: true

  /@typescript-eslint/scope-manager@7.6.0:
    resolution: {integrity: sha512-ngttyfExA5PsHSx0rdFgnADMYQi+Zkeiv4/ZxGYUWd0nLs63Ha0ksmp8VMxAIC0wtCFxMos7Lt3PszJssG/E6w==}
    engines: {node: ^18.18.0 || >=20.0.0}
    dependencies:
      '@typescript-eslint/types': 7.6.0
      '@typescript-eslint/visitor-keys': 7.6.0
    dev: true

  /@typescript-eslint/type-utils@7.6.0(eslint@8.57.0)(typescript@5.4.5):
    resolution: {integrity: sha512-NxAfqAPNLG6LTmy7uZgpK8KcuiS2NZD/HlThPXQRGwz6u7MDBWRVliEEl1Gj6U7++kVJTpehkhZzCJLMK66Scw==}
    engines: {node: ^18.18.0 || >=20.0.0}
    peerDependencies:
      eslint: ^8.56.0
      typescript: '*'
    peerDependenciesMeta:
      typescript:
        optional: true
    dependencies:
      '@typescript-eslint/typescript-estree': 7.6.0(typescript@5.4.5)
      '@typescript-eslint/utils': 7.6.0(eslint@8.57.0)(typescript@5.4.5)
      debug: 4.3.4
      eslint: 8.57.0
      ts-api-utils: 1.3.0(typescript@5.4.5)
      typescript: 5.4.5
    transitivePeerDependencies:
      - supports-color
    dev: true

  /@typescript-eslint/types@7.6.0:
    resolution: {integrity: sha512-h02rYQn8J+MureCvHVVzhl69/GAfQGPQZmOMjG1KfCl7o3HtMSlPaPUAPu6lLctXI5ySRGIYk94clD/AUMCUgQ==}
    engines: {node: ^18.18.0 || >=20.0.0}
    dev: true

  /@typescript-eslint/typescript-estree@7.6.0(typescript@5.4.5):
    resolution: {integrity: sha512-+7Y/GP9VuYibecrCQWSKgl3GvUM5cILRttpWtnAu8GNL9j11e4tbuGZmZjJ8ejnKYyBRb2ddGQ3rEFCq3QjMJw==}
    engines: {node: ^18.18.0 || >=20.0.0}
    peerDependencies:
      typescript: '*'
    peerDependenciesMeta:
      typescript:
        optional: true
    dependencies:
      '@typescript-eslint/types': 7.6.0
      '@typescript-eslint/visitor-keys': 7.6.0
      debug: 4.3.4
      globby: 11.1.0
      is-glob: 4.0.3
      minimatch: 9.0.4
      semver: 7.6.0
      ts-api-utils: 1.3.0(typescript@5.4.5)
      typescript: 5.4.5
    transitivePeerDependencies:
      - supports-color
    dev: true

  /@typescript-eslint/utils@7.6.0(eslint@8.57.0)(typescript@5.4.5):
    resolution: {integrity: sha512-x54gaSsRRI+Nwz59TXpCsr6harB98qjXYzsRxGqvA5Ue3kQH+FxS7FYU81g/omn22ML2pZJkisy6Q+ElK8pBCA==}
    engines: {node: ^18.18.0 || >=20.0.0}
    peerDependencies:
      eslint: ^8.56.0
    dependencies:
      '@eslint-community/eslint-utils': 4.4.0(eslint@8.57.0)
      '@types/json-schema': 7.0.15
      '@types/semver': 7.5.8
      '@typescript-eslint/scope-manager': 7.6.0
      '@typescript-eslint/types': 7.6.0
      '@typescript-eslint/typescript-estree': 7.6.0(typescript@5.4.5)
      eslint: 8.57.0
      semver: 7.6.0
    transitivePeerDependencies:
      - supports-color
      - typescript
    dev: true

  /@typescript-eslint/visitor-keys@7.6.0:
    resolution: {integrity: sha512-4eLB7t+LlNUmXzfOu1VAIAdkjbu5xNSerURS9X/S5TUKWFRpXRQZbmtPqgKmYx8bj3J0irtQXSiWAOY82v+cgw==}
    engines: {node: ^18.18.0 || >=20.0.0}
    dependencies:
      '@typescript-eslint/types': 7.6.0
      eslint-visitor-keys: 3.4.3
    dev: true

  /@typescript/twoslash@3.1.0:
    resolution: {integrity: sha512-kTwMUQ8xtAZaC4wb2XuLkPqFVBj2dNBueMQ89NWEuw87k2nLBbuafeG5cob/QEr6YduxIdTVUjix0MtC7mPlmg==}
    dependencies:
      '@typescript/vfs': 1.3.5
      debug: 4.3.4
      lz-string: 1.5.0
    transitivePeerDependencies:
      - supports-color
    dev: true

  /@typescript/vfs@1.3.4:
    resolution: {integrity: sha512-RbyJiaAGQPIcAGWFa3jAXSuAexU4BFiDRF1g3hy7LmRqfNpYlTQWGXjcrOaVZjJ8YkkpuwG0FcsYvtWQpd9igQ==}
    dependencies:
      debug: 4.3.4
    transitivePeerDependencies:
      - supports-color
    dev: true

  /@typescript/vfs@1.3.5:
    resolution: {integrity: sha512-pI8Saqjupf9MfLw7w2+og+fmb0fZS0J6vsKXXrp4/PDXEFvntgzXmChCXC/KefZZS0YGS6AT8e0hGAJcTsdJlg==}
    dependencies:
      debug: 4.3.4
    transitivePeerDependencies:
      - supports-color
    dev: true

  /@ungap/structured-clone@1.2.0:
    resolution: {integrity: sha512-zuVdFrMJiuCDQUMCzQaD6KL28MjnqqN8XnAqiEq9PNm/hCPTSGfrXCOfwj1ow4LFb/tNymJPwsNbVePc1xFqrQ==}
    dev: true

  /@vercel/nft@0.26.4:
    resolution: {integrity: sha512-j4jCOOXke2t8cHZCIxu1dzKLHLcFmYzC3yqAK6MfZznOL1QIJKd0xcFsXK3zcqzU7ScsE2zWkiMMNHGMHgp+FA==}
    engines: {node: '>=16'}
    hasBin: true
    dependencies:
      '@mapbox/node-pre-gyp': 1.0.11
      '@rollup/pluginutils': 4.2.1
      acorn: 8.11.3
      acorn-import-attributes: 1.9.5(acorn@8.11.3)
      async-sema: 3.1.1
      bindings: 1.5.0
      estree-walker: 2.0.2
      glob: 7.2.3
      graceful-fs: 4.2.11
      micromatch: 4.0.5
      node-gyp-build: 4.8.0
      resolve-from: 5.0.0
    transitivePeerDependencies:
      - encoding
      - supports-color
    dev: false

  /@vitest/expect@1.5.0:
    resolution: {integrity: sha512-0pzuCI6KYi2SIC3LQezmxujU9RK/vwC1U9R0rLuGlNGcOuDWxqWKu6nUdFsX9tH1WU0SXtAxToOsEjeUn1s3hA==}
    dependencies:
      '@vitest/spy': 1.5.0
      '@vitest/utils': 1.5.0
      chai: 4.4.1
    dev: true

  /@vitest/runner@1.5.0:
    resolution: {integrity: sha512-7HWwdxXP5yDoe7DTpbif9l6ZmDwCzcSIK38kTSIt6CFEpMjX4EpCgT6wUmS0xTXqMI6E/ONmfgRKmaujpabjZQ==}
    dependencies:
      '@vitest/utils': 1.5.0
      p-limit: 5.0.0
      pathe: 1.1.2
    dev: true

  /@vitest/snapshot@1.5.0:
    resolution: {integrity: sha512-qpv3fSEuNrhAO3FpH6YYRdaECnnRjg9VxbhdtPwPRnzSfHVXnNzzrpX4cJxqiwgRMo7uRMWDFBlsBq4Cr+rO3A==}
    dependencies:
      magic-string: 0.30.9
      pathe: 1.1.2
      pretty-format: 29.7.0
    dev: true

  /@vitest/spy@1.5.0:
    resolution: {integrity: sha512-vu6vi6ew5N5MMHJjD5PoakMRKYdmIrNJmyfkhRpQt5d9Ewhw9nZ5Aqynbi3N61bvk9UvZ5UysMT6ayIrZ8GA9w==}
    dependencies:
      tinyspy: 2.2.1
    dev: true

  /@vitest/utils@1.5.0:
    resolution: {integrity: sha512-BDU0GNL8MWkRkSRdNFvCUCAVOeHaUlVJ9Tx0TYBZyXaaOTmGtUFObzchCivIBrIwKzvZA7A9sCejVhXM2aY98A==}
    dependencies:
      diff-sequences: 29.6.3
      estree-walker: 3.0.3
      loupe: 2.3.7
      pretty-format: 29.7.0
    dev: true

  /abbrev@1.1.1:
    resolution: {integrity: sha512-nne9/IiQ/hzIhY6pdDnbBtz7DjPTKrY00P/zvPSm5pOFkl6xuGrGnXn/VtTNNfNtAfZ9/1RtehkszU9qcTii0Q==}
    dev: false

  /acorn-import-attributes@1.9.5(acorn@8.11.3):
    resolution: {integrity: sha512-n02Vykv5uA3eHGM/Z2dQrcD56kL8TyDb2p1+0P83PClMnC/nc+anbQRhIOWnSq4Ke/KvDPrY3C9hDtC/A3eHnQ==}
    peerDependencies:
      acorn: ^8
    dependencies:
      acorn: 8.11.3
    dev: false

  /acorn-jsx@5.3.2(acorn@8.11.3):
    resolution: {integrity: sha512-rq9s+JNhf0IChjtDXxllJ7g41oZk5SlXtp0LHwyA5cejwn7vKmKp4pPri6YEePv2PU65sAsegbXtIinmDFDXgQ==}
    peerDependencies:
      acorn: ^6.0.0 || ^7.0.0 || ^8.0.0
    dependencies:
      acorn: 8.11.3
    dev: true

  /acorn-walk@8.3.2:
    resolution: {integrity: sha512-cjkyv4OtNCIeqhHrfS81QWXoCBPExR/J62oyEqepVw8WaQeSqpW2uhuLPh1m9eWhDuOo/jUXVTlifvesOWp/4A==}
    engines: {node: '>=0.4.0'}

  /acorn@8.11.3:
    resolution: {integrity: sha512-Y9rRfJG5jcKOE0CLisYbojUjIrIEE7AGMzA/Sm4BslANhbS+cDMpgBdcPT91oJ7OuJ9hYJBx59RjbhxVnrF8Xg==}
    engines: {node: '>=0.4.0'}
    hasBin: true

  /agent-base@6.0.2:
    resolution: {integrity: sha512-RZNwNclF7+MS/8bDg70amg32dyeZGZxiDuQmZxKLAlQjr3jGyLx+4Kkk58UO7D2QdgFIQCovuSuZESne6RG6XQ==}
    engines: {node: '>= 6.0.0'}
    dependencies:
      debug: 4.3.4
    transitivePeerDependencies:
      - supports-color
    dev: false

  /ajv@6.12.6:
    resolution: {integrity: sha512-j3fVLgvTo527anyYyJOGTYJbG+vnnQYvE0m5mmkc1TK+nxAppkCLMIL0aZ4dblVCNoGShhm+kzE4ZUykBoMg4g==}
    dependencies:
      fast-deep-equal: 3.1.3
      fast-json-stable-stringify: 2.1.0
      json-schema-traverse: 0.4.1
      uri-js: 4.4.1
    dev: true

  /ansi-colors@4.1.3:
    resolution: {integrity: sha512-/6w/C21Pm1A7aZitlI5Ni/2J6FFQN8i1Cvz3kHABAAbw93v/NlvKdVOqz7CCWz/3iv/JplRSEEZ83XION15ovw==}
    engines: {node: '>=6'}
    dev: true

  /ansi-regex@5.0.1:
    resolution: {integrity: sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==}
    engines: {node: '>=8'}

  /ansi-regex@6.0.1:
    resolution: {integrity: sha512-n5M855fKb2SsfMIiFFoVrABHJC8QtHwVx+mHWP3QcEqBHYienj5dHSgjbxtC0WEZXYt4wcD6zrQElDPhFuZgfA==}
    engines: {node: '>=12'}
    dev: true

  /ansi-styles@3.2.1:
    resolution: {integrity: sha512-VT0ZI6kZRdTh8YyJw3SMbYm/u+NqfsAxEpWO0Pf9sq8/e94WxxOpPKx9FR1FlyCtOVDNOQ+8ntlqFxiRc+r5qA==}
    engines: {node: '>=4'}
    dependencies:
      color-convert: 1.9.3
    dev: true

  /ansi-styles@4.3.0:
    resolution: {integrity: sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==}
    engines: {node: '>=8'}
    dependencies:
      color-convert: 2.0.1
    dev: true

  /ansi-styles@5.2.0:
    resolution: {integrity: sha512-Cxwpt2SfTzTtXcfOlzGEee8O+c+MmUgGrNiBcXnuWxuFJHe6a5Hz7qwhwe5OgaSYI0IJvkLqWX1ASG+cJOkEiA==}
    engines: {node: '>=10'}
    dev: true

  /ansi-styles@6.2.1:
    resolution: {integrity: sha512-bN798gFfQX+viw3R7yrGWRqnrN2oRkEkUjjl4JNn4E8GxxbjtG3FbrEIIY3l8/hrwUwIeCZvi4QuOTP4MErVug==}
    engines: {node: '>=12'}
    dev: true

  /any-promise@1.3.0:
    resolution: {integrity: sha512-7UvmKalWRt1wgjL1RrGxoSJW/0QZFIegpeGvZG9kjp8vrRu55XTHbwnqq2GpXm9uLbcuhxm3IqX9OB4MZR1b2A==}
    dev: true

  /anymatch@3.1.3:
    resolution: {integrity: sha512-KMReFUr0B4t+D+OBkjR3KYqvocp2XaSzO55UcB6mgQMd3KbcE+mWTyvVV7D/zsdEbNnV6acZUutkiHQXvTr1Rw==}
    engines: {node: '>= 8'}
    dependencies:
      normalize-path: 3.0.0
      picomatch: 2.3.1

  /aproba@2.0.0:
    resolution: {integrity: sha512-lYe4Gx7QT+MKGbDsA+Z+he/Wtef0BiwDOlK/XkBrdfsh9J/jPPXbX0tE9x9cl27Tmu5gg3QUbUrQYa/y+KOHPQ==}
    dev: false

  /are-we-there-yet@2.0.0:
    resolution: {integrity: sha512-Ci/qENmwHnsYo9xKIcUJN5LeDKdJ6R1Z1j9V/J5wyq8nh/mYPEpIKJbBZXtZjG04HiK7zV/p6Vs9952MrMeUIw==}
    engines: {node: '>=10'}
    dependencies:
      delegates: 1.0.0
      readable-stream: 3.6.2
    dev: false

  /argparse@1.0.10:
    resolution: {integrity: sha512-o5Roy6tNG4SL/FOkCAN6RzjiakZS25RLYFrcMttJqbdd8BWrnA+fGz57iN5Pb06pvBGvl5gQ0B48dJlslXvoTg==}
    dependencies:
      sprintf-js: 1.0.3
    dev: true

  /argparse@2.0.1:
    resolution: {integrity: sha512-8+9WqebbFzpX9OR+Wa6O29asIogeRMzcGtAINdpMHHyAg10f05aSFVBbcEqGf/PXw1EjAZ+q2/bEBg3DvurK3Q==}
    dev: true

  /aria-query@5.3.0:
    resolution: {integrity: sha512-b0P0sZPKtyu8HkeRAfCq0IfURZK+SuwMjY1UXGBU27wpAiTwQAIlq56IbIO+ytk/JjS1fMR14ee5WBBfKi5J6A==}
    dependencies:
      dequal: 2.0.3

  /array-buffer-byte-length@1.0.1:
    resolution: {integrity: sha512-ahC5W1xgou+KTXix4sAO8Ki12Q+jf4i0+tmk3sC+zgcynshkHxzpXdImBehiUYKKKDwvfFiJl1tZt6ewscS1Mg==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      is-array-buffer: 3.0.4
    dev: true

  /array-union@2.1.0:
    resolution: {integrity: sha512-HGyxoOTYUyCM6stUe6EJgnd4EoewAI7zMdfqO+kGjnlZmBDz/cR5pf8r/cR4Wq60sL/p0IkcjUEEPwS3GFrIyw==}
    engines: {node: '>=8'}
    dev: true

  /array.prototype.flat@1.3.2:
    resolution: {integrity: sha512-djYB+Zx2vLewY8RWlNCUdHjDXs2XOgm602S9E7P/UpHgfeHL00cRiIF+IN/G/aUJ7kGPb6yO/ErDI5V2s8iycA==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      define-properties: 1.2.1
      es-abstract: 1.23.3
      es-shim-unscopables: 1.0.2
    dev: true

  /arraybuffer.prototype.slice@1.0.3:
    resolution: {integrity: sha512-bMxMKAjg13EBSVscxTaYA4mRc5t1UAXa2kXiGTNfZ079HIWXEkKmkgFrh/nJqamaLSrXO5H4WFFkPEaLJWbs3A==}
    engines: {node: '>= 0.4'}
    dependencies:
      array-buffer-byte-length: 1.0.1
      call-bind: 1.0.7
      define-properties: 1.2.1
      es-abstract: 1.23.3
      es-errors: 1.3.0
      get-intrinsic: 1.2.4
      is-array-buffer: 3.0.4
      is-shared-array-buffer: 1.0.3
    dev: true

  /arrify@1.0.1:
    resolution: {integrity: sha512-3CYzex9M9FGQjCGMGyi6/31c8GJbgb0qGyrx5HWxPd0aCwh4cB2YjMb2Xf9UuoogrMrlO9cTqnB5rI5GHZTcUA==}
    engines: {node: '>=0.10.0'}
    dev: true

  /as-table@1.0.55:
    resolution: {integrity: sha512-xvsWESUJn0JN421Xb9MQw6AsMHRCUknCe0Wjlxvjud80mU4E6hQf1A6NzQKcYNmYw62MfzEtXc+badstZP3JpQ==}
    dependencies:
      printable-characters: 1.0.42
    dev: false

  /assertion-error@1.1.0:
    resolution: {integrity: sha512-jgsaNduz+ndvGyFt3uSuWqvy4lCnIJiovtouQN5JZHOKCS2QuhEdbcQHFhVksz2N2U9hXJo8odG7ETyWlEeuDw==}
    dev: true

  /async-sema@3.1.1:
    resolution: {integrity: sha512-tLRNUXati5MFePdAk8dw7Qt7DpxPB60ofAgn8WRhW6a2rcimZnYBP9oxHiv0OHy+Wz7kPMG+t4LGdt31+4EmGg==}
    dev: false

  /available-typed-arrays@1.0.7:
    resolution: {integrity: sha512-wvUjBtSGN7+7SjNpq/9M2Tg350UZD3q62IFZLbRAR1bSMlCo1ZaeW+BJ+D090e4hIIZLBcTDWe4Mh4jvUDajzQ==}
    engines: {node: '>= 0.4'}
    dependencies:
      possible-typed-array-names: 1.0.0
    dev: true

  /axobject-query@4.0.0:
    resolution: {integrity: sha512-+60uv1hiVFhHZeO+Lz0RYzsVHy5Wr1ayX0mwda9KPDVLNJgZ1T9Ny7VmFbLDzxsH0D87I86vgj3gFrjTJUYznw==}
    dependencies:
      dequal: 2.0.3

  /balanced-match@1.0.2:
    resolution: {integrity: sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==}

  /better-path-resolve@1.0.0:
    resolution: {integrity: sha512-pbnl5XzGBdrFU/wT4jqmJVPn2B6UHPBOhzMQkY/SPUPB6QtUXtmBHBIwCbXJol93mOpGMnQyP/+BB19q04xj7g==}
    engines: {node: '>=4'}
    dependencies:
      is-windows: 1.0.2
    dev: true

  /binary-extensions@2.3.0:
    resolution: {integrity: sha512-Ceh+7ox5qe7LJuLHoY0feh3pHuUDHAcRUeyL2VYghZwfpkNIy/+8Ocg0a3UuSoYzavmylwuLWQOf3hl0jjMMIw==}
    engines: {node: '>=8'}

  /bindings@1.5.0:
    resolution: {integrity: sha512-p2q/t/mhvuOj/UeLlV6566GD/guowlr0hHxClI0W9m7MWYkL1F0hLo+0Aexs9HSPCtR1SXQ0TD3MMKrXZajbiQ==}
    dependencies:
      file-uri-to-path: 1.0.0
    dev: false

  /blake3-wasm@2.1.5:
    resolution: {integrity: sha512-F1+K8EbfOZE49dtoPtmxUQrpXaBIl3ICvasLh+nJta0xkz+9kF/7uet9fLnwKqhDrmj6g+6K3Tw9yQPUg2ka5g==}
    dev: false

  /brace-expansion@1.1.11:
    resolution: {integrity: sha512-iCuPHDFgrHX7H2vEI/5xpz07zSHB00TpugqhmYtVmMO6518mCuRMoOYFldEBl0g187ufozdaHgWKcYFb61qGiA==}
    dependencies:
      balanced-match: 1.0.2
      concat-map: 0.0.1

  /brace-expansion@2.0.1:
    resolution: {integrity: sha512-XnAIvQ8eM+kC6aULx6wuQiwVsnzsi9d3WxzV3FpWTGA19F621kwdbsAcFKXgKUHZWsy+mY6iL1sHTxWEFCytDA==}
    dependencies:
      balanced-match: 1.0.2

  /braces@3.0.2:
    resolution: {integrity: sha512-b8um+L1RzM3WDSzvhm6gIz1yfTbBt6YTlcEKAvsmqCZZFw46z626lVj9j1yEPW33H5H+lBQpZMP1k8l+78Ha0A==}
    engines: {node: '>=8'}
    dependencies:
      fill-range: 7.0.1

  /breakword@1.0.6:
    resolution: {integrity: sha512-yjxDAYyK/pBvws9H4xKYpLDpYKEH6CzrBPAuXq3x18I+c/2MkVtT3qAr7Oloi6Dss9qNhPVueAAVU1CSeNDIXw==}
    dependencies:
      wcwidth: 1.0.1
    dev: true

  /browserslist@4.23.0:
    resolution: {integrity: sha512-QW8HiM1shhT2GuzkvklfjcKDiWFXHOeFCIA/huJPwHsslwcydgk7X+z2zXpEijP98UCY7HbubZt5J2Zgvf0CaQ==}
    engines: {node: ^6 || ^7 || ^8 || ^9 || ^10 || ^11 || ^12 || >=13.7}
    hasBin: true
    dependencies:
      caniuse-lite: 1.0.30001609
      electron-to-chromium: 1.4.736
      node-releases: 2.0.14
      update-browserslist-db: 1.0.13(browserslist@4.23.0)
    dev: true

  /buffer-crc32@0.2.13:
    resolution: {integrity: sha512-VO9Ht/+p3SN7SKWqcrgEzjGbRSJYTx+Q1pTQC0wrWqHx0vpJraQ6GtHx8tvcg1rlK1byhU5gccxgOgj7B0TDkQ==}
    dev: true

  /builtin-modules@3.3.0:
    resolution: {integrity: sha512-zhaCDicdLuWN5UbN5IMnFqNMhNfo919sH85y2/ea+5Yg9TsTkeZxpL+JLbp6cgYFS4sRLp3YV4S6yDuqVWHYOw==}
    engines: {node: '>=6'}

  /c8@9.1.0:
    resolution: {integrity: sha512-mBWcT5iqNir1zIkzSPyI3NCR9EZCVI3WUD+AVO17MVWTSFNyUueXE82qTeampNtTr+ilN/5Ua3j24LgbCKjDVg==}
    engines: {node: '>=14.14.0'}
    hasBin: true
    dependencies:
      '@bcoe/v8-coverage': 0.2.3
      '@istanbuljs/schema': 0.1.3
      find-up: 5.0.0
      foreground-child: 3.1.1
      istanbul-lib-coverage: 3.2.2
      istanbul-lib-report: 3.0.1
      istanbul-reports: 3.1.7
      test-exclude: 6.0.0
      v8-to-istanbul: 9.2.0
      yargs: 17.7.2
      yargs-parser: 21.1.1
    dev: true

  /cac@6.7.14:
    resolution: {integrity: sha512-b6Ilus+c3RrdDk+JhLKUAQfzzgLEPy6wcXqS7f/xe1EETvsDP6GORG7SFuOs6cID5YkqchW/LXZbX5bc8j7ZcQ==}
    engines: {node: '>=8'}
    dev: true

  /call-bind@1.0.7:
    resolution: {integrity: sha512-GHTSNSYICQ7scH7sZ+M2rFopRoLh8t2bLSW6BbgrtLsahOIB5iyAVJf9GjWK3cYTDaMj4XdBpM1cA6pIS0Kv2w==}
    engines: {node: '>= 0.4'}
    dependencies:
      es-define-property: 1.0.0
      es-errors: 1.3.0
      function-bind: 1.1.2
      get-intrinsic: 1.2.4
      set-function-length: 1.2.2
    dev: true

  /callsites@3.1.0:
    resolution: {integrity: sha512-P8BjAsXvZS+VIDUI11hHCQEv74YT67YUi5JJFNWIqL235sBmjX4+qx9Muvls5ivyNENctx46xQLQ3aTuE7ssaQ==}
    engines: {node: '>=6'}
    dev: true

  /camelcase-keys@6.2.2:
    resolution: {integrity: sha512-YrwaA0vEKazPBkn0ipTiMpSajYDSe+KjQfrjhcBMxJt/znbvlHd8Pw/Vamaz5EB4Wfhs3SUR3Z9mwRu/P3s3Yg==}
    engines: {node: '>=8'}
    dependencies:
      camelcase: 5.3.1
      map-obj: 4.3.0
      quick-lru: 4.0.1
    dev: true

  /camelcase@5.3.1:
    resolution: {integrity: sha512-L28STB170nwWS63UjtlEOE3dldQApaJXZkOI1uMFfzf3rRuPegHaHesyee+YxQ+W6SvRDQV6UrdOdRiR153wJg==}
    engines: {node: '>=6'}
    dev: true

  /caniuse-lite@1.0.30001609:
    resolution: {integrity: sha512-JFPQs34lHKx1B5t1EpQpWH4c+29zIyn/haGsbpfq3suuV9v56enjFt23zqijxGTMwy1p/4H2tjnQMY+p1WoAyA==}
    dev: true

  /capnp-ts@0.7.0:
    resolution: {integrity: sha512-XKxXAC3HVPv7r674zP0VC3RTXz+/JKhfyw94ljvF80yynK6VkTnqE3jMuN8b3dUVmmc43TjyxjW4KTsmB3c86g==}
    dependencies:
      debug: 4.3.4
      tslib: 2.6.2
    transitivePeerDependencies:
      - supports-color
    dev: false

  /chai@4.4.1:
    resolution: {integrity: sha512-13sOfMv2+DWduEU+/xbun3LScLoqN17nBeTLUsmDfKdoiC1fr0n9PU4guu4AhRcOVFk/sW8LyZWHuhWtQZiF+g==}
    engines: {node: '>=4'}
    dependencies:
      assertion-error: 1.1.0
      check-error: 1.0.3
      deep-eql: 4.1.3
      get-func-name: 2.0.2
      loupe: 2.3.7
      pathval: 1.1.1
      type-detect: 4.0.8
    dev: true

  /chalk@2.4.2:
    resolution: {integrity: sha512-Mti+f9lpJNcwF4tWV8/OrTTtF1gZi+f8FqlyAdouralcFWFQWF2+NgCHShjkCb+IFBLq9buZwE1xckQU4peSuQ==}
    engines: {node: '>=4'}
    dependencies:
      ansi-styles: 3.2.1
      escape-string-regexp: 1.0.5
      supports-color: 5.5.0
    dev: true

  /chalk@4.1.2:
    resolution: {integrity: sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==}
    engines: {node: '>=10'}
    dependencies:
      ansi-styles: 4.3.0
      supports-color: 7.2.0
    dev: true

  /chardet@0.7.0:
    resolution: {integrity: sha512-mT8iDcrh03qDGRRmoA2hmBJnxpllMR+0/0qlzjqZES6NdiWDcZkCNAk4rPFZ9Q85r27unkiNNg8ZOiwZXBHwcA==}
    dev: true

  /check-error@1.0.3:
    resolution: {integrity: sha512-iKEoDYaRmd1mxM90a2OEfWhjsjPpYPuQ+lMYsoxB126+t8fw7ySEO48nmDg5COTjxDI65/Y2OWpeEHk3ZOe8zg==}
    dependencies:
      get-func-name: 2.0.2
    dev: true

  /chokidar@3.6.0:
    resolution: {integrity: sha512-7VT13fmjotKpGipCW9JEQAusEPE+Ei8nl6/g4FBAmIm0GOOLMua9NDDo/DWp0ZAxCr3cPq5ZpBqmPAQgDda2Pw==}
    engines: {node: '>= 8.10.0'}
    dependencies:
      anymatch: 3.1.3
      braces: 3.0.2
      glob-parent: 5.1.2
      is-binary-path: 2.1.0
      is-glob: 4.0.3
      normalize-path: 3.0.0
      readdirp: 3.6.0
    optionalDependencies:
      fsevents: 2.3.3

  /chownr@2.0.0:
    resolution: {integrity: sha512-bIomtDF5KGpdogkLd9VspvFzk9KfpyyGlS8YFVZl7TGPBHL5snIOnxeshwVgPteQ9b4Eydl+pVbIyE1DcvCWgQ==}
    engines: {node: '>=10'}
    dev: false

  /ci-info@3.9.0:
    resolution: {integrity: sha512-NIxF55hv4nSqQswkAeiOi1r83xy8JldOFDTWiug55KBu9Jnblncd2U6ViHmYgHf01TPZS77NJBhBMKdWj9HQMQ==}
    engines: {node: '>=8'}
    dev: true

  /ci-info@4.0.0:
    resolution: {integrity: sha512-TdHqgGf9odd8SXNuxtUBVx8Nv+qZOejE6qyqiy5NtbYYQOeFa6zmHkxlPzmaLxWWHsU6nJmB7AETdVPi+2NBUg==}
    engines: {node: '>=8'}
    dev: true

  /clean-regexp@1.0.0:
    resolution: {integrity: sha512-GfisEZEJvzKrmGWkvfhgzcz/BllN1USeqD2V6tg14OAOgaCD2Z/PUEuxnAZ/nPvmaHRG7a8y77p1T/IRQ4D1Hw==}
    engines: {node: '>=4'}
    dependencies:
      escape-string-regexp: 1.0.5
    dev: true

  /cliui@6.0.0:
    resolution: {integrity: sha512-t6wbgtoCXvAzst7QgXxJYqPt0usEfbgQdftEPbLL/cvv6HPE5VgvqCuAIDR0NgU52ds6rFwqrgakNLrHEjCbrQ==}
    dependencies:
      string-width: 4.2.3
      strip-ansi: 6.0.1
      wrap-ansi: 6.2.0
    dev: true

  /cliui@8.0.1:
    resolution: {integrity: sha512-BSeNnyus75C4//NQ9gQt1/csTXyo/8Sb+afLAkzAptFuMsod9HFokGNudZpi/oQV73hnVK+sR+5PVRMd+Dr7YQ==}
    engines: {node: '>=12'}
    dependencies:
      string-width: 4.2.3
      strip-ansi: 6.0.1
      wrap-ansi: 7.0.0
    dev: true

  /clone@1.0.4:
    resolution: {integrity: sha512-JQHZ2QMW6l3aH/j6xCqQThY/9OH4D/9ls34cgkUBiEeocRTU04tHfKPBsUK1PqZCUQM7GiA0IIXJSuXHI64Kbg==}
    engines: {node: '>=0.8'}
    dev: true

  /code-block-writer@13.0.1:
    resolution: {integrity: sha512-c5or4P6erEA69TxaxTNcHUNcIn+oyxSRTOWV+pSYF+z4epXqNvwvJ70XPGjPNgue83oAFAPBRQYwpAJ/Hpe/Sg==}
    dev: false

  /code-red@1.0.4:
    resolution: {integrity: sha512-7qJWqItLA8/VPVlKJlFXU+NBlo/qyfs39aJcuMT/2ere32ZqvF5OSxgdM5xOfJJ7O429gg2HM47y8v9P+9wrNw==}
    dependencies:
      '@jridgewell/sourcemap-codec': 1.4.15
      '@types/estree': 1.0.5
      acorn: 8.11.3
      estree-walker: 3.0.3
      periscopic: 3.1.0

  /color-convert@1.9.3:
    resolution: {integrity: sha512-QfAUtd+vFdAtFQcC8CCyYt1fYWxSqAiK2cSD6zDB8N3cpsEBAvRxp9zOGg6G/SHHJYAT88/az/IuDGALsNVbGg==}
    dependencies:
      color-name: 1.1.3
    dev: true

  /color-convert@2.0.1:
    resolution: {integrity: sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==}
    engines: {node: '>=7.0.0'}
    dependencies:
      color-name: 1.1.4

  /color-name@1.1.3:
    resolution: {integrity: sha512-72fSenhMw2HZMTVHeCA9KCmpEIbzWiQsjN+BHcBbS9vr1mtt+vJjPdksIBNUmKAW8TFUDPJK5SUU3QhE9NEXDw==}
    dev: true

  /color-name@1.1.4:
    resolution: {integrity: sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==}

  /color-string@1.9.1:
    resolution: {integrity: sha512-shrVawQFojnZv6xM40anx4CkoDP+fZsw/ZerEMsW/pyzsRbElpsL/DBVW7q3ExxwusdNXI3lXpuhEZkzs8p5Eg==}
    dependencies:
      color-name: 1.1.4
      simple-swizzle: 0.2.2
    dev: false

  /color-support@1.1.3:
    resolution: {integrity: sha512-qiBjkpbMLO/HL68y+lh4q0/O1MZFj2RX6X/KmMa3+gJD3z+WwI1ZzDHysvqHGS3mP6mznPckpXmw1nI9cJjyRg==}
    hasBin: true
    dev: false

  /color@4.2.3:
    resolution: {integrity: sha512-1rXeuUUiGGrykh+CeBdu5Ie7OJwinCgQY0bc7GCRxy5xVHy+moaqkpL/jqQq0MtQOeYcrqEz4abc5f0KtU7W4A==}
    engines: {node: '>=12.5.0'}
    dependencies:
      color-convert: 2.0.1
      color-string: 1.9.1
    dev: false

  /commander@12.0.0:
    resolution: {integrity: sha512-MwVNWlYjDTtOjX5PiD7o5pK0UrFU/OYgcJfjjK4RaHZETNtjJqrZa9Y9ds88+A+f+d5lv+561eZ+yCKoS3gbAA==}
    engines: {node: '>=18'}
    dev: false

  /commander@2.20.3:
    resolution: {integrity: sha512-GpVkmM8vF2vQUkj2LvZmD35JxeJOLCwJ9cUkugyk2nuhbv3+mJvpLYYt+0+USMxE+oj+ey/lJEnhZw75x/OMcQ==}
    dev: false

  /commander@4.1.1:
    resolution: {integrity: sha512-NOKm8xhkzAjzFx8B2v5OAHT+u5pRQc2UCa2Vq9jYL/31o2wi9mxBA7LIFs3sV5VSC49z6pEhfbMULvShKj26WA==}
    engines: {node: '>= 6'}
    dev: true

  /commander@7.2.0:
    resolution: {integrity: sha512-QrWXB+ZQSVPmIWIhtEO9H+gwHaMGYiF5ChvoJ+K9ZGHG/sVsa6yiesAD1GC/x46sET00Xlwo1u49RVVVzvcSkw==}
    engines: {node: '>= 10'}
    dev: false

  /commondir@1.0.1:
    resolution: {integrity: sha512-W9pAhw0ja1Edb5GVdIF1mjZw/ASI0AlShXM83UUGe2DVr5TdAPEA1OA8m/g8zWp9x6On7gqufY+FatDbC3MDQg==}

  /concat-map@0.0.1:
    resolution: {integrity: sha1-2Klr13/Wjfd5OnMDajug1UBdR3s=}

  /console-clear@1.1.1:
    resolution: {integrity: sha512-pMD+MVR538ipqkG5JXeOEbKWS5um1H4LUUccUQG68qpeqBYbzYy79Gh55jkd2TtPdRfUaLWdv6LPP//5Zt0aPQ==}
    engines: {node: '>=4'}
    dev: true

  /console-control-strings@1.1.0:
    resolution: {integrity: sha512-ty/fTekppD2fIwRvnZAVdeOiGd1c7YXEixbgJTNzqcxJWKQnjJ/V1bNEEE6hygpM3WjwHFUVK6HTjWSzV4a8sQ==}
    dev: false

  /convert-source-map@2.0.0:
    resolution: {integrity: sha512-Kvp459HrV2FEJ1CAsi1Ku+MY3kasH19TFykTz2xWmMeq6bk2NU3XXvfJ+Q61m0xktWwt+1HSYf3JZsTms3aRJg==}
    dev: true

  /cookie@0.5.0:
    resolution: {integrity: sha512-YZ3GUyn/o8gfKJlnlX7g7xq4gyO6OSuhGPKaaGssGB2qgDUS0gPgtTvoyZLTt9Ab6dC4hfc9dV5arkvc/OCmrw==}
    engines: {node: '>= 0.6'}
    dev: false

  /cookie@0.6.0:
    resolution: {integrity: sha512-U71cyTamuh1CRNCfpGY6to28lxvNwPG4Guz/EVjgf3Jmzv0vlDp1atT9eS5dDjMYHucpHbWns6Lwf3BKz6svdw==}
    engines: {node: '>= 0.6'}
    dev: false

  /core-js-compat@3.36.1:
    resolution: {integrity: sha512-Dk997v9ZCt3X/npqzyGdTlq6t7lDBhZwGvV94PKzDArjp7BTRm7WlDAXYd/OWdeFHO8OChQYRJNJvUCqCbrtKA==}
    dependencies:
      browserslist: 4.23.0
    dev: true

  /cross-env@7.0.3:
    resolution: {integrity: sha512-+/HKd6EgcQCJGh2PSjZuUitQBQynKor4wrFbRg4DtAgS1aWO+gU52xpH7M9ScGgXSYmAVS9bIJ8EzuaGw0oNAw==}
    engines: {node: '>=10.14', npm: '>=6', yarn: '>=1'}
    hasBin: true
    dependencies:
      cross-spawn: 7.0.3
    dev: true

  /cross-spawn@5.1.0:
    resolution: {integrity: sha512-pTgQJ5KC0d2hcY8eyL1IzlBPYjTkyH72XRZPnLyKus2mBfNjQs3klqbJU2VILqZryAZUt9JOb3h/mWMy23/f5A==}
    dependencies:
      lru-cache: 4.1.5
      shebang-command: 1.2.0
      which: 1.3.1
    dev: true

  /cross-spawn@7.0.3:
    resolution: {integrity: sha512-iRDPJKUPVEND7dHPO8rkbOnPpyDygcDFtWjpeWNCgy8WP2rXcxXL8TskReQl6OrB2G7+UJrags1q15Fudc7G6w==}
    engines: {node: '>= 8'}
    dependencies:
      path-key: 3.1.1
      shebang-command: 2.0.0
      which: 2.0.2
    dev: true

  /css-tree@2.3.1:
    resolution: {integrity: sha512-6Fv1DV/TYw//QF5IzQdqsNDjx/wc8TrMBZsqjL9eW01tWb7R7k/mq+/VXfJCl7SoD5emsJop9cOByJZfs8hYIw==}
    engines: {node: ^10 || ^12.20.0 || ^14.13.0 || >=15.0.0}
    dependencies:
      mdn-data: 2.0.30
      source-map-js: 1.2.0

  /cssesc@3.0.0:
    resolution: {integrity: sha512-/Tb/JcjK111nNScGob5MNtsntNM1aCNUDipB/TkwZFhyDrrE47SOx/18wF2bbjgc3ZzCSKW1T5nt5EbFoAz/Vg==}
    engines: {node: '>=4'}
    hasBin: true
    dev: true

  /csv-generate@3.4.3:
    resolution: {integrity: sha512-w/T+rqR0vwvHqWs/1ZyMDWtHHSJaN06klRqJXBEpDJaM/+dZkso0OKh1VcuuYvK3XM53KysVNq8Ko/epCK8wOw==}
    dev: true

  /csv-parse@4.16.3:
    resolution: {integrity: sha512-cO1I/zmz4w2dcKHVvpCr7JVRu8/FymG5OEpmvsZYlccYolPBLoVGKUHgNoc4ZGkFeFlWGEDmMyBM+TTqRdW/wg==}
    dev: true

  /csv-stringify@5.6.5:
    resolution: {integrity: sha512-PjiQ659aQ+fUTQqSrd1XEDnOr52jh30RBurfzkscaE2tPaFsDH5wOAHJiw8XAHphRknCwMUE9KRayc4K/NbO8A==}
    dev: true

  /csv@5.5.3:
    resolution: {integrity: sha512-QTaY0XjjhTQOdguARF0lGKm5/mEq9PD9/VhZZegHDIBq2tQwgNpHc3dneD4mGo2iJs+fTKv5Bp0fZ+BRuY3Z0g==}
    engines: {node: '>= 0.1.90'}
    dependencies:
      csv-generate: 3.4.3
      csv-parse: 4.16.3
      csv-stringify: 5.6.5
      stream-transform: 2.1.3
    dev: true

  /d3-array@3.2.4:
    resolution: {integrity: sha512-tdQAmyA18i4J7wprpYq8ClcxZy3SC31QMeByyCFyRt7BVHdREQZ5lpzoe5mFEYZUWe+oq8HBvk9JjpibyEV4Jg==}
    engines: {node: '>=12'}
    dependencies:
      internmap: 2.0.3
    dev: false

  /d3-geo-projection@4.0.0:
    resolution: {integrity: sha512-p0bK60CEzph1iqmnxut7d/1kyTmm3UWtPlwdkM31AU+LW+BXazd5zJdoCn7VFxNCHXRngPHRnsNn5uGjLRGndg==}
    engines: {node: '>=12'}
    hasBin: true
    dependencies:
      commander: 7.2.0
      d3-array: 3.2.4
      d3-geo: 3.1.1
    dev: false

  /d3-geo@3.1.1:
    resolution: {integrity: sha512-637ln3gXKXOwhalDzinUgY83KzNWZRKbYubaG+fGVuc/dxO64RRljtCTnf5ecMyE1RIdtqpkVcq0IbtU2S8j2Q==}
    engines: {node: '>=12'}
    dependencies:
      d3-array: 3.2.4
    dev: false

  /data-uri-to-buffer@2.0.2:
    resolution: {integrity: sha512-ND9qDTLc6diwj+Xe5cdAgVTbLVdXbtxTJRXRhli8Mowuaan+0EJOtdqJ0QCHNSSPyoXGx9HX2/VMnKeC34AChA==}
    dev: false

  /data-view-buffer@1.0.1:
    resolution: {integrity: sha512-0lht7OugA5x3iJLOWFhWK/5ehONdprk0ISXqVFn/NFrDu+cuc8iADFrGQz5BnRK7LLU3JmkbXSxaqX+/mXYtUA==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      es-errors: 1.3.0
      is-data-view: 1.0.1
    dev: true

  /data-view-byte-length@1.0.1:
    resolution: {integrity: sha512-4J7wRJD3ABAzr8wP+OcIcqq2dlUKp4DVflx++hs5h5ZKydWMI6/D/fAot+yh6g2tHh8fLFTvNOaVN357NvSrOQ==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      es-errors: 1.3.0
      is-data-view: 1.0.1
    dev: true

  /data-view-byte-offset@1.0.0:
    resolution: {integrity: sha512-t/Ygsytq+R995EJ5PZlD4Cu56sWa8InXySaViRzw9apusqsOO2bQP+SbYzAhR0pFKoB+43lYy8rWban9JSuXnA==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      es-errors: 1.3.0
      is-data-view: 1.0.1
    dev: true

  /dataloader@1.4.0:
    resolution: {integrity: sha512-68s5jYdlvasItOJnCuI2Q9s4q98g0pCyL3HrcKJu8KNugUl8ahgmZYg38ysLTgQjjXX3H8CJLkAvWrclWfcalw==}
    dev: true

  /debug@4.3.4:
    resolution: {integrity: sha512-PRWFHuSU3eDtQJPvnNY7Jcket1j0t5OuOsFzPPzsekD52Zl8qUfFIPEiswXqIvHWGVHOgX+7G/vCNNhehwxfkQ==}
    engines: {node: '>=6.0'}
    peerDependencies:
      supports-color: '*'
    peerDependenciesMeta:
      supports-color:
        optional: true
    dependencies:
      ms: 2.1.2

  /decamelize-keys@1.1.1:
    resolution: {integrity: sha512-WiPxgEirIV0/eIOMcnFBA3/IJZAZqKnwAwWyvvdi4lsr1WCN22nhdf/3db3DoZcUjTV2SqfzIwNyp6y2xs3nmg==}
    engines: {node: '>=0.10.0'}
    dependencies:
      decamelize: 1.2.0
      map-obj: 1.0.1
    dev: true

  /decamelize@1.2.0:
    resolution: {integrity: sha512-z2S+W9X73hAUUki+N+9Za2lBlun89zigOyGrsax+KUQ6wKW4ZoWpEYBkGhQjwAjjDCkWxhY0VKEhk8wzY7F5cA==}
    engines: {node: '>=0.10.0'}
    dev: true

  /dedent-js@1.0.1:
    resolution: {integrity: sha512-OUepMozQULMLUmhxS95Vudo0jb0UchLimi3+pQ2plj61Fcy8axbP9hbiD4Sz6DPqn6XG3kfmziVfQ1rSys5AJQ==}
    dev: false

  /deep-eql@4.1.3:
    resolution: {integrity: sha512-WaEtAOpRA1MQ0eohqZjpGD8zdI0Ovsm8mmFhaDN8dvDZzyoUMcYDnf5Y6iu7HTXxf8JDS23qWa4a+hKCDyOPzw==}
    engines: {node: '>=6'}
    dependencies:
      type-detect: 4.0.8
    dev: true

  /deep-is@0.1.4:
    resolution: {integrity: sha512-oIPzksmTg4/MriiaYGO+okXDT7ztn/w3Eptv/+gSIdMdKsJo0u4CfYNFJPy+4SKMuCqGw2wxnA+URMg3t8a/bQ==}
    dev: true

  /deepmerge@4.3.1:
    resolution: {integrity: sha512-3sUqbMEc77XqpdNO7FRyRog+eW3ph+GYCbj+rK+uYyRMuwsVy0rMiVtPn+QJlKFvWP/1PYpapqYn0Me2knFn+A==}
    engines: {node: '>=0.10.0'}

  /defaults@1.0.4:
    resolution: {integrity: sha512-eFuaLoy/Rxalv2kr+lqMlUnrDWV+3j4pljOIJgLIhI058IQfWJ7vXhyEIHu+HtC738klGALYxOKDO0bQP3tg8A==}
    dependencies:
      clone: 1.0.4
    dev: true

  /define-data-property@1.1.4:
    resolution: {integrity: sha512-rBMvIzlpA8v6E+SJZoo++HAYqsLrkg7MSfIinMPFhmkorw7X+dOXVJQs+QT69zGkzMyfDnIMN2Wid1+NbL3T+A==}
    engines: {node: '>= 0.4'}
    dependencies:
      es-define-property: 1.0.0
      es-errors: 1.3.0
      gopd: 1.0.1
    dev: true

  /define-properties@1.2.1:
    resolution: {integrity: sha512-8QmQKqEASLd5nx0U1B1okLElbUuuttJ/AnYmRXbbbGDWh6uS208EjD4Xqq/I9wK7u0v6O08XhTWnt5XtEbR6Dg==}
    engines: {node: '>= 0.4'}
    dependencies:
      define-data-property: 1.1.4
      has-property-descriptors: 1.0.2
      object-keys: 1.1.1
    dev: true

  /delegates@1.0.0:
    resolution: {integrity: sha512-bd2L678uiWATM6m5Z1VzNCErI3jiGzt6HGY8OVICs40JQq/HALfbyNJmp0UDakEY4pMMaN0Ly5om/B1VI/+xfQ==}
    dev: false

  /dequal@2.0.3:
    resolution: {integrity: sha512-0je+qPKHEMohvfRTCEo3CrPG6cAzAYgmzKyxRiYSSDkS6eGJdyVJm7WaYA5ECaAD9wLB2T4EEeymA5aFVcYXCA==}
    engines: {node: '>=6'}

  /detect-indent@6.1.0:
    resolution: {integrity: sha512-reYkTUJAZb9gUuZ2RvVCNhVHdg62RHnJ7WJl8ftMi4diZ6NWlciOzQN88pUhSELEwflJht4oQDv0F0BMlwaYtA==}
    engines: {node: '>=8'}
    dev: true

  /detect-libc@1.0.3:
    resolution: {integrity: sha512-pGjwhsmsp4kL2RTz08wcOlGN83otlqHeD/Z5T8GXZB+/YcpQ/dgo+lbU8ZsGxV0HIvqqxo9l7mqYwyYMD9bKDg==}
    engines: {node: '>=0.10'}
    hasBin: true
    dev: true

  /detect-libc@2.0.3:
    resolution: {integrity: sha512-bwy0MGW55bG41VqxxypOsdSdGqLwXPI/focwgTYCFMbdUiBAxLg9CFzG08sz2aqzknwiX7Hkl0bQENjg8iLByw==}
    engines: {node: '>=8'}
    dev: false

  /devalue@5.0.0:
    resolution: {integrity: sha512-gO+/OMXF7488D+u3ue+G7Y4AA3ZmUnB3eHJXmBTgNHvr4ZNzl36A0ZtG+XCRNYCkYx/bFmw4qtkoFLa+wSrwAA==}
    dev: false

  /diff-sequences@29.6.3:
    resolution: {integrity: sha512-EjePK1srD3P08o2j4f0ExnylqRs5B9tJjcp9t1krH2qRi8CCdsYfwe9JgSLurFBWwq4uOlipzfk5fHNvwFKr8Q==}
    engines: {node: ^14.15.0 || ^16.10.0 || >=18.0.0}
    dev: true

  /diff@5.2.0:
    resolution: {integrity: sha512-uIFDxqpRZGZ6ThOk84hEfqWoHx2devRFvpTZcTHur85vImfaxUbTW9Ryh4CpCuDnToOP1CEtXKIgytHBPVff5A==}
    engines: {node: '>=0.3.1'}
    dev: true

  /dir-glob@3.0.1:
    resolution: {integrity: sha512-WkrWp9GR4KXfKGYzOLmTuGVi1UWFfws377n9cc55/tb6DuqyF6pcQ5AbiHEshaDpY9v6oaSr2XCDidGmMwdzIA==}
    engines: {node: '>=8'}
    dependencies:
      path-type: 4.0.0
    dev: true

  /doctrine@3.0.0:
    resolution: {integrity: sha512-yS+Q5i3hBf7GBkd4KG8a7eBNNWNGLTaEwwYWUijIYM7zrlYDM0BFXHjjPWlWZ1Rg7UaddZeIDmi9jF3HmqiQ2w==}
    engines: {node: '>=6.0.0'}
    dependencies:
      esutils: 2.0.3
    dev: true

  /dotenv@16.4.5:
    resolution: {integrity: sha512-ZmdL2rui+eB2YwhsWzjInR8LldtZHGDoQ1ugH85ppHKwpUHL7j7rN0Ti9NCnGiQbhaZ11FpR+7ao1dNsmduNUg==}
    engines: {node: '>=12'}
    dev: true

  /dropcss@1.0.16:
    resolution: {integrity: sha512-QgA6BUh2SoBYE/dSuMmeGhNdoGtGewt3Rn66xKyXoGNyjrKRXf163wuM+xeQ83p87l/3ALoB6Il1dgKyGS5pEw==}
    dev: true

  /dts-buddy@0.4.6(typescript@5.4.5):
    resolution: {integrity: sha512-0gccY0vIuVCwbx4F9X5soE6ABKyjev2XVgwX2PYBx5hXfnrTeCBZwpf5F7MlVxzLo0pHfO9yNNo21cjZQZD/aw==}
    hasBin: true
    peerDependencies:
      typescript: '>=5.0.4 <5.5'
    dependencies:
      '@jridgewell/source-map': 0.3.6
      '@jridgewell/sourcemap-codec': 1.4.15
      globrex: 0.1.2
      kleur: 4.1.5
      locate-character: 3.0.0
      magic-string: 0.30.9
      sade: 1.8.1
      tiny-glob: 0.2.9
      ts-api-utils: 1.3.0(typescript@5.4.5)
      typescript: 5.4.5
    dev: true

  /eastasianwidth@0.2.0:
    resolution: {integrity: sha512-I88TYZWc9XiYHRQ4/3c5rjjfgkjhLyW2luGIheGERbNQ6OY7yTybanSpDXZa8y7VUP9YmDcYa+eyq4ca7iLqWA==}
    dev: true

  /electron-to-chromium@1.4.736:
    resolution: {integrity: sha512-Rer6wc3ynLelKNM4lOCg7/zPQj8tPOCB2hzD32PX9wd3hgRRi9MxEbmkFCokzcEhRVMiOVLjnL9ig9cefJ+6+Q==}
    dev: true

  /emoji-regex@8.0.0:
    resolution: {integrity: sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==}

  /emoji-regex@9.2.2:
    resolution: {integrity: sha512-L18DaJsXSUk2+42pv8mLs5jJT2hqFkFE4j21wOmgbUqsZ2hL72NsUU785g9RXgo3s0ZNgVl42TiHp3ZtOv/Vyg==}
    dev: true

  /enquirer@2.4.1:
    resolution: {integrity: sha512-rRqJg/6gd538VHvR3PSrdRBb/1Vy2YfzHqzvbhGIQpDRKIa4FgV/54b5Q1xYSxOOwKvjXweS26E0Q+nAMwp2pQ==}
    engines: {node: '>=8.6'}
    dependencies:
      ansi-colors: 4.1.3
      strip-ansi: 6.0.1
    dev: true

  /error-ex@1.3.2:
    resolution: {integrity: sha512-7dFHNmqeFSEt2ZBsCriorKnn3Z2pj+fd9kmI6QoWw4//DL+icEBfc0U7qJCisqrTsKTjw4fNFy2pW9OqStD84g==}
    dependencies:
      is-arrayish: 0.2.1
    dev: true

  /es-abstract@1.23.3:
    resolution: {integrity: sha512-e+HfNH61Bj1X9/jLc5v1owaLYuHdeHHSQlkhCBiTK8rBvKaULl/beGMxwrMXjpYrv4pz22BlY570vVePA2ho4A==}
    engines: {node: '>= 0.4'}
    dependencies:
      array-buffer-byte-length: 1.0.1
      arraybuffer.prototype.slice: 1.0.3
      available-typed-arrays: 1.0.7
      call-bind: 1.0.7
      data-view-buffer: 1.0.1
      data-view-byte-length: 1.0.1
      data-view-byte-offset: 1.0.0
      es-define-property: 1.0.0
      es-errors: 1.3.0
      es-object-atoms: 1.0.0
      es-set-tostringtag: 2.0.3
      es-to-primitive: 1.2.1
      function.prototype.name: 1.1.6
      get-intrinsic: 1.2.4
      get-symbol-description: 1.0.2
      globalthis: 1.0.3
      gopd: 1.0.1
      has-property-descriptors: 1.0.2
      has-proto: 1.0.3
      has-symbols: 1.0.3
      hasown: 2.0.2
      internal-slot: 1.0.7
      is-array-buffer: 3.0.4
      is-callable: 1.2.7
      is-data-view: 1.0.1
      is-negative-zero: 2.0.3
      is-regex: 1.1.4
      is-shared-array-buffer: 1.0.3
      is-string: 1.0.7
      is-typed-array: 1.1.13
      is-weakref: 1.0.2
      object-inspect: 1.13.1
      object-keys: 1.1.1
      object.assign: 4.1.5
      regexp.prototype.flags: 1.5.2
      safe-array-concat: 1.1.2
      safe-regex-test: 1.0.3
      string.prototype.trim: 1.2.9
      string.prototype.trimend: 1.0.8
      string.prototype.trimstart: 1.0.8
      typed-array-buffer: 1.0.2
      typed-array-byte-length: 1.0.1
      typed-array-byte-offset: 1.0.2
      typed-array-length: 1.0.6
      unbox-primitive: 1.0.2
      which-typed-array: 1.1.15
    dev: true

  /es-define-property@1.0.0:
    resolution: {integrity: sha512-jxayLKShrEqqzJ0eumQbVhTYQM27CfT1T35+gCgDFoL82JLsXqTJ76zv6A0YLOgEnLUMvLzsDsGIrl8NFpT2gQ==}
    engines: {node: '>= 0.4'}
    dependencies:
      get-intrinsic: 1.2.4
    dev: true

  /es-errors@1.3.0:
    resolution: {integrity: sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==}
    engines: {node: '>= 0.4'}
    dev: true

  /es-object-atoms@1.0.0:
    resolution: {integrity: sha512-MZ4iQ6JwHOBQjahnjwaC1ZtIBH+2ohjamzAO3oaHcXYup7qxjF2fixyH+Q71voWHeOkI2q/TnJao/KfXYIZWbw==}
    engines: {node: '>= 0.4'}
    dependencies:
      es-errors: 1.3.0
    dev: true

  /es-set-tostringtag@2.0.3:
    resolution: {integrity: sha512-3T8uNMC3OQTHkFUsFq8r/BwAXLHvU/9O9mE0fBc/MY5iq/8H7ncvO947LmYA6ldWw9Uh8Yhf25zu6n7nML5QWQ==}
    engines: {node: '>= 0.4'}
    dependencies:
      get-intrinsic: 1.2.4
      has-tostringtag: 1.0.2
      hasown: 2.0.2
    dev: true

  /es-shim-unscopables@1.0.2:
    resolution: {integrity: sha512-J3yBRXCzDu4ULnQwxyToo/OjdMx6akgVC7K6few0a7F/0wLtmKKN7I73AH5T2836UuXRqN7Qg+IIUw/+YJksRw==}
    dependencies:
      hasown: 2.0.2
    dev: true

  /es-to-primitive@1.2.1:
    resolution: {integrity: sha512-QCOllgZJtaUo9miYBcLChTUaHNjJF3PYs1VidD7AwiEj1kYxKeQTctLAezAOH5ZKRH0g2IgPn6KwB4IT8iRpvA==}
    engines: {node: '>= 0.4'}
    dependencies:
      is-callable: 1.2.7
      is-date-object: 1.0.5
      is-symbol: 1.0.4
    dev: true

  /es6-promise@3.3.1:
    resolution: {integrity: sha512-SOp9Phqvqn7jtEUxPWdWfWoLmyt2VaJ6MpvP9Comy1MceMXqE6bxvaTu4iaxpYYPzhny28Lc+M87/c2cPK6lDg==}
    dev: true

  /esbuild@0.17.19:
    resolution: {integrity: sha512-XQ0jAPFkK/u3LcVRcvVHQcTIqD6E2H1fvZMA5dQPSOWb3suUbWbfbRf94pjc0bNzRYLfIrDRQXr7X+LHIm5oHw==}
    engines: {node: '>=12'}
    hasBin: true
    requiresBuild: true
    optionalDependencies:
      '@esbuild/android-arm': 0.17.19
      '@esbuild/android-arm64': 0.17.19
      '@esbuild/android-x64': 0.17.19
      '@esbuild/darwin-arm64': 0.17.19
      '@esbuild/darwin-x64': 0.17.19
      '@esbuild/freebsd-arm64': 0.17.19
      '@esbuild/freebsd-x64': 0.17.19
      '@esbuild/linux-arm': 0.17.19
      '@esbuild/linux-arm64': 0.17.19
      '@esbuild/linux-ia32': 0.17.19
      '@esbuild/linux-loong64': 0.17.19
      '@esbuild/linux-mips64el': 0.17.19
      '@esbuild/linux-ppc64': 0.17.19
      '@esbuild/linux-riscv64': 0.17.19
      '@esbuild/linux-s390x': 0.17.19
      '@esbuild/linux-x64': 0.17.19
      '@esbuild/netbsd-x64': 0.17.19
      '@esbuild/openbsd-x64': 0.17.19
      '@esbuild/sunos-x64': 0.17.19
      '@esbuild/win32-arm64': 0.17.19
      '@esbuild/win32-ia32': 0.17.19
      '@esbuild/win32-x64': 0.17.19
    dev: false

  /esbuild@0.20.2:
    resolution: {integrity: sha512-WdOOppmUNU+IbZ0PaDiTst80zjnrOkyJNHoKupIcVyU8Lvla3Ugx94VzkQ32Ijqd7UhHJy75gNWDMUekcrSJ6g==}
    engines: {node: '>=12'}
    hasBin: true
    requiresBuild: true
    optionalDependencies:
      '@esbuild/aix-ppc64': 0.20.2
      '@esbuild/android-arm': 0.20.2
      '@esbuild/android-arm64': 0.20.2
      '@esbuild/android-x64': 0.20.2
      '@esbuild/darwin-arm64': 0.20.2
      '@esbuild/darwin-x64': 0.20.2
      '@esbuild/freebsd-arm64': 0.20.2
      '@esbuild/freebsd-x64': 0.20.2
      '@esbuild/linux-arm': 0.20.2
      '@esbuild/linux-arm64': 0.20.2
      '@esbuild/linux-ia32': 0.20.2
      '@esbuild/linux-loong64': 0.20.2
      '@esbuild/linux-mips64el': 0.20.2
      '@esbuild/linux-ppc64': 0.20.2
      '@esbuild/linux-riscv64': 0.20.2
      '@esbuild/linux-s390x': 0.20.2
      '@esbuild/linux-x64': 0.20.2
      '@esbuild/netbsd-x64': 0.20.2
      '@esbuild/openbsd-x64': 0.20.2
      '@esbuild/sunos-x64': 0.20.2
      '@esbuild/win32-arm64': 0.20.2
      '@esbuild/win32-ia32': 0.20.2
      '@esbuild/win32-x64': 0.20.2

  /escalade@3.1.2:
    resolution: {integrity: sha512-ErCHMCae19vR8vQGe50xIsVomy19rg6gFu3+r3jkEO46suLMWBksvVyoGgQV+jOfl84ZSOSlmv6Gxa89PmTGmA==}
    engines: {node: '>=6'}
    dev: true

  /escape-string-regexp@1.0.5:
    resolution: {integrity: sha512-vbRorB5FUQWvla16U8R/qgaFIya2qGzwDrNmCZuYKrbdSUMG6I1ZCGQRefkRVhuOkIGVne7BQ35DSfo1qvJqFg==}
    engines: {node: '>=0.8.0'}
    dev: true

  /escape-string-regexp@4.0.0:
    resolution: {integrity: sha512-TtpcNJ3XAzx3Gq8sWRzJaVajRs0uVxA2YAkdb1jm2YkPz4G6egUFAyA3n5vtEIZefPk5Wa4UXbKuS5fKkJWdgA==}
    engines: {node: '>=10'}

  /eslint-compat-utils@0.5.0(eslint@8.57.0):
    resolution: {integrity: sha512-dc6Y8tzEcSYZMHa+CMPLi/hyo1FzNeonbhJL7Ol0ccuKQkwopJcJBA9YL/xmMTLU1eKigXo9vj9nALElWYSowg==}
    engines: {node: '>=12'}
    peerDependencies:
      eslint: '>=6.0.0'
    dependencies:
      eslint: 8.57.0
      semver: 7.6.0
    dev: true

  /eslint-config-prettier@9.1.0(eslint@8.57.0):
    resolution: {integrity: sha512-NSWl5BFQWEPi1j4TjVNItzYV7dZXZ+wP6I6ZhrBGpChQhZRUaElihE9uRRkcbRnNb76UMKDF3r+WTmNcGPKsqw==}
    hasBin: true
    peerDependencies:
      eslint: '>=7.0.0'
    dependencies:
      eslint: 8.57.0
    dev: true

  /eslint-plugin-svelte@2.37.0(eslint@8.57.0):
    resolution: {integrity: sha512-H/2Gz7agYHEMEEzRuLYuCmAIdjuBnbhFG9hOK0yCdSBvvJGJMkjo+lR6j67OIvLOavgp4L7zA5LnDKi8WqdPhQ==}
    engines: {node: ^14.17.0 || >=16.0.0}
    peerDependencies:
      eslint: ^7.0.0 || ^8.0.0-0 || ^9.0.0-0
      svelte: ^3.37.0 || ^4.0.0 || ^5.0.0-next.95
    peerDependenciesMeta:
      svelte:
        optional: true
    dependencies:
      '@eslint-community/eslint-utils': 4.4.0(eslint@8.57.0)
      '@jridgewell/sourcemap-codec': 1.4.15
      debug: 4.3.4
      eslint: 8.57.0
      eslint-compat-utils: 0.5.0(eslint@8.57.0)
      esutils: 2.0.3
      known-css-properties: 0.30.0
      postcss: 8.4.38
      postcss-load-config: 3.1.4(postcss@8.4.38)
      postcss-safe-parser: 6.0.0(postcss@8.4.38)
      postcss-selector-parser: 6.0.16
      semver: 7.6.0
      svelte-eslint-parser: 0.34.1
    transitivePeerDependencies:
      - supports-color
      - ts-node
    dev: true

  /eslint-plugin-unicorn@52.0.0(eslint@8.57.0):
    resolution: {integrity: sha512-1Yzm7/m+0R4djH0tjDjfVei/ju2w3AzUGjG6q8JnuNIL5xIwsflyCooW5sfBvQp2pMYQFSWWCFONsjCax1EHng==}
    engines: {node: '>=16'}
    peerDependencies:
      eslint: '>=8.56.0'
    dependencies:
      '@babel/helper-validator-identifier': 7.22.20
      '@eslint-community/eslint-utils': 4.4.0(eslint@8.57.0)
      '@eslint/eslintrc': 2.1.4
      ci-info: 4.0.0
      clean-regexp: 1.0.0
      core-js-compat: 3.36.1
      eslint: 8.57.0
      esquery: 1.5.0
      indent-string: 4.0.0
      is-builtin-module: 3.2.1
      jsesc: 3.0.2
      pluralize: 8.0.0
      read-pkg-up: 7.0.1
      regexp-tree: 0.1.27
      regjsparser: 0.10.0
      semver: 7.6.0
      strip-indent: 3.0.0
    transitivePeerDependencies:
      - supports-color
    dev: true

  /eslint-scope@7.2.2:
    resolution: {integrity: sha512-dOt21O7lTMhDM+X9mB4GX+DZrZtCUJPL/wlcTqxyrx5IvO0IYtILdtrQGQp+8n5S0gwSVmOf9NQrjMOgfQZlIg==}
    engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}
    dependencies:
      esrecurse: 4.3.0
      estraverse: 5.3.0
    dev: true

  /eslint-visitor-keys@3.4.3:
    resolution: {integrity: sha512-wpc+LXeiyiisxPlEkUzU6svyS1frIO3Mgxj1fdy7Pm8Ygzguax2N3Fa/D/ag1WqbOprdI+uY6wMUl8/a2G+iag==}
    engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}
    dev: true

  /eslint@8.57.0:
    resolution: {integrity: sha512-dZ6+mexnaTIbSBZWgou51U6OmzIhYM2VcNdtiTtI7qPNZm35Akpr0f6vtw3w1Kmn5PYo+tZVfh13WrhpS6oLqQ==}
    engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}
    hasBin: true
    dependencies:
      '@eslint-community/eslint-utils': 4.4.0(eslint@8.57.0)
      '@eslint-community/regexpp': 4.10.0
      '@eslint/eslintrc': 2.1.4
      '@eslint/js': 8.57.0
      '@humanwhocodes/config-array': 0.11.14
      '@humanwhocodes/module-importer': 1.0.1
      '@nodelib/fs.walk': 1.2.8
      '@ungap/structured-clone': 1.2.0
      ajv: 6.12.6
      chalk: 4.1.2
      cross-spawn: 7.0.3
      debug: 4.3.4
      doctrine: 3.0.0
      escape-string-regexp: 4.0.0
      eslint-scope: 7.2.2
      eslint-visitor-keys: 3.4.3
      espree: 9.6.1
      esquery: 1.5.0
      esutils: 2.0.3
      fast-deep-equal: 3.1.3
      file-entry-cache: 6.0.1
      find-up: 5.0.0
      glob-parent: 6.0.2
      globals: 13.24.0
      graphemer: 1.4.0
      ignore: 5.3.1
      imurmurhash: 0.1.4
      is-glob: 4.0.3
      is-path-inside: 3.0.3
      js-yaml: 4.1.0
      json-stable-stringify-without-jsonify: 1.0.1
      levn: 0.4.1
      lodash.merge: 4.6.2
      minimatch: 3.1.2
      natural-compare: 1.4.0
      optionator: 0.9.3
      strip-ansi: 6.0.1
      text-table: 0.2.0
    transitivePeerDependencies:
      - supports-color
    dev: true

  /esm-env@1.0.0:
    resolution: {integrity: sha512-Cf6VksWPsTuW01vU9Mk/3vRue91Zevka5SjyNf3nEpokFRuqt/KjUQoGAwq9qMmhpLTHmXzSIrFRw8zxWzmFBA==}

  /espree@9.6.1:
    resolution: {integrity: sha512-oruZaFkjorTpF32kDSI5/75ViwGeZginGGy2NoOSg3Q9bnwlnmDm4HLnkl0RE3n+njDXR037aY1+x58Z/zFdwQ==}
    engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}
    dependencies:
      acorn: 8.11.3
      acorn-jsx: 5.3.2(acorn@8.11.3)
      eslint-visitor-keys: 3.4.3
    dev: true

  /esprima@4.0.1:
    resolution: {integrity: sha512-eGuFFw7Upda+g4p+QHvnW0RyTX/SVeJBDM/gCtMARO0cLuT2HcEKnTPvhjV6aGeqrCB/sbNop0Kszm0jsaWU4A==}
    engines: {node: '>=4'}
    hasBin: true
    dev: true

  /esquery@1.5.0:
    resolution: {integrity: sha512-YQLXUplAwJgCydQ78IMJywZCceoqk1oH01OERdSAJc/7U2AylwjhSCLDEtqwg811idIS/9fIU5GjG73IgjKMVg==}
    engines: {node: '>=0.10'}
    dependencies:
      estraverse: 5.3.0
    dev: true

  /esrecurse@4.3.0:
    resolution: {integrity: sha512-KmfKL3b6G+RXvP8N1vr3Tq1kL/oCFgn2NYXEtqP8/L3pKapUA4G8cFVaoF3SU323CD4XypR/ffioHmkti6/Tag==}
    engines: {node: '>=4.0'}
    dependencies:
      estraverse: 5.3.0
    dev: true

  /estraverse@5.3.0:
    resolution: {integrity: sha512-MMdARuVEQziNTeJD8DgMqmhwR11BRQ/cBP+pLtYdSTnf3MIO8fFeiINEbX36ZdNlfU/7A9f3gUw49B3oQsvwBA==}
    engines: {node: '>=4.0'}
    dev: true

  /estree-walker@0.6.1:
    resolution: {integrity: sha512-SqmZANLWS0mnatqbSfRP5g8OXZC12Fgg1IwNtLsyHDzJizORW4khDfjPqJZsemPWBB2uqykUah5YpQ6epsqC/w==}
    dev: false

  /estree-walker@2.0.2:
    resolution: {integrity: sha512-Rfkk/Mp/DL7JVje3u18FxFujQlTNR2q6QfMSMB7AvCBx91NGj/ba3kCfza0f6dVDbw7YlRf/nDrn7pQrCCyQ/w==}

  /estree-walker@3.0.3:
    resolution: {integrity: sha512-7RUKfXgSMMkzt6ZuXmqapOurLGPPfgj6l9uRZ7lRGolvk0y2yocc35LdcxKC5PQZdn2DMqioAQ2NoWcrTKmm6g==}
    dependencies:
      '@types/estree': 1.0.5

  /esutils@2.0.3:
    resolution: {integrity: sha512-kVscqXk4OCp68SZ0dkgEKVi6/8ij300KBWTJq32P/dYeWTSwK41WyTxalN1eRmA5Z9UU/LX9D7FWSmV9SAYx6g==}
    engines: {node: '>=0.10.0'}
    dev: true

  /execa@8.0.1:
    resolution: {integrity: sha512-VyhnebXciFV2DESc+p6B+y0LjSm0krU4OgJN44qFAhBY0TJ+1V61tYD2+wHusZ6F9n5K+vl8k0sTy7PEfV4qpg==}
    engines: {node: '>=16.17'}
    dependencies:
      cross-spawn: 7.0.3
      get-stream: 8.0.1
      human-signals: 5.0.0
      is-stream: 3.0.0
      merge-stream: 2.0.0
      npm-run-path: 5.3.0
      onetime: 6.0.0
      signal-exit: 4.1.0
      strip-final-newline: 3.0.0
    dev: true

  /exit-hook@2.2.1:
    resolution: {integrity: sha512-eNTPlAD67BmP31LDINZ3U7HSF8l57TxOY2PmBJ1shpCvpnxBF93mWCE8YHBnXs8qiUZJc9WDcWIeC3a2HIAMfw==}
    engines: {node: '>=6'}
    dev: false

  /extendable-error@0.1.7:
    resolution: {integrity: sha512-UOiS2in6/Q0FK0R0q6UY9vYpQ21mr/Qn1KOnte7vsACuNJf514WvCCUHSRCPcgjPT2bAhNIJdlE6bVap1GKmeg==}
    dev: true

  /external-editor@3.1.0:
    resolution: {integrity: sha512-hMQ4CX1p1izmuLYyZqLMO/qGNw10wSv9QDCPfzXfyFrOaCSSoRfqE1Kf1s5an66J5JZC62NewG+mK49jOCtQew==}
    engines: {node: '>=4'}
    dependencies:
      chardet: 0.7.0
      iconv-lite: 0.4.24
      tmp: 0.0.33
    dev: true

  /fast-deep-equal@3.1.3:
    resolution: {integrity: sha512-f3qQ9oQy9j2AhBe/H9VC91wLmKBCCU/gDOnKNAYG5hswO7BLKj09Hc5HYNz9cGI++xlpDCIgDaitVs03ATR84Q==}
    dev: true

  /fast-glob@3.3.2:
    resolution: {integrity: sha512-oX2ruAFQwf/Orj8m737Y5adxDQO0LAB7/S5MnxCdTNDd4p6BsyIVsv9JQsATbTSq8KHRpLwIHbVlUNatxd+1Ow==}
    engines: {node: '>=8.6.0'}
    dependencies:
      '@nodelib/fs.stat': 2.0.5
      '@nodelib/fs.walk': 1.2.8
      glob-parent: 5.1.2
      merge2: 1.4.1
      micromatch: 4.0.5

  /fast-json-stable-stringify@2.1.0:
    resolution: {integrity: sha512-lhd/wF+Lk98HZoTCtlVraHtfh5XYijIjalXck7saUtuanSDyLMxnHhSXEDJqHxD7msR8D0uCmqlkwjCV8xvwHw==}
    dev: true

  /fast-levenshtein@2.0.6:
    resolution: {integrity: sha512-DCXu6Ifhqcks7TZKY3Hxp3y6qphY5SJZmrWMDrKcERSOXWQdMhU9Ig/PYrzyw/ul9jOIyh0N4M0tbC5hodg8dw==}
    dev: true

  /fastq@1.17.1:
    resolution: {integrity: sha512-sRVD3lWVIXWg6By68ZN7vho9a1pQcN/WBFaAAsDDFzlJjvoGx0P8z7V1t72grFJfJhu3YPZBuu25f7Kaw2jN1w==}
    dependencies:
      reusify: 1.0.4

  /fenceparser@1.1.1:
    resolution: {integrity: sha512-VdkTsK7GWLT0VWMK5S5WTAPn61wJ98WPFwJiRHumhg4ESNUO/tnkU8bzzzc62o6Uk1SVhuZFLnakmDA4SGV7wA==}
    engines: {node: '>=12'}
    dev: true

  /file-entry-cache@6.0.1:
    resolution: {integrity: sha512-7Gps/XWymbLk2QLYK4NzpMOrYjMhdIxXuIvy2QBsLE6ljuodKvdkWs/cpyJJ3CVIVpH0Oi1Hvg1ovbMzLdFBBg==}
    engines: {node: ^10.12.0 || >=12.0.0}
    dependencies:
      flat-cache: 3.2.0
    dev: true

  /file-uri-to-path@1.0.0:
    resolution: {integrity: sha512-0Zt+s3L7Vf1biwWZ29aARiVYLx7iMGnEUl9x33fbB/j3jR81u/O2LbqK+Bm1CDSNDKVtJ/YjwY7TUd5SkeLQLw==}
    dev: false

  /fill-range@7.0.1:
    resolution: {integrity: sha512-qOo9F+dMUmC2Lcb4BbVvnKJxTPjCm+RRpe4gDuGrzkL7mEVl/djYSu2OdQ2Pa302N4oqkSg9ir6jaLWJ2USVpQ==}
    engines: {node: '>=8'}
    dependencies:
      to-regex-range: 5.0.1

  /find-up@4.1.0:
    resolution: {integrity: sha512-PpOwAdQ/YlXQ2vj8a3h8IipDuYRi3wceVQQGYWxNINccq40Anw7BlsEXCMbt1Zt+OLA6Fq9suIpIWD0OsnISlw==}
    engines: {node: '>=8'}
    dependencies:
      locate-path: 5.0.0
      path-exists: 4.0.0
    dev: true

  /find-up@5.0.0:
    resolution: {integrity: sha512-78/PXT1wlLLDgTzDs7sjq9hzz0vXD+zn+7wypEe4fXQxCmdmqfGsEPQxmiCSQI3ajFV91bVSsvNtrJRiW6nGng==}
    engines: {node: '>=10'}
    dependencies:
      locate-path: 6.0.0
      path-exists: 4.0.0
    dev: true

  /find-yarn-workspace-root2@1.2.16:
    resolution: {integrity: sha512-hr6hb1w8ePMpPVUK39S4RlwJzi+xPLuVuG8XlwXU3KD5Yn3qgBWVfy3AzNlDhWvE1EORCE65/Qm26rFQt3VLVA==}
    dependencies:
      micromatch: 4.0.5
      pkg-dir: 4.2.0
    dev: true

  /flat-cache@3.2.0:
    resolution: {integrity: sha512-CYcENa+FtcUKLmhhqyctpclsq7QF38pKjZHsGNiSQF5r4FtoKDWabFDl3hzaEQMvT1LHEysw5twgLvpYYb4vbw==}
    engines: {node: ^10.12.0 || >=12.0.0}
    dependencies:
      flatted: 3.3.1
      keyv: 4.5.4
      rimraf: 3.0.2
    dev: true

  /flatted@3.3.1:
    resolution: {integrity: sha512-X8cqMLLie7KsNUDSdzeN8FYK9rEt4Dt67OsG/DNGnYTSDBG4uFAJFBnUeiV+zCVAvwFy56IjM9sH51jVaEhNxw==}
    dev: true

  /flexsearch@0.7.43:
    resolution: {integrity: sha512-c5o/+Um8aqCSOXGcZoqZOm+NqtVwNsvVpWv6lfmSclU954O3wvQKxxK8zj74fPaSJbXpSLTs4PRhh+wnoCXnKg==}
    dev: true

  /for-each@0.3.3:
    resolution: {integrity: sha512-jqYfLp7mo9vIyQf8ykW2v7A+2N4QjeCeI5+Dz9XraiO1ign81wjiH7Fb9vSOWvQfNtmSa4H2RoQTrrXivdUZmw==}
    dependencies:
      is-callable: 1.2.7
    dev: true

  /foreground-child@3.1.1:
    resolution: {integrity: sha512-TMKDUnIte6bfb5nWv7V/caI169OHgvwjb7V4WkeUvbQQdjr5rWKqHFiKWb/fcOwB+CzBT+qbWjvj+DVwRskpIg==}
    engines: {node: '>=14'}
    dependencies:
      cross-spawn: 7.0.3
      signal-exit: 4.1.0
    dev: true

  /fs-extra@7.0.1:
    resolution: {integrity: sha512-YJDaCJZEnBmcbw13fvdAM9AwNOJwOzrE4pqMqBq5nFiEqXUqHwlK4B+3pUw6JNvfSPtX05xFHtYy/1ni01eGCw==}
    engines: {node: '>=6 <7 || >=8'}
    dependencies:
      graceful-fs: 4.2.11
      jsonfile: 4.0.0
      universalify: 0.1.2
    dev: true

  /fs-extra@8.1.0:
    resolution: {integrity: sha512-yhlQgA6mnOJUKOsRUFsgJdQCvkKhcz8tlZG5HBQfReYZy46OwLcY+Zia0mtdHsOo9y/hP+CxMN0TU9QxoOtG4g==}
    engines: {node: '>=6 <7 || >=8'}
    dependencies:
      graceful-fs: 4.2.11
      jsonfile: 4.0.0
      universalify: 0.1.2
    dev: true

  /fs-minipass@2.1.0:
    resolution: {integrity: sha512-V/JgOLFCS+R6Vcq0slCuaeWEdNC3ouDlJMNIsacH2VtALiu9mV4LPrHc5cDl8k5aw6J8jwgWWpiTo5RYhmIzvg==}
    engines: {node: '>= 8'}
    dependencies:
      minipass: 3.3.6
    dev: false

  /fs.realpath@1.0.0:
    resolution: {integrity: sha512-OO0pH2lK6a0hZnAdau5ItzHPI6pUlvI7jMVnxUQRtw4owF2wk8lOSabtGDCTP4Ggrg2MbGnWO9X8K1t4+fGMDw==}

  /fsevents@2.3.2:
    resolution: {integrity: sha512-xiqMQR4xAeHTuB9uWm+fFRcIOgKBMiOBP+eXiyT7jsgVCq1bkVygt00oASowB7EdtpOHaaPgKt812P9ab+DDKA==}
    engines: {node: ^8.16.0 || ^10.6.0 || >=11.0.0}
    os: [darwin]
    requiresBuild: true
    dev: true
    optional: true

  /fsevents@2.3.3:
    resolution: {integrity: sha512-5xoDfX+fL7faATnagmWPpbFtwh/R77WmMMqqHGS65C3vvB0YHrgF+B1YmZ3441tMj5n63k0212XNoJwzlhffQw==}
    engines: {node: ^8.16.0 || ^10.6.0 || >=11.0.0}
    os: [darwin]
    requiresBuild: true
    optional: true

  /function-bind@1.1.2:
    resolution: {integrity: sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==}

  /function.prototype.name@1.1.6:
    resolution: {integrity: sha512-Z5kx79swU5P27WEayXM1tBi5Ze/lbIyiNgU3qyXUOf9b2rgXYyF9Dy9Cx+IQv/Lc8WCG6L82zwUPpSS9hGehIg==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      define-properties: 1.2.1
      es-abstract: 1.23.3
      functions-have-names: 1.2.3
    dev: true

  /functions-have-names@1.2.3:
    resolution: {integrity: sha512-xckBUXyTIqT97tq2x2AMb+g163b5JFysYk0x4qxNFwbfQkmNZoiRHb6sPzI9/QV33WeuvVYBUIiD4NzNIyqaRQ==}
    dev: true

  /gauge@3.0.2:
    resolution: {integrity: sha512-+5J6MS/5XksCuXq++uFRsnUd7Ovu1XenbeuIuNRJxYWjgQbPuFhT14lAvsWfqfAmnwluf1OwMjz39HjfLPci0Q==}
    engines: {node: '>=10'}
    dependencies:
      aproba: 2.0.0
      color-support: 1.1.3
      console-control-strings: 1.1.0
      has-unicode: 2.0.1
      object-assign: 4.1.1
      signal-exit: 3.0.7
      string-width: 4.2.3
      strip-ansi: 6.0.1
      wide-align: 1.1.5
    dev: false

  /get-caller-file@2.0.5:
    resolution: {integrity: sha512-DyFP3BM/3YHTQOCUL/w0OZHR0lpKeGrxotcHWcqNEdnltqFwXVfhEBQ94eIo34AfQpo0rGki4cyIiftY06h2Fg==}
    engines: {node: 6.* || 8.* || >= 10.*}
    dev: true

  /get-func-name@2.0.2:
    resolution: {integrity: sha512-8vXOvuE167CtIc3OyItco7N/dpRtBbYOsPsXCz7X/PMnlGjYjSGuZJgM1Y7mmew7BKf9BqvLX2tnOVy1BBUsxQ==}
    dev: true

  /get-intrinsic@1.2.4:
    resolution: {integrity: sha512-5uYhsJH8VJBTv7oslg4BznJYhDoRI6waYCxMmCdnTrcCrHA/fCFKoTFz2JKKE0HdDFUF7/oQuhzumXJK7paBRQ==}
    engines: {node: '>= 0.4'}
    dependencies:
      es-errors: 1.3.0
      function-bind: 1.1.2
      has-proto: 1.0.3
      has-symbols: 1.0.3
      hasown: 2.0.2
    dev: true

  /get-port@3.2.0:
    resolution: {integrity: sha512-x5UJKlgeUiNT8nyo/AcnwLnZuZNcSjSw0kogRB+Whd1fjjFq4B1hySFxSFWWSn4mIBzg3sRNUDFYc4g5gjPoLg==}
    engines: {node: '>=4'}
    dev: true

  /get-source@2.0.12:
    resolution: {integrity: sha512-X5+4+iD+HoSeEED+uwrQ07BOQr0kEDFMVqqpBuI+RaZBpBpHCuXxo70bjar6f0b0u/DQJsJ7ssurpP0V60Az+w==}
    dependencies:
      data-uri-to-buffer: 2.0.2
      source-map: 0.6.1
    dev: false

  /get-stream@8.0.1:
    resolution: {integrity: sha512-VaUJspBffn/LMCJVoMvSAdmscJyS1auj5Zulnn5UoYcY531UWmdwhRWkcGKnGU93m5HSXP9LP2usOryrBtQowA==}
    engines: {node: '>=16'}
    dev: true

  /get-symbol-description@1.0.2:
    resolution: {integrity: sha512-g0QYk1dZBxGwk+Ngc+ltRH2IBp2f7zBkBMBJZCDerh6EhlhSR6+9irMCuT/09zD6qkarHUSn529sK/yL4S27mg==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      es-errors: 1.3.0
      get-intrinsic: 1.2.4
    dev: true

  /gitignore-parser@0.0.2:
    resolution: {integrity: sha512-X6mpqUv59uWLGD4n3hZ8Cu8KbF2PMWPSFYmxZjdkpm3yOU7hSUYnzTkZI1mcWqchphvqyuz3/BhgBR4E/JtkCg==}
    engines: {node: '>=0.10.0'}
    dev: true

  /glob-parent@5.1.2:
    resolution: {integrity: sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==}
    engines: {node: '>= 6'}
    dependencies:
      is-glob: 4.0.3

  /glob-parent@6.0.2:
    resolution: {integrity: sha512-XxwI8EOhVQgWp6iDL+3b0r86f4d6AX6zSU55HfB4ydCEuXLXc5FcYeOu+nnGftS4TEju/11rt4KJPTMgbfmv4A==}
    engines: {node: '>=10.13.0'}
    dependencies:
      is-glob: 4.0.3
    dev: true

  /glob-to-regexp@0.4.1:
    resolution: {integrity: sha512-lkX1HJXwyMcprw/5YUZc2s7DrpAiHB21/V+E1rHUrVNokkvB6bqMzT0VfV6/86ZNabt1k14YOIaT7nDvOX3Iiw==}
    dev: false

  /glob@10.3.12:
    resolution: {integrity: sha512-TCNv8vJ+xz4QiqTpfOJA7HvYv+tNIRHKfUWw/q+v2jdgN4ebz+KY9tGx5J4rHP0o84mNP+ApH66HRX8us3Khqg==}
    engines: {node: '>=16 || 14 >=14.17'}
    hasBin: true
    dependencies:
      foreground-child: 3.1.1
      jackspeak: 2.3.6
      minimatch: 9.0.4
      minipass: 7.0.4
      path-scurry: 1.10.2
    dev: true

  /glob@7.2.3:
    resolution: {integrity: sha512-nFR0zLpU2YCaRxwoCJvL6UvCH2JFyFVIvwTLsIf21AuHlMskA1hhTdk+LlYJtOlYt9v6dvszD2BGRqBL+iQK9Q==}
    dependencies:
      fs.realpath: 1.0.0
      inflight: 1.0.6
      inherits: 2.0.4
      minimatch: 3.1.2
      once: 1.4.0
      path-is-absolute: 1.0.1

  /glob@8.1.0:
    resolution: {integrity: sha512-r8hpEjiQEYlF2QU0df3dS+nxxSIreXQS1qRhMJM0Q5NDdR386C7jb7Hwwod8Fgiuex+k0GFjgft18yvxm5XoCQ==}
    engines: {node: '>=12'}
    dependencies:
      fs.realpath: 1.0.0
      inflight: 1.0.6
      inherits: 2.0.4
      minimatch: 5.1.6
      once: 1.4.0

  /globals@13.24.0:
    resolution: {integrity: sha512-AhO5QUcj8llrbG09iWhPU2B204J1xnPeL8kQmVorSsy+Sjj1sk8gIyh6cUocGmH4L0UuhAJy+hJMRA4mgA4mFQ==}
    engines: {node: '>=8'}
    dependencies:
      type-fest: 0.20.2
    dev: true

  /globalthis@1.0.3:
    resolution: {integrity: sha512-sFdI5LyBiNTHjRd7cGPWapiHWMOXKyuBNX/cWJ3NfzrZQVa8GI/8cofCl74AOVqq9W5kNmguTIzJ/1s2gyI9wA==}
    engines: {node: '>= 0.4'}
    dependencies:
      define-properties: 1.2.1
    dev: true

  /globalyzer@0.1.0:
    resolution: {integrity: sha512-40oNTM9UfG6aBmuKxk/giHn5nQ8RVz/SS4Ir6zgzOv9/qC3kKZ9v4etGTcJbEl/NyVQH7FGU7d+X1egr57Md2Q==}

  /globby@11.1.0:
    resolution: {integrity: sha512-jhIXaOzy1sb8IyocaruWSn1TjmnBVs8Ayhcy83rmxNJ8q2uWKCAj3CnJY+KpGSXCueAPc0i05kVvVKtP1t9S3g==}
    engines: {node: '>=10'}
    dependencies:
      array-union: 2.1.0
      dir-glob: 3.0.1
      fast-glob: 3.3.2
      ignore: 5.3.1
      merge2: 1.4.1
      slash: 3.0.0
    dev: true

  /globrex@0.1.2:
    resolution: {integrity: sha512-uHJgbwAMwNFf5mLst7IWLNg14x1CkeqglJb/K3doi4dw6q2IvAAmM/Y81kevy83wP+Sst+nutFTYOGg3d1lsxg==}

  /gopd@1.0.1:
    resolution: {integrity: sha512-d65bNlIadxvpb/A2abVdlqKqV563juRnZ1Wtk6s1sIR8uNsXR70xqIzVqxVf1eTqDunwT2MkczEeaezCKTZhwA==}
    dependencies:
      get-intrinsic: 1.2.4
    dev: true

  /graceful-fs@4.2.11:
    resolution: {integrity: sha512-RbJ5/jmFcNNCcDV5o9eTnBLJ/HszWV0P73bc+Ff4nS/rJj+YaS6IGyiOL0VoBYX+l1Wrl3k63h/KrH+nhJ0XvQ==}

  /grapheme-splitter@1.0.4:
    resolution: {integrity: sha512-bzh50DW9kTPM00T8y4o8vQg89Di9oLJVLW/KaOGIXJWP/iqCN6WKYkbNOF04vFLJhwcpYUh9ydh/+5vpOqV4YQ==}
    dev: true

  /graphemer@1.4.0:
    resolution: {integrity: sha512-EtKwoO6kxCL9WO5xipiHTZlSzBm7WLT627TqC/uVRd0HKmq8NXyebnNYxDoBi7wt8eTWrUrKXCOVaFq9x1kgag==}
    dev: true

  /hard-rejection@2.1.0:
    resolution: {integrity: sha512-VIZB+ibDhx7ObhAe7OVtoEbuP4h/MuOTHJ+J8h/eBXotJYl0fBgR72xDFCKgIh22OJZIOVNxBMWuhAr10r8HdA==}
    engines: {node: '>=6'}
    dev: true

  /has-bigints@1.0.2:
    resolution: {integrity: sha512-tSvCKtBr9lkF0Ex0aQiP9N+OpV4zi2r/Nee5VkRDbaqv35RLYMzbwQfFSZZH0kR+Rd6302UJZ2p/bJCEoR3VoQ==}
    dev: true

  /has-flag@3.0.0:
    resolution: {integrity: sha512-sKJf1+ceQBr4SMkvQnBDNDtf4TXpVhVGateu0t918bl30FnbE2m4vNLX+VWe/dpjlb+HugGYzW7uQXH98HPEYw==}
    engines: {node: '>=4'}
    dev: true

  /has-flag@4.0.0:
    resolution: {integrity: sha512-EykJT/Q1KjTWctppgIAgfSO0tKVuZUjhgMr17kqTumMl6Afv3EISleU7qZUzoXDFTAHTDC4NOoG/ZxU3EvlMPQ==}
    engines: {node: '>=8'}
    dev: true

  /has-property-descriptors@1.0.2:
    resolution: {integrity: sha512-55JNKuIW+vq4Ke1BjOTjM2YctQIvCT7GFzHwmfZPGo5wnrgkid0YQtnAleFSqumZm4az3n2BS+erby5ipJdgrg==}
    dependencies:
      es-define-property: 1.0.0
    dev: true

  /has-proto@1.0.3:
    resolution: {integrity: sha512-SJ1amZAJUiZS+PhsVLf5tGydlaVB8EdFpaSO4gmiUKUOxk8qzn5AIy4ZeJUmh22znIdk/uMAUT2pl3FxzVUH+Q==}
    engines: {node: '>= 0.4'}
    dev: true

  /has-symbols@1.0.3:
    resolution: {integrity: sha512-l3LCuF6MgDNwTDKkdYGEihYjt5pRPbEg46rtlmnSPlUbgmB8LOIrKJbYYFBSbnPaJexMKtiPO8hmeRjRz2Td+A==}
    engines: {node: '>= 0.4'}
    dev: true

  /has-tostringtag@1.0.2:
    resolution: {integrity: sha512-NqADB8VjPFLM2V0VvHUewwwsw0ZWBaIdgo+ieHtK3hasLz4qeCRjYcqfB6AQrBggRKppKF8L52/VqdVsO47Dlw==}
    engines: {node: '>= 0.4'}
    dependencies:
      has-symbols: 1.0.3
    dev: true

  /has-unicode@2.0.1:
    resolution: {integrity: sha512-8Rf9Y83NBReMnx0gFzA8JImQACstCYWUplepDa9xprwwtmgEZUF0h/i5xSA625zB/I37EtrswSST6OXxwaaIJQ==}
    dev: false

  /hasown@2.0.2:
    resolution: {integrity: sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==}
    engines: {node: '>= 0.4'}
    dependencies:
      function-bind: 1.1.2

  /hosted-git-info@2.8.9:
    resolution: {integrity: sha512-mxIDAb9Lsm6DoOJ7xH+5+X4y1LU/4Hi50L9C5sIswK3JzULS4bwk1FvjdBgvYR4bzT4tuUQiC15FE2f5HbLvYw==}
    dev: true

  /html-escaper@2.0.2:
    resolution: {integrity: sha512-H2iMtd0I4Mt5eYiapRdIDjp+XzelXQ0tFE4JS7YFwFevXXMmOp9myNrUvCg0D6ws8iqkRPBfKHgbwig1SmlLfg==}
    dev: true

  /https-proxy-agent@5.0.1:
    resolution: {integrity: sha512-dFcAjpTQFgoLMzC2VwU+C/CbS7uRL0lWmxDITmqm7C+7F0Odmj6s9l6alZc6AELXhrnggM2CeWSXHGOdX2YtwA==}
    engines: {node: '>= 6'}
    dependencies:
      agent-base: 6.0.2
      debug: 4.3.4
    transitivePeerDependencies:
      - supports-color
    dev: false

  /human-id@1.0.2:
    resolution: {integrity: sha512-UNopramDEhHJD+VR+ehk8rOslwSfByxPIZyJRfV739NDhN5LF1fa1MqnzKm2lGTQRjNrjK19Q5fhkgIfjlVUKw==}
    dev: true

  /human-signals@5.0.0:
    resolution: {integrity: sha512-AXcZb6vzzrFAUE61HnN4mpLqd/cSIwNQjtNWR0euPm6y0iqx3G4gOXaIDdtdDwZmhwe82LA6+zinmW4UBWVePQ==}
    engines: {node: '>=16.17.0'}
    dev: true

  /iconv-lite@0.4.24:
    resolution: {integrity: sha512-v3MXnZAcvnywkTUEZomIActle7RXXeedOR31wwl7VlyoXO4Qi9arvSenNQWne1TcRwhCL1HwLI21bEqdpj8/rA==}
    engines: {node: '>=0.10.0'}
    dependencies:
      safer-buffer: 2.1.2
    dev: true

  /ignore-walk@5.0.1:
    resolution: {integrity: sha512-yemi4pMf51WKT7khInJqAvsIGzoqYXblnsz0ql8tM+yi1EKYTY1evX4NAbJrLL/Aanr2HyZeluqU+Oi7MGHokw==}
    engines: {node: ^12.13.0 || ^14.15.0 || >=16.0.0}
    dependencies:
      minimatch: 5.1.6
    dev: true

  /ignore@5.3.1:
    resolution: {integrity: sha512-5Fytz/IraMjqpwfd34ke28PTVMjZjJG2MPn5t7OE4eUCUNf8BAa7b5WUS9/Qvr6mwOQS7Mk6vdsMno5he+T8Xw==}
    engines: {node: '>= 4'}
    dev: true

  /imagetools-core@7.0.0:
    resolution: {integrity: sha512-6fYbD7u4VIOt6fqKrOlbF77JXgUVyUmEJIPlfYVTuR/S2Ig9cX3gukGiLEU0aSetcfE7CYnhLTPtTEu4mLwhCw==}
    engines: {node: '>=18.0.0'}
    dependencies:
      sharp: 0.33.3
    dev: false

  /import-fresh@3.3.0:
    resolution: {integrity: sha512-veYYhQa+D1QBKznvhUHxb8faxlrwUnxseDAbAp457E0wLNio2bOSKnjYDhMj+YiAq61xrMGhQk9iXVk5FzgQMw==}
    engines: {node: '>=6'}
    dependencies:
      parent-module: 1.0.1
      resolve-from: 4.0.0
    dev: true

  /import-meta-resolve@4.0.0:
    resolution: {integrity: sha512-okYUR7ZQPH+efeuMJGlq4f8ubUgO50kByRPyt/Cy1Io4PSRsPjxME+YlVaCOx+NIToW7hCsZNFJyTPFFKepRSA==}
    dev: false

  /imurmurhash@0.1.4:
    resolution: {integrity: sha512-JmXMZ6wuvDmLiHEml9ykzqO6lwFbof0GG4IkcGaENdCRDDmMVnny7s5HsIgHCbaq0w2MyPhDqkhTUgS2LU2PHA==}
    engines: {node: '>=0.8.19'}
    dev: true

  /indent-string@4.0.0:
    resolution: {integrity: sha512-EdDDZu4A2OyIK7Lr/2zG+w5jmbuk1DVBnEwREQvBzspBJkCEbRa8GxU1lghYcaGJCnRWibjDXlq779X1/y5xwg==}
    engines: {node: '>=8'}
    dev: true

  /inflight@1.0.6:
    resolution: {integrity: sha512-k92I/b08q4wvFscXCLvqfsHCrjrF7yiXsQuIVvVE7N82W3+aqpzuUdBbfhWcy/FZR3/4IgflMgKLOsvPDrGCJA==}
    dependencies:
      once: 1.4.0
      wrappy: 1.0.2

  /inherits@2.0.4:
    resolution: {integrity: sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==}

  /internal-slot@1.0.7:
    resolution: {integrity: sha512-NGnrKwXzSms2qUUih/ILZ5JBqNTSa1+ZmP6flaIp6KmSElgE9qdndzS3cqjrDovwFdmwsGsLdeFgB6suw+1e9g==}
    engines: {node: '>= 0.4'}
    dependencies:
      es-errors: 1.3.0
      hasown: 2.0.2
      side-channel: 1.0.6
    dev: true

  /internmap@2.0.3:
    resolution: {integrity: sha512-5Hh7Y1wQbvY5ooGgPbDaL5iYLAPzMTUrjMulskHLH6wnv/A+1q5rgEaiuqEjB+oxGXIVZs1FF+R/KPN3ZSQYYg==}
    engines: {node: '>=12'}
    dev: false

  /is-array-buffer@3.0.4:
    resolution: {integrity: sha512-wcjaerHw0ydZwfhiKbXJWLDY8A7yV7KhjQOpb83hGgGfId/aQa4TOvwyzn2PuswW2gPCYEL/nEAiSVpdOj1lXw==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      get-intrinsic: 1.2.4
    dev: true

  /is-arrayish@0.2.1:
    resolution: {integrity: sha512-zz06S8t0ozoDXMG+ube26zeCTNXcKIPJZJi8hBrF4idCLms4CG9QtK7qBl1boi5ODzFpjswb5JPmHCbMpjaYzg==}
    dev: true

  /is-arrayish@0.3.2:
    resolution: {integrity: sha512-eVRqCvVlZbuw3GrM63ovNSNAeA1K16kaR/LRY/92w0zxQ5/1YzwblUX652i4Xs9RwAGjW9d9y6X88t8OaAJfWQ==}
    dev: false

  /is-bigint@1.0.4:
    resolution: {integrity: sha512-zB9CruMamjym81i2JZ3UMn54PKGsQzsJeo6xvN3HJJ4CAsQNB6iRutp2To77OfCNuoxspsIhzaPoO1zyCEhFOg==}
    dependencies:
      has-bigints: 1.0.2
    dev: true

  /is-binary-path@2.1.0:
    resolution: {integrity: sha512-ZMERYes6pDydyuGidse7OsHxtbI7WVeUEozgR/g7rd0xUimYNlvZRE/K2MgZTjWy725IfelLeVcEM97mmtRGXw==}
    engines: {node: '>=8'}
    dependencies:
      binary-extensions: 2.3.0

  /is-boolean-object@1.1.2:
    resolution: {integrity: sha512-gDYaKHJmnj4aWxyj6YHyXVpdQawtVLHU5cb+eztPGczf6cjuTdwve5ZIEfgXqH4e57An1D1AKf8CZ3kYrQRqYA==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      has-tostringtag: 1.0.2
    dev: true

  /is-builtin-module@3.2.1:
    resolution: {integrity: sha512-BSLE3HnV2syZ0FK0iMA/yUGplUeMmNz4AW5fnTunbCIqZi4vG3WjJT9FHMy5D69xmAYBHXQhJdALdpwVxV501A==}
    engines: {node: '>=6'}
    dependencies:
      builtin-modules: 3.3.0

  /is-callable@1.2.7:
    resolution: {integrity: sha512-1BC0BVFhS/p0qtw6enp8e+8OD0UrK0oFLztSjNzhcKA3WDuJxxAPXzPuPtKkjEY9UUoEWlX/8fgKeu2S8i9JTA==}
    engines: {node: '>= 0.4'}
    dev: true

  /is-core-module@2.13.1:
    resolution: {integrity: sha512-hHrIjvZsftOsvKSn2TRYl63zvxsgE0K+0mYMoH6gD4omR5IWB2KynivBQczo3+wF1cCkjzvptnI9Q0sPU66ilw==}
    dependencies:
      hasown: 2.0.2

  /is-data-view@1.0.1:
    resolution: {integrity: sha512-AHkaJrsUVW6wq6JS8y3JnM/GJF/9cf+k20+iDzlSaJrinEo5+7vRiteOSwBhHRiAyQATN1AmY4hwzxJKPmYf+w==}
    engines: {node: '>= 0.4'}
    dependencies:
      is-typed-array: 1.1.13
    dev: true

  /is-date-object@1.0.5:
    resolution: {integrity: sha512-9YQaSxsAiSwcvS33MBk3wTCVnWK+HhF8VZR2jRxehM16QcVOdHqPn4VPHmRK4lSr38n9JriurInLcP90xsYNfQ==}
    engines: {node: '>= 0.4'}
    dependencies:
      has-tostringtag: 1.0.2
    dev: true

  /is-extglob@2.1.1:
    resolution: {integrity: sha512-SbKbANkN603Vi4jEZv49LeVJMn4yGwsbzZworEoyEiutsN3nJYdbO36zfhGJ6QEDpOZIFkDtnq5JRxmvl3jsoQ==}
    engines: {node: '>=0.10.0'}

  /is-fullwidth-code-point@3.0.0:
    resolution: {integrity: sha512-zymm5+u+sCsSWyD9qNaejV3DFvhCKclKdizYaJUuHA83RLjb7nSuGnddCHGv0hk+KY7BMAlsWeK4Ueg6EV6XQg==}
    engines: {node: '>=8'}

  /is-glob@4.0.3:
    resolution: {integrity: sha512-xelSayHH36ZgE7ZWhli7pW34hNbNl8Ojv5KVmkJD4hBdD3th8Tfk9vYasLM+mXWOZhFkgZfxhLSnrwRr4elSSg==}
    engines: {node: '>=0.10.0'}
    dependencies:
      is-extglob: 2.1.1

  /is-module@1.0.0:
    resolution: {integrity: sha512-51ypPSPCoTEIN9dy5Oy+h4pShgJmPCygKfyRCISBI+JoWT/2oJvK8QPxmwv7b/p239jXrm9M1mlQbyKJ5A152g==}

  /is-negative-zero@2.0.3:
    resolution: {integrity: sha512-5KoIu2Ngpyek75jXodFvnafB6DJgr3u8uuK0LEZJjrU19DrMD3EVERaR8sjz8CCGgpZvxPl9SuE1GMVPFHx1mw==}
    engines: {node: '>= 0.4'}
    dev: true

  /is-number-object@1.0.7:
    resolution: {integrity: sha512-k1U0IRzLMo7ZlYIfzRu23Oh6MiIFasgpb9X76eqfFZAqwH44UI4KTBvBYIZ1dSL9ZzChTB9ShHfLkR4pdW5krQ==}
    engines: {node: '>= 0.4'}
    dependencies:
      has-tostringtag: 1.0.2
    dev: true

  /is-number@7.0.0:
    resolution: {integrity: sha512-41Cifkg6e8TylSpdtTpeLVMqvSBEVzTttHvERD741+pnZ8ANv0004MRL43QKPDlK9cGvNp6NZWZUBlbGXYxxng==}
    engines: {node: '>=0.12.0'}

  /is-path-inside@3.0.3:
    resolution: {integrity: sha512-Fd4gABb+ycGAmKou8eMftCupSir5lRxqf4aD/vd0cD2qc4HL07OjCeuHMr8Ro4CoMaeCKDB0/ECBOVWjTwUvPQ==}
    engines: {node: '>=8'}
    dev: true

  /is-plain-obj@1.1.0:
    resolution: {integrity: sha512-yvkRyxmFKEOQ4pNXCmJG5AEQNlXJS5LaONXo5/cLdTZdWvsZ1ioJEonLGAosKlMWE8lwUy/bJzMjcw8az73+Fg==}
    engines: {node: '>=0.10.0'}
    dev: true

  /is-reference@1.2.1:
    resolution: {integrity: sha512-U82MsXXiFIrjCK4otLT+o2NA2Cd2g5MLoOVXUZjIOhLurrRxpEXzI8O0KZHr3IjLvlAH1kTPYSuqer5T9ZVBKQ==}
    dependencies:
      '@types/estree': 1.0.5

  /is-reference@3.0.2:
    resolution: {integrity: sha512-v3rht/LgVcsdZa3O2Nqs+NMowLOxeOm7Ay9+/ARQ2F+qEoANRcqrjAZKGN0v8ymUetZGgkp26LTnGT7H0Qo9Pg==}
    dependencies:
      '@types/estree': 1.0.5

  /is-regex@1.1.4:
    resolution: {integrity: sha512-kvRdxDsxZjhzUX07ZnLydzS1TU/TJlTUHHY4YLL87e37oUA49DfkLqgy+VjFocowy29cKvcSiu+kIv728jTTVg==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      has-tostringtag: 1.0.2
    dev: true

  /is-shared-array-buffer@1.0.3:
    resolution: {integrity: sha512-nA2hv5XIhLR3uVzDDfCIknerhx8XUKnstuOERPNNIinXG7v9u+ohXF67vxm4TPTEPU6lm61ZkwP3c9PCB97rhg==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
    dev: true

  /is-stream@3.0.0:
    resolution: {integrity: sha512-LnQR4bZ9IADDRSkvpqMGvt/tEJWclzklNgSw48V5EAaAeDd6qGvN8ei6k5p0tvxSR171VmGyHuTiAOfxAbr8kA==}
    engines: {node: ^12.20.0 || ^14.13.1 || >=16.0.0}
    dev: true

  /is-string@1.0.7:
    resolution: {integrity: sha512-tE2UXzivje6ofPW7l23cjDOMa09gb7xlAqG6jG5ej6uPV32TlWP3NKPigtaGeHNu9fohccRYvIiZMfOOnOYUtg==}
    engines: {node: '>= 0.4'}
    dependencies:
      has-tostringtag: 1.0.2
    dev: true

  /is-subdir@1.2.0:
    resolution: {integrity: sha512-2AT6j+gXe/1ueqbW6fLZJiIw3F8iXGJtt0yDrZaBhAZEG1raiTxKWU+IPqMCzQAXOUCKdA4UDMgacKH25XG2Cw==}
    engines: {node: '>=4'}
    dependencies:
      better-path-resolve: 1.0.0
    dev: true

  /is-symbol@1.0.4:
    resolution: {integrity: sha512-C/CPBqKWnvdcxqIARxyOh4v1UUEOCHpgDa0WYgpKDFMszcrPcffg5uhwSgPCLD2WWxmq6isisz87tzT01tuGhg==}
    engines: {node: '>= 0.4'}
    dependencies:
      has-symbols: 1.0.3
    dev: true

  /is-typed-array@1.1.13:
    resolution: {integrity: sha512-uZ25/bUAlUY5fR4OKT4rZQEBrzQWYV9ZJYGGsUmEJ6thodVJ1HX64ePQ6Z0qPWP+m+Uq6e9UugrE38jeYsDSMw==}
    engines: {node: '>= 0.4'}
    dependencies:
      which-typed-array: 1.1.15
    dev: true

  /is-weakref@1.0.2:
    resolution: {integrity: sha512-qctsuLZmIQ0+vSSMfoVvyFe2+GSEvnmZ2ezTup1SBse9+twCCeial6EEi3Nc2KFcf6+qz2FBPnjXsk8xhKSaPQ==}
    dependencies:
      call-bind: 1.0.7
    dev: true

  /is-windows@1.0.2:
    resolution: {integrity: sha512-eXK1UInq2bPmjyX6e3VHIzMLobc4J94i4AWn+Hpq3OU5KkrRC96OAcR3PRJ/pGu6m8TRnBHP9dkXQVsT/COVIA==}
    engines: {node: '>=0.10.0'}
    dev: true

  /isarray@2.0.5:
    resolution: {integrity: sha512-xHjhDr3cNBK0BzdUJSPXZntQUx/mwMS5Rw4A7lPJ90XGAO6ISP/ePDNuo0vhqOZU+UD5JoodwCAAoZQd3FeAKw==}
    dev: true

  /isexe@2.0.0:
    resolution: {integrity: sha512-RHxMLp9lnKHGHRng9QFhRCMbYAcVpn69smSGcq3f36xjgVVWThj4qqLbTLlq7Ssj8B+fIQ1EuCEGI2lKsyQeIw==}
    dev: true

  /istanbul-lib-coverage@3.2.2:
    resolution: {integrity: sha512-O8dpsF+r0WV/8MNRKfnmrtCWhuKjxrq2w+jpzBL5UZKTi2LeVWnWOmWRxFlesJONmc+wLAGvKQZEOanko0LFTg==}
    engines: {node: '>=8'}
    dev: true

  /istanbul-lib-report@3.0.1:
    resolution: {integrity: sha512-GCfE1mtsHGOELCU8e/Z7YWzpmybrx/+dSTfLrvY8qRmaY6zXTKWn6WQIjaAFw069icm6GVMNkgu0NzI4iPZUNw==}
    engines: {node: '>=10'}
    dependencies:
      istanbul-lib-coverage: 3.2.2
      make-dir: 4.0.0
      supports-color: 7.2.0
    dev: true

  /istanbul-reports@3.1.7:
    resolution: {integrity: sha512-BewmUXImeuRk2YY0PVbxgKAysvhRPUQE0h5QRM++nVWyubKGV0l8qQ5op8+B2DOmwSe63Jivj0BjkPQVf8fP5g==}
    engines: {node: '>=8'}
    dependencies:
      html-escaper: 2.0.2
      istanbul-lib-report: 3.0.1
    dev: true

  /jackspeak@2.3.6:
    resolution: {integrity: sha512-N3yCS/NegsOBokc8GAdM8UcmfsKiSS8cipheD/nivzr700H+nsMOxJjQnvwOcRYVuFkdH0wGUvW2WbXGmrZGbQ==}
    engines: {node: '>=14'}
    dependencies:
      '@isaacs/cliui': 8.0.2
    optionalDependencies:
      '@pkgjs/parseargs': 0.11.0
    dev: true

  /js-tokens@4.0.0:
    resolution: {integrity: sha512-RdJUflcE3cUzKiMqQgsCu06FPu9UdIJO0beYbPhHN4k6apgJtifcoCtT9bcxOpYBtpD2kCM6Sbzg4CausW/PKQ==}
    dev: true

  /js-tokens@9.0.0:
    resolution: {integrity: sha512-WriZw1luRMlmV3LGJaR6QOJjWwgLUTf89OwT2lUOyjX2dJGBwgmIkbcz+7WFZjrZM635JOIR517++e/67CP9dQ==}
    dev: true

  /js-yaml@3.14.1:
    resolution: {integrity: sha512-okMH7OXXJ7YrN9Ok3/SXrnu4iX9yOk+25nqX4imS2npuvTYDmo/QEZoqwZkYaIDk3jVvBOTOIEgEhaLOynBS9g==}
    hasBin: true
    dependencies:
      argparse: 1.0.10
      esprima: 4.0.1
    dev: true

  /js-yaml@4.1.0:
    resolution: {integrity: sha512-wpxZs9NoxZaJESJGIZTyDEaYpl0FKSA+FB9aJiyemKhMwkxQg63h4T1KJgUGHpTqPDNRcmmYLugrRjJlBtWvRA==}
    hasBin: true
    dependencies:
      argparse: 2.0.1
    dev: true

  /jsesc@0.5.0:
    resolution: {integrity: sha512-uZz5UnB7u4T9LvwmFqXii7pZSouaRPorGs5who1Ip7VO0wxanFvBL7GkM6dTHlgX+jhBApRetaWpnDabOeTcnA==}
    hasBin: true
    dev: true

  /jsesc@3.0.2:
    resolution: {integrity: sha512-xKqzzWXDttJuOcawBt4KnKHHIf5oQ/Cxax+0PWFG+DFDgHNAdi+TXECADI+RYiFUMmx8792xsMbbgXj4CwnP4g==}
    engines: {node: '>=6'}
    hasBin: true
    dev: true

  /json-buffer@3.0.1:
    resolution: {integrity: sha512-4bV5BfR2mqfQTJm+V5tPPdf+ZpuhiIvTuAB5g8kcrXOZpTT/QwwVRWBywX1ozr6lEuPdbHxwaJlm9G6mI2sfSQ==}
    dev: true

  /json-parse-even-better-errors@2.3.1:
    resolution: {integrity: sha512-xyFwyhro/JEof6Ghe2iz2NcXoj2sloNsWr/XsERDK/oiPCfaNhl5ONfp+jQdAZRQQ0IJWNzH9zIZF7li91kh2w==}
    dev: true

  /json-schema-traverse@0.4.1:
    resolution: {integrity: sha512-xbbCH5dCYU5T8LcEhhuh7HJ88HXuW3qsI3Y0zOZFKfZEHcpWiHU/Jxzk629Brsab/mMiHQti9wMP+845RPe3Vg==}
    dev: true

  /json-stable-stringify-without-jsonify@1.0.1:
    resolution: {integrity: sha512-Bdboy+l7tA3OGW6FjyFHWkP5LuByj1Tk33Ljyq0axyzdk9//JSi2u3fP1QSmd1KNwq6VOKYGlAu87CisVir6Pw==}
    dev: true

  /json5@2.2.3:
    resolution: {integrity: sha512-XmOWe7eyHYH14cLdVPoyg+GOH3rYX++KpzrylJwSW98t3Nk+U8XOl8FWKOgwtzdb8lXGf6zYwDUzeHMWfxasyg==}
    engines: {node: '>=6'}
    hasBin: true
    dev: false

  /jsonc-parser@3.2.1:
    resolution: {integrity: sha512-AilxAyFOAcK5wA1+LeaySVBrHsGQvUFCDWXKpZjzaL0PqW+xfBOttn8GNtWKFWqneyMZj41MWF9Kl6iPWLwgOA==}
    dev: true

  /jsonfile@4.0.0:
    resolution: {integrity: sha512-m6F1R3z8jjlf2imQHS2Qez5sjKWQzbuuhuJ/FKYFRZvPE3PuHcSMVZzfsLhGVOkfd20obL5SWEBew5ShlquNxg==}
    optionalDependencies:
      graceful-fs: 4.2.11
    dev: true

  /keyv@4.5.4:
    resolution: {integrity: sha512-oxVHkHR/EJf2CNXnWxRLW6mg7JyCCUcG0DtEGmL2ctUo1PNTin1PUil+r/+4r5MpVgC/fn1kjsx7mjSujKqIpw==}
    dependencies:
      json-buffer: 3.0.1
    dev: true

  /kind-of@6.0.3:
    resolution: {integrity: sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw==}
    engines: {node: '>=0.10.0'}
    dev: true

  /kleur@3.0.3:
    resolution: {integrity: sha512-eTIzlVOSUR+JxdDFepEYcBMtZ9Qqdef+rnzWdRZuMbOywu5tO2w2N7rqjoANZ5k9vywhL6Br1VRjUIgTQx4E8w==}
    engines: {node: '>=6'}

  /kleur@4.1.5:
    resolution: {integrity: sha512-o+NO+8WrRiQEE4/7nwRJhN1HWpVmJm511pBHUxPLtp0BUISzlBplORYSmTclCnJvQq2tKu/sgl3xVpkc7ZWuQQ==}
    engines: {node: '>=6'}

  /known-css-properties@0.30.0:
    resolution: {integrity: sha512-VSWXYUnsPu9+WYKkfmJyLKtIvaRJi1kXUqVmBACORXZQxT5oZDsoZ2vQP+bQFDnWtpI/4eq3MLoRMjI2fnLzTQ==}
    dev: true

  /levn@0.4.1:
    resolution: {integrity: sha512-+bT2uH4E5LGE7h/n3evcS/sQlJXCpIp6ym8OWJ5eV6+67Dsql/LaaT7qJBAt2rzfoa/5QBGBhxDix1dMt2kQKQ==}
    engines: {node: '>= 0.8.0'}
    dependencies:
      prelude-ls: 1.2.1
      type-check: 0.4.0
    dev: true

  /lightningcss-darwin-arm64@1.24.1:
    resolution: {integrity: sha512-1jQ12jBy+AE/73uGQWGSafK5GoWgmSiIQOGhSEXiFJSZxzV+OXIx+a9h2EYHxdJfX864M+2TAxWPWb0Vv+8y4w==}
    engines: {node: '>= 12.0.0'}
    cpu: [arm64]
    os: [darwin]
    requiresBuild: true
    dev: true
    optional: true

  /lightningcss-darwin-x64@1.24.1:
    resolution: {integrity: sha512-R4R1d7VVdq2mG4igMU+Di8GPf0b64ZLnYVkubYnGG0Qxq1KaXQtAzcLI43EkpnoWvB/kUg8JKCWH4S13NfiLcQ==}
    engines: {node: '>= 12.0.0'}
    cpu: [x64]
    os: [darwin]
    requiresBuild: true
    dev: true
    optional: true

  /lightningcss-freebsd-x64@1.24.1:
    resolution: {integrity: sha512-z6NberUUw5ALES6Ixn2shmjRRrM1cmEn1ZQPiM5IrZ6xHHL5a1lPin9pRv+w6eWfcrEo+qGG6R9XfJrpuY3e4g==}
    engines: {node: '>= 12.0.0'}
    cpu: [x64]
    os: [freebsd]
    requiresBuild: true
    dev: true
    optional: true

  /lightningcss-linux-arm-gnueabihf@1.24.1:
    resolution: {integrity: sha512-NLQLnBQW/0sSg74qLNI8F8QKQXkNg4/ukSTa+XhtkO7v3BnK19TS1MfCbDHt+TTdSgNEBv0tubRuapcKho2EWw==}
    engines: {node: '>= 12.0.0'}
    cpu: [arm]
    os: [linux]
    requiresBuild: true
    dev: true
    optional: true

  /lightningcss-linux-arm64-gnu@1.24.1:
    resolution: {integrity: sha512-AQxWU8c9E9JAjAi4Qw9CvX2tDIPjgzCTrZCSXKELfs4mCwzxRkHh2RCxX8sFK19RyJoJAjA/Kw8+LMNRHS5qEg==}
    engines: {node: '>= 12.0.0'}
    cpu: [arm64]
    os: [linux]
    requiresBuild: true
    dev: true
    optional: true

  /lightningcss-linux-arm64-musl@1.24.1:
    resolution: {integrity: sha512-JCgH/SrNrhqsguUA0uJUM1PvN5+dVuzPIlXcoWDHSv2OU/BWlj2dUYr3XNzEw748SmNZPfl2NjQrAdzaPOn1lA==}
    engines: {node: '>= 12.0.0'}
    cpu: [arm64]
    os: [linux]
    requiresBuild: true
    dev: true
    optional: true

  /lightningcss-linux-x64-gnu@1.24.1:
    resolution: {integrity: sha512-TYdEsC63bHV0h47aNRGN3RiK7aIeco3/keN4NkoSQ5T8xk09KHuBdySltWAvKLgT8JvR+ayzq8ZHnL1wKWY0rw==}
    engines: {node: '>= 12.0.0'}
    cpu: [x64]
    os: [linux]
    requiresBuild: true
    dev: true
    optional: true

  /lightningcss-linux-x64-musl@1.24.1:
    resolution: {integrity: sha512-HLfzVik3RToot6pQ2Rgc3JhfZkGi01hFetHt40HrUMoeKitLoqUUT5owM6yTZPTytTUW9ukLBJ1pc3XNMSvlLw==}
    engines: {node: '>= 12.0.0'}
    cpu: [x64]
    os: [linux]
    requiresBuild: true
    dev: true
    optional: true

  /lightningcss-win32-x64-msvc@1.24.1:
    resolution: {integrity: sha512-joEupPjYJ7PjZtDsS5lzALtlAudAbgIBMGJPNeFe5HfdmJXFd13ECmEM+5rXNxYVMRHua2w8132R6ab5Z6K9Ow==}
    engines: {node: '>= 12.0.0'}
    cpu: [x64]
    os: [win32]
    requiresBuild: true
    dev: true
    optional: true

  /lightningcss@1.24.1:
    resolution: {integrity: sha512-kUpHOLiH5GB0ERSv4pxqlL0RYKnOXtgGtVe7shDGfhS0AZ4D1ouKFYAcLcZhql8aMspDNzaUCumGHZ78tb2fTg==}
    engines: {node: '>= 12.0.0'}
    dependencies:
      detect-libc: 1.0.3
    optionalDependencies:
      lightningcss-darwin-arm64: 1.24.1
      lightningcss-darwin-x64: 1.24.1
      lightningcss-freebsd-x64: 1.24.1
      lightningcss-linux-arm-gnueabihf: 1.24.1
      lightningcss-linux-arm64-gnu: 1.24.1
      lightningcss-linux-arm64-musl: 1.24.1
      lightningcss-linux-x64-gnu: 1.24.1
      lightningcss-linux-x64-musl: 1.24.1
      lightningcss-win32-x64-msvc: 1.24.1
    dev: true

  /lilconfig@2.1.0:
    resolution: {integrity: sha512-utWOt/GHzuUxnLKxB6dk81RoOeoNeHgbrXiuGk4yyF5qlRz+iIVWu56E2fqGHFrXz0QNUhLB/8nKqvRH66JKGQ==}
    engines: {node: '>=10'}
    dev: true

  /lines-and-columns@1.2.4:
    resolution: {integrity: sha512-7ylylesZQ/PV29jhEDl3Ufjo6ZX7gCqJr5F7PKrqc93v7fzSymt1BpwEU8nAUXs8qzzvqhbjhK5QZg6Mt/HkBg==}
    dev: true

  /load-yaml-file@0.2.0:
    resolution: {integrity: sha512-OfCBkGEw4nN6JLtgRidPX6QxjBQGQf72q3si2uvqyFEMbycSFFHwAZeXx6cJgFM9wmLrf9zBwCP3Ivqa+LLZPw==}
    engines: {node: '>=6'}
    dependencies:
      graceful-fs: 4.2.11
      js-yaml: 3.14.1
      pify: 4.0.1
      strip-bom: 3.0.0
    dev: true

  /local-access@1.1.0:
    resolution: {integrity: sha512-XfegD5pyTAfb+GY6chk283Ox5z8WexG56OvM06RWLpAc/UHozO8X6xAxEkIitZOtsSMM1Yr3DkHgW5W+onLhCw==}
    engines: {node: '>=6'}
    dev: true

  /local-pkg@0.5.0:
    resolution: {integrity: sha512-ok6z3qlYyCDS4ZEU27HaU6x/xZa9Whf8jD4ptH5UZTQYZVYeb9bnZ3ojVhiJNLiXK1Hfc0GNbLXcmZ5plLDDBg==}
    engines: {node: '>=14'}
    dependencies:
      mlly: 1.6.1
      pkg-types: 1.0.3
    dev: true

  /locate-character@3.0.0:
    resolution: {integrity: sha512-SW13ws7BjaeJ6p7Q6CO2nchbYEc3X3J6WrmTTDto7yMPqVSZTUyY5Tjbid+Ab8gLnATtygYtiDIJGQRRn2ZOiA==}

  /locate-path@5.0.0:
    resolution: {integrity: sha512-t7hw9pI+WvuwNJXwk5zVHpyhIqzg2qTlklJOf0mVxGSbe3Fp2VieZcduNYjaLDoy6p9uGpQEGWG87WpMKlNq8g==}
    engines: {node: '>=8'}
    dependencies:
      p-locate: 4.1.0
    dev: true

  /locate-path@6.0.0:
    resolution: {integrity: sha512-iPZK6eYjbxRu3uB4/WZ3EsEIMJFMqAoopl3R+zuq0UjcAm/MO6KCweDgPfP3elTztoKP3KtnVHxTn2NHBSDVUw==}
    engines: {node: '>=10'}
    dependencies:
      p-locate: 5.0.0
    dev: true

  /lodash.merge@4.6.2:
    resolution: {integrity: sha512-0KpjqXRVvrYyCsX1swR/XTK0va6VQkQM6MNo7PqW77ByjAhoARA8EfrP1N4+KlKj8YS0ZUCtRT/YUuhyYDujIQ==}
    dev: true

  /lodash.startcase@4.4.0:
    resolution: {integrity: sha512-+WKqsK294HMSc2jEbNgpHpd0JfIBhp7rEV4aqXWqFr6AlXov+SlcgB1Fv01y2kGe3Gc8nMW7VA0SrGuSkRfIEg==}
    dev: true

  /loupe@2.3.7:
    resolution: {integrity: sha512-zSMINGVYkdpYSOBmLi0D1Uo7JU9nVdQKrHxC8eYlV+9YKK9WePqAlL7lSlorG/U2Fw1w0hTBmaa/jrQ3UbPHtA==}
    dependencies:
      get-func-name: 2.0.2
    dev: true

  /lower-case@2.0.2:
    resolution: {integrity: sha512-7fm3l3NAF9WfN6W3JOmf5drwpVqX78JtoGJ3A6W0a6ZnldM41w2fV5D490psKFTpMds8TJse/eHLFFsNHHjHgg==}
    dependencies:
      tslib: 2.6.2
    dev: false

  /lru-cache@10.2.0:
    resolution: {integrity: sha512-2bIM8x+VAf6JT4bKAljS1qUWgMsqZRPGJS6FSahIMPVvctcNhyVp7AJu7quxOW9jwkryBReKZY5tY5JYv2n/7Q==}
    engines: {node: 14 || >=16.14}
    dev: true

  /lru-cache@4.1.5:
    resolution: {integrity: sha512-sWZlbEP2OsHNkXrMl5GYk/jKk70MBng6UU4YI/qGDYbgf6YbP4EvmqISbXCoJiRKs+1bSpFHVgQxvJ17F2li5g==}
    dependencies:
      pseudomap: 1.0.2
      yallist: 2.1.2
    dev: true

  /lru-cache@6.0.0:
    resolution: {integrity: sha512-Jo6dJ04CmSjuznwJSS3pUeWmd/H0ffTlkXXgwZi+eq1UCmqQwCh+eLsYOYCwY991i2Fah4h1BEMCx4qThGbsiA==}
    engines: {node: '>=10'}
    dependencies:
      yallist: 4.0.0

  /lz-string@1.5.0:
    resolution: {integrity: sha512-h5bgJWpxJNswbU7qCrV0tIKQCaS3blPDrqKWx+QxzuzL1zGUzij9XCWLrSLsJPu5t+eWA/ycetzYAO5IOMcWAQ==}
    hasBin: true
    dev: true

  /magic-string@0.25.9:
    resolution: {integrity: sha512-RmF0AsMzgt25qzqqLc1+MbHmhdx0ojF2Fvs4XnOqz2ZOBXzzkEwc/dJQZCYHAn7v1jbVOjAZfK8msRn4BxO4VQ==}
    dependencies:
      sourcemap-codec: 1.4.8
    dev: false

  /magic-string@0.30.9:
    resolution: {integrity: sha512-S1+hd+dIrC8EZqKyT9DstTH/0Z+f76kmmvZnkfQVmOpDEF9iVgdYif3Q/pIWHmCoo59bQVGW0kVL3e2nl+9+Sw==}
    engines: {node: '>=12'}
    dependencies:
      '@jridgewell/sourcemap-codec': 1.4.15

  /make-dir@3.1.0:
    resolution: {integrity: sha512-g3FeP20LNwhALb/6Cz6Dd4F2ngze0jz7tbzrD2wAV+o9FeNHe4rL+yK2md0J/fiSf1sa1ADhXqi5+oVwOM/eGw==}
    engines: {node: '>=8'}
    dependencies:
      semver: 6.3.1
    dev: false

  /make-dir@4.0.0:
    resolution: {integrity: sha512-hXdUTZYIVOt1Ex//jAQi+wTZZpUpwBj/0QsOzqegb3rGMMeJiSEu5xLHnYfBrRV4RH2+OCSOO95Is/7x1WJ4bw==}
    engines: {node: '>=10'}
    dependencies:
      semver: 7.6.0
    dev: true

  /map-obj@1.0.1:
    resolution: {integrity: sha512-7N/q3lyZ+LVCp7PzuxrJr4KMbBE2hW7BT7YNia330OFxIf4d3r5zVpicP2650l7CPN6RM9zOJRl3NGpqSiw3Eg==}
    engines: {node: '>=0.10.0'}
    dev: true

  /map-obj@4.3.0:
    resolution: {integrity: sha512-hdN1wVrZbb29eBGiGjJbeP8JbKjq1urkHJ/LIP/NY48MZ1QVXUsQBV1G1zvYFHn1XE06cwjBsOI2K3Ulnj1YXQ==}
    engines: {node: '>=8'}
    dev: true

  /marked@12.0.1:
    resolution: {integrity: sha512-Y1/V2yafOcOdWQCX0XpAKXzDakPOpn6U0YLxTJs3cww6VxOzZV1BTOOYWLvH3gX38cq+iLwljHHTnMtlDfg01Q==}
    engines: {node: '>= 18'}
    hasBin: true
    dev: true

  /mdn-data@2.0.30:
    resolution: {integrity: sha512-GaqWWShW4kv/G9IEucWScBx9G1/vsFZZJUO+tD26M8J8z3Kw5RDQjaoZe03YAClgeS/SWPOcb4nkFBTEi5DUEA==}

  /meow@6.1.1:
    resolution: {integrity: sha512-3YffViIt2QWgTy6Pale5QpopX/IvU3LPL03jOTqp6pGj3VjesdO/U8CuHMKpnQr4shCNCM5fd5XFFvIIl6JBHg==}
    engines: {node: '>=8'}
    dependencies:
      '@types/minimist': 1.2.5
      camelcase-keys: 6.2.2
      decamelize-keys: 1.1.1
      hard-rejection: 2.1.0
      minimist-options: 4.1.0
      normalize-package-data: 2.5.0
      read-pkg-up: 7.0.1
      redent: 3.0.0
      trim-newlines: 3.0.1
      type-fest: 0.13.1
      yargs-parser: 18.1.3
    dev: true

  /merge-stream@2.0.0:
    resolution: {integrity: sha512-abv/qOcuPfk3URPfDzmZU1LKmuw8kT+0nIHvKrKgFrwifol/doWcdA4ZqsWQ8ENrFKkd67Mfpo/LovbIUsbt3w==}
    dev: true

  /merge2@1.4.1:
    resolution: {integrity: sha512-8q7VEgMJW4J8tcfVPy8g09NcQwZdbwFEqhe/WZkoIzjn/3TGDwtOCYtXGxA3O8tPzpczCCDgv+P2P5y00ZJOOg==}
    engines: {node: '>= 8'}

  /micromatch@4.0.5:
    resolution: {integrity: sha512-DMy+ERcEW2q8Z2Po+WNXuw3c5YaUSFjAO5GsJqfEl7UjvtIuFKO6ZrKvcItdy98dwFI2N1tg3zNIdKaQT+aNdA==}
    engines: {node: '>=8.6'}
    dependencies:
      braces: 3.0.2
      picomatch: 2.3.1

  /mime@3.0.0:
    resolution: {integrity: sha512-jSCU7/VB1loIWBZe14aEYHU/+1UMEHoaO7qxCOVJOw9GgH72VAWppxNcjU+x9a2k3GSIBXNKxXQFqRvvZ7vr3A==}
    engines: {node: '>=10.0.0'}
    hasBin: true

  /mimic-fn@4.0.0:
    resolution: {integrity: sha512-vqiC06CuhBTUdZH+RYl8sFrL096vA45Ok5ISO6sE/Mr1jRbGH4Csnhi8f3wKVl7x8mO4Au7Ir9D3Oyv1VYMFJw==}
    engines: {node: '>=12'}
    dev: true

  /min-indent@1.0.1:
    resolution: {integrity: sha512-I9jwMn07Sy/IwOj3zVkVik2JTvgpaykDZEigL6Rx6N9LbMywwUSMtxET+7lVoDLLd3O3IXwJwvuuns8UB/HeAg==}
    engines: {node: '>=4'}
    dev: true

  /miniflare@3.20240405.1:
    resolution: {integrity: sha512-oShOR/ckr9JTO1bkPQH0nXvuSgJjoE+E5+M1tvP01Q8Z+Q0GJnzU2+FDYUH8yIK/atHv7snU8yy0X6KWVn1YdQ==}
    engines: {node: '>=16.13'}
    hasBin: true
    dependencies:
      '@cspotcode/source-map-support': 0.8.1
      acorn: 8.11.3
      acorn-walk: 8.3.2
      capnp-ts: 0.7.0
      exit-hook: 2.2.1
      glob-to-regexp: 0.4.1
      stoppable: 1.1.0
      undici: 5.28.4
      workerd: 1.20240405.0
      ws: 8.16.0
      youch: 3.3.3
      zod: 3.22.4
    transitivePeerDependencies:
      - bufferutil
      - supports-color
      - utf-8-validate
    dev: false

  /minimatch@3.1.2:
    resolution: {integrity: sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==}
    dependencies:
      brace-expansion: 1.1.11

  /minimatch@5.1.6:
    resolution: {integrity: sha512-lKwV/1brpG6mBUFHtb7NUmtABCb2WZZmm2wNiOA5hAb8VdCS4B3dtMWyvcoViccwAW/COERjXLt0zP1zXUN26g==}
    engines: {node: '>=10'}
    dependencies:
      brace-expansion: 2.0.1

  /minimatch@9.0.4:
    resolution: {integrity: sha512-KqWh+VchfxcMNRAJjj2tnsSJdNbHsVgnkBhTNrW7AjVo6OvLtxw8zfT9oLw1JSohlFzJ8jCoTgaoXvJ+kHt6fw==}
    engines: {node: '>=16 || 14 >=14.17'}
    dependencies:
      brace-expansion: 2.0.1

  /minimist-options@4.1.0:
    resolution: {integrity: sha512-Q4r8ghd80yhO/0j1O3B2BjweX3fiHg9cdOwjJd2J76Q135c+NDxGCqdYKQ1SKBuFfgWbAUzBfvYjPUEeNgqN1A==}
    engines: {node: '>= 6'}
    dependencies:
      arrify: 1.0.1
      is-plain-obj: 1.1.0
      kind-of: 6.0.3
    dev: true

  /minimist@1.2.8:
    resolution: {integrity: sha512-2yyAR8qBkN3YuheJanUpWC5U3bb5osDywNB8RzDVlDwDHbocAJveqqj1u8+SVD7jkWT4yvsHCpWqqWqAxb0zCA==}
    dev: true

  /minipass@3.3.6:
    resolution: {integrity: sha512-DxiNidxSEK+tHG6zOIklvNOwm3hvCrbUrdtzY74U6HKTJxvIDfOUL5W5P2Ghd3DTkhhKPYGqeNUIh5qcM4YBfw==}
    engines: {node: '>=8'}
    dependencies:
      yallist: 4.0.0
    dev: false

  /minipass@5.0.0:
    resolution: {integrity: sha512-3FnjYuehv9k6ovOEbyOswadCDPX1piCfhV8ncmYtHOjuPwylVWsghTLo7rabjC3Rx5xD4HDx8Wm1xnMF7S5qFQ==}
    engines: {node: '>=8'}
    dev: false

  /minipass@7.0.4:
    resolution: {integrity: sha512-jYofLM5Dam9279rdkWzqHozUo4ybjdZmCsDHePy5V/PbBcVMiSZR97gmAy45aqi8CK1lG2ECd356FU86avfwUQ==}
    engines: {node: '>=16 || 14 >=14.17'}
    dev: true

  /minizlib@2.1.2:
    resolution: {integrity: sha512-bAxsR8BVfj60DWXHE3u30oHzfl4G7khkSuPW+qvpd7jFRHm7dLxOjUk1EHACJ/hxLY8phGJ0YhYHZo7jil7Qdg==}
    engines: {node: '>= 8'}
    dependencies:
      minipass: 3.3.6
      yallist: 4.0.0
    dev: false

  /mixme@0.5.10:
    resolution: {integrity: sha512-5H76ANWinB1H3twpJ6JY8uvAtpmFvHNArpilJAjXRKXSDDLPIMoZArw5SH0q9z+lLs8IrMw7Q2VWpWimFKFT1Q==}
    engines: {node: '>= 8.0.0'}
    dev: true

  /mkdirp@0.5.6:
    resolution: {integrity: sha512-FP+p8RB8OWpF3YZBCrP5gtADmtXApB5AMLn+vdyA+PyxCjrCs00mjyUozssO33cwDeT3wNGdLxJ5M//YqtHAJw==}
    hasBin: true
    dependencies:
      minimist: 1.2.8
    dev: true

  /mkdirp@1.0.4:
    resolution: {integrity: sha512-vVqVZQyf3WLx2Shd0qJ9xuvqgAyKPLAiqITEtqW0oIUjzo3PePDd6fW9iFz30ef7Ysp/oiWqbhszeGWW2T6Gzw==}
    engines: {node: '>=10'}
    hasBin: true
    dev: false

  /mkdirp@3.0.1:
    resolution: {integrity: sha512-+NsyUUAZDmo6YVHzL/stxSu3t9YS1iljliy3BSDrXJ/dkn1KYdmtZODGGjLcc9XLgVVpH4KshHB8XmZgMhaBXg==}
    engines: {node: '>=10'}
    hasBin: true
    dev: false

  /mlly@1.6.1:
    resolution: {integrity: sha512-vLgaHvaeunuOXHSmEbZ9izxPx3USsk8KCQ8iC+aTlp5sKRSoZvwhHh5L9VbKSaVC6sJDqbyohIS76E2VmHIPAA==}
    dependencies:
      acorn: 8.11.3
      pathe: 1.1.2
      pkg-types: 1.0.3
      ufo: 1.5.3
    dev: true

  /mri@1.2.0:
    resolution: {integrity: sha512-tzzskb3bG8LvYGFF/mDTpq3jpI6Q9wc3LEmBaghu+DdCssd1FakN7Bc0hVNmEyGq1bq3RgfkCb3cmQLpNPOroA==}
    engines: {node: '>=4'}

  /mrmime@2.0.0:
    resolution: {integrity: sha512-eu38+hdgojoyq63s+yTpN4XMBdt5l8HhMhc4VKLO9KM5caLIBvUm4thi7fFaxyTmCKeNnXZ5pAlBwCUnhA09uw==}
    engines: {node: '>=10'}

  /ms@2.1.2:
    resolution: {integrity: sha512-sGkPx+VjMtmA6MX27oA4FBFELFCZZ4S4XqeGOXCv68tT+jb3vk/RyaKWP0PTKyWtmLSM0b+adUTEvbs1PEaH2w==}

  /mustache@4.2.0:
    resolution: {integrity: sha512-71ippSywq5Yb7/tVYyGbkBggbU8H3u5Rz56fH60jGFgr8uHwxs+aSKeqmluIVzM0m0kB7xQjKS6qPfd0b2ZoqQ==}
    hasBin: true
    dev: false

  /mz@2.7.0:
    resolution: {integrity: sha512-z81GNO7nnYMEhrGh9LeymoE4+Yr0Wn5McHIZMK5cfQCl+NDX08sCZgUc9/6MHni9IWuFLm1Z3HTCXu2z9fN62Q==}
    dependencies:
      any-promise: 1.3.0
      object-assign: 4.1.1
      thenify-all: 1.6.0
    dev: true

  /nanoid@3.3.7:
    resolution: {integrity: sha512-eSRppjcPIatRIMC1U6UngP8XFcz8MQWGQdt1MTBQ7NaAmvXDfvNxbvWV3x2y6CdEUciCSsDHDQZbhYaB8QEo2g==}
    engines: {node: ^10 || ^12 || ^13.7 || ^14 || >=15.0.1}
    hasBin: true

  /natural-compare@1.4.0:
    resolution: {integrity: sha512-OWND8ei3VtNC9h7V60qff3SVobHr996CTwgxubgyQYEpg290h9J0buyECNNJexkFm5sOajh5G116RYA1c8ZMSw==}
    dev: true

  /no-case@3.0.4:
    resolution: {integrity: sha512-fgAN3jGAh+RoxUGZHTSOLJIqUc2wmoBwGR4tbpNAKmmovFoWq0OdRkb0VkldReO2a2iBT/OEulG9XSUc10r3zg==}
    dependencies:
      lower-case: 2.0.2
      tslib: 2.6.2
    dev: false

  /node-fetch@2.7.0:
    resolution: {integrity: sha512-c4FRfUm/dbcWZ7U+1Wq0AwCyFL+3nt2bEw05wfxSz+DWpWsitgmSgYmy2dQdWyKC1694ELPqMs/YzUSNozLt8A==}
    engines: {node: 4.x || >=6.0.0}
    peerDependencies:
      encoding: ^0.1.0
    peerDependenciesMeta:
      encoding:
        optional: true
    dependencies:
      whatwg-url: 5.0.0

  /node-forge@1.3.1:
    resolution: {integrity: sha512-dPEtOeMvF9VMcYV/1Wb8CPoVAXtp6MKMlcbAt4ddqmGqUJ6fQZFXkNZNkNlfevtNkGtaSoXf/vNNNSvgrdXwtA==}
    engines: {node: '>= 6.13.0'}
    dev: false

  /node-gyp-build@4.8.0:
    resolution: {integrity: sha512-u6fs2AEUljNho3EYTJNBfImO5QTo/J/1Etd+NVdCj7qWKUSN/bSLkZwhDv7I+w/MSC6qJ4cknepkAYykDdK8og==}
    hasBin: true
    dev: false

  /node-releases@2.0.14:
    resolution: {integrity: sha512-y10wOWt8yZpqXmOgRo77WaHEmhYQYGNA6y421PKsKYWEK8aW+cqAphborZDhqfyKrbZEN92CN1X2KbafY2s7Yw==}
    dev: true

  /nopt@5.0.0:
    resolution: {integrity: sha512-Tbj67rffqceeLpcRXrT7vKAN8CwfPeIBgM7E6iBkmKLV7bEMwpGgYLGv0jACUsECaa/vuxP0IjEont6umdMgtQ==}
    engines: {node: '>=6'}
    hasBin: true
    dependencies:
      abbrev: 1.1.1
    dev: false

  /normalize-package-data@2.5.0:
    resolution: {integrity: sha512-/5CMN3T0R4XTj4DcGaexo+roZSdSFW/0AOOTROrjxzCG1wrWXEsGbRKevjlIL+ZDE4sZlJr5ED4YW0yqmkK+eA==}
    dependencies:
      hosted-git-info: 2.8.9
      resolve: 1.22.8
      semver: 5.7.2
      validate-npm-package-license: 3.0.4
    dev: true

  /normalize-path@3.0.0:
    resolution: {integrity: sha512-6eZs5Ls3WtCisHWp9S2GUy8dqkpGi4BVSz3GaqiE6ezub0512ESztXUwUB6C6IKbQkY2Pnb/mD4WYojCRwcwLA==}
    engines: {node: '>=0.10.0'}

  /npm-bundled@2.0.1:
    resolution: {integrity: sha512-gZLxXdjEzE/+mOstGDqR6b0EkhJ+kM6fxM6vUuckuctuVPh80Q6pw/rSZj9s4Gex9GxWtIicO1pc8DB9KZWudw==}
    engines: {node: ^12.13.0 || ^14.15.0 || >=16.0.0}
    dependencies:
      npm-normalize-package-bin: 2.0.0
    dev: true

  /npm-normalize-package-bin@2.0.0:
    resolution: {integrity: sha512-awzfKUO7v0FscrSpRoogyNm0sajikhBWpU0QMrW09AMi9n1PoKU6WaIqUzuJSQnpciZZmJ/jMZ2Egfmb/9LiWQ==}
    engines: {node: ^12.13.0 || ^14.15.0 || >=16.0.0}
    dev: true

  /npm-packlist@5.1.3:
    resolution: {integrity: sha512-263/0NGrn32YFYi4J533qzrQ/krmmrWwhKkzwTuM4f/07ug51odoaNjUexxO4vxlzURHcmYMH1QjvHjsNDKLVg==}
    engines: {node: ^12.13.0 || ^14.15.0 || >=16.0.0}
    hasBin: true
    dependencies:
      glob: 8.1.0
      ignore-walk: 5.0.1
      npm-bundled: 2.0.1
      npm-normalize-package-bin: 2.0.0
    dev: true

  /npm-run-path@5.3.0:
    resolution: {integrity: sha512-ppwTtiJZq0O/ai0z7yfudtBpWIoxM8yE6nHi1X47eFR2EWORqfbu6CnPlNsjeN683eT0qG6H/Pyf9fCcvjnnnQ==}
    engines: {node: ^12.20.0 || ^14.13.1 || >=16.0.0}
    dependencies:
      path-key: 4.0.0
    dev: true

  /npmlog@5.0.1:
    resolution: {integrity: sha512-AqZtDUWOMKs1G/8lwylVjrdYgqA4d9nu8hc+0gzRxlDb1I10+FHBGMXs6aiQHFdCUUlqH99MUMuLfzWDNDtfxw==}
    dependencies:
      are-we-there-yet: 2.0.0
      console-control-strings: 1.1.0
      gauge: 3.0.2
      set-blocking: 2.0.0
    dev: false

  /object-assign@4.1.1:
    resolution: {integrity: sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==}
    engines: {node: '>=0.10.0'}

  /object-inspect@1.13.1:
    resolution: {integrity: sha512-5qoj1RUiKOMsCCNLV1CBiPYE10sziTsnmNxkAI/rZhiD63CF7IqdFGC/XzjWjpSgLf0LxXX3bDFIh0E18f6UhQ==}
    dev: true

  /object-keys@1.1.1:
    resolution: {integrity: sha512-NuAESUOUMrlIXOfHKzD6bpPu3tYt3xvjNdRIQ+FeT0lNb4K8WR70CaDxhuNguS2XG+GjkyMwOzsN5ZktImfhLA==}
    engines: {node: '>= 0.4'}
    dev: true

  /object.assign@4.1.5:
    resolution: {integrity: sha512-byy+U7gp+FVwmyzKPYhW2h5l3crpmGsxl7X2s8y43IgxvG4g3QZ6CffDtsNQy1WsmZpQbO+ybo0AlW7TY6DcBQ==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      define-properties: 1.2.1
      has-symbols: 1.0.3
      object-keys: 1.1.1
    dev: true

  /once@1.4.0:
    resolution: {integrity: sha512-lNaJgI+2Q5URQBkccEKHTQOPaXdUxnZZElQTZY0MFUAuaEqe1E+Nyvgdz/aIyNi6Z9MzO5dv1H8n58/GELp3+w==}
    dependencies:
      wrappy: 1.0.2

  /onetime@6.0.0:
    resolution: {integrity: sha512-1FlR+gjXK7X+AsAHso35MnyN5KqGwJRi/31ft6x0M194ht7S+rWAvd7PHss9xSKMzE0asv1pyIHaJYq+BbacAQ==}
    engines: {node: '>=12'}
    dependencies:
      mimic-fn: 4.0.0
    dev: true

  /optionator@0.9.3:
    resolution: {integrity: sha512-JjCoypp+jKn1ttEFExxhetCKeJt9zhAgAve5FXHixTvFDW/5aEktX9bufBKLRRMdU7bNtpLfcGu94B3cdEJgjg==}
    engines: {node: '>= 0.8.0'}
    dependencies:
      '@aashutoshrathi/word-wrap': 1.2.6
      deep-is: 0.1.4
      fast-levenshtein: 2.0.6
      levn: 0.4.1
      prelude-ls: 1.2.1
      type-check: 0.4.0
    dev: true

  /os-tmpdir@1.0.2:
    resolution: {integrity: sha512-D2FR03Vir7FIu45XBY20mTb+/ZSWB00sjU9jdQXt83gDrI4Ztz5Fs7/yy74g2N5SVQY4xY1qDr4rNddwYRVX0g==}
    engines: {node: '>=0.10.0'}
    dev: true

  /outdent@0.5.0:
    resolution: {integrity: sha512-/jHxFIzoMXdqPzTaCpFzAAWhpkSjZPF4Vsn6jAfNpmbH/ymsmd7Qc6VE9BGn0L6YMj6uwpQLxCECpus4ukKS9Q==}
    dev: true

  /p-filter@2.1.0:
    resolution: {integrity: sha512-ZBxxZ5sL2HghephhpGAQdoskxplTwr7ICaehZwLIlfL6acuVgZPm8yBNuRAFBGEqtD/hmUeq9eqLg2ys9Xr/yw==}
    engines: {node: '>=8'}
    dependencies:
      p-map: 2.1.0
    dev: true

  /p-limit@2.3.0:
    resolution: {integrity: sha512-//88mFWSJx8lxCzwdAABTJL2MyWB12+eIY7MDL2SqLmAkeKU9qxRvWuSyTjm3FUmpBEMuFfckAIqEaVGUDxb6w==}
    engines: {node: '>=6'}
    dependencies:
      p-try: 2.2.0
    dev: true

  /p-limit@3.1.0:
    resolution: {integrity: sha512-TYOanM3wGwNGsZN2cVTYPArw454xnXj5qmWF1bEoAc4+cU/ol7GVh7odevjp1FNHduHc3KZMcFduxU5Xc6uJRQ==}
    engines: {node: '>=10'}
    dependencies:
      yocto-queue: 0.1.0
    dev: true

  /p-limit@5.0.0:
    resolution: {integrity: sha512-/Eaoq+QyLSiXQ4lyYV23f14mZRQcXnxfHrN0vCai+ak9G0pp9iEQukIIZq5NccEvwRB8PUnZT0KsOoDCINS1qQ==}
    engines: {node: '>=18'}
    dependencies:
      yocto-queue: 1.0.0
    dev: true

  /p-locate@4.1.0:
    resolution: {integrity: sha512-R79ZZ/0wAxKGu3oYMlz8jy/kbhsNrS7SKZ7PxEHBgJ5+F2mtFW2fK2cOtBh1cHYkQsbzFV7I+EoRKe6Yt0oK7A==}
    engines: {node: '>=8'}
    dependencies:
      p-limit: 2.3.0
    dev: true

  /p-locate@5.0.0:
    resolution: {integrity: sha512-LaNjtRWUBY++zB5nE/NwcaoMylSPk+S+ZHNB1TzdbMJMny6dynpAGt7X/tl/QYq3TIeE6nxHppbo2LGymrG5Pw==}
    engines: {node: '>=10'}
    dependencies:
      p-limit: 3.1.0
    dev: true

  /p-map@2.1.0:
    resolution: {integrity: sha512-y3b8Kpd8OAN444hxfBbFfj1FY/RjtTd8tzYwhUqNYXx0fXx2iX4maP4Qr6qhIKbQXI02wTLAda4fYUbDagTUFw==}
    engines: {node: '>=6'}
    dev: true

  /p-try@2.2.0:
    resolution: {integrity: sha512-R4nPAVTAU0B9D35/Gk3uJf/7XYbQcyohSKdvAxIRSNghFl4e71hVoGnBNQz9cWaXxO2I10KTC+3jMdvvoKw6dQ==}
    engines: {node: '>=6'}
    dev: true

  /parent-module@1.0.1:
    resolution: {integrity: sha512-GQ2EWRpQV8/o+Aw8YqtfZZPfNRWZYkbidE9k5rpl/hC3vtHHBfGm2Ifi6qWV+coDGkrUKZAxE3Lot5kcsRlh+g==}
    engines: {node: '>=6'}
    dependencies:
      callsites: 3.1.0
    dev: true

  /parse-json@5.2.0:
    resolution: {integrity: sha512-ayCKvm/phCGxOkYRSCM82iDwct8/EonSEgCSxWxD7ve6jHggsFl4fZVQBPRNgQoKiuV/odhFrGzQXZwbifC8Rg==}
    engines: {node: '>=8'}
    dependencies:
      '@babel/code-frame': 7.24.2
      error-ex: 1.3.2
      json-parse-even-better-errors: 2.3.1
      lines-and-columns: 1.2.4
    dev: true

  /pascal-case@3.1.2:
    resolution: {integrity: sha512-uWlGT3YSnK9x3BQJaOdcZwrnV6hPpd8jFH1/ucpiLRPh/2zCVJKS19E4GvYHvaCcACn3foXZ0cLB9Wrx1KGe5g==}
    dependencies:
      no-case: 3.0.4
      tslib: 2.6.2
    dev: false

  /path-browserify@1.0.1:
    resolution: {integrity: sha512-b7uo2UCUOYZcnF/3ID0lulOJi/bafxa1xPe7ZPsammBSpjSWQkjNxlt635YGS2MiR9GjvuXCtz2emr3jbsz98g==}
    dev: false

  /path-exists@4.0.0:
    resolution: {integrity: sha512-ak9Qy5Q7jYb2Wwcey5Fpvg2KoAc/ZIhLSLOSBmRmygPsGwkVVt0fZa0qrtMz+m6tJTAHfZQ8FnmB4MG4LWy7/w==}
    engines: {node: '>=8'}
    dev: true

  /path-is-absolute@1.0.1:
    resolution: {integrity: sha512-AVbw3UJ2e9bq64vSaS9Am0fje1Pa8pbGqTTsmXfaIiMpnr5DlDhfJOuLj9Sf95ZPVDAUerDfEk88MPmPe7UCQg==}
    engines: {node: '>=0.10.0'}

  /path-key@3.1.1:
    resolution: {integrity: sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==}
    engines: {node: '>=8'}
    dev: true

  /path-key@4.0.0:
    resolution: {integrity: sha512-haREypq7xkM7ErfgIyA0z+Bj4AGKlMSdlQE2jvJo6huWD1EdkKYV+G/T4nq0YEF2vgTT8kqMFKo1uHn950r4SQ==}
    engines: {node: '>=12'}
    dev: true

  /path-parse@1.0.7:
    resolution: {integrity: sha512-LDJzPVEEEPR+y48z93A0Ed0yXb8pAByGWo/k5YYdYgpY2/2EsOsksJrq7lOHxryrVOn1ejG6oAp8ahvOIQD8sw==}

  /path-scurry@1.10.2:
    resolution: {integrity: sha512-7xTavNy5RQXnsjANvVvMkEjvloOinkAjv/Z6Ildz9v2RinZ4SBKTWFOVRbaF8p0vpHnyjV/UwNDdKuUv6M5qcA==}
    engines: {node: '>=16 || 14 >=14.17'}
    dependencies:
      lru-cache: 10.2.0
      minipass: 7.0.4
    dev: true

  /path-to-regexp@6.2.2:
    resolution: {integrity: sha512-GQX3SSMokngb36+whdpRXE+3f9V8UzyAorlYvOGx87ufGHehNTn5lCxrKtLyZ4Yl/wEKnNnr98ZzOwwDZV5ogw==}
    dev: false

  /path-type@4.0.0:
    resolution: {integrity: sha512-gDKb8aZMDeD/tZWs9P6+q0J9Mwkdl6xMV8TjnGP3qJVJ06bdMgkbBlLU8IdfOsIsFz2BW1rNVT3XuNEl8zPAvw==}
    engines: {node: '>=8'}
    dev: true

  /pathe@1.1.2:
    resolution: {integrity: sha512-whLdWMYL2TwI08hn8/ZqAbrVemu0LNaNNJZX73O6qaIdCTfXutsLhMkjdENX0qhsQ9uIimo4/aQOmXkoon2nDQ==}
    dev: true

  /pathval@1.1.1:
    resolution: {integrity: sha512-Dp6zGqpTdETdR63lehJYPeIOqpiNBNtc7BpWSLrOje7UaIsE5aY92r/AunQA7rsXvet3lrJ3JnZX29UPTKXyKQ==}
    dev: true

  /periscopic@3.1.0:
    resolution: {integrity: sha512-vKiQ8RRtkl9P+r/+oefh25C3fhybptkHKCZSPlcXiJux2tJF55GnEj3BVn4A5gKfq9NWWXXrxkHBwVPUfH0opw==}
    dependencies:
      '@types/estree': 1.0.5
      estree-walker: 3.0.3
      is-reference: 3.0.2

  /picocolors@1.0.0:
    resolution: {integrity: sha512-1fygroTLlHu66zi26VoTDv8yRgm0Fccecssto+MhsZ0D/DGW2sm8E8AjW7NU5VVTRt5GxbeZ5qBuJr+HyLYkjQ==}

  /picomatch@2.3.1:
    resolution: {integrity: sha512-JU3teHTNjmE2VCGFzuY8EXzCDVwEqB2a8fsIvwaStHhAWJEeVd1o1QD80CU6+ZdEXXSLbSsuLwJjkCBWqRQUVA==}
    engines: {node: '>=8.6'}

  /pify@4.0.1:
    resolution: {integrity: sha512-uB80kBFb/tfd68bVleG9T5GGsGPjJrLAUpR5PZIrhBnIaRTQRjqdJSsIKkOP6OAIFbj7GOrcudc5pNjZ+geV2g==}
    engines: {node: '>=6'}
    dev: true

  /pirates@4.0.6:
    resolution: {integrity: sha512-saLsH7WeYYPiD25LDuLRRY/i+6HaPYr6G1OUlN39otzkSTxKnubR9RTxS3/Kk50s1g2JTgFwWQDQyplC5/SHZg==}
    engines: {node: '>= 6'}
    dev: true

  /pkg-dir@4.2.0:
    resolution: {integrity: sha512-HRDzbaKjC+AOWVXxAU/x54COGeIv9eb+6CkDSQoNTt4XyWoIJvuPsXizxu/Fr23EiekbtZwmh1IcIG/l/a10GQ==}
    engines: {node: '>=8'}
    dependencies:
      find-up: 4.1.0
    dev: true

  /pkg-types@1.0.3:
    resolution: {integrity: sha512-nN7pYi0AQqJnoLPC9eHFQ8AcyaixBUOwvqc5TDnIKCMEE6I0y8P7OKA7fPexsXGCGxQDl/cmrLAp26LhcwxZ4A==}
    dependencies:
      jsonc-parser: 3.2.1
      mlly: 1.6.1
      pathe: 1.1.2
    dev: true

  /playwright-core@1.43.1:
    resolution: {integrity: sha512-EI36Mto2Vrx6VF7rm708qSnesVQKbxEWvPrfA1IPY6HgczBplDx7ENtx+K2n4kJ41sLLkuGfmb0ZLSSXlDhqPg==}
    engines: {node: '>=16'}
    hasBin: true
    dev: true

  /playwright@1.43.1:
    resolution: {integrity: sha512-V7SoH0ai2kNt1Md9E3Gwas5B9m8KR2GVvwZnAI6Pg0m3sh7UvgiYhRrhsziCmqMJNouPckiOhk8T+9bSAK0VIA==}
    engines: {node: '>=16'}
    hasBin: true
    dependencies:
      playwright-core: 1.43.1
    optionalDependencies:
      fsevents: 2.3.2
    dev: true

  /pluralize@8.0.0:
    resolution: {integrity: sha512-Nc3IT5yHzflTfbjgqWcCPpo7DaKy4FnpB0l/zCAW0Tc7jxAiuqSxHasntB3D7887LSrA93kDJ9IXovxJYxyLCA==}
    engines: {node: '>=4'}
    dev: true

  /polka@1.0.0-next.25:
    resolution: {integrity: sha512-LBgDEGL73aeb/5yAwO9JWsqCuqPdvEdwA/n25Y38F4kv6jqFaLbgIWVuZfsv9Sc9O052eoWWrAjGB75oCQvELw==}
    engines: {node: '>=8'}
    dependencies:
      '@polka/url': 1.0.0-next.25
      trouter: 4.0.0
    dev: true

  /possible-typed-array-names@1.0.0:
    resolution: {integrity: sha512-d7Uw+eZoloe0EHDIYoe+bQ5WXnGMOpmiZFTuMWCwpjzzkL2nTjcKiAk4hh8TjnGye2TwWOk3UXucZ+3rbmBa8Q==}
    engines: {node: '>= 0.4'}
    dev: true

  /postcss-load-config@3.1.4(postcss@8.4.38):
    resolution: {integrity: sha512-6DiM4E7v4coTE4uzA8U//WhtPwyhiim3eyjEMFCnUpzbrkK9wJHgKDT2mR+HbtSrd/NubVaYTOpSpjUl8NQeRg==}
    engines: {node: '>= 10'}
    peerDependencies:
      postcss: '>=8.0.9'
      ts-node: '>=9.0.0'
    peerDependenciesMeta:
      postcss:
        optional: true
      ts-node:
        optional: true
    dependencies:
      lilconfig: 2.1.0
      postcss: 8.4.38
      yaml: 1.10.2
    dev: true

  /postcss-safe-parser@6.0.0(postcss@8.4.38):
    resolution: {integrity: sha512-FARHN8pwH+WiS2OPCxJI8FuRJpTVnn6ZNFiqAM2aeW2LwTHWWmWgIyKC6cUo0L8aeKiF/14MNvnpls6R2PBeMQ==}
    engines: {node: '>=12.0'}
    peerDependencies:
      postcss: ^8.3.3
    dependencies:
      postcss: 8.4.38
    dev: true

  /postcss-scss@4.0.9(postcss@8.4.38):
    resolution: {integrity: sha512-AjKOeiwAitL/MXxQW2DliT28EKukvvbEWx3LBmJIRN8KfBGZbRTxNYW0kSqi1COiTZ57nZ9NW06S6ux//N1c9A==}
    engines: {node: '>=12.0'}
    peerDependencies:
      postcss: ^8.4.29
    dependencies:
      postcss: 8.4.38
    dev: true

  /postcss-selector-parser@6.0.16:
    resolution: {integrity: sha512-A0RVJrX+IUkVZbW3ClroRWurercFhieevHB38sr2+l9eUClMqome3LmEmnhlNy+5Mr2EYN6B2Kaw9wYdd+VHiw==}
    engines: {node: '>=4'}
    dependencies:
      cssesc: 3.0.0
      util-deprecate: 1.0.2
    dev: true

  /postcss@8.4.38:
    resolution: {integrity: sha512-Wglpdk03BSfXkHoQa3b/oulrotAkwrlLDRSOb9D0bN86FdRyE9lppSp33aHNPgBa0JKCoB+drFLZkQoRRYae5A==}
    engines: {node: ^10 || ^12 || >=14}
    dependencies:
      nanoid: 3.3.7
      picocolors: 1.0.0
      source-map-js: 1.2.0
    dev: true

  /preferred-pm@3.1.3:
    resolution: {integrity: sha512-MkXsENfftWSRpzCzImcp4FRsCc3y1opwB73CfCNWyzMqArju2CrlMHlqB7VexKiPEOjGMbttv1r9fSCn5S610w==}
    engines: {node: '>=10'}
    dependencies:
      find-up: 5.0.0
      find-yarn-workspace-root2: 1.2.16
      path-exists: 4.0.0
      which-pm: 2.0.0
    dev: true

  /prelude-ls@1.2.1:
    resolution: {integrity: sha512-vkcDPrRZo1QZLbn5RLGPpg/WmIQ65qoWWhcGKf/b5eplkkarX0m9z8ppCat4mlOqUsWpyNuYgO3VRyrYHSzX5g==}
    engines: {node: '>= 0.8.0'}
    dev: true

  /prettier-plugin-svelte@3.1.2(prettier@3.2.5)(svelte@4.2.14):
    resolution: {integrity: sha512-7xfMZtwgAWHMT0iZc8jN4o65zgbAQ3+O32V6W7pXrqNvKnHnkoyQCGCbKeUyXKZLbYE0YhFRnamfxfkEGxm8qA==}
    peerDependencies:
      prettier: ^3.0.0
      svelte: ^3.2.0 || ^4.0.0-next.0 || ^5.0.0-next.0
    dependencies:
      prettier: 3.2.5
      svelte: 4.2.14
    dev: true

  /prettier@2.8.8:
    resolution: {integrity: sha512-tdN8qQGvNjw4CHbY+XXk0JgCXn9QiF21a55rBe5LJAU+kDyC4WQn4+awm2Xfk2lQMk5fKup9XgzTZtGkjBdP9Q==}
    engines: {node: '>=10.13.0'}
    hasBin: true
    dev: true

  /prettier@3.2.5:
    resolution: {integrity: sha512-3/GWa9aOC0YeD7LUfvOG2NiDyhOWRvt1k+rcKhOuYnMY24iiCphgneUfJDyFXd6rZCAnuLBv6UeAULtrhT/F4A==}
    engines: {node: '>=14'}
    hasBin: true
    dev: true

  /pretty-format@29.7.0:
    resolution: {integrity: sha512-Pdlw/oPxN+aXdmM9R00JVC9WVFoCLTKJvDVLgmJ+qAffBMxsV85l/Lu7sNx4zSzPyoL2euImuEwHhOXdEgNFZQ==}
    engines: {node: ^14.15.0 || ^16.10.0 || >=18.0.0}
    dependencies:
      '@jest/schemas': 29.6.3
      ansi-styles: 5.2.0
      react-is: 18.2.0
    dev: true

  /printable-characters@1.0.42:
    resolution: {integrity: sha512-dKp+C4iXWK4vVYZmYSd0KBH5F/h1HoZRsbJ82AVKRO3PEo8L4lBS/vLwhVtpwwuYcoIsVY+1JYKR268yn480uQ==}
    dev: false

  /prism-svelte@0.5.0:
    resolution: {integrity: sha512-db91Bf3pRGKDPz1lAqLFSJXeW13mulUJxhycysFpfXV5MIK7RgWWK2E5aPAa71s8TCzQUXxF5JOV42/iOs6QkA==}
    dev: true

  /prismjs@1.29.0:
    resolution: {integrity: sha512-Kx/1w86q/epKcmte75LNrEoT+lX8pBpavuAbvJWRXar7Hz8jrtF+e3vY751p0R8H9HdArwaCTNDDzHg/ScJK1Q==}
    engines: {node: '>=6'}
    dev: true

  /prompts@2.4.2:
    resolution: {integrity: sha512-NxNv/kLguCA7p3jE8oL2aEBsrJWgAakBpgmgK6lpPWV+WuOmY6r2/zbAVnP+T8bQlA0nzHXSJSJW0Hq7ylaD2Q==}
    engines: {node: '>= 6'}
    dependencies:
      kleur: 3.0.3
      sisteransi: 1.0.5
    dev: false

  /pseudomap@1.0.2:
    resolution: {integrity: sha512-b/YwNhb8lk1Zz2+bXXpS/LK9OisiZZ1SNsSLxN1x2OXVEhW2Ckr/7mWE5vrC1ZTiJlD9g19jWszTmJsB+oEpFQ==}
    dev: true

  /publint@0.2.7:
    resolution: {integrity: sha512-tLU4ee3110BxWfAmCZggJmCUnYWgPTr0QLnx08sqpLYa8JHRiOudd+CgzdpfU5x5eOaW2WMkpmOrFshRFYK7Mw==}
    engines: {node: '>=16'}
    hasBin: true
    dependencies:
      npm-packlist: 5.1.3
      picocolors: 1.0.0
      sade: 1.8.1
    dev: true

  /punycode@2.3.1:
    resolution: {integrity: sha512-vYt7UD1U9Wg6138shLtLOvdAu+8DsC/ilFtEVHcH+wydcSpNE20AfSOduf6MkRFahL5FY7X1oU7nKVZFtfq8Fg==}
    engines: {node: '>=6'}
    dev: true

  /queue-microtask@1.2.3:
    resolution: {integrity: sha512-NuaNSa6flKT5JaSYQzJok04JzTL1CA6aGhv5rfLW3PgqA+M2ChpZQnAC8h8i4ZFkBS8X5RqkDBHA7r4hej3K9A==}

  /quick-lru@4.0.1:
    resolution: {integrity: sha512-ARhCpm70fzdcvNQfPoy49IaanKkTlRWF2JMzqhcJbhSFRZv7nPTvZJdcY7301IPmvW+/p0RgIWnQDLJxifsQ7g==}
    engines: {node: '>=8'}
    dev: true

  /react-is@18.2.0:
    resolution: {integrity: sha512-xWGDIW6x921xtzPkhiULtthJHoJvBbF3q26fzloPCK0hsvxtPVelvftw3zjbHWSkR2km9Z+4uxbDDK/6Zw9B8w==}
    dev: true

  /read-pkg-up@7.0.1:
    resolution: {integrity: sha512-zK0TB7Xd6JpCLmlLmufqykGE+/TlOePD6qKClNW7hHDKFh/J7/7gCWGR7joEQEW1bKq3a3yUZSObOoWLFQ4ohg==}
    engines: {node: '>=8'}
    dependencies:
      find-up: 4.1.0
      read-pkg: 5.2.0
      type-fest: 0.8.1
    dev: true

  /read-pkg@5.2.0:
    resolution: {integrity: sha512-Ug69mNOpfvKDAc2Q8DRpMjjzdtrnv9HcSMX+4VsZxD1aZ6ZzrIE7rlzXBtWTyhULSMKg076AW6WR5iZpD0JiOg==}
    engines: {node: '>=8'}
    dependencies:
      '@types/normalize-package-data': 2.4.4
      normalize-package-data: 2.5.0
      parse-json: 5.2.0
      type-fest: 0.6.0
    dev: true

  /read-yaml-file@1.1.0:
    resolution: {integrity: sha512-VIMnQi/Z4HT2Fxuwg5KrY174U1VdUIASQVWXXyqtNRtxSr9IYkn1rsI6Tb6HsrHCmB7gVpNwX6JxPTHcH6IoTA==}
    engines: {node: '>=6'}
    dependencies:
      graceful-fs: 4.2.11
      js-yaml: 3.14.1
      pify: 4.0.1
      strip-bom: 3.0.0
    dev: true

  /readable-stream@3.6.2:
    resolution: {integrity: sha512-9u/sniCrY3D5WdsERHzHE4G2YCXqoG5FTHUiCC4SIbr6XcLZBY05ya9EKjYek9O5xOAwjGq+1JdGBAS7Q9ScoA==}
    engines: {node: '>= 6'}
    dependencies:
      inherits: 2.0.4
      string_decoder: 1.3.0
      util-deprecate: 1.0.2
    dev: false

  /readdirp@3.6.0:
    resolution: {integrity: sha512-hOS089on8RduqdbhvQ5Z37A0ESjsqz6qnRcffsMU3495FuTdqSm+7bhJ29JvIOsBDEEnan5DPu9t3To9VRlMzA==}
    engines: {node: '>=8.10.0'}
    dependencies:
      picomatch: 2.3.1

  /redent@3.0.0:
    resolution: {integrity: sha512-6tDA8g98We0zd0GvVeMT9arEOnTw9qM03L9cJXaCjrip1OO764RDBLBfrB4cwzNGDj5OA5ioymC9GkizgWJDUg==}
    engines: {node: '>=8'}
    dependencies:
      indent-string: 4.0.0
      strip-indent: 3.0.0
    dev: true

  /regenerator-runtime@0.14.1:
    resolution: {integrity: sha512-dYnhHh0nJoMfnkZs6GmmhFknAGRrLznOu5nc9ML+EJxGvrx6H7teuevqVqCuPcPK//3eDrrjQhehXVx9cnkGdw==}
    dev: true

  /regexp-tree@0.1.27:
    resolution: {integrity: sha512-iETxpjK6YoRWJG5o6hXLwvjYAoW+FEZn9os0PD/b6AP6xQwsa/Y7lCVgIixBbUPMfhu+i2LtdeAqVTgGlQarfA==}
    hasBin: true
    dev: true

  /regexp.prototype.flags@1.5.2:
    resolution: {integrity: sha512-NcDiDkTLuPR+++OCKB0nWafEmhg/Da8aUPLPMQbK+bxKKCm1/S5he+AqYa4PlMCVBalb4/yxIRub6qkEx5yJbw==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      define-properties: 1.2.1
      es-errors: 1.3.0
      set-function-name: 2.0.2
    dev: true

  /regexparam@3.0.0:
    resolution: {integrity: sha512-RSYAtP31mvYLkAHrOlh25pCNQ5hWnT106VukGaaFfuJrZFkGRX5GhUAdPqpSDXxOhA2c4akmRuplv1mRqnBn6Q==}
    engines: {node: '>=8'}

  /regjsparser@0.10.0:
    resolution: {integrity: sha512-qx+xQGZVsy55CH0a1hiVwHmqjLryfh7wQyF5HO07XJ9f7dQMY/gPQHhlyDkIzJKC+x2fUCpCcUODUUUFrm7SHA==}
    hasBin: true
    dependencies:
      jsesc: 0.5.0
    dev: true

  /require-directory@2.1.1:
    resolution: {integrity: sha512-fGxEI7+wsG9xrvdjsrlmL22OMTTiHRwAMroiEeMgq8gzoLC/PQr7RsRDSTLUg/bZAZtF+TVIkHc6/4RIKrui+Q==}
    engines: {node: '>=0.10.0'}
    dev: true

  /require-main-filename@2.0.0:
    resolution: {integrity: sha512-NKN5kMDylKuldxYLSUfrbo5Tuzh4hd+2E8NPPX02mZtn1VuREQToYe/ZdlJy+J3uCpfaiGF05e7B8W0iXbQHmg==}
    dev: true

  /resolve-from@4.0.0:
    resolution: {integrity: sha512-pb/MYmXstAkysRFx8piNI1tGFNQIFA3vkE3Gq4EuA1dF6gHp/+vgZqsCGJapvy8N3Q+4o7FwvquPJcnZ7RYy4g==}
    engines: {node: '>=4'}
    dev: true

  /resolve-from@5.0.0:
    resolution: {integrity: sha512-qYg9KP24dD5qka9J47d0aVky0N+b4fTU89LN9iDnjB5waksiC49rvMB0PrUJQGoTmH50XPiqOvAjDfaijGxYZw==}
    engines: {node: '>=8'}

  /resolve.exports@2.0.2:
    resolution: {integrity: sha512-X2UW6Nw3n/aMgDVy+0rSqgHlv39WZAlZrXCdnbyEiKm17DSqHX4MmQMaST3FbeWR5FTuRcUwYAziZajji0Y7mg==}
    engines: {node: '>=10'}
    dev: false

  /resolve@1.22.8:
    resolution: {integrity: sha512-oKWePCxqpd6FlLvGV1VU0x7bkPmmCNolxzjMf4NczoDnQcIWrAF+cPtZn5i6n+RfD2d9i0tzpKnG6Yk168yIyw==}
    hasBin: true
    dependencies:
      is-core-module: 2.13.1
      path-parse: 1.0.7
      supports-preserve-symlinks-flag: 1.0.0

  /reusify@1.0.4:
    resolution: {integrity: sha512-U9nH88a3fc/ekCF1l0/UP1IosiuIjyTh7hBvXVMHYgVcfGvt897Xguj2UOLDeI5BG2m7/uwyaLVT6fbtCwTyzw==}
    engines: {iojs: '>=1.0.0', node: '>=0.10.0'}

  /rimraf@2.7.1:
    resolution: {integrity: sha512-uWjbaKIK3T1OSVptzX7Nl6PvQ3qAGtKEtVRjRuazjfL3Bx5eI409VZSqgND+4UNnmzLVdPj9FqFJNPqBZFve4w==}
    hasBin: true
    dependencies:
      glob: 7.2.3
    dev: true

  /rimraf@3.0.2:
    resolution: {integrity: sha512-JZkJMZkAGFFPP2YqXZXPbMlMBgsxzE8ILs4lMIX/2o0L9UBw9O/Y3o6wFw/i9YLapcUJWwqbi3kdxIPdC62TIA==}
    hasBin: true
    dependencies:
      glob: 7.2.3

  /rollup-plugin-inject@3.0.2:
    resolution: {integrity: sha512-ptg9PQwzs3orn4jkgXJ74bfs5vYz1NCZlSQMBUA0wKcGp5i5pA1AO3fOUEte8enhGUC+iapTCzEWw2jEFFUO/w==}
    deprecated: This package has been deprecated and is no longer maintained. Please use @rollup/plugin-inject.
    dependencies:
      estree-walker: 0.6.1
      magic-string: 0.25.9
      rollup-pluginutils: 2.8.2
    dev: false

  /rollup-plugin-node-polyfills@0.2.1:
    resolution: {integrity: sha512-4kCrKPTJ6sK4/gLL/U5QzVT8cxJcofO0OU74tnB19F40cmuAKSzH5/siithxlofFEjwvw1YAhPmbvGNA6jEroA==}
    dependencies:
      rollup-plugin-inject: 3.0.2
    dev: false

  /rollup-pluginutils@2.8.2:
    resolution: {integrity: sha512-EEp9NhnUkwY8aif6bxgovPHMoMoNr2FulJziTndpt5H9RdwC47GSGuII9XxpSdzVGM0GWrNPHV6ie1LTNJPaLQ==}
    dependencies:
      estree-walker: 0.6.1
    dev: false

  /rollup@4.14.2:
    resolution: {integrity: sha512-WkeoTWvuBoFjFAhsEOHKRoZ3r9GfTyhh7Vff1zwebEFLEFjT1lG3784xEgKiTa7E+e70vsC81roVL2MP4tgEEQ==}
    engines: {node: '>=18.0.0', npm: '>=8.0.0'}
    hasBin: true
    dependencies:
      '@types/estree': 1.0.5
    optionalDependencies:
      '@rollup/rollup-android-arm-eabi': 4.14.2
      '@rollup/rollup-android-arm64': 4.14.2
      '@rollup/rollup-darwin-arm64': 4.14.2
      '@rollup/rollup-darwin-x64': 4.14.2
      '@rollup/rollup-linux-arm-gnueabihf': 4.14.2
      '@rollup/rollup-linux-arm64-gnu': 4.14.2
      '@rollup/rollup-linux-arm64-musl': 4.14.2
      '@rollup/rollup-linux-powerpc64le-gnu': 4.14.2
      '@rollup/rollup-linux-riscv64-gnu': 4.14.2
      '@rollup/rollup-linux-s390x-gnu': 4.14.2
      '@rollup/rollup-linux-x64-gnu': 4.14.2
      '@rollup/rollup-linux-x64-musl': 4.14.2
      '@rollup/rollup-win32-arm64-msvc': 4.14.2
      '@rollup/rollup-win32-ia32-msvc': 4.14.2
      '@rollup/rollup-win32-x64-msvc': 4.14.2
      fsevents: 2.3.3

  /run-parallel@1.2.0:
    resolution: {integrity: sha512-5l4VyZR86LZ/lDxZTR6jqL8AFE2S0IFLMP26AbjsLVADxHdhB/c0GUsH+y39UfCi3dzz8OlQuPmnaJOMoDHQBA==}
    dependencies:
      queue-microtask: 1.2.3

  /sade@1.8.1:
    resolution: {integrity: sha512-xal3CZX1Xlo/k4ApwCFrHVACi9fBqJ7V+mwhBsuf/1IOKbBy098Fex+Wa/5QMubw09pSZ/u8EY8PWgevJsXp1A==}
    engines: {node: '>=6'}
    dependencies:
      mri: 1.2.0

  /safe-array-concat@1.1.2:
    resolution: {integrity: sha512-vj6RsCsWBCf19jIeHEfkRMw8DPiBb+DMXklQ/1SGDHOMlHdPUkZXFQ2YdplS23zESTijAcurb1aSgJA3AgMu1Q==}
    engines: {node: '>=0.4'}
    dependencies:
      call-bind: 1.0.7
      get-intrinsic: 1.2.4
      has-symbols: 1.0.3
      isarray: 2.0.5
    dev: true

  /safe-buffer@5.2.1:
    resolution: {integrity: sha512-rp3So07KcdmmKbGvgaNxQSJr7bGVSVk5S9Eq1F+ppbRo70+YeaDxkw5Dd8NPN+GD6bjnYm2VuPuCXmpuYvmCXQ==}
    dev: false

  /safe-regex-test@1.0.3:
    resolution: {integrity: sha512-CdASjNJPvRa7roO6Ra/gLYBTzYzzPyyBXxIMdGW3USQLyjWEls2RgW5UBTXaQVp+OrpeCK3bLem8smtmheoRuw==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      es-errors: 1.3.0
      is-regex: 1.1.4
    dev: true

  /safe-stable-stringify@2.4.3:
    resolution: {integrity: sha512-e2bDA2WJT0wxseVd4lsDP4+3ONX6HpMXQa1ZhFQ7SU+GjvORCmShbCMltrtIDfkYhVHrOcPtj+KhmDBdPdZD1g==}
    engines: {node: '>=10'}
    dev: false

  /safer-buffer@2.1.2:
    resolution: {integrity: sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==}
    dev: true

  /sander@0.5.1:
    resolution: {integrity: sha512-3lVqBir7WuKDHGrKRDn/1Ye3kwpXaDOMsiRP1wd6wpZW56gJhsbp5RqQpA6JG/P+pkXizygnr1dKR8vzWaVsfA==}
    dependencies:
      es6-promise: 3.3.1
      graceful-fs: 4.2.11
      mkdirp: 0.5.6
      rimraf: 2.7.1
    dev: true

  /selfsigned@2.4.1:
    resolution: {integrity: sha512-th5B4L2U+eGLq1TVh7zNRGBapioSORUeymIydxgFpwww9d2qyKvtuPU2jJuHvYAwwqi2Y596QBL3eEqcPEYL8Q==}
    engines: {node: '>=10'}
    dependencies:
      '@types/node-forge': 1.3.11
      node-forge: 1.3.1
    dev: false

  /semiver@1.1.0:
    resolution: {integrity: sha512-QNI2ChmuioGC1/xjyYwyZYADILWyW6AmS1UH6gDj/SFUUUS4MBAWs/7mxnkRPc/F4iHezDP+O8t0dO8WHiEOdg==}
    engines: {node: '>=6'}
    dev: true

  /semver@5.7.2:
    resolution: {integrity: sha512-cBznnQ9KjJqU67B52RMC65CMarK2600WFnbkcaiwWq3xy/5haFJlshgnpjovMVJ+Hff49d8GEn0b87C5pDQ10g==}
    hasBin: true
    dev: true

  /semver@6.3.1:
    resolution: {integrity: sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==}
    hasBin: true
    dev: false

  /semver@7.6.0:
    resolution: {integrity: sha512-EnwXhrlwXMk9gKu5/flx5sv/an57AkRplG3hTK68W7FRDN+k+OWBj65M7719OkA82XLBxrcX0KSHj+X5COhOVg==}
    engines: {node: '>=10'}
    hasBin: true
    dependencies:
      lru-cache: 6.0.0

  /set-blocking@2.0.0:
    resolution: {integrity: sha512-KiKBS8AnWGEyLzofFfmvKwpdPzqiy16LvQfK3yv/fVH7Bj13/wl3JSR1J+rfgRE9q7xUJK4qvgS8raSOeLUehw==}

  /set-cookie-parser@2.6.0:
    resolution: {integrity: sha512-RVnVQxTXuerk653XfuliOxBP81Sf0+qfQE73LIYKcyMYHG94AuH0kgrQpRDuTZnSmjpysHmzxJXKNfa6PjFhyQ==}
    dev: false

  /set-function-length@1.2.2:
    resolution: {integrity: sha512-pgRc4hJ4/sNjWCSS9AmnS40x3bNMDTknHgL5UaMBTMyJnU90EgWh1Rz+MC9eFu4BuN/UwZjKQuY/1v3rM7HMfg==}
    engines: {node: '>= 0.4'}
    dependencies:
      define-data-property: 1.1.4
      es-errors: 1.3.0
      function-bind: 1.1.2
      get-intrinsic: 1.2.4
      gopd: 1.0.1
      has-property-descriptors: 1.0.2
    dev: true

  /set-function-name@2.0.2:
    resolution: {integrity: sha512-7PGFlmtwsEADb0WYyvCMa1t+yke6daIG4Wirafur5kcf+MhUnPms1UeR0CKQdTZD81yESwMHbtn+TR+dMviakQ==}
    engines: {node: '>= 0.4'}
    dependencies:
      define-data-property: 1.1.4
      es-errors: 1.3.0
      functions-have-names: 1.2.3
      has-property-descriptors: 1.0.2
    dev: true

  /sharp@0.33.3:
    resolution: {integrity: sha512-vHUeXJU1UvlO/BNwTpT0x/r53WkLUVxrmb5JTgW92fdFCFk0ispLMAeu/jPO2vjkXM1fYUi3K7/qcLF47pwM1A==}
    engines: {libvips: '>=8.15.2', node: ^18.17.0 || ^20.3.0 || >=21.0.0}
    requiresBuild: true
    dependencies:
      color: 4.2.3
      detect-libc: 2.0.3
      semver: 7.6.0
    optionalDependencies:
      '@img/sharp-darwin-arm64': 0.33.3
      '@img/sharp-darwin-x64': 0.33.3
      '@img/sharp-libvips-darwin-arm64': 1.0.2
      '@img/sharp-libvips-darwin-x64': 1.0.2
      '@img/sharp-libvips-linux-arm': 1.0.2
      '@img/sharp-libvips-linux-arm64': 1.0.2
      '@img/sharp-libvips-linux-s390x': 1.0.2
      '@img/sharp-libvips-linux-x64': 1.0.2
      '@img/sharp-libvips-linuxmusl-arm64': 1.0.2
      '@img/sharp-libvips-linuxmusl-x64': 1.0.2
      '@img/sharp-linux-arm': 0.33.3
      '@img/sharp-linux-arm64': 0.33.3
      '@img/sharp-linux-s390x': 0.33.3
      '@img/sharp-linux-x64': 0.33.3
      '@img/sharp-linuxmusl-arm64': 0.33.3
      '@img/sharp-linuxmusl-x64': 0.33.3
      '@img/sharp-wasm32': 0.33.3
      '@img/sharp-win32-ia32': 0.33.3
      '@img/sharp-win32-x64': 0.33.3
    dev: false

  /shebang-command@1.2.0:
    resolution: {integrity: sha512-EV3L1+UQWGor21OmnvojK36mhg+TyIKDh3iFBKBohr5xeXIhNBcx8oWdgkTEEQ+BEFFYdLRuqMfd5L84N1V5Vg==}
    engines: {node: '>=0.10.0'}
    dependencies:
      shebang-regex: 1.0.0
    dev: true

  /shebang-command@2.0.0:
    resolution: {integrity: sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==}
    engines: {node: '>=8'}
    dependencies:
      shebang-regex: 3.0.0
    dev: true

  /shebang-regex@1.0.0:
    resolution: {integrity: sha512-wpoSFAxys6b2a2wHZ1XpDSgD7N9iVjg29Ph9uV/uaP9Ex/KXlkTZTeddxDPSYQpgvzKLGJke2UU0AzoGCjNIvQ==}
    engines: {node: '>=0.10.0'}
    dev: true

  /shebang-regex@3.0.0:
    resolution: {integrity: sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==}
    engines: {node: '>=8'}
    dev: true

  /shiki-twoslash@3.1.2(typescript@5.0.4):
    resolution: {integrity: sha512-JBcRIIizi+exIA/OUhYkV6jtyeZco0ykCkIRd5sgwIt1Pm4pz+maoaRZpm6SkhPwvif4fCA7xOtJOykhpIV64Q==}
    peerDependencies:
      typescript: '>3'
    dependencies:
      '@typescript/twoslash': 3.1.0
      '@typescript/vfs': 1.3.4
      fenceparser: 1.1.1
      shiki: 0.10.1
      typescript: 5.0.4
    transitivePeerDependencies:
      - supports-color
    dev: true

  /shiki@0.10.1:
    resolution: {integrity: sha512-VsY7QJVzU51j5o1+DguUd+6vmCmZ5v/6gYu4vyYAhzjuNQU6P/vmSy4uQaOhvje031qQMiW0d2BwgMH52vqMng==}
    dependencies:
      jsonc-parser: 3.2.1
      vscode-oniguruma: 1.7.0
      vscode-textmate: 5.2.0
    dev: true

  /side-channel@1.0.6:
    resolution: {integrity: sha512-fDW/EZ6Q9RiO8eFG8Hj+7u/oW+XrPTIChwCOM2+th2A6OblDtYYIpve9m+KvI9Z4C9qSEXlaGR6bTEYHReuglA==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      es-errors: 1.3.0
      get-intrinsic: 1.2.4
      object-inspect: 1.13.1
    dev: true

  /siginfo@2.0.0:
    resolution: {integrity: sha512-ybx0WO1/8bSBLEWXZvEd7gMW3Sn3JFlW3TvX1nREbDLRNQNaeNN8WK0meBwPdAaOI7TtRRRJn/Es1zhrrCHu7g==}
    dev: true

  /signal-exit@3.0.7:
    resolution: {integrity: sha512-wnD2ZE+l+SPC/uoS0vXeE9L1+0wuaMqKlfz9AMUo38JsyLSBWSFcHR1Rri62LZc12vLr1gb3jl7iwQhgwpAbGQ==}

  /signal-exit@4.1.0:
    resolution: {integrity: sha512-bzyZ1e88w9O1iNJbKnOlvYTrWPDl46O1bG0D3XInv+9tkPrxrN8jUUTiFlDkkmKWgn1M6CfIA13SuGqOa9Korw==}
    engines: {node: '>=14'}
    dev: true

  /simple-swizzle@0.2.2:
    resolution: {integrity: sha512-JA//kQgZtbuY83m+xT+tXJkmJncGMTFT+C+g2h2R9uxkYIrE2yy9sgmcLhCnw57/WSD+Eh3J97FPEDFnbXnDUg==}
    dependencies:
      is-arrayish: 0.3.2
    dev: false

  /sirv-cli@2.0.2:
    resolution: {integrity: sha512-OtSJDwxsF1NWHc7ps3Sa0s+dPtP15iQNJzfKVz+MxkEo3z72mCD+yu30ct79rPr0CaV1HXSOBp+MIY5uIhHZ1A==}
    engines: {node: '>= 10'}
    hasBin: true
    dependencies:
      console-clear: 1.1.1
      get-port: 3.2.0
      kleur: 4.1.5
      local-access: 1.1.0
      sade: 1.8.1
      semiver: 1.1.0
      sirv: 2.0.4
      tinydate: 1.3.0
    dev: true

  /sirv@2.0.4:
    resolution: {integrity: sha512-94Bdh3cC2PKrbgSOUqTiGPWVZeSiXfKOVZNJniWoqrWrRkB1CJzBU3NEbiTsPcYy1lDsANA/THzS+9WBiy5nfQ==}
    engines: {node: '>= 10'}
    dependencies:
      '@polka/url': 1.0.0-next.25
      mrmime: 2.0.0
      totalist: 3.0.1

  /sisteransi@1.0.5:
    resolution: {integrity: sha512-bLGGlR1QxBcynn2d5YmDX4MGjlZvy2MRBDRNHLJ8VI6l6+9FUiyTFNJ0IveOSP0bcXgVDPRcfGqA0pjaqUpfVg==}
    dev: false

  /slash@3.0.0:
    resolution: {integrity: sha512-g9Q1haeby36OSStwb4ntCGGGaKsaVSjQ68fBxoQcutl5fS1vuY18H3wSt3jFyFtrkx+Kz0V1G85A4MyAdDMi2Q==}
    engines: {node: '>=8'}
    dev: true

  /smartwrap@2.0.2:
    resolution: {integrity: sha512-vCsKNQxb7PnCNd2wY1WClWifAc2lwqsG8OaswpJkVJsvMGcnEntdTCDajZCkk93Ay1U3t/9puJmb525Rg5MZBA==}
    engines: {node: '>=6'}
    hasBin: true
    dependencies:
      array.prototype.flat: 1.3.2
      breakword: 1.0.6
      grapheme-splitter: 1.0.4
      strip-ansi: 6.0.1
      wcwidth: 1.0.1
      yargs: 15.4.1
    dev: true

  /sorcery@0.11.0:
    resolution: {integrity: sha512-J69LQ22xrQB1cIFJhPfgtLuI6BpWRiWu1Y3vSsIwK/eAScqJxd/+CJlUuHQRdX2C9NGFamq+KqNywGgaThwfHw==}
    hasBin: true
    dependencies:
      '@jridgewell/sourcemap-codec': 1.4.15
      buffer-crc32: 0.2.13
      minimist: 1.2.8
      sander: 0.5.1
    dev: true

  /source-map-js@1.2.0:
    resolution: {integrity: sha512-itJW8lvSA0TXEphiRoawsCksnlf8SyvmFzIhltqAHluXd88pkCd+cXJVHTDwdCr0IzwptSm035IHQktUu1QUMg==}
    engines: {node: '>=0.10.0'}

  /source-map@0.6.1:
    resolution: {integrity: sha512-UjgapumWlbMhkBgzT7Ykc5YXUT46F0iKu8SGXq0bcwP5dz/h0Plj6enJqjz1Zbq2l5WaqYnrVbwWOWMyF3F47g==}
    engines: {node: '>=0.10.0'}
    dev: false

  /sourcemap-codec@1.4.8:
    resolution: {integrity: sha512-9NykojV5Uih4lgo5So5dtw+f0JgJX30KCNI8gwhz2J9A15wD0Ml6tjHKwf6fTSa6fAdVBdZeNOs9eJ71qCk8vA==}
    deprecated: Please use @jridgewell/sourcemap-codec instead
    dev: false

  /spawndamnit@2.0.0:
    resolution: {integrity: sha512-j4JKEcncSjFlqIwU5L/rp2N5SIPsdxaRsIv678+TZxZ0SRDJTm8JrxJMjE/XuiEZNEir3S8l0Fa3Ke339WI4qA==}
    dependencies:
      cross-spawn: 5.1.0
      signal-exit: 3.0.7
    dev: true

  /spdx-correct@3.2.0:
    resolution: {integrity: sha512-kN9dJbvnySHULIluDHy32WHRUu3Og7B9sbY7tsFLctQkIqnMh3hErYgdMjTYuqmcXX+lK5T1lnUt3G7zNswmZA==}
    dependencies:
      spdx-expression-parse: 3.0.1
      spdx-license-ids: 3.0.17
    dev: true

  /spdx-exceptions@2.5.0:
    resolution: {integrity: sha512-PiU42r+xO4UbUS1buo3LPJkjlO7430Xn5SVAhdpzzsPHsjbYVflnnFdATgabnLude+Cqu25p6N+g2lw/PFsa4w==}
    dev: true

  /spdx-expression-parse@3.0.1:
    resolution: {integrity: sha512-cbqHunsQWnJNE6KhVSMsMeH5H/L9EpymbzqTQ3uLwNCLZ1Q481oWaofqH7nO6V07xlXwY6PhQdQ2IedWx/ZK4Q==}
    dependencies:
      spdx-exceptions: 2.5.0
      spdx-license-ids: 3.0.17
    dev: true

  /spdx-license-ids@3.0.17:
    resolution: {integrity: sha512-sh8PWc/ftMqAAdFiBu6Fy6JUOYjqDJBJvIhpfDMyHrr0Rbp5liZqd4TjtQ/RgfLjKFZb+LMx5hpml5qOWy0qvg==}
    dev: true

  /sprintf-js@1.0.3:
    resolution: {integrity: sha512-D9cPgkvLlV3t3IzL0D0YLvGA9Ahk4PcvVwUbN0dSGr1aP0Nrt4AEnTUbuGvquEC0mA64Gqt1fzirlRs5ibXx8g==}
    dev: true

  /stackback@0.0.2:
    resolution: {integrity: sha512-1XMJE5fQo1jGH6Y/7ebnwPOBEkIEnT4QF32d5R1+VXdXveM0IBMJt8zfaxX1P3QhVwrYe+576+jkANtSS2mBbw==}
    dev: true

  /stacktracey@2.1.8:
    resolution: {integrity: sha512-Kpij9riA+UNg7TnphqjH7/CzctQ/owJGNbFkfEeve4Z4uxT5+JapVLFXcsurIfN34gnTWZNJ/f7NMG0E8JDzTw==}
    dependencies:
      as-table: 1.0.55
      get-source: 2.0.12
    dev: false

  /std-env@3.7.0:
    resolution: {integrity: sha512-JPbdCEQLj1w5GilpiHAx3qJvFndqybBysA3qUOnznweH4QbNYUsW/ea8QzSrnh0vNsezMMw5bcVool8lM0gwzg==}
    dev: true

  /stoppable@1.1.0:
    resolution: {integrity: sha512-KXDYZ9dszj6bzvnEMRYvxgeTHU74QBFL54XKtP3nyMuJ81CFYtABZ3bAzL2EdFUaEwJOBOgENyFj3R7oTzDyyw==}
    engines: {node: '>=4', npm: '>=6'}
    dev: false

  /stream-transform@2.1.3:
    resolution: {integrity: sha512-9GHUiM5hMiCi6Y03jD2ARC1ettBXkQBoQAe7nJsPknnI0ow10aXjTnew8QtYQmLjzn974BnmWEAJgCY6ZP1DeQ==}
    dependencies:
      mixme: 0.5.10
    dev: true

  /string-width@4.2.3:
    resolution: {integrity: sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==}
    engines: {node: '>=8'}
    dependencies:
      emoji-regex: 8.0.0
      is-fullwidth-code-point: 3.0.0
      strip-ansi: 6.0.1

  /string-width@5.1.2:
    resolution: {integrity: sha512-HnLOCR3vjcY8beoNLtcjZ5/nxn2afmME6lhrDrebokqMap+XbeW8n9TXpPDOqdGK5qcI3oT0GKTW6wC7EMiVqA==}
    engines: {node: '>=12'}
    dependencies:
      eastasianwidth: 0.2.0
      emoji-regex: 9.2.2
      strip-ansi: 7.1.0
    dev: true

  /string.prototype.trim@1.2.9:
    resolution: {integrity: sha512-klHuCNxiMZ8MlsOihJhJEBJAiMVqU3Z2nEXWfWnIqjN0gEFS9J9+IxKozWWtQGcgoa1WUZzLjKPTr4ZHNFTFxw==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      define-properties: 1.2.1
      es-abstract: 1.23.3
      es-object-atoms: 1.0.0
    dev: true

  /string.prototype.trimend@1.0.8:
    resolution: {integrity: sha512-p73uL5VCHCO2BZZ6krwwQE3kCzM7NKmis8S//xEC6fQonchbum4eP6kR4DLEjQFO3Wnj3Fuo8NM0kOSjVdHjZQ==}
    dependencies:
      call-bind: 1.0.7
      define-properties: 1.2.1
      es-object-atoms: 1.0.0
    dev: true

  /string.prototype.trimstart@1.0.8:
    resolution: {integrity: sha512-UXSH262CSZY1tfu3G3Secr6uGLCFVPMhIqHjlgCUtCCcgihYc/xKs9djMTMUOb2j1mVSeU8EU6NWc/iQKU6Gfg==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      define-properties: 1.2.1
      es-object-atoms: 1.0.0
    dev: true

  /string_decoder@1.3.0:
    resolution: {integrity: sha512-hkRX8U1WjJFd8LsDJ2yQ/wWWxaopEsABU1XfkM8A+j0+85JAGppt16cr1Whg6KIbb4okU6Mql6BOj+uup/wKeA==}
    dependencies:
      safe-buffer: 5.2.1
    dev: false

  /strip-ansi@6.0.1:
    resolution: {integrity: sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==}
    engines: {node: '>=8'}
    dependencies:
      ansi-regex: 5.0.1

  /strip-ansi@7.1.0:
    resolution: {integrity: sha512-iq6eVVI64nQQTRYq2KtEg2d2uU7LElhTJwsH4YzIHZshxlgZms/wIc4VoDQTlG/IvVIrBKG06CrZnp0qv7hkcQ==}
    engines: {node: '>=12'}
    dependencies:
      ansi-regex: 6.0.1
    dev: true

  /strip-bom@3.0.0:
    resolution: {integrity: sha512-vavAMRXOgBVNF6nyEEmL3DBK19iRpDcoIwW+swQ+CbGiu7lju6t+JklA1MHweoWtadgt4ISVUsXLyDq34ddcwA==}
    engines: {node: '>=4'}
    dev: true

  /strip-final-newline@3.0.0:
    resolution: {integrity: sha512-dOESqjYr96iWYylGObzd39EuNTa5VJxyvVAEm5Jnh7KGo75V43Hk1odPQkNDyXNmUR6k+gEiDVXnjB8HJ3crXw==}
    engines: {node: '>=12'}
    dev: true

  /strip-indent@3.0.0:
    resolution: {integrity: sha512-laJTa3Jb+VQpaC6DseHhF7dXVqHTfJPCRDaEbid/drOhgitgYku/letMUqOXFoWV0zIIUbjpdH2t+tYj4bQMRQ==}
    engines: {node: '>=8'}
    dependencies:
      min-indent: 1.0.1
    dev: true

  /strip-json-comments@3.1.1:
    resolution: {integrity: sha512-6fPc+R4ihwqP6N/aIv2f1gMH8lOVtWQHoqC4yK6oSDVVocumAsfCqjkXnqiYMhmMwS/mEHLp7Vehlt3ql6lEig==}
    engines: {node: '>=8'}
    dev: true

  /strip-literal@2.1.0:
    resolution: {integrity: sha512-Op+UycaUt/8FbN/Z2TWPBLge3jWrP3xj10f3fnYxf052bKuS3EKs1ZQcVGjnEMdsNVAM+plXRdmjrZ/KgG3Skw==}
    dependencies:
      js-tokens: 9.0.0
    dev: true

  /sucrase@3.35.0:
    resolution: {integrity: sha512-8EbVDiu9iN/nESwxeSxDKe0dunta1GOlHufmSSXxMD2z2/tMZpDMpvXQGsc+ajGo8y2uYUmixaSRUc/QPoQ0GA==}
    engines: {node: '>=16 || 14 >=14.17'}
    hasBin: true
    dependencies:
      '@jridgewell/gen-mapping': 0.3.5
      commander: 4.1.1
      glob: 10.3.12
      lines-and-columns: 1.2.4
      mz: 2.7.0
      pirates: 4.0.6
      ts-interface-checker: 0.1.13
    dev: true

  /supports-color@5.5.0:
    resolution: {integrity: sha512-QjVjwdXIt408MIiAqCX4oUKsgU2EqAGzs2Ppkm4aQYbjm+ZEWEcW4SfFNTr4uMNZma0ey4f5lgLrkB0aX0QMow==}
    engines: {node: '>=4'}
    dependencies:
      has-flag: 3.0.0
    dev: true

  /supports-color@7.2.0:
    resolution: {integrity: sha512-qpCAvRl9stuOHveKsn7HncJRvv501qIacKzQlO/+Lwxc9+0q2wLyv4Dfvt80/DPn2pqOBsJdDiogXGR9+OvwRw==}
    engines: {node: '>=8'}
    dependencies:
      has-flag: 4.0.0
    dev: true

  /supports-preserve-symlinks-flag@1.0.0:
    resolution: {integrity: sha512-ot0WnXS9fgdkgIcePe6RHNk1WA8+muPa6cSjeR3V8K27q9BB1rTE3R1p7Hv0z1ZyAc8s6Vvv8DIyWf681MAt0w==}
    engines: {node: '>= 0.4'}

  /svelte-check@3.6.9(postcss@8.4.38)(svelte@4.2.14):
    resolution: {integrity: sha512-hDQrk3L0osX07djQyMiXocKysTLfusqi8AriNcCiQxhQR49/LonYolcUGMtZ0fbUR8HTR198Prrgf52WWU9wEg==}
    hasBin: true
    peerDependencies:
      svelte: ^3.55.0 || ^4.0.0-next.0 || ^4.0.0 || ^5.0.0-next.0
    dependencies:
      '@jridgewell/trace-mapping': 0.3.25
      chokidar: 3.6.0
      fast-glob: 3.3.2
      import-fresh: 3.3.0
      picocolors: 1.0.0
      sade: 1.8.1
      svelte: 4.2.14
      svelte-preprocess: 5.1.3(postcss@8.4.38)(svelte@4.2.14)(typescript@5.4.5)
      typescript: 5.4.5
    transitivePeerDependencies:
      - '@babel/core'
      - coffeescript
      - less
      - postcss
      - postcss-load-config
      - pug
      - sass
      - stylus
      - sugarss
    dev: true

  /svelte-eslint-parser@0.34.1:
    resolution: {integrity: sha512-9+uLA1pqI9AZioKVGJzYYmlOZWxfoCXSbAM9iaNm7H01XlYlzRTtJfZgl9o3StQGN41PfGJIbkKkfk3e/pHFfA==}
    engines: {node: ^12.22.0 || ^14.17.0 || >=16.0.0}
    peerDependencies:
      svelte: ^3.37.0 || ^4.0.0 || ^5.0.0-next.94
    peerDependenciesMeta:
      svelte:
        optional: true
    dependencies:
      eslint-scope: 7.2.2
      eslint-visitor-keys: 3.4.3
      espree: 9.6.1
      postcss: 8.4.38
      postcss-scss: 4.0.9(postcss@8.4.38)
    dev: true

  /svelte-hmr@0.16.0(svelte@4.2.14):
    resolution: {integrity: sha512-Gyc7cOS3VJzLlfj7wKS0ZnzDVdv3Pn2IuVeJPk9m2skfhcu5bq3wtIZyQGggr7/Iim5rH5cncyQft/kRLupcnA==}
    engines: {node: ^12.20 || ^14.13.1 || >= 16}
    peerDependencies:
      svelte: ^3.19.0 || ^4.0.0
    dependencies:
      svelte: 4.2.14
    dev: true

  /svelte-local-storage-store@0.6.4(svelte@4.2.14):
    resolution: {integrity: sha512-45WoY2vSGPQM1sIQJ9jTkPPj20hYeqm+af6mUGRFSPP5WglZf36YYoZqwmZZ8Dt/2SU8lem+BTA8/Z/8TkqNLg==}
    engines: {node: '>=0.14'}
    peerDependencies:
      svelte: ^3.48.0 || >4.0.0
    dependencies:
      svelte: 4.2.14
    dev: true

  /svelte-parse-markup@0.1.2(svelte@4.2.14):
    resolution: {integrity: sha512-DycY7DJr7VqofiJ63ut1/NEG92HrWWL56VWITn/cJCu+LlZhMoBkBXT4opUitPEEwbq1nMQbv4vTKUfbOqIW1g==}
    peerDependencies:
      svelte: ^3.0.0 || ^4.0.0
    dependencies:
      svelte: 4.2.14
    dev: false

  /svelte-preprocess@5.1.3(postcss@8.4.38)(svelte@4.2.14)(typescript@5.4.5):
    resolution: {integrity: sha512-xxAkmxGHT+J/GourS5mVJeOXZzne1FR5ljeOUAMXUkfEhkLEllRreXpbl3dIYJlcJRfL1LO1uIAPpBpBfiqGPw==}
    engines: {node: '>= 16.0.0', pnpm: ^8.0.0}
    requiresBuild: true
    peerDependencies:
      '@babel/core': ^7.10.2
      coffeescript: ^2.5.1
      less: ^3.11.3 || ^4.0.0
      postcss: ^7 || ^8
      postcss-load-config: ^2.1.0 || ^3.0.0 || ^4.0.0 || ^5.0.0
      pug: ^3.0.0
      sass: ^1.26.8
      stylus: ^0.55.0
      sugarss: ^2.0.0 || ^3.0.0 || ^4.0.0
      svelte: ^3.23.0 || ^4.0.0-next.0 || ^4.0.0 || ^5.0.0-next.0
      typescript: '>=3.9.5 || ^4.0.0 || ^5.0.0'
    peerDependenciesMeta:
      '@babel/core':
        optional: true
      coffeescript:
        optional: true
      less:
        optional: true
      postcss:
        optional: true
      postcss-load-config:
        optional: true
      pug:
        optional: true
      sass:
        optional: true
      stylus:
        optional: true
      sugarss:
        optional: true
      typescript:
        optional: true
    dependencies:
      '@types/pug': 2.0.10
      detect-indent: 6.1.0
      magic-string: 0.30.9
      postcss: 8.4.38
      sorcery: 0.11.0
      strip-indent: 3.0.0
      svelte: 4.2.14
      typescript: 5.4.5
    dev: true

  /svelte2tsx@0.7.6(svelte@4.2.14)(typescript@5.4.5):
    resolution: {integrity: sha512-awHvYsakyiGjRqqSOhb2F+qJ6lUT9klQe0UQofAcdHNaKKeDHA8kEZ8zYKGG3BiDPurKYMGvH5/lZ+jeIoG7yQ==}
    peerDependencies:
      svelte: ^3.55 || ^4.0.0-next.0 || ^4.0 || ^5.0.0-next.0
      typescript: ^4.9.4 || ^5.0.0
    dependencies:
      dedent-js: 1.0.1
      pascal-case: 3.1.2
      svelte: 4.2.14
      typescript: 5.4.5
    dev: false

  /svelte@4.2.14:
    resolution: {integrity: sha512-ry3+YlWqZpHxLy45MW4MZIxNdvB+Wl7p2nnstWKbOAewaJyNJuOtivSbRChcfIej6wFBjWqyKmf/NgK1uW2JAA==}
    engines: {node: '>=16'}
    dependencies:
      '@ampproject/remapping': 2.3.0
      '@jridgewell/sourcemap-codec': 1.4.15
      '@jridgewell/trace-mapping': 0.3.25
      '@types/estree': 1.0.5
      acorn: 8.11.3
      aria-query: 5.3.0
      axobject-query: 4.0.0
      code-red: 1.0.4
      css-tree: 2.3.1
      estree-walker: 3.0.3
      is-reference: 3.0.2
      locate-character: 3.0.0
      magic-string: 0.30.9
      periscopic: 3.1.0

  /tar@6.2.1:
    resolution: {integrity: sha512-DZ4yORTwrbTj/7MZYq2w+/ZFdI6OZ/f9SFHR+71gIVUZhOQPHzVCLpvRnPgyaMpfWxxk/4ONva3GQSyNIKRv6A==}
    engines: {node: '>=10'}
    dependencies:
      chownr: 2.0.0
      fs-minipass: 2.1.0
      minipass: 5.0.0
      minizlib: 2.1.2
      mkdirp: 1.0.4
      yallist: 4.0.0
    dev: false

  /term-size@2.2.1:
    resolution: {integrity: sha512-wK0Ri4fOGjv/XPy8SBHZChl8CM7uMc5VML7SqiQ0zG7+J5Vr+RMQDoHa2CNT6KHUnTGIXH34UDMkPzAUyapBZg==}
    engines: {node: '>=8'}
    dev: true

  /test-exclude@6.0.0:
    resolution: {integrity: sha512-cAGWPIyOHU6zlmg88jwm7VRyXnMN7iV68OGAbYDk/Mh/xC/pzVPlQtY6ngoIH/5/tciuhGfvESU8GrHrcxD56w==}
    engines: {node: '>=8'}
    dependencies:
      '@istanbuljs/schema': 0.1.3
      glob: 7.2.3
      minimatch: 3.1.2
    dev: true

  /text-table@0.2.0:
    resolution: {integrity: sha512-N+8UisAXDGk8PFXP4HAzVR9nbfmVJ3zYLAWiTIoqC5v5isinhr+r5uaO8+7r3BMfuNIufIsA7RdpVgacC2cSpw==}
    dev: true

  /thenify-all@1.6.0:
    resolution: {integrity: sha512-RNxQH/qI8/t3thXJDwcstUO4zeqo64+Uy/+sNVRBx4Xn2OX+OZ9oP+iJnNFqplFra2ZUVeKCSa2oVWi3T4uVmA==}
    engines: {node: '>=0.8'}
    dependencies:
      thenify: 3.3.1
    dev: true

  /thenify@3.3.1:
    resolution: {integrity: sha512-RVZSIV5IG10Hk3enotrhvz0T9em6cyHBLkH/YAZuKqd8hRkKhSfCGIcP2KUY0EPxndzANBmNllzWPwak+bheSw==}
    dependencies:
      any-promise: 1.3.0
    dev: true

  /tiny-glob@0.2.9:
    resolution: {integrity: sha512-g/55ssRPUjShh+xkfx9UPDXqhckHEsHr4Vd9zX55oSdGZc/MD0m3sferOkwWtp98bv+kcVfEHtRJgBVJzelrzg==}
    dependencies:
      globalyzer: 0.1.0
      globrex: 0.1.2

  /tinybench@2.6.0:
    resolution: {integrity: sha512-N8hW3PG/3aOoZAN5V/NSAEDz0ZixDSSt5b/a05iqtpgfLWMSVuCo7w0k2vVvEjdrIoeGqZzweX2WlyioNIHchA==}
    dev: true

  /tinydate@1.3.0:
    resolution: {integrity: sha512-7cR8rLy2QhYHpsBDBVYnnWXm8uRTr38RoZakFSW7Bs7PzfMPNZthuMLkwqZv7MTu8lhQ91cOFYS5a7iFj2oR3w==}
    engines: {node: '>=4'}
    dev: true

  /tinypool@0.8.3:
    resolution: {integrity: sha512-Ud7uepAklqRH1bvwy22ynrliC7Dljz7Tm8M/0RBUW+YRa4YHhZ6e4PpgE+fu1zr/WqB1kbeuVrdfeuyIBpy4tw==}
    engines: {node: '>=14.0.0'}
    dev: true

  /tinyspy@2.2.1:
    resolution: {integrity: sha512-KYad6Vy5VDWV4GH3fjpseMQ/XU2BhIYP7Vzd0LG44qRWm/Yt2WCOTicFdvmgo6gWaqooMQCawTtILVQJupKu7A==}
    engines: {node: '>=14.0.0'}
    dev: true

  /tmp@0.0.33:
    resolution: {integrity: sha512-jRCJlojKnZ3addtTOjdIqoRuPEKBvNXcGYqzO6zWZX8KfKEpnGY5jfggJQ3EjKuu8D4bJRr0y+cYJFmYbImXGw==}
    engines: {node: '>=0.6.0'}
    dependencies:
      os-tmpdir: 1.0.2
    dev: true

  /to-regex-range@5.0.1:
    resolution: {integrity: sha512-65P7iz6X5yEr1cwcgvQxbbIw7Uk3gOy5dIdtZ4rDveLqhrdJP+Li/Hx6tyK0NEb+2GCyneCMJiGqrADCSNk8sQ==}
    engines: {node: '>=8.0'}
    dependencies:
      is-number: 7.0.0

  /topojson-client@3.1.0:
    resolution: {integrity: sha512-605uxS6bcYxGXw9qi62XyrV6Q3xwbndjachmNxu8HWTtVPxZfEJN9fd/SZS1Q54Sn2y0TMyMxFj/cJINqGHrKw==}
    hasBin: true
    dependencies:
      commander: 2.20.3
    dev: false

  /totalist@3.0.1:
    resolution: {integrity: sha512-sf4i37nQ2LBx4m3wB74y+ubopq6W/dIzXg0FDGjsYnZHVa1Da8FH853wlL2gtUhg+xJXjfk3kUZS3BRoQeoQBQ==}
    engines: {node: '>=6'}

  /tr46@0.0.3:
    resolution: {integrity: sha512-N3WMsuqV66lT30CrXNbEjx4GEwlow3v6rr4mCcv6prnfwhS01rkgyFdjPNBYd9br7LpXV1+Emh01fHnq2Gdgrw==}

  /trim-newlines@3.0.1:
    resolution: {integrity: sha512-c1PTsA3tYrIsLGkJkzHF+w9F2EyxfXGo4UyJc4pFL++FMjnq0HJS69T3M7d//gKrFKwy429bouPescbjecU+Zw==}
    engines: {node: '>=8'}
    dev: true

  /trouter@4.0.0:
    resolution: {integrity: sha512-bwwr76BThfiVwAFZqks5cJ+VoKNM3/2Yg1ZwJslkdmAUQ6S0UNoCoGYFDxdw+u1skfexggdmD2p35kW5Td4Cug==}
    engines: {node: '>=6'}
    dependencies:
      regexparam: 3.0.0
    dev: true

  /ts-api-utils@1.3.0(typescript@5.4.5):
    resolution: {integrity: sha512-UQMIo7pb8WRomKR1/+MFVLTroIvDVtMX3K6OUir8ynLyzB8Jeriont2bTAtmNPa1ekAgN7YPDyf6V+ygrdU+eQ==}
    engines: {node: '>=16'}
    peerDependencies:
      typescript: '>=4.2.0'
    dependencies:
      typescript: 5.4.5
    dev: true

  /ts-interface-checker@0.1.13:
    resolution: {integrity: sha512-Y/arvbn+rrz3JCKl9C4kVNfTfSm2/mEp5FSz5EsZSANGPSlQrpRI5M4PKF+mJnE52jOO90PnPSc3Ur3bTQw0gA==}
    dev: true

  /ts-json-schema-generator@1.5.1:
    resolution: {integrity: sha512-apX5qG2+NA66j7b4AJm8q/DpdTeOsjfh7A3LpKsUiil0FepkNwtN28zYgjrsiiya2/OPhsr/PSjX5FUYg79rCg==}
    engines: {node: '>=10.0.0'}
    hasBin: true
    dependencies:
      '@types/json-schema': 7.0.15
      commander: 12.0.0
      glob: 8.1.0
      json5: 2.2.3
      normalize-path: 3.0.0
      safe-stable-stringify: 2.4.3
      typescript: 5.4.5
    dev: false

  /ts-morph@22.0.0:
    resolution: {integrity: sha512-M9MqFGZREyeb5fTl6gNHKZLqBQA0TjA1lea+CR48R8EBTDuWrNqW6ccC5QvjNR4s6wDumD3LTCjOFSp9iwlzaw==}
    dependencies:
      '@ts-morph/common': 0.23.0
      code-block-writer: 13.0.1
    dev: false

  /tslib@2.6.2:
    resolution: {integrity: sha512-AEYxH93jGFPn/a2iVAwW87VuUIkR1FVUKB77NwMF7nBTDkDrrT/Hpt/IrCJ0QXhW27jTBDcf5ZY7w6RiqTMw2Q==}
    dev: false

  /tty-table@4.2.3:
    resolution: {integrity: sha512-Fs15mu0vGzCrj8fmJNP7Ynxt5J7praPXqFN0leZeZBXJwkMxv9cb2D454k1ltrtUSJbZ4yH4e0CynsHLxmUfFA==}
    engines: {node: '>=8.0.0'}
    hasBin: true
    dependencies:
      chalk: 4.1.2
      csv: 5.5.3
      kleur: 4.1.5
      smartwrap: 2.0.2
      strip-ansi: 6.0.1
      wcwidth: 1.0.1
      yargs: 17.7.2
    dev: true

  /type-check@0.4.0:
    resolution: {integrity: sha512-XleUoc9uwGXqjWwXaUTZAmzMcFZ5858QA2vvx1Ur5xIcixXIP+8LnFDgRplU30us6teqdlskFfu+ae4K79Ooew==}
    engines: {node: '>= 0.8.0'}
    dependencies:
      prelude-ls: 1.2.1
    dev: true

  /type-detect@4.0.8:
    resolution: {integrity: sha512-0fr/mIH1dlO+x7TlcMy+bIDqKPsw/70tVyeHW787goQjhmqaZe10uwLujubK9q9Lg6Fiho1KUKDYz0Z7k7g5/g==}
    engines: {node: '>=4'}
    dev: true

  /type-fest@0.13.1:
    resolution: {integrity: sha512-34R7HTnG0XIJcBSn5XhDd7nNFPRcXYRZrBB2O2jdKqYODldSzBAqzsWoZYYvduky73toYS/ESqxPvkDf/F0XMg==}
    engines: {node: '>=10'}
    dev: true

  /type-fest@0.20.2:
    resolution: {integrity: sha512-Ne+eE4r0/iWnpAxD852z3A+N0Bt5RN//NjJwRd2VFHEmrywxf5vsZlh4R6lixl6B+wz/8d+maTSAkN1FIkI3LQ==}
    engines: {node: '>=10'}
    dev: true

  /type-fest@0.6.0:
    resolution: {integrity: sha512-q+MB8nYR1KDLrgr4G5yemftpMC7/QLqVndBmEEdqzmNj5dcFOO4Oo8qlwZE3ULT3+Zim1F8Kq4cBnikNhlCMlg==}
    engines: {node: '>=8'}
    dev: true

  /type-fest@0.8.1:
    resolution: {integrity: sha512-4dbzIzqvjtgiM5rw1k5rEHtBANKmdudhGyBEajN01fEyhaAIhsoKNy6y7+IN93IfpFtwY9iqi7kD+xwKhQsNJA==}
    engines: {node: '>=8'}
    dev: true

  /typed-array-buffer@1.0.2:
    resolution: {integrity: sha512-gEymJYKZtKXzzBzM4jqa9w6Q1Jjm7x2d+sh19AdsD4wqnMPDYyvwpsIc2Q/835kHuo3BEQ7CjelGhfTsoBb2MQ==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      es-errors: 1.3.0
      is-typed-array: 1.1.13
    dev: true

  /typed-array-byte-length@1.0.1:
    resolution: {integrity: sha512-3iMJ9q0ao7WE9tWcaYKIptkNBuOIcZCCT0d4MRvuuH88fEoEH62IuQe0OtraD3ebQEoTRk8XCBoknUNc1Y67pw==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      for-each: 0.3.3
      gopd: 1.0.1
      has-proto: 1.0.3
      is-typed-array: 1.1.13
    dev: true

  /typed-array-byte-offset@1.0.2:
    resolution: {integrity: sha512-Ous0vodHa56FviZucS2E63zkgtgrACj7omjwd/8lTEMEPFFyjfixMZ1ZXenpgCFBBt4EC1J2XsyVS2gkG0eTFA==}
    engines: {node: '>= 0.4'}
    dependencies:
      available-typed-arrays: 1.0.7
      call-bind: 1.0.7
      for-each: 0.3.3
      gopd: 1.0.1
      has-proto: 1.0.3
      is-typed-array: 1.1.13
    dev: true

  /typed-array-length@1.0.6:
    resolution: {integrity: sha512-/OxDN6OtAk5KBpGb28T+HZc2M+ADtvRxXrKKbUwtsLgdoxgX13hyy7ek6bFRl5+aBs2yZzB0c4CnQfAtVypW/g==}
    engines: {node: '>= 0.4'}
    dependencies:
      call-bind: 1.0.7
      for-each: 0.3.3
      gopd: 1.0.1
      has-proto: 1.0.3
      is-typed-array: 1.1.13
      possible-typed-array-names: 1.0.0
    dev: true

  /typescript@5.0.4:
    resolution: {integrity: sha512-cW9T5W9xY37cc+jfEnaUvX91foxtHkza3Nw3wkoF4sSlKn0MONdkdEndig/qPBWXNkmplh3NzayQzCiHM4/hqw==}
    engines: {node: '>=12.20'}
    hasBin: true
    dev: true

  /typescript@5.4.5:
    resolution: {integrity: sha512-vcI4UpRgg81oIRUFwR0WSIHKt11nJ7SAVlYNIu+QpqeyXP+gpQJy/Z4+F0aGxSE4MqwjyXvW/TzgkLAx2AGHwQ==}
    engines: {node: '>=14.17'}
    hasBin: true

  /ufo@1.5.3:
    resolution: {integrity: sha512-Y7HYmWaFwPUmkoQCUIAYpKqkOf+SbVj/2fJJZ4RJMCfZp0rTGwRbzQD+HghfnhKOjL9E01okqz+ncJskGYfBNw==}
    dev: true

  /unbox-primitive@1.0.2:
    resolution: {integrity: sha512-61pPlCD9h51VoreyJ0BReideM3MDKMKnh6+V9L08331ipq6Q8OFXZYiqP6n/tbHx4s5I9uRhcye6BrbkizkBDw==}
    dependencies:
      call-bind: 1.0.7
      has-bigints: 1.0.2
      has-symbols: 1.0.3
      which-boxed-primitive: 1.0.2
    dev: true

  /undici-types@5.26.5:
    resolution: {integrity: sha512-JlCMO+ehdEIKqlFxk6IfVoAUVmgz7cU7zD/h9XZ0qzeosSHmUJVOzSQvvYSYWXkFXC+IfLKSIffhv0sVZup6pA==}

  /undici@5.28.4:
    resolution: {integrity: sha512-72RFADWFqKmUb2hmmvNODKL3p9hcB6Gt2DOQMis1SEBaV6a4MH8soBvzg+95CYhCKPFedut2JY9bMfrDl9D23g==}
    engines: {node: '>=14.0'}
    dependencies:
      '@fastify/busboy': 2.1.1
    dev: false

  /universalify@0.1.2:
    resolution: {integrity: sha512-rBJeI5CXAlmy1pV+617WB9J63U6XcazHHF2f2dbJix4XzpUF0RS3Zbj0FGIOCAva5P/d/GBOYaACQ1w+0azUkg==}
    engines: {node: '>= 4.0.0'}
    dev: true

  /update-browserslist-db@1.0.13(browserslist@4.23.0):
    resolution: {integrity: sha512-xebP81SNcPuNpPP3uzeW1NYXxI3rxyJzF3pD6sH4jE7o/IX+WtSpwnVU+qIsDPyk0d3hmFQ7mjqc6AtV604hbg==}
    hasBin: true
    peerDependencies:
      browserslist: '>= 4.21.0'
    dependencies:
      browserslist: 4.23.0
      escalade: 3.1.2
      picocolors: 1.0.0
    dev: true

  /uri-js@4.4.1:
    resolution: {integrity: sha512-7rKUyy33Q1yc98pQ1DAmLtwX109F7TIfWlW1Ydo8Wl1ii1SeHieeh0HHfPeL2fMXK6z0s8ecKs9frCuLJvndBg==}
    dependencies:
      punycode: 2.3.1
    dev: true

  /urlpattern-polyfill@8.0.2:
    resolution: {integrity: sha512-Qp95D4TPJl1kC9SKigDcqgyM2VDVO4RiJc2d4qe5GrYm+zbIQCWWKAFaJNQ4BhdFeDGwBmAxqJBwWSJDb9T3BQ==}
    dev: true

  /util-deprecate@1.0.2:
    resolution: {integrity: sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==}

  /uvu@0.5.6:
    resolution: {integrity: sha512-+g8ENReyr8YsOc6fv/NVJs2vFdHBnBNdfE49rshrTzDWOlUx4Gq7KOS2GD8eqhy2j+Ejq29+SbKH8yjkAqXqoA==}
    engines: {node: '>=8'}
    hasBin: true
    dependencies:
      dequal: 2.0.3
      diff: 5.2.0
      kleur: 4.1.5
      sade: 1.8.1
    dev: true

  /v8-to-istanbul@9.2.0:
    resolution: {integrity: sha512-/EH/sDgxU2eGxajKdwLCDmQ4FWq+kpi3uCmBGpw1xJtnAxEjlD8j8PEiGWpCIMIs3ciNAgH0d3TTJiUkYzyZjA==}
    engines: {node: '>=10.12.0'}
    dependencies:
      '@jridgewell/trace-mapping': 0.3.25
      '@types/istanbul-lib-coverage': 2.0.6
      convert-source-map: 2.0.0
    dev: true

  /validate-npm-package-license@3.0.4:
    resolution: {integrity: sha512-DpKm2Ui/xN7/HQKCtpZxoRWBhZ9Z0kqtygG8XCgNQ8ZlDnxuQmWhj566j8fN4Cu3/JmbhsDo7fcAJq4s9h27Ew==}
    dependencies:
      spdx-correct: 3.2.0
      spdx-expression-parse: 3.0.1
    dev: true

  /vite-imagetools@7.0.1(rollup@4.14.2):
    resolution: {integrity: sha512-23jnLhkTH0HR9Vd9LxMYnajOLeo0RJNEAHhtlsQP6kfPuOBoTzt54rWbEWB9jmhEXAOflLQpM+FrmilVPAoyGA==}
    engines: {node: '>=18.0.0'}
    dependencies:
      '@rollup/pluginutils': 5.1.0(rollup@4.14.2)
      imagetools-core: 7.0.0
    transitivePeerDependencies:
      - rollup
    dev: false

  /vite-node@1.5.0(@types/node@18.19.31)(lightningcss@1.24.1):
    resolution: {integrity: sha512-tV8h6gMj6vPzVCa7l+VGq9lwoJjW8Y79vst8QZZGiuRAfijU+EEWuc0kFpmndQrWhMMhet1jdSF+40KSZUqIIw==}
    engines: {node: ^18.0.0 || >=20.0.0}
    hasBin: true
    dependencies:
      cac: 6.7.14
      debug: 4.3.4
      pathe: 1.1.2
      picocolors: 1.0.0
      vite: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)
    transitivePeerDependencies:
      - '@types/node'
      - less
      - lightningcss
      - sass
      - stylus
      - sugarss
      - supports-color
      - terser
    dev: true

  /vite@5.2.8(@types/node@18.19.31)(lightningcss@1.24.1):
    resolution: {integrity: sha512-OyZR+c1CE8yeHw5V5t59aXsUPPVTHMDjEZz8MgguLL/Q7NblxhZUlTu9xSPqlsUO/y+X7dlU05jdhvyycD55DA==}
    engines: {node: ^18.0.0 || >=20.0.0}
    hasBin: true
    peerDependencies:
      '@types/node': ^18.0.0 || >=20.0.0
      less: '*'
      lightningcss: ^1.21.0
      sass: '*'
      stylus: '*'
      sugarss: '*'
      terser: ^5.4.0
    peerDependenciesMeta:
      '@types/node':
        optional: true
      less:
        optional: true
      lightningcss:
        optional: true
      sass:
        optional: true
      stylus:
        optional: true
      sugarss:
        optional: true
      terser:
        optional: true
    dependencies:
      '@types/node': 18.19.31
      esbuild: 0.20.2
      lightningcss: 1.24.1
      postcss: 8.4.38
      rollup: 4.14.2
    optionalDependencies:
      fsevents: 2.3.3
    dev: true

  /vitefu@0.2.5(vite@5.2.8):
    resolution: {integrity: sha512-SgHtMLoqaeeGnd2evZ849ZbACbnwQCIwRH57t18FxcXoZop0uQu0uzlIhJBlF/eWVzuce0sHeqPcDo+evVcg8Q==}
    peerDependencies:
      vite: ^3.0.0 || ^4.0.0 || ^5.0.0
    peerDependenciesMeta:
      vite:
        optional: true
    dependencies:
      vite: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)
    dev: true

  /vitest@1.5.0(@types/node@18.19.31)(lightningcss@1.24.1):
    resolution: {integrity: sha512-d8UKgR0m2kjdxDWX6911uwxout6GHS0XaGH1cksSIVVG8kRlE7G7aBw7myKQCvDI5dT4j7ZMa+l706BIORMDLw==}
    engines: {node: ^18.0.0 || >=20.0.0}
    hasBin: true
    peerDependencies:
      '@edge-runtime/vm': '*'
      '@types/node': ^18.0.0 || >=20.0.0
      '@vitest/browser': 1.5.0
      '@vitest/ui': 1.5.0
      happy-dom: '*'
      jsdom: '*'
    peerDependenciesMeta:
      '@edge-runtime/vm':
        optional: true
      '@types/node':
        optional: true
      '@vitest/browser':
        optional: true
      '@vitest/ui':
        optional: true
      happy-dom:
        optional: true
      jsdom:
        optional: true
    dependencies:
      '@types/node': 18.19.31
      '@vitest/expect': 1.5.0
      '@vitest/runner': 1.5.0
      '@vitest/snapshot': 1.5.0
      '@vitest/spy': 1.5.0
      '@vitest/utils': 1.5.0
      acorn-walk: 8.3.2
      chai: 4.4.1
      debug: 4.3.4
      execa: 8.0.1
      local-pkg: 0.5.0
      magic-string: 0.30.9
      pathe: 1.1.2
      picocolors: 1.0.0
      std-env: 3.7.0
      strip-literal: 2.1.0
      tinybench: 2.6.0
      tinypool: 0.8.3
      vite: 5.2.8(@types/node@18.19.31)(lightningcss@1.24.1)
      vite-node: 1.5.0(@types/node@18.19.31)(lightningcss@1.24.1)
      why-is-node-running: 2.2.2
    transitivePeerDependencies:
      - less
      - lightningcss
      - sass
      - stylus
      - sugarss
      - supports-color
      - terser
    dev: true

  /vscode-oniguruma@1.7.0:
    resolution: {integrity: sha512-L9WMGRfrjOhgHSdOYgCt/yRMsXzLDJSL7BPrOZt73gU0iWO4mpqzqQzOz5srxqTvMBaR0XZTSrVWo4j55Rc6cA==}
    dev: true

  /vscode-textmate@5.2.0:
    resolution: {integrity: sha512-Uw5ooOQxRASHgu6C7GVvUxisKXfSgW4oFlO+aa+PAkgmH89O3CXxEEzNRNtHSqtXFTl0nAC1uYj0GMSH27uwtQ==}
    dev: true

  /wcwidth@1.0.1:
    resolution: {integrity: sha512-XHPEwS0q6TaxcvG85+8EYkbiCux2XtWG2mkc47Ng2A77BQu9+DqIOJldST4HgPkuea7dvKSj5VgX3P1d4rW8Tg==}
    dependencies:
      defaults: 1.0.4
    dev: true

  /webidl-conversions@3.0.1:
    resolution: {integrity: sha512-2JAn3z8AR6rjK8Sm8orRC0h/bcl/DqL7tRPdGZ4I1CjdF+EaMLmYxBHyXuKL849eucPFhvBoxMsflfOb8kxaeQ==}

  /whatwg-url@5.0.0:
    resolution: {integrity: sha512-saE57nupxk6v3HY35+jzBwYa0rKSy0XR8JSxZPwgLr7ys0IBzhGviA1/TUGJLmSVqs8pb9AnvICXEuOHLprYTw==}
    dependencies:
      tr46: 0.0.3
      webidl-conversions: 3.0.1

  /which-boxed-primitive@1.0.2:
    resolution: {integrity: sha512-bwZdv0AKLpplFY2KZRX6TvyuN7ojjr7lwkg6ml0roIy9YeuSr7JS372qlNW18UQYzgYK9ziGcerWqZOmEn9VNg==}
    dependencies:
      is-bigint: 1.0.4
      is-boolean-object: 1.1.2
      is-number-object: 1.0.7
      is-string: 1.0.7
      is-symbol: 1.0.4
    dev: true

  /which-module@2.0.1:
    resolution: {integrity: sha512-iBdZ57RDvnOR9AGBhML2vFZf7h8vmBjhoaZqODJBFWHVtKkDmKuHai3cx5PgVMrX5YDNp27AofYbAwctSS+vhQ==}
    dev: true

  /which-pm@2.0.0:
    resolution: {integrity: sha512-Lhs9Pmyph0p5n5Z3mVnN0yWcbQYUAD7rbQUiMsQxOJ3T57k7RFe35SUwWMf7dsbDZks1uOmw4AecB/JMDj3v/w==}
    engines: {node: '>=8.15'}
    dependencies:
      load-yaml-file: 0.2.0
      path-exists: 4.0.0
    dev: true

  /which-typed-array@1.1.15:
    resolution: {integrity: sha512-oV0jmFtUky6CXfkqehVvBP/LSWJ2sy4vWMioiENyJLePrBO/yKyV9OyJySfAKosh+RYkIl5zJCNZ8/4JncrpdA==}
    engines: {node: '>= 0.4'}
    dependencies:
      available-typed-arrays: 1.0.7
      call-bind: 1.0.7
      for-each: 0.3.3
      gopd: 1.0.1
      has-tostringtag: 1.0.2
    dev: true

  /which@1.3.1:
    resolution: {integrity: sha512-HxJdYWq1MTIQbJ3nw0cqssHoTNU267KlrDuGZ1WYlxDStUtKUhOaJmh112/TZmHxxUfuJqPXSOm7tDyas0OSIQ==}
    hasBin: true
    dependencies:
      isexe: 2.0.0
    dev: true

  /which@2.0.2:
    resolution: {integrity: sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==}
    engines: {node: '>= 8'}
    hasBin: true
    dependencies:
      isexe: 2.0.0
    dev: true

  /why-is-node-running@2.2.2:
    resolution: {integrity: sha512-6tSwToZxTOcotxHeA+qGCq1mVzKR3CwcJGmVcY+QE8SHy6TnpFnh8PAvPNHYr7EcuVeG0QSMxtYCuO1ta/G/oA==}
    engines: {node: '>=8'}
    hasBin: true
    dependencies:
      siginfo: 2.0.0
      stackback: 0.0.2
    dev: true

  /wide-align@1.1.5:
    resolution: {integrity: sha512-eDMORYaPNZ4sQIuuYPDHdQvf4gyCF9rEEV/yPxGfwPkRodwEgiMUUXTx/dex+Me0wxx53S+NgUHaP7y3MGlDmg==}
    dependencies:
      string-width: 4.2.3
    dev: false

  /workerd@1.20240405.0:
    resolution: {integrity: sha512-AWrOSBh4Ll7sBWHuh0aywm8hDkKqsZmcwnDB0PVGszWZM5mndNBI5iJ/8haXVpdoyqkJQEVdhET9JDi4yU8tRg==}
    engines: {node: '>=16'}
    hasBin: true
    requiresBuild: true
    optionalDependencies:
      '@cloudflare/workerd-darwin-64': 1.20240405.0
      '@cloudflare/workerd-darwin-arm64': 1.20240405.0
      '@cloudflare/workerd-linux-64': 1.20240405.0
      '@cloudflare/workerd-linux-arm64': 1.20240405.0
      '@cloudflare/workerd-windows-64': 1.20240405.0
    dev: false

  /worktop@0.8.0-next.18:
    resolution: {integrity: sha512-+TvsA6VAVoMC3XDKR5MoC/qlLqDixEfOBysDEKnPIPou/NvoPWCAuXHXMsswwlvmEuvX56lQjvELLyLuzTKvRw==}
    engines: {node: '>=12'}
    dependencies:
      mrmime: 2.0.0
      regexparam: 3.0.0
    dev: false

  /wrangler@3.50.0(@cloudflare/workers-types@4.20240405.0):
    resolution: {integrity: sha512-JlLuch+6DtaC5HGp8YD9Au++XvMv34g3ySdlB5SyPbaObELi8P9ZID5vgyf9AA75djzxL7cuNOk1YdKCJEuq0w==}
    engines: {node: '>=16.17.0'}
    hasBin: true
    peerDependencies:
      '@cloudflare/workers-types': ^4.20240405.0
    peerDependenciesMeta:
      '@cloudflare/workers-types':
        optional: true
    dependencies:
      '@cloudflare/kv-asset-handler': 0.3.1
      '@cloudflare/workers-types': 4.20240405.0
      '@esbuild-plugins/node-globals-polyfill': 0.2.3(esbuild@0.17.19)
      '@esbuild-plugins/node-modules-polyfill': 0.2.2(esbuild@0.17.19)
      blake3-wasm: 2.1.5
      chokidar: 3.6.0
      esbuild: 0.17.19
      miniflare: 3.20240405.1
      nanoid: 3.3.7
      path-to-regexp: 6.2.2
      resolve: 1.22.8
      resolve.exports: 2.0.2
      selfsigned: 2.4.1
      source-map: 0.6.1
      ts-json-schema-generator: 1.5.1
      xxhash-wasm: 1.0.2
    optionalDependencies:
      fsevents: 2.3.3
    transitivePeerDependencies:
      - bufferutil
      - supports-color
      - utf-8-validate
    dev: false

  /wrap-ansi@6.2.0:
    resolution: {integrity: sha512-r6lPcBGxZXlIcymEu7InxDMhdW0KDxpLgoFLcguasxCaJ/SOIZwINatK9KY/tf+ZrlywOKU0UDj3ATXUBfxJXA==}
    engines: {node: '>=8'}
    dependencies:
      ansi-styles: 4.3.0
      string-width: 4.2.3
      strip-ansi: 6.0.1
    dev: true

  /wrap-ansi@7.0.0:
    resolution: {integrity: sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt/Fi7D16Q==}
    engines: {node: '>=10'}
    dependencies:
      ansi-styles: 4.3.0
      string-width: 4.2.3
      strip-ansi: 6.0.1
    dev: true

  /wrap-ansi@8.1.0:
    resolution: {integrity: sha512-si7QWI6zUMq56bESFvagtmzMdGOtoxfR+Sez11Mobfc7tm+VkUckk9bW2UeffTGVUbOksxmSw0AA2gs8g71NCQ==}
    engines: {node: '>=12'}
    dependencies:
      ansi-styles: 6.2.1
      string-width: 5.1.2
      strip-ansi: 7.1.0
    dev: true

  /wrappy@1.0.2:
    resolution: {integrity: sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ==}

  /ws@8.16.0:
    resolution: {integrity: sha512-HS0c//TP7Ina87TfiPUz1rQzMhHrl/SG2guqRcTOIUYD2q8uhUdNHZYJUaQ8aTGPzCh+c6oawMKW35nFl1dxyQ==}
    engines: {node: '>=10.0.0'}
    peerDependencies:
      bufferutil: ^4.0.1
      utf-8-validate: '>=5.0.2'
    peerDependenciesMeta:
      bufferutil:
        optional: true
      utf-8-validate:
        optional: true
    dev: false

  /xxhash-wasm@1.0.2:
    resolution: {integrity: sha512-ibF0Or+FivM9lNrg+HGJfVX8WJqgo+kCLDc4vx6xMeTce7Aj+DLttKbxxRR/gNLSAelRc1omAPlJ77N/Jem07A==}
    dev: false

  /y18n@4.0.3:
    resolution: {integrity: sha512-JKhqTOwSrqNA1NY5lSztJ1GrBiUodLMmIZuLiDaMRJ+itFd+ABVE8XBjOvIWL+rSqNDC74LCSFmlb/U4UZ4hJQ==}
    dev: true

  /y18n@5.0.8:
    resolution: {integrity: sha512-0pfFzegeDWJHJIAmTLRP2DwHjdF5s7jo9tuztdQxAhINCdvS+3nGINqPd00AphqJR/0LhANUS6/+7SCb98YOfA==}
    engines: {node: '>=10'}
    dev: true

  /yallist@2.1.2:
    resolution: {integrity: sha512-ncTzHV7NvsQZkYe1DW7cbDLm0YpzHmZF5r/iyP3ZnQtMiJ+pjzisCiMNI+Sj+xQF5pXhSHxSB3uDbsBTzY/c2A==}
    dev: true

  /yallist@4.0.0:
    resolution: {integrity: sha512-3wdGidZyq5PB084XLES5TpOSRA3wjXAlIWMhum2kRcv/41Sn2emQ0dycQW4uZXLejwKvg6EsvbdlVL+FYEct7A==}

  /yaml@1.10.2:
    resolution: {integrity: sha512-r3vXyErRCYJ7wg28yvBY5VSoAF8ZvlcW9/BwUzEtUsjvX/DKs24dIkuwjtuprwJJHsbyUbLApepYTR1BN4uHrg==}
    engines: {node: '>= 6'}
    dev: true

  /yargs-parser@18.1.3:
    resolution: {integrity: sha512-o50j0JeToy/4K6OZcaQmW6lyXXKhq7csREXcDwk2omFPJEwUNOVtJKvmDr9EI1fAJZUyZcRF7kxGBWmRXudrCQ==}
    engines: {node: '>=6'}
    dependencies:
      camelcase: 5.3.1
      decamelize: 1.2.0
    dev: true

  /yargs-parser@21.1.1:
    resolution: {integrity: sha512-tVpsJW7DdjecAiFpbIB1e3qxIQsE6NoPc5/eTdrbbIC4h0LVsWhnoa3g+m2HclBIujHzsxZ4VJVA+GUuc2/LBw==}
    engines: {node: '>=12'}
    dev: true

  /yargs@15.4.1:
    resolution: {integrity: sha512-aePbxDmcYW++PaqBsJ+HYUFwCdv4LVvdnhBy78E57PIor8/OVvhMrADFFEDh8DHDFRv/O9i3lPhsENjO7QX0+A==}
    engines: {node: '>=8'}
    dependencies:
      cliui: 6.0.0
      decamelize: 1.2.0
      find-up: 4.1.0
      get-caller-file: 2.0.5
      require-directory: 2.1.1
      require-main-filename: 2.0.0
      set-blocking: 2.0.0
      string-width: 4.2.3
      which-module: 2.0.1
      y18n: 4.0.3
      yargs-parser: 18.1.3
    dev: true

  /yargs@17.7.2:
    resolution: {integrity: sha512-7dSzzRQ++CKnNI/krKnYRV7JKKPUXMEh61soaHKg9mrWEhzFWhFnxPxGl+69cD1Ou63C13NUPCnmIcrvqCuM6w==}
    engines: {node: '>=12'}
    dependencies:
      cliui: 8.0.1
      escalade: 3.1.2
      get-caller-file: 2.0.5
      require-directory: 2.1.1
      string-width: 4.2.3
      y18n: 5.0.8
      yargs-parser: 21.1.1
    dev: true

  /yocto-queue@0.1.0:
    resolution: {integrity: sha512-rVksvsnNCdJ/ohGc6xgPwyN8eheCxsiLM8mxuE/t/mOVqJewPuO1miLpTHQiRgTKCLexL4MeAFVagts7HmNZ2Q==}
    engines: {node: '>=10'}
    dev: true

  /yocto-queue@1.0.0:
    resolution: {integrity: sha512-9bnSc/HEW2uRy67wc+T8UwauLuPJVn28jb+GtJY16iiKWyvmYJRXVT4UamsAEGQfPohgr2q4Tq0sQbQlxTfi1g==}
    engines: {node: '>=12.20'}
    dev: true

  /youch@3.3.3:
    resolution: {integrity: sha512-qSFXUk3UZBLfggAW3dJKg0BMblG5biqSF8M34E06o5CSsZtH92u9Hqmj2RzGiHDi64fhe83+4tENFP2DB6t6ZA==}
    dependencies:
      cookie: 0.5.0
      mustache: 4.2.0
      stacktracey: 2.1.8
    dev: false

  /zimmerframe@1.1.2:
    resolution: {integrity: sha512-rAbqEGa8ovJy4pyBxZM70hg4pE6gDgaQ0Sl9M3enG3I0d6H4XSAM3GeNGLKnsBpuijUow064sf7ww1nutC5/3w==}
    dev: false

  /zod@3.22.4:
    resolution: {integrity: sha512-iC+8Io04lddc+mVqQ9AZ7OQ2MrUKGN+oIQyq1vemgt46jwCwLfhq7/pwnBnNXXXZb8VTVLKwp9EDkx+ryxIWmg==}
    dev: false

```


####### pnpm-workspace.yaml #######

```

packages:
  - 'packages/*'
  - 'sites/*'
  - 'packages/adapter-static/test/apps/*'
  - 'packages/kit/test/apps/*'
  - 'packages/kit/test/prerendering/*'
  - 'packages/kit/test/build-errors/**'
  - 'packages/kit/test/build-errors/apps/*'
  - 'packages/create-svelte/templates/*'
  - '!.test-tmp/**'
  - 'playgrounds/*'

```


####### README.md #######


####### renovate.json #######

```

{
	"extends": [
		"github>whitesource/merge-confidence:beta",
		"config:base",
		":preserveSemverRanges",
		"group:allNonMajor",
		":semanticCommitTypeAll(chore)"
	],
	"pin": {
		"enabled": false
	},
	"ignoreDeps": [
		"@types/node",
		"esbuild",
		"rollup",
		"typescript"
	],
	"ignorePaths": [
		"**/create-svelte/shared/**",
		"**/create-svelte/templates/**"
	],
	"packageRules": [
		{
			"matchPackageNames": [
				"vite"
			],
			"matchUpdateTypes": [
				"major"
			],
			"enabled": false
		}
	]
}
```


####### scripts/check-dependencies.js #######

```

import { execSync } from 'node:child_process';

const output = execSync('pnpm list --recursive --depth Infinity --json', {
	encoding: 'utf8',
	maxBuffer: 100 * 1024 * 1024
});

const packages = JSON.parse(output);

const deps = new Map();

function get_or_default(map, key, constructor) {
	let current = map.get(key);
	if (!current) {
		map.set(key, (current = new constructor()));
	}
	return current;
}

function add_deps(parent, dependencies, is_dev) {
	for (const [name, { version }] of Object.entries(dependencies)) {
		if (version.startsWith('link:')) continue;
		const versions = get_or_default(deps, name, Map);
		const parents = get_or_default(versions, version, Set);
		parents.add(parent + (is_dev ? ':dev' : ''));
	}
}

for (const pkg of packages) {
	if (pkg.dependencies) add_deps(pkg.name, pkg.dependencies);
	if (pkg.devDependencies) add_deps(pkg.name, pkg.devDependencies, 'dev');
}

const duplicates = new Map([...deps].filter(([, versions]) => versions.size > 1));
console.log(duplicates);

```


####### scripts/sync-all.js #######

```

import fs from 'node:fs';
import path from 'node:path';
import * as sync from '../packages/kit/src/core/sync/sync.js';
import { load_config } from '../packages/kit/src/core/config/index.js';

// This isn't strictly necessary, but it eliminates some annoying warnings in CI

for (const directories of [
	'packages/kit/test/apps',
	'packages/kit/test/build-errors/apps',
	'packages/kit/test/prerendering'
].map((dir) => path.resolve(dir))) {
	for (const dir of fs.readdirSync(directories)) {
		const cwd = path.join(directories, dir);

		if (!fs.existsSync(path.join(cwd, 'svelte.config.js'))) {
			continue;
		}

		await sync.all(await load_config({ cwd }), 'development');
	}
}

```


####### sites/kit.svelte.dev/package.json #######

```

{
	"name": "kit.svelte.dev",
	"private": true,
	"version": "0.0.1",
	"scripts": {
		"lint": "prettier --check .",
		"format": "prettier --write .",
		"update": "node scripts/types",
		"dev": "pnpm run update && vite dev",
		"build": "pnpm run update && vite build",
		"prebuild": "test \"$CI\" = true && npx pnpm install --store=node_modules/.pnpm-store || echo skipping pnpm install",
		"preview": "vite preview",
		"test": "vitest run"
	},
	"devDependencies": {
		"@sveltejs/adapter-vercel": "workspace:^",
		"@sveltejs/amp": "workspace:^",
		"@sveltejs/enhanced-img": "workspace:^",
		"@sveltejs/kit": "workspace:^",
		"@sveltejs/site-kit": "6.0.0-next.59",
		"@sveltejs/vite-plugin-svelte": "^3.0.1",
		"@types/d3-geo": "^3.1.0",
		"@types/node": "^18.19.3",
		"browserslist": "^4.22.2",
		"flexsearch": "^0.7.31",
		"lightningcss": "^1.22.1",
		"marked": "^12.0.0",
		"prettier": "^3.1.1",
		"prettier-plugin-svelte": "^3.1.2",
		"prism-svelte": "^0.5.0",
		"prismjs": "^1.29.0",
		"shiki-twoslash": "^3.1.2",
		"svelte": "^4.2.10",
		"typescript": "5.0.4",
		"vite": "^5.2.8",
		"vitest": "^1.5.0"
	},
	"type": "module",
	"dependencies": {
		"d3-geo": "^3.1.0",
		"d3-geo-projection": "^4.0.0",
		"topojson-client": "^3.1.0"
	}
}

```


####### sites/kit.svelte.dev/README.md #######

# kit.svelte.dev

This is the SvelteKit website. The docs live [here](../../documentation).

## Developing

Once you've [set up the repo](../../CONTRIBUTING.md#preparing), `cd` into this directory and start the dev server:

```bash
cd sites/kit.svelte.dev
pnpm run update
pnpm dev
```

####### sites/kit.svelte.dev/scripts/tsconfig.json #######

```

{
	"compilerOptions": {
		"module": "ESNext",
		"target": "ESNext",
		"moduleResolution": "Bundler",
		"allowJs": true,
		"outDir": "./dist",
		"checkJs": true,
		"strict": true
	},
	"include": ["**/*.ts", "**/*.js"]
}

```


####### sites/kit.svelte.dev/scripts/types/index.js #######

```

import { readFile, readdir, writeFile } from 'node:fs/promises';
import path from 'node:path';
import { fileURLToPath } from 'node:url';
import { format } from 'prettier';
import ts from 'typescript';
import { mkdirp } from '../../../../packages/kit/src/utils/filesystem.js';

/**
 * @typedef {{
 * name: string;
 * comment: string;
 * markdown?: string;
 * snippet: string;
 * deprecated: string | null;
 * children: Extracted[] }
 * } Extracted
 */

/** @type {Array<{ name: string; comment: string; exports: Extracted[]; types: Extracted[]; exempt?: boolean; }>} */
const modules = [];

/**
 * @param {string} code
 * @param {ts.NodeArray<ts.Statement>} statements
 */
async function get_types(code, statements) {
	/** @type {Extracted[]} */
	const exports = [];

	/** @type {Extracted[]} */
	const types = [];

	if (statements) {
		for (const statement of statements) {
			const modifiers = ts.canHaveModifiers(statement) ? ts.getModifiers(statement) : undefined;

			const export_modifier = modifiers?.find(
				(modifier) => modifier.kind === ts.SyntaxKind.ExportKeyword
			);

			if (!export_modifier) continue;

			if (
				ts.isClassDeclaration(statement) ||
				ts.isInterfaceDeclaration(statement) ||
				ts.isTypeAliasDeclaration(statement) ||
				ts.isModuleDeclaration(statement) ||
				ts.isVariableStatement(statement) ||
				ts.isFunctionDeclaration(statement)
			) {
				const name_node = ts.isVariableStatement(statement)
					? statement.declarationList.declarations[0]
					: statement;

				// @ts-ignore no idea why it's complaining here
				const name = name_node.name?.escapedText;

				let start = statement.pos;
				let comment = '';
				/** @type {string | null} */
				let deprecated_notice = null;

				// @ts-ignore i think typescript is bad at typescript
				if (statement.jsDoc) {
					// @ts-ignore
					const jsDoc = statement.jsDoc[0];

					// `@link` JSDoc tags (and maybe others?) turn this property into an array, which we need to join manually
					if (Array.isArray(jsDoc.comment)) {
						comment = jsDoc.comment
							.map(({ name, text }) => (name ? `\`${name.escapedText}\`` : text))
							.join('');
					} else {
						comment = jsDoc.comment;
					}

					if (jsDoc?.tags?.[0]?.tagName?.escapedText === 'deprecated') {
						deprecated_notice = jsDoc.tags[0].comment;
					}

					// @ts-ignore
					start = jsDoc.end;
				}

				const i = code.indexOf('export', start);
				start = i + 6;

				/** @type {Extracted[]} */
				let children = [];

				let snippet_unformatted = code.slice(start, statement.end).trim();

				if (ts.isInterfaceDeclaration(statement) || ts.isClassDeclaration(statement)) {
					if (statement.members.length > 0) {
						for (const member of statement.members) {
							// @ts-ignore
							children.push(munge_type_element(member));
						}

						children = children.filter(Boolean);

						// collapse `interface Foo {/* lots of stuff*/}` into `interface Foo {…}`
						const first = statement.members.at(0);
						const last = statement.members.at(-1);

						let body_start = first.pos - start;
						while (snippet_unformatted[body_start] !== '{') body_start -= 1;

						let body_end = last.end - start;
						while (snippet_unformatted[body_end] !== '}') body_end += 1;

						snippet_unformatted =
							snippet_unformatted.slice(0, body_start + 1) +
							'/*…*/' +
							snippet_unformatted.slice(body_end);
					}
				}

				const snippet = (
					await format(snippet_unformatted, {
						parser: 'typescript',
						printWidth: 60,
						useTabs: true,
						singleQuote: true,
						trailingComma: 'none'
					})
				)
					.replace(/\s*(\/\*…\*\/)\s*/g, '/*…*/')
					.trim();

				const collection =
					ts.isVariableStatement(statement) || ts.isFunctionDeclaration(statement)
						? exports
						: types;

				collection.push({
					name,
					comment,
					snippet,
					children,
					deprecated: deprecated_notice
				});
			}
		}

		types.sort((a, b) => (a.name < b.name ? -1 : 1));
		exports.sort((a, b) => (a.name < b.name ? -1 : 1));
	}

	return { types, exports };
}

/**
 * @param {ts.TypeElement} member
 */
function munge_type_element(member, depth = 1) {
	// @ts-ignore
	const doc = member.jsDoc?.[0];

	if (/private api/i.test(doc?.comment)) return;

	/** @type {string[]} */
	const children = [];

	const name = member.name?.escapedText;
	let snippet = member.getText();

	for (let i = -1; i < depth; i += 1) {
		snippet = snippet.replace(/^\t/gm, '');
	}

	if (
		ts.isPropertySignature(member) &&
		ts.isTypeLiteralNode(member.type) &&
		member.type.members.some((member) => member.jsDoc?.[0].comment)
	) {
		let a = 0;
		while (snippet[a] !== '{') a += 1;

		snippet = snippet.slice(0, a + 1) + '/*…*/}';

		for (const child of member.type.members) {
			children.push(munge_type_element(child, depth + 1));
		}
	}

	/** @type {string[]} */
	const bullets = [];

	for (const tag of doc?.tags ?? []) {
		const type = tag.tagName.escapedText;

		switch (tag.tagName.escapedText) {
			case 'private':
				bullets.push(`- <span class="tag">private</span> ${tag.comment}`);
				break;

			case 'readonly':
				bullets.push(`- <span class="tag">readonly</span> ${tag.comment}`);
				break;

			case 'param':
				bullets.push(`- \`${tag.name.getText()}\` ${tag.comment}`);
				break;

			case 'default':
				bullets.push(`- <span class="tag">default</span> \`${tag.comment}\``);
				break;

			case 'returns':
				bullets.push(`- <span class="tag">returns</span> ${tag.comment}`);
				break;

			case 'deprecated':
				bullets.push(`- <span class="tag deprecated">deprecated</span> ${tag.comment}`);
				break;

			default:
				console.log(`unhandled JSDoc tag: ${type}`); // TODO indicate deprecated stuff
		}
	}

	return {
		name,
		snippet,
		comment: (doc?.comment ?? '')
			.replace(/\/\/\/ type: (.+)/g, '/** @type {$1} */')
			.replace(/^(  )+/gm, (match, spaces) => {
				return '\t'.repeat(match.length / 2);
			}),
		bullets,
		children
	};
}

/**
 * Type declarations include fully qualified URLs so that they become links when
 * you hover over names in an editor with TypeScript enabled. We need to remove
 * the origin so that they become root-relative, so that they work in preview
 * deployments and when developing locally
 * @param {string} str
 */
function strip_origin(str) {
	return str.replace(/https:\/\/kit\.svelte\.dev/g, '');
}

/**
 * @param {string} file
 */
async function read_d_ts_file(file) {
	const resolved = path.resolve('../../packages/kit', file);

	// We can't use JSDoc comments inside JSDoc, so we would get ts(7031) errors if
	// we didn't ignore this error specifically for `/// file:` code examples
	const str = await readFile(resolved, 'utf-8');

	//! For some reason, typescript 5.1> is reading this @errors as a jsdoc tag, and splitting it into separate pieces
	return str.replace(/(\s*\*\s*)```js([\s\S]+?)```/g, (match, prefix, code) => {
		return `${prefix}\`\`\`js${prefix}// @errors: 7031${code}\`\`\``;
	});
}

{
	const code = await read_d_ts_file('src/types/private.d.ts');
	const node = ts.createSourceFile('private.d.ts', code, ts.ScriptTarget.Latest, true);

	modules.push({
		name: 'Private types',
		comment: '',
		...(await get_types(code, node.statements))
	});
}

const dir = fileURLToPath(
	new URL('../../../../packages/kit/src/types/synthetic', import.meta.url).href
);
for (const file of await readdir(dir)) {
	if (!file.endsWith('.md')) continue;

	const comment = strip_origin(await read_d_ts_file(`${dir}/${file}`));

	modules.push({
		name: file.replace(/\+/g, '/').slice(0, -3),
		comment,
		exports: [],
		types: [],
		exempt: true
	});
}

{
	const code = await read_d_ts_file('types/index.d.ts');
	const node = ts.createSourceFile('index.d.ts', code, ts.ScriptTarget.Latest, true);

	for (const statement of node.statements) {
		if (ts.isModuleDeclaration(statement)) {
			// @ts-ignore
			const name = statement.name.text || statement.name.escapedText;

			// @ts-ignore
			const comment = strip_origin(statement.jsDoc?.[0].comment ?? '');

			modules.push({
				name,
				comment,
				// @ts-ignore
				...(await get_types(code, statement.body?.statements))
			});
		}
	}
}

modules.sort((a, b) => (a.name < b.name ? -1 : 1));

mkdirp('src/lib/generated');
writeFile(
	'src/lib/generated/type-info.js',
	`
/* This file is generated by running \`pnpm run update\`
   in the sites/kit.svelte.dev directory — do not edit it */
export const modules = /** @type {import('@sveltejs/site-kit/markdown').Modules} */ (${JSON.stringify(
		modules.filter((m) => !m.name.startsWith('_')),
		null,
		'  '
	)});
`.trim()
);

```


####### sites/kit.svelte.dev/src/app.d.ts #######

```

// See https://kit.svelte.dev/docs/types#app
// for information about these interfaces
declare global {
	namespace App {
		// interface Error {}
		// interface Locals {}
		// interface PageData {}
		// interface Platform {}
	}
}

export {};

```


####### sites/kit.svelte.dev/src/app.html #######

```

<!doctype html>
<html lang="en" class="no-js">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#ff3e00" />
		<meta name="color-scheme" content="dark light" />

		<link rel="manifest" href="/manifest.json" />
		<link rel="icon" type="image/png" href="%sveltekit.assets%/favicon.png" />

		<meta name="twitter:card" content="summary" />
		<meta name="twitter:site" content="@sveltejs" />
		<meta name="twitter:creator" content="@sveltejs" />
		<meta name="twitter:image" content="https://kit.svelte.dev/images/twitter-thumbnail.jpg" />
		<meta name="og:image" content="https://kit.svelte.dev/images/twitter-thumbnail.jpg" />

		<link
			rel="search"
			type="application/opensearchdescription+xml"
			href="/opensearch.xml"
			title="SvelteKit"
		/>

		<!-- add inline style and blocking script to prevent content flash/jump -->
		<style>
			.ts-version {
				display: none;
			}
			body.prefers-ts .js-version {
				display: none;
			}
			body.prefers-ts .ts-version {
				display: block;
			}
			.no-js .ts-toggle {
				display: none;
			}
		</style>
		<script>
			document.getElementsByTagName('html')[0].classList.remove('no-js');
			localStorage.getItem('svelte:prefers-ts') === 'true' &&
				document.documentElement.classList.add('prefers-ts');
		</script>

		%sveltekit.head%
	</head>
	<body>
		<script>
			const themeValue = JSON.parse(localStorage.getItem('svelte:theme'))?.current;
			const systemPreferredTheme = window.matchMedia('(prefers-color-scheme: dark)').matches
				? 'dark'
				: 'light';

			document.body.classList.remove('light', 'dark');
			document.body.classList.add(themeValue ?? systemPreferredTheme);
		</script>

		<div style="height: 100%">%sveltekit.body%</div>
	</body>
</html>

```


####### sites/kit.svelte.dev/src/hooks.server.js #######

```

const redirects = {
	'/docs/amp': '/docs/seo#manual-setup-amp',
	'/docs/assets': '/docs/images',
	'/docs/typescript': '/docs/types'
};

const preload_types = ['js', 'css', 'font'];

/** @type {import('@sveltejs/kit').Handle} */
export function handle({ event, resolve }) {
	if (event.url.pathname in redirects) {
		return new Response(undefined, {
			status: 308,
			headers: {
				location: redirects[event.url.pathname]
			}
		});
	}

	return resolve(event, {
		preload: ({ type }) => preload_types.includes(type)
	});
}

```


####### sites/kit.svelte.dev/src/lib/server/docs/index.js #######

```

import { base } from '$app/paths';
import { modules } from '$lib/generated/type-info.js';
import {
	escape,
	extractFrontmatter,
	markedTransform,
	normalizeSlugify,
	removeMarkdown,
	replaceExportTypePlaceholders
} from '@sveltejs/site-kit/markdown';
import { render_content } from '../renderer';
import { read } from '$app/server';
import { error } from '@sveltejs/kit';

const meta = import.meta.glob('../../../../../../documentation/docs/*/meta.json', {
	query: '?url',
	import: 'default',
	eager: true
});

const markdown = import.meta.glob('../../../../../../documentation/docs/*/*.md', {
	query: '?url',
	import: 'default',
	eager: true
});

export const categories = {};
export const pages = {};

for (const [file, asset] of Object.entries(meta)) {
	const slug = /\/\d{2}-(.+)\/meta\.json$/.exec(file)[1];

	const { title, draft } = await read(asset).json();

	if (draft) continue;

	categories[slug] = {
		title,
		pages: []
	};
}

for (const [file, asset] of Object.entries(markdown)) {
	const [, category_dir, basename] = /\/(\d{2}-.+?)\/(\d{2}-.+\.md)$/.exec(file);
	const category_slug = category_dir.slice(3);
	const slug = basename.slice(3, -3); // strip the number prefix and .md suffix

	const category = categories[category_slug];
	if (!category) continue; // draft

	const {
		metadata: { draft, title, rank },
		body
	} = extractFrontmatter(await read(asset).text());

	if (draft === 'true') continue;

	category.pages.push({
		title,
		path: `${base}/docs/${slug}`
	});

	pages[slug] = {
		rank: +rank || undefined,
		category: category.title,
		title,
		file: `${category_dir}/${basename}`,
		slug,
		path: slug,
		sections: await get_sections(body),
		body
	};
}

/** @param {string} slug */
export async function get_parsed_docs(slug) {
	const page = pages[slug];
	if (!page) error(404);

	// TODO this should probably use a type from site-kit
	return {
		category: page.category,
		title: page.title,
		file: page.file,
		path: page.path,
		slug: page.slug,
		sections: page.sections,
		content: await render_content(page.file, page.body)
	};
}

export function get_docs_list() {
	return Object.values(categories);
}

/** @param {string} markdown */
async function get_sections(markdown) {
	/** @type {import('./types.js').Section[]} */
	const second_level_headings = [];

	const pattern = /^##\s+(.*)$/gm;
	let match;

	const placeholders_rendered = await replaceExportTypePlaceholders(markdown, modules);

	while ((match = pattern.exec(placeholders_rendered)) !== null) {
		second_level_headings.push({
			title: removeMarkdown(
				escape(await markedTransform(match[1], { paragraph: (txt) => txt }))
					.replace(/<\/?code>/g, '')
					.replace(/&#39;/g, "'")
					.replace(/&quot;/g, '"')
					.replace(/&lt;/g, '<')
					.replace(/&gt;/g, '>')
					.replace(/<(\/)?(em|b|strong|code)>/g, '')
			),
			slug: normalizeSlugify(match[1])
		});
	}

	return second_level_headings;
}

```


####### sites/kit.svelte.dev/src/lib/server/docs/types.d.ts #######

```

export type DocsData = Category[];

export interface Section {
	title: string;
	slug: string;
	/** Currently, we are only going with 2 level headings, so this will be undefined. In future, we may want to support 3 levels, in which case this will be a list of sections */
	sections?: Section[];
}

export type Category = {
	title: string;
	slug: string;
	pages: Page[];
};

export type Page = {
	title: string;
	slug: string;
	file: string;
	path: string;
	category: string;
	content: string;
	sections: Section[];
};

```


####### sites/kit.svelte.dev/src/lib/server/renderer.js #######

```

import { modules } from '$lib/generated/type-info.js';
import { renderContentMarkdown, slugify } from '@sveltejs/site-kit/markdown';
import { parse_route_id } from '../../../../../packages/kit/src/utils/routing.js';

/**
 * @param {string} filename
 * @param {string} body
 */
export const render_content = (filename, body) =>
	renderContentMarkdown(filename, body, {
		cacheCodeSnippets: true,
		modules,

		resolveTypeLinks: (module_name, type_name) => {
			if (module_name === '@sveltejs/kit') module_name = 'Public Types';

			return {
				page: `/docs/types`,
				slug: `${slugify(module_name)}-${slugify(type_name)}`
			};
		},

		twoslashBanner: (filename, source, language, options) => {
			const injected = [];

			if (
				source.includes('$app/') ||
				source.includes('$service-worker') ||
				source.includes('@sveltejs/kit/')
			) {
				injected.push(`// @filename: ambient-kit.d.ts`, `/// <reference types="@sveltejs/kit" />`);
			}

			if (source.includes('$env/')) {
				// TODO we're hardcoding static env vars that are used in code examples
				// in the types, which isn't... totally ideal, but will do for now
				injected.push(
					`declare module '$env/dynamic/private' { export const env: Record<string, string> }`,
					`declare module '$env/dynamic/public' { export const env: Record<string, string> }`,
					`declare module '$env/static/private' { export const API_KEY: string }`,
					`declare module '$env/static/public' { export const PUBLIC_BASE_URL: string }`
				);
			}

			if (source.includes('./$types') && !source.includes('@filename: $types.d.ts')) {
				const params = parse_route_id(`${options.file}` || `+page.${language}`)
					.params.map((param) => `${param.name}: string`)
					.join(', ');

				injected.push(
					`// @filename: $types.d.ts`,
					`import type * as Kit from '@sveltejs/kit';`,
					`export type PageLoad = Kit.Load<{${params}}>;`,
					`export type PageServerLoad = Kit.ServerLoad<{${params}}>;`,
					`export type LayoutLoad = Kit.Load<{${params}}>;`,
					`export type LayoutServerLoad = Kit.ServerLoad<{${params}}>;`,
					`export type RequestHandler = Kit.RequestHandler<{${params}}>;`,
					`export type Action = Kit.Action<{${params}}>;`,
					`export type Actions = Kit.Actions<{${params}}>;`,
					`export type EntryGenerator = () => Promise<Array<{${params}}>> | Array<{${params}}>;`
				);
			}

			// special case — we need to make allowances for code snippets coming
			// from e.g. ambient.d.ts
			if (filename.endsWith('30-modules.md')) {
				injected.push('// @errors: 7006 7031');
			}

			if (filename.endsWith('10-configuration.md')) {
				injected.push('// @errors: 2307');
			}

			// another special case
			if (source.includes('$lib/types')) {
				injected.push(`declare module '$lib/types' { export interface User {} }`);
			}

			return injected.join('\n');
		}
	});

```


####### sites/kit.svelte.dev/src/routes/content.json/content.server.js #######

```

import { modules } from '$lib/generated/type-info.js';
import { pages } from '$lib/server/docs/index.js';
import {
	markedTransform,
	replaceExportTypePlaceholders,
	slugify
} from '@sveltejs/site-kit/markdown';

const categories = [
	{
		slug: 'docs',
		label: null,
		href: (parts) =>
			parts.length > 1 ? `/docs/${parts[0]}#${parts.slice(1).join('-')}` : `/docs/${parts[0]}`
	}
];

export async function content() {
	/** @type {import('@sveltejs/site-kit/search').Block[]} */
	const blocks = [];

	for (const category of categories) {
		const breadcrumbs = category.label ? [category.label] : [];

		for (const [slug, page] of Object.entries(pages)) {
			const body = await replaceExportTypePlaceholders(page.body, modules);

			const sections = body.trim().split(/^## /m);
			const intro = sections.shift().trim();
			const rank = page.rank;

			blocks.push({
				breadcrumbs: [...breadcrumbs, page.title],
				href: category.href([slug]),
				content: await plaintext(intro),
				rank
			});

			for (const section of sections) {
				const lines = section.split('\n');
				const h3 = lines.shift();
				const content = lines.join('\n');

				const subsections = content.trim().split('### ');

				const intro = subsections.shift().trim();

				blocks.push({
					breadcrumbs: [...breadcrumbs, page.title, h3],
					href: category.href([slug, slugify(h3)]),
					content: await plaintext(intro),
					rank
				});

				for (const subsection of subsections) {
					const lines = subsection.split('\n');
					const h4 = lines.shift();

					blocks.push({
						breadcrumbs: [...breadcrumbs, page.title, h3, h4],
						href: category.href([slug, slugify(h3), slugify(h4)]),
						content: await plaintext(lines.join('\n').trim()),
						rank
					});
				}
			}
		}
	}

	return blocks;
}

/** @param {string} markdown  */
async function plaintext(markdown) {
	const block = (text) => `${text}\n`;
	const inline = (text) => text;

	return (
		await markedTransform(markdown, {
			code: (source) =>
				source
					.split('// ---cut---\n')
					.pop()
					.replace(/^\/\/((\/ file:)|( @errors:))[\s\S]*/gm, ''),
			blockquote: block,
			html: () => '\n',
			heading: (text) => `${text}\n`,
			hr: () => '',
			list: block,
			listitem: block,
			checkbox: block,
			paragraph: (text) => `${text}\n\n`,
			table: block,
			tablerow: block,
			tablecell: (text, opts) => {
				return text + ' ';
			},
			strong: inline,
			em: inline,
			codespan: inline,
			br: () => '',
			del: inline,
			link: (href, title, text) => text,
			image: (href, title, text) => text,
			text: inline
		})
	)
		.replace(/&lt;/g, '<')
		.replace(/&gt;/g, '>')
		.replace(/&#(\d+);/g, (match, code) => {
			return String.fromCharCode(code);
		})
		.trim();
}

```


####### sites/kit.svelte.dev/src/routes/content.json/+server.js #######

```

import { content } from './content.server.js';
import { json } from '@sveltejs/kit';

export const prerender = true;

export async function GET() {
	return json({
		blocks: await content()
	});
}

```


####### sites/kit.svelte.dev/src/routes/docs/+layout.server.js #######

```

import { get_docs_list } from '$lib/server/docs/index.js';

export const prerender = true;

export async function load() {
	return {
		sections: get_docs_list()
	};
}

```


####### sites/kit.svelte.dev/src/routes/docs/+layout.svelte #######

```

<script>
	import { page } from '$app/stores';
	import { DocsContents } from '@sveltejs/site-kit/docs';

	export let data;

	$: category = $page.data.page?.category;
</script>

<div class="container">
	<div class="page">
		{#if category}
			<p class="category">{category}</p>
		{/if}
		<slot />
	</div>

	<div class="toc-container">
		<DocsContents contents={data.sections} />
	</div>
</div>

<style>
	.container {
		--sidebar-menu-width: 28rem;
		--sidebar-width: var(--sidebar-menu-width);
		--ts-toggle-height: 4.2rem;
	}

	.page {
		--on-this-page-display: none;
		padding: var(--sk-page-padding-top) var(--sk-page-padding-side);
	}

	.category {
		font: 700 var(--sk-text-s) var(--sk-font);
		text-transform: uppercase;
		letter-spacing: 0.12em;
		margin: 0 0 0.5em;
		color: var(--sk-text-3);
	}

	.toc-container {
		background: var(--sk-back-3);
		display: none;
	}

	@media (min-width: 832px) {
		.toc-container {
			display: block;
			width: var(--sidebar-width);
			height: calc(
				100vh - var(--sk-nav-height) - var(--ts-toggle-height) - var(--sk-banner-bottom-height)
			);
			position: fixed;
			left: 0;
			top: var(--sk-nav-height);
			overflow: hidden;
		}

		.toc-container::before {
			content: '';
			position: fixed;
			width: 0;
			height: 100%;
			top: 0;
			left: calc(var(--sidebar-width) - 1px);
			border-right: 1px solid var(--sk-back-5);
		}

		.page {
			padding-left: calc(var(--sidebar-width) + var(--sk-page-padding-side));
		}
	}

	@media (min-width: 1200px) {
		.container {
			--sidebar-width: max(28rem, 23vw);
		}

		.page {
			--on-this-page-display: block;
			padding: var(--sk-page-padding-top) calc(var(--sidebar-width) + var(--sk-page-padding-side));
			margin: 0 auto;
			max-width: var(--sk-line-max-width);
			box-sizing: content-box;
		}
	}
</style>

```


####### sites/kit.svelte.dev/src/routes/docs/+page.js #######

```

import { redirect } from '@sveltejs/kit';

export function load() {
	redirect(307, `./docs/introduction`);
}

```


####### sites/kit.svelte.dev/src/routes/docs/[slug]/+page.server.js #######

```

import { get_parsed_docs } from '$lib/server/docs/index.js';

export const prerender = true;

export async function load({ params }) {
	return { page: await get_parsed_docs(params.slug) };
}

```


####### sites/kit.svelte.dev/src/routes/docs/[slug]/+page.svelte #######

```

<script>
	import { page } from '$app/stores';
	import { copy_code_descendants } from '@sveltejs/site-kit/actions';
	import { Icon } from '@sveltejs/site-kit/components';
	import { DocsOnThisPage, setupDocsHovers } from '@sveltejs/site-kit/docs';
	import { onMount } from 'svelte';

	export let data;

	$: pages = data.sections.flatMap((section) => section.pages);
	$: index = pages.findIndex(({ path }) => path === $page.url.pathname);
	$: prev = pages[index - 1];
	$: next = pages[index + 1];

	setupDocsHovers();

	const redirects = {
		hmr: 'how-do-i-use-hmr-with-sveltekit',
		'read-package-json': 'how-do-i-include-details-from-package-json-in-my-application',
		packages: 'how-do-i-fix-the-error-i-m-getting-trying-to-include-a-package',
		integrations: 'how-do-i-use-x-with-sveltekit',
		'how-do-i-setup-a-database': 'how-do-i-use-x-with-sveltekit-how-do-i-setup-a-database',
		'how-do-i-use-a-client-side-only-library-that-depends-on-document-or-window':
			'how-do-i-use-x-with-sveltekit-how-do-i-use-a-client-side-only-library-that-depends-on-document-or-window',
		'how-do-i-use-a-different-backend-api-server':
			'how-do-i-use-x-with-sveltekit-how-do-i-use-a-different-backend-api-server',
		'how-do-i-use-middleware': 'how-do-i-use-x-with-sveltekit-how-do-i-use-middleware',
		'does-it-work-with-yarn-2': 'how-do-i-use-x-with-sveltekit-does-it-work-with-yarn-2',
		'how-do-i-use-with-yarn-3': 'how-do-i-use-x-with-sveltekit-how-do-i-use-with-yarn-3'
	};

	onMount(() => {
		if ($page.url.pathname !== '/docs/faq') return;

		const hash = $page.url.hash.replace(/^#/, '');

		if (!redirects[hash]) return;

		document.location.hash = `#${redirects[hash]}`;
	});
</script>

<svelte:head>
	<title>{data.page.title} • Docs • SvelteKit</title>

	<meta name="twitter:title" content="SvelteKit docs" />
	<meta name="twitter:description" content="{data.page.title} • SvelteKit documentation" />
	<meta name="Description" content="{data.page.title} • SvelteKit documentation" />
</svelte:head>

<div class="text content" use:copy_code_descendants>
	<h1>{data.page.title}</h1>

	<a
		class="edit"
		href="https://github.com/sveltejs/kit/edit/main/documentation/docs/{data.page.file}"
	>
		<Icon size={50} name="edit" /> Edit this page on GitHub
	</a>

	<DocsOnThisPage details={data.page} />

	<section>
		{@html data.page.content}
	</section>

	<div class="controls">
		<div>
			<span class:faded={!prev}>previous</span>
			{#if prev}
				<a href={prev.path}>{prev.title}</a>
			{/if}
		</div>

		<div>
			<span class:faded={!next}>next</span>
			{#if next}
				<a href={next.path}>{next.title}</a>
			{/if}
		</div>
	</div>
</div>

<style>
	.content {
		width: 100%;
		margin: 0;
	}

	.edit {
		position: relative;
		font-size: 1.4rem;
		line-height: 1;
		z-index: 2;
	}

	.edit :global(.icon) {
		position: relative;
		top: -0.1rem;
		left: 0.3rem;
		width: 1.4rem;
		height: 1.4rem;
		margin-right: 0.5rem;
	}

	.controls {
		max-width: calc(var(--sk-line-max-width) + 1rem);
		border-top: 1px solid var(--sk-back-4);
		padding: 1rem 0 0 0;
		display: grid;
		grid-template-columns: 1fr 1fr;
		margin: 6rem 0 0 0;
	}

	.controls > :first-child {
		text-align: left;
	}

	.controls > :last-child {
		text-align: right;
	}

	.controls span {
		display: block;
		font-size: 1.2rem;
		text-transform: uppercase;
		font-weight: 600;
		color: var(--sk-text-3);
	}

	.controls span.faded {
		opacity: 0.4;
	}
</style>

```


####### sites/kit.svelte.dev/src/routes/edge.svg/countries.json #######

```

{
	"AF": "Afghanistan",
	"AL": "Albania",
	"DZ": "Algeria",
	"AS": "American Samoa",
	"AD": "Andorra",
	"AO": "Angola",
	"AI": "Anguilla",
	"AQ": "Antarctica",
	"AG": "Antigua and Barbuda",
	"AR": "Argentina",
	"AM": "Armenia",
	"AW": "Aruba",
	"AU": "Australia",
	"AT": "Austria",
	"AZ": "Azerbaijan",
	"BS": "Bahamas (the)",
	"BH": "Bahrain",
	"BD": "Bangladesh",
	"BB": "Barbados",
	"BY": "Belarus",
	"BE": "Belgium",
	"BZ": "Belize",
	"BJ": "Benin",
	"BM": "Bermuda",
	"BT": "Bhutan",
	"BO": "Bolivia",
	"BQ": "Bonaire, Sint Eustatius and Saba",
	"BA": "Bosnia and Herzegovina",
	"BW": "Botswana",
	"BV": "Bouvet Island",
	"BR": "Brazil",
	"IO": "British Indian Ocean Territory",
	"BN": "Brunei Darussalam",
	"BG": "Bulgaria",
	"BF": "Burkina Faso",
	"BI": "Burundi",
	"CV": "Cabo Verde",
	"KH": "Cambodia",
	"CM": "Cameroon",
	"CA": "Canada",
	"KY": "Cayman Islands",
	"CF": "Central African Republic",
	"TD": "Chad",
	"CL": "Chile",
	"CN": "China",
	"CX": "Christmas Island",
	"CC": "Cocos (Keeling) Islands",
	"CO": "Colombia",
	"KM": "Comoros",
	"CD": "Congo (Kinshasa)",
	"CG": "Congo (Brazzaville)",
	"CK": "Cook Islands",
	"CR": "Costa Rica",
	"HR": "Croatia",
	"CU": "Cuba",
	"CW": "Curaçao",
	"CY": "Cyprus",
	"CZ": "Czechia",
	"CI": "Côte d'Ivoire",
	"DK": "Denmark",
	"DJ": "Djibouti",
	"DM": "Dominica",
	"DO": "Dominican Republic",
	"EC": "Ecuador",
	"EG": "Egypt",
	"SV": "El Salvador",
	"GQ": "Equatorial Guinea",
	"ER": "Eritrea",
	"EE": "Estonia",
	"SZ": "Eswatini",
	"ET": "Ethiopia",
	"FK": "Falkland Islands",
	"FO": "Faroe Islands",
	"FJ": "Fiji",
	"FI": "Finland",
	"FR": "France",
	"GF": "French Guiana",
	"PF": "French Polynesia",
	"TF": "French Southern Territories",
	"GA": "Gabon",
	"GM": "Gambia",
	"GE": "Georgia",
	"DE": "Germany",
	"GH": "Ghana",
	"GI": "Gibraltar",
	"GR": "Greece",
	"GL": "Greenland",
	"GD": "Grenada",
	"GP": "Guadeloupe",
	"GU": "Guam",
	"GT": "Guatemala",
	"GG": "Guernsey",
	"GN": "Guinea",
	"GW": "Guinea-Bissau",
	"GY": "Guyana",
	"HT": "Haiti",
	"HM": "Heard Island and McDonald Islands",
	"VA": "Holy See",
	"HN": "Honduras",
	"HK": "Hong Kong",
	"HU": "Hungary",
	"IS": "Iceland",
	"IN": "India",
	"ID": "Indonesia",
	"IR": "Iran",
	"IQ": "Iraq",
	"IE": "Ireland",
	"IM": "Isle of Man",
	"IL": "Israel",
	"IT": "Italy",
	"JM": "Jamaica",
	"JP": "Japan",
	"JE": "Jersey",
	"JO": "Jordan",
	"KZ": "Kazakhstan",
	"KE": "Kenya",
	"KI": "Kiribati",
	"KP": "DPRK",
	"KR": "Republic of Korea",
	"KW": "Kuwait",
	"KG": "Kyrgyzstan",
	"LA": "Laos",
	"LV": "Latvia",
	"LB": "Lebanon",
	"LS": "Lesotho",
	"LR": "Liberia",
	"LY": "Libya",
	"LI": "Liechtenstein",
	"LT": "Lithuania",
	"LU": "Luxembourg",
	"MO": "Macao",
	"MG": "Madagascar",
	"MW": "Malawi",
	"MY": "Malaysia",
	"MV": "Maldives",
	"ML": "Mali",
	"MT": "Malta",
	"MH": "Marshall Islands",
	"MQ": "Martinique",
	"MR": "Mauritania",
	"MU": "Mauritius",
	"YT": "Mayotte",
	"MX": "Mexico",
	"FM": "Micronesia",
	"MD": "Moldova",
	"MC": "Monaco",
	"MN": "Mongolia",
	"ME": "Montenegro",
	"MS": "Montserrat",
	"MA": "Morocco",
	"MZ": "Mozambique",
	"MM": "Myanmar",
	"NA": "Namibia",
	"NR": "Nauru",
	"NP": "Nepal",
	"NL": "Netherlands",
	"NC": "New Caledonia",
	"NZ": "New Zealand",
	"NI": "Nicaragua",
	"NE": "Niger",
	"NG": "Nigeria",
	"NU": "Niue",
	"NF": "Norfolk Island",
	"MP": "Northern Mariana Islands",
	"NO": "Norway",
	"OM": "Oman",
	"PK": "Pakistan",
	"PW": "Palau",
	"PS": "Palestine",
	"PA": "Panama",
	"PG": "Papua New Guinea",
	"PY": "Paraguay",
	"PE": "Peru",
	"PH": "Philippines",
	"PN": "Pitcairn",
	"PL": "Poland",
	"PT": "Portugal",
	"PR": "Puerto Rico",
	"QA": "Qatar",
	"MK": "North Macedonia",
	"RO": "Romania",
	"RU": "Russian Federation",
	"RW": "Rwanda",
	"RE": "Réunion",
	"BL": "Saint Barthélemy",
	"SH": "Saint Helena, Ascension and Tristan da Cunha",
	"KN": "Saint Kitts and Nevis",
	"LC": "Saint Lucia",
	"MF": "Saint Martin (French part)",
	"PM": "Saint Pierre and Miquelon",
	"VC": "Saint Vincent and the Grenadines",
	"WS": "Samoa",
	"SM": "San Marino",
	"ST": "Sao Tome and Principe",
	"SA": "Saudi Arabia",
	"SN": "Senegal",
	"RS": "Serbia",
	"SC": "Seychelles",
	"SL": "Sierra Leone",
	"SG": "Singapore",
	"SX": "Sint Maarten (Dutch part)",
	"SK": "Slovakia",
	"SI": "Slovenia",
	"SB": "Solomon Islands",
	"SO": "Somalia",
	"ZA": "South Africa",
	"GS": "South Georgia and the South Sandwich Islands",
	"SS": "South Sudan",
	"ES": "Spain",
	"LK": "Sri Lanka",
	"SD": "Sudan (the)",
	"SR": "Suriname",
	"SJ": "Svalbard and Jan Mayen",
	"SE": "Sweden",
	"CH": "Switzerland",
	"SY": "Syrian Arab Republic",
	"TW": "Taiwan",
	"TJ": "Tajikistan",
	"TZ": "Tanzania",
	"TH": "Thailand",
	"TL": "Timor-Leste",
	"TG": "Togo",
	"TK": "Tokelau",
	"TO": "Tonga",
	"TT": "Trinidad and Tobago",
	"TN": "Tunisia",
	"TR": "Turkey",
	"TM": "Turkmenistan",
	"TC": "Turks and Caicos Islands (the)",
	"TV": "Tuvalu",
	"UG": "Uganda",
	"UA": "Ukraine",
	"AE": "UAE",
	"GB": "UK",
	"UM": "United States Minor Outlying Islands",
	"US": "USA",
	"UY": "Uruguay",
	"UZ": "Uzbekistan",
	"VU": "Vanuatu",
	"VE": "Venezuela",
	"VN": "Vietnam",
	"VG": "British Virgin Islands",
	"VI": "US Virgin Islands",
	"WF": "Wallis and Futuna",
	"EH": "Western Sahara",
	"YE": "Yemen",
	"ZM": "Zambia",
	"ZW": "Zimbabwe",
	"AX": "Åland Islands"
}

```


####### sites/kit.svelte.dev/src/routes/edge.svg/land-110m.json #######

```

{"type":"Topology","objects":{"land":{"type":"GeometryCollection","geometries":[{"type":"MultiPolygon","arcs":[[[0]],[[1]],[[2]],[[3]],[[4]],[[5]],[[6]],[[7]],[[8]],[[9]],[[10]],[[11]],[[12]],[[13]],[[14]],[[15]],[[16,18]],[[19]],[[20]],[[21]],[[22]],[[23]],[[24]],[[25]],[[26]],[[27]],[[28]],[[29]],[[30]],[[31]],[[32]],[[33]],[[34]],[[35]],[[36]],[[37]],[[38]],[[39]],[[40]],[[41]],[[42]],[[43]],[[44]],[[45]],[[46]],[[47]],[[48]],[[49]],[[50]],[[51]],[[52]],[[53]],[[54]],[[55]],[[56]],[[57]],[[58]],[[59]],[[60]],[[61]],[[62]],[[63]],[[64]],[[65]],[[66]],[[67]],[[68]],[[69]],[[70]],[[71]],[[72]],[[73]],[[74]],[[75]],[[76]],[[77]],[[78]],[[79]],[[80]],[[81]],[[82]],[[83]],[[84]],[[85]],[[86]],[[87]],[[88]],[[89]],[[90]],[[91]],[[92,115],[114]],[[94]],[[95]],[[96]],[[97]],[[98]],[[99]],[[100]],[[101]],[[102]],[[103]],[[104]],[[105]],[[106]],[[107]],[[108]],[[109]],[[110]],[[111]],[[112]],[[113]],[[116]],[[117]],[[118]],[[119]],[[120]],[[121]],[[122]],[[123]],[[124]],[[125]],[[126]],[[127]],[[128]],[[129]]]}]}},"arcs":[[[33452,3290],[-82,-301],[-81,-266],[-582,81],[-621,-35],[-348,197],[0,23],[-152,174],[625,-23],[599,-58],[207,243],[147,208],[288,-243]],[[5775,3611],[-533,-81],[-364,208],[-163,209],[-11,35],[-180,162],[169,220],[517,-93],[277,-185],[212,-209],[76,-266]],[[37457,4468],[342,-255],[120,-359],[33,-254],[11,-301],[-430,-186],[-452,-150],[-522,-139],[-582,-116],[-658,35],[-365,197],[49,243],[593,162],[239,197],[174,254],[126,220],[168,209],[180,243],[141,0],[414,127],[419,-127]],[[16330,7154],[359,-93],[332,104],[-158,-208],[-261,-151],[-386,47],[-278,208],[60,197],[332,-104]],[[15122,7165],[425,-231],[-164,23],[-359,58],[-381,162],[202,127],[277,-139]],[[22505,8080],[305,-81],[304,69],[163,-335],[-217,46],[-337,-23],[-343,23],[-376,-35],[-283,116],[-146,243],[174,104],[353,-81],[403,-46]],[[30985,8657],[33,-266],[-49,-231],[-76,-220],[-326,-81],[-311,-116],[-364,11],[136,232],[-327,-81],[-310,-81],[-212,174],[-16,243],[305,231],[190,70],[321,-23],[82,301],[16,219],[-6,475],[158,278],[256,93],[147,-220],[65,-220],[120,-267],[92,-254],[76,-267]],[[0,529],[16,-5],[245,344],[501,-185],[32,21],[78,49],[94,61],[81,52],[41,26],[41,-1],[29,-10],[402,-246],[352,246],[63,34],[816,104],[265,-138],[130,-71],[419,-196],[789,-151],[625,-185],[1072,-139],[800,162],[1181,-116],[669,-185],[734,174],[773,162],[60,278],[-1094,23],[-898,139],[-234,231],[-745,128],[49,266],[103,243],[104,220],[-55,243],[-462,162],[-212,209],[-430,185],[675,-35],[642,93],[402,-197],[495,173],[457,220],[223,197],[-98,243],[-359,162],[-408,174],[-571,35],[-500,81],[-539,58],[-180,220],[-359,185],[-217,208],[-87,672],[136,-58],[250,-185],[457,58],[441,81],[228,-255],[441,58],[370,127],[348,162],[315,197],[419,58],[-11,220],[-97,220],[81,208],[359,104],[163,-196],[425,115],[321,151],[397,12],[375,57],[376,139],[299,128],[337,127],[218,-35],[190,-46],[414,81],[370,-104],[381,11],[364,81],[375,-57],[414,-58],[386,23],[403,-12],[413,-11],[381,23],[283,174],[337,92],[349,-127],[331,104],[300,208],[179,-185],[98,-208],[180,-197],[288,174],[332,-220],[375,-70],[321,-162],[392,35],[354,104],[418,-23],[376,-81],[381,-104],[147,254],[-180,197],[-136,209],[-359,46],[-158,220],[-60,220],[-98,440],[213,-81],[364,-35],[359,35],[327,-93],[283,-174],[119,-208],[376,-35],[359,81],[381,116],[342,70],[283,-139],[370,46],[239,451],[224,-266],[321,-104],[348,58],[228,-232],[365,-23],[337,-69],[332,-128],[218,220],[108,209],[278,-232],[381,58],[283,-127],[190,-197],[370,58],[288,127],[283,151],[337,81],[392,69],[354,81],[272,127],[163,186],[65,254],[-32,244],[-87,231],[-98,232],[-87,231],[-71,209],[-16,231],[27,232],[130,220],[109,243],[44,231],[-55,255],[-32,232],[136,266],[152,173],[180,220],[190,186],[223,173],[109,255],[152,162],[174,151],[267,34],[174,186],[196,115],[228,70],[202,150],[157,186],[218,69],[163,-151],[-103,-196],[-283,-174],[-120,-127],[-206,92],[-229,-58],[-190,-139],[-202,-150],[-136,-174],[-38,-231],[17,-220],[130,-197],[-190,-139],[-261,-46],[-153,-197],[-163,-185],[-174,-255],[-44,-220],[98,-243],[147,-185],[229,-139],[212,-185],[114,-232],[60,-220],[82,-232],[130,-196],[82,-220],[38,-544],[81,-220],[22,-232],[87,-231],[-38,-313],[-152,-243],[-163,-197],[-370,-81],[-125,-208],[-169,-197],[-419,-220],[-370,-93],[-348,-127],[-376,-128],[-223,-243],[-446,-23],[-489,23],[-441,-46],[-468,0],[87,-232],[424,-104],[311,-162],[174,-208],[-310,-185],[-479,58],[-397,-151],[-17,-243],[-11,-232],[327,-196],[60,-220],[353,-220],[588,-93],[500,-162],[398,-185],[506,-186],[690,-92],[681,-162],[473,-174],[517,-197],[272,-278],[136,-220],[337,209],[457,173],[484,186],[577,150],[495,162],[691,12],[680,-81],[560,-139],[180,255],[386,173],[702,12],[550,127],[522,128],[577,81],[614,104],[430,150],[-196,209],[-119,208],[0,220],[-539,-23],[-571,-93],[-544,0],[-77,220],[39,440],[125,128],[397,138],[468,139],[337,174],[337,174],[251,231],[380,104],[376,81],[190,47],[430,23],[408,81],[343,116],[337,139],[305,139],[386,185],[245,197],[261,173],[82,232],[-294,139],[98,243],[185,185],[288,116],[305,139],[283,185],[217,232],[136,277],[202,163],[331,-35],[136,-197],[332,-23],[11,220],[142,231],[299,-58],[71,-220],[331,-34],[360,104],[348,69],[315,-34],[120,-243],[305,196],[283,105],[315,81],[310,81],[283,139],[310,92],[240,128],[168,208],[207,-151],[288,81],[202,-277],[157,-209],[316,116],[125,232],[283,162],[365,-35],[108,-220],[229,220],[299,69],[326,23],[294,-11],[310,-70],[300,-34],[130,-197],[180,-174],[304,104],[327,24],[315,0],[310,11],[278,81],[294,70],[245,162],[261,104],[283,58],[212,162],[152,324],[158,197],[288,-93],[109,-208],[239,-139],[289,46],[196,-208],[206,-151],[283,139],[98,255],[250,104],[289,197],[272,81],[326,116],[218,127],[228,139],[218,127],[261,-69],[250,208],[180,162],[261,-11],[229,139],[54,208],[234,162],[228,116],[278,93],[256,46],[244,-35],[262,-58],[223,-162],[27,-254],[245,-197],[168,-162],[332,-70],[185,-162],[229,-162],[266,-35],[223,116],[240,243],[261,-127],[272,-70],[261,-69],[272,-46],[277,0],[229,-614],[-11,-150],[-33,-267],[-266,-150],[-218,-220],[38,-232],[310,12],[-38,-232],[-141,-220],[-131,-243],[212,-185],[321,-58],[321,104],[153,232],[92,220],[153,185],[174,174],[70,208],[147,289],[174,58],[316,24],[277,69],[283,93],[136,231],[82,220],[190,220],[272,151],[234,115],[153,197],[157,104],[202,93],[277,-58],[250,58],[272,69],[305,-34],[201,162],[142,393],[103,-162],[131,-278],[234,-115],[266,-47],[267,70],[283,-46],[261,-12],[174,58],[234,-35],[212,-127],[250,81],[300,0],[255,81],[289,-81],[185,197],[141,196],[191,163],[348,439],[179,-81],[212,-162],[185,-208],[354,-359],[272,-12],[256,0],[299,70],[299,81],[229,162],[190,174],[310,23],[207,127],[218,-116],[141,-185],[196,-185],[305,23],[190,-150],[332,-151],[348,-58],[288,47],[218,185],[185,185],[250,46],[251,-81],[288,-58],[261,93],[250,0],[245,-58],[256,-58],[250,104],[299,93],[283,23],[316,0],[255,58],[251,46],[76,290],[11,243],[174,-162],[49,-266],[92,-244],[115,-196],[234,-105],[315,35],[365,12],[250,35],[364,0],[262,11],[364,-23],[310,-46],[196,-186],[-54,-220],[179,-173],[299,-139],[310,-151],[360,-104],[375,-92],[283,-93],[315,-12],[180,197],[245,-162],[212,-185],[245,-139],[337,-58],[321,-69],[136,-232],[316,-139],[212,-208],[310,-93],[321,12],[299,-35],[332,12],[332,-47],[310,-81],[288,-139],[289,-116],[195,-173],[-32,-232],[-147,-208],[-125,-266],[-98,-209],[-131,-243],[-364,-93],[-163,-208],[-360,-127],[-125,-232],[-190,-220],[-201,-185],[-115,-243],[-70,-220],[-28,-266],[6,-220],[158,-232],[60,-220],[130,-208],[517,-81],[109,-255],[-501,-93],[-424,-127],[-528,-23],[-234,-336],[-49,-278],[-119,-220],[-147,-220],[370,-196],[141,-244],[239,-219],[338,-197],[386,-186],[419,-185],[636,-185],[142,-289],[800,-128],[53,-45],[208,-175],[767,151],[636,-186],[-99520,-142]],[[31180,18764],[361,-355],[389,-147],[-125,-296],[-264,-29],[-141,208],[-92,-239],[-238,-183],[-301,67],[-202,177],[-291,86],[-350,330],[-283,317],[-383,662],[229,-124],[390,-395],[369,-212],[143,271],[90,405],[256,244],[198,-70],[106,-274],[139,-443]],[[33736,20389],[222,-266],[-83,-207],[-375,-177],[-125,207],[-236,-266],[-139,266],[333,354],[236,-148],[167,237]],[[69522,21210],[-427,-38],[-7,314],[41,244],[19,121],[179,-186],[263,-74],[9,-112],[-77,-269]],[[90387,26479],[269,-204],[151,81],[217,113],[166,-39],[20,-702],[-95,-203],[-29,-476],[-97,162],[-193,-412],[-57,32],[-171,19],[-171,505],[-38,390],[-160,515],[7,271],[181,-52]],[[98060,26404],[63,-244],[198,239],[80,-249],[0,-249],[-103,-274],[-182,-435],[-142,-238],[103,-284],[-214,-7],[-238,-223],[-75,-387],[-157,-597],[-219,-264],[-138,-169],[-256,13],[-180,194],[-302,42],[-46,217],[149,438],[349,583],[179,111],[200,225],[238,310],[167,306],[123,441],[106,149],[41,330],[195,273],[61,-251]],[[98502,29218],[202,-622],[5,403],[126,-161],[41,-447],[224,-192],[188,-48],[158,226],[141,-69],[-67,-524],[-85,-345],[-212,12],[-74,-179],[26,-254],[-41,-110],[-105,-319],[-138,-404],[-214,-236],[-48,155],[-116,85],[160,486],[-91,326],[-299,236],[8,214],[201,206],[47,455],[-13,382],[-113,396],[8,104],[-133,244],[-218,523],[-117,418],[104,46],[151,-328],[216,-153],[78,-526]],[[96421,37487],[-105,-142],[-153,160],[-199,266],[-179,313],[-184,416],[-38,201],[119,-9],[156,-201],[122,-200],[89,-166],[228,-366],[144,-272]],[[99547,40335],[96,-171],[-46,-308],[-172,-81],[-153,73],[-27,260],[107,203],[126,-74],[69,98]],[[0,40798],[99822,-145],[-177,-124],[-36,220],[139,121],[88,33],[-99836,184]],[[0,41087],[0,-289]],[[0,41087],[57,27],[-34,-284],[-23,-32]],[[96623,40851],[-92,-78],[-93,259],[10,158],[175,-339]],[[96418,41756],[45,-476],[-75,74],[-58,-32],[-39,163],[-6,453],[133,-182]],[[63904,42571],[45,-711],[72,-276],[-28,-284],[-49,-174],[-94,347],[-53,-175],[53,-438],[-24,-250],[-77,-137],[-18,-500],[-109,-689],[-137,-814],[-172,-1120],[-106,-821],[-125,-685],[-226,-140],[-243,-250],[-160,151],[-220,211],[-77,312],[-18,524],[-98,471],[-26,425],[50,426],[128,102],[1,197],[133,447],[25,377],[-65,280],[-52,372],[-23,544],[97,331],[38,375],[138,22],[155,121],[103,107],[122,7],[158,337],[229,364],[83,297],[-38,253],[118,-71],[153,410],[6,356],[92,264],[96,-254],[74,-251],[69,-390]],[[89877,42448],[100,-464],[179,223],[92,-250],[133,-231],[-29,-262],[60,-506],[42,-295],[70,-72],[75,-505],[-27,-307],[90,-400],[301,-309],[197,-281],[186,-257],[-37,-143],[159,-371],[108,-639],[111,130],[113,-256],[68,91],[48,-626],[197,-363],[129,-226],[217,-478],[78,-475],[7,-337],[-19,-365],[132,-502],[-16,-523],[-48,-274],[-75,-527],[6,-339],[-55,-423],[-123,-538],[-205,-290],[-102,-458],[-93,-292],[-82,-510],[-107,-294],[-70,-442],[-36,-407],[14,-187],[-159,-205],[-311,-22],[-257,-242],[-127,-229],[-168,-254],[-230,262],[-170,104],[43,308],[-152,-112],[-243,-428],[-240,160],[-158,94],[-159,42],[-269,171],[-179,364],[-52,449],[-64,298],[-137,240],[-267,71],[91,287],[-67,438],[-136,-408],[-247,-109],[146,327],[42,341],[107,289],[-22,438],[-226,-504],[-174,-202],[-106,-470],[-217,243],[9,313],[-174,429],[-147,221],[52,137],[-356,358],[-195,17],[-267,287],[-498,-56],[-359,-211],[-317,-197],[-265,39],[-294,-303],[-241,-137],[-53,-309],[-103,-240],[-236,-15],[-174,-52],[-246,107],[-199,-64],[-191,-27],[-165,-315],[-81,26],[-140,-167],[-133,-187],[-203,23],[-186,0],[-295,377],[-149,113],[6,338],[138,81],[47,134],[-10,212],[34,411],[-31,350],[-147,598],[-45,337],[12,336],[-111,385],[-7,174],[-123,235],[-35,463],[-158,467],[-39,252],[122,-255],[-93,548],[137,-171],[83,-229],[-5,303],[-138,465],[-26,186],[-65,177],[31,341],[56,146],[38,295],[-29,346],[114,425],[21,-450],[118,406],[225,198],[136,252],[212,217],[126,46],[77,-73],[219,220],[168,66],[42,129],[74,54],[153,-14],[292,173],[151,262],[71,316],[163,300],[13,236],[7,321],[194,502],[117,-510],[119,118],[-99,279],[87,287],[122,-128],[34,449],[152,291],[67,233],[140,101],[4,165],[122,-69],[5,148],[122,85],[134,80],[205,-271],[155,-350],[173,-4],[177,-56],[-59,325],[133,473],[126,155],[-44,147],[121,338],[168,208],[142,-70],[234,111],[-5,302],[-204,195],[148,86],[184,-147],[148,-242],[234,-151],[79,60],[172,-182],[162,169],[105,-51],[65,113],[127,-292],[-74,-316],[-105,-239],[-96,-20],[32,-236],[-81,-295],[-99,-291],[20,-166],[221,-327],[214,-189],[143,-204],[201,-350],[78,1],[145,-151],[43,-183],[265,-200],[183,202],[55,317],[56,262],[34,324],[85,470],[-39,286],[20,171],[-32,339],[37,445],[53,120],[-43,197],[67,313],[52,325],[7,168],[104,222],[78,-289],[19,-371],[70,-71],[11,-249],[101,-300],[21,-335],[-10,-214]],[[95032,44386],[78,-203],[-194,4],[-106,363],[166,-142],[56,-22]],[[83531,44530],[-117,-11],[-368,414],[259,116],[146,-180],[97,-180],[-17,-159]],[[94680,44747],[-108,-14],[-170,60],[-58,91],[17,235],[183,-93],[91,-124],[45,-155]],[[94910,44908],[-42,-109],[-206,512],[-57,353],[94,0],[100,-473],[111,-283]],[[84565,44589],[-238,-130],[-33,71],[25,201],[119,360],[275,235],[32,139],[239,133],[194,20],[87,74],[105,-74],[-102,-160],[-289,-258],[-233,-170],[-181,-441]],[[82749,45797],[100,-158],[172,48],[69,-251],[-321,-119],[-193,-79],[-149,5],[95,340],[153,5],[74,209]],[[84139,45797],[-41,-328],[-417,-168],[-370,73],[0,216],[220,123],[174,-177],[185,45],[249,216]],[[94409,45654],[12,-119],[-218,251],[-152,212],[-104,197],[41,60],[128,-142],[228,-272],[65,-187]],[[93760,46238],[-56,-33],[-121,134],[-114,243],[14,99],[166,-250],[111,-193]],[[80172,46575],[533,-59],[61,244],[515,-284],[101,-383],[417,-108],[341,-351],[-317,-225],[-306,238],[-251,-16],[-288,44],[-260,106],[-322,225],[-204,59],[-116,-74],[-506,243],[-48,254],[-255,44],[191,564],[337,-35],[224,-231],[115,-45],[38,-210]],[[87423,46908],[-143,-402],[-27,445],[49,212],[58,200],[63,-173],[0,-282]],[[93299,46550],[-78,-59],[-120,227],[-122,375],[-59,450],[38,57],[30,-175],[84,-134],[135,-375],[131,-200],[-39,-166]],[[92217,47343],[-146,-48],[-44,-166],[-152,-144],[-142,-138],[-148,1],[-228,171],[-158,165],[23,183],[249,-86],[152,46],[42,283],[40,15],[27,-314],[158,45],[78,202],[155,211],[-30,348],[166,11],[56,-97],[-5,-327],[-93,-361]],[[85346,48536],[-104,-196],[-192,108],[-54,254],[281,29],[69,-195]],[[86241,48752],[101,-452],[-234,244],[-232,49],[-157,-39],[-192,21],[65,325],[344,24],[305,-172]],[[92538,47921],[-87,-157],[-52,348],[-65,229],[-126,193],[-158,252],[-200,174],[77,143],[150,-166],[94,-130],[117,-142],[111,-248],[106,-189],[33,-307]],[[87261,49899],[78,-955],[287,-354],[232,627],[319,356],[247,1],[238,-206],[206,-212],[298,-113],[482,-407],[513,-338],[192,-302],[154,-297],[43,-349],[462,-365],[68,-313],[-256,-64],[62,-393],[248,-388],[180,-627],[159,20],[-11,-262],[215,-100],[-84,-111],[295,-249],[-30,-171],[-184,-41],[-69,153],[-238,66],[-281,89],[-216,377],[-158,325],[-144,517],[-362,259],[-235,-169],[-170,-195],[35,-436],[-218,-203],[-155,99],[-288,25],[-247,485],[-282,118],[-69,-168],[-352,-18],[118,481],[175,164],[-72,642],[-134,496],[-538,500],[-229,50],[-417,546],[-82,-287],[-107,-52],[-63,216],[-1,257],[-212,290],[299,213],[198,-11],[-23,156],[-407,1],[-110,352],[-248,109],[-117,293],[374,143],[142,192],[446,-242],[44,-220]],[[84788,51419],[-223,-587],[-209,-113],[-267,115],[-463,-29],[-243,-85],[-39,-447],[248,-526],[150,268],[518,201],[-22,-272],[-121,86],[-121,-347],[-245,-229],[263,-757],[-50,-203],[249,-682],[-2,-388],[-148,-173],[-109,207],[134,484],[-273,-229],[-69,164],[36,228],[-200,346],[21,576],[-186,-179],[24,-689],[11,-846],[-176,-85],[-119,173],[79,544],[-43,570],[-117,4],[-86,405],[115,387],[40,469],[139,891],[58,243],[237,439],[217,-174],[350,-82],[319,25],[275,429],[48,-132]],[[85746,51249],[-15,-517],[-143,58],[-42,-359],[114,-312],[-78,-71],[-112,374],[-82,755],[56,472],[92,215],[20,-322],[164,-52],[26,-241]],[[79393,47122],[-308,-12],[-234,494],[-356,482],[-119,358],[-210,481],[-138,443],[-212,827],[-244,493],[-81,508],[-103,461],[-250,372],[-145,506],[-209,330],[-290,652],[-24,300],[178,-24],[430,-114],[246,-577],[215,-401],[153,-246],[263,-635],[283,-9],[233,-405],[161,-495],[211,-270],[-111,-482],[159,-205],[100,-15],[47,-412],[97,-330],[204,-52],[135,-374],[-70,-735],[-11,-914]],[[82742,51659],[312,-546],[-329,-70],[-93,-403],[12,-535],[-267,-404],[-7,-589],[-107,-903],[-41,210],[-316,-266],[-110,361],[-198,34],[-139,189],[-330,-212],[-101,285],[-182,-32],[-229,68],[-43,793],[-138,164],[-134,505],[-38,517],[32,548],[165,392],[204,-202],[214,110],[56,500],[119,112],[333,128],[199,467],[137,374],[110,221],[236,323],[214,411],[140,462],[112,2],[143,-299],[13,-257],[183,-165],[231,-177],[-20,-232],[-186,-29],[50,-289],[-205,-201],[-158,-533],[204,-560],[-48,-272]],[[85104,55551],[28,-392],[16,-332],[-94,-540],[-102,602],[-130,-300],[89,-435],[-79,-277],[-327,343],[-78,428],[84,280],[-176,280],[-87,-245],[-131,23],[-205,-330],[-46,173],[109,498],[175,166],[151,223],[98,-268],[212,162],[45,264],[196,15],[-16,457],[225,-280],[23,-297],[20,-218]],[[72560,54241],[-242,-135],[-132,470],[-49,849],[126,959],[192,-328],[129,-416],[134,-616],[-42,-615],[-116,-168]],[[33073,56553],[-232,-65],[-50,53],[81,163],[-6,233],[160,77],[58,-21],[-11,-440]],[[84439,56653],[-100,-195],[-87,-373],[-87,-175],[-171,409],[57,158],[70,165],[30,367],[153,35],[-44,-398],[205,570],[-26,-563]],[[82917,56084],[-369,-561],[136,414],[200,364],[167,409],[146,587],[49,-482],[-183,-325],[-146,-406]],[[83856,57606],[166,-183],[177,1],[-5,-247],[-129,-251],[-176,-178],[-10,275],[20,301],[-43,282]],[[84861,57766],[78,-660],[-214,157],[5,-199],[68,-364],[-132,-133],[-11,416],[-84,31],[-43,357],[163,-47],[-4,224],[-169,451],[266,-13],[77,-220]],[[83757,58301],[-74,-510],[-119,295],[-142,450],[238,-22],[97,-213]],[[83700,61512],[171,-168],[85,153],[26,-150],[-46,-245],[95,-423],[-73,-491],[-164,-196],[-43,-476],[62,-471],[147,-65],[123,70],[347,-328],[-27,-321],[91,-142],[-29,-272],[-216,290],[-103,310],[-71,-217],[-177,354],[-253,-87],[-138,130],[14,244],[87,151],[-83,136],[-36,-213],[-137,340],[-41,257],[-11,566],[112,-195],[29,925],[90,535],[169,-1]],[[31780,61349],[-71,-149],[-209,4],[-163,-21],[-16,253],[40,86],[227,-3],[142,-52],[50,-118]],[[28638,61137],[-84,-99],[-156,95],[-159,215],[34,135],[116,41],[64,-20],[187,-53],[147,-142],[46,-161],[-195,-11]],[[29839,62320],[241,-93],[34,101],[217,-3],[165,-152],[73,15],[50,-209],[152,11],[-9,-176],[124,-21],[136,-217],[-103,-240],[-132,128],[-127,-25],[-92,28],[-50,-107],[-106,-37],[-43,144],[-92,-85],[-111,-405],[-71,94],[-14,170],[-185,100],[-131,-41],[-169,43],[-130,-110],[-149,184],[24,190],[256,-82],[210,-47],[100,131],[-127,256],[2,226],[-175,92],[62,163],[170,-26]],[[80649,61615],[-240,-284],[-228,183],[-8,509],[137,267],[304,166],[159,-14],[62,-226],[-122,-260],[-64,-341]],[[6794,61855],[-41,-99],[-69,84],[8,165],[-46,216],[14,65],[48,97],[-19,116],[16,55],[21,-11],[107,-100],[49,-51],[45,-79],[71,-207],[-7,-33],[-108,-126],[-89,-92]],[[6645,62777],[-94,-43],[-47,125],[-32,48],[-3,37],[27,50],[99,-56],[73,-90],[-23,-71]],[[6456,63091],[-9,-63],[-149,17],[21,72],[137,-26]],[[6207,63177],[-15,-34],[-19,8],[-97,21],[-35,133],[-11,24],[74,82],[23,-38],[80,-196]],[[5737,63567],[-33,-58],[-93,107],[14,43],[43,58],[64,-12],[5,-138]],[[27867,64030],[110,-216],[260,66],[98,-138],[235,-366],[173,-267],[92,8],[165,-120],[-20,-167],[205,-24],[210,-242],[-33,-138],[-185,-75],[-187,-29],[-191,46],[-398,-57],[186,329],[-113,154],[-179,39],[-96,171],[-66,336],[-157,-23],[-259,159],[-83,124],[-362,91],[-97,115],[104,148],[-273,30],[-199,-307],[-115,-8],[-40,-144],[-138,-65],[-118,56],[146,183],[60,213],[126,131],[142,116],[210,56],[67,65],[240,-42],[219,-7],[261,-201]],[[28462,64617],[-68,-29],[-70,340],[-104,171],[60,375],[84,-23],[97,-491],[1,-343]],[[83659,64045],[-119,-485],[-146,499],[-32,438],[163,581],[223,447],[127,-176],[-49,-357],[-167,-947]],[[28383,66284],[-303,-95],[-19,219],[130,47],[184,-18],[8,-153]],[[28611,66290],[-48,-420],[-51,75],[4,309],[-124,234],[-1,67],[220,-265]],[[87399,70756],[35,-203],[-156,-357],[-114,189],[-143,-137],[-73,-346],[-181,168],[2,281],[154,352],[158,-68],[114,248],[204,-127]],[[59604,71655],[-188,-251],[21,-111],[8,-48],[-285,-240],[-136,77],[-64,237],[132,22],[19,3],[40,143],[200,-8],[253,176]],[[56583,71675],[152,-199],[216,34],[207,-42],[-7,-103],[151,71],[-35,-175],[-400,-50],[3,98],[-339,115],[52,251]],[[54311,73167],[-100,-465],[41,-183],[-58,-303],[-213,222],[-141,64],[-387,300],[38,304],[325,-54],[284,64],[211,51]],[[52558,74927],[166,-419],[-39,-782],[-126,38],[-113,-197],[-105,156],[-11,713],[-64,338],[153,-30],[139,183]],[[89159,72524],[-104,-472],[48,-296],[-145,-416],[-355,-278],[-488,-36],[-396,-675],[-186,227],[-12,442],[-483,-130],[-329,-279],[-325,-11],[282,-435],[-186,-1004],[-179,-248],[-135,229],[69,533],[-176,172],[-113,405],[263,182],[145,371],[280,306],[203,403],[553,177],[297,-121],[291,1050],[185,-282],[408,591],[158,229],[174,723],[-47,664],[117,374],[295,108],[152,-819],[-9,-479],[-256,-595],[4,-610]],[[52655,75484],[-92,-456],[-126,120],[-64,398],[56,219],[179,226],[47,-507]],[[89974,76679],[195,-126],[197,250],[62,-663],[-412,-162],[-244,-587],[-436,404],[-152,-646],[-308,-9],[-39,587],[138,455],[296,33],[81,817],[83,460],[326,-615],[213,-198]],[[32315,78082],[202,-79],[257,16],[-137,-242],[-102,-38],[-353,250],[-69,198],[105,183],[97,-288]],[[32831,79592],[-135,-11],[-360,186],[-258,279],[96,49],[365,-148],[284,-247],[8,-108]],[[15692,79240],[-140,-82],[-456,269],[-84,209],[-248,207],[-50,168],[-286,107],[-107,321],[24,137],[291,-129],[171,-89],[261,-63],[94,-204],[138,-280],[277,-244],[115,-327]],[[34407,80527],[-184,-517],[181,199],[187,-126],[-98,-206],[247,-162],[128,144],[277,-182],[-86,-433],[194,101],[36,-313],[86,-367],[-117,-520],[-125,-22],[-183,111],[60,484],[-77,75],[-322,-513],[-166,21],[196,277],[-267,144],[-298,-35],[-539,18],[-43,175],[173,208],[-121,160],[234,356],[287,941],[172,336],[241,204],[129,-26],[-54,-160],[-148,-372]],[[13136,82508],[267,47],[-84,-671],[242,-475],[-111,1],[-167,270],[-103,272],[-140,184],[-51,260],[16,188],[131,-76]],[[89901,80562],[280,-1046],[-411,195],[-171,-854],[271,-605],[-8,-413],[-211,356],[-182,-457],[-51,496],[31,575],[-32,638],[64,446],[13,790],[-163,581],[24,808],[257,271],[-110,274],[123,83],[73,-391],[96,-569],[-7,-581],[114,-597]],[[48114,81456],[-493,-349],[-393,89],[225,617],[-145,601],[378,463],[210,276],[233,24],[298,-365],[-149,-406],[46,-422],[-210,-528]],[[53524,83435],[-166,-478],[-291,333],[-39,246],[408,195],[88,-296]],[[7498,84325],[-277,-225],[-142,152],[-43,277],[252,210],[148,90],[185,-40],[117,-183],[-240,-281]],[[49165,85222],[-297,-639],[283,81],[304,-3],[-72,-481],[-250,-530],[287,-38],[270,-759],[190,-95],[171,-673],[79,-233],[337,-113],[-34,-378],[-142,-173],[111,-305],[-250,-310],[-371,6],[-473,-163],[-130,116],[-183,-276],[-257,67],[-195,-226],[-148,118],[407,621],[249,127],[-436,99],[-79,235],[291,183],[-152,319],[52,387],[414,-54],[40,343],[-190,372],[-337,104],[-66,160],[101,264],[-92,163],[-149,-279],[-17,569],[-140,301],[101,611],[216,480],[222,-47],[335,49]],[[4006,85976],[-171,-92],[-182,110],[-168,161],[274,101],[220,-54],[27,-226]],[[27981,87304],[-108,-310],[-123,50],[-73,176],[13,41],[107,177],[114,-13],[70,-121]],[[27250,87631],[-325,-326],[-196,13],[-61,160],[207,273],[381,-6],[-6,-114]],[[2297,88264],[171,-113],[173,61],[225,-156],[276,-79],[-23,-64],[-211,-125],[-211,128],[-106,107],[-245,-34],[-66,52],[17,223]],[[26344,89371],[51,-259],[143,91],[161,-155],[304,-203],[318,-184],[25,-281],[204,46],[199,-196],[-247,-186],[-432,142],[-156,266],[-275,-314],[-396,-306],[-95,346],[-377,-57],[242,292],[35,465],[95,542],[201,-49]],[[45969,89843],[-64,-382],[314,-403],[-361,-451],[-801,-405],[-240,-107],[-365,87],[-775,187],[273,261],[-605,289],[492,114],[-12,174],[-583,137],[188,385],[421,87],[433,-400],[422,321],[349,-167],[453,315],[461,-42]],[[28926,90253],[-312,-30],[-69,289],[118,331],[255,82],[217,-163],[3,-253],[-32,-82],[-180,-174]],[[0,91325],[681,-451],[728,-588],[-24,-367],[187,-147],[-64,429],[754,-88],[544,-553],[-276,-257],[-455,-61],[-7,-578],[-111,-122],[-260,17],[-212,206],[-369,172],[-62,257],[-283,96],[-315,-76],[-151,207],[60,219],[-333,-140],[126,-278],[-158,-251]],[[0,88971],[0,2354]],[[23431,91410],[-173,-207],[-374,179],[-226,-65],[-380,266],[245,183],[194,256],[295,-168],[166,-106],[84,-112],[169,-226]],[[0,92833],[99999,-404],[-305,-30],[-49,187],[-99645,247]],[[0,92833],[36,24],[235,-1],[402,-169],[-24,-81],[-286,-141],[-363,-36],[0,404]],[[24848,91640],[-1,-604],[371,463],[332,-380],[-83,-438],[269,-399],[290,427],[202,510],[16,648],[394,-45],[411,-87],[373,-293],[17,-293],[-207,-315],[196,-316],[-36,-288],[-544,-413],[-386,-91],[-287,178],[-83,-297],[-268,-498],[-81,-258],[-322,-400],[-397,-39],[-220,-250],[-18,-384],[-323,-74],[-340,-479],[-301,-665],[-108,-466],[-15,-686],[408,-99],[125,-553],[130,-448],[388,117],[517,-256],[277,-225],[199,-279],[348,-162],[294,-249],[459,-34],[302,-58],[-45,-511],[86,-594],[201,-661],[414,-561],[214,192],[150,607],[-145,934],[-196,311],[445,276],[314,415],[154,411],[-22,395],[-189,502],[-338,445],[328,619],[-121,535],[-93,922],[194,137],[476,-161],[286,-57],[230,155],[258,-200],[342,-343],[85,-229],[495,-45],[-8,-496],[92,-747],[254,-92],[201,-348],[402,328],[266,652],[184,274],[216,-527],[362,-754],[307,-709],[-112,-371],[370,-333],[250,-338],[442,-152],[179,-189],[110,-500],[216,-78],[112,-223],[20,-664],[-202,-222],[-199,-207],[-458,-210],[-349,-486],[-470,-96],[-594,125],[-417,4],[-287,-41],[-233,-424],[-354,-262],[-401,-782],[-320,-545],[236,97],[446,776],[583,493],[416,59],[245,-290],[-262,-397],[88,-637],[91,-446],[361,-295],[459,86],[278,664],[19,-429],[180,-214],[-344,-387],[-615,-351],[-276,-239],[-310,-426],[-211,44],[-11,500],[483,488],[-445,-19],[-309,-72],[48,-194],[-296,-286],[-286,-204],[-293,-175],[-159,-386],[-35,-98],[-3,-313],[92,-313],[115,-15],[-29,216],[83,-131],[-22,-169],[-188,-96],[-133,12],[-205,-104],[-121,-29],[-162,-29],[-231,-171],[408,111],[82,-112],[-389,-177],[-177,-1],[8,72],[-84,-164],[82,-27],[-60,-424],[-203,-455],[-20,152],[-61,31],[-91,147],[57,-318],[66,-106],[8,-222],[-89,-230],[-157,-472],[-25,24],[86,402],[-142,226],[-33,490],[-53,-255],[59,-375],[-175,88],[183,-186],[12,-562],[79,-41],[29,-204],[39,-591],[-176,-439],[-288,-175],[-182,-346],[-139,-38],[-141,-217],[-39,-199],[-305,-383],[-157,-281],[-131,-351],[-43,-419],[50,-411],[92,-505],[124,-418],[1,-256],[132,-685],[-9,-398],[-12,-230],[-69,-361],[-83,-74],[-137,71],[-44,259],[-106,136],[-147,508],[-129,452],[-42,231],[57,393],[-77,325],[-217,494],[-108,91],[-281,-269],[-49,30],[-135,276],[-174,146],[-314,-75],[-247,66],[-212,-41],[-118,-83],[54,-166],[-5,-240],[59,-117],[-53,-77],[-103,87],[-104,-112],[-202,18],[-207,313],[-242,-74],[-202,137],[-173,-42],[-234,-138],[-253,-438],[-276,-255],[-152,-282],[-63,-266],[-3,-407],[14,-284],[52,-201],[1,-1],[-1,-1],[-107,-516],[-49,-426],[-20,-791],[-27,-289],[48,-322],[86,-288],[56,-458],[184,-440],[65,-337],[109,-291],[295,-157],[114,-247],[244,165],[212,60],[208,106],[175,101],[176,241],[67,345],[22,496],[48,173],[188,155],[294,137],[246,-21],[169,50],[66,-125],[-9,-285],[-149,-351],[-66,-360],[51,-103],[-42,-255],[-69,-461],[-71,152],[-58,-10],[1,-87],[53,-3],[-5,-160],[-45,-256],[24,-91],[-29,-212],[18,-56],[-32,-299],[-55,-156],[-50,-19],[-55,-205],[90,-107],[24,88],[82,-75],[29,-23],[61,104],[79,8],[26,-48],[43,29],[129,-53],[128,16],[90,65],[32,66],[89,-31],[66,-40],[73,14],[55,51],[127,-82],[44,-13],[85,-110],[80,-132],[101,-91],[73,-162],[-24,-57],[-14,-132],[29,-216],[-64,-202],[-30,-237],[-9,-261],[15,-152],[7,-266],[-43,-58],[-26,-253],[19,-156],[-56,-151],[12,-159],[43,-97],[70,-321],[108,-238],[130,-252],[100,-212],[-6,-125],[111,-27],[26,48],[77,-145],[136,42],[119,150],[168,119],[95,176],[153,-34],[-10,-58],[155,-21],[124,-102],[90,-177],[105,-164],[143,-18],[209,412],[114,63],[3,195],[51,500],[159,274],[175,11],[22,123],[218,-49],[218,298],[109,132],[134,285],[98,-36],[73,-156],[-54,-199],[-8,-139],[-163,-69],[91,-268],[-3,-309],[-123,-343],[105,-469],[120,38],[62,427],[-86,208],[-14,447],[346,241],[-38,278],[97,186],[100,-415],[195,-9],[180,-330],[11,-195],[249,-6],[297,61],[159,-264],[213,-73],[155,184],[4,149],[344,35],[333,9],[-236,-175],[95,-279],[222,-44],[210,-291],[45,-473],[144,13],[109,-139],[183,-217],[171,-385],[8,-304],[105,-14],[149,-289],[109,-205],[333,-119],[30,107],[225,43],[298,-159],[95,-65],[204,-140],[294,-499],[46,-242],[95,28],[69,-327],[155,-1033],[149,-97],[7,-408],[-208,-487],[86,-178],[491,-92],[10,-593],[211,388],[349,-212],[462,-361],[135,-346],[-45,-327],[323,182],[540,-313],[415,23],[411,-489],[355,-662],[214,-170],[237,-24],[101,-186],[94,-752],[46,-358],[-110,-977],[-142,-385],[-391,-822],[-177,-668],[-206,-513],[-69,-11],[-78,-435],[20,-1107],[-77,-910],[-30,-390],[-88,-233],[-49,-790],[-282,-771],[-47,-610],[-225,-256],[-65,-355],[-302,2],[-437,-227],[-195,-263],[-311,-173],[-327,-470],[-235,-586],[-41,-441],[46,-326],[-51,-597],[-63,-289],[-195,-325],[-308,-1040],[-244,-468],[-189,-277],[-127,-562],[-183,-337],[-121,-372],[-313,-328],[-205,118],[-151,-63],[-256,253],[-189,-19],[-169,327],[-19,-308],[353,-506],[-38,-408],[173,-257],[-14,-289],[-267,-757],[-412,-317],[-557,-123],[-305,59],[59,-352],[-57,-442],[51,-298],[-167,-208],[-284,-82],[-267,216],[-108,-155],[39,-587],[188,-178],[152,186],[82,-307],[-255,-183],[-223,-367],[-41,-595],[-66,-316],[-262,-2],[-218,-302],[-80,-443],[274,-433],[265,-119],[-96,-531],[-328,-333],[-180,-692],[-254,-234],[-113,-276],[89,-614],[185,-342],[-117,30],[-247,4],[-134,-145],[-250,-213],[-45,-552],[-118,-14],[-313,192],[-318,412],[-346,338],[-87,374],[79,346],[-140,393],[-36,1007],[119,568],[293,457],[-422,172],[265,522],[94,982],[309,-208],[145,1224],[-186,157],[-87,-738],[-175,83],[87,845],[95,1095],[127,404],[-79,576],[-23,666],[117,19],[170,954],[192,945],[118,881],[-64,885],[83,487],[-34,730],[163,721],[50,1143],[89,1227],[87,1321],[-20,967],[-58,832],[-279,340],[-24,242],[-551,593],[-498,646],[-214,365],[-115,488],[46,170],[-236,775],[-274,1090],[-262,1177],[-114,269],[-87,435],[-216,386],[-198,239],[90,264],[-134,563],[86,414],[221,373],[148,442],[-60,258],[-106,-275],[-166,259],[56,167],[-47,536],[97,89],[52,368],[105,381],[-20,241],[153,126],[190,236],[-37,183],[103,44],[-12,296],[65,214],[138,40],[117,371],[106,310],[-102,141],[52,343],[-62,540],[59,155],[-44,500],[-112,315],[-93,170],[-59,319],[68,158],[-70,40],[-52,195],[-138,165],[-122,-38],[-56,-205],[-112,-149],[-61,-20],[-27,-123],[132,-321],[-75,-76],[-40,-87],[-130,-30],[-48,353],[-36,-101],[-92,35],[-56,238],[-114,39],[-72,69],[-119,-1],[-8,-128],[-32,89],[-151,131],[-56,124],[32,103],[-11,130],[-77,142],[-109,116],[-95,76],[-19,173],[-73,105],[18,-172],[-55,-141],[-64,164],[-89,58],[-38,120],[2,179],[36,187],[-78,83],[64,114],[-96,186],[-130,238],[-61,200],[-117,185],[-140,267],[31,92],[46,-89],[21,41],[-48,185],[-84,52],[-31,-140],[-161,9],[-100,57],[-115,117],[-154,37],[-79,127],[-142,103],[-174,11],[-127,117],[-149,244],[-314,636],[-144,192],[-226,154],[-156,-43],[-223,-223],[-140,-58],[-196,156],[-208,112],[-260,271],[-208,83],[-314,275],[-233,282],[-70,158],[-155,35],[-284,187],[-116,270],[-299,335],[-139,373],[-66,288],[93,57],[-29,169],[64,153],[1,204],[-93,266],[-25,235],[-94,298],[-244,587],[-280,462],[-135,368],[-238,241],[-51,145],[42,365],[-142,137],[-164,288],[-69,412],[-149,48],[-162,311],[-130,288],[-12,184],[-149,446],[-99,452],[5,227],[-201,235],[-93,-26],[-159,163],[-44,-240],[46,-284],[27,-444],[95,-243],[206,-407],[46,-139],[42,-42],[37,-203],[49,8],[56,-381],[85,-150],[59,-210],[174,-300],[92,-550],[83,-259],[77,-277],[15,-311],[134,-20],[112,-268],[100,-264],[-6,-106],[-117,-217],[-49,3],[-74,359],[-182,337],[-200,286],[-142,150],[9,432],[-42,320],[-132,183],[-191,264],[-37,-76],[-70,154],[-171,143],[-164,343],[20,44],[115,-33],[103,221],[10,266],[-214,422],[-163,163],[-102,369],[-103,388],[-129,472],[-113,531],[-46,302],[-180,340],[-130,71],[-30,169],[-156,30],[-100,159],[-258,59],[-70,95],[-34,324],[-270,594],[-231,821],[10,137],[-123,195],[-215,495],[-38,482],[-148,323],[61,489],[-10,507],[-89,453],[109,557],[67,1072],[-50,792],[-88,506],[-80,274],[33,115],[402,-200],[148,-558],[68,156],[-44,485],[-94,484],[-38,1],[-537,581],[-199,255],[-503,245],[-155,523],[40,362],[-356,252],[-48,476],[-336,429],[-6,304],[-153,223],[-245,188],[-78,515],[-358,478],[-150,558],[-267,38],[-441,15],[-326,170],[-574,613],[-266,112],[-486,211],[-385,-50],[-546,271],[-330,252],[-309,-125],[58,-411],[-154,-38],[-321,-123],[-245,-199],[-307,-126],[-40,348],[125,580],[295,182],[-76,148],[-354,-329],[-190,-394],[-400,-420],[203,-287],[-262,-424],[-299,-247],[-278,-181],[-69,-261],[-434,-305],[-87,-278],[-325,-252],[-191,45],[-259,-165],[-282,-201],[-231,-197],[-477,-169],[-43,99],[304,276],[271,182],[296,324],[345,66],[137,243],[385,353],[62,119],[205,208],[48,448],[141,349],[-320,-179],[-90,102],[-150,-215],[-181,300],[-75,-212],[-104,294],[-278,-236],[-170,0],[-24,352],[50,217],[-179,210],[-361,-113],[-235,277],[-190,142],[-1,334],[-214,252],[108,340],[226,330],[99,303],[225,43],[191,-94],[224,285],[201,-51],[212,183],[-52,270],[-155,106],[205,228],[-170,-7],[-295,-128],[-85,-131],[-219,131],[-392,-67],[-407,142],[-117,238],[-351,343],[390,247],[620,289],[228,0],[-38,-295],[586,22],[-225,366],[-342,226],[-197,295],[-267,252],[-381,187],[155,309],[493,19],[350,270],[66,287],[284,281],[271,68],[526,262],[256,-40],[427,315],[421,-124],[201,-266],[123,114],[469,-35],[-16,-136],[425,-101],[283,59],[585,-186],[534,-56],[214,-77],[370,96],[421,-177],[302,-83],[518,-142],[438,-284],[289,-55],[244,247],[336,184],[413,-72],[416,259],[455,148],[191,-245],[207,138],[62,278],[192,-63],[470,-530],[369,401],[38,-448],[341,96],[105,173],[337,-34],[424,-248],[650,-217],[383,-100],[272,38],[375,-300],[-391,-293],[502,-127],[750,70],[236,103],[296,-354],[302,299],[-283,251],[179,202],[338,27],[223,59],[224,-141],[279,-321],[310,47],[491,-266],[431,94],[405,-14],[-32,367],[247,103],[431,-200],[-2,-559],[177,471],[223,-16],[126,594],[-298,364],[-324,239],[22,653],[329,429],[366,-95],[281,-261],[378,-666],[-247,-290],[517,-120]],[[18287,93781],[-139,-277],[618,179],[386,-298],[314,302],[254,-194],[227,-580],[140,244],[-197,606],[244,86],[276,-94],[311,-239],[175,-575],[86,-417],[466,-293],[502,-279],[-31,-260],[-456,-48],[178,-227],[-94,-217],[-503,93],[-478,160],[-322,-36],[-522,-201],[-824,-103],[-374,-41],[-151,279],[-379,161],[-246,-66],[-343,468],[185,62],[429,101],[392,-26],[362,103],[-537,138],[-594,-47],[-394,12],[-146,217],[644,237],[-428,-9],[-485,156],[233,443],[193,235],[744,359],[284,-114]],[[20972,93958],[-244,-390],[-434,413],[95,83],[372,24],[211,-130]],[[28794,93770],[25,-163],[-296,17],[-299,13],[-304,-80],[-80,36],[-306,313],[12,213],[133,39],[636,-63],[479,-325]],[[25955,93803],[219,-369],[256,477],[704,242],[477,-611],[-42,-387],[550,172],[263,235],[616,-299],[383,-282],[36,-258],[515,134],[290,-376],[670,-234],[242,-238],[263,-553],[-510,-275],[654,-386],[441,-130],[400,-543],[437,-39],[-87,-414],[-487,-687],[-342,253],[-437,568],[-359,-74],[-35,-338],[292,-344],[377,-272],[114,-157],[181,-584],[-96,-425],[-350,160],[-697,473],[393,-509],[289,-357],[45,-206],[-753,236],[-596,343],[-337,287],[97,167],[-414,304],[-405,286],[5,-171],[-803,-94],[-235,203],[183,435],[522,10],[571,76],[-92,211],[96,294],[360,576],[-77,261],[-107,203],[-425,286],[-563,201],[178,150],[-294,367],[-245,34],[-219,201],[-149,-175],[-503,-76],[-1011,132],[-588,174],[-450,89],[-231,207],[290,270],[-394,2],[-88,599],[213,528],[286,241],[717,158],[-204,-382]],[[22123,94208],[331,-124],[496,75],[72,-172],[-259,-283],[420,-254],[-50,-532],[-455,-229],[-268,50],[-192,225],[-690,456],[5,189],[567,-73],[-306,386],[329,286]],[[89889,93835],[-421,-4],[-569,66],[-49,31],[263,234],[348,54],[394,-226],[34,-155]],[[24112,93575],[-298,-442],[-317,22],[-173,519],[4,294],[145,251],[276,161],[579,-20],[530,-144],[-415,-526],[-331,-115]],[[16539,92764],[-731,-294],[-147,259],[-641,312],[93,193],[218,489],[241,388],[-272,362],[939,93],[397,-123],[709,-33],[270,-171],[298,-249],[-349,-149],[-681,-415],[-344,-414],[0,-248]],[[91869,94941],[-321,-234],[-444,53],[-516,233],[66,192],[518,-89],[697,-155]],[[23996,94879],[-151,-229],[-403,44],[-337,155],[148,266],[399,159],[243,-208],[101,-187]],[[90301,95224],[-219,-439],[-1023,16],[-461,-139],[-550,384],[149,406],[366,111],[734,-26],[1004,-313]],[[22639,95907],[212,-273],[9,-303],[-127,-440],[-458,-60],[-298,94],[5,345],[-455,-46],[-18,457],[299,-18],[419,201],[390,-34],[22,77]],[[19941,95601],[109,-210],[247,99],[291,-26],[49,-289],[-169,-281],[-940,-91],[-701,-256],[-423,-14],[-35,193],[577,261],[-1255,-70],[-389,106],[379,577],[262,165],[782,-199],[493,-350],[485,-45],[-397,565],[255,215],[286,-68],[94,-282]],[[65981,92363],[-164,-52],[-907,77],[-74,262],[-503,158],[-40,320],[284,126],[-10,323],[551,503],[-255,73],[665,518],[-75,268],[621,312],[917,380],[925,110],[475,220],[541,76],[193,-233],[-187,-184],[-984,-293],[-848,-282],[-863,-562],[-414,-577],[-435,-568],[56,-491],[531,-484]],[[23699,96131],[308,-190],[547,1],[240,-194],[-64,-222],[319,-134],[177,-140],[374,-26],[406,-50],[441,128],[566,51],[451,-42],[298,-223],[62,-244],[-174,-157],[-414,-127],[-355,72],[-797,-91],[-570,-11],[-449,73],[-738,190],[-96,325],[-34,293],[-279,258],[-574,72],[-322,183],[104,242],[573,-37]],[[17722,96454],[-38,-454],[-214,-205],[-259,-29],[-517,-252],[-444,-91],[-377,128],[472,442],[570,383],[426,-9],[381,87]],[[63641,74970],[141,-419],[130,-28],[85,-159],[-228,-47],[-49,-459],[-47,-207],[-102,-138],[7,-293],[88,-436],[263,-123],[193,-296],[395,-102],[434,156],[27,139],[-52,417],[40,618],[-216,200],[71,405],[-184,34],[61,498],[262,-145],[244,189],[-202,355],[-80,338],[-224,-151],[-28,-433],[-87,383],[-15,144],[68,246],[-53,206],[-322,202],[-125,530],[-154,150],[-9,192],[270,-56],[11,432],[236,96],[243,-88],[50,576],[-50,365],[-278,-28],[-236,144],[-321,-260],[-259,-124],[-127,-350],[-269,-97],[-276,-610],[252,-561],[-27,-398],[303,-696],[146,-311]],[[0,88971],[99997,-3],[-357,-260],[-360,44],[250,-315],[166,-487],[128,-159],[32,-244],[-71,-157],[-518,129],[-777,-445],[-247,-69],[-425,-415],[-403,-362],[-102,-269],[-397,409],[-724,-464],[-126,220],[-268,-254],[-371,81],[-90,-388],[-333,-572],[10,-239],[316,-132],[-37,-860],[-258,-22],[-119,-494],[116,-255],[-486,-301],[-96,-675],[-415,-144],[-83,-600],[-400,-551],[-103,407],[-119,862],[-155,1313],[134,819],[234,353],[15,276],[431,132],[496,744],[479,608],[499,471],[223,833],[-337,-50],[-167,-487],[-705,-648],[-227,726],[-717,-201],[-696,-990],[230,-362],[-620,-154],[-430,-61],[20,427],[-431,90],[-344,-291],[-850,102],[-913,-175],[-900,-1153],[-1065,-1394],[438,-74],[136,-370],[270,-132],[178,296],[305,-39],[401,-650],[9,-502],[-217,-591],[-23,-705],[-126,-945],[-418,-855],[-94,-409],[-377,-688],[-374,-682],[-179,-349],[-370,-346],[-175,-8],[-175,287],[-373,-432],[-43,-197],[-106,36],[-120,-201],[-83,-201],[10,-424],[-143,-130],[-50,-105],[-104,-174],[-185,-97],[-121,-159],[-9,-256],[-32,-65],[111,-96],[157,-259],[240,-697],[68,-383],[3,-681],[-105,-325],[-252,-113],[-222,-245],[-250,-51],[-31,322],[52,443],[-123,615],[206,99],[-190,506],[-135,113],[-34,-112],[-81,-49],[-10,112],[-72,54],[-75,94],[77,260],[65,69],[-25,108],[71,319],[-18,97],[-163,64],[-131,158],[-388,-171],[-204,-277],[-300,-161],[148,274],[-58,230],[220,397],[-147,310],[-242,-209],[-314,-411],[-171,-381],[-272,-29],[-142,-275],[147,-400],[227,-97],[9,-265],[220,-172],[311,421],[247,-230],[179,-15],[46,-310],[-394,-165],[-130,-319],[-270,-296],[-142,-414],[299,-324],[109,-582],[169,-541],[189,-454],[-5,-439],[-174,-161],[66,-315],[164,-184],[-43,-481],[-71,-468],[-155,-53],[-203,-640],[-225,-775],[-258,-705],[-382,-545],[-386,-498],[-313,-68],[-170,-262],[-96,192],[-157,-294],[-388,-296],[-294,-90],[-95,-624],[-154,-35],[-73,429],[66,228],[-373,190],[-131,-97],[-371,-505],[-231,-558],[-61,-410],[212,-623],[260,-772],[252,-365],[169,-475],[127,-1093],[-37,-1039],[-232,-389],[-318,-381],[-227,-492],[-346,-550],[-101,378],[78,401],[-206,335],[-233,87],[-112,307],[-141,611],[-249,271],[-238,-11],[41,464],[-245,-3],[-22,-650],[-150,-863],[-90,-522],[19,-428],[181,-18],[113,-539],[50,-512],[155,-338],[168,-69],[144,-306],[64,-56],[164,-356],[116,-396],[16,-398],[-29,-269],[27,-203],[20,-349],[98,-163],[109,-523],[-5,-199],[-197,-40],[-263,438],[-329,469],[-32,301],[-161,395],[-38,489],[-100,322],[30,431],[-61,250],[-110,227],[-47,292],[-148,334],[-135,280],[-45,-347],[-53,328],[30,369],[82,566],[-27,439],[86,452],[-94,350],[23,644],[-113,306],[-90,707],[-50,746],[-121,490],[-183,-297],[-315,-421],[-156,53],[-172,138],[96,732],[-58,554],[-218,681],[34,213],[-163,76],[-197,481],[-79,309],[-16,301],[-53,284],[-116,344],[-256,23],[25,-243],[-87,-329],[-118,120],[-41,-108],[-78,65],[-108,53],[-39,-216],[-189,7],[-343,-122],[16,-445],[-148,-349],[-400,-398],[-311,-695],[-209,-373],[-276,-386],[-1,-272],[-138,-146],[-250,-212],[-130,-31],[-84,-450],[58,-769],[15,-490],[-118,-561],[-1,-1004],[-144,-29],[-126,-450],[84,-195],[-253,-167],[-93,-402],[-112,-170],[-263,552],[-128,827],[-107,596],[-97,279],[-148,568],[-69,739],[-48,369],[-253,811],[-115,1145],[-83,756],[1,716],[-54,553],[-404,-353],[-196,70],[-362,716],[133,214],[-82,232],[-326,501],[-203,150],[-83,425],[-215,449],[-512,-111],[-451,-11],[-391,-83],[-523,179],[-302,136],[-314,76],[-118,725],[-133,105],[-214,-106],[-280,-286],[-339,196],[-281,454],[-267,168],[-186,561],[-205,788],[-149,-96],[-177,196],[-103,-231],[-165,29],[58,-261],[-25,-135],[89,-445],[109,-510],[137,-135],[47,-207],[190,-248],[16,-244],[-27,-197],[35,-199],[80,-165],[37,-194],[41,-145],[-18,430],[75,310],[76,64],[84,-186],[5,-345],[-61,-348],[53,-226],[49,29],[11,-162],[217,93],[230,-15],[168,-18],[190,400],[207,379],[176,364],[80,201],[35,-51],[-26,-244],[-37,-108],[38,-466],[125,-404],[155,-214],[204,-78],[164,-107],[125,-339],[75,-196],[100,-75],[-1,-132],[-101,-352],[-44,-166],[-117,-189],[-104,-404],[-126,31],[-58,-141],[-44,-300],[34,-395],[-26,-72],[-128,2],[-174,-221],[-27,-288],[-63,-125],[-173,5],[-109,-149],[1,-239],[-134,-164],[-153,56],[-186,-199],[-128,-33],[-201,-159],[-54,-263],[-6,-201],[-277,-249],[-444,-276],[-249,-417],[-122,-32],[-83,34],[-163,-245],[-177,-113],[-233,-31],[-70,-34],[-61,-156],[-73,-43],[-42,-150],[-138,13],[-89,-80],[-192,30],[-72,345],[8,323],[-46,174],[-54,437],[-80,243],[56,29],[-29,270],[34,114],[-12,257],[-36,253],[-84,177],[-22,236],[-143,212],[-148,495],[-79,482],[-192,406],[-124,97],[-184,563],[-32,411],[12,350],[-159,655],[-130,231],[-150,122],[-92,339],[15,133],[-77,307],[-81,131],[-108,440],[-170,476],[-141,406],[-139,-3],[44,325],[12,206],[34,236],[-9,86],[-78,-238],[-60,-446],[-75,-308],[-65,-103],[-93,191],[-125,263],[-198,847],[-29,-53],[115,-624],[171,-594],[210,-920],[102,-321],[90,-334],[249,-654],[-55,-103],[9,-384],[323,-530],[49,-121],[90,-580],[-61,-107],[40,-608],[102,-706],[106,-145],[152,-219],[161,-683],[77,-543],[152,-288],[379,-558],[154,-336],[151,-341],[87,-203],[136,-178],[66,-183],[-9,-245],[-158,-142],[119,-161],[91,-109],[54,-244],[125,-248],[138,-2],[262,151],[302,70],[245,184],[138,39],[99,108],[158,20],[89,12],[128,88],[147,59],[132,202],[105,2],[6,-163],[-25,-344],[1,-310],[-59,-214],[-78,-639],[-134,-659],[-172,-755],[-238,-866],[-237,-661],[-327,-806],[-278,-479],[-415,-586],[-259,-450],[-304,-715],[-64,-312],[-63,-140],[-195,-236],[-68,-246],[-104,-44],[-40,-416],[-89,-238],[-54,-393],[-112,-195],[-128,-728],[16,-335],[178,-216],[8,-153],[-76,-357],[16,-180],[-18,-282],[97,-370],[115,-583],[101,-129],[45,-265],[-11,-588],[34,-519],[11,-923],[49,-290],[-83,-422],[-108,-410],[-177,-366],[-254,-225],[-313,-287],[-313,-634],[-107,-108],[-194,-420],[-115,-136],[-23,-421],[132,-448],[54,-346],[4,-177],[49,29],[-8,-579],[-45,-274],[65,-102],[-41,-246],[-116,-210],[-229,-199],[-334,-320],[-122,-219],[24,-248],[71,-40],[-24,-311],[-70,-430],[-32,-491],[-72,-267],[-190,-298],[-54,-86],[-118,-300],[-77,-303],[-158,-424],[-314,-609],[-196,-355],[-209,-269],[-291,-229],[-141,-31],[-36,-164],[-169,88],[-138,-113],[-301,114],[-168,-72],[-115,31],[-286,-233],[-238,-94],[-171,-223],[-127,-14],[-117,210],[-94,11],[-120,264],[-13,-82],[-37,159],[2,346],[-90,396],[89,108],[-7,453],[-182,553],[-139,501],[-1,1],[-199,768],[-207,446],[-108,432],[-62,575],[-68,428],[-93,910],[-7,707],[-35,322],[-108,243],[-144,489],[-146,708],[-60,371],[-226,577],[-17,453],[-26,372],[38,519],[96,541],[15,254],[90,532],[66,243],[159,386],[90,263],[29,438],[-15,335],[-83,211],[-74,358],[-68,355],[15,122],[85,235],[-84,570],[-57,396],[-139,374],[26,115],[-39,183],[-74,444],[-228,626],[-285,596],[-184,488],[-169,610],[9,196],[61,189],[67,430],[56,438],[-52,90],[96,663],[40,467],[-108,390],[-127,100],[-56,265],[-71,85],[3,163],[-289,-213],[-105,32],[-107,-133],[-222,13],[-149,370],[-91,427],[-197,390],[-209,-8],[-245,1],[-229,-69],[-224,-126],[-436,-346],[-154,-203],[-250,-171],[-248,168],[-126,-7],[-194,116],[-178,-7],[-329,-103],[-193,-170],[-275,-217],[-54,15],[-73,-5],[-286,282],[-252,450],[-237,323],[-187,381],[-75,44],[-200,238],[-144,316],[-49,216],[-34,437],[-122,349],[-108,232],[-71,76],[-69,118],[-32,261],[-41,130],[-80,97],[-149,247],[-117,39],[-63,166],[1,90],[-84,125],[-18,127],[-46,453],[36,262],[-115,460],[-138,210],[122,112],[134,415],[66,304],[-24,318],[78,291],[34,557],[-30,583],[-34,294],[28,295],[-72,281],[-146,255],[12,249],[13,274],[106,161],[91,308],[-18,200],[96,417],[155,376],[93,95],[74,344],[6,315],[100,365],[185,216],[177,603],[144,235],[259,66],[219,403],[139,158],[232,493],[-70,735],[106,508],[37,312],[179,399],[278,270],[206,244],[186,612],[87,362],[205,-2],[167,-251],[264,41],[288,-131],[121,-6],[267,323],[300,102],[175,244],[268,180],[471,105],[459,48],[140,-87],[262,232],[297,5],[113,-137],[190,35],[302,239],[195,-71],[-9,-299],[236,217],[20,-113],[-139,-289],[-2,-274],[96,-147],[-36,-511],[-183,-297],[53,-322],[143,-10],[70,-281],[106,-92],[326,-204],[117,51],[232,-98],[368,-264],[130,-526],[250,-114],[391,-248],[296,-293],[136,153],[133,272],[-65,452],[87,288],[200,277],[192,80],[375,-121],[95,-264],[104,-2],[88,-101],[276,-69],[68,-196],[369,10],[268,-156],[275,-175],[129,-92],[214,188],[114,169],[245,49],[198,-75],[75,-293],[65,193],[222,-140],[217,-33],[137,149],[80,194],[-19,34],[74,276],[56,446],[40,149],[8,6],[99,482],[138,416],[5,21],[-26,452],[68,243],[-102,268],[105,222],[-169,-51],[-233,136],[-191,-340],[-421,-66],[-225,317],[-300,20],[-64,-245],[-192,-71],[-268,315],[-303,-10],[-165,587],[-203,328],[135,459],[-176,283],[308,565],[428,23],[117,449],[529,-78],[334,383],[324,167],[459,13],[485,-416],[399,-229],[323,91],[239,-53],[328,309],[42,252],[-70,403],[-160,218],[-154,68],[-102,181],[-354,499],[-317,223],[-240,347],[202,95],[231,494],[-156,234],[410,241],[-8,129],[-249,-95],[-222,-48],[-185,-191],[-260,-31],[-239,-220],[16,-368],[136,-142],[284,35],[-55,-210],[-304,-103],[-377,-342],[-154,121],[61,277],[-304,173],[50,113],[265,197],[-80,135],[-432,149],[-19,221],[-257,-73],[-103,-325],[-215,-437],[6,-152],[-135,-128],[-84,56],[-78,-713],[-144,-245],[-101,-422],[89,-337],[33,-228],[243,-190],[-51,-145],[-330,-33],[-118,-182],[-232,-319],[-87,275],[3,122],[-169,17],[-145,56],[-336,-154],[192,-332],[-141,-96],[-154,0],[-147,304],[-52,-130],[62,-353],[139,-277],[-105,-130],[155,-272],[137,-171],[4,-334],[-257,157],[82,-302],[-176,-62],[105,-521],[-184,-7],[-228,257],[-104,472],[-49,393],[-108,272],[-143,337],[-18,168],[-48,41],[-5,130],[-154,199],[-24,281],[23,403],[38,184],[-46,93],[-59,46],[-78,192],[-120,118],[-261,218],[-161,213],[-254,176],[-233,435],[56,44],[-127,248],[-5,200],[-179,93],[-85,-255],[-82,198],[6,205],[10,9],[62,54],[-221,86],[-226,-210],[15,-293],[-34,-168],[91,-301],[261,-298],[140,-488],[309,-476],[217,3],[68,-130],[-78,-118],[249,-213],[204,-179],[238,-308],[29,-111],[-52,-211],[-154,276],[-242,97],[-116,-382],[200,-219],[-33,-309],[-116,-35],[-148,-506],[-116,-46],[1,181],[57,317],[60,126],[-108,342],[-85,298],[-115,74],[-82,255],[-179,107],[-120,238],[-206,38],[-217,267],[-254,384],[-189,341],[-86,584],[-138,68],[-226,195],[-128,-80],[-161,-274],[-115,-43],[-252,-334],[-548,160],[-404,-192],[-32,-355],[15,-344],[-263,-393],[-356,-125],[-25,-199],[-171,-327],[-107,-481],[108,-338],[-160,-263],[-60,-384],[-210,-118],[-197,-455],[-352,-8],[-265,11],[-174,-209],[-106,-223],[-136,49],[-103,199],[-79,340],[-259,92],[-112,-153],[-146,83],[-143,-65],[42,462],[-26,363],[-124,55],[-67,224],[22,386],[111,215],[20,239],[58,355],[-6,250],[-56,212],[-12,200],[14,420],[-114,257],[393,426],[340,-107],[373,4],[296,-101],[230,31],[449,-19],[144,354],[53,1177],[-287,620],[-205,299],[-424,228],[-28,430],[360,129],[466,-152],[-88,669],[263,-254],[646,461],[84,484],[243,119],[222,117],[143,162],[244,870],[380,247],[231,-17],[54,125],[232,32],[52,-130],[188,291],[-63,222],[-13,335],[-113,328],[-8,604],[46,159],[80,178],[244,36],[98,163],[223,167],[-9,-304],[-82,-192],[33,-166],[151,-89],[-68,-223],[-83,64],[-200,-425],[76,-288],[4,-228],[281,-138],[-3,-210],[283,111],[156,162],[313,-233],[132,-189],[189,174],[434,273],[350,200],[277,-100],[21,-144],[268,-7],[63,260],[383,191],[-59,497],[10,445],[136,371],[262,202],[221,-442],[223,12],[53,453],[32,349],[-102,-75],[-176,210],[-24,340],[351,164],[350,86],[301,-97],[287,17],[316,327],[-291,280],[-504,-47],[-489,-216],[-452,-125],[-161,322],[-269,195],[62,581],[-135,534],[133,344],[252,371],[635,640],[185,124],[-28,250],[-387,279],[-478,-167],[-269,-413],[43,-361],[-441,-475],[-537,-509],[-202,-832],[198,-416],[265,-328],[-255,-666],[-289,-138],[-106,-992],[-157,-554],[-337,57],[-158,-468],[-321,-27],[-89,558],[-232,671],[-211,835],[-187,363],[-548,-684],[-370,-138],[-385,301],[-99,635],[-88,1364],[256,380],[733,496],[549,609],[508,824],[668,1141],[465,444],[763,741],[610,259],[457,-31],[423,489],[506,-26],[499,118],[869,-433],[-358,-158],[305,-371],[286,206],[456,-358],[761,-140],[1050,-668],[213,-281],[18,-393],[-308,-311],[-454,-157],[-1240,449],[-204,-75],[453,-433],[36,-878],[358,-180],[217,-153],[36,286],[-174,263],[183,215],[672,-368],[234,144],[-187,433],[647,578],[256,-34],[260,-206],[161,406],[-231,352],[136,353],[-204,367],[777,-190],[158,-331],[-351,-73],[2,-328],[218,-203],[429,128],[68,377],[581,282],[969,507],[209,-29],[-273,-359],[344,-61],[199,202],[521,16],[412,245],[317,-356],[315,391],[-291,343],[145,195],[820,-179],[385,-185],[1006,-675],[186,309],[-282,313],[-8,125],[-335,58],[92,280],[-149,461],[-8,189],[512,535],[182,537],[207,116],[735,-156],[58,-328],[-263,-479],[173,-189],[89,-413],[-63,-809],[307,-362],[-120,-395],[-544,-839],[318,-87],[110,213],[306,151],[74,293],[240,281],[-162,336],[130,390],[-304,49],[-67,328],[222,594],[-361,481],[497,398],[-64,421],[139,13],[145,-328],[-109,-570],[297,-108],[-127,426],[465,233],[577,31],[513,-337],[-247,492],[-28,630],[484,119],[668,-26],[602,77],[-226,309],[321,388],[319,16],[540,293],[734,79],[93,162],[729,55],[227,-133],[624,314],[510,-10],[77,255],[265,252],[656,242],[476,-191],[-378,-146],[629,-90],[75,-292],[254,143],[812,-7],[626,-289],[223,-221],[-69,-307],[-307,-175],[-730,-328],[-209,-175],[345,-83],[410,-149],[250,112],[142,-379],[122,153],[444,93],[892,-97],[67,-276],[1162,-88],[15,451],[590,-103],[443,3],[449,-312],[128,-378],[-165,-247],[349,-465],[437,-240],[268,620],[446,-266],[473,159],[538,-182],[204,166],[455,-83],[-201,549],[367,256],[2509,-384],[236,-351],[727,-451],[1122,112],[553,-98],[231,-244],[-33,-432],[342,-168],[372,121],[492,15],[525,-116],[526,66],[484,-526],[344,189],[-224,378],[123,263],[886,-166],[578,36],[799,-282],[-99610,-258]],[[23933,96380],[-126,-17],[-521,38],[-74,165],[559,-9],[195,-109],[-33,-68]],[[19392,96485],[-518,-170],[-411,191],[224,188],[406,60],[392,-92],[-93,-177]],[[56867,96577],[-620,-241],[-490,137],[191,152],[-167,189],[575,119],[110,-222],[401,-134]],[[19538,97019],[-339,-115],[-461,1],[5,84],[285,177],[149,-27],[361,-120]],[[23380,96697],[-411,-122],[-226,138],[-119,221],[-22,245],[360,-24],[162,-39],[332,-205],[-76,-214]],[[22205,96856],[108,-247],[-453,66],[-457,192],[-619,21],[268,176],[-335,142],[-21,227],[546,-81],[751,-215],[212,-281]],[[79187,96845],[-1566,-228],[507,776],[229,66],[208,-38],[704,-336],[-82,-240]],[[55069,97669],[915,-440],[-699,-233],[-155,-435],[-243,-111],[-132,-490],[-335,-23],[-598,361],[252,210],[-416,170],[-541,499],[-216,463],[757,212],[152,-207],[396,8],[105,202],[408,20],[350,-206]],[[57068,98086],[545,-207],[-412,-318],[-806,-70],[-819,98],[-50,163],[-398,11],[-304,271],[858,165],[403,-142],[281,177],[702,-148]],[[64204,98169],[-373,-78],[-250,-45],[-39,-97],[-324,-98],[-301,140],[158,185],[-618,18],[542,107],[422,8],[57,-160],[159,142],[262,97],[412,-129],[-107,-90]],[[77760,97184],[-606,-73],[-773,170],[-462,226],[-213,423],[-379,117],[722,404],[600,133],[540,-297],[640,-572],[-69,-531]],[[25828,97644],[334,-190],[-381,-176],[-513,-445],[-492,-42],[-575,76],[-299,240],[4,215],[220,157],[-508,-4],[-306,196],[-176,268],[193,262],[192,180],[285,42],[-122,135],[646,30],[355,-315],[468,-127],[455,-112],[220,-390]],[[30972,99681],[742,-47],[597,-75],[508,-161],[-12,-157],[-678,-257],[-672,-119],[-251,-133],[605,3],[-656,-358],[-452,-167],[-476,-483],[-573,-98],[-177,-120],[-841,-64],[383,-74],[-192,-105],[230,-292],[-264,-202],[-429,-167],[-132,-232],[-388,-176],[39,-134],[475,23],[6,-144],[-742,-355],[-726,163],[-816,-91],[-414,71],[-525,31],[-35,284],[514,133],[-137,427],[170,41],[742,-255],[-379,379],[-450,113],[225,229],[492,141],[79,206],[-392,231],[-118,304],[759,-26],[220,-64],[433,216],[-625,68],[-972,-38],[-491,201],[-232,239],[-324,173],[-61,202],[413,112],[324,19],[545,96],[409,220],[344,-30],[300,-166],[211,319],[367,95],[498,65],[849,24],[148,-63],[802,100],[601,-38],[602,-37]],[[42472,99925],[1737,-469],[-513,-227],[-1062,-26],[-1496,-58],[140,-105],[984,65],[836,-204],[540,181],[231,-212],[-305,-344],[707,220],[1348,229],[833,-114],[156,-253],[-1132,-420],[-157,-136],[-888,-102],[643,-28],[-324,-431],[-224,-383],[9,-658],[333,-386],[-434,-24],[-457,-187],[513,-313],[65,-502],[-297,-55],[360,-508],[-617,-42],[322,-241],[-91,-208],[-391,-91],[-388,-2],[348,-400],[4,-263],[-549,244],[-143,-158],[375,-148],[364,-361],[105,-476],[-495,-114],[-214,228],[-344,340],[95,-401],[-322,-311],[732,-25],[383,-32],[-745,-515],[-755,-466],[-813,-204],[-306,-2],[-288,-228],[-386,-624],[-597,-414],[-192,-24],[-370,-145],[-399,-138],[-238,-365],[-4,-415],[-141,-388],[-453,-472],[112,-462],[-125,-488],[-142,-577],[-391,-36],[-410,482],[-556,3],[-269,324],[-186,577],[-481,735],[-141,385],[-38,530],[-384,546],[100,435],[-186,208],[275,691],[418,220],[110,247],[58,461],[-318,-209],[-151,-88],[-249,-84],[-341,193],[-19,401],[109,314],[258,9],[567,-157],[-478,375],[-249,202],[-276,-83],[-232,147],[310,550],[-169,220],[-220,409],[-335,626],[-353,230],[3,247],[-745,346],[-590,43],[-743,-24],[-677,-44],[-323,188],[-482,372],[729,186],[559,31],[-1188,154],[-627,241],[39,229],[1051,285],[1018,284],[107,214],[-750,213],[243,235],[961,413],[404,63],[-115,265],[658,156],[854,93],[853,5],[303,-184],[737,325],[663,-221],[390,-46],[577,-192],[-660,318],[38,253],[932,353],[975,-27],[354,218],[982,57],[2219,-74]]],"bbox":[-180,-85.60903777459777,180,83.64513000000002],"transform":{"scale":[0.0036000360003600037,0.0016925586033320111],"translate":[-180,-85.60903777459777]}}

```


####### sites/kit.svelte.dev/src/routes/edge.svg/+server.js #######

```

import { geoPath } from 'd3-geo';
import { geoSatellite } from 'd3-geo-projection';
import * as topojson from 'topojson-client';
import topology from './land-110m.json';
import countries from './countries.json';

const land = topojson.feature(topology, topology.objects.land);

const font_size = 36;

/**
 * distance of the satellite observer from the earth
 * https://github.com/d3/d3-geo-projection#satellite_distance
 */
const distance = 8;

const w = 1000;
const h = 1000;

const rad_to_deg = 180 / Math.PI;

const projection = geoSatellite()
	.distance(distance)
	.clipAngle(Math.acos(1 / distance) * rad_to_deg)
	.translate([w / 2, h / 2])
	.scale(450)
	.precision(0.5);

let isDark = false;

const path = geoPath(projection);

/**
 * @param {string | null} lat
 * @param {string | null} lon
 * @param {string} city
 * @param {string} country
 */
function render(lat, lon, city, country) {
	const coords = lat && lon ? [+lon, +lat] : [-74, 40.7];

	// spin globe a little west of the user's location so that it isn't
	// dead centre, and tilt them slightly towards the vertical center
	projection.rotate([-coords[0] - 30, -coords[1] * (30 / 90), 0]);

	const dot = lon && lat ? projection([lon, lat]) : null;

	const MAX_LABEL_LENGTH = 27;
	const DEFAULT_LABEL = 'Your location';

	let label = [city, country].filter(Boolean).join(', ') || DEFAULT_LABEL;
	if (label.length > MAX_LABEL_LENGTH) label = city ?? DEFAULT_LABEL;
	if (label.length > MAX_LABEL_LENGTH) label = country ?? DEFAULT_LABEL;
	if (label.length > MAX_LABEL_LENGTH) label = DEFAULT_LABEL;

	return `<?xml version="1.0" encoding="UTF-8"?>
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${w} ${h}">
			<style>
				path {
					stroke: none;
				}

				.ocean {
					fill: rgb(185,183,172);
				}

				.land {
					fill: white;
				}

				.highlight {
					fill: #ff3e00;
				}

				.dot {
					fill: #ff3e00;
					stroke: white;
					stroke-width: 5;
				}

				${
					isDark
						? `.ocean {
					fill: rgb(120,120,120);
				}

				.land {
					fill: #222;
				}

				.dot {
					stroke: #222;
				}`
						: ''
				} 
			</style>

			<path d="${path({ type: 'Sphere' })}" class="ocean"/>
			<path d="${path(land)}" class="land"/>

			${
				dot
					? `
			<g transform="translate(${dot[0]},${dot[1]})">
				<circle r="20" class="dot"/>
				<rect x="50" y="-30" width="${font_size * 0.6 * label.length + 40}" height="60" class="highlight"/>
				<polygon points="35,0 50,-10 50,10" class="highlight" />
				<text
					x="70"
					fill="white"
					text-anchor="start"
					alignment-baseline="middle"
					dominant-baseline="middle"
					style="font-family: 'Courier', 'Courier New'; font-size: ${font_size}px; font-weight: bold"
				>${label.toUpperCase()}</text>
			</g>`
					: ''
			}
		</svg>
	`;
}

export function GET({ request, url }) {
	const h = request.headers;

	isDark = !!url.searchParams.has('dark');

	const latitude = h.get('x-vercel-ip-latitude') ?? '';
	const longitude = h.get('x-vercel-ip-longitude') ?? '';
	const city = h.get('x-vercel-ip-city') ?? '';
	const country = countries[h.get('x-vercel-ip-country')];

	const svg = render(latitude, longitude, decodeURIComponent(city), country).replace(
		/\d\.\d+/g,
		(match) => match.slice(0, 4)
	);

	return new Response(svg, {
		headers: {
			'content-type': 'image/svg+xml',
			'cache-control': 'private, max-age=3600'
		}
	});
}

```


####### sites/kit.svelte.dev/src/routes/+error.svelte #######

```

<script>
	import { page } from '$app/stores';

	// we don't want to use <svelte:window bind:online> here, because we only care about the online
	// state when the page first loads
	let online = typeof navigator !== 'undefined' ? navigator.onLine : true;
</script>

<svelte:head>
	<title>{$page.status}</title>
</svelte:head>

<div class="container">
	{#if $page.status === 404}
		<h1>Not found!</h1>
	{:else if online}
		<h1>Yikes!</h1>

		{#if $page.error.message}
			<p class="error">{$page.status}: {$page.error.message}</p>
		{/if}

		<p>Please try reloading the page.</p>

		<p>
			If the error persists, please drop by <a href="https://svelte.dev/chat">Discord chatroom</a>
			and let us know, or raise an issue on
			<a href="https://github.com/sveltejs/svelte">GitHub</a>. Thanks!
		</p>
	{:else}
		<h1>It looks like you're offline</h1>

		<p>Reload the page once you've found the internet.</p>
	{/if}
</div>

<style>
	.container {
		padding: var(--sk-page-padding-top) var(--sk-page-padding-side) 6rem var(--sk-page-padding-side);
	}

	h1,
	p {
		margin: 0 auto;
	}

	h1 {
		font-size: 2.8em;
		font-weight: 300;
		margin: 0;
		margin-bottom: 0.5em;
	}

	p {
		margin: 1em auto;
	}

	.error {
		background-color: #da106e;
		color: white;
		padding: 12px 16px;
		font: 600 16px/1.7 var(--sk-font);
		border-radius: 2px;
	}
</style>

```


####### sites/kit.svelte.dev/src/routes/faq/+page.js #######

```

import { redirect } from '@sveltejs/kit';

export const load = ({}) => {
	redirect(301, '/docs/faq');
};

```


####### sites/kit.svelte.dev/src/routes/home/common.css #######

```

.hero-container:dir(rtl) {
	max-width: 116rem;
}

.home {
	--background-1: radial-gradient(circle at top right, rgb(230, 233, 236), rgb(244, 245, 247));
	--background-2: var(--sk-theme-2);
}

.home h2 {
	font-size: var(--sk-text-xl);
	line-height: 1.2;
}

.home .grid {
	display: grid;
	gap: 1em;
	margin: 0 0 4rem 0;
}

.home .grid:last-child {
	margin-bottom: 0;
}

@media (min-width: 900px) {
	.home h2 {
		font-size: var(--sk-text-xxl);
	}

	.home .grid {
		grid-template-columns: repeat(var(--columns), 1fr);
		gap: 7rem;
	}
}

/* In case JS disabled */
@media screen and (prefers-color-scheme: dark) {
	.home {
		/* --background-1: radial-gradient(circle at top right, rgb(49, 49, 49), rgb(77, 77, 77)); */
		--background-1: #222;
		--background-2: #444;
	}

	body.light .home {
		--background-1: radial-gradient(circle at top right, rgb(230, 233, 236), rgb(244, 245, 247));
		--background-2: var(--sk-theme-2);
	}
}

body.dark .home {
	/* --background-1: radial-gradient(circle at top right, rgb(49, 49, 49), rgb(77, 77, 77)); */
	--background-1: #222;
	--background-2: #444;
}

```


####### sites/kit.svelte.dev/src/routes/home/Deployment.svelte #######

```

<script>
	import { Section } from '@sveltejs/site-kit/components';
	import { theme } from '@sveltejs/site-kit/stores';

	import { base } from '$app/paths';
	import plus from '$lib/icons/plus.svg';
	import azure from './logos/azure.svg';
	import cloudflare from './logos/cloudflare.svg';
	import deno from './logos/deno.svg';
	import firebase from './logos/firebase.svg';
	import html5 from './logos/html5.svg';
	import lambda from './logos/lambda.svg';
	import netlify from './logos/netlify.svg';
	import node from './logos/node.svg';
	import vercel from './logos/vercel.svg';
</script>

<Section --background="var(--background-1)">
	<div class="grid" style="--columns: 3">
		<h2>deploy anywhere</h2>
		<div class="blurb">
			<p>
				Export static HTML files. Run your own Node server. Deploy code to the edge of the world. If
				a platform runs JavaScript, it runs SvelteKit — in some cases with <strong
					>zero configuration</strong
				>.
			</p>
			<p>Want to try deploying somewhere else? Swap out your adapter with a single line of code.</p>
		</div>
	</div>

	<div class="grid" style="--columns: 3">
		<div class="platforms left">
			<a
				target="_blank"
				rel="noreferrer"
				href="https://github.com/sveltejs/kit/tree/main/packages/adapter-static"
				class="invert"
			>
				<img src={html5} alt="" />
				<span><span class="large">Static</span> HTML</span>
			</a>
			<a
				target="_blank"
				rel="noreferrer"
				href="https://github.com/sveltejs/kit/tree/main/packages/adapter-node"
				class="invert"
			>
				<img src={node} alt="" />
				<span>Node.js</span>
			</a>
			<a
				target="_blank"
				rel="noreferrer"
				href="https://vercel.com/templates/svelte/sveltekit-boilerplate"
				class="invert invert-hover"
			>
				<img src={vercel} alt="" style="transform: translate(0,-0.2rem)" />
				<span>Vercel</span>
			</a>
			<a
				target="_blank"
				rel="noreferrer"
				href="https://github.com/sveltejs/kit/tree/main/packages/adapter-netlify"
			>
				<img src={netlify} alt="" />
				<span>Netlify</span>
			</a>
			<a
				target="_blank"
				rel="noreferrer"
				href="https://github.com/sveltejs/kit/tree/main/packages/adapter-cloudflare"
			>
				<img src={cloudflare} alt="" />
				<span>Cloudflare</span>
			</a>
		</div>

		<div class="platforms right">
			<a
				target="_blank"
				rel="noreferrer"
				href="https://github.com/jthegedus/svelte-adapter-firebase"
			>
				<img src={firebase} alt="" />
				<span>Firebase</span>
			</a>
			<a
				target="_blank"
				rel="noreferrer"
				href="https://github.com/pluvial/svelte-adapter-deno"
				class="invert invert-hover"
			>
				<img src={deno} alt="" />
				<span>Deno</span>
			</a>
			<a target="_blank" rel="noreferrer" href="https://github.com/MikeBild/sveltekit-adapter-aws">
				<img src={lambda} alt="" />
				<span>AWS</span>
			</a>
			<a
				target="_blank"
				rel="noreferrer"
				href="https://github.com/geoffrich/svelte-adapter-azure-swa"
			>
				<img src={azure} alt="" />
				<span>Azure</span>
			</a>
			<a target="_blank" rel="noreferrer" href="https://kit.svelte.dev/docs/adapters">
				<img src={plus} alt="" />
				<span>More...</span>
			</a>
		</div>

		<div class="globe">
			<img
				src="{base}/edge.svg?{$theme.current}"
				width="100%"
				height="100%"
				alt="Dynamically rendered map of the world, centered on the user's location"
			/>
			<span> rendered on the edge, just for you </span>
		</div>
	</div>
</Section>

<style>
	.globe {
		--max-size: 40rem;
		position: relative;
		width: 100%;
		max-height: var(--max-size);
		text-align: center;
		aspect-ratio: 1;
	}

	.globe img {
		max-width: var(--max-size);
		max-height: var(--max-size);
	}

	.globe span {
		position: absolute;
		bottom: -4rem;
		left: 0;
		width: 100%;
		color: var(--sk-text-3);
		font-size: var(--sk-text-xs);
	}

	.globe span::before {
		--size: 2rem;
		content: '';
		position: absolute;
		width: var(--size);
		height: var(--size);
		background: url($lib/icons/up-small.svg) no-repeat center;
		left: calc(50% - 0.5 * var(--size));
		top: -3rem;
	}

	.platforms {
		display: grid;
		grid-template-columns: repeat(5, 1fr);
		gap: 1rem;
		align-items: center;
	}

	.platforms a {
		display: flex;
		flex-direction: column;
		gap: 1rem;
		align-items: center;
		color: inherit;
	}

	.platforms.left {
		justify-content: flex-end;
		flex-direction: column-reverse;
	}

	.platforms a span {
		font-size: var(--sk-text-xs);
		color: var(--sk-text-3);
		text-align: center;
	}

	.platforms img {
		--size: 4rem;
		--invert: 0;
		--invert-hover: 0;
		width: var(--size);
		height: var(--size);
		object-fit: contain;
		filter: invert(var(--invert)) opacity(0.5) grayscale(100%);
		transition: filter 0.2s;
	}

	.platforms a:hover img,
	.platforms a:focus-visible img {
		filter: invert(var(--invert-hover));
		transition: none;
	}

	.platforms a:hover span,
	.platforms a:focus-visible span {
		color: var(--sk-text-1);
	}

	p {
		margin-top: 0;
	}

	.large {
		display: none;
	}

	@media (min-width: 600px) {
		.large {
			display: initial;
		}
	}

	@media (min-width: 900px) {
		.blurb {
			grid-column: 2 / 4;
		}

		.platforms {
			display: grid;
			grid-template-columns: none;
			grid-template-rows: repeat(4, 1fr);
			align-items: center;
		}

		.platforms a {
			--direction: -1;
			flex-direction: row;
			align-items: center;
			gap: 2rem;
			height: 100%;
		}

		.platforms.left {
			order: 1;
		}

		.globe {
			order: 2;
		}

		.platforms.right {
			order: 3;
		}

		.platforms a:first-child,
		.platforms a:last-child {
			transform: translate(calc(var(--direction) * 5rem), 0);
		}

		.platforms a:nth-child(2) {
			transform: translate(calc(var(--direction) * 1rem), -0.2rem);
		}

		.platforms a:nth-child(4) {
			transform: translate(calc(var(--direction) * 1rem), 0.2rem);
		}

		.platforms.left {
			justify-content: flex-end;
			flex-direction: row-reverse;
		}

		.platforms.left a {
			--direction: 1;
			flex-direction: row-reverse;
		}
	}

	@media (prefers-color-scheme: dark) {
		.platforms .invert img {
			--invert: 1;
		}

		.platforms .invert-hover img {
			--invert-hover: 1;
		}
	}

	:global(body.dark) .platforms .invert img {
		--invert: 1;
	}

	:global(body.dark) .platforms .invert-hover img {
		--invert-hover: 1;
	}
</style>

```


####### sites/kit.svelte.dev/src/routes/home/Features.svelte #######

```

<script>
	import { Section } from '@sveltejs/site-kit/components';
</script>

<Section --background="var(--sk-back-1)">
	<div class="container">
		<div class="features">
			<h2><span>features? we got 'em.</span></h2>
			<p class="wall">
				Mix and match <strong>prerendered</strong> pages for maximum performance with dynamic
				<strong>server-side rendering</strong> for maximum flexibility. Turn your app into a
				client-rendered
				<strong>PWA</strong> with a single line of code, for the whole thing or just one page. Use
				accessible <strong>client-side routing</strong> with automatic
				<strong>preloading</strong> for slick, instantaneous navigation that doesn't reload your
				entire page (and your analytics, and all that other junk). Protect your users with automatic
				<strong>CSRF protection</strong>
				and easy-to-use
				<strong>Content Security Policy</strong> configuration. Keep your secrets to yourself with
				advanced <strong>environment variable</strong> handling. Handle errors gracefully and
				<strong>securely</strong>. Load data
				<strong>directly from your database</strong>
				and connect your back end to your front end with <strong>type-safe</strong> data loading and
				built-in <strong>form actions</strong>
				that work with or without JavaScript. <strong>Co-exist</strong> with other client-side
				routing frameworks on the same page. Add service workers for <strong>offline</strong>
				support. Generate <strong>AMP-compliant</strong>
				pages if you really have to. Build complex UIs with unusually powerful
				<strong>filesystem-based routes</strong>. Nested layouts? Duh. Learn
				<strong>web standards</strong>
				that work across environments. Integrate with <strong>Tailwind</strong>
				and <strong>Playwright</strong> and <strong>Vitest</strong> and <strong>Storybook</strong>
				and, well, whatever you want. Build <strong>libraries</strong> as well as apps.
				<strong>Deploy anywhere</strong> with adapters.
			</p>

			<p>
				SvelteKit is the framework that
				<strong>grows with you</strong>, whatever you end up building.
			</p>
		</div>
	</div>
</Section>

<style>
	.container {
		display: flex;
		flex-direction: column;
	}

	.features {
		order: 1;
		text-align: justify;
	}

	h2 {
		float: right;
		width: 5.5em;
	}

	h2 span {
		display: block;
		text-align: right;
		width: 5em;
		margin: 0 0 0 auto;
	}

	.wall {
		margin: 0;
		font-size: var(--sk-text-xs);
	}

	p + p {
		margin-top: 1em;
	}

	p,
	strong {
		color: var(--sk-text-3);
	}

	@media (min-width: 600px) {
		h2 {
			margin-top: 0.5em;
			width: 10em;
		}

		h2 span {
			width: auto;
		}

		/* TODO remove the 62.5% hack so we can use rems in media queries */
		.container {
			--size: 40rem;
			display: block;
		}

		.features {
			padding: 2rem 0 2rem calc(0 * var(--size));
		}
	}

	@media (min-width: 900px) {
		.container {
			--size: 45rem;
		}

		h2 {
			margin-top: 0.1em;
		}

		p {
			font-size: var(--sk-text-s);
		}

		.features {
			padding-top: clamp(0px, calc(23.333vw - 210px), 70px);
		}
	}
</style>

```


####### sites/kit.svelte.dev/src/routes/home/Hero.svelte #######

```

<script>
	import { base } from '$app/paths';
	import Logotype from './svelte-kit-logotype.svg.svelte';
</script>

<section class="hero">
	<div class="hero-contents">
		<div class="hero-text">
			<div class="logotype" role="img" aria-label="SvelteKit">
				<Logotype />
			</div>

			<div class="tagline">web development, streamlined</div>
			<a href="{base}/docs/introduction" class="cta"> read the docs </a>
		</div>

		<div class="hero-image-wrapper">
			<enhanced:img
				src="./svelte-kit-machine.webp?w=1440;1080;768;640"
				sizes="(min-width: 768px) min(100vw, 108rem), 64rem"
				class="hero-image"
				alt="SvelteKit illustration"
			/>
		</div>
	</div>
</section>

<style>
	.hero {
		--gradient: radial-gradient(
				83.39% 117.39% at 47.58% 31.75%,
				rgba(242, 249, 255, 0.52) 0%,
				rgba(255, 255, 255, 0) 100%
			),
			linear-gradient(
				125deg,
				#e7f1fa 0%,
				rgba(238, 247, 255, 0.48) 34.51%,
				rgba(222, 234, 244, 0.62) 100%
			);

		--dark-gradient: radial-gradient(
				64.14% 72.25% at 47.58% 31.75%,
				hsl(209deg 6% 47% / 52%) 0%,
				hsla(0, 0%, 100%, 0) 100%
			),
			linear-gradient(
				92.4deg,
				hsl(210, 7%, 16%) 14.67%,
				hsl(0deg 0% 0% / 48%) 54.37%,
				hsla(207, 22%, 13%, 0.62) 92.49%
			),
			linear-gradient(0deg, hsl(204, 38%, 20%), hsl(204, 10%, 90%));

		max-width: 100vw;
		background: hsl(210, 7%, 84%);
		background: var(--gradient);
		background-blend-mode: hard-light, multiply, normal;
		position: relative;
		padding: 8rem var(--sk-page-padding-side);
		margin-bottom: 2rem;
	}

	.hero-contents {
		position: relative;
		max-width: 48rem;
		margin: 0 auto;
		padding-bottom: 10rem;
	}

	.hero-text {
		text-align: center;
	}

	.hero .tagline {
		font-size: var(--sk-text-l);
		font-weight: 200;
		line-height: 1.2;
		color: var(--sk-text-2);
		font-family: var(--sk-font);
		max-width: 12em;
		margin: 0 auto;
	}

	.logotype :global(svg) {
		position: relative;
		width: 100%;
		max-width: 400px;
		margin: 0 0 1rem 0;
	}

	.hero-image-wrapper {
		--size: 64rem;
		position: absolute;
		left: calc(50% - 0.53 * var(--size));
		bottom: -30rem;
		pointer-events: none;
	}

	.hero-image {
		width: var(--size);
		height: auto;
		aspect-ratio: 4 / 3;
		object-fit: cover;
	}

	.cta {
		display: inline-block;
		align-items: center;
		gap: 0.1rem;
		background: var(--sk-theme-1);
		padding: 0.35em 0.8em;
		width: max-content;
		margin-top: 1.6rem;
		font-size: var(--sk-text-s);
		letter-spacing: 0.05em;
		font-weight: 600;
		white-space: nowrap;
		border-radius: var(--sk-border-radius);
		box-shadow: 0px 6px 14px rgba(0, 0, 0, 0.08);
		color: #fff;
		color: color-mix(in hwb, hsl(var(--sk-theme-1-hsl)) 10%, var(--sk-back-1) 95%);
		transition: 0.5s var(--quint-out);
		transition-property: box-shadow, color;
	}

	.cta:hover {
		text-decoration: none;
		box-shadow:
			0px 0.8px 3.8px rgba(0, 0, 0, 0.115),
			0px 6px 30px rgba(0, 0, 0, 0.23);
	}

	@media (min-width: 400px) {
		.hero .tagline {
			max-width: none;
		}
	}

	@media (min-width: 768px) {
		.hero {
			padding: calc(10rem + var(--sk-nav-height)) var(--sk-page-padding-side) 16rem;
		}
		.hero-contents {
			max-width: calc(120rem - 2 * var(--sk-page-padding-side));
			padding-bottom: 0rem;
		}

		.hero-text {
			text-align: left;
		}

		.hero-image-wrapper {
			--size: min(100vw, 108rem);
			left: auto;
			right: -20rem;
			bottom: calc(-5rem - 0.38 * var(--size));
		}

		.cta {
			font-size: var(--sk-text-m);
		}
	}

	@media (prefers-color-scheme: dark) {
		.hero {
			background: hsl(210, 7%, 20%);
			background: var(--dark-gradient);
		}

		.hero-text :global(svg) {
			mix-blend-mode: screen;
		}

		:global(body.light) .hero {
			background: var(--gradient);
		}

		:global(body.light) .hero-text :global(svg) {
			mix-blend-mode: initial;
		}
	}

	:global(body.dark) .hero {
		background: hsl(210, 7%, 20%);
		background: var(--dark-gradient);
	}

	:global(body.dark) .hero-text :global(svg) {
		mix-blend-mode: screen;
	}
</style>

```


####### sites/kit.svelte.dev/src/routes/home/Intro.svelte #######

```

<script>
	import { Blurb } from '@sveltejs/site-kit/home';
</script>

<Blurb --background="var(--sk-back-1)">
	<div slot="one">
		<h2>fast</h2>
		<p>
			Powered by <a target="_blank" rel="noreferrer" href="https://svelte.dev">Svelte</a> and
			<a target="_blank" rel="noreferrer" href="https://vitejs.dev">Vite</a>, speed is baked into
			every crevice: fast setup, fast dev, fast builds, fast page loads, fast navigation. Did we
			mention it's fast?
		</p>
	</div>

	<div slot="two">
		<h2>fun</h2>
		<p>
			No more wasted days figuring out bundler configuration, routing, SSR, CSP, TypeScript,
			deployment settings and all the other boring stuff. Code with joy.
		</p>
	</div>

	<div slot="three">
		<h2>flexible</h2>
		<p>
			SPA? MPA? SSR? SSG? Check. SvelteKit gives you the tools to succeed whatever it is you're
			building. And it runs wherever JavaScript does.
		</p>
	</div>
</Blurb>

<style>
	p {
		font-size: var(--sk-text-m);
	}
</style>

```


####### sites/kit.svelte.dev/src/routes/home/Showcase.svelte #######

```

<script>
	import { Section } from '@sveltejs/site-kit/components';
	import pudding from './showcase/pudding.png?enhanced';
	import pocketbase from './showcase/pocketbase.png?enhanced';
	import pronauns from './showcase/pronauns.png?enhanced';
	import pausly from './showcase/pausly.png?enhanced';
	import asmeditor from './showcase/asmeditor.png?enhanced';
	import monogram from './showcase/monogram.png?enhanced';
	import raster from './showcase/raster.png?enhanced';
	import tradingstrategy from './showcase/tradingstrategy.png?enhanced';

	const showcase = [
		{ url: 'pudding.cool', image: pudding },
		{ url: 'www.pronauns.com', image: pronauns },
		{ url: 'www.pausly.app', image: pausly },
		{ url: 'asm-editor.specy.app', image: asmeditor },
		{ url: 'raster.app', image: raster },
		{ url: 'pocketbase.io', image: pocketbase },
		{ url: 'monogram.io', image: monogram },
		{ url: 'tradingstrategy.ai', image: tradingstrategy }
	];
</script>

<Section --background="var(--background-2)">
	<h2>showcase</h2>

	<div class="showcase">
		{#each showcase as { url, image }}
			<a href="https://{url}" target="_blank" rel="noreferrer">
				<enhanced:img src={image} alt="" style="width:100%; height:100%; object-fit:cover" />
				<span>{url}</span>
			</a>
		{/each}
	</div>
</Section>

<style>
	h2 {
		color: white;
		margin-bottom: 1em;
		text-transform: uppercase;
		font-size: var(--sk-text-s);
		text-align: center;
	}

	.showcase {
		display: grid;
		gap: 2rem;
	}

	a {
		overflow: hidden;
		color: var(--sk-text-1);
		display: flex;
		border-radius: var(--sk-border-radius);
		overflow: hidden;
		aspect-ratio: 16 / 9;
	}

	a :global(img) {
		width: 100%;
		height: 100%;
		margin: 0 0 0.5em 0;
		object-fit: cover;
		display: block;
		transition: transform 0.2s;
	}

	span {
		position: absolute;
		display: flex;
		align-items: center;
		justify-content: center;
		width: 100%;
		height: 100%;
		left: 0;
		top: 0;
		background: rgba(0, 0, 0, 0.25);
		color: white;
		backdrop-filter: blur(3px);
		opacity: 0;
		transition: opacity 0.2s;
		font-size: var(--sk-text-s);
		filter: drop-shadow(0 0 0.5rem rgba(0, 0, 0, 0.5));
	}

	a:hover span {
		opacity: 1;
	}

	a:hover :global(img) {
		transform: scale(1.05);
	}

	@media (min-width: 400px) {
		.showcase {
			grid-template-columns: repeat(2, 1fr);
		}
	}

	@media (min-width: 800px) {
		.showcase {
			grid-template-columns: repeat(4, 1fr);
		}
	}
</style>

```


####### sites/kit.svelte.dev/src/routes/home/subtitles.vtt #######

```

WEBVTT

00:00:00.000 --> 00:00:01.920
 [Scott Tolinski] I wanted to share it immediately.

00:00:01.920 --> 00:00:04.240
 I wanted to build more things in it.

00:00:04.240 --> 00:00:05.640
 [James Q Quick] I love it.

00:00:05.640 --> 00:00:07.080
 [Fireship] It's the only JavaScript framework

00:00:07.080 --> 00:00:08.640
 that's actually enjoyable to use.

00:00:08.640 --> 00:00:10.540
 [Ben McCann] Svelte introduced a new ergonomics

00:00:10.540 --> 00:00:13.160
 to building a website that's made it more fun

00:00:13.160 --> 00:00:15.440
 and easier than it's been in a long time.

00:00:15.440 --> 00:00:18.720
 And the way that it's done that is by introducing

00:00:18.720 --> 00:00:22.360
 this concept of generating reactive code at compile time.

00:00:22.360 --> 00:00:25.560
 [Scott Tolinski] What Svelte allows us to do is to write code

00:00:25.560 --> 00:00:29.400
 that's not only small and simple, but plain and readable.

00:00:29.400 --> 00:00:32.760
 [Amelia Wattenberger] You're mostly just looking at basic HTML,

00:00:32.760 --> 00:00:34.760
 JavaScript, and CSS.

00:00:34.760 --> 00:00:37.120
 [Aliza Aufrichtig] The thing I like most about using Svelte

00:00:37.120 --> 00:00:39.200
 is how fast you can move.

00:00:39.200 --> 00:00:42.400
 [Moritz Stefaner] And when I discovered Svelte, it came back to this,

00:00:42.400 --> 00:00:44.800
 oh, here's a really simple way to do things.

00:00:44.800 --> 00:00:47.480
 [Shawn Wang] You don't actually need all this machinery

00:00:47.480 --> 00:00:49.120
 in order to do components right.

00:00:49.120 --> 00:00:51.640
 I looked at my React experience so far —

00:00:51.640 --> 00:00:55.120
 I could not be anywhere as productive as I could be in Svelte.

00:00:55.120 --> 00:00:57.520
 And that's when it started really taking it seriously.

00:00:57.520 --> 00:00:59.800
 [Amelia Wattenberger] There's quite a bit of usage these days

00:00:59.800 --> 00:01:02.680
 and satisfaction is still, I think, the highest

00:01:02.680 --> 00:01:05.920
 or one of the highest for any of the larger

00:01:05.920 --> 00:01:08.120
 or more used JavaScript frameworks.

00:01:08.120 --> 00:01:10.040
 [Guillermo Rauch] When you write your application,

00:01:10.040 --> 00:01:13.160
 you're making it fast by construction.

00:01:13.160 --> 00:01:14.880
 It's almost impossible to create a slow app

00:01:14.880 --> 00:01:17.200
 and I think Svelte has an incredible advantage here.

00:01:17.200 --> 00:01:18.360
 People love Svelte.


```


####### sites/kit.svelte.dev/src/routes/home/svelte-kit-logotype.svg.svelte #######

```

<svg viewBox="30 31 400 50" width="400" height="50" xmlns="http://www.w3.org/2000/svg">
	<path
		class="svelte"
		d="M48.3359 80.876C44.4451 80.9736 40.6159 79.8942 37.3519 77.78C34.3023 75.7742 32.0378 72.7827 30.9387 69.3081L37.6241 66.8581C38.5518 68.991 40.066 70.8183 41.9916 72.1286C43.9468 73.4367 46.2574 74.1149 48.6113 74.0715C50.8732 74.1893 53.1053 73.5154 54.9219 72.1661C55.7123 71.5043 56.3367 70.6675 56.7454 69.7223C57.1541 68.7772 57.3357 67.7499 57.2758 66.7223C57.2852 65.7649 57.063 64.8193 56.6281 63.9657C56.2495 63.2023 55.7547 62.5019 55.1613 61.8894C54.4103 61.2078 53.5586 60.6454 52.6361 60.222C51.4981 59.6561 50.5542 59.2252 49.8042 58.9292C49.0543 58.6332 47.9513 58.2363 46.4952 57.7385C44.6761 57.1034 43.3118 56.6046 42.4023 56.242C41.1703 55.719 39.9737 55.1164 38.8202 54.4381C37.579 53.7813 36.4506 52.9313 35.4776 51.9202C34.6349 50.9339 33.9554 49.8197 33.4647 48.6198C32.5217 46.3326 32.3235 43.8075 32.8983 41.4018C33.473 38.9961 34.7915 36.8316 36.6673 35.2143C39.3991 32.8106 43.1066 31.6085 47.7898 31.608C51.7018 31.608 54.9201 32.4699 57.4448 34.1937C59.8955 35.819 61.695 38.2524 62.528 41.0678L55.9772 43.2446C55.3192 41.7704 54.2079 40.5431 52.8042 39.7406C51.1067 38.8008 49.184 38.3416 47.2438 38.4125C45.3411 38.3039 43.4564 38.8307 41.8875 39.9098C41.247 40.4053 40.7359 41.0476 40.3976 41.7822C40.0593 42.5168 39.9038 43.322 39.9443 44.1294C39.95 44.7485 40.0866 45.3594 40.3452 45.9222C40.6037 46.485 40.9784 46.987 41.4447 47.3956C42.3512 48.2863 43.4153 49.0016 44.5833 49.5054C45.6753 49.9589 47.3356 50.5712 49.5641 51.342C50.9278 51.8419 51.9396 52.2162 52.5993 52.4648C53.259 52.7134 54.2249 53.1332 55.4968 53.7242C56.5174 54.1744 57.4987 54.7086 58.4304 55.3213C59.2647 55.9196 60.0622 56.5673 60.8187 57.261C61.6416 57.9722 62.3444 58.8107 62.9003 59.7445C63.4302 60.7128 63.8425 61.7406 64.1285 62.8062C64.4763 64.0584 64.6485 65.3527 64.6401 66.6521C64.6401 71.0984 63.1162 74.5802 60.0685 77.0972C57.0207 79.6143 53.1098 80.8739 48.3359 80.876ZM92.0693 80.0599L75.6946 32.4241H83.3367L94.1846 65.6331C94.784 67.4193 95.2852 69.2369 95.6858 71.0777C96.085 69.2366 96.5861 67.4189 97.187 65.6331L107.899 32.4241H115.472L99.1646 80.0599H92.0693ZM129.935 80.0599V32.4241H159.546V39.0937H137.031V52.159H151.563V58.8286H137.031V73.3903H161.05V80.0599H129.935ZM179.126 80.0599V32.4241H186.223V73.2546H209.556V80.0599H179.126ZM236.301 39.2295V80.0599H229.204V39.2295H215.696V32.4241H249.813V39.2295H236.301ZM264.478 80.0599V32.4241H294.088V39.0937H271.574V52.159H286.106V58.8286H271.574V73.3903H295.593V80.0599H264.478Z"
	/>
	<path
		class="kit"
		d="M348.645 80.0599L335.205 55.1536L326.745 65.3616V80.0599H319.648V32.4241H326.745V55.4938L345.169 32.4241H353.356L339.986 49.1652L356.974 80.0599H348.645ZM372.319 80.0599V32.4241H379.416V80.0599H372.319ZM416.394 39.2295V80.0599H409.3V39.2295H395.789V32.4241H429.902V39.2295H416.394Z"
	/>
</svg>

<style>
	.svelte {
		fill: hsl(0, 0%, 27%);
	}

	.kit {
		fill: #8d8d93;
	}

	@media (prefers-color-scheme: dark) {
		.svelte {
			fill: hsl(0, 0%, 80%);
		}

		.kit {
			fill: #8d8d93;
		}

		:global(body.light) .svelte {
			fill: hsl(0, 0%, 27%);
		}

		:global(body.light) .kit {
			fill: #8d8d93;
		}
	}

	:global(body.dark) .svelte {
		fill: hsl(0, 0%, 80%);
	}

	:global(body.dark) .kit {
		fill: #8d8d93;
	}
</style>

```


####### sites/kit.svelte.dev/src/routes/home/Svelte.svelte #######

```

<script>
	import { Section } from '@sveltejs/site-kit/components';
	import Video from './Video.svelte';
</script>

<Section --background="var(--background-1)">
	<p class="definition">
		<em>/ˈsvɛlt/</em> <span class="adjective">adjective</span>
		<span class="description">attractively thin, graceful and stylish</span>
	</p>

	<div class="grid" style="--columns: 3">
		<div class="video-container">
			<Video />

			<p>
				<a
					target="_blank"
					rel="noreferrer"
					href="https://www.offerzen.com/community/svelte-origins-documentary"
				>
					Watch the full Svelte Origins documentary
				</a>
			</p>
		</div>

		<div>
			<p>
				SvelteKit is built on Svelte, a UI framework that uses a compiler to let you write
				breathtakingly concise components that do minimal work in the browser, using languages you
				already know — HTML, CSS and JavaScript. <strong
					>It's a love letter to web development.</strong
				>
			</p>

			<p>
				But don't take our word for it. Developers consistently rank Svelte as the framework they're
				<a
					target="_blank"
					rel="noreferrer"
					href="https://insights.stackoverflow.com/survey/2021#section-most-loved-dreaded-and-wanted-web-frameworks"
				>
					most
				</a>
				<a
					target="_blank"
					rel="noreferrer"
					href="https://tsh.io/state-of-frontend/#which-of-the-following-frameworks-would-you-like-to-learn-in-the-future"
				>
					excited
				</a>
				<a
					target="_blank"
					rel="noreferrer"
					href="https://2021.stateofjs.com/en-US/libraries/front-end-frameworks/"
				>
					about
				</a>

				<a
					target="_blank"
					rel="noreferrer"
					href="https://twitter.com/Rich_Harris/status/1589675637195042817"
				>
					using</a
				>.
			</p>
		</div>
	</div>
</Section>

<style>
	p {
		font-size: var(--sk-text-s);
	}

	.definition {
		font-size: var(--sk-text-l);
	}

	.definition em {
		font-style: normal;
		font-size: var(--sk-text-xxl);
		color: var(--sk-theme-1);
	}

	.definition .adjective {
		position: relative;
		top: -0.15em;
		padding: 0.25em 0.5em 0.1em;
		line-height: 1;
		margin: 0 1em;
		text-transform: uppercase;
		font-size: var(--sk-text-s);
		background: var(--sk-text-2);
		border-radius: var(--sk-border-radius);
		color: var(--sk-back-2);
	}

	.definition .description {
		display: block;
	}

	@media (min-width: 900px) {
		.definition .description {
			display: inline;
		}

		.video-container {
			order: 2;
			grid-column: 2 / 4;
		}
	}
</style>

```


####### sites/kit.svelte.dev/src/routes/home/Video.svelte #######

```

<script>
	import volume_off from './volume-off.svg';
	import volume_high from './volume-high.svg';
	import cc_on from './cc-on.svg';
	import cc_off from './cc-off.svg';
	import play from '$lib/icons/play.svg';
	import pause from '$lib/icons/pause.svg';
	import vtt from './subtitles.vtt';
	import { onMount } from 'svelte';
	import { browser } from '$app/environment';

	/** @type {HTMLVideoElement} */
	let video;

	let paused = false;
	let muted = true;
	let captioned = true;
	let has_used_controls = false;

	$: if (browser && video) {
		video.textTracks[0].mode = captioned ? 'showing' : 'hidden';
	}

	let d = 0;
	let t = 0;

	onMount(() => {
		// I think this binding is broken in SSR because the video already
		// has a duration by the time hydration occurs. TODO investigate
		d = video.duration;
		paused = video.paused;

		if (matchMedia('(prefers-reduced-motion)').matches) {
			return;
		}

		const observer = new IntersectionObserver(
			(entries) => {
				for (const entry of entries) {
					if (entry.isIntersecting) {
						video.play();
						observer.disconnect();
					}
				}
			},
			{
				threshold: 1
			}
		);

		observer.observe(video);

		return () => {
			observer.disconnect();
		};
	});

	/**
	 * @param {HTMLTrackElement} node
	 */
	function handle_cues(node) {
		const cues = node.track.cues;
		if (node.track.cues) {
			set_cue_positions(cues);
		} else {
			node.addEventListener('load', handle_load, { once: true });
		}

		return {
			destroy: () => {
				node.removeEventListener('load', handle_load);
			}
		};

		/**
		 * @param {Event} e
		 */
		function handle_load(e) {
			/** @type {HTMLTrackElement} */
			const track_el = e.target;
			set_cue_positions(track_el.track.cues);
		}

		/**
		 * @param {TextTrackCueList} cues
		 */
		function set_cue_positions(cues) {
			for (let i = 0; i < cues.length; i++) {
				// https://developer.mozilla.org/en-US/docs/Web/API/WebVTT_API#cue_settings
				cues[i].line = -2; // second line from the bottom
				cues[i].size = 80; // width is 80% of the available space
			}
		}
	}
</script>

<div class="video-player">
	<video
		src="https://sveltejs.github.io/assets/svelte-origins-preview.mp4"
		loop
		playsinline
		bind:this={video}
		bind:muted
		bind:paused
		bind:currentTime={t}
		bind:duration={d}
		on:click={() => {
			if (video.paused) {
				video.play();

				if (!has_used_controls) {
					muted = false;
				}
			} else {
				video.pause();
			}
		}}
	>
		<track kind="captions" srclang="en" src={vtt} default use:handle_cues />
	</video>

	{#if d}
		<div class="progress-bar" style={`width: ${(t / d) * 100}%`}></div>
	{/if}

	<div class="top-controls">
		<label class="captions" class:unused={!has_used_controls}>
			<input
				class="visually-hidden"
				type="checkbox"
				bind:checked={captioned}
				on:change={() => (has_used_controls = true)}
			/>

			<img style:display={captioned ? 'block' : 'none'} src={cc_on} alt="hide subtitles" />
			<img style:display={captioned ? 'none' : 'block'} src={cc_off} alt="show subtitles" />
		</label>

		<label class="mute" class:unused={!has_used_controls}>
			<input
				class="visually-hidden"
				type="checkbox"
				bind:checked={muted}
				on:change={() => (has_used_controls = true)}
			/>

			<img style:display={muted ? 'block' : 'none'} src={volume_off} alt="unmute" />
			<img style:display={muted ? 'none' : 'block'} src={volume_high} alt="mute" />
		</label>
	</div>

	<label class="play-pause">
		<input
			class="visually-hidden"
			type="checkbox"
			bind:checked={paused}
			on:change={() => {
				if (!has_used_controls) {
					muted = false;
				}
			}}
		/>

		<img style:display={paused ? 'block' : 'none'} src={play} alt="play" />
		<img style:display={paused ? 'none' : 'block'} src={pause} alt="pause" />
	</label>
</div>

<style>
	.video-player {
		position: relative;
		margin: 1em 0;
		border-radius: var(--sk-border-radius);
		filter: drop-shadow(0.5rem 0.5rem 1rem rgba(0, 0, 0, 0.2));
		overflow: hidden;
	}

	video {
		width: 100%;
		display: block;
		--control-filter: drop-shadow(0 0 3px rgba(0, 0, 0, 0.3));
	}

	video:focus {
		outline: 1px solid var(--sk-theme-1);
	}

	video::cue {
		font-size: 1.25rem;
		line-height: 1.3;
	}

	@media (min-width: 600px) {
		video::cue {
			font-size: 1.75rem;
		}
	}

	.progress-bar {
		position: absolute;
		left: 0;
		bottom: 0;
		height: 0.5rem;
		background: var(--sk-theme-1);
		transition: height 0.2s;
	}

	label {
		opacity: 0.2;
		transition: opacity 0.2s;
	}

	.top-controls {
		position: absolute;
		top: 1rem;
		right: 1rem;
		display: flex;
		align-items: center;
		gap: 1rem;
	}

	.play-pause {
		left: 1rem;
		bottom: 2rem;
		position: absolute;
	}

	.captions {
		line-height: 1;
		color: white;
		font-size: 2rem;
		font-weight: 700;
		filter: var(--control-filter);
	}

	label.unused {
		opacity: 0.8;
	}

	label img {
		width: 3rem;
		height: 3rem;
		filter: var(--control-filter);
	}

	/* TODO re-enable when we get drag-to-seek */
	/* .video-player:hover .progress-bar {
		height: 1rem;
		border-radius: 0 var(--sk-border-radius) var(--sk-border-radius) var(--sk-border-radius);
	} */

	.video-player:hover label {
		opacity: 1;
	}

	.video-player input:focus-visible ~ img {
		outline: 2px solid var(--sk-theme-1);
		outline-offset: 2px;
		border-radius: var(--sk-border-radius);
	}
</style>

```


####### sites/kit.svelte.dev/src/routes/+layout.server.js #######

```

import { fetchBanner } from '@sveltejs/site-kit/components';

export const prerender = true;

export const load = async ({ url, fetch }) => {
	const nav_links = fetch('/nav.json').then((r) => r.json()); // TODO why is this behind a `fetch`? does `nav.json` need to be exposed publicly?
	const banner = fetchBanner('kit.svelte.dev', fetch);

	return {
		nav_title: get_nav_title(url),
		nav_links: await nav_links,
		banner: await banner
	};
};

/** @param {URL} url */
function get_nav_title(url) {
	const list = new Map([[/^docs/, 'Docs']]);

	for (const [regex, title] of list) {
		if (regex.test(url.pathname.replace(/^\/(.+)/, '$1'))) {
			return title;
		}
	}

	return '';
}

```


####### sites/kit.svelte.dev/src/routes/+layout.svelte #######

```

<script>
	import '@sveltejs/site-kit/styles/index.css';

	import { browser } from '$app/environment';
	import { page } from '$app/stores';
	import { Banners, Icon, Shell } from '@sveltejs/site-kit/components';
	import { Nav, Separator } from '@sveltejs/site-kit/nav';
	import { Search, SearchBox } from '@sveltejs/site-kit/search';

	export let data;

	/** @type {import('@sveltejs/kit').Snapshot<number>} */
	let shell_snapshot;

	/** @type {import('@sveltejs/kit').Snapshot<{shell: number}>} */
	export const snapshot = {
		capture() {
			return {
				shell: shell_snapshot?.capture()
			};
		},
		restore(data) {
			shell_snapshot?.restore(data.shell);
		}
	};
</script>

<div style:display={$page.url.pathname !== '/docs' ? 'contents' : 'none'}>
	<Shell nav_visible={$page.url.pathname !== '/repl/embed'} bind:snapshot={shell_snapshot}>
		<Nav slot="top-nav" title={data.nav_title} links={data.nav_links}>
			<svelte:fragment slot="home-large">
				<strong>kit</strong>.svelte.dev
			</svelte:fragment>

			<svelte:fragment slot="home-small">
				<strong>kit</strong>
			</svelte:fragment>

			<svelte:fragment slot="search">
				{#if $page.url.pathname !== '/search'}
					<Search />
				{/if}
			</svelte:fragment>

			<svelte:fragment slot="external-links">
				<a href="https://learn.svelte.dev/tutorial/introducing-sveltekit" rel="external">Tutorial</a
				>
				<a href="https://svelte.dev">Svelte</a>

				<Separator />

				<a href="https://svelte.dev/chat" rel="external" title="Discord Chat">
					<span class="small">Discord</span>
					<span class="large"><Icon name="discord" /></span>
				</a>

				<a href="https://github.com/sveltejs/kit" title="GitHub Repo">
					<span class="small">GitHub</span>
					<span class="large"><Icon name="github" /></span>
				</a>
			</svelte:fragment>
		</Nav>

		<slot />

		<Banners slot="banner-bottom" data={data.banner} />
	</Shell>
</div>

{#if browser}
	<SearchBox />
{/if}

<style>
	.small {
		display: inline;
	}

	.large {
		display: none;
	}

	@media (min-width: 800px) {
		.small {
			display: none;
		}

		.large {
			display: inline;
		}
	}

	:global(.examples-container, .repl-outer, .tutorial-outer) {
		height: calc(100vh - var(--sk-nav-height)) !important;
	}

	:global(.toggle) {
		bottom: 0 !important;
	}
</style>

```


####### sites/kit.svelte.dev/src/routes/nav.json/+server.js #######

```

import { get_docs_list } from '$lib/server/docs/index.js';
import { json } from '@sveltejs/kit';

export const prerender = true;

export const GET = async () => {
	const docs_list = get_docs_list();

	/** @type {import('@sveltejs/site-kit').NavigationLink[]} */
	const nav_list = [
		{
			title: 'Docs',
			prefix: 'docs',
			pathname: '/docs/introduction',
			sections: [
				{
					title: 'DOCS',
					sections: docs_list.map(({ title, pages }) => ({
						title,
						sections: pages.map(({ title, path }) => ({ title, path }))
					}))
				}
			]
		}
	];

	return json(nav_list);
};

```


####### sites/kit.svelte.dev/src/routes/+page.js #######

```

export function load({ setHeaders }) {
	setHeaders({
		'cache-control': 'public, max-age=60'
	});
}

```


####### sites/kit.svelte.dev/src/routes/+page.svelte #######

```

<script>
	import { Footer, TrySection } from '@sveltejs/site-kit/home';
	import { onMount } from 'svelte';
	import Deployment from './home/Deployment.svelte';
	import Features from './home/Features.svelte';
	import Hero from './home/Hero.svelte';
	import Intro from './home/Intro.svelte';
	import Showcase from './home/Showcase.svelte';
	import Svelte from './home/Svelte.svelte';
	import schema_url from './schema.json?url';

	import './home/common.css';

	let schema;
	onMount(async () => {
		// Google will not allow linking to a schema file. It must be in the DOM
		// We load it and add it to the DOM to save bytes on page load vs inlining
		const json = await (await fetch(schema_url)).text();
		schema = `<script type="application/ld+json">${json}<\/script>`;
	});
</script>

<svelte:head>
	<title>SvelteKit • Web development, streamlined</title>

	<meta name="twitter:title" content="SvelteKit" />
	<meta name="twitter:description" content="Web development, streamlined" />
	<meta name="description" content="SvelteKit is the official Svelte application framework" />

	<meta property="og:type" content="website" />
	<meta property="og:title" content="SvelteKit • Web development, streamlined" />
	<meta
		property="og:description"
		content="SvelteKit is the official Svelte application framework"
	/>
	<meta property="og:url" content="https://kit.svelte.dev/" />
	<meta
		property="og:image"
		content="https://raw.githubusercontent.com/sveltejs/branding/master/svelte-logo.svg"
	/>

	{#if schema}
		{@html schema}
	{/if}
</svelte:head>

<div class="home">
	<h1 class="visually-hidden">SvelteKit</h1>

	<Hero />
	<Intro />
	<TrySection />
	<Svelte />
	<Features />
	<Deployment />
	<Showcase />

	<Footer
		links={{
			resources: [
				{
					title: 'documentation',
					href: '/docs'
				},
				{
					title: 'tutorial',
					href: 'https://learn.svelte.dev/tutorial/introducing-sveltekit'
				},
				{
					title: 'blog',
					href: 'https://svelte.dev/blog'
				}
			],
			connect: [
				{
					title: 'github',
					href: 'https://github.com/sveltejs/kit'
				},
				{
					title: 'opencollective',
					href: 'https://opencollective.com/svelte'
				},
				{
					title: 'discord',
					href: 'https://svelte.dev/chat'
				},
				{
					title: 'twitter',
					href: 'https://twitter.com/sveltejs'
				}
			]
		}}
	>
		<span slot="license">
			SvelteKit is <a target="_blank" rel="noreferrer" href="https://github.com/sveltejs/kit"
				>free and open source software</a
			> released under the MIT license.
		</span></Footer
	>
</div>

```


####### sites/kit.svelte.dev/src/routes/schema.json #######

```

{
	"@context": "http://schema.org",
	"@type": "SoftwareSourceCode",
	"name": "SvelteKit",
	"description": "SvelteKit is the official Svelte application framework.",
	"url": "https://kit.svelte.dev/",
	"codeRepository": "https://github.com/sveltejs/kit",
	"dateCreated": "2020-10-15T16:00:00",
	"programmingLanguage": ["JavaScript", "TypeScript"],
	"image": "https://raw.githubusercontent.com/sveltejs/branding/master/svelte-logo.svg",
	"sameAs": ["https://github.com/sveltejs/kit", "https://www.npmjs.com/package/@sveltejs/kit"],
	"license": "https://github.com/sveltejs/kit/blob/main/LICENSE",
	"releasedEvent": {
		"@type": "PublicationEvent",
		"startDate": "2022-12-14T17:00:00",
		"url": [
			"https://svelte.dev/blog/announcing-sveltekit-1.0",
			"https://www.youtube.com/watch?v=N4BRVkQVoMc"
		]
	},
	"contributor": [
		{
			"@type": "Person",
			"name": "Rich Harris",
			"url": "https://www.rich-harris.co.uk",
			"image": "https://avatars.githubusercontent.com/u/1162160",
			"sameAs": ["https://github.com/Rich-Harris", "https://twitter.com/Rich_Harris"]
		},
		{
			"@type": "Person",
			"name": "Ben McCann",
			"url": "https://www.benmccann.com",
			"image": "https://avatars.githubusercontent.com/u/322311",
			"sameAs": [
				"https://github.com/benmccann",
				"https://twitter.com/benjaminmccann",
				"https://about.me/benmccann",
				"https://angel.co/ben-mccann",
				"https://www.crunchbase.com/person/benjamin-mccann",
				"https://www.linkedin.com/in/benmccann"
			]
		},
		{
			"@type": "Person",
			"name": "Simon Holthausen",
			"image": "https://avatars.githubusercontent.com/u/5968653",
			"sameAs": ["https://github.com/dummdidumm", "https://twitter.com/dummdidumm_"]
		},
		{
			"@type": "Person",
			"name": "Ignatius Bagus",
			"url": "https://mauss.dev/",
			"image": "https://avatars.githubusercontent.com/u/8156777",
			"sameAs": [
				"https://twitter.com/alchemauss",
				"https://github.com/ignatiusmb",
				"https://gitlab.com/ignatiusmb",
				"https://www.linkedin.com/in/ignatiusmb"
			]
		},
		{
			"@type": "Person",
			"name": "Conduitry",
			"url": "https://conduitry.dev/",
			"image": "https://avatars.githubusercontent.com/u/16696352",
			"sameAs": ["https://github.com/Conduitry"]
		},
		{
			"@type": "Person",
			"name": "Dominik Göpel",
			"url": "https://goepel.it/",
			"image": "https://avatars.githubusercontent.com/u/611613",
			"sameAs": ["https://github.com/dominikg", "https://m.webtoo.ls/@dominikg"]
		},
		{
			"@type": "Person",
			"name": "Bjorn Lu",
			"url": "https://bjornlu.com/",
			"image": "https://avatars.githubusercontent.com/u/34116392",
			"sameAs": [
				"https://github.com/bluwy",
				"https://twitter.com/bluwyoo",
				"https://m.webtoo.ls/@bluwy",
				"https://www.linkedin.com/in/bjorn-lu-3302a31b5",
				"https://www.reddit.com/user/IamLUG"
			]
		}
	]
}

```


####### sites/kit.svelte.dev/src/routes/search/+page.js #######

```

export const prerender = false;

```


####### sites/kit.svelte.dev/src/routes/search/+page.server.js #######

```

import { init, inited, search } from '@sveltejs/site-kit/search';

export async function load({ url, fetch }) {
	if (!inited) {
		const res = await fetch('/content.json');
		if (!res.ok) throw new Error("Couldn't fetch content");

		const blocks = (await res.json()).blocks;
		init(blocks);
	}

	const query = url.searchParams.get('q');

	const results = query ? search(query) : [];

	return {
		query,
		results
	};
}

```


####### sites/kit.svelte.dev/src/routes/search/+page.svelte #######

```

<script>
	import { SearchResults } from '@sveltejs/site-kit/search';

	export let data;
</script>

<svelte:head>
	<title>Search • SvelteKit</title>
</svelte:head>

<main>
	<h1>Search</h1>
	<form>
		<input
			name="q"
			value={data.query}
			type="search"
			aria-label="Search"
			placeholder="Search"
			spellcheck="false"
		/>
	</form>

	<SearchResults results={data.results} query={data.query} />
</main>

<style>
	main {
		max-width: 48rem;
		margin: 0 auto;
		padding: 8rem 1rem;
	}

	form {
		--size: 4rem;
		position: relative;
		width: 100%;
		height: var(--size);
		margin: 0 0 2em 0;
	}

	input {
		display: block;
		width: 100%;
		height: 100%;
		font-family: inherit;
		font-size: inherit;
		border: 1px solid var(--sk-back-5);
		border-radius: var(--sk-border-radius);
		padding-left: var(--size);
		border-radius: var(--size);
		background: no-repeat 1rem 50% / 2rem 2rem url($lib/icons/search.svg);
		color: var(--sk-text-1);
	}
</style>

```


####### sites/kit.svelte.dev/static/manifest.json #######

```

{
	"background_color": "#ffffff",
	"theme_color": "#ff3e00",
	"name": "SvelteKit",
	"short_name": "SvelteKit",
	"display": "minimal-ui",
	"start_url": "/",
	"icons": [
		{
			"src": "images/svelte-android-chrome-192.png",
			"sizes": "192x192",
			"type": "image/png"
		},
		{
			"src": "images/svelte-android-chrome-512.png",
			"sizes": "512x512",
			"type": "image/png"
		}
	]
}

```


####### sites/kit.svelte.dev/static/opensearch.xml #######

```

<OpenSearchDescription xmlns="http://a9.com/-/spec/opensearch/1.1/"
    xmlns:moz="http://www.mozilla.org/2006/browser/search/">
    <ShortName>SvelteKit</ShortName>
    <Description>Search SvelteKit</Description>
    <InputEncoding>UTF-8</InputEncoding>
    <Image width="128" height="128" type="image/png">https://kit.svelte.dev/favicon.png</Image>
    <Url type="text/html" method="get"
        template="https://kit.svelte.dev/search?q={searchTerms}" />
    <moz:SearchForm>https://kit.svelte.dev/search</moz:SearchForm>
</OpenSearchDescription>
```


####### sites/kit.svelte.dev/static/robots.txt #######

# https://www.robotstxt.org/robotstxt.html
User-agent: *
Disallow:

####### sites/kit.svelte.dev/svelte.config.js #######

```

import adapter from '@sveltejs/adapter-vercel';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	kit: {
		adapter: adapter({
			runtime: 'edge'
		}),

		paths: {
			relative: true
		}
	}
};

export default config;

```


####### sites/kit.svelte.dev/tsconfig.json #######

```

{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"allowJs": true,
		"checkJs": true,
		"allowSyntheticDefaultImports": true,
		"module": "es2022",
		"moduleResolution": "bundler",
		"outDir": "build"
	}
}

```


####### sites/kit.svelte.dev/vercel.json #######

```

{
	"$schema": "http://openapi.vercel.sh/vercel.json",
	"github": {
		"silent": true
	},
	"trailingSlash": false,
	"installCommand": "pnpm install --frozen-lockfile --verbose && pnpm rebuild",
	"buildCommand": "cd ../../packages/kit && pnpm prepublishOnly && cd ../../sites/kit.svelte.dev && pnpm build"
}

```


####### sites/kit.svelte.dev/vite.config.js #######

```

import { sveltekit } from '@sveltejs/kit/vite';
import { enhancedImages } from '@sveltejs/enhanced-img';
import browserslist from 'browserslist';
import { browserslistToTargets } from 'lightningcss';

/** @type {import('vite').UserConfig} */
const config = {
	assetsInclude: ['**/*.vtt'],

	logLevel: 'info',

	css: {
		transformer: 'lightningcss',
		lightningcss: {
			targets: browserslistToTargets(browserslist(['>0.2%', 'not dead']))
		}
	},
	build: {
		cssMinify: 'lightningcss'
	},

	plugins: [enhancedImages(), sveltekit()],

	ssr: {
		noExternal: ['@sveltejs/site-kit']
	},
	optimizeDeps: {
		exclude: ['@sveltejs/site-kit']
	},

	server: {
		fs: {
			strict: false
		}
	}
};

export default config;

```

